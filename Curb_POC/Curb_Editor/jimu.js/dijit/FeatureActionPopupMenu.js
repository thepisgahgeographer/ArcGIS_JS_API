// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/_base/array jimu/accessibleUtils dojo/on dojo/keys dijit/a11yclick dojo/dom-geometry dijit/_WidgetBase dijit/_TemplatedMixin jimu/FeatureActionManager ./FeatureActionPopupMenuItem".split(" "),function(n,d,f,l,p,h,g,q,r,t,u,v,w){var k=null,m=n([t,u],{baseClass:"popup-menu",templateString:'\x3cdiv\x3e\x3cdiv data-dojo-attach-point\x3d"menuNode" class\x3d"menu-content"\x3e\x3cdiv class\x3d"menu-title" data-dojo-attach-point\x3d"titleNode"\x3e\x3cdiv role\x3d"title" class\x3d"label jimu-float-leading" data-dojo-attach-point\x3d"labelNode" tabindex\x3d"0"\x3e\x3c/div\x3e\x3cdiv class\x3d"feature-action icon-close close-btn jimu-float-trailing" data-dojo-attach-point\x3d"closeBtn" tabindex\x3d"0"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"menu-items" data-dojo-attach-point\x3d"menuContent" tabindex\x3d"0"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this._setFocusedNodeBeforeOpen();this.inherited(arguments);this.hide();this.menuItems=[];this.own(h(this.domNode,"click",f.hitch(this,function(a){a=a.target||a.srcElement;a===this.menuNode||d.isDescendant(a,this.menuNode)||this.hide()})));this._a11y_addEvents()},_setFocusedNodeBeforeOpen:function(){this.focusedNodeBeforeOpen=document.activeElement},_a11y_addEvents:function(){this.own(h(this.labelNode,"keydown",f.hitch(this,function(a){a.shiftKey&&a.keyCode===g.TAB&&(a.preventDefault(),
this.hide())})));this.own(h(this.closeBtn,q,f.hitch(this,this.hide)));this.own(h(this.menuContent,"focus",f.hitch(this,function(){this.currentMenuItem=this.menuItems[0].domNode;l.forEach(this.menuItems,function(a){d.hasClass(a.domNode,"selected")&&(this.currentMenuItem=a.domNode)});this.currentMenuItem.focus()})));this.own(h(this.menuContent,"keydown",f.hitch(this,function(a){a.keyCode===g.ESCAPE&&(a.stopPropagation(),this.hide());if(d.hasClass(a.target,"popup-menu-item"))if(a.keyCode!==g.TAB||(!a.shiftKey||
this.hasTitle)&&a.shiftKey){if(a.keyCode===g.DOWN_ARROW)var b=this.currentMenuItem.nextSibling?this.currentMenuItem.nextSibling:this.currentMenuItem;else a.keyCode===g.UP_ARROW?b=this.currentMenuItem.previousSibling?this.currentMenuItem.previousSibling:this.currentMenuItem:a.keyCode===g.HOME?b=this.menuItems[0].domNode:a.keyCode===g.END&&(b=this.menuItems[this.menuItems.length-1].domNode);b&&(this.currentMenuItem=b,b.focus())}else a.preventDefault(),this.hide()})))},setActions:function(a){this.clearActions();
l.forEach(a,f.hitch(this,this._addMenuItem))},appendAction:function(a){this._addMenuItem(a)},clearActions:function(){this.menuItems=[];d.empty(this.menuContent)},_addMenuItem:function(a){var b=new w({action:a});d.place(b.domNode,this.menuContent);b.startup();this.menuItems.push(b);this.own(h(b,"click",f.hitch(this,function(e){e?(e=0<=["ShowStatistics","SaveToMyContent","ChangeSymbol"].indexOf(b.action.name),p.isInNavMode()&&e||this.hide()):this.hide()})))},markAsSelected:function(a){l.forEach(this.menuItems,
function(b){b.action.label===a.label?b.setSelected(!0):b.setSelected(!1)})},prepareActions:function(a,b){return v.getInstance().getSupportedActions(a).then(f.hitch(this,function(e){!1===b&&(e=l.filter(e,function(c){return 0!==c.name.indexOf("Export")&&"SaveToMyContent"!==c.name}));l.forEach(e,function(c){c.data=a},this);this.setActions(e)}))},hide:function(){d.setStyle(this.domNode,"display","none");this.focusedNodeBeforeOpen&&this.focusedNodeBeforeOpen.focus()},show:function(a,b){if(0===this.menuItems.length)d.setStyle(this.domNode,
"display","none");else{"string"===typeof b&&""!==b?(this.labelNode.innerHTML=b,d.setStyle(this.titleNode,"display","")):(this.labelNode.innerHTML="",d.setStyle(this.titleNode,"display","none"));var e=a.y+a.h;a=window.isRTL?a.x:a.x+a.w;d.setStyle(this.domNode,"display","");d.setStyle(this.menuNode,{left:"-1000px",top:"0px",display:"block"});var c=r.getMarginSize(this.menuNode);d.setStyle(this.menuNode,{left:(window.isRTL?a+c.w>window.innerWidth?window.innerWidth-c.w:0>a?0:a:0>a-c.w?0:a>window.innerWidth?
window.innerWidth-c.w:a-c.w)+"px",top:(c.h>window.innerHeight?0:e+c.h>window.innerHeight?window.innerHeight-c.h:e+c.h+5<window.innerHeight?e+5:e)+"px"});"string"===typeof b&&""!==b?(this.labelNode.focus(),this.hasTitle=!0):(this.menuContent.focus(),this.hasTitle=!1)}}});m.getInstance=function(){null===k&&(k=new m,d.place(k.domNode,document.body),k.startup());k.setActions([]);return k};return m});