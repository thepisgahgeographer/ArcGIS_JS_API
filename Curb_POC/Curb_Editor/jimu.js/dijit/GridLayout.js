// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/_base/declare dojo/_base/lang dojo/_base/array dijit/_WidgetBase dojo/dom-geometry dojo/dom-class dojo/Evented dojo/debounce".split(" "),function(p,l,m,q,r,n,t,u){return p([q,t],{baseClass:"jimu-dijit-gridlayout",declaredClass:"jimu.dijit.GridLayout",container:null,layoutDefinition:null,components:null,editable:!1,_layout:null,_coordinates:null,_isCreatingLayout:null,postCreate:function(){this.inherited(arguments);this._isCreatingLayout=!1;this._createLayout(this.layoutDefinition)},restoreLayout:function(a){a=
a||this.layoutDefinition;this._createLayout(a)},destroy:function(){m.forEach(this.components,function(a){a.dijit.destroy()});this._layout.destroy();this.inherited(arguments)},getLayoutDefinition:function(){return this._layout.toConfig().content},resize:function(){var a=r.getMarginBox(this.container);this._layout.updateSize(a.w,a.h)},getComponentSize:function(a){return(a=this._layout.root.contentItems[0].getItemsById(a))&&0<a.length?(a=a[0].container,{w:a.width,h:a.height}):{w:0,h:0}},getSize:function(){return{w:this._layout.width,
h:this._layout.height}},setVisible:function(a,g){var b=this._layout.root.contentItems[0].getItemsById(a);b&&0<b.length&&!1===g?this._hideComponent(b[0]):b&&0!==b.length||!0!==g||this._showComponent(a)},highlightItem:function(a){(a=this._layout.root.contentItems[0].getItemsById(a))&&0<a.length&&a[0].highlight()},unhighlightItem:function(a){(a=this._layout.root.contentItems[0].getItemsById(a))&&0<a.length&&a[0].unhighlight()},_createLayout:function(a){if(!this._isCreatingLayout){this._coordinates={};
this._isCreatingLayout=!0;var g={settings:{hasHeaders:!1,resizeEnabled:this.editable,reorderEnabled:this.editable,selectionEnabled:this.editable,highlightEnabled:this.editable},dimensions:{borderWidth:1,dragProxyWidth:0,dragProxyHeight:0},content:a},b=this._layout;require(["libs/goldenlayout/goldenlayout"],l.hitch(this,function(h){this._layout=new h(g,this.container);this._layout.registerComponent("jimu grid",l.hitch(this,function(c,d){var e;c.parent.config.id=d.id;m.some(this.components,function(f){if(f.id===
d.id)return e=f.dijit,c.getElement().html(f.dijit.domNode),!0},this);c.on("resize",u(l.hitch(this,function(){0<c.width&&0<c.height&&e&&"function"===typeof e.resize&&e.resize(c.width,c.height)}),200));c.on("select",l.hitch(this,function(){this.editable&&c.parent.select();this.emit("mask-click",c.parent.config.id)}))}));this._layout.on("initialised",l.hitch(this,function(){this._resetCoordinate();this.emit("initialised");this._isCreatingLayout=!1;b&&b.destroy()}));this._layout.on("stateChanged",l.hitch(this,
function(){this._resetCoordinate()}));this._layout.init();this.editable||n.add(this._layout.root.childElementContainer[0],"viewonly");n.add(this._layout.root.childElementContainer[0],"jimu-dijit-gridlayout");setTimeout(l.hitch(this,this.resize),100)}))}},_hideComponent:function(a){a.parent&&a.parent.removeChild(a,!0)},_showComponent:function(a){var g,b;m.some(this.components,function(k){if(k.id===a)return g=k,!0},this);if(g){var h={id:a,type:"component",componentName:"jimu grid",componentState:{id:a}};
var c=this._coordinates[a];var d=this._layout.root;if(c){if(c[0].type!==d.contentItems[0].type){var e=d.contentItems[0];d.replaceChild(e,{type:c[0].type,content:[]});d.contentItems[0].addChild(e)}var f=d;m.forEach(c,function(k){b=k.index<=f.contentItems.length?k.index:f.contentItems.length;"component"===k.type?f.addChild(h,b):("stack"!==k.type&&f.contentItems[k.index].type===k.type||f.addChild({type:k.type,content:[]},b),f=f.contentItems[b])},this)}else"stack"===d.contentItems[0].type&&(e=d.contentItems[0],
d.replaceChild(e,{type:"column",content:[]}),d.contentItems[0].addChild(e)),d.contentItems[0].addChild(h)}},_resetCoordinate:function(){var a=this._layout.root.getItemsByType("component"),g=function(b,h){var c=b.parent;c&&(m.some(c.contentItems,function(d,e){if(d===b)return h.push({type:d.type,index:e}),!0}),g(c,h))};m.forEach(a,function(b){var h=[];g(b,h);this._coordinates[b.config.id]=h.reverse()},this)}})});