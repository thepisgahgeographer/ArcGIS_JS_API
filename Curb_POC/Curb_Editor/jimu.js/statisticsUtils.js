// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/_base/array dojo/when esri/tasks/StatisticDefinition esri/tasks/QueryTask esri/tasks/query esri/lang jimu/utils jimu/LayerInfos/LayerInfos exports".split(" "),function(u,l,v,w,x,y,n,z,k){function A(a){var b=new x;b.outFields=[a.fieldName];b.outStatistics=[];b.geometry=a.geometry;var d=p(a);u.forEach(d,function(c){var e=new v;e.statisticType=c;e.displayFeildName=a.fieldName;e.onStatisticField=a.fieldName;e.outStatisticFieldName=B[c];b.outStatistics.push(e)});b.where=a.filterExpression?
a.filterExpression:a.layer.getDefinitionExpression()?a.layer.getDefinitionExpression():"1\x3d1";a.geometry&&(b.geometry=a.geometry);return(new w(a.layer.url)).execute(b).then(function(c){return c&&c.features&&0<c.features.length?(c=c.features[0].attributes,q(a,c),c):[]})}function m(a){var b={countField:0,sumField:0},d=p(a),c=0,e=0;a.featureSet.features.forEach(function(f){var g=f.attributes[a.fieldName];null!==g&&"undefined"!==typeof g&&d.forEach(function(C){switch(C){case "count":b.countField++;
break;case "sum":b.sumField+=g;break;case "min":b.minField="undefined"===typeof b.minField?g:Math.min(b.minField,g);break;case "max":b.maxField="undefined"===typeof b.maxField?g:Math.max(b.maxField,g);break;case "avg":c++,e+=g}})});b.avgField=0===c?0:0===c?"":e/c;var h=a.featureSet.features.filter(function(f){f=f.attributes[a.fieldName];return null===f||"undefined"===typeof f?!1:!0}).map(function(f){return f.attributes[a.fieldName]});b.stddevField=r(h);q(a,b);return b}function p(a){return a.statisticTypes&&
0<a.statisticTypes.length?t.filter(function(b){return-1<a.statisticTypes.indexOf(b)}):t}function r(a){var b=a.length;if(1>=b)return 0;var d=0;a.forEach(function(h){d+=h});var c=d/b,e=0;a.forEach(function(h){e+=Math.pow(h-c,2)});return Math.sqrt(1/(b-1)*e)}function D(a){var b=z.getInstanceSync();return a.layer?b.getLayerOrTableInfoById(a.layer.id).loadInfoTemplate().then(function(d){var c={};d.info&&d.info.fieldInfos&&d.info.fieldInfos.forEach(function(e){c[e.fieldName]=e});return c}):l({})}function q(a,
b){if(a.fieldInfos&&a.fieldInfos[a.fieldName])for(var d in b)"countField"!==d&&y.isDefined(b[d])&&(b[d]=null===b[d]||"undefined"===typeof b[d]?"":n.localizeNumberByFieldInfo(b[d],a.fieldInfos[a.fieldName]))}var t="count sum min max avg stddev".split(" "),B={count:"countField",sum:"sumField",min:"minField",max:"maxField",avg:"avgField",stddev:"stddevField"};k.getStatisticsResult=function(a){return D(a).then(function(b){a.fieldInfos=b;if(a.featureSet)return l(m(a));if(a.layer){if(a.layer.url)return A(a);
a.featureSet=n.toFeatureSet(a.layer.graphics);return l(m(a))}})};k.isStatFromServer=function(a){return a.layer&&a.layer.url};k.getStddevVal=r;k.getStatisticsResultFromClientSync=m});