// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/keys dojo/aspect dojo/topic jimu/BaseWidgetPanel jimu/BaseWidgetFrame jimu/utils dojo/query dojo/dom-class ./FoldableDijit ./FoldableWidgetFrame dijit/registry".split(" "),function(p,f,c,n,m,g,q,e,r,t,u,d,k,v,w,x){return p([r,v],{baseClass:"jimu-panel jimu-foldable-dijit jimu-foldable-panel",closeTolerance:30,openAnimation:"fadeIn",closeAnimation:"fadeOut",animationDuration:500,postMixInProperties:function(){this.headerNls=
window.jimuNls.panelHeader},startup:function(){this.titleHeight=35;this.inherited(arguments);this._switchParentNode();c.addClass(this.titleNode,"jimu-panel-title");this.createFoldableBtn();this.createMaxBtn();this.createCloseBtn();this.panelManager.normalizePanel(this);this.own(m(this.domNode,"keydown",f.hitch(this,function(a){c.hasClass(a.target,"close-btn")||a.keyCode!==g.ESCAPE||this.closeNode.focus()})))},getPanelPosition:function(){if(window.appInfo.isRunInMobile){if(0===this.panelManager.getPositionOnMobile(this).top){var a=
this.panelManager.getPositionOnMobile(this);a.top="39px"}else a=this.panelManager.getPositionOnMobile(this);return a}a=f.clone(this.position);"undefined"===typeof a.width&&(a.width=360);"minimized"===this.windowState?(a.bottom="auto",a.height=this.titleHeight,a.borderRadiusStyle={borderTopLeftRadius:"0px",borderTopRightRadius:"0px",borderBottomLeftRadius:0,borderBottomRightRadius:0}):(a.bottom=this.position.bottom,a.height="auto",a.borderRadiusStyle={borderTopLeftRadius:"0px",borderTopRightRadius:"0px",
borderBottomLeftRadius:"0px",borderBottomRightRadius:"0px"});return a},onNormalize:function(){this.resize();k.contains(this.foldableNode,"folded")&&k.remove(this.foldableNode,"folded")},onMaximize:function(){this.resize();k.contains(this.foldableNode,"folded")&&k.remove(this.foldableNode,"folded")},onMinimize:function(){this.resize();k.contains(this.foldableNode,"folded")||k.add(this.foldableNode,"folded")},resize:function(){this._switchMaxBtn();var a=this.getPanelPosition();"maximized"===this.windowState&&
window.appInfo.isRunInMobile&&(a.top="39px");this._setMapCanvasArea(a.top);window.appInfo.isRunInMobile||(a.top="39px",a.right="0",a.bottom="0");this.position.zIndex&&(a.zIndex=this.position.zIndex);var b=u.getPositionStyle(a);b.width=window.appInfo.isRunInMobile?760>=window.innerWidth||600>=window.innerHeight?"maximized"===this.windowState?"100%":760>=window.innerWidth?"100%":"360px":"360px":"360px";b.left=window.isRTL?"0px":"auto";b.right="0px"===b.left?"auto":b.right;f.mixin(b,a.borderRadiusStyle);
b.margin="none";b.marginLeft="0";b.marginRight="0";b.marginBottom="0";b.marginTop="0";c.setStyle(this.domNode,b);1<this.getChildren().length&&this._setFrameSize(a.contentHeight);this.inherited(arguments)},reloadWidget:function(a){this.inherited(arguments);this.isWidgetInPanel(a)&&(Array.isArray(this.config.widgets)||this.setTitleLabel(a.label))},_setMapCanvasArea:function(a){if(window.appInfo.isRunInMobile){var b=0;d(".jimu-widget-attributetable")[0]&&(b=d(".jimu-widget-attributetable")[0].clientHeight);
"minimized"===this.windowState?0<b&&35<b?e.publish("changeMapPosition",{bottom:b}):window.hasOwnProperty("ontouchstart")||void 0!==window.ontouchstart||760>=window.innerWidth?e.publish("changeMapPosition",{bottom:"35px"}):e.publish("changeMapPosition",{bottom:"0px"}):"maximized"===this.windowState?e.publish("changeMapPosition",{bottom:"0px"}):0<b&&b>a?e.publish("changeMapPosition",{bottom:b}):window.hasOwnProperty("ontouchstart")||void 0!==window.ontouchstart||760>=window.innerWidth?e.publish("changeMapPosition",
{bottom:a}):e.publish("changeMapPosition",{bottom:"0px"})}else window.appInfo.isRunInMobile||("minimized"===this.windowState?e.publish("changeMapPosition",{right:"0px"}):(e.publish("changeMapPosition",{right:"360px"}),this._resizeAttributeTableinRTL()))},_resizeAttributeTableinRTL:function(){d(".jimu-widget-attributetable")[0]&&(window.isRTL?c.setStyle(d(".jimu-widget-attributetable")[0],"right","0px"):c.setStyle(d(".jimu-widget-attributetable")[0],"left","0px"),d(".dijitTabContainer",d(".jimu-widget-attributetable")[0])[0]&&
x.byId(d(".dijitTabContainer",d(".jimu-widget-attributetable")[0])[0].id).resize())},updateConfig:function(a){this.inherited(arguments);this.setTitleLabel(a.label)},_switchMaxBtn:function(){window.appInfo.isRunInMobile&&(760>=window.innerWidth||600>=window.innerHeight)?c.setStyle(this.maxNode,"display",""):c.setStyle(this.maxNode,"display","none")},_switchParentNode:function(){c.place(this.domNode,jimuConfig.layoutId)},_setFrameSize:function(a){var b=0;n.forEach(this.getChildren(),function(h){h.folded||
b++},this);"undefined"===typeof a&&(a=c.getContentBox(this.containerNode).h);var l=(a-(this.getChildren().length-b)*this.getChildren()[0].titleHeight)/b;n.forEach(this.getChildren(),function(h){h.folded?c.setStyle(h.domNode,{height:h.titleHeight+"px"}):c.setStyle(h.domNode,{height:l+"px"});h.resize()},this)},createCloseBtn:function(){this.closeNode=c.create("div",{"class":"close-btn jimu-float-trailing",role:"button",tabindex:"0","aria-label":this.headerNls.closeWindow},this.btnsContainer);this.own(m(this.closeNode,
"click",f.hitch(this,function(a){a.stopPropagation();d(".widget-open-symbol").addClass("esriCTHidden");this.panelManager.closePanel(this)})));this.own(m(this.closeNode,"keydown",f.hitch(this,function(a){a.keyCode===g.ENTER||a.keyCode===g.SPACE?this.panelManager.closePanel(this):!a.shiftKey&&a.keyCode===g.TAB&&this.isGroupPanel&&(a.preventDefault(),this.firstTitleNode.focus())})))},createMaxBtn:function(){this.maxNode=c.create("div",{"class":"max-btn jimu-float-trailing",role:"button","aria-label":this.headerNls.maxWindow,
tabindex:0},this.btnsContainer);this.own(m(this.maxNode,"click",f.hitch(this,function(a){a.stopPropagation();c.removeClass(this.titleNode,"esriCTBorderBottom");this.onMaxNodeClick()})));this.own(m(this.maxNode,"keydown",f.hitch(this,function(a){if(a.keyCode===g.ENTER||a.keyCode===g.SPACE)a.stopPropagation(),this.onMaxNodeClick();a.keyCode===g.ESCAPE&&(a.stopPropagation(),(a=d(".jimu-state-selected")[0])&&a.focus())})))},createFrame:function(a){this.config.widgets&&1===this.config.widgets.length||
!this.config.widgets?a=new t:(a=new w({label:a.label,widgetManager:this.widgetManager}),q.after(a,"onFoldStateChanged",f.hitch(this,function(){var b=0;this._setFrameSize();n.forEach(this.getChildren(),function(l){l.folded||b++},this);n.forEach(this.getChildren(),function(l){l.foldEnable=l.folded||1!==b?!0:!1},this)})));return a},onFoldableNodeClick:function(){this.inherited(arguments);"minimized"===this.windowState?(c.removeClass(this.titleNode,"esriCTBorderBottom"),this.panelManager.normalizePanel(this)):
this.panelManager.minimizePanel(this);c.setAttr(this.maxNode,"aria-label",this.headerNls.maxWindow)},onMaxNodeClick:function(){c.removeClass(this.titleNode,"esriCTBorderBottom");"maximized"===this.windowState?(c.setAttr(this.maxNode,"aria-label",this.headerNls.maxWindow),this.panelManager.normalizePanel(this)):(c.setAttr(this.maxNode,"aria-label",this.headerNls.restoreWindow),this.panelManager.maximizePanel(this),this.folded=!1,c.removeClass(this.foldableNode,"folded"),c.setAttr(this.foldableNode,
"aria-label",this.headerNls.foldWindow))},moveTitle:function(){this.isFull?this.folded?c.setStyle(this.domNode,{top:c.getMarginBox(jimuConfig.layoutId).h-this.titleHeight+"px"}):c.setStyle(this.domNode,{top:"0px"}):c.setStyle(this.domNode,{top:this.position.top+"px"})}})});