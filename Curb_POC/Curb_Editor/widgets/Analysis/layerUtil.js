// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/_base/lang dojo/_base/array dojo/promise/all dojo/Deferred esri/layers/FeatureLayer esri/layers/GeoRSSLayer esri/layers/WFSLayer jimu/LayerInfos/LayerInfos".split(" "),function(n,h,p,q,m,t,u,r){var l={getLayerObjects:function(){var b=new q,c=[];r.getInstanceSync().traversal(function(d){c.push(d)});var e=h.map(c,function(d){var f;return d.getItemInfo().then(function(a){a&&(f=a.getItem())}).then(function(){return d.getLayerType()}).then(function(a){"GeoRSSLayer"===a&&(d.isLeaf()||h.forEach(d.getSubLayers(),
function(k){k.layerObject.name||(k.layerObject.name=k.title)}));return d.getLayerObjectTryUsingFeatureService()}).then(function(a){if(a)return a.itemInfo=f,a})});p(e).then(function(d){var f=[];h.forEach(d,function(a,k){if(a&&a.geometryType)if(a instanceof m&&"esri.layers.StreamLayer"!==a.declaredClass||a instanceof t)a.id=a.id||c[k].id,f.push(a);else if(a instanceof u){var g=l.createFeatureCollectionJsonFromWFS(a);g=new m(g,{mode:m.MODE_SNAPSHOT,outFields:["*"]});g.id=a.id||c[k].id;g.title=a._layerName;
g.name=a._layerName;g.capabilities?-1===g.capabilities.indexOf("Extract")&&(g.capabilities+=",Extract"):g.capabilities="Extract";f.push(g)}});b.resolve(f)},function(){b.resolve([])});return b},getTableInfos:function(){var b=r.getInstanceSync();b=[].concat(b.getTableInfoArray(),b.getLayerInfoArray());return h.filter(b,function(c){return!0===c.isTable})},getTableLayerObjects:function(){var b=new q,c=l.getTableInfos();c=h.map(c,function(e){return e.getLayerObject()});p(c).then(function(e){e=h.filter(e,
function(d){return null!==d});b.resolve(e)});return b},getMainGeometryType:function(b){var c=0,e=0,d=0;h.forEach(b.graphics,function(f){"point"===f.geometry.type?c++:"polyline"===f.geometry.type?e++:"polygon"===f.geometry.type&&d++});return c>e&&c>d?"esriGeometryPoint":e>c&&e>d?"esriGeometryPolyline":"esriGeometryPolygon"},createFeatureCollectionJsonFromWFS:function(b){var c=l.getMainGeometryType(b),e={layerDefinition:null,featureSet:{features:[],geometryType:c}};e.layerDefinition={geometryType:c,
objectIdField:"__OBJECTID",type:"Feature Layer",typeIdField:"",drawingInfo:{renderer:{type:"simple",symbol:("esriGeometryPoint"===c?b._pointSymbol:"esriGeometryPolyline"===c?b._lineSymbol:b._polygonSymbol).toJson()},fixedSymbols:!0},fields:[{name:"__OBJECTID",alias:"__OBJECTID",type:"esriFieldTypeOID"}],types:[],capabilities:"Query"};h.forEach(b.fields,function(f){-1<h.indexOf(["esriFieldTypeInteger","esriFieldTypeDouble","esriFieldTypeDate","esriFieldTypeString"],f.type)&&e.layerDefinition.fields.push(n.clone(f))});
var d=[];h.forEach(b.graphics,function(f,a){var k=n.clone(f.attributes);k.__OBJECTID=a;d.push({geometry:f.geometry.toJson(),attributes:k})});e.featureSet.features=d;return e}};return l});