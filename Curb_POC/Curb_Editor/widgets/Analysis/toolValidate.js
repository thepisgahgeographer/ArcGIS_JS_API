// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define(["dojo/_base/lang","dojo/_base/array","./layerUtil"],function(g,f,k){return{isValid:function(a,b,e){var d=!1;-1!==b.dijitID.indexOf("MergeLayers")?d=this.mergeAvailable(a):-1!==b.dijitID.indexOf("ExtractData")?d=this.extractAvailable(a,e):-1!==b.dijitID.indexOf("GeocodeLocationsFromTable")?d=this.geocodeLocationsFromTable():(e=null,"requiredParam"in b&&(e=b.requiredParam),d=this.paramAvailable(a,b.analysisLayer,e));return d},geocodeLocationsFromTable:function(){var a=k.getTableInfos();return g.isArray(a)&&
0<a.length},mergeAvailable:function(a){return f.some(a,function(b){return f.some(a,function(e){return e!==b&&e.geometryType===b.geometryType})})},extractAvailable:function(a,b){var e=b.getUser(),d=b.isPortal();f.forEach(a,function(c){var l="esri.layers.GeoRSSLayer"===c.declaredClass,m="esri.layers.CSVLayer"===c.declaredClass,h="esri.layers.FeatureLayer"===c.declaredClass,n="esri.layers.WFSLayer"===c.declaredClass;h&&!c.url||l||m||n?this._addExtractCapability(c):h&&(b.isAdmin()&&(d&&c.itemInfo&&c.itemInfo.itemControl&&
"admin"===c.itemInfo.itemControl||!d&&c.url&&-1<c.url.indexOf("/"+e.orgId+"/"))?this._addExtractCapability(c):e&&c.itemInfo&&c.itemInfo.owner&&c.itemInfo.owner===e.username&&(!d&&c.url&&-1<c.url.indexOf("/"+e.orgId+"/")||d)&&this._addExtractCapability(c))},this);return f.some(a,function(c){return c.capabilities&&0<=c.capabilities.indexOf("Extract")})},_addExtractCapability:function(a){a.capabilities?-1===a.capabilities.indexOf("Extract")&&(a.capabilities+=",Extract"):a.capabilities="Extract";return!0},
paramAvailable:function(a,b,e){var d=!1;var c=b.geomTypes;b=this.findMatchedFeatureLayers(a,c);0<b.length&&(e?(c=e.geomTypes,a=this.findMatchedFeatureLayers(a,c),0<a.length&&(b.length!==a.length?d=!0:1<b.length?d=!0:b[0]!==a[0]&&(d=!0))):d=!0);return d},findMatchedFeatureLayers:function(a,b){var e=[];f.forEach(a,g.hitch(this,function(d){d&&(1===b.length?("*"===b[0]||b[0]===d.geometryType)&&e.push(d.id):-1<b.indexOf(d.geometryType)&&e.push(d.id))}));return e}}});