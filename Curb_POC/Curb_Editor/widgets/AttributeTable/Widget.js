// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"dijit/layout/TabContainer":function(){define(["dojo/_base/lang","dojo/_base/declare","./_TabContainerBase","./TabController","./ScrollingTabController"],function(J,m,H,M,D){return m("dijit.layout.TabContainer",H,{useMenu:!0,useSlider:!0,controllerWidget:"",_makeController:function(C){var B=this.baseClass+"-tabs"+(this.doLayout?"":" dijitTabNoLayout");return new ("string"==typeof this.controllerWidget?J.getObject(this.controllerWidget):this.controllerWidget)({id:this.id+"_tablist",
ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir,tabPosition:this.tabPosition,doLayout:this.doLayout,containerId:this.id,"class":B,nested:this.nested,useMenu:this.useMenu,useSlider:this.useSlider,tabStripClass:this.tabStrip?this.baseClass+(this.tabStrip?"":"No")+"Strip":null},C)},postMixInProperties:function(){this.inherited(arguments);this.controllerWidget||(this.controllerWidget="top"!=this.tabPosition&&"bottom"!=this.tabPosition||this.nested?M:D)}})})},"dijit/layout/_TabContainerBase":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style ./StackContainer ./utils ../_TemplatedMixin dojo/text!./templates/TabContainer.html".split(" "),
function(J,m,H,M,D,C,B,F){return J("dijit.layout._TabContainerBase",[D,B],{tabPosition:"top",baseClass:"dijitTabContainer",tabStrip:!1,nested:!1,templateString:F,postMixInProperties:function(){this.baseClass+=this.tabPosition.charAt(0).toUpperCase()+this.tabPosition.substr(1).replace(/-.*/,"");this.srcNodeRef&&M.set(this.srcNodeRef,"visibility","hidden");this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.tablist=this._makeController(this.tablistNode);this.doLayout||
m.add(this.domNode,"dijitTabContainerNoLayout");this.nested?(m.add(this.domNode,"dijitTabContainerNested"),m.add(this.tablist.containerNode,"dijitTabContainerTabListNested"),m.add(this.tablistSpacer,"dijitTabContainerSpacerNested"),m.add(this.containerNode,"dijitTabPaneWrapperNested")):m.add(this.domNode,"tabStrip-"+(this.tabStrip?"enabled":"disabled"))},_setupChild:function(K){m.add(K.domNode,"dijitTabPane");this.inherited(arguments)},removeChild:function(K){m.remove(K.domNode,"dijitTabPane");this.inherited(arguments)},
startup:function(){this._started||(this.tablist.startup(),this.inherited(arguments))},layout:function(){if(this._contentBox&&"undefined"!=typeof this._contentBox.l){var K=this.selectedChildWidget;if(this.doLayout){var L=this.tabPosition.replace(/-h/,"");this.tablist.region=L;L=[this.tablist,{domNode:this.tablistSpacer,region:L},{domNode:this.containerNode,region:"center"}];C.layoutChildren(this.domNode,this._contentBox,L);this._containerContentBox=C.marginBox2contentBox(this.containerNode,L[2]);K&&
K.resize&&K.resize(this._containerContentBox)}else{if(this.tablist.resize){L=this.tablist.domNode.style;L.width="0";var T=H.getContentBox(this.domNode).w;L.width="";this.tablist.resize({w:T})}K&&K.resize&&K.resize()}}},destroy:function(K){this.tablist&&this.tablist.destroy(K);this.inherited(arguments)}})})},"dijit/layout/StackContainer":function(){define("dojo/_base/array dojo/cookie dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/has dojo/_base/lang dojo/on dojo/ready dojo/topic dojo/when ../registry ../_WidgetBase ./_LayoutWidget".split(" "),
function(J,m,H,M,D,C,B,F,K,L,T,h,e,n){C("dijit-legacy-requires")&&K(0,function(){require(["dijit/layout/StackController"])});H=H("dijit.layout.StackContainer",n,{doLayout:!0,persist:!1,baseClass:"dijitStackContainer",buildRendering:function(){this.inherited(arguments);M.add(this.domNode,"dijitLayoutContainer")},postCreate:function(){this.inherited(arguments);this.own(F(this.domNode,"keydown",B.hitch(this,"_onKeyDown")))},startup:function(){if(!this._started){var c=this.getChildren();J.forEach(c,this._setupChild,
this);this.persist?this.selectedChildWidget=h.byId(m(this.id+"_selectedChild")):J.some(c,function(a){a.selected&&(this.selectedChildWidget=a);return a.selected},this);var k=this.selectedChildWidget;!k&&c[0]&&(k=this.selectedChildWidget=c[0],k.selected=!0);L.publish(this.id+"-startup",{children:c,selected:k,textDir:this.textDir});this.inherited(arguments)}},resize:function(){if(!this._hasBeenShown){this._hasBeenShown=!0;var c=this.selectedChildWidget;c&&this._showChild(c)}this.inherited(arguments)},
_setupChild:function(c){var k=c.domNode,a=D.place("\x3cdiv role\x3d'tabpanel' class\x3d'"+this.baseClass+"ChildWrapper dijitHidden'\x3e",c.domNode,"replace"),f=c["aria-label"]||c.title||c.label;f&&a.setAttribute("aria-label",f);D.place(k,a);c._wrapper=a;this.inherited(arguments);"none"==k.style.display&&(k.style.display="block");c.domNode.removeAttribute("title")},addChild:function(c,k){this.inherited(arguments);this._started&&(L.publish(this.id+"-addChild",c,k),this.layout(),this.selectedChildWidget||
this.selectChild(c))},removeChild:function(c){var k=J.indexOf(this.getChildren(),c);this.inherited(arguments);D.destroy(c._wrapper);delete c._wrapper;this._started&&L.publish(this.id+"-removeChild",c);if(!this._descendantsBeingDestroyed){if(this.selectedChildWidget===c&&(this.selectedChildWidget=void 0,this._started)){var a=this.getChildren();a.length&&this.selectChild(a[Math.max(k-1,0)])}this._started&&this.layout()}},selectChild:function(c,k){c=h.byId(c);if(this.selectedChildWidget!=c){var a=this._transition(c,
this.selectedChildWidget,k);this._set("selectedChildWidget",c);L.publish(this.id+"-selectChild",c,this._focused);this.persist&&m(this.id+"_selectedChild",this.selectedChildWidget.id)}return T(a||!0)},_transition:function(c,k){k&&this._hideChild(k);k=this._showChild(c);c.resize&&(this.doLayout?c.resize(this._containerContentBox||this._contentBox):c.resize());return k},_adjacent:function(c){var k=this.getChildren(),a=J.indexOf(k,this.selectedChildWidget);a+=c?1:k.length-1;return k[a%k.length]},forward:function(){return this.selectChild(this._adjacent(!0),
!0)},back:function(){return this.selectChild(this._adjacent(!1),!0)},_onKeyDown:function(c){L.publish(this.id+"-containerKeyDown",{e:c,page:this})},layout:function(){var c=this.selectedChildWidget;c&&c.resize&&(this.doLayout?c.resize(this._containerContentBox||this._contentBox):c.resize())},_showChild:function(c){var k=this.getChildren();c.isFirstChild=c==k[0];c.isLastChild=c==k[k.length-1];c._set("selected",!0);c._wrapper&&M.replace(c._wrapper,"dijitVisible","dijitHidden");return c._onShow&&c._onShow()||
!0},_hideChild:function(c){c._set("selected",!1);c._wrapper&&M.replace(c._wrapper,"dijitHidden","dijitVisible");c.onHide&&c.onHide()},closeChild:function(c){if(!c.onClose||c.onClose(this,c))this.removeChild(c),c.destroyRecursive()},destroyDescendants:function(c){this._descendantsBeingDestroyed=!0;this.selectedChildWidget=void 0;J.forEach(this.getChildren(),function(k){c||this.removeChild(k);k.destroyRecursive(c)},this);this._descendantsBeingDestroyed=!1}});H.ChildWidgetProperties={selected:!1,disabled:!1,
closable:!1,iconClass:"dijitNoIcon",showTitle:!0};B.extend(e,H.ChildWidgetProperties);return H})},"dijit/layout/TabController":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/has dojo/i18n dojo/_base/lang ./StackController ../registry ../Menu ../MenuItem dojo/text!./templates/_TabButton.html dojo/i18n!../nls/common".split(" "),function(J,m,H,M,D,C,B,F,K,L,T,h){h=J("dijit.layout._TabButton"+(D("dojo-bidi")?"_NoBidi":""),F.StackButton,{baseClass:"dijitTab",cssStateNodes:{closeNode:"dijitTabCloseButton"},
templateString:h,_setNameAttr:"focusNode",scrollOnFocus:!1,buildRendering:function(){this.inherited(arguments);m.setSelectable(this.containerNode,!1)},startup:function(){this.inherited(arguments);var e=this.domNode;this.defer(function(){e.className=e.className},1)},_setCloseButtonAttr:function(e){this._set("closeButton",e);M.toggle(this.domNode,"dijitClosable",e);this.closeNode.style.display=e?"":"none";e&&(e=C.getLocalization("dijit","common"),this.closeNode&&H.set(this.closeNode,"title",e.itemClose))},
_setDisabledAttr:function(e){this.inherited(arguments);if(this.closeNode)if(e)H.remove(this.closeNode,"title");else{var n=C.getLocalization("dijit","common");H.set(this.closeNode,"title",n.itemClose)}},_setLabelAttr:function(e){this.inherited(arguments);this.showLabel||this.params.title||(this.iconNode.alt=B.trim(this.containerNode.innerText||this.containerNode.textContent||""))}});D("dojo-bidi")&&(h=J("dijit.layout._TabButton",h,{_setLabelAttr:function(e){this.inherited(arguments);this.applyTextDir(this.iconNode,
this.iconNode.alt)}}));J=J("dijit.layout.TabController",F,{baseClass:"dijitTabController",templateString:"\x3cdiv role\x3d'tablist' data-dojo-attach-event\x3d'onkeydown:onkeydown'\x3e\x3c/div\x3e",tabPosition:"top",buttonWidget:h,buttonWidgetCloseClass:"dijitTabCloseButton",postCreate:function(){this.inherited(arguments);var e=new L({id:this.id+"_Menu",ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir,targetNodeIds:[this.domNode],selector:function(k){return M.contains(k,
"dijitClosable")&&!M.contains(k,"dijitTabDisabled")}});this.own(e);var n=C.getLocalization("dijit","common"),c=this;e.addChild(new T({label:n.itemClose,ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir,onClick:function(k){k=K.byNode(this.getParent().currentTarget);c.onCloseButtonClick(k.page)}}))}});J.TabButton=h;return J})},"dijit/layout/StackController":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/keys dojo/_base/lang dojo/on dojo/topic ../focus ../registry ../_Widget ../_TemplatedMixin ../_Container ../form/ToggleButton dojo/touch".split(" "),
function(J,m,H,M,D,C,B,F,K,L,T,h,e,n){M=m("dijit.layout._StackButton",n,{tabIndex:"-1",closeButton:!1,_aria_attr:"aria-selected",buildRendering:function(c){this.inherited(arguments);(this.focusNode||this.domNode).setAttribute("role","tab")}});m=m("dijit.layout.StackController",[T,h,e],{baseClass:"dijitStackController",templateString:"\x3cspan role\x3d'tablist' data-dojo-attach-event\x3d'onkeydown'\x3e\x3c/span\x3e",containerId:"",buttonWidget:M,buttonWidgetCloseClass:"dijitStackCloseButton",pane2button:function(c){return L.byId(this.id+
"_"+c)},postCreate:function(){this.inherited(arguments);this.own(F.subscribe(this.containerId+"-startup",C.hitch(this,"onStartup")),F.subscribe(this.containerId+"-addChild",C.hitch(this,"onAddChild")),F.subscribe(this.containerId+"-removeChild",C.hitch(this,"onRemoveChild")),F.subscribe(this.containerId+"-selectChild",C.hitch(this,"onSelectChild")),F.subscribe(this.containerId+"-containerKeyDown",C.hitch(this,"onContainerKeyDown")));this.containerNode.dojoClick=!0;this.own(B(this.containerNode,"click",
C.hitch(this,function(c){var k=L.getEnclosingWidget(c.target);if(k!=this.containerNode&&!k.disabled&&k.page)for(c=c.target;c!==this.containerNode;c=c.parentNode)if(H.contains(c,this.buttonWidgetCloseClass)){this.onCloseButtonClick(k.page);break}else if(c==k.domNode){this.onButtonClick(k.page);break}})))},onStartup:function(c){this.textDir=c.textDir;J.forEach(c.children,this.onAddChild,this);if(c.selected)this.onSelectChild(c.selected);var k=L.byId(this.containerId).containerNode,a=C.hitch(this,"pane2button");
c={title:"label",showtitle:"showLabel",iconclass:"iconClass",closable:"closeButton",tooltip:"title",disabled:"disabled",textdir:"textdir"};var f=function(u,p){return B(k,"attrmodified-"+u,function(x){var E=a(x.detail&&x.detail.widget&&x.detail.widget.id);E&&E.set(p,x.detail.newValue)})},q;for(q in c)this.own(f(q,c[q]))},destroy:function(c){this.destroyDescendants(c);this.inherited(arguments)},onAddChild:function(c,k){var a=new (C.isString(this.buttonWidget)?C.getObject(this.buttonWidget):this.buttonWidget)({id:this.id+
"_"+c.id,name:this.id+"_"+c.id,label:c.title,disabled:c.disabled,ownerDocument:this.ownerDocument,dir:c.dir,lang:c.lang,textDir:c.textDir||this.textDir,showLabel:c.showTitle,iconClass:c.iconClass,closeButton:c.closable,title:c.tooltip,page:c});this.addChild(a,k);c.controlButton=a;if(!this._currentChild)this.onSelectChild(c);k=c._wrapper.getAttribute("aria-labelledby")?c._wrapper.getAttribute("aria-labelledby")+" "+a.id:a.id;c._wrapper.removeAttribute("aria-label");c._wrapper.setAttribute("aria-labelledby",
k)},onRemoveChild:function(c){this._currentChild===c&&(this._currentChild=null);var k=this.pane2button(c.id);k&&(this.removeChild(k),k.destroy());delete c.controlButton},onSelectChild:function(c){if(c){if(this._currentChild){var k=this.pane2button(this._currentChild.id);k.set("checked",!1);k.focusNode.setAttribute("tabIndex","-1")}k=this.pane2button(c.id);k.set("checked",!0);this._currentChild=c;k.focusNode.setAttribute("tabIndex","0");L.byId(this.containerId)}},onButtonClick:function(c){var k=this.pane2button(c.id);
K.focus(k.focusNode);this._currentChild&&this._currentChild.id===c.id&&k.set("checked",!0);L.byId(this.containerId).selectChild(c)},onCloseButtonClick:function(c){L.byId(this.containerId).closeChild(c);this._currentChild&&(c=this.pane2button(this._currentChild.id))&&K.focus(c.focusNode||c.domNode)},adjacent:function(c){this.isLeftToRight()||this.tabPosition&&!/top|bottom/.test(this.tabPosition)||(c=!c);var k=this.getChildren(),a=J.indexOf(k,this.pane2button(this._currentChild.id)),f=k[a];do{a=(a+
(c?1:k.length-1))%k.length;var q=k[a]}while(q.disabled&&q!=f);return q},onkeydown:function(c,k){if(!this.disabled&&!c.altKey&&(k=null,c.ctrlKey||!c._djpage)){switch(c.keyCode){case D.LEFT_ARROW:case D.UP_ARROW:c._djpage||(k=!1);break;case D.PAGE_UP:c.ctrlKey&&(k=!1);break;case D.RIGHT_ARROW:case D.DOWN_ARROW:c._djpage||(k=!0);break;case D.PAGE_DOWN:c.ctrlKey&&(k=!0);break;case D.HOME:for(var a=this.getChildren(),f=0;f<a.length;f++){var q=a[f];if(!q.disabled){this.onButtonClick(q.page);break}}c.stopPropagation();
c.preventDefault();break;case D.END:a=this.getChildren();for(f=a.length-1;0<=f;f--)if(q=a[f],!q.disabled){this.onButtonClick(q.page);break}c.stopPropagation();c.preventDefault();break;case D.DELETE:case 87:this._currentChild.closable&&(c.keyCode==D.DELETE||c.ctrlKey)&&(this.onCloseButtonClick(this._currentChild),c.stopPropagation(),c.preventDefault());break;case D.TAB:c.ctrlKey&&(this.onButtonClick(this.adjacent(!c.shiftKey).page),c.stopPropagation(),c.preventDefault())}null!==k&&(this.onButtonClick(this.adjacent(k).page),
c.stopPropagation(),c.preventDefault())}},onContainerKeyDown:function(c){c.e._djpage=c.page;this.onkeydown(c.e)}});m.StackButton=M;return m})},"dijit/layout/ScrollingTabController":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/fx dojo/_base/lang dojo/on dojo/query dojo/sniff ../registry dojo/text!./templates/ScrollingTabController.html dojo/text!./templates/_ScrollingTabControllerButton.html ./TabController ./utils ../_WidgetsInTemplateMixin ../Menu ../MenuItem ../form/Button ../_HasDropDown dojo/NodeList-dom ../a11yclick".split(" "),
function(J,m,H,M,D,C,B,F,K,L,T,h,e,n,c,k,a,f,q,u){h=m("dijit.layout.ScrollingTabController",[n,k],{baseClass:"dijitTabController dijitScrollingTabController",templateString:h,useMenu:!0,useSlider:!0,tabStripClass:"",_minScroll:5,_setClassAttr:{node:"containerNode",type:"class"},buildRendering:function(){this.inherited(arguments);var p=this.domNode;this.scrollNode=this.tablistWrapper;this._initButtons();this.tabStripClass||(this.tabStripClass="dijitTabContainer"+this.tabPosition.charAt(0).toUpperCase()+
this.tabPosition.substr(1).replace(/-.*/,"")+"None",H.add(p,"tabStrip-disabled"));H.add(this.tablistWrapper,this.tabStripClass)},onStartup:function(){this.inherited(arguments);D.set(this.domNode,"visibility","");this._postStartup=!0;this.own(F(this.containerNode,"attrmodified-label, attrmodified-iconclass",B.hitch(this,function(p){this._dim&&this.resize(this._dim)})))},onAddChild:function(p,x){this.inherited(arguments);D.set(this.containerNode,"width",D.get(this.containerNode,"width")+200+"px")},
onRemoveChild:function(p,x){var E=this.pane2button(p.id);this._selectedTab===E.domNode&&(this._selectedTab=null);this.inherited(arguments)},_initButtons:function(){this._btnWidth=0;this._buttons=K("\x3e .tabStripButton",this.domNode).filter(function(p){if(this.useMenu&&p==this._menuBtn.domNode||this.useSlider&&(p==this._rightBtn.domNode||p==this._leftBtn.domNode))return this._btnWidth+=M.getMarginSize(p).w,!0;D.set(p,"display","none");return!1},this)},_getTabsWidth:function(){var p=this.getChildren();
if(p.length){var x=p[this.isLeftToRight()?0:p.length-1].domNode;p=p[this.isLeftToRight()?p.length-1:0].domNode;return p.offsetLeft+p.offsetWidth-x.offsetLeft}return 0},_enableBtn:function(p){var x=this._getTabsWidth();p=p||D.get(this.scrollNode,"width");return 0<x&&p<x},resize:function(p){this._dim=p;this.scrollNode.style.height="auto";var x=this._contentBox=c.marginBox2contentBox(this.domNode,{h:0,w:p.w});x.h=this.scrollNode.offsetHeight;M.setContentSize(this.domNode,x);x=this._enableBtn(this._contentBox.w);
this._buttons.style("display",x?"":"none");this._leftBtn.region="left";this._rightBtn.region="right";this._menuBtn.region=this.isLeftToRight()?"right":"left";c.layoutChildren(this.domNode,this._contentBox,[this._menuBtn,this._leftBtn,this._rightBtn,{domNode:this.scrollNode,region:"center"}]);this._selectedTab&&(this._anim&&"playing"==this._anim.status()&&this._anim.stop(),this.scrollNode.scrollLeft=this._convertToScrollLeft(this._getScrollForSelectedTab()));this._setButtonClass(this._getScroll());
this._postResize=!0;return{h:this._contentBox.h,w:p.w}},_getScroll:function(){return this.isLeftToRight()||8>L("ie")||L("trident")&&L("quirks")||L("webkit")?this.scrollNode.scrollLeft:D.get(this.containerNode,"width")-D.get(this.scrollNode,"width")+(L("trident")||L("edge")?-1:1)*this.scrollNode.scrollLeft},_convertToScrollLeft:function(p){if(this.isLeftToRight()||8>L("ie")||L("trident")&&L("quirks")||L("webkit"))return p;var x=D.get(this.containerNode,"width")-D.get(this.scrollNode,"width");return(L("trident")||
L("edge")?-1:1)*(p-x)},onSelectChild:function(p,x){var E=this.pane2button(p.id);if(E){var P=E.domNode;if(P!=this._selectedTab&&(this._selectedTab=P,this._postResize)){var b=this._getScroll();b>P.offsetLeft||b+D.get(this.scrollNode,"width")<P.offsetLeft+D.get(P,"width")?(P=this.createSmoothScroll(),x&&(P.onEnd=function(){E.focus()}),P.play()):x&&E.focus()}this.inherited(arguments)}},_getScrollBounds:function(){var p=this.getChildren(),x=D.get(this.scrollNode,"width"),E=D.get(this.containerNode,"width")-
x,P=this._getTabsWidth();if(p.length&&P>x)return{min:this.isLeftToRight()?0:p[p.length-1].domNode.offsetLeft,max:this.isLeftToRight()?p[p.length-1].domNode.offsetLeft+p[p.length-1].domNode.offsetWidth-x:E};p=this.isLeftToRight()?0:E;return{min:p,max:p}},_getScrollForSelectedTab:function(){var p=this._selectedTab,x=D.get(this.scrollNode,"width"),E=this._getScrollBounds();p=p.offsetLeft+D.get(p,"width")/2-x/2;return p=Math.min(Math.max(p,E.min),E.max)},createSmoothScroll:function(p){if(0<arguments.length){var x=
this._getScrollBounds();p=Math.min(Math.max(p,x.min),x.max)}else p=this._getScrollForSelectedTab();this._anim&&"playing"==this._anim.status()&&this._anim.stop();var E=this,P=this.scrollNode,b=new C.Animation({beforeBegin:function(){this.curve&&delete this.curve;var r=P.scrollLeft,v=E._convertToScrollLeft(p);b.curve=new C._Line(r,v)},onAnimate:function(r){P.scrollLeft=r}});this._anim=b;this._setButtonClass(p);return b},_getBtnNode:function(p){for(p=p.target;p&&!H.contains(p,"tabStripButton");)p=p.parentNode;
return p},doSlideRight:function(p){this.doSlide(1,this._getBtnNode(p))},doSlideLeft:function(p){this.doSlide(-1,this._getBtnNode(p))},doSlide:function(p,x){x&&H.contains(x,"dijitTabDisabled")||(p*=.75*D.get(this.scrollNode,"width"),p=this._getScroll()+p,this._setButtonClass(p),this.createSmoothScroll(p).play())},_setButtonClass:function(p){var x=this._getScrollBounds();this._leftBtn.set("disabled",p<=x.min);this._rightBtn.set("disabled",p>=x.max)}});e=m("dijit.layout._ScrollingTabControllerButtonMixin",
null,{baseClass:"dijitTab tabStripButton",templateString:e,tabIndex:"",isFocusable:function(){return!1}});m("dijit.layout._ScrollingTabControllerButton",[q,e]);m("dijit.layout._ScrollingTabControllerMenuButton",[q,u,e],{containerId:"",tabIndex:"-1",isLoaded:function(){return!1},loadDropDown:function(p){this.dropDown=new a({id:this.containerId+"_menu",ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir});var x=T.byId(this.containerId);J.forEach(x.getChildren(),function(E){var P=
new f({id:E.id+"_stcMi",label:E.title,iconClass:E.iconClass,disabled:E.disabled,ownerDocument:this.ownerDocument,dir:E.dir,lang:E.lang,textDir:E.textDir||x.textDir,onClick:function(){x.selectChild(E)}});this.dropDown.addChild(P)},this);p()},closeDropDown:function(p){this.inherited(arguments);this.dropDown&&(this._popupStateNode.removeAttribute("aria-owns"),this.dropDown.destroyRecursive(),delete this.dropDown)}});return h})},"widgets/AttributeTable/_ResourceManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/promise/all esri/lang jimu/portalUrlUtils ./table/_FeatureTable jimu/utils ./utils jimu/LayerInfos/LayerInfos".split(" "),
function(J,m,H,M,D,C,B,F,K,L,T){return J(null,{_activeLayerInfoId:null,_activeRelationshipKey:null,nls:null,config:null,map:null,parent:null,_delayedLayerInfos:[],_layerInfosFromMap:[],featureTableSet:{},relationshipsSet:{},relationshipTableSet:{},currentRelationshipKey:null,relationshipInfoMapping:{},constructor:function(h){this.widgetId=h&&h.widgetId;this.map=h&&h.map;this.nls=h&&h.nls;this.parent=h&&h.parent;this._delayedLayerInfos=[];this._layerInfosFromMap=[];this.featureTableSet={};this.relationshipsSet=
{};this.relationshipTableSet={};this.currentRelationshipKey=null;this.relationshipInfoMapping={}},setConfig:function(h){this.config=m.clone(h||{})},setMap:function(h){this.map=h},updateLayerInfoResources:function(h){var e=new M;L.readConfigLayerInfosFromMap(this.map,!1,!0).then(m.hitch(this,function(n){this._layerInfosFromMap=n;this._processDelayedLayerInfos();h&&(0===this.config.layerInfos.length?(n=L.getConfigInfosFromLayerInfos(n),this.config.layerInfos=H.filter(n,function(c){return c.show})):
this.config.layerInfos=H.filter(m.delegate(this.config.layerInfos),m.hitch(this,function(c){var k=this._getLayerInfoById(c.id),a=this.config.syncWithLayers?k.isVisible():c.show;a&&k&&(c.name=k.name||k.title,c.show=a);return a&&k})));e.resolve()}),function(n){e.reject(n)});return e},isEmpty:function(){return this.config&&this.config.layerInfos&&0>=this.config.layerInfos.length},getConfigInfos:function(){return m.clone(this.config.layerInfos)},addLayerInfo:function(h){0===this._layerInfosFromMap.length?
this._delayedLayerInfos.push(h):0<this._layerInfosFromMap.length&&!this._getLayerInfoById(h.id)&&this._layerInfosFromMap.push(h)},addConfigInfo:function(h){this._getConfigInfoById(h.id)||(h=L.getConfigInfoFromLayerInfo(h),this.config.layerInfos.push({id:h.id,name:h.name,layer:{url:h.layer.url,fields:h.layer.fields}}))},removeLayerInfo:function(h){h=this._getLayerInfoById(h);h=this._layerInfosFromMap.indexOf(h);this._layerInfosFromMap.splice(h,1)},removeConfigInfo:function(h){if(m.getObject("config.layerInfos",
!1,this))for(var e=this.config.layerInfos.length,n=0;n<e;n++)if(this.config.layerInfos[n].id===h){this.featureTableSet[h]&&(this.featureTableSet[h].destroy(),delete this.featureTableSet[h]);this.config.layerInfos.splice(n,1);break}},getQueryTable:function(h,e,n,c){var k=new M;this._activeLayerInfoId=h;this.featureTableSet[h]?k.resolve({isSupportQuery:!0,table:this.featureTableSet[h]}):this._getQueryTableInfo(h).then(m.hitch(this,function(a){if(a){var f=a.layerInfo,q=a.layerObject;a=a.tableInfo;if(this.featureTableSet[h])k.resolve({isSupportQuery:a.isSupportQuery,
table:this.featureTableSet[h]});else if(m.getObject("isSupportQuery",!1,a)){var u=this._getConfigInfoById(h);u||(this.addConfigInfo(f),u=this._getConfigInfoById(h));var p=m.getObject("layer.fields",!1,u);q=q&&q.fields;q=L.arcade.appendArcadeExpressionsToFields(q,f);u.layer.fields=this._clipValidFields(p,q);f=new F({widgetId:this.widgetId,map:this.map,matchingMap:e,hideExportButton:n,allowTextSelection:c,layerInfo:f,configedInfo:u,nls:this.nls,parent:this.parent});f.onFeatureSelectionChange=m.hitch(this,
function(){var x={},E;for(E in this.featureTableSet)this.featureTableSet[E]&&(x[E]=this.featureTableSet[E].selectionRows||[]);this.onFeatureSelectionChange(x)});this.featureTableSet[h]=f;k.resolve({isSupportQuery:a.isSupportQuery,table:f})}else k.resolve({isSupportQuery:!1})}else k.resolve(null)}),function(a){k.reject(a)});return k},getRelationTable:function(h,e,n,c,k){var a=new M,f=this.relationshipsSet[e];this._activeRelationshipKey=e;if(f){var q=this._getLayerInfoById(h);h=this.getRelationShipInfo(f);
this.getQueryTable(h.id,n,c,k).then(m.hitch(this,function(u){if(u&&u.table){var p=u.table;K.isEqual(p.relationship,f)||(p.set("prevRelationship",p.relationship),p.set("relationship",f));p.set("relatedOriginalInfo",q)}a.resolve(u)}),m.hitch(function(){a.resolve(null)}))}else a.resolve(null);return a},removeRelationTable:function(h){this.relationshipTableSet[h]&&(this.relationshipTableSet[h].destroy(),this.relationshipTableSet[h]=null)},getCurrentTable:function(h){return this.featureTableSet[h]||this.relationshipTableSet[h]},
collectRelationShips:function(h,e){this._collectRelationShips(h,h.layerObject,e)},getConfigInfoById:function(h){return this._getConfigInfoById(h)},getLayerInfoById:function(h){return this._getLayerInfoById(h)},getVisivleLayerInfoIndexById:function(h){return this._getVisivleLayerInfoIndexById(h)},getRelationshipsByInfoId:function(h){var e=[],n;for(n in this.relationshipsSet){var c=this.relationshipsSet[n];c._layerInfoId===h&&e.push(c)}return e},getRelationShipInfo:function(h){var e;if(h)for(var n in this.relationshipInfoMapping)h._relKey===
n&&(e=this.relationshipInfoMapping[n]);return e},empty:function(){this._delayedLayerInfos=[];this._layerInfosFromMap=[];this.featureTableSet={};for(var h in this.relationshipsSet)this._removeRelationShipInfo(this.relationshipsSet[h]);this.relationshipsSet={};this.relationshipTableSet={};this.nls=this.map=this.config=this.currentRelationshipKey=null},_processDelayedLayerInfos:function(){0<this._delayedLayerInfos.length&&(H.forEach(this._delayedLayerInfos,m.hitch(this,function(h){!this._getLayerInfoById(h&&
h.id)&&this.map&&this.map.getLayer(h.id)&&this._layerInfosFromMap.push(h)})),this._delayedLayerInfos=[])},_getLayerInfoById:function(h){for(var e=0,n=this._layerInfosFromMap.length;e<n;e++)if(this._layerInfosFromMap[e]&&this._layerInfosFromMap[e].id===h)return this._layerInfosFromMap[e]},_getVisivleLayerInfoIndexById:function(h){for(var e=-1,n=0,c=this._layerInfosFromMap.length;n<c;n++)if(this._layerInfosFromMap[n]&&this._layerInfosFromMap[n].isShowInMap()&&(e++,this._layerInfosFromMap[n].id===h))return e},
_getConfigInfoById:function(h){if(!m.getObject("layerInfos.length",!1,this.config))return null;for(var e=0,n=this.config.layerInfos.length;e<n;e++){var c=this.config.layerInfos[e];if(c&&c.id===h)return c}return null},_getQueryTableInfo:function(h){var e=new M,n=this._getLayerInfoById(h);if(n){var c=[],k=n.getUrl();c.push(n.getLayerObject());c.push(n.getSupportTableInfo());k&&c.push(n.getRelatedTableInfoArray());D(c).then(m.hitch(this,function(a){if(this._activeLayerInfoId===h&&a){var f=a[0],q=a[1];
a=k?a[2]:[];C.isDefined(a)&&C.isDefined(f)&&0<a.length&&this._collectRelationShips(n,f,a);e.resolve({layerInfo:n,layerObject:f,tableInfo:q})}else e.resolve(null)}),function(a){e.reject(a)})}else console.error("no activeLayerInfo!"),e.reject(Error());return e},_collectRelationShips:function(h,e,n){var c=e.relationships;if(c&&0<c.length&&e&&e.url){var k=e.url.split("/");H.forEach(c,m.hitch(this,function(a){k[k.length-1]=a.relatedTableId;var f=k.join("/"),q=H.filter(n,m.hitch(this,function(p){p=p.getUrl();
return C.isDefined(p)&&C.isDefined(f)&&B.removeProtocol(p.toString().toLowerCase())===B.removeProtocol(f.toString().toLowerCase())})),u=h.id+"_"+a.name+"_"+a.id;a._relKey=u;a._layerInfoId=h.id;q&&0<q.length&&this._setRelationShipInfo(a,q[0]);this.relationshipsSet[u]||(this.relationshipsSet[u]=a,this.relationshipsSet[u].objectIdField=e.objectIdField)}))}},_setRelationShipInfo:function(h,e){h&&"_relKey"in h&&(this.relationshipInfoMapping[h._relKey]=e)},_removeRelationShipInfo:function(h){if(h&&"_relKey"in
h)for(var e in this.relationshipInfoMapping)h._relKey===e&&delete this.relationshipInfoMapping[e]},_getLayerInfoLabel:function(h){return h.name||h.title},_getLayerInfoId:function(h){return h&&h.id||""},_clipValidFields:function(h,e){if(!h||!h.length)return e||[];if(!e||!e.length)return h;for(var n=[],c=[],k=0,a=e.length;k<a;k++){for(var f=e[k],q=0,u=h.length;q<u;q++){var p=h[q];if(p.name===f.name)break}q===u&&c.push(f)}k=0;for(a=h.length;k<a;k++)for(p=h[k],q=0,u=e.length;q<u;q++)if(f=e[q],f.name===
p.name){n.push(p);break}n=n.concat(c);0===n.length&&0<h.length&&(h=m.clone(e),H.forEach(h,m.hitch(this,function(x){"esriFieldTypeGeometry"!==x.type&&(x.show=!0,n.push(x))})));return n}})})},"widgets/AttributeTable/table/_FeatureTable":function(){define("dojo/_base/declare dojo/_base/html dijit/_WidgetBase jimu/dijit/Message jimu/dijit/Filter dgrid/OnDemandGrid ../dgrid/Selection dgrid/extensions/ColumnHider dgrid/extensions/ColumnResizer dgrid/extensions/ColumnReorder dgrid/Keyboard dijit/Menu dijit/MenuItem dijit/PopupMenuItem dijit/Toolbar dijit/form/Button dijit/DropDownMenu dijit/form/ToggleButton dijit/form/DropDownButton dojo/Deferred dojo/when dojo/Evented dojo/touch dojo/store/Memory esri/config esri/lang esri/request esri/tasks/RelationParameters esri/tasks/RelationshipQuery esri/layers/FeatureLayer esri/tasks/QueryTask esri/tasks/query esri/tasks/ProjectParameters esri/geometry/Multipoint esri/geometry/geometryEngine esri/geometry/normalizeUtils esri/IdentityManager dojo/_base/lang dojo/on dojo/aspect dojo/_base/array jimu/dijit/LoadingIndicator jimu/dijit/FieldStatistics jimu/dijit/Popup jimu/dijit/CheckBox jimu/SelectionManager jimu/CSVUtils jimu/utils ../utils dojo/query dojo/string dojo/topic dojo/keys dojo/has".split(" "),
function(J,m,H,M,D,C,B,F,K,L,T,h,e,n,c,k,a,f,q,u,p,x,E,P,b,r,v,z,G,R,Q,O,ca,Y,aa,ba,la,A,V,ea,U,da,na,oa,qa,ta,ua,ma,ka,pa,va,sa,ha,ra){return J([H,x],{baseClass:"jimu-widget-attributetable-feature-table",_defaultFeatureCount:2E3,_defaultBatchCount:25,_batchCount:0,_filterObj:null,_currentDef:null,_requestStatus:"initial",parent:null,map:null,matchingMap:!1,layerInfo:null,configedInfo:null,footerHeight:25,layer:null,loading:null,grid:null,footer:null,selectedRowsLabel:null,selectionRows:null,nls:null,
_dblClickResult:null,actived:!1,showSelected:!1,tableCreated:!1,_relatedQuery:!1,_relatedQueryIds:null,_selectionHandles:null,_selectionResults:null,_normalizedExtent:null,GRID_FAR_OFF_REMOVAL:{DEFAULT:2E3,RESELECTION:Infinity,INFINITY:Infinity},constructor:function(d){d=d||{};this.set("parent",d.parent||null);this.set("map",d.map||null);this.set("matchingMap",!!d.matchingMap);this.set("layerInfo",d.layerInfo||null);this.set("layer",d.layer||null);this.set("configedInfo",d.configedInfo||null);this.set("relatedOriginalInfo",
d.relatedOriginalInfo||null);this.set("relationship",d.relationship||null);this.set("prevRelationship",null);this.set("syncSelection",!!d.syncSelection||!0)},postCreate:function(){this.inherited(arguments);this._relatedQueryIds=[];this.createToolbar();this.loading=new da;this.loading.placeAt(this.domNode);this.selectionManager=ta.getInstance();this._selectionResults=[];this.selectionRows=[];this._normalizedExtent=null;m.setAttr(this.domNode,"data-layerinfoid",A.getObject("layerInfo.id",!1,this));
this.get("map")&&(this.own(V(this.map.root,E.release,A.hitch(this,function(){this._clickMap=!0}))),this.own(V(this.map,"extent-change",A.hitch(this,"_onExtentChange"))));this.own(V(window,"resize",A.hitch(this,this._resize)));this.layerInfo&&this.own(V(this.layerInfo,"filterChanged",A.hitch(this,this._handleFilterChange)))},startup:function(){this.inherited(arguments);this.toolbarHeight=parseInt(m.getStyle(this.toolbar.domNode,"height"),10)||0},setLayerDefinition:function(d){this._layerDefinition=
d},getLayerDefinition:function(){return this._getLayerDifinition()},getFilterableFields:function(){if(this._layerDefinition&&this.configedInfo){var d=A.clone(this._layerDefinition);return this._getFilterableFields(d.fields,this.configedInfo.layer.fields)}return[]},getFilterObj:function(){return this._filterObj},setFilterObj:function(d){this._filterObj=d},showRefreshing:function(d){d?this._toggleLoading(!0):this._toggleLoading(!1)},active:function(){this.actived=!0},deactive:function(){this.actived=
!1},cancelThread:function(){"fulfilled"!==this._requestStatus&&this._currentDef&&(this._currentDef.cancel({canceledBySelf:!0}),this._requestStatus="canceled")},isCanceled:function(){return"canceled"===this._requestStatus},createToolbar:function(){var d=new c({},m.create("div")),g=new a;this.showSelectedRecordsMenuItem=new e({label:this.nls.showSelectedRecords,iconClass:"esriAttributeTableSelectPageImage",onClick:A.hitch(this,this.toggleSelectedRecords)});g.addChild(this.showSelectedRecordsMenuItem);
var l=this.layerInfo&&this.layerInfo.layerObject&&this.layerInfo.layerObject.relationships,t=new h;this.showRelatedRecordsMenuItem=new n({label:this.nls.showRelatedRecords,iconClass:"esriAttributeTableSelectAllImage",popup:t});if(l&&0<l.length){var w=U.map(l,A.hitch(this,function(y){return this.parent&&this.parent.getRelationShipInfo(y)}));U.forEach(l,A.hitch(this,function(y){var N=this.parent&&this.parent.getRelationShipInfo(y),S=0;N&&(U.some(w,function(I){I&&I.name===N.name&&S++;if(1<S)return!1}),
t.addChild(new e({label:N.name+(1<S?y&&'\x3cbr\x3e\x3cspan style\x3d"opacity: 0.4"\x3e\x26lpar;'+y.name+"\x26rpar;\x3c/span\x3e":""),onClick:A.hitch(this,this.onShowRelatedRecordsClick,y)})))}))}g.addChild(this.showRelatedRecordsMenuItem);this.filterMenuItem=new e({label:this.nls.filter,iconClass:"esriAttributeTableFilterImage",onClick:A.hitch(this,this.onFilterMenuItemClick)});g.addChild(this.filterMenuItem);this.toggleColumnsMenuItem=new e({label:this.nls.columns,iconClass:"esriAttributeTableColumnsImage",
onClick:A.hitch(this,this.onToggleColumnsClick)});g.addChild(this.toggleColumnsMenuItem);this.hideExportButton||(this.exportCSVMenuItem=new e({label:this.nls.exportFiles,showLabel:!0,iconClass:"esriAttributeTableExportImage",onClick:A.hitch(this,this.onExportCSVClick)}),g.addChild(this.exportCSVMenuItem));this.selectionMenu=new q({label:this.nls.options,iconClass:"esriAttributeTableOptionsImage",dropDown:g});d.addChild(this.selectionMenu);this.matchingCheckBox=new f({checked:this.matchingMap?!0:!1,
showLabel:!0,label:this.nls.filterByExtent,onChange:A.hitch(this,function(y){this.set("matchingMap",y);this._onMatchingCheckBoxChange(y)})});d.addChild(this.matchingCheckBox);this.zoomButton=new k({label:this.nls.zoomto,iconClass:"esriAttributeTableZoomImage",onClick:A.hitch(this,this.zoomTo)});d.addChild(this.zoomButton);this.clearSelectionButton=new k({label:this.nls.clearSelection,iconClass:"esriAttributeTableClearImage",onClick:A.hitch(this,this.clearSelection,!0,!0)});d.addChild(this.clearSelectionButton);
this.refreshButton=new k({label:this.nls.refresh,showLabel:!0,iconClass:"esriAttributeTableRefreshImage",onClick:A.hitch(this,this.refresh)});d.addChild(this.refreshButton);m.place(d.domNode,this.domNode);this.toolbar=d;this.own(V(this,"data-loaded,row-click,clear-selection",A.hitch(this,"changeToolbarStatus")));this.parent&&sa.publish(this.parent.id+"_toolbar_created",{toolbar:this.toolbar,context:this})},startQuery:function(d){this.cancelThread();this._requestStatus="processing";this._toggleLoading();
d&&d.length?this.queryByStoreObjectIds=d:(this._relatedQuery=!1,this._relatedQueryIds=[],this.queryByStoreObjectIds=null);this._currentDef=this._getLayerObject();this._currentDef.then(A.hitch(this,function(g){this.domNode&&(this.layer=g,(g=!this.layerInfo.isTable&&this.matchingMap&&this.map.extent||null)&&g.spatialReference&&g.spatialReference.isWebMercator()?(this._currentDef=ba.normalizeCentralMeridian([g],null,A.hitch(this,function(l){return l[0]}))).then(A.hitch(this,function(l){this._doQuery(l,
d);this._normalizedExtent=l}),A.hitch(this,function(l){l&&"Request canceled"!==l.message&&console.error(l);this.changeToolbarStatus();this._toggleLoading(!1)})):this._doQuery(g,d))}),A.hitch(this,function(g){console.error(g);this.changeToolbarStatus();this._toggleLoading(!1)}))},queryRecordsByRelationship:function(d){var g=d&&d.layer,l=d&&d.selectedIds;d&&d.relationship&&(this.set("prevRelationship",this.relationship),this.set("relationship",d.relationship));d&&d.relatedOriginalInfo&&this.set("relatedOriginalInfo",
d.relatedOriginalInfo);var t=this.relationship;d=this.prevRelationship;g&&t&&l&&0<l.length&&(!ma.isEqual(this._relatedQueryIds,l)||!ma.isEqual(t,d))&&A.getObject("relatedOriginalInfo.layerObject.url",!1,this)?(this._toggleLoading(!0),this._requestStatus="processing",this._relatedQuery=!0,this.matchingCheckBox.set("checked",!1),this.cancelThread(),this._currentDef=this._getLayerObject(),this._currentDef.then(A.hitch(this,function(w){if(this.domNode){this.layer=w;var y=[],N=this.layer;U.forEach(N.fields,
function(S){r.isDefined(S.show)&&!0!==S.show&&!("esriFieldTypeOID"===S.type||r.isDefined(N.objectIdField)&&S.name===N.objectIdField)||ka.arcade.isArcadeExpressionField(S)||y.push(S.name)});w=new G;w.objectIds=l;w.outFields=y.length?y:["*"];w.relationshipId=t.id;w.returnGeometry="esriGeometryPoint"===this.layer.geometryType;(this._currentDef=g.queryRelatedFeatures(w,function(S){return S})).then(A.hitch(this,function(S){if(this.domNode){var I={displayFieldName:t.objectIdField,fields:N.fields,features:[],
fieldAliases:null},W={},Z=function(fa){var ia=fa.attributes[this.layer.objectIdField];W[ia]||(W[ia]=!0,I.features.push(fa))},X;for(X in S){var ja=S[X];U.forEach(ja&&ja.features,Z,this)}m.destroy(this.tipNode);0<I.features.length?(this.grid||(this._removeTable(),m.place(this.loading.domNode,this.domNode)),S=this._getOutFieldsFromLayerInfos(this.layer.objectIdField),this.queryExecute(S,I.features.length,!1,I)):(this.tipNode=m.toDom("\x3cdiv\x3e"+this.nls.noRelatedRecords+"\x3c/div\x3e"),this._removeTable(),
m.place(this.tipNode,this.domNode),m.place(this.loading.domNode,this.domNode));this._relatedQueryIds=l;this.emit("data-loaded");this._toggleLoading(!1)}}),A.hitch(this,function(S){S&&"Request canceled"!==S.message&&console.error(S);m.destroy(this.tipNode);this.tipNode=m.toDom("\x3cdiv\x3e"+this.nls.noRelatedRecords+"\x3c/div\x3e");this._removeTable();m.place(this.tipNode,this.domNode);m.place(this.loading.domNode,this.domNode);this._toggleLoading(!1);this.changeToolbarStatus()}))}}),A.hitch(this,
function(w){console.error(w);this._toggleLoading(!1);this.changeToolbarStatus()}))):this._toggleLoading(!1)},getSelectedRows:function(){return this.tableCreated?this.selectionRows:[]},zoomTo:function(){this._zoomToSelected()},toggleSelectedRecords:function(){this._relatedQuery&&!this.showSelected&&0===this.getSelectedRows().length?(this._relatedQuery=!1,this._relatedQueryIds=[],this.layerInfo&&!this.layerInfo.isTable&&this.matchingCheckBox.set("checked",!0),this.startQuery(),this.showSelectedRecordsMenuItem.set("label",
this.nls.showSelectedRecords),this.showSelected=!1,this.emit("show-all-records",{layerInfoId:this.layerInfo.id})):this.tableCreated&&(this.showSelected?(this.showAllSelectedRecords(),this.showSelectedRecordsMenuItem.set("label",this.nls.showSelectedRecords),this.showSelected=!1,this.emit("show-all-records",{layerInfoId:this.layerInfo.id})):(this.showSelectedRecords(),this.showSelectedRecordsMenuItem.set("label",this.nls.showAllRecords),this.showSelected=!0,this.emit("show-selected-records",{layerInfoId:this.layerInfo.id})))},
onShowRelatedRecordsClick:function(d){var g=this.getSelectedRows();0<g.length?this.emit("show-related-records",{layerInfoId:this.layerInfo.id,objectIds:g,relationshipObj:d}):this._getFeatureIds(this.layer&&this.layer.objectIdField,this.matchingMap&&this._normalizedExtent).then(A.hitch(this,function(l){console.log(l);this.emit("show-related-records",{layerInfoId:this.layerInfo.id,objectIds:l,relationshipObj:d})}))},onFilterMenuItemClick:function(){this.showRefreshing(!0);this.getLayerDefinition().then(A.hitch(this,
function(d){if(this.domNode){d=A.clone(d);var g=this.getFilterableFields();d.fields=g;var l=new D({widgetId:this.widgetId,noFilterTip:this.nls.noFilterTip,style:"width:100%;",featureLayerId:this.layerInfo.id,runtime:!0});g=this._getFilterPopupSize();this._filterPopup=new oa({titleLabel:this.nls.filter,width:g.w,height:g.h,content:l,autoHeight:!0,buttons:[{label:this.nls.ok,onClick:A.hitch(this,function(){var t=l.toJson();t&&t.expr?(this.setFilterObj(t),this.clearSelection(!1),this.startQuery(),this._filterPopup.close(),
this._filterPopup=null,this.emit("apply-filter",{layerInfoId:this.layerInfo.id,expr:t.expr})):new M({message:this.nls.setFilterTip})})},{label:this.nls.cancel}]});l.startup();m.addClass(this._filterPopup.domNode,"widget-at-filter-popup");g=this.getFilterObj();l.build({url:this.layer.url,partsObj:g,layerDefinition:this.layer||d,featureLayerId:this.layer.id})}}),A.hitch(this,function(d){this.domNode&&console.error(d)})).always(A.hitch(this,function(){this.showRefreshing(!1)}));this.emit("show-filter",
{layerInfoId:this.layerInfo.id})},_getFilterPopupSize:function(){var d={w:720,h:485};window.appInfo.isRunInMobile&&(d={w:window.innerWidth,h:window.innerHeight});return d},_resize:function(){if(this._filterPopup){var d=this._getFilterPopupSize();this._filterPopup.resize(d)}},onToggleColumnsClick:function(){this.toggleColumns();this.emit("toggle-columns",{layerInfoId:this.layerInfo.id})},onExportCSVClick:function(){var d=this._getRichTextFields(),g=this._getExportCSVPopupMessage(d),l=new M({"class":this.baseClass+
"-popup",message:g,titleLabel:this.nls.exportFiles,autoHeight:!0,buttons:[{label:this.nls.ok,onClick:A.hitch(this,function(){var t=g._check;l.domNode&&(l.domNode.className+=" is-loading",(new da).placeAt(l.domNode));this.exportToCSV(null,"undefined"===typeof t||t.checked?null:d).then(function(){l.close()},function(w){console.error("Error exporting CSV for Attribute Table");l.close()})})},{label:this.nls.cancel}]});this.emit("export-csv",{layerInfoId:this.layerInfo.id})},_getExportCSVPopupMessage:function(d){var g=
document.createElement("div");g.className="message-wrapper";g.appendChild(document.createTextNode(this.nls.exportMessage));if(d.length){var l=document.createElement("div");l.className="input-row";var t=new qa({label:this.nls.keepRichTextLabel,checked:!0}),w=document.createElement("a");w.className="hint-button";w.href="#";w.role="button";w.appendChild(document.createTextNode(this.nls.whatsThis));l.appendChild(t.domNode);l.appendChild(w);g.appendChild(l);g._check=t;this.own(V(w,"click",A.hitch(this,
function(y){y.preventDefault();y={"class":this.baseClass+"-popup",message:this._getRichTextMessage(d)};window.appInfo.isRunInMobile||(y.width=500);new M(y)})))}return g},_getRichTextMessage:function(d){if(!d||d.hasOwnProperty("length")&&!d.length)return"";for(var g=document.createElement("div"),l="",t=0,w=d.length;t<w;t++)l+="\x3cmark\x3e"+d[t].fieldName+"\x3c/mark\x3e";d="\x3cp\x3e"+va.substitute(this.nls.richTextMessage.explanatoryText.line1,{layerName:"\x3cstrong\x3e"+this.layer.name+"\x3c/strong\x3e"})+
"\x3c/p\x3e";d=d+('\x3cdiv class\x3d"tags"\x3e'+l+"\x3c/div\x3e\x3cp\x3e")+(this.nls.richTextMessage.explanatoryText.line2+"\x3c/p\x3e\x3cp\x3e"+this.nls.richTextMessage.explanatoryText.line3+"\x3c/p\x3e\x3ch3\x3e"+this.nls.richTextMessage.example.label+'\x3c/h3\x3e\x3cdiv class\x3d"example-block"\x3e\x3cpre\x3e\x3cu\x3eArcGIS\x3c/u\x3e \x3cfont color\x3d"#31aacd"\x3eWeb AppBuilder\x3c/font\x3e\x3c/pre\x3e'+this.nls.richTextMessage.example.scenarios.first+'\x3cpre\x3e\x26ltu\x26gtArcGIS\x26lt/u\x26gt \x26ltfont color\x3d"#31aacd"\x26gtWeb AppBuilder\x26lt/font\x26gt\x3c/pre\x3e'+
this.nls.richTextMessage.example.scenarios.second+"\x3cpre\x3eArcGIS Web AppBuilder\x3c/pre\x3e\x3c/div\x3e");g.innerHTML=d;return g},_getRichTextFields:function(){var d=this.layerInfo&&this.layerInfo.getPopupInfo&&this.layerInfo.getPopupInfo();d=d&&d.fieldInfos;var g=[];if(d)for(var l=0,t=d.length;l<t;l++){var w=d[l];w.stringFieldOption&&"richtext"===w.stringFieldOption&&g.push(w)}return g},onSelectionComplete:function(){var d=this.layer&&this.layer.getSelectedFeatures();d&&(0===d.length?this.clearSelection(!1,
0<this._selectionResults.length):this._selectBySelf(d)||(this.clearSelection(!1),this._updateSelectRowsByFeatures(d)))},onSelectionClear:function(){this.clearSelection(!1,!0);this._setFarOffRemoval(this.GRID_FAR_OFF_REMOVAL.DEFAULT)},changeToolbarStatus:function(){if(this.tableCreated){var d=this.getSelectedRows();this.showSelected?this.showSelectedRecordsMenuItem.set("label",this.nls.showAllRecords):this.showSelectedRecordsMenuItem.set("label",this.nls.showSelectedRecords);this.tableCreated&&d&&
0<d.length&&this.layer&&this.layer.objectIdField?(this.showSelectedRecordsMenuItem.set("disabled",!1),this.clearSelectionButton.set("disabled",!1)):(this.showSelectedRecordsMenuItem.set("disabled",!0),this.clearSelectionButton.set("disabled",!0));this._relatedQuery&&(this.showSelectedRecordsMenuItem.set("disabled",!1),this.tableCreated&&d&&0===d.length&&this.showSelectedRecordsMenuItem.set("label",this.nls.showAllRecords));this.showRelatedRecordsMenuItem.set("disabled",!0);if(this.layerInfo&&this.isSupportQueryToServer()&&
this.layer&&this.layer.objectIdField){this._relatedDef&&!this._relatedDef.isFulfilled()&&this._relatedDef.cancel();var g=this.layerInfo.getRelatedTableInfoArray();this._relatedDef=g;g.then(A.hitch(this,function(l){this.domNode&&this.tableCreated&&l&&0<l.length&&this.showRelatedRecordsMenuItem.set("disabled",!1)}))}this.tableCreated&&this.isSupportQueryToServer()&&!this._relatedQuery?this.filterMenuItem.set("disabled",!1):this.filterMenuItem.set("disabled",!0);this.matchingCheckBox.set("disabled",
!1);this.tableCreated?this.toggleColumnsMenuItem.set("disabled",!1):this.toggleColumnsMenuItem.set("disabled",!0);this.hideExportButton||(d&&0<d.length?this.exportCSVMenuItem.set("label",this.nls.exportSelected):this.exportCSVMenuItem.set("label",this.nls.exportAll),this.tableCreated?this.exportCSVMenuItem.set("disabled",!1):this.exportCSVMenuItem.set("disabled",!0));this.layerInfo.isShowInMap()?this.tableCreated&&d&&0<d.length?this.zoomButton.set("disabled",!1):this.zoomButton.set("disabled",!0):
this.zoomButton.set("disabled",!0);this.layerInfo.isTable&&(this.matchingCheckBox.set("disabled",!0),this.zoomButton.set("disabled",!0))}else this._relatedQuery?(this.showSelectedRecordsMenuItem.set("disabled",!1),this.showSelectedRecordsMenuItem.set("label",this.nls.showAllRecords)):this.showSelectedRecordsMenuItem.set("disabled",!0),this.showRelatedRecordsMenuItem.set("disabled",!0),this.matchingCheckBox.set("disabled",!0),this.filterMenuItem.set("disabled",!0),this.toggleColumnsMenuItem.set("disabled",
!0),this.hideExportButton||this.exportCSVMenuItem.set("disabled",!0),this.zoomButton.set("disabled",!0)},showSelectedRecords:function(){if(this.tableCreated){var d=this.layer.objectIdField,g=this.getSelectedRows();0<g.length&&this.grid&&(this.grid.store instanceof P?this.grid.set("query",A.hitch(this,function(l){return"number"===typeof l&&-1<g.indexOf(l)||-1<g.indexOf(l[d])?!0:!1})):this.grid.set("query",function(){return g}))}},showAllSelectedRecords:function(){if(this.tableCreated&&this.showSelected){this.grid.set("query",
{});var d=this.getSelectedRows();this._updateSelectRowsByIds(d)}},clearSelection:function(d,g){this.tableCreated&&(this.grid.clearSelection(),this.selectionRows=[],d&&this.grid.set("query",{}),g&&(this._selectionResults=[],this.layer&&0<this.layer.getSelectedFeatures().length&&this.selectionManager.clearSelection(this.layer)),this._closePopup(),this.setSelectedNumber(),this.showSelected=!1,this.emit("clear-selection"))},refresh:function(){this.grid&&this.grid.clearSelection();this._relatedQuery||
this.startQuery();this.emit("refresh",{layerInfoId:this.layerInfo.id})},exportToCSV:function(d,g){if(!this.layerInfo||!this.layer||!this.tableCreated){var l=new u;l.reject();return l}return this.getSelectedRowsData().then(A.hitch(this,function(t){var w=this.layer.objectIdField,y=[],N=this.layer.fullExtent.spatialReference.equals(this.map.extent.spatialReference),S=this._hasArcadeExpressionFields(),I=ka.getSortbyFields(this.grid,this.layer);if(N||!this.layer.url){var W=U.map(this._getTableSelectedIds(),
A.hitch(this,function(fa){for(var ia=0,wa=t.length;ia<wa;ia++)if(t[ia]&&t[ia][w]===fa)return t[ia];return{}}))||[];0===W.length&&this.isSelectionMode()&&W.push({});y=W;0===W.length&&this.grid.store instanceof P&&(y={},I&&I instanceof Array&&(y.sort=U.map(I,function(fa){fa=fa.split(/ +/);return{attribute:fa[0],descending:"DESC"===fa[1]}})),y=A.clone(this.grid.store.query({},y)));y.length&&this._appendXY(y)}var Z=this._getTableSelectedIds(),X=this.parent&&this.parent.tabContainer.selectedChildWidget.params.viewInTableFlag;
W=[];if(Z=!y.length&&X&&!Z.length)W=A.clone(this.grid.store.data),!N&&this.layer.url||!W.length||this._appendXY(W);X={};var ja=this.getOutFields(!!y.length);X.datas=Z?W:y;X.fromClient=!1;X.withGeometry="esriGeometryPoint"===this.layer.geometryType;X.outFields=ja;X.formatNumber=!1;X.formatDate=!0;X.formatCodedValue=!0;X.popupInfo=this.layerInfo.getPopupInfo();X.objectIds=!N&&0<this.getSelectedRows().length&&this._getExportObjectIds();X.outSpatialReference=!N&&A.clone(this.layer.fullExtent.spatialReference);
X.richTextFieldsToClear=g;S&&(X.arcadeExpressions={expressionInfos:this.layerInfo.getPopupInfo().expressionInfos,layerDefinition:ma.getFeatureLayerDefinition(this.layer)});X.orderByFields=I;if(!X.objectIds||X.objectIds instanceof Array&&0===X.objectIds.length)this.matchingMap&&this.layerInfo&&!this.layerInfo.isTable&&(X.geometry=this._currentExtent),X.start=0,X.num=this.layer.maxRecordCount||1E3,X.filterExpression=this.layerInfo.getFilter&&this.layerInfo.getFilter();return ua.exportCSVFromFeatureLayer(d||
this.configedInfo.name,this.layer,X)}))},toggleColumns:function(){this.tableCreated&&this.grid._toggleColumnHiderMenu()},changeHeight:function(d){this.grid&&0<=d-this.toolbarHeight-this.footerHeight&&m.setStyle(this.grid.domNode,"height",d-this.toolbarHeight-this.footerHeight+"px")},isSupportQueryToServer:function(){var d=this.layer&&"esri.layers.CSVLayer"===this.layer.declaredClass,g=this.layer&&"esri.layers.StreamLayer"===this.layer.declaredClass;return this.layer&&this.layer.url&&this.configedInfo.layer.url&&
!d&&!g},isSupportQueryOnClient:function(){var d=this.layer&&"esri.layers.CSVLayer"===this.layer.declaredClass,g=this.layer&&"esri.layers.StreamLayer"===this.layer.declaredClass;return!(this.layer&&this.layer.url&&this.configedInfo.layer.url)||d||g},destroy:function(){this._destroyed||(this.layer=this.configedInfo=this.layerInfo=null,this._selectionHandles&&U.forEach(this._selectionHandles,function(d){d&&d.remove&&d.remove()}),this._closePopup(),this._filterPopup&&this._filterPopup.domNode&&(this._filterPopup.close(),
this._filterPopup=null),this._dblClickResult=null,this.grid&&this.grid.destroy(),this.prevRelationship=this.relationship=this.nls=this.map=null,this._currentDef&&!this._currentDef.isFulfilled()&&this._currentDef.cancel({canceledBySelf:!0}),this._relatedDef&&!this._relatedDef.isFulfilled()&&this._relatedDef.cancel({canceledBySelf:!0}),this.inherited(arguments))},_selectBySelf:function(d){d=d||[];if(d.length!==this._selectionResults.length)return!1;var g=this.layer.objectIdField;return U.every(this._selectionResults,
function(l){return d.some(function(t){return l.attributes[g]===t.attributes[g]})})},_updateSelectRowsByFeatures:function(d){var g=U.map(d,A.hitch(this,function(l){return l.attributes[this.layer.objectIdField]}));this._updateSelectRowsByIds(g);this._selectionResults=d},_updateSelectRowsByIds:function(d){this.grid&&this.tableCreated&&(this.selectionRows=d,U.forEach(d,A.hitch(this,function(g){this.grid.select(g)})),this.setSelectedNumber(),this.changeToolbarStatus())},_removeTable:function(){this.grid&&
this.grid.domNode&&(this.grid.destroy(),this.grid=null);this.footer&&(m.destroy(this.footer),this.selectedRowsLabel=this.footer=null);this.tableCreated=!1},_onMatchingCheckBoxChange:function(d){this.tableCreated&&!this._relatedQuery&&(this.cancelThread(),this.queryByStoreObjectIds=null,this.startQuery());if("fulfilled"===this._requestStatus&&this.tableCreated&&this._relatedQuery)if(d)this.queryByStoreObjectIds=U.map(this.grid.store.data,A.hitch(this,function(l){return l[this.layer.objectIdField]})),
this.startQuery(this.queryByStoreObjectIds);else{var g=this._relatedQueryIds;this._relatedQueryIds=[];this.queryRecordsByRelationship({layer:this.relatedOriginalInfo.layerObject,selectedIds:g})}d||(this._currentExtent=null)},_closePopup:function(){var d=this.map.infoWindow.getSelectedFeature(),g=d&&this._dblClickResult&&d===this._dblClickResult;d=d&&d._layer===this.layer;this.domNode&&(g||d)&&(this.map.infoWindow.hide(),this._dblClickResult=null)},_getLayerObject:function(){function d(g){this._selectionHandles&&
U.forEach(this._selectionHandles,function(l){l&&l.remove&&l.remove()});this._selectionHandles=[];this._selectionHandles.push(V(g,"selection-complete",A.hitch(this,"onSelectionComplete")));this._selectionHandles.push(V(g,"selection-clear",A.hitch(this,"onSelectionClear")))}return(this._currentDef=this.layerInfo.getLayerObject()).then(A.hitch(this,function(g){var l=new u;"esri.layers.ArcGISImageServiceLayer"===g.declaredClass||"esri.layers.ArcGISImageServiceVectorLayer"===g.declaredClass?(g=new R(g.url),
this.own(V(g,"load",A.hitch(this,function(t){A.hitch(this,d)(t.layer);l.resolve(t.layer)})))):(A.hitch(this,d)(g),l.resolve(g));return l}))},_getLayerDifinition:function(){return this._layerDefinition?p(A.clone(this._layerDefinition)):v({url:this.layer.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(A.hitch(this,function(d){this.setLayerDefinition(d);return this.getLayerDefinition()}))},_getFilterableFields:function(d,g){return U.filter(d,function(l){return U.some(g,function(t){return l.name===
t.name&&(t.show||!r.isDefined(t.show))&&A.mixin(l,t)})})},_getExportObjectIds:function(){var d=this._getTableSelectedIds()||[];if(0===d.length&&this.grid.store instanceof P){var g=this.layer.objectIdField;this.grid.store.query(function(l){d.push(l[g])})}return d},_doQuery:function(d,g){if(this.layer){var l=this.layer.objectIdField;this.isSupportQueryToServer()?this._queryToServer(d,l,g):this.isSupportQueryOnClient()&&this._queryOnClient(d,l,g)}},_queryOnClient:function(d,g,l){var t={};t.features=
"esri.layers.StreamLayer"===this.layer.declaredClass?this.layer.getLatestObservations():U.filter(this.layer.graphics,A.hitch(this,function(I){return!I.wabIsTemp}));l&&0<l.length&&(t.features=U.filter(t.features,function(I){return-1<l.indexOf(I.attributes[this.layer.objectIdField])},this));var w=this.layer.fields,y=this.configedInfo.layer.fields;t.fields=y?U.filter(y,A.hitch(this,function(I){r.isDefined(I.show)||(I.show=!0);I.name!==g||"esriFieldTypeOID"!==I.type&&"esriFieldTypeInteger"!==I.type||
(I._pk=!0);for(var W=0,Z=w.length;W<Z;W++)w[W].name!==I.name||I.type||(I.type=w[W].type);return I.show||I._pk})):U.filter(w,A.hitch(this,function(I){r.isDefined(I.show)||(I.show=!0);I.name!==g||"esriFieldTypeOID"!==I.type&&"esriFieldTypeInteger"!==I.type||(I._pk=!0);return I.show||I._pk}));y=[];for(var N=t.features.length,S=0;S<N;S++)t&&t.features&&t.features[S]&&t.features[S].geometry&&y.push(t.features[S].geometry);d&&b.defaults.geometryService&&0<y.length?d.spatialReference.equals(y[0].spatialReference)?
(t.features=U.filter(t.features,A.hitch(this,function(I){if(I&&I.geometry)return aa.intersects(d,I.geometry)})),this.queryExecute(t.fields,t.features.length,!1,t,d)):(N=new z,N.geometries1=y,N.geometries2=[d],N.relation=z.SPATIAL_REL_INTERSECTION,(this._currentDef=b.defaults.geometryService.relation(N,A.hitch(this,function(I){return I}))).then(A.hitch(this,function(I,W){for(var Z=W.length,X=[],ja=0;ja<Z;ja++)X.push(I.features[W[ja].geometry1Index]);I.features=X;this.queryExecute(I.fields,I.features.length,
!1,I,d)},t),A.hitch(this,function(I){I&&"Request canceled"!==I.message&&console.error(I);this.changeToolbarStatus();this._toggleLoading(!1)}))):this.queryExecute(t.fields,t.features.length,!1,t,d)},_queryToServer:function(d,g,l){this._getFeatureCount(d,l).then(A.hitch(this,function(t){if(this.domNode)if(l)this._queryFeatureLayer(d,g,t,!1,l);else{var w=this.layer,y=r.isDefined(w.maxRecordCount)?w.maxRecordCount:1E3;this._batchCount=Math.min(y,this._defaultBatchCount);if(t<=y||!this.layer.objectIdField)this._queryFeatureLayer(d,
g,t,!1);else{var N=this._getOutFieldsFromLayerInfos(g),S={fields:this.layer.fields};this.layer._recordCounts=t;w.advancedQueryCapabilities&&w.advancedQueryCapabilities.supportsPagination?this.queryExecute(N,t,!0,S,d):this._getFeatureIds(g,d).then(A.hitch(this,function(I){this.domNode&&(this.layer._objectIds=I,this.queryExecute(N,t,!0,S,d))}),A.hitch(this,function(I){console.error(I);this.changeToolbarStatus()}))}}}),A.hitch(this,function(t){console.error(t);this.changeToolbarStatus()}))},_getFeatureCount:function(d,
g){var l=new u,t=new Q(this.configedInfo.layer.url),w=new O;w.returnGeometry=!1;w.where=this._getLayerFilterExpression();g&&(w.where+=" AND "+this.layer.objectIdField+" IN ("+g.join()+")");d&&(w.geometry=d);(this._currentDef=t.executeForCount(w,A.hitch(this,function(y){return y}))).then(A.hitch(this,function(y){l.resolve(y)}),A.hitch(this,function(y){y&&"Request canceled"!==y.message&&(console.error(y),console.log("Could not get feature count."));this._toggleLoading(!1);l.reject(y)}));return l},_queryFeatureLayer:function(d,
g,l,t,w){var y=new Q(this.configedInfo.layer.url),N=new O;N.where=this._getLayerFilterExpression();w&&g&&(N.where+=" AND "+g+" IN ("+w.join()+")");var S=this._getOutFieldsFromLayerInfos(g),I=(w=this._hasArcadeExpressionFields())&&this._hasArcadeExpressionWithGeometry();if(0<S.length&&!w){var W=[];U.forEach(S,function(Z){W.push(Z.name)});N.outFields=W}else N.outFields=["*"];d&&(N.geometry=d,N.spatialRelationship=O.SPATIAL_REL_INTERSECTS);N.outSpatialReference=A.clone(this.map.spatialReference);N.returnGeometry=
"esriGeometryPoint"===this.layer.geometryType||I;g&&(N.orderByFields=[g+" ASC"]);(this._currentDef=y.execute(N,A.hitch(this,function(Z){return Z}))).then(A.hitch(this,function(Z){this.queryExecute(S,l,t,Z,d)}),A.hitch(this,function(Z){Z&&"Request canceled"!==Z.message&&console.error(Z);this.changeToolbarStatus();this._toggleLoading(!1)}))},_getFeatureIds:function(d,g){var l=new u,t=new Q(this.configedInfo.layer.url),w=new O;w.returnGeometry=!1;w.returnIdsOnly=!0;w.where=this._getLayerFilterExpression();
if(this.layer._orderByFields||d)w.orderByFields=this.layer._orderByFields||[d+" ASC"];g&&(w.geometry=g);(this._currentDef=t.executeForIds(w,A.hitch(this,function(y){return y}))).then(A.hitch(this,function(y){l.resolve(y)}),A.hitch(this,function(y){y&&"Request canceled"!==y.message&&(console.error(y),console.log("Could not get feature Ids"));l.resolve([])}));return l},queryExecute:function(d,g,l,t,w){var y=[];y=null;var N={};if(this.domNode){t.fields=this._processExecuteFields(this.layer.fields,d);
l?y=ka.generateCacheStore(this.layer,g,this._batchCount,this._getLayerFilterExpression(),w):(y=U.map(t.features,A.hitch(this,function(Z){var X=A.clone(Z.attributes);return A.mixin(X,{geometry:Z.geometry})})),y=ka.generateMemoryStore(y,this.layer.objectIdField));d=this.layer.typeIdField;N=this.layer.types;var S=A.getObject("advancedQueryCapabilities.supportsOrderBy",!1,this.layer),I=A.getObject("advancedQueryCapabilities.supportsPagination",!1,this.layer),W=A.getObject("advancedQueryCapabilities.supportsStatistics",
!1,this.layer);N=ka.generateColumnsFromFields(this.grid&&this.grid.columns,this.layerInfo,t.fields,d,N,S&&I||!l,W,this.layer);this.layer.hasAttachments&&this.layer.objectIdField&&this.configedInfo.showAttachments&&(N.attachmentsColumn=this.formatAttachmentsColumn());l=20+100*t.fields.length<m.getMarginBox(this.domNode).w;this.createTable(N,y,g,l);g=this.grid.domNode.querySelectorAll(".dgrid-header .dgrid-column-selectionHandle");0<g.length&&g[0].setAttribute("role","presentation");this._currentExtent=
w;w=this.layer.getSelectedFeatures();this.selectionRows&&0<this.selectionRows.length?this._updateSelectRowsByIds(this.selectionRows):w&&0<w.length?this._updateSelectRowsByFeatures(w):this.grid.clearSelection();this.changeToolbarStatus();this.emit("data-loaded")}},formatAttachmentsColumn:function(){var d={label:this.nls.attachments,className:"attachments-column",hidden:!1,unhidable:!0,field:"at-show-attachments",sortable:!1,_cache:{sortable:!1,statistics:!1}};d.renderCell=A.hitch(this,function(g,l,
t){var w=g[this.layer.objectIdField];this.layer.queryAttachmentInfos(w,A.hitch(this,function(y){var N=U.map(y,A.hitch(this,function(I){var W=I.name&&/\.(png|jpg|jpeg|gif)$/gi.test(I.name)?"image-type":"file-type",Z=la.findCredential(this.layer.url);return'\x3cli class\x3d"'+W+'"\x3e\x3ca class\x3d"jimu-ellipsis" target\x3d"_blank" href\x3d"'+(this.layer.url+"/"+w+"/attachments/"+I.id+(Z?"?token\x3d"+Z.token:""))+'"\x3e'+I.name+"\x3c/a\x3e\x3c/li\x3e"})),S="";0<y.length&&(S=" "+this.nls.files);S='\x3cdiv class\x3d"attachment-infos"\x3e\x3cdiv class\x3d"show-attachments-div"\x3e\x3cspan class\x3d"show-attachments"\x3e'+
y.length+S+'\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"attachment-popup"\x3e\x3cdiv class\x3d"attachment-popup-header"\x3e\x3cspan\x3e'+N.length+"\x26nbsp;"+this.nls.files+'\x3c/span\x3e\x3cspan class\x3d"close jimu-float-trailing"\x3e\x3c/span\x3e\x3c/div\x3e\x3cul class\x3d"attachment-popup-content"\x3e'+N.join("")+"\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e";S=m.toDom(S);0<y.length&&(y=pa(".show-attachments-div",S)[0],m.addClass(y,"has-attachments"));t.appendChild(S);this.own(V(t,"click",A.hitch(this,
function(I){I=I&&I.target;if(m.hasClass(I,"show-attachments-div")||m.hasClass(I,"show-attachments")||m.hasClass(I,"close")){I=this._visibleAttachmentPopup;var W=pa(".attachment-popup",t)[0];W&&0<N.length&&m.toggleClass(W,"show");m.hasClass(W,"show")?this._visibleAttachmentPopup=W:this._visibleAttachmentPopup=null;I&&I!==W&&m.toggleClass(I,"show")}})))}),A.hitch(this,function(y){console.error(y)}))});return d},createTable:function(d,g,l,t){if(this.grid)this.grid.set("store",g),this.grid.set("columns",
d),this.grid.refresh();else{var w={},y=new da;m.setStyle(y.domNode,"max-width","100vw");w.columns=d;w.store=g;w.keepScrollPosition=!0;w.farOffRemoval=this.GRID_FAR_OFF_REMOVAL.DEFAULT;ra("chrome")||(w.pagingDelay=1E3);w.allowTextSelection=this.allowTextSelection;w.deselectOnRefresh=!1;w.loadingMessage=y.domNode&&y.domNode.outerHTML;this.layer.objectIdField||(w.minRowsPerPage=this.layer.maxRecordCount||1E3,w.maxRowsPerPage=this.layer.maxRecordCount||1E3,w.selectionMode="none");this.grid=new (J([C,
B,F,K,L,T]))(w,m.create("div"));m.place(this.grid.domNode,this.domNode);this.grid.startup();this.tipNode&&m.destroy(this.tipNode);this.own(V(this.ownerDocument,"keydown",A.hitch(this,function(N){this.allowTextSelection&&this.grid&&this.grid.allowTextSelection&&N.shiftKey&&this.grid._setAllowTextSelection(!1)})));this.own(V(this.ownerDocument,"keyup",A.hitch(this,function(){this.allowTextSelection&&this.grid&&!this.grid.allowTextSelection&&this.grid._setAllowTextSelection(!0)})));this.own(V(this.ownerDocument,
"keydown",A.hitch(this,function(N){this.tableCreated&&(N.keyCode===ha.SHIFT||(ra("mac")?N.keyCode===ha.META:N.keyCode===ha.CTRL)&&this.isSelectionMode())&&(this._setFarOffRemoval(this.GRID_FAR_OFF_REMOVAL.INFINITY),V.once(this.ownerDocument,"keyup",A.hitch(this,function(S){!this.tableCreated||S.keyCode!==ha.SHIFT&&(ra("mac")?S.keyCode!==ha.META:S.keyCode!==ha.CTRL)||(this.isSelectionMode()?this._setFarOffRemoval(this.GRID_FAR_OFF_REMOVAL.RESELECTION):this._setFarOffRemoval(this.GRID_FAR_OFF_REMOVAL.DEFAULT))})))})));
this.layer.objectIdField&&(this.own(V(this.grid,".dgrid-header .dgrid-cell:click",A.hitch(this,this._onHeaderClick))),this.own(V(this.grid,"dgrid-columnstatechange",A.hitch(this,this._onColumnStateChange))),this.own(V(this.grid,".selection-handle-column:click",A.hitch(this,this._onSelectionHandleClick)),V(this.grid,".selection-handle-column:keydown",A.hitch(this,function(N){N.keyCode!==ha.ENTER&&N.keyCode!==ha.SPACE||this._onSelectionHandleClick()}))),this.own(V(this.grid,".dgrid-row:dblclick",A.hitch(this,
this._onDblclickRow)),V(this.grid,"dgrid-sort",A.hitch(this,function(N){this.emit("sort",N)})),V(this.grid,"dgrid-refresh-complete",A.hitch(this,function(N){this.parent&&sa.publish(this.parent.id+"_table_created",{grid:N.grid,context:this})}))),d=this.map.getLayer(this.layer.id),this.syncSelection&&d&&this.own(V(d,"click",A.hitch(this,this._onFeaturelayerClick))))}this.grid.get("sort")[0]||(this.configedInfo&&this.configedInfo.sortField?this.grid.set("sort",this.configedInfo.sortField,this.configedInfo.isDescending):
this.layer.objectIdField&&this.grid.set("sort",this.layer.objectIdField,!1));this.getParent()&&(d=pa(".dgrid-scroller",this.grid.domNode)[0],w=pa(".dgrid-header",this.grid.domNode)[0],g=m.getComputedStyle(d),w=m.getMarginBox(w),g=parseInt(g.marginTop,10),isFinite(g)&&w&&g<w.h&&m.setStyle(d,"marginTop",w.h+"px"));t?m.addClass(this.domNode,"auto-width"):m.removeClass(this.domNode,"auto-width");this.footer?m.empty(this.footer):this.footer=m.create("div",{id:this.parent.id+"_"+this.id+"_footer","class":this.parent.baseClass+
"-feature-table-footer",tabindex:"-1"},this.domNode);l=m.create("div",{"class":"dgrid-status self-footer",innerHTML:l+"\x26nbsp;"+(this.layerInfo.isTable?this.nls.records:this.nls.features)+"\x26nbsp;"},this.footer);this.selectedRowsLabel=m.create("div",{"class":"dgrid-status self-footer",id:this.id+"_Selected_Rows_Label",innerHTML:"0\x26nbsp;"+this.nls.selected+"\x26nbsp;",style:{display:this.layer.objectIdField?"":"none"}},l,"after");l=m.getStyle(this.domNode,"height");this.changeHeight(l);this._requestStatus=
"fulfilled";this.tableCreated=!0;m.place(this.loading.domNode,this.grid.domNode);this._toggleLoading(!1)},getSelectedRowsData:function(){var d=new u,g=this._getTableSelectedIds()||[];if(!this.grid||!g.length)return d.resolve(null),d;this.grid.store instanceof P?(g=A.clone(this.grid.store.data),d.resolve(g)):this.grid.store.query(g,{_export_count:g.length}).then(A.hitch(this,function(l){l=l&&A.clone(this.grid.store._entityData||this.grid.store.data);d.resolve(l)}));return d},_appendXY:function(d){d&&
"esriGeometryPoint"===this.layer.geometryType&&U.forEach(d,function(g){var l=g.geometry;l&&"point"===l.type&&("x"in g?g._x=l.x:g.x=l.x,"y"in g?g._y=l.y:g.y=l.y);delete g.geometry})},getOutFields:function(d){var g=null;g=this._getOutFieldsFromLayerInfos(this.layer.objectIdField);g=this._processExecuteFields(this.layer.fields,g);g=this._getVisibleFields(g);g=A.clone(g);d&&(d="",d=-1!==g.indexOf("x")?"_x":"x",g.push({name:d,alias:d,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"}),
d=-1!==g.indexOf("y")?"_y":"y",g.push({name:d,alias:d,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"}));return g},setSelectedNumber:function(){if(this.selectedRowsLabel&&this.grid){var d=this.getSelectedRows(),g=0;if(this.grid.store instanceof P){var l=U.map(this.grid.store.data,function(t){return t[this.layer.objectIdField]},this);U.forEach(d,function(t){-1<l.indexOf(t)&&g++})}else g=d.length;this.selectedRowsLabel.innerHTML="\x26nbsp;\x26nbsp;"+g+" "+this.nls.selected+"\x26nbsp;\x26nbsp;"}},
_setSelection:function(d){this._selectionResults=d=d||[];this.selectionManager.setSelection(this.layer,d)},_zoomToExtentByFeatures:function(d){return this.getExtent(d).then(A.hitch(this,function(g){if(g&&this.domNode){var l=null;if("point"===g.type){var t=this.map.getNumLevels(),w=this.map.getLevel();l=this.map.getMaxZoom();0<t?(w===l?t=w:(t=w+4,t>l&&(t=l)),l=this.map.centerAndZoom(g,t)):l=this.map.centerAndZoom(g,1/Math.pow(2,4)*2)}else l=this.map.setExtent(g.expand(2));return l.then(function(){return g})}}))},
_showMapInfoWindowByFeatures:function(d,g){if(g&&0!==g.length&&this.domNode){var l=this.map.infoWindow,t=this.layerInfo.isPopupEnabled()&&this.layerInfo.getInfoTemplate();if(l&&l.setFeatures&&1===g.length&&t){U.forEach(g,A.hitch(this,function(y){y._layer=this.layerInfo.layerObject;y.setInfoTemplate(t)}));l.setFeatures(g);var w=null;w="point"===d.type?g[0].geometry:d.getCenter();l.show(w,{closetFirst:!0});this._dblClickResult=g[0];this.syncWithMapInfowindow(this._dblClickResult)}}},selectFeatures:function(d,
g){if(g&&0<g.length){if("rowclick"===d||"selectall"===d)this._setSelection(g);else if("zoom"===d||"row-dblclick"===d){var l=ma.graphicsExtent(g),t=ma.toFeatureSet(g),w=V(this.map,"zoom-end, pan-end",A.hitch(this,function(){w.remove();"row-dblclick"===d&&this.domNode&&this._showMapInfoWindowByFeatures(l,g)}));ma.zoomToFeatureSet(this.map,t).then(null,function(y){y&&(console.error(y.message),w&&w.remove())})}this.setSelectedNumber();this.onFeatureSelectionChange()}else this.onFeatureSelectionChange(),
this._popupMessage(this.nls.dataNotAvailable)},syncWithMapInfowindow:function(d){var g=this.map.infoWindow,l=A.isArray(d)?d:[d];V.once(g,"hide",A.hitch(this,function(){t&&t.remove&&(t.remove(),t=null)}));var t=ea.after(g,"show",A.hitch(this,function(){var w=g.getSelectedFeature();w=w&&l[0]===w;var y=-1;g.features&&(y=g.features.indexOf(l[0]));!w&&-1<y?g.select(y):this.domNode&&!w&&t&&t.remove&&(t.remove(),t=null)}))},getGraphicsFromLocalFeatureLayer:function(d){for(var g=[],l,t,w=d.length,y=this.layer.graphics.length,
N=this.layer.objectIdField,S=0;S<w;S++)for(var I=0;I<y;I++)if(l=this.layer.graphics[I].attributes[N]+"",t=d[S]+"",l===t){g.push(this.layer.graphics[I]);break}return g},getExtent:function(d){var g=new u,l,t=d.length;if(1===t&&d[0].geometry&&"point"===d[0].geometry.type)var w=d[0].geometry;else if(1!==t||d[0].geometry)for(var y=0;y<t;y++)d[y].geometry?"point"===d[y].geometry.type?(l||(l=new Y(d[y].geometry.spatialReference)),l.addPoint(d[y].geometry),y===t-1&&(w=l.getExtent())):w=w?w.union(d[y].geometry.getExtent()):
d[y].geometry.getExtent():console.error("unable to get geometry of the reocord: ",d[y]);else return g.reject(Error("AttributeTable.getExtent:: extent was not projected.")),g;if(!w||!w.spatialReference)return g.reject(Error("AttributeTable.getExtent:: extent was not projected.")),g;d=this.map.spatialReference;w.spatialReference.equals(d)?g.resolve(w):(l=new ca,l.geometries=[w],l.outSR=d,b.defaults.geometryService.project(l,A.hitch(this,function(N){this.domNode&&(N&&N.length?g.resolve(N[0]):g.reject(Error("AttributeTable.getExtent:: extent was not projected.")))}),
A.hitch(this,function(N){N||(N=Error("AttributeTable.getExtent:: extent was not projected."));g.reject(N)})));return g},_onFeaturelayerClick:function(d,g){if(this.actived){var l=A.getObject("graphic",!1,d),t=A.getObject("graphic.attributes",!1,d);t&&l&&l._layer===this.layer&&((l=this.map.infoWindow.getSelectedFeature())&&l._layer===this.layer&&!g&&this.map.infoWindow.hide(),g=t[this.layer.objectIdField],this.showSelected&&this.toggleSelectedRecords(),this._getIndexOfIdInGrid(g).then(A.hitch(this,
function(w){-1!==w&&(this.grid.scrollTo({x:0,y:this.grid.rowHeight*w}),this.map.infoWindow.features&&(w=this.map.infoWindow.features.indexOf(d.graphic),this.map.infoWindow.select(w)),V.once(this.map.infoWindow,"selection-change",A.hitch(this,function(){var y=this.map.infoWindow.getSelectedFeature(),N=A.getObject("_layer",!1,y);y!==d.graphic&&N===this.layer&&this._onFeaturelayerClick({graphic:y},!0)})),this.syncWithMapInfowindow(d.graphic))})))}},_getIndexOfIdInGrid:function(d){var g=new u,l=-1,t=
A.getObject("store.objectIds",!1,this.grid);l=null;l=this.grid.get("sort")[0];if(this._relatedQuery)return g.resolve(-1),g;if(this.grid.store instanceof P)d=this.grid.store.get(d),t=this.grid.store.data,d?l&&l.attribute&&r.isDefined(l.descending)?(t=A.clone(t),l=function(w,y){return function(N,S){return N[w]===S[w]?0:N[w]<S[w]?y?1:-1:y?-1:1}}(l.attribute,l.descending),t.sort(l),t=U.map(t,function(w){return w[this.layer.objectIdField]},this),l=t.indexOf(d[this.layer.objectIdField])):l=t.indexOf(d):
l=-1,g.resolve(l);else if(t&&0<t.length)l=t.indexOf(d),g.resolve(l);else{t=new O;t.returnGeometry=!1;t.where=this._getLayerFilterExpression()+" AND "+this.layer.objectIdField+" \x3c "+d;if(l&&(l.attribute!==this.layer.objectIdField||l.descending))return g.resolve(-1),g;this.matchingMap&&!this._relatedQuery&&this._currentExtent&&(t.geometry=this._currentExtent);(this._currentDef=this.layer.queryCount(t)).then(A.hitch(this,function(w){g.resolve(w)}),A.hitch(this,function(w){g.reject(w)}))}return g},
_zoomToSelected:function(){if(this.configedInfo&&this.tableCreated){var d=this.getSelectedRows();this._goToFeatures(d,"zoom")}},_goToFeatures:function(d,g){if(0!==d.length){var l=this.getGraphicsFromLocalFeatureLayer(d);this.isSupportQueryToServer()&&d.length!==l.length?this._queryFeaturesByIds(d,g):this.selectFeatures(g,l)}},_onDblclickRow:function(d){this.layerInfo&&this.layerInfo.isShowInMap()&&(d=[this.grid.row(d).id],this._goToFeatures(d,"row-dblclick"))},_queryFeaturesByIds:function(d,g){var l=
new O;l.objectIds=d;l.returnGeometry=!0;l.outSpatialReference=A.clone(this.map.spatialReference);l.outFields=["*"];d=this.layer;var t="esri.layers.CSVLayer"===d.declaredClass;d.url&&!t?(new Q(d.url)).execute(l,A.hitch(this,function(w){this.selectFeatures(g,w.features)}),A.hitch(this,this._errorSelectFeatures)):d.selectFeatures(l,R.SELECTION_NEW,A.hitch(this,this.selectFeatures,g),A.hitch(this,this._errorSelectFeatures))},_onHeaderClick:function(d){var g=this.grid.cell(d),l=g.column,t=g.element.getBoundingClientRect();
this._showColumnMenu(l,g,d.target,{x:d.pageX||t.x+.5*t.width,y:d.pageY||t.y+t.height})},_showColumnMenu:function(d,g,l,t){var w=A.getObject("_cache",!1,d);if(w&&(w.sortable||w.statistics)){var y=new h({});m.addClass(y.domNode,"jimu-widget-attributetable-feature-menu");var N=this;if(w.sortable){var S=["iconSortAscending","iconSortDescending"];U.forEach([this.nls.sortAsc,this.nls.sortDes],function(I,W){I=new e({label:I,iconClass:S[W],baseClass:"menuItemClass",onClick:function(){0===W?N.grid.set("sort",
d.field,!1):1===W&&N.grid.set("sort",d.field,!0)}});y.addChild(I)})}w.statistics&&(w=new e({label:this.nls.statistics,iconClass:"iconTableStatistics",baseClass:"menuItemClass",onClick:A.hitch(this,function(){var I={layer:this.layer,filterExpression:this._getLayerFilterExpression(),fieldNames:[d.field]};this.matchingMap&&(I.geometry=this._currentExtent);if(this.showSelected){var W=this._getSelectedIds();I.filterExpression+=" AND "+this.layer.objectIdField+" IN ("+W.join()+")"}else this.queryByStoreObjectIds&&
0<this.queryByStoreObjectIds.length&&(I.filterExpression+=" AND "+this.layer.objectIdField+" IN ("+this.queryByStoreObjectIds.join()+")");this.fieldStatistics=new na;this.fieldStatistics.showContentAsPopup(I)})}),y.addChild(w));w=y.getChildren();y.startup();y._openMyself({target:l,delegatedTarget:g,iframe:null,coords:t});this.own(V(y,"Close",A.hitch(this,function(){var I=this.get("columnMenu");I&&(I.destroyRecursive(),this.set("columnMenu",null))})));this.set("columnMenu",y);1>w.length&&V.emit(y,
"Close")}},_onColumnStateChange:function(d){if(d&&d.grid&&d.grid.columns){var g=0,l;for(l in d.grid.columns)d.grid.columns[l].hidden||g++;20+100*g-1<m.getMarginBox(this.domNode).w?m.addClass(this.domNode,"auto-width"):m.removeClass(this.domNode,"auto-width")}},_onSelectionHandleClick:function(){var d=this._getSelectedIds();this.selectionRows=d;this._closePopup();this.layerInfo.isTable||(0<d.length?this._goToFeatures(d,"rowclick"):(this.onFeatureSelectionChange(),this._setSelection([])));this.setSelectedNumber();
1===this.getSelectedRows().length&&this._setFarOffRemoval(this.GRID_FAR_OFF_REMOVAL.RESELECTION);this.emit("row-click",{table:this,selectedIds:d})},_onExtentChange:function(d){var g=A.getObject("delta.x",!1,d),l=A.getObject("delta.y",!1,d);d=this._clickMap&&!d.levelChange?isFinite(g)&&isFinite(l)&&(0<Math.abs(g)||0<Math.abs(l)):!0;this._clickMap=!1;d&&this.matchingMap&&this.actived&&this.layerInfo&&!this.layerInfo.isTable&&this.startQuery(this.queryByStoreObjectIds)},_getLayerFilterExpression:function(){var d=
this.layerInfo.getFilter();return d?d:"1\x3d1"},_getOutFieldsFromLayerInfos:function(d){var g=this.configedInfo.layer.fields,l=this.layerInfo.getPopupInfo(),t=l&&l.fieldInfos,w=[];g&&U.forEach(g,A.hitch(this,function(y){if(!r.isDefined(y.show)&&(y.show=!0,t))for(var N=0,S=t.length;N<S;N++){var I=t[N];I.fieldName===y.name&&(y.show=I.visible)}y.name!==d||"esriFieldTypeOID"!==y.type&&"esriFieldTypeInteger"!==y.type&&y.type||(y._pk=!0);(y.show||y._pk)&&w.push(y)}));return w},_processExecuteFields:function(d,
g){if(d&&0<d.length){var l=[];if(!g.length)return d;for(var t=0,w=g.length;t<w;t++)for(var y=0;y<d.length;y++)g[t].name!==d[y].name||g[t].type!==d[y].type&&g[t].type||(d[y]=A.mixin(d[y],g[t]),l.push(d[y]));return l}return g},_getVisibleFields:function(d){var g=[];if(this.grid&&this.grid.columns){for(var l in this.grid.columns){var t=this.grid.columns[l];t&&t.hidden&&g.push(t.field)}return U.filter(d,function(w){if(0>g.indexOf(w.name))return w})}return d},_getSelectedIds:function(){var d=[],g=this.grid.selection,
l;for(l in g)g[l]&&(isFinite(l)?d.push(parseInt(l,10)):d.push(l));return d},_getTableSelectedIds:function(){var d=[],g=this.getSelectedRows();if(this.grid)if(this.grid.store instanceof P){var l=U.map(this.grid.store.data,function(t){return t[this.layer.objectIdField]},this);U.forEach(g,function(t){-1<l.indexOf(t)&&d.push(parseInt(t,10))})}else d=g;return d},isSelectionMode:function(){var d=this.getSelectedRows();return this.tableCreated&&d&&0<d.length&&this.layer&&this.layer.objectIdField?!0:!1},
_errorSelectFeatures:function(d){console.error(d)},_popupMessage:function(d){var g=new M({message:d,buttons:[{label:this.nls.ok,onClick:A.hitch(this,function(){g.close()})}]});this._toggleLoading(!1)},_hasArcadeExpressionFields:function(){return this.layerInfo.getPopupInfo()&&this.layerInfo.getPopupInfo().expressionInfos&&U.some(this.configedInfo.layer.fields,function(d){return ka.arcade.isArcadeExpressionField(d)})},_hasArcadeExpressionWithGeometry:function(){var d=this.layerInfo.getPopupInfo()&&
this.layerInfo.getPopupInfo().expressionInfos,g=ka.arcade.parseArcadeExpressions(d);return g?U.some(Object.keys(g),function(l){return g[l].usesGeometry}):!1},_toggleLoading:function(d){void 0===d?this.loading.hidden?this.loading.show():this.loading.hide():d?this.loading.show():this.loading.hide()},_setFarOffRemoval:function(d){this.tableCreated&&!isNaN(d)&&this.grid.set("farOffRemoval",d)},_handleFilterChange:function(){var d=this.layer.getSelectedFeatures(),g=this.layer.objectIdField;if(d&&0<d.length){var l=
U.map(d,function(w){return w.attributes[g]}),t=new O;t.where=g+" in ("+l.join(",")+") AND "+this.layerInfo.getFilter();(new Q(this.layer.url)).executeForIds(t).then(A.hitch(this,function(w){U.forEach(d,function(y){w&&0<=w.indexOf(y.attributes[g])?y.show():y.hide()});this.selectionManager._isLayerNeedDisplayLayer(this.layer)&&this.selectionManager._updateDisplayLayer(this.layer,d,R.SELECTION_NEW)}),A.hitch(this,function(w){console.error(w)}))}}})})},"widgets/AttributeTable/dgrid/Selection":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/Deferred dojo/on dojo/has dojo/aspect dgrid/List dojo/has!touch?dgrid/util/touch put-selector/put dojo/query dojo/_base/sniff".split(" "),
function(J,m,H,M,D,C,B,F,K){function L(a,f){f=a.unselectable=f?"on":"";a=a.getElementsByTagName("*");for(var q=a.length;--q;)"INPUT"!==a[q].tagName&&"TEXTAREA"!==a[q].tagName&&(a[q].unselectable=f)}function T(a,f){var q=a.bodyNode,u=f?"text":21>D("ff")?"-moz-none":"none";e&&"msUserSelect"!==e?q.style[e]=u:D("dom-selectstart")?f||a._selectstartHandle?f&&a._selectstartHandle&&(a._selectstartHandle.remove(),delete a._selectstartHandle):a._selectstartHandle=M(q,"selectstart",function(p){var x=p.target&&
p.target.tagName;"INPUT"!==x&&"TEXTAREA"!==x&&p.preventDefault()}):(L(q,!f),f||a._unselectableHandle)?f&&a._unselectableHandle&&(a._unselectableHandle.remove(),delete a._unselectableHandle):a._unselectableHandle=C.after(a,"renderRow",function(p){L(p,!0);return p})}D.add("dom-comparedocumentposition",function(a,f,q){return!!q.compareDocumentPosition});D.add("pointer",function(a){return"PointerEvent"in a?"pointer":"MSPointerEvent"in a?"MSPointer":!1});D.add("css-user-select",function(a,f,q){a=q.style;
f=["Khtml","O","ms","Moz","Webkit"];q=f.length;var u="userSelect";do if("undefined"!==typeof a[u])return u;while(q--&&(u=f[q]+"UserSelect"));return!1});D.add("dom-selectstart","undefined"!==typeof document.onselectstart);var h=D("mac")?"metaKey":"ctrlKey",e=D("css-user-select"),n=(B=D("pointer"))&&"MS"===B.slice(0,2),c=B?B+(n?"Down":"down"):"mousedown",k=B?B+(n?"Up":"up"):"mouseup";"WebkitUserSelect"===e&&"undefined"!==typeof document.documentElement.style.msUserSelect&&(e=!1);return m("dgrid.Selection",
null,{selectionDelegate:".dgrid-cell.dgrid-cell-padding.dgrid-column-selectionHandle.field-selectionHandle.selection-handle-column",selectionEvents:c+","+k+",dgrid-cellfocusin",selectionTouchEvents:D("touch")?F.tap:null,deselectOnRefresh:!0,allowSelectAll:!1,selection:{},selectionMode:"extended",allowTextSelection:void 0,_selectionTargetType:"rows",create:function(){this.selection={};return this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._initSelectionEvents();var a=
this.selectionMode;this.selectionMode="";this._setSelectionMode(a)},destroy:function(){this.inherited(arguments);this._selectstartHandle&&this._selectstartHandle.remove();this._unselectableHandle&&this._unselectableHandle.remove();this._removeDeselectSignals&&this._removeDeselectSignals()},_setSelectionMode:function(a){a!=this.selectionMode&&(this.clearSelection(),this.selectionMode=a,this._selectionHandlerName="_"+a+"SelectionHandler",this._setAllowTextSelection(this.allowTextSelection))},setSelectionMode:function(a){J.deprecated("setSelectionMode(...)",
'use set("selectionMode", ...) instead',"dgrid 0.4");this.set("selectionMode",a)},_setAllowTextSelection:function(a){"undefined"!==typeof a?T(this,a):T(this,"none"===this.selectionMode);this.allowTextSelection=a},_handleSelect:function(a,f){if(this[this._selectionHandlerName]&&this.allowSelect(this.row(f))&&("dgrid-cellfocusin"!==a.type||"mousedown"!==a.parentType)&&(a.type!==k||f==this._waitForMouseUp)){this._waitForMouseUp=null;this._selectionTriggerEvent=a;if(!a.keyCode||!a.ctrlKey||32==a.keyCode)if(!a.shiftKey&&
a.type===c&&this.isSelected(f))this._waitForMouseUp=f;else this[this._selectionHandlerName](a,f);this._selectionTriggerEvent=null}},_singleSelectionHandler:function(a,f){a=a.keyCode?a.ctrlKey:a[h];this._lastSelected===f?this.select(f,null,!a||!this.isSelected(f)):(this.clearSelection(),this.select(f),this._lastSelected=f)},_multipleSelectionHandler:function(a,f){var q=this._lastSelected,u=a.keyCode?a.ctrlKey:a[h];if(!a.shiftKey){var p=u?null:!0;q=null}this.select(f,q,p);q||(this._lastSelected=f)},
_extendedSelectionHandler:function(a,f){(2===a.button?this.isSelected(f):a.keyCode?a.ctrlKey:a[h])||this.clearSelection(null,!0);this._multipleSelectionHandler(a,f)},_toggleSelectionHandler:function(a,f){this.select(f,null,null)},_initSelectionEvents:function(){var a=this,f=this.contentNode,q=this.selectionDelegate;this._selectionEventQueues={deselect:[],select:[]};D("touch")&&!D("pointer")&&this.selectionTouchEvents?(M(f,F.selector(q,this.selectionTouchEvents),function(u){a._handleSelect(u,this);
a._ignoreMouseSelect=this}),M(f,M.selector(q,this.selectionEvents),function(u){a._ignoreMouseSelect!==this?a._handleSelect(u,this):u.type===k&&(a._ignoreMouseSelect=null)})):M(f,M.selector(q,this.selectionEvents),function(u){a._handleSelect(u,this)});this.addKeyHandler&&this.addKeyHandler(32,function(u){a._handleSelect(u,u.target)});if(this.allowSelectAll)this.on("keydown",function(u){u[h]&&65==u.keyCode&&!/\bdgrid-input\b/.test(u.target.className)&&(u.preventDefault(),a[a.allSelected?"clearSelection":
"selectAll"]())});this._setStore&&C.after(this,"_setStore",function(){a._updateDeselectionAspect()});this._updateDeselectionAspect()},_updateDeselectionAspect:function(){function a(x,E,P){x=E||x&&x[f.idProperty||"id"];if(null!=x&&(E=(x=f.row(x))&&f.selection[x.id]))f[P](x,null,E)}var f=this,q=this.store;this._removeDeselectSignals&&this._removeDeselectSignals();if(q&&q.notify){var u=C.before(q,"notify",function(x,E){x||a(x,E,"deselect")});var p=C.after(q,"notify",function(x,E){a(x,E,"select")},!0);
this._removeDeselectSignals=function(){u.remove();p.remove()}}else u=C.before(this,"removeRow",function(x,E){E||(x=this.row(x))&&x.id in this.selection&&this.deselect(x)}),this._removeDeselectSignals=function(){u.remove()}},allowSelect:function(a){return!0},_fireSelectionEvent:function(a){var f=this._selectionEventQueues[a],q=this._selectionTriggerEvent;var u={bubbles:!0,grid:this};q&&(u.parentType=q.type);u[this._selectionTargetType]=f;this._selectionEventQueues[a]=[];M.emit(this.contentNode,"dgrid-"+
a,u)},_fireSelectionEvents:function(){var a=this._selectionEventQueues,f;for(f in a)a[f].length&&this._fireSelectionEvent(f)},_select:function(a,f,q){"undefined"===typeof q&&(q=!0);a.element||(a=this.row(a));if(!1===q||this.allowSelect(a)){var u=this.selection;var p=!!u[a.id];null===q&&(q=!p);var x=a.element;q||this.allSelected?u[a.id]=q:delete this.selection[a.id];x&&(q?K(x,".dgrid-selected"+(this.addUiClasses?".ui-state-active":"")):K(x,"!dgrid-selected!ui-state-active"));q!==p&&x&&this._selectionEventQueues[(q?
"":"de")+"select"].push(a);if(f)if(f.element||(f=this.row(f)),f){if(f=f.element)for(u=this._determineSelectionDirection(x,f),u||(f=document.getElementById(f.id),u=this._determineSelectionDirection(x,f));a.element!=f&&(a=this[u](a));)this._select(a,null,q)}else this._lastSelected=x,console.warn("The selection range has been reset because the beginning of the selection is no longer in the DOM. If you are using OnDemandList, you may wish to increase farOffRemoval to avoid this, but note that keeping more nodes in the DOM may impact performance.")}},
_determineSelectionDirection:D("dom-comparedocumentposition")?function(a,f){a=f.compareDocumentPosition(a);return a&1?!1:2===a?"down":"up"}:function(a,f){return 1>f.sourceIndex?!1:f.sourceIndex>a.sourceIndex?"down":"up"},select:function(a,f,q){this._select(a,f,q);this._fireSelectionEvents()},deselect:function(a,f){this.select(a,f,!1)},clearSelection:function(a,f){this.allSelected=!1;for(var q in this.selection)a!==q&&this._select(q,null,!1);f||(this._lastSelected=null);this._fireSelectionEvents()},
selectAll:function(){this.allSelected=!0;this.selection={};for(var a in this._rowIdToObject){var f=this.row(this._rowIdToObject[a]);this._select(f.id,null,!0)}this._fireSelectionEvents()},isSelected:function(a){if("undefined"===typeof a||null===a)return!1;a.element||(a=this.row(a));return a.id in this.selection?!!this.selection[a.id]:this.allSelected&&(!a.data||this.allowSelect(a))},refresh:function(){this.deselectOnRefresh&&this.clearSelection();this._lastSelected=null;return this.inherited(arguments)},
renderArray:function(){var a=this,f=this.inherited(arguments);H.when(f,function(q){var u=a.selection,p,x;for(p=0;p<q.length;p++){var E=a.row(q[p]);(x=E.id in u?u[E.id]:a.allSelected)&&a._select(E,null,x)}a._fireSelectionEvents()});return f}})})},"dgrid/extensions/ColumnHider":function(){define("dojo/_base/declare dojo/has dojo/on ../util/misc put-selector/put dojo/i18n!./nls/columnHider xstyle/css!../css/extensions/ColumnHider.css".split(" "),function(J,m,H,M,D,C){var B,F,K=m("ie"),L=K&&m("quirks"),
T=8>K||L?"htmlFor":"for";return J("dgrid.extensions.ColumnHider",null,{hiderMenuNode:null,hiderToggleNode:null,i18nColumnHider:C,_hiderMenuOpened:!1,_columnHiderRules:null,_columnHiderCheckboxes:null,_renderHiderMenuEntries:function(){var h=this.subRows,e=!0,n,c;delete this._columnHiderFirstCheckbox;var k=0;for(n=h.length;k<n;k++){var a=0;for(c=h[k].length;a<c;a++)this._renderHiderMenuEntry(h[k][a]),e&&(e=!1,this._columnHiderFirstCheckbox=this._columnHiderCheckboxes[h[k][a].id])}},_renderHiderMenuEntry:function(h){var e=
h.id,n=M.escapeCssIdentifier(e,"-");h.hidden&&(h.hidden=!1,this._hideColumn(e),h.hidden=!0);if(!h.unhidable){var c=D("div.dgrid-hider-menu-row");var k=this.domNode.id+"-hider-menu-check-"+n;e=this._columnHiderCheckboxes[e]=D(c,"input.dgrid-hider-menu-check.hider-menu-check-"+n+"[type\x3dcheckbox]");e.id=k;D(c,"label.dgrid-hider-menu-label.hider-menu-label-"+n+"["+T+"\x3d"+k+"]",h.label||h.field||"");D(this.hiderMenuNode,c);h.hidden||(e.checked=!0)}},renderHeader:function(){function h(a){a.stopPropagation()}
var e=this,n=this.hiderMenuNode,c=this.hiderToggleNode,k;this.inherited(arguments);if(n){for(k in this._columnHiderRules)this._columnHiderRules[k].remove();n.innerHTML=""}else c=this.hiderToggleNode=D(this.domNode,"button.ui-icon.dgrid-hider-toggle[type\x3dbutton][aria-label\x3d"+this.i18nColumnHider.popupTriggerLabel+"]"),this._listeners.push(H(c,"click",function(a){e._toggleColumnHiderMenu(a)})),n=this.hiderMenuNode=D("div.dgrid-hider-menu[role\x3ddialog][aria-label\x3d"+this.i18nColumnHider.popupLabel+
"]"),n.id=this.id+"-hider-menu",this._listeners.push(H(n,"keyup",function(a){27===(a.charCode||a.keyCode)&&(e._toggleColumnHiderMenu(a),c.focus())})),n.style.display="none",D(this.domNode,n),this._listeners.push(H(n,".dgrid-hider-menu-check:"+(9>K||L?"click":"change"),function(a){e._updateColumnHiddenState(a.target.id.substr(e.id.length+18),!a.target.checked)})),this._listeners.push(H(n,"mousedown",h),H(c,"mousedown",h)),F||(F=H.pausable(document,"mousedown",function(a){B&&B._toggleColumnHiderMenu(a)}),
F.pause());this._columnHiderCheckboxes={};this._columnHiderRules={};this._renderHiderMenuEntries()},destroy:function(){this.inherited(arguments);for(var h in this._columnHiderRules)this._columnHiderRules[h].remove()},left:function(h,e){return this.right(h,-e)},right:function(h,e){h.element||(h=this.cell(h));for(var n=this.inherited(arguments),c=h;n.column.hidden;){n=this.inherited(arguments,[n,0<e?1:-1]);if(c.element===n.element)return h;c=n}return n},isColumnHidden:function(h){return!!this._columnHiderRules[h]},
_toggleColumnHiderMenu:function(){var h=this._hiderMenuOpened,e=this.hiderMenuNode,n=this.domNode,c;e.style.display=h?"none":"";h?e.style.height="":(e.offsetHeight>n.offsetHeight-12&&(e.style.height=n.offsetHeight-12+"px"),(c=this._columnHiderFirstCheckbox)&&c.focus());F[h?"pause":"resume"]();B=h?null:this;this._hiderMenuOpened=!h},_hideColumn:function(h){var e=this,n="#"+M.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-";if(!(this._columnHiderRules[h]||(this._columnHiderRules[h]=M.addCssRule(n+
M.escapeCssIdentifier(h,"-"),"display: none;"),8!==m("ie")&&10!==m("ie")||m("quirks")))){var c=M.addCssRule(".dgrid-row-table","display: inline-table;");window.setTimeout(function(){c.remove();e.resize()},0)}},_showColumn:function(h){this._columnHiderRules[h]&&(this._columnHiderRules[h].remove(),delete this._columnHiderRules[h])},_updateColumnHiddenState:function(h,e){this[e?"_hideColumn":"_showColumn"](h);this.columns[h].hidden=e;H.emit(this.domNode,"dgrid-columnstatechange",{grid:this,column:this.columns[h],
hidden:e,bubbles:!0});this.resize()},toggleColumnHiddenState:function(h,e){"undefined"===typeof e&&(e=!this._columnHiderRules[h]);this._updateColumnHiddenState(h,e);this._columnHiderCheckboxes[h].checked=!e}})})},"dgrid/extensions/ColumnResizer":function(){define("dojo/_base/declare dojo/on dojo/query dojo/_base/lang dojo/dom dojo/dom-geometry dojo/has ../util/misc put-selector/put dojo/_base/html xstyle/css!../css/extensions/ColumnResizer.css".split(" "),function(J,m,H,M,D,C,B,F,K){function L(c){for(var k=
c.length,a=k,f=c[0].length,q=Array(k);k--;)q[k]=Array(f);var u={};for(k=0;k<a;k++)for(var p=q[k],x=c[k],E=0,P=0;E<f;E++){var b=x[P];if("undefined"==typeof p[E]){p[E]=b.id;if(b.rowSpan&&1<b.rowSpan){var r=q;for(var v=b.rowSpan,z=k,G=E,R=b.id,Q=1;Q<v;Q++)r[z+Q][G]=R}if(0<k&&b.colSpan&&1<b.colSpan)for(r=1;r<b.colSpan;r++)if(p[++E]=b.id,b.rowSpan&&1<b.rowSpan){v=q;z=b.rowSpan;G=k;R=E;Q=b.id;for(var O=1;O<z;O++)v[G+O][R]=Q}u[b.id]=c[0][E].id;P++}}return u}function T(c,k,a,f,q){if(!(0>=a)){var u=c.columns[k];
if(u){var p={grid:c,columnId:k,width:a,bubbles:!0,cancelable:!0};f&&(p.parentType=f);if(!c._resizedColumns||m.emit(c.headerNode,"dgrid-columnresize",p))return"auto"===a?delete u.width:(u.width=a,a+="px"),(f=c._columnSizes[k])?f.set("width",a):f=F.addCssRule("#"+F.escapeCssIdentifier(c.domNode.id)+" .dgrid-column-"+F.escapeCssIdentifier(k,"-"),"width: "+a+";"),c._columnSizes[k]=f,!1!==q&&c.resize(),!0}}}var h,e=0,n={create:function(){h=K("div.dgrid-column-resizer")},destroy:function(){K(h,"!");h=null},
show:function(c){c=C.position(c.domNode,!0);h.style.top=c.y+"px";h.style.height=c.h+"px";K(document.body,h)},move:function(c){h.style.left=c+"px"},hide:function(){h.parentNode.removeChild(h)}};return J("dgrid.extensions.ColumnResizer",null,{resizeNode:null,minWidth:40,adjustLastColumn:!0,_resizedColumns:!1,buildRendering:function(){this.inherited(arguments);e++||n.create()},destroy:function(){this.inherited(arguments);for(var c in this._columnSizes)this._columnSizes[c].remove();--e||n.destroy()},
resizeColumnWidth:function(c,k){return T(this,c,k)},configStructure:function(){var c=this._oldColumnSizes=M.mixin({},this._columnSizes),k;this._resizedColumns=!1;this._columnSizes={};this.inherited(arguments);for(k in c)k in this._columnSizes||c[k].remove();delete this._oldColumnSizes},_configColumn:function(c){this.inherited(arguments);var k=c.id,a;"width"in c&&((a=this._oldColumnSizes[k])?a.set("width",c.width+"px"):a=F.addCssRule("#"+F.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+F.escapeCssIdentifier(k,
"-"),"width: "+c.width+"px;"),this._columnSizes[k]=a)},renderHeader:function(){this.inherited(arguments);var c=this;if(this.columnSets&&this.columnSets.length)for(var k=this.columnSets.length;k--;)var a=M.mixin(a||{},L(this.columnSets[k]));else this.subRows&&1<this.subRows.length&&(a=L(this.subRows));k=H(".dgrid-cell",c.headerNode);for(var f=k.length;f--;){var q=k[f],u=q.columnId,p=c.columns[u],x=q.childNodes;if(p&&!1!==p.resizable){p=K("div.dgrid-resize-header-container");for(q.contents=p;0<x.length;)K(p,
x[0]);K(q,p,"div.dgrid-resize-handle.resizeNode-"+F.escapeCssIdentifier(u,"-")).columnId=a&&a[u]||u}}c.mouseMoveListen||(m(c.headerNode,".dgrid-resize-handle:mousedown"+(B("touch")?",.dgrid-resize-handle:touchstart":""),function(E){c._resizeMouseDown(E,this);c.mouseMoveListen.resume();c.mouseUpListen.resume()}),c._listeners.push(c.mouseMoveListen=m.pausable(document,"mousemove"+(B("touch")?",touchmove":""),F.throttleDelayed(function(E){c._updateResizerPosition(E)}))),c._listeners.push(c.mouseUpListen=
m.pausable(document,"mouseup"+(B("touch")?",touchend":""),function(E){c._resizeMouseUp(E);c.mouseMoveListen.pause();c.mouseUpListen.pause()})),c.mouseMoveListen.pause(),c.mouseUpListen.pause())},_resizeMouseDown:function(c,k){c.preventDefault();D.setSelectable(this.domNode,!1);this._startX=this._getResizeMouseLocation(c);this._targetCell=H(".dgrid-column-"+F.escapeCssIdentifier(k.columnId,"-"),this.headerNode)[0];this._updateResizerPosition(c);n.show(this)},_resizeMouseUp:function(c){var k=this._columnSizes,
a;this.adjustLastColumn&&(a=this.headerNode.clientWidth-1);if(!this._resizedColumns){var f=H(".dgrid-cell",this.headerNode);this.columnSets&&this.columnSets.length?f=f.filter(function(b){return"0"==b.columnId.split("-")[0]&&!(b.columnId in k)}):this.subRows&&1<this.subRows.length&&(f=f.filter(function(b){return"0"==b.columnId.charAt(0)&&!(b.columnId in k)}));var q=f.map(function(b){return b.offsetWidth});f.forEach(function(b,r){T(this,b.columnId,q[r],null,!1)},this);this._resizedColumns=!0}D.setSelectable(this.domNode,
!0);f=this._targetCell;var u=this._getResizeMouseLocation(c)-this._startX,p=f.offsetWidth+u,x=this._getResizedColumnWidths(),E=x.totalWidth;x=x.lastColId;var P=H(".dgrid-column-"+F.escapeCssIdentifier(x,"-"),this.headerNode)[0].offsetWidth;p<this.minWidth&&(p=this.minWidth);T(this,f.columnId,p,c.type)&&f.columnId!=x&&this.adjustLastColumn&&(E+u<a?T(this,x,"auto",c.type):P-u<=this.minWidth&&T(this,x,this.minWidth,c.type));n.hide();delete this._startX;delete this._targetCell},_updateResizerPosition:function(c){if(this._targetCell){c=
this._getResizeMouseLocation(c);var k=this._targetCell.offsetWidth,a=c;k+(c-this._startX)<this.minWidth&&(a=this._startX-(k-this.minWidth));n.move(a)}},_getResizeMouseLocation:function(c){var k=0;c.pageX?k=c.pageX:c.clientX&&(k=c.clientX+document.body.scrollLeft+document.documentElement.scrollLeft);return k},_getResizedColumnWidths:function(){var c=0,k=H((this.columnSets?".dgrid-column-set-cell ":"")+"tr:first-child .dgrid-cell",this.headerNode),a=k.length;if(!a)return{};for(var f=k[a-1].columnId;a--;)c+=
k[a].offsetWidth;return{totalWidth:c,lastColId:f}}})})},"dgrid/extensions/ColumnReorder":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/on dojo/query dojo/dnd/Source put-selector/put xstyle/css!../css/extensions/ColumnReorder.css".split(" "),function(J,m,H,M,D,C,B){function F(h,e){var n=e[2];h=h[n?"columnSets":"subRows"][e[1]];return n?h[e[2]]:h}function K(h,e,n){e[2]?h.columnSets[e[1]][e[2]]=n:h.subRows[e[1]]=n}function L(h,e){return e.slice(("dgrid-"+h+"-").length)}
var T=/(\d+)(?:-(\d+))?$/;J=m(C,{copyState:function(){return!1},checkAcceptance:function(h,e){return h==this},_legalMouseDown:function(h){return-1<h.target.className.indexOf("dgrid-resize-handle")?!1:this.inherited(arguments)},onDropInternal:function(h){var e=this.grid,n=T.exec(L(e.id,h[0].getAttribute("dndType"))),c=n[2]?"columnSets":"subRows",k=F(e,n),a=e.columns;this.inherited(arguments);n&&setTimeout(function(){var f=H.map(h[0].parentNode.childNodes,function(q){return a[q.columnId]});K(e,n,f);
f={grid:e,subRow:f,column:a[h[0].columnId],bubbles:!0,cancelable:!0,parentType:"dnd"};f[c]=e[c];M.emit(e.domNode,"dgrid-columnreorder",f)?e.set(c,e[c]):(K(e,n,k),e.renderHeader(),this._sort&&this._sort.length&&this.updateSortArrow(this._sort))},0)}});m=m("dgrid.extensions.ColumnReorder",null,{columnDndConstructor:J,_initSubRowDnd:function(h,e){var n;var c=0;for(n=h.length;c<n;c++){var k=h[c];if(!1!==k.reorderable&&(k=k.headerNode,"TH"!=k.tagName&&(k=k.parentNode),B(k,".dojoDndItem[dndType\x3d"+e+
"]"),!a))var a=k.parentNode}a&&this._columnDndSources.push(new this.columnDndConstructor(a,{horizontal:!0,grid:this}))},renderHeader:function(){var h="dgrid-"+this.id+"-",e;this.inherited(arguments);this._columnDndSources&&H.forEach(this._columnDndSources,function(c){c.destroy()});this._columnDndSources=[];if(this.columnSets){var n=0;for(e=this.columnSets.length;n<e;n++)H.forEach(this.columnSets[n],function(c,k){this._initSubRowDnd(c,h+n+"-"+k)},this)}else H.forEach(this.subRows,function(c,k){this._initSubRowDnd(c,
h+k)},this)},_destroyColumns:function(){this._columnDndSources&&H.forEach(this._columnDndSources,function(h){h.destroy()});this.inherited(arguments)}});m.ColumnDndSource=J;return m})},"dgrid/Keyboard":function(){define("dojo/_base/declare dojo/aspect dojo/on dojo/_base/lang dojo/has put-selector/put ./util/misc dojo/_base/Deferred dojo/_base/sniff".split(" "),function(J,m,H,M,D,C,B,F){function K(b){b.preventDefault()}var L={checkbox:1,radio:1,button:1},T=/\bdgrid-cell\b/,h=/\bdgrid-row\b/,e=J("dgrid.Keyboard",
null,{pageSkip:10,tabIndex:0,keyMap:null,headerKeyMap:null,postMixInProperties:function(){this.inherited(arguments);this.keyMap||(this.keyMap=M.mixin({},e.defaultKeyMap));this.headerKeyMap||(this.headerKeyMap=M.mixin({},e.defaultHeaderKeyMap))},postCreate:function(){function b(z){var G=z.target;return G.type&&(!L[G.type]||32==z.keyCode)}function r(z){function G(){v._focusedHeaderNode&&(v._focusedHeaderNode.tabIndex=-1);if(v.showHeader){if(R)for(var Y=0,aa,ba=v.headerNode.getElementsByTagName("th");aa=
ba[Y];++Y){if(Q.test(aa.className)){v._focusedHeaderNode=ca=aa;break}}else v._focusedHeaderNode=ca=v.headerNode;ca&&(ca.tabIndex=v.tabIndex)}}var R=v.cellNavigation,Q=R?T:h,O=z===v.headerNode,ca=z;O?(G(),m.after(v,"renderHeader",G,!0)):m.after(v,"renderArray",function(Y){return F.when(Y,function(aa){var ba=v._focusedNode||ca;if(Q.test(ba.className)&&B.contains(z,ba))return aa;for(var la=0,A=z.getElementsByTagName("*"),V;V=A[la];++la)if(Q.test(V.className)){ba=v._focusedNode=V;break}ba.tabIndex=v.tabIndex;
return aa})});v._listeners.push(H(z,"mousedown",function(Y){b(Y)||v._focusOnNode(Y.target,O,Y)}));v._listeners.push(H(z,"keydown",function(Y){if(!Y.metaKey&&!Y.altKey){var aa=v[O?"headerKeyMap":"keyMap"][Y.keyCode];aa&&!b(Y)&&aa.call(v,Y)}}))}this.inherited(arguments);var v=this;this.tabableHeader&&(r(this.headerNode),this._listeners.push(H(this.headerNode,"dgrid-cellfocusin",function(){v.scrollTo({x:this.scrollLeft})})));r(this.contentNode);this._debouncedEnsureScroll=B.debounce(this._ensureScroll,
this)},removeRow:function(b){if(!this._focusedNode)return this.inherited(arguments);var r=this,v=document.activeElement===this._focusedNode,z=this[this.cellNavigation?"cell":"row"](this._focusedNode),G=z.row||z,R;b=b.element||b;b===G.element&&((R=this.down(G,!0))&&R.element!==b||(R=this.up(G,!0)),this._removedFocus={active:v,rowId:G.id,columnId:z.column&&z.column.id,siblingId:R&&R.element!==b?R.id:void 0},setTimeout(function(){r._removedFocus&&r._restoreFocus(G.id)},0),this._focusedNode=null);this.inherited(arguments)},
insertRow:function(b){var r=this.inherited(arguments);this._removedFocus&&!this._removedFocus.wait&&this._restoreFocus(r);return r},_restoreFocus:function(b){var r=this._removedFocus,v;if((b=(b=b&&this.row(b))&&b.element&&b.id===r.rowId?b:"undefined"!==typeof r.siblingId&&this.row(r.siblingId))&&b.element){if(!b.element.parentNode.parentNode){r.wait=!0;return}"undefined"!==typeof r.columnId&&(v=this.cell(b,r.columnId))&&v.element&&(b=v);r.active&&0!==b.element.offsetHeight?this._focusOnNode(b,!1,
null):(C(b.element,".dgrid-focus"),b.element.tabIndex=this.tabIndex,this._focusedNode=b.element)}delete this._removedFocus},addKeyHandler:function(b,r,v){return m.after(this[v?"headerKeyMap":"keyMap"],b,r,!0)},_ensureRowScroll:function(b){var r=this.getScrollPosition().y;r>b.offsetTop?this.scrollTo({y:b.offsetTop}):r+this.contentNode.offsetHeight<b.offsetTop+b.offsetHeight&&this.scrollTo({y:b.offsetTop-this.contentNode.offsetHeight+b.offsetHeight})},_ensureColumnScroll:function(b){var r=this.getScrollPosition().x,
v=b.offsetLeft;if(r>v)this.scrollTo({x:v});else{var z=this.bodyNode.clientWidth;b=b.offsetWidth;var G=v+b;r+z<G&&this.scrollTo({x:z>b?G-z:v})}},_ensureScroll:function(b,r){this.cellNavigation&&(this.columnSets||1<this.subRows.length)&&!r&&this._ensureRowScroll(b.row.element);this.bodyNode.clientWidth<this.contentNode.offsetWidth&&this._ensureColumnScroll(b.element)},_focusOnNode:function(b,r,v){var z="_focused"+(r?"Header":"")+"Node",G=this[z],R=this.cellNavigation?"cell":"row",Q=this[R](b),O;if(b=
Q&&Q.element){if(this.cellNavigation){var ca=b.getElementsByTagName("input");var Y=0;for(O=ca.length;Y<O;Y++){var aa=ca[Y];if((-1!=aa.tabIndex||"_dgridLastValue"in aa)&&!aa.disabled){8>D("ie")&&(aa.style.position="relative");aa.focus();8>D("ie")&&(aa.style.position="");var ba=!0;break}}}null!==v&&(v=M.mixin({grid:this},v),v.type&&(v.parentType=v.type),v.bubbles||(v.bubbles=!0));G&&(C(G,"!dgrid-focus[!tabIndex]"),8>D("ie")&&(G.style.position=""),v&&(v[R]=this[R](G),H.emit(G,"dgrid-cellfocusout",v)));
G=this[z]=b;v&&(v[R]=Q);z=this.cellNavigation?T:h;!ba&&z.test(b.className)&&(8>D("ie")&&(b.style.position="relative"),b.tabIndex=this.tabIndex,b.focus());C(b,".dgrid-focus");v&&H.emit(G,"dgrid-cellfocusin",v);this._debouncedEnsureScroll(Q,r)}},focusHeader:function(b){this._focusOnNode(b||this._focusedHeaderNode,!0)},focus:function(b){(b=b||this._focusedNode)?this._focusOnNode(b,!1):this.contentNode.focus()}}),n=e.moveFocusVertical=function(b,r){if(this._focusOnNode&&b.target!==this.contentNode){var v=
this.cellNavigation,z=this[v?"cell":"row"](b);z=v&&z.column.id;r=this.down(this._focusedNode,r,!0);v&&(r=this.cell(r,z));this._focusOnNode(r,!1,b);b.preventDefault()}};J=e.moveFocusUp=function(b){n.call(this,b,-1)};var c=e.moveFocusDown=function(b){n.call(this,b,1)},k=e.moveFocusPageUp=function(b){n.call(this,b,-this.pageSkip)},a=e.moveFocusPageDown=function(b){n.call(this,b,this.pageSkip)},f=e.moveFocusHorizontal=function(b,r){if(this.cellNavigation&&b.target!==this.contentNode){var v=!this.row(b);
this._focusOnNode(this.right(this["_focused"+(v?"Header":"")+"Node"],r),v,b);b.preventDefault()}},q=e.moveFocusLeft=function(b){f.call(this,b,-1)},u=e.moveFocusRight=function(b){f.call(this,b,1)},p=e.moveHeaderFocusEnd=function(b,r){if(this.cellNavigation){var v=this.headerNode.getElementsByTagName("th");this._focusOnNode(v[r?0:v.length-1],!0,b)}b.preventDefault()},x=e.moveHeaderFocusHome=function(b){p.call(this,b,!0)},E=e.moveFocusEnd=function(b,r){var v=this,z=this.cellNavigation,G=this.contentNode,
R=G.scrollTop+(r?0:G.scrollHeight);G=G[r?"firstChild":"lastChild"];var Q=-1<G.className.indexOf("dgrid-preload"),O=Q?G[(r?"next":"previous")+"Sibling"]:G,ca=O.offsetTop+(r?0:O.offsetHeight);if(Q){for(;O&&0>O.className.indexOf("dgrid-row");)O=O[(r?"next":"previous")+"Sibling"];if(!O)return}if(!Q||1>G.offsetHeight)z&&(O=this.cell(O,this.cell(b).column.id)),this._focusOnNode(O,!1,b);else{D("dom-addeventlistener")||(b=M.mixin({},b));var Y=m.after(this,"renderArray",function(aa){Y.remove();return F.when(aa,
function(ba){ba=ba[r?0:ba.length-1];z&&(ba=v.cell(ba,v.cell(b).column.id));v._focusOnNode(ba,!1,b)})})}R===ca&&b.preventDefault()},P=e.moveFocusHome=function(b){E.call(this,b,!0)};e.defaultKeyMap={32:K,33:k,34:a,35:E,36:P,37:q,38:J,39:u,40:c};e.defaultHeaderKeyMap={32:K,35:p,36:x,37:q,39:u};return e})},"dijit/PopupMenuItem":function(){define("dojo/_base/declare dojo/dom-style dojo/_base/lang dojo/query ./popup ./registry ./MenuItem ./hccss".split(" "),function(J,m,H,M,D,C,B){return J("dijit.PopupMenuItem",
B,{baseClass:"dijitMenuItem dijitPopupMenuItem",_fillContent:function(){if(this.srcNodeRef){var F=M("*",this.srcNodeRef);this.inherited(arguments,[F[0]]);this.dropDownContainer=this.srcNodeRef}},_openPopup:function(F,K){var L=this.popup;D.open(H.delegate(F,{popup:this.popup,around:this.domNode}));K&&L.focus&&L.focus()},_closePopup:function(){D.close(this.popup);this.popup.parentMenu=null},startup:function(){if(!this._started){this.inherited(arguments);if(!this.popup){var F=M("[widgetId]",this.dropDownContainer)[0];
this.popup=C.byNode(F)}this.ownerDocumentBody.appendChild(this.popup.domNode);this.popup.domNode.setAttribute("aria-labelledby",this.containerNode.id);this.popup.startup();this.popup.domNode.style.display="none";this.arrowWrapper&&m.set(this.arrowWrapper,"visibility","");this.focusNode.setAttribute("aria-haspopup","true")}},destroyDescendants:function(F){this.popup&&(this.popup._destroyed||this.popup.destroyRecursive(F),delete this.popup);this.inherited(arguments)}})})},"dijit/Toolbar":function(){define("require dojo/_base/declare dojo/has dojo/keys dojo/ready ./_Widget ./_KeyNavContainer ./_TemplatedMixin".split(" "),
function(J,m,H,M,D,C,B,F){H("dijit-legacy-requires")&&D(0,function(){J(["dijit/ToolbarSeparator"])});return m("dijit.Toolbar",[C,F,B],{templateString:'\x3cdiv class\x3d"dijit" role\x3d"toolbar" tabIndex\x3d"${tabIndex}" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e',baseClass:"dijitToolbar",_onLeftArrow:function(){this.focusPrev()},_onRightArrow:function(){this.focusNext()}})})},"esri/tasks/RelationParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),
function(J,m,H,M,D,C,B){J=J(null,{declaredClass:"esri.tasks.RelationParameters",geometries1:null,geometries2:null,relation:null,relationParam:null,toJson:function(){var F=H.map(this.geometries1,function(h){return h.toJson()}),K=H.map(this.geometries2,function(h){return h.toJson()}),L={},T=this.geometries1;T&&0<T.length&&(L.geometries1=M.toJson({geometryType:B.getJsonType(T[0]),geometries:F}),F=this.geometries1[0].spatialReference,L.sr=F.wkid?F.wkid:M.toJson(F.toJson()));(F=this.geometries2)&&0<F.length&&
(L.geometries2=M.toJson({geometryType:B.getJsonType(F[0]),geometries:K}));this.relation&&(L.relation=this.relation);this.relationParam&&(L.relationParam=this.relationParam);return L}});m.mixin(J,{SPATIAL_REL_CROSS:"esriGeometryRelationCross",SPATIAL_REL_DISJOINT:"esriGeometryRelationDisjoint",SPATIAL_REL_IN:"esriGeometryRelationIn",SPATIAL_REL_INTERIORINTERSECTION:"esriGeometryRelationInteriorIntersection",SPATIAL_REL_INTERSECTION:"esriGeometryRelationIntersection",SPATIAL_REL_COINCIDENCE:"esriGeometryRelationLineCoincidence",
SPATIAL_REL_LINETOUCH:"esriGeometryRelationLineTouch",SPATIAL_REL_OVERLAP:"esriGeometryRelationOverlap",SPATIAL_REL_POINTTOUCH:"esriGeometryRelationPointTouch",SPATIAL_REL_TOUCH:"esriGeometryRelationTouch",SPATIAL_REL_WITHIN:"esriGeometryRelationWithin",SPATIAL_REL_RELATION:"esriGeometryRelationRelation"});D("extend-esri")&&m.setObject("tasks.RelationParameters",J,C);return J})},"widgets/AttributeTable/utils":function(){define("dojo/_base/lang dojo/_base/array jimu/LayerInfos/LayerInfos dojo/Deferred dojo/promise/all exports dojo/store/Observable dojo/store/Cache dojo/store/Memory esri/lang ./table/FeatureLayerQueryStore jimu/ArcadeUtils jimu/utils esri/graphic dojo/i18n!./nls/strings".split(" "),
function(J,m,H,M,D,C,B,F,K,L,T,h,e,n,c){function k(a,f){if(!a||!a.length)return f||[];if(!f||!f.length)return a;for(var q=[],u=0,p=a.length;u<p;u++)for(var x=a[u],E=0,P=f.length;E<P;E++){var b=f[E];if(b.name===x.name){b.alias!==x.alias&&(x.alias=b.alias);q.push(x);break}}return q}C.readLayerInfosObj=function(a){return H.getInstance(a,a.itemInfo)};C.readLayerInfosFromMap=function(a,f,q){var u=new M;H.getInstance(a,a.itemInfo).then(J.hitch(this,function(p){var x=[];f?p.traversalLayerInfosOfWebmap(function(b){x.push(b)}):
p.traversal(function(b){x.push(b)});if(q){var E=[],P=p.getMapNotesLayerInfoArray();m.forEach(P,function(b){E.push(b.id);b.traversal(function(r){E.push(r.id)})});x=m.filter(x,function(b){return-1===E.indexOf(b.id)})}p=p.getTableInfoArray();x=x.concat(p);u.resolve(x)}),J.hitch(this,function(p){console.error(p);u.reject(p)}));return u.promise};C.generateColumnsFromFields=function(a,f,q,u,p,x,E,P){function b(z){var G=z.name;if(r&&L.isDefined(r.fieldInfos))for(var R=0,Q=r.fieldInfos.length;R<Q;R++){var O=
r.fieldInfos[R];if(O.fieldName===G&&O.format)return O.format}return(z=e.getDefaultPortalFieldInfo(z))&&z.format?z.format:null}var r=f.getPopupInfo()||f.getPopupInfoFromLayerObject&&f.getPopupInfoFromLayerObject(),v={selectionHandle:{label:"",className:"selection-handle-column",hidden:!1,unhidable:!0,field:null,sortable:!1,_cache:{sortable:!1,statistics:!1},renderCell:function(z,G,R){R.setAttribute("role","button");R.setAttribute("title",c.selectionHandleLabel)}}};m.forEach(q,J.hitch(C,function(z,
G,R){G="field"+G;var Q=!!z.domain,O="esriFieldTypeDate"===z.type,ca=u&&z.name===u,Y="esriFieldTypeDouble"===z.type||"esriFieldTypeSingle"===z.type||"esriFieldTypeInteger"===z.type||"esriFieldTypeSmallInteger"===z.type,aa="esriFieldTypeString"===z.type,ba=0===z.name.indexOf("expression/"),la=z.alias||z.name;var A=1===R.length?!1:a&&a[G]?a[G].hidden:z?!z.show&&L.isDefined(z.show):!1;v[G]={label:la,className:G,hidden:A,unhidable:1===R.length?!1:!z.show&&L.isDefined(z.show)&&z._pk,field:z.name,sortable:!1,
_cache:{sortable:!!x,statistics:E&&!Q&&Y}};aa?v[G].formatter=J.hitch(C,C.urlFormatter):O?v[G].formatter=J.hitch(C,C.dateFormatter,b(z)):Y&&(v[G].formatter=J.hitch(C,C.numberFormatter,b(z)));Q?v[G].get="range"===(z.domain&&z.domain.type)?J.hitch(C,function(V,ea,U){return this.getRangeDomainValue(ea.name,U)},P,z):J.hitch(C,function(V,ea,U){return this.getCodeValue(V,ea.name,U)},P,z):ca?v[G].get=J.hitch(C,function(V,ea,U){return this.getTypeName(U[V.name],ea)},z,p):ba?(R=this.arcade.getExpressionInfosFromLayerInfo(f),
Q=e.getFeatureLayerDefinition(P),v[G]._cache.sortable=!1,v[G].get=J.hitch(C,function(V,ea,U,da){return this.arcade.getAttributes(da,V,U)[ea.name]||""},R,z,Q)):Q||O||ca||ba||(v[G].get=J.hitch(C,function(V,ea,U,da,na){var oa=null;U&&da&&0<da.length&&(da=(da=m.filter(da,J.hitch(C,function(qa){return qa.id===na[U]})))&&da[0]||null)&&da.domains&&da.domains[ea.name]&&da.domains[ea.name].codedValues&&(oa=this.getCodeValue(V,ea.name,na));return(V=null!==oa?oa:na[ea.name])||isFinite(V)?V:""},P,z,u,p))}));
return v};C.getTypeName=function(a,f){return e.fieldFormatter.getTypeName(a,f)};C.getCodeValue=function(a,f,q){return(a=e.getDisplayValueForCodedValueOrSubtype(a,f,q))&&a.isCodedValueOrSubtype?a.displayValue||"":""};C.getRangeDomainValue=function(a,f){return(a=f[a])?a:""};C.urlFormatter=function(a){return e.fieldFormatter.getFormattedUrl(a)};C.dateFormatter=function(a,f){return e.fieldFormatter.getFormattedDate(f,a)};C.numberFormatter=function(a,f){return e.fieldFormatter.getFormattedNumber(f,a)};
C.readLayerObjectsFromMap=function(a,f,q){var u=new M,p=[];this.readLayerInfosFromMap(a,f,q).then(J.hitch(this,function(x){m.forEach(x,J.hitch(this,function(E){p.push(E.getLayerObject())}));D(p).then(J.hitch(this,function(E){u.resolve(E)}),J.hitch(this,function(E){u.reject(E);console.error(E)}))}),J.hitch(this,function(x){u.reject(x)}));return u.promise};C.readSupportTableInfoFromLayerInfos=function(a){var f=new M,q=[];m.forEach(a,J.hitch(this,function(u){q.push(u.getSupportTableInfo())}));D(q).then(J.hitch(this,
function(u){u=J.clone(u);m.forEach(u,function(p,x){p.id=a[x].id});f.resolve(u)}),function(u){f.reject(u)});return f.promise};C.readConfigLayerInfosFromMap=function(a,f,q){var u=new M,p=[];this.readLayerInfosFromMap(a,f,q).then(J.hitch(this,function(x){var E=[];m.forEach(x,function(P){p.push(P.getSupportTableInfo())});D(p).then(J.hitch(this,function(P){m.forEach(P,J.hitch(this,function(b,r){b.isSupportedLayer&&(x[r].name=x[r].title,E.push(x[r]))}));u.resolve(E)}),J.hitch(this,function(P){u.reject(P)}))}),
J.hitch(this,function(x){u.reject(x)}));return u.promise};C.getConfigInfosFromLayerInfos=function(a){return m.map(a,function(f){return C.getConfigInfoFromLayerInfo(f)})};C.getConfigInfoFromLayerInfo=function(a){var f={};f.name=a.name||a.title;f.id=a.id;f.show=a.isShowInMap();f.layer={url:a.getUrl()};var q=a.getPopupInfo();q&&!q.description&&(f.layer.fields=m.map(q.fieldInfos,function(u){return{name:u.fieldName,alias:u.label,show:u.visible,format:u.format}}),a=J.getObject("layerObject.fields",!1,a),
f.layer.fields=k(f.layer.fields,a),m.some(f.layer.fields,function(u){return u.show})||(f.layer.fields&&0<f.layer.fields.length?f.layer.fields[0].show=!0:console.warn("We do not get fields info.")));return f};C.generateCacheStore=function(a,f,q,u,p){a=new T({layer:a,objectIds:a._objectIds||null,totalCount:f,batchCount:q,where:u||"1\x3d1",spatialFilter:p});f=new K;return new F(a,f,{})};C.generateMemoryStore=function(a,f){return new B(new K({data:a||[],idProperty:f}))};C.merge=function(a,f,q,u){for(var p=
m.map(f,function(b){return b[q]}),x=0,E=a.length;x<E;x++){var P=p.indexOf(a[x][q]);-1<P&&u(a[x],f[P])}};C.syncOrderWith=function(a,f,q){function u(r,v){return m.map(r,function(z){return z[v]})}if(!J.isArray(f)||!q)return a;for(var p=u(a,q),x=[],E=0,P=f.length;E<P;E++){var b=p.indexOf(f[E][q]);-1<b&&(x=x.concat(a.splice(b,1)),p=u(a,q))}return x.concat(a)};C.arcade={};C.arcade.getExpressionInfosFromLayer=function(a,f){a=h.readExprInfo.getArcadeProfilesByType(a,f,"infoTemplate");return 0<a.length&&a[0].expressionInfos?
a[0].expressionInfos:[]};C.arcade.getExpressionInfosFromLayerInfo=function(a){return(a=a&&a.getPopupInfo())&&a.expressionInfos||[]};C.arcade.getAttributes=function(a,f,q){var u=new n(a.geometry,null,a);return h.customExpr.getAttributesFromCustomArcadeExpr(f,u,q)||a};C.arcade.appendArcadeExpressionsToFields=function(a,f){if(a){f=C.arcade.getExpressionInfosFromLayerInfo(f);if(0<f.length){var q=/^expression\//;m.forEach(f,function(u){m.some(a,function(p){if(q.test(p.name))return p=p.name.substr(11),
u.name===p})||a.push({name:"expression/"+u.name,alias:u.title,show:!0})})}return a}};C.arcade.isArcadeExpressionField=function(a){return a&&"string"===typeof a.name&&0===a.name.indexOf("expression/")};C.arcade.parseArcadeExpressions=function(a){return h.InfoTemplate._parseArcadeExpressions(a)};C.getSortbyFields=function(a,f){a=a&&a.get("sort")||[];f=f&&f.objectIdField;0<a.length?a=m.map(a,function(q){return q.attribute+" "+(q.descending?"DESC":"ASC")}):f&&a.push(f+" ASC");return a}})},"dojo/store/Cache":function(){define(["../_base/lang",
"../when"],function(J,m){var H=function(M,D,C){C=C||{};return J.delegate(M,{query:function(B,F){B=M.query(B,F);B.forEach(function(K){C.isLoaded&&!C.isLoaded(K)||D.put(K)});return B},queryEngine:M.queryEngine||D.queryEngine,get:function(B,F){return m(D.get(B),function(K){return K||m(M.get(B,F),function(L){L&&D.put(L,{id:B});return L})})},add:function(B,F){return m(M.add(B,F),function(K){D.add(K&&"object"==typeof K?K:B,F);return K})},put:function(B,F){D.remove(F&&F.id||this.getIdentity(B));return m(M.put(B,
F),function(K){D.put(K&&"object"==typeof K?K:B,F);return K})},remove:function(B,F){return m(M.remove(B,F),function(K){return D.remove(B,F)})},evict:function(B){return D.remove(B)}})};J.setObject("dojo.store.Cache",H);return H})},"widgets/AttributeTable/table/FeatureLayerQueryStore":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array esri/tasks/query esri/tasks/QueryTask ./FeatureLayerQueryResult".split(" "),function(J,m,H,M,D,C){return J(null,{queryUrl:"",idProperty:"id",data:null,
_entityData:null,constructor:function(B){J.safeMixin(this,B);this.data=[];this._entityData=[];this.layer=B.layer;this.objectIds=B.objectIds;this.where=B.where;this.orderByFields=B.orderByFields;this.totalCount=B.totalCount;this.batchCount=B.batchCount||25;this.idProperty=this.layer.objectIdField;this.spatialFilter=B.spatialFilter;this.layer&&this.layer.url&&(this.queryTask=new D(this.layer.url))},get:function(B){return this.data[B]},getIdentity:function(B){return B[this.idProperty]},query:function(B,
F){var K=new M,L=F&&F.start||0,T=F._export_count||this.batchCount,h=null;"function"===typeof B?h=B(this._entityData):"[object Array]"===Object.prototype.toString.call(B)&&(h=B);this.objectIds?(h=h?h:this.objectIds,K.objectIds=h.length>=L+this.batchCount?h.slice(L,L+T):h.slice(L)):(h&&0<h.length?K.objectIds=h.length>=L+this.batchCount?h.slice(L,L+T):h.slice(L):(K.start=L,K.num=T,K.where=this.where,K.geometry=this.spatialFilter,K.spatialRelationship=M.SPATIAL_REL_INTERSECTS),(B=F.sort)&&0<B.length&&
(B=H.map(B,function(n){return n.attribute+" "+(n.descending?"DESC":"ASC")}),K.orderByFields=B));K.returnGeometry="esriGeometryPoint"===this.layer.geometryType;K.outFields=["*"];var e=this.totalCount;B=null;B=!K.where;if(!(K.objectIds&&0<K.objectIds.length)&&B)return new C([]);B=this.queryTask?this.queryTask.execute(K):this.layer.queryFeatures(K);B.total=B.then(m.hitch(this,function(n){var c=0,k=this.layer.objectIdField;if(this.objectIds){if(!k)for(c=0;c<n.fields.length;c++)if("esriFieldTypeOID"===
n.fields[c].type){k=n.fields[c].name;break}var a={};for(c=0;c<n.features.length;c++)a[n.features[c].attributes[k]]=n.features[c];n.features=H.map(K.objectIds,function(q){return a[q]})}for(c=0;c<n.features.length;c++)if(n.features[c]){var f=n.features[c];n.features[c]=m.mixin(m.clone(f.attributes),{geometry:f.geometry});this.data[n.features[c][k]]=n.features[c];this._entityData.push(n.features[c])}n=n.features;return e}),function(){console.log("FeatureLayerQueryStore queryFeatures failed.");return 0});
return new C(B)}})})},"widgets/AttributeTable/table/FeatureLayerQueryResult":function(){define("esri/main dojo/_base/lang dojo/_base/kernel dojo/_base/Deferred dojo/DeferredList dojo/_base/array".split(" "),function(J,m,H,M){var D=function(C){function B(F){C[F]||(C[F]=function(){var K=arguments;return M.when(C,function(L){Array.prototype.unshift.call(K,L.features||L);return D(H[F].apply(H,K))})})}if(!C)return C;C.then&&(C=m.delegate(C));C.total||(C.total=M.when(C,function(F){return J._isDefined(F.total)?
F.total:F.length||0}));B("forEach");B("filter");B("map");B("some");B("every");return C};return D})},"widgets/AttributeTable/a11y/WidgetMixin":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/html dojo/on dojo/aspect dojo/keys dijit/focus dojo/topic dojo/string jimu/utils jimu/LayoutManager".split(" "),function(J,m,H,M,D,C,B,F,K,L,T,h){return J(null,{_layoutManager:null,_focusedTab:null,focusToDisplay:!1,hasBeenActivated:!1,postCreate:function(){this.inherited(arguments);
this._layoutManager=h.getInstance();this.focusToDisplay=!0;this.hasBeenActivated=this.config.initiallyExpand;this.own(D(this.domNode,"keydown",H.hitch(this,function(e){M.hasClass(e.target,this.baseClass)&&e.keyCode===B.ENTER&&(this.focusToDisplay=!1,this.hasBeenActivated=!0,this.showing||(this.widgetManager.activateWidget(this),this._switchTable()))})));this.own(D(this.domNode,"focus",H.hitch(this,function(){T.isInNavMode()&&this.focusToDisplay&&!this.showing&&(this.widgetManager.activateWidget(this),
this._switchTable())})));this.own(D(this.domNode,"blur",H.hitch(this,function(){T.isInNavMode()&&this.focusToDisplay&&this.showing&&(this.hasBeenActivated||this._switchTable());this.focusToDisplay=!0;this.showing||(this.hasBeenActivated=!1)})));this.own(K.subscribe(this.id+"_table_created",H.hitch(this,function(e){this._applyA11y2Grid(e&&e.grid,e&&e.context)})),K.subscribe(this.id+"_toolbar_created",H.hitch(this,function(e){this._applyA11y2Toolbar(e&&e.toolbar,e&&e.context)})))},applyA11y:function(){this._isOnlyTable()&&
M.removeAttr(this.domNode,"tabindex");this.switchBtn&&this.own(D(this.switchBtn,"keydown",H.hitch(this,function(e){e.keyCode===B.ENTER&&(this._switchTable(),this.focusToDisplay=this.showing,this.__focus2WidgetNode())})));this.tabContainer&&this.tabContainer.hasChildren()?this._applyA11y2TabContainer(this.tabContainer):this.NoTableMessageDiv&&(M.setAttr(this.NoTableMessageDiv,{tabindex:"0"}),T.initFirstFocusNode(this.domNode,this.NoTableMessageDiv),T.initLastFocusNode(this.domNode,this.NoTableMessageDiv),
this.own(D(this.NoTableMessageDiv,"keydown",H.hitch(this,function(e){e.keyCode===B.ESCAPE&&this.__escape2WidgetSwitch(e)}))),this._isOnlyTable()&&F.focus(this.NoTableMessageDiv))},_applyA11y2TabContainer:function(e){if(e){var n=this,c=function(f){f&&(m.forEach(e.tablist.getChildren(),function(q){!q.active&&q.closeButton&&q.id!==f.id&&M.setAttr(q.closeNode,"tabindex",-1)}),M.setAttr(f.closeNode,"tabindex",0))},k=e.tablist.onkeydown;e.tablist.onkeydown=function(f,q){var u=null,p=!1;switch(f.keyCode){case B.LEFT_ARROW:case B.UP_ARROW:f._djpage||
(u=!1);break;case B.PAGE_UP:f.ctrlKey&&(u=!1);break;case B.RIGHT_ARROW:case B.DOWN_ARROW:f._djpage||(u=!0);break;case B.PAGE_DOWN:f.ctrlKey&&(u=!0);break;case B.HOME:for(var x=this.getChildren(),E=0;E<x.length;E++){var P=x[E];if(!P.disabled){F.focus(P.focusNode);n._focusedTab=P;break}}f.stopPropagation();f.preventDefault();break;case B.END:x=this.getChildren();for(E=x.length-1;0<=E;E--)if(P=x[E],!P.disabled){F.focus(P.focusNode);n._focusedTab=P;break}f.stopPropagation();f.preventDefault();break;case B.DELETE:case 87:this._currentChild.closable&&
(f.keyCode==B.DELETE||f.ctrlKey)&&(f.stopPropagation(),f.preventDefault());break;case B.ENTER:case B.SPACE:n.tabForwardStep=0;break;case B.ESCAPE:"Close"===f.target.title?n._focusedTab&&F.focus(n._focusedTab.focusNode):n.__escape2WidgetSwitch(f);f.stopPropagation();f.preventDefault();break;case B.TAB:if(n.isLoading()){f.stopPropagation();f.preventDefault();return}break;default:p=!0}if(null!==u){this.isLeftToRight()||this.tabPosition&&!/top|bottom/.test(this.tabPosition)||(u=!u);x=this.getChildren();
E=m.indexOf(x,this.pane2button(n._focusedTab?n._focusedTab.page&&n._focusedTab.page.id:this._currentChild.id));P=x[E];do{E=(E+(u?1:x.length-1))%x.length;var b=x[E]}while(b.disabled&&b!==P);n._focusedTab=b;F.focus(n._focusedTab.focusNode);f.stopPropagation();f.preventDefault()}p&&k.apply(this,arguments)};if(e.hasChildren()){m.forEach(e.getChildren(),H.hitch(this,function(f){f.controlButton.checked||M.setAttr(f.controlButton.focusNode,"aria-selected","false");f.closable&&M.setAttr(f.controlButton.closeNode,
"role","button")}));var a=e.tablist.getChildren()[0];this._focusedTab=a;T.initFirstFocusNode(this.domNode,a.focusNode);a.closeNode&&c(a);!this._isOnlyTable()||"LaunchpadTheme"!==this.appConfig.theme.name&&"BillboardTheme"!==this.appConfig.theme.name||F.focus(a.focusNode)}this.own(C.after(e,"selectChild",function(){var f=H.getObject("controlButton",!1,this.selectedChildWidget);f&&(T.initFirstFocusNode(n.domNode,f.focusNode),f.closeNode&&c(f));n._focusedTab=f}),D(e.tablist,"blur",H.hitch(this,function(){this._focusedTab=
null})))}},_applyA11y2Toolbar:function(e,n){e&&(H.mixin(e,{_onLeftArrow:function(){},_onRightArrow:function(){}}),this.own(D(e,"keydown",H.hitch(this,function(c){if(c.keyCode===B.TAB){if(c.shiftKey){if(c.target.id===e._getFirstFocusableChild().id)return}else if(c.target.id===e._getLastFocusableChild().id)return;c.shiftKey?e.focusPrev():e.focusNext();c.stopPropagation();c.preventDefault()}else c.keyCode===B.ESCAPE&&this.__escape2ActiveTab(c)}))),n&&n.toggleColumnsMenuItem&&this.own(D(n.toggleColumnsMenuItem,
"click",H.hitch(this,function(c){T.isInNavMode()&&this.__applyA11y2GridHiderMenu(this._activeTable&&this._activeTable.grid)}))))},_applyA11y2Grid:function(e,n){if(e&&e.hiderToggleNode&&e.hiderMenuNode){var c=e.hiderToggleNode,k=e.hiderMenuNode;T.initLastFocusNode(this.domNode,c);if(!e._customEvtHandlersInitialized){var a=n.id+"_ScreenReader_Node",f=M.create("div",{"class":"sr-only","aria-live":"assertive",id:a},n.footer,"after");this.own(D(n,"row-click",function(q){T.isInNavMode()&&(f.textContent=
q.selectedIds.length+" "+this.nls.selected)}),D(n,"clear-selection",function(){T.isInNavMode()&&(f.textContent="")}),D(e,"keydown",H.hitch(this,function(q){T.isInNavMode()&&q.keyCode===B.ESCAPE&&(f.textContent="",this.__escape2ActiveTab(q))})),F.watch("curNode",H.hitch(this,function(q,u,p){T.isInNavMode()&&p&&p.classList&&p.classList.contains("dgrid-column-selectionHandle")&&(q=-1,e.selection&&0===Object.keys(e.selection).length&&(q=this.__IndexOfGridRowHandle(p,e),-1<q&&(f.textContent="Row "+q+", Selection Handle.",
p.setAttribute("aria-labelledby",a))))})),D(e,"dgrid-select",H.hitch(this,function(q){q=F.curNode;if(T.isInNavMode()&&q&&q.classList&&q.classList.contains("dgrid-column-selectionHandle")){var u=(e.selection&&Object.keys(e.selection)).length,p=-1;0<u&&q&&(p=this.__IndexOfGridRowHandle(q,e),-1<p&&(f.textContent=1===u?L.substitute(this.nls.rowHeaderColumnTitle,{rowId:p}):L.substitute(this.nls.rowHeaderColumnTitleMultiple,{rowId:p,rowCount:u}),q.setAttribute("aria-labelledby",a)))}})),D(c,"keydown",H.hitch(this,
function(q){if(q.keyCode===B.SPACE||q.keyCode===B.ENTER)e._toggleColumnHiderMenu(),this.__applyA11y2GridHiderMenu(e),q.stopPropagation(),q.preventDefault()})),D(k,"keydown",H.hitch(this,function(q){q.keyCode===B.ESCAPE&&(c.focus(),e._hiderMenuOpened&&e._toggleColumnHiderMenu(q),q.stopPropagation(),q.preventDefault())})),D(e,".dgrid-header .dgrid-cell:keydown",H.hitch(this,function(q){q.keyCode===B.ENTER&&this._activeTable&&this._activeTable._onHeaderClick(q)})));e._customEvtHandlersInitialized=!0}this._focusedTab&&
this._focusedTab.checked&&n&&M.setAttr(this._focusedTab.focusNode,"aria-labelledby",this._focusedTab.focusNode.id+" "+this.id+"_"+n.id+"_footer")}},__escape2WidgetSwitch:function(e){this.switchBtn?this.switchBtn.focus():T.isDomFocusable(this.domNode)?this.__focus2WidgetNode():this._controllerDiv&&this._controllerDiv.focus();if(this.closeable&&this._isOnlyTable()&&this.widgetManager){var n;m.some(this._layoutManager&&this._layoutManager.layoutManager&&this._layoutManager.layoutManager.onScreenWidgetIcons,
H.hitch(this,function(c){if(c&&c.widgetConfig&&c.widgetConfig.id===this.id)return n=c,!0}));n?n.domNode.focus():this.widgetManager.closeWidget(this)}e&&(e.stopPropagation(),e.preventDefault())},__focus2WidgetNode:function(){this.domNode.focus()},__escape2ActiveTab:function(e){T.focusFirstFocusNode(this.domNode);e&&(e.stopPropagation(),e.preventDefault())},__applyA11y2GridHiderMenu:function(e){if(e&&e._hiderMenuOpened&&(e=e.hiderMenuNode,e.children&&0<e.children.length)){var n=e.children[0],c=e.children[e.children.length-
1],k=n.querySelector("input");T.initFirstFocusNode(e,n.querySelector("input"));T.initLastFocusNode(e,c.querySelector("input"));k&&k.focus()}},__focusOnActiveTab:function(){setTimeout(H.hitch(this,function(){T.focusFirstFocusNode(this.domNode)}),600)},__IndexOfGridRowHandle:function(e,n){var c;n=n.domNode.querySelectorAll(".dgrid-column-selectionHandle");m.some(n,function(k,a){if(k.isEqualNode(e))return console.log(a),c=a,!0});return c}})})},"widgets/AttributeTable/_build-generate_module":function(){define(["dojo/text!./css/style.css",
"dojo/i18n!./nls/strings"],function(){})},"url:dijit/layout/templates/TabContainer.html":'\x3cdiv class\x3d"dijitTabContainer"\x3e\r\n\t\x3cdiv class\x3d"dijitTabListWrapper" data-dojo-attach-point\x3d"tablistNode"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"tablistSpacer" class\x3d"dijitTabSpacer ${baseClass}-spacer"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"dijitTabPaneWrapper ${baseClass}-container" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\r\n\x3c/div\x3e\r\n',"url:dijit/layout/templates/_TabButton.html":'\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"titleNode,innerDiv,tabContent" class\x3d"dijitTabInner dijitTabContent"\x3e\r\n\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitTabButtonIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3cspan data-dojo-attach-point\x3d\'containerNode,focusNode\' class\x3d\'tabLabel\'\x3e\x3c/span\x3e\r\n\t\x3cspan class\x3d"dijitInline dijitTabCloseButton dijitTabCloseIcon" data-dojo-attach-point\x3d\'closeNode\'\r\n\t\t  role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d\'closeText\' class\x3d\'dijitTabCloseText\'\x3e[x]\x3c/span\r\n\t\t\t\t\x3e\x3c/span\x3e\r\n\x3c/div\x3e\r\n',
"url:dijit/layout/templates/ScrollingTabController.html":'\x3cdiv class\x3d"dijitTabListContainer-${tabPosition}" style\x3d"visibility:hidden"\x3e\r\n\t\x3cdiv data-dojo-type\x3d"dijit.layout._ScrollingTabControllerMenuButton"\r\n\t\t class\x3d"tabStripButton-${tabPosition}"\r\n\t\t id\x3d"${id}_menuBtn"\r\n\t\t data-dojo-props\x3d"containerId: \'${containerId}\', iconClass: \'dijitTabStripMenuIcon\',\r\n\t\t\t\t\tdropDownPosition: [\'below-alt\', \'above-alt\']"\r\n\t\t data-dojo-attach-point\x3d"_menuBtn" showLabel\x3d"false" title\x3d""\x3e\x26#9660;\x3c/div\x3e\r\n\t\x3cdiv data-dojo-type\x3d"dijit.layout._ScrollingTabControllerButton"\r\n\t\t class\x3d"tabStripButton-${tabPosition}"\r\n\t\t id\x3d"${id}_leftBtn"\r\n\t\t data-dojo-props\x3d"iconClass:\'dijitTabStripSlideLeftIcon\', showLabel:false, title:\'\'"\r\n\t\t data-dojo-attach-point\x3d"_leftBtn" data-dojo-attach-event\x3d"onClick: doSlideLeft"\x3e\x26#9664;\x3c/div\x3e\r\n\t\x3cdiv data-dojo-type\x3d"dijit.layout._ScrollingTabControllerButton"\r\n\t\t class\x3d"tabStripButton-${tabPosition}"\r\n\t\t id\x3d"${id}_rightBtn"\r\n\t\t data-dojo-props\x3d"iconClass:\'dijitTabStripSlideRightIcon\', showLabel:false, title:\'\'"\r\n\t\t data-dojo-attach-point\x3d"_rightBtn" data-dojo-attach-event\x3d"onClick: doSlideRight"\x3e\x26#9654;\x3c/div\x3e\r\n\t\x3cdiv class\x3d\'dijitTabListWrapper\' data-dojo-attach-point\x3d\'tablistWrapper\'\x3e\r\n\t\t\x3cdiv role\x3d\'tablist\' data-dojo-attach-event\x3d\'onkeydown:onkeydown\'\r\n\t\t\t data-dojo-attach-point\x3d\'containerNode\' class\x3d\'nowrapTabStrip\'\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/layout/templates/_ScrollingTabControllerButton.html":'\x3cdiv data-dojo-attach-event\x3d"ondijitclick:_onClick" class\x3d"dijitTabInnerDiv dijitTabContent dijitButtonContents"  data-dojo-attach-point\x3d"focusNode" role\x3d"button"\x3e\r\n\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitTabStripIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3cspan data-dojo-attach-point\x3d"containerNode,titleNode" class\x3d"dijitButtonText"\x3e\x3c/span\x3e\r\n\x3c/div\x3e',
"url:widgets/AttributeTable/css/style.css":'.jimu-widget-attributetable-main .tabStripButton{height: 24px !important;}.jimu-widget-attributetable,.jimu-widget-attributetable-main{left: 0px; right: 0px; bottom: 0px; background-color: #efefef;}.jimu-widget-attributetable{height: auto;}.jimu-widget-attributetable-main{overflow: hidden; width: 100%; height: 100%;}.jimu-widget-attributetable .jimu-widget-attributetable-main .dijitToolbar {position: relative;}.jimu-widget-attributetable-move{width: 100%; height: 7px; top: 0px; background-color: rgba(0, 0, 0, 0.7);}.jimu-widget-attributetable-move:hover{cursor: n-resize;}.jimu-widget-attributetable-move:hover .jimu-widget-attributetable-thumb{background-color: #fff;}.jimu-widget-attributetable .draging{background-color: gray;}.jimu-widget-attributetable-thumb{background: #B0B0B0 none; height: 1px; width: 19px; margin: 3px auto; position: absolute; left: 0; right: 0;}.jimu-widget-attributetable-indicate-vertical{width: 2px; height: 100%; background-color: black; position: absolute; z-index: 1; opacity: 0;}.jimu-widget-attributetable-indicate-horizontal{width: 100%; height: 2px; background-color: black; position: absolute; z-index: 1; opacity: 0;}.jimu-widget-attributetable-switch{width: 63px; height: 17px; left: 0; right: 0; top: -17px; margin: auto; position: absolute; cursor: pointer; border-radius: 8px 8px 0 0; background-position: center; background-repeat: no-repeat; background-color: rgba(0,0,0,0.7); border: 2px solid rgba(255,255,255,0.8); border-bottom-style: none;}.jimu-widget-attributetable-switch.open{background-image: url(images/arrow_down.svg); border-bottom-left-radius: 0; border-bottom-right-radius: 0;}.jimu-widget-attributetable-switch.open:hover{background-image: url(images/arrow_down_hover.svg);}.jimu-widget-attributetable-switch.close{background-image: url(images/arrow_up.svg)}.jimu-widget-attributetable-switch.close:hover{background-image: url(images/arrow_up_hover.svg);}.jimu-widget-attributetable-arrowImage{width: 30px; height: 30px; left: 48%; top: -30px; position: absolute; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; background-position: center center; background-repeat: no-repeat; cursor: ns-resize; background-color: rgba(0, 0, 0, 0.8);}.dijitTabPaneWrapper .dijitTabContainerTop-container .dijitAlignCenter{height: 100%;}.jimu-widget-attributetable .dijitTabContainerTopChildWrapper,.jimu-widget-attributetable .dijitTabContainerTopChildWrapper .dijitContentPane{height: 100% !important; width: 100% !important; padding: 0;}.jimu-widget-attributetable .dijitToggleButton.dijitToggleButtonChecked .dijitButtonText{color: #518dca;}.jimu-widget-attributetable .esriAttributeTable{width: 100%; height: 100%; position: relative;}.jimu-widget-attributetable .dgrid-header .dgrid-column-selectionHandle.selection-handle-column div.dgrid-resize-header-container{display: none;}.jimu-widget-attributetable .dgrid-column-selectionHandle.selection-handle-column{width: 20px !important; background-color: #eee; padding: 0 !important; border-bottom: 1px solid #ccc !important; cursor: pointer;}.dojoDndSource.dojoDndTarget.dojoDndHorizontal.dojoDndContainer .dgrid-column-selectionHandle.selection-handle-column{pointer-events: none;}.jimu-widget-attributetable .dgrid-cell {border-right: solid 1px #ccc; width: 100px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table.auto-width .dgrid-cell{width: auto;}.jimu-widget-attributetable .dgrid-row .dgrid-cell {border:medium none; padding: 7px 3px; border-right: 1px solid #CCCCCC;}.jimu-rtl .jimu-widget-attributetable .dgrid-rtl-swap .dgrid-header-row {right: 0; left: 17px;}.has-webkit.jimu-rtl .jimu-widget-attributetable .dgrid-rtl-swap .dgrid-header-row {left: 6px;}.dj_edge.jimu-rtl .jimu-widget-attributetable .dgrid-header-row {left: 16px; right: 0;}.dj_edge.jimu-rtl .dgrid-header-scroll,.dj_edge.jimu-rtl .dgrid-hider-toggle {right: auto; left: 0;}.dj_edge.jimu-rtl .dgrid-hider-menu {left: 17px; right: auto;}.jimu-rtl .jimu-widget-attributetable .dgrid-cell {text-align: right; border-left: solid 1px #ccc;}.jimu-widget-attributetable .dgrid-header {overflow: hidden; background-color: #eee;}.jimu-widget-attributetable .dgrid-header.dgrid-scrollbar-width {min-width: 16px;}.jimu-widget-attributetable .dgrid-hider-toggle {z-index: 10000;}.jimu-widget-attributetable .dgrid-header .dgrid-cell:last-child {border-right-color: transparent;}.jimu-widget-attributetable .dgrid-header .dgrid-cell:last-child .dgrid-resize-handle {display: none;}.jimu-rtl .jimu-widget-attributetable .dgrid-header .dgrid-cell:last-child {border-left-color: transparent;}.jimu-widget-attributetable .dgrid-cell a{color: #21759B; text-decoration: none;}.jimu-widget-attributetable .dgrid-cell a:hover, a:active{text-decoration: underline;}.jimu-widget-attributetable .dgrid-row {border: medium none;}.jimu-widget-attributetable .dgrid-row:hover {background-color:#E1F0FB;}.jimu-widget-attributetable .dgrid-row-even{background-color: #FFF;}.jimu-widget-attributetable .dgrid-row-odd {background-color: #F7F8F8;}.jimu-widget-attributetable .ui-state-active {background-color: rgb(0, 255, 255) !important;}.jimu-widget-attributetable .dgrid-status {white-space: pre;}.jimu-widget-attributetable .self-footer {display: inline-block;}.jimu-rtl .dgrid-hider-menu-check{right: 2px; left: auto;}.jimu-rtl .dgrid-hider-menu-label {padding-left: 0; padding-right: 20px;}.jimu-rtl .jimu-widget-attributetable .dgrid-pagination .dgrid-status{float: right !important;}.jimu-rtl .dgrid-pagination .dgrid-navigation,.jimu-rtl .dgrid-pagination .dgrid-page-size{float: left !important;}.esriAttributeTableExportImage{background-image: url("../images/export.png"); width: 13px; height: 13px;}.esriAttributeTableZoomImage{background-image: url("../images/zoom.png"); width: 13px; height: 13px;}.esriAttributeTableSelectAllImage{background-image: url("../images/select.png"); width: 13px; height: 13px;}.esriAttributeTableFilterImage{background-image: url("../images/filter.png"); width: 13px; height: 13px;}.esriAttributeTableSelectPageImage{background-image: url("../images/page.png"); width: 13px; height: 13px;}.esriAttributeTableClearImage{background-image: url("../images/clear.png"); width: 13px; height: 13px;}.esriAttributeTableOptionsImage{background-image: url("../images/more.png"); width: 13px; height: 13px;}.esriAttributeTableRefreshImage{background-image: url("../images/refresh.png"); width: 13px; height: 13px;}.esriAttributeTableSymbolImage{background-image: url("../images/symbol.png"); width: 13px; height: 13px;}.esriAttributeTableCloseImage{background-image: url("../images/close.png"); width: 13px; height: 13px; position: absolute; right: 0; top: -13px;}.esriAttributeTableColumnsImage{background-image: url("../images/columns.png"); width: 13px; height: 13px;}.jimu-rtl .jimu-widget-attributetable .close-button {right: auto; left: 0;}.jimu-widget-attributetable .jimu-loading-indicator {z-index: 100;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table{height: 100%; position: relative;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column{overflow: visible; text-align: center;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos{text-align: center; display: inline-block; position: relative;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .show-attachments-div{display: inline-block; color: #24B5CC; cursor: pointer; padding: 2px 10px; height: 20px; border-radius: 10px; line-height: 16px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .show-attachments-div.has-attachments:hover,.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .show-attachments-div.has-attachments.selected{background: #24B5CC; color: white;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup{display: none; position: absolute; background: #FFFFFF; box-shadow: 0px 0px 10px 0px rgba(0,0,0,0.50); border-radius: 2px; width: 240px; left: -245px; top: 4px; text-align: left;}.jimu-rtl .jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup{left: auto; right: -245px; text-align: right;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup.show{display: block;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-header{background: none; padding-left: 10px; font-size: 14px; color: #000000; font-weight: bold; line-height: 36px;}.jimu-rtl .jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-header{padding-left: 0; padding-right: 10px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-header:hover{background: #fff;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-header .close {display: inline-block; width: 36px; height: 36px; background: url(\'../images/close.png\') center no-repeat; cursor: pointer;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content{box-sizing: border-box; width: 100%; max-height: 160px; list-style-type: none; margin: 0; padding: 0; overflow-x: hidden; overflow-y: auto; padding-left: 20px;}.jimu-rtl .jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content{padding-left: 0; padding-right: 20px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li {vertical-align: middle; background-image: url(\'./images/file.png\'); background-repeat: no-repeat; padding-left: 30px; background-size: 20px; background-position: left;}.jimu-rtl .jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li{padding-left: 0; padding-right: 30px; background-position: right;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li.image-type{background-image: url(\'./images/image.png\');}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li a{display: inline-block; width: 176px; height: 36px; line-height: 36px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li a:hover{cursor: pointer;}.jimu-widget-attributetable-feature-menu .menuItemClass{cursor: pointer;}.jimu-widget-attributetable-feature-menu.dijitMenu{background-color: #fff !important;}.jimu-widget-attributetable-feature-menu.dijitMenu .dijitMenuItemSelected td,.jimu-widget-attributetable-feature-menu.dijitMenu .dijitMenuItemSelected{background-color: #f1f1f1 !important; color: #000!important;}.jimu-widget-attributetable-feature-table-footer {position: absolute; bottom: 4px; background: white; width: 100%;}.widget-at-filter-popup .content-absolute{left: 0; right: 0;}.jimu-widget-attributetable-feature-table-popup p {margin-bottom: 10px;}.jimu-widget-attributetable-feature-table-popup strong {font-family: "Avenir Medium";}.jimu-widget-attributetable-feature-table-popup mark {display: inline-block; color: #596679; background: #f1f1f1; border-bottom: 1px solid #ddd; margin: 5px; padding: 5px; font-size: 12px;}.jimu-widget-attributetable-feature-table-popup pre {padding: 5px; white-space: normal; font-size: 13px; color: #595959; background-color: #f8f8f8; border: 1px solid #efefef; margin: 10px 0 15px;}.jimu-widget-attributetable-feature-table-popup .tags {margin-bottom: 10px;}.jimu-widget-attributetable-feature-table-popup .example-block {margin-top: 10px;}.jimu-widget-attributetable-feature-table-popup .input-row {margin: 20px auto; color: #596679;}.jimu-widget-attributetable-feature-table-popup .input-row \x3e * {vertical-align: top;}.jimu-widget-attributetable-feature-table-popup .input-row a {color: #485566; cursor: pointer; line-height: 16px; margin-left: 10px;}.jimu-rtl .jimu-widget-attributetable-feature-table-popup .input-row a {margin-left: auto; margin-right: 10px;}.jimu-widget-attributetable-feature-table-popup .input-row a.hint-button {font-size: 12px; color: #999;}.jimu-widget-attributetable-feature-table-popup .input-row a.hint-button:hover {color: #595959;}.jimu-widget-attributetable-feature-table-popup.is-loading \x3e *:not(.jimu-loading-indicator) {opacity: .35;}.jimu-widget-attributetable-notable {color: #999; line-height: 1.5; position: absolute; top: 50%; left: 50%; text-align: center; max-width: 400px; transform: translate(-50%, -50%);}.jimu-widget-attributetable-notable.hidden {display: none;}.closed .jimu-widget-attributetable-notable {display: none;}.sr-only {position: absolute; width: 1px; height: 1px; padding: 0; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0;}',
"*now":function(J){J(['dojo/i18n!*preload*widgets/AttributeTable/nls/Widget*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare dojo/_base/html dijit/_WidgetsInTemplateMixin jimu/BaseWidget dijit/layout/TabContainer dijit/layout/ContentPane jimu/utils jimu/dijit/Message dojo/Deferred dojo/promise/all esri/layers/FeatureLayer esri/lang dojo/_base/lang dojo/on dojo/touch dojo/topic dojo/aspect dojo/_base/array dojo/query jimu/dijit/LoadingIndicator jimu/FilterManager ./_ResourceManager ./utils ./a11y/WidgetMixin".split(" "),function(J,m,H,M,D,C,B,F,K,L,T,h,e,n,c,k,a,f,q,u,p,x,E,P){J=J([M,H,P],{name:"AttributeTable",
baseClass:"jimu-widget-attributetable",normalHeight:0,openHeight:0,arrowDivHeight:null,_relatedDef:null,_resourceManager:null,_activeLayerInfoId:null,_layerTypes:{FEATURELAYER:"FeatureLayerTable",RELATIONSHIPTABLE:"RelationshipTable"},postMixInProperties:function(){this.nls.features=this.nls.features||"features"},postCreate:function(){this.inherited(arguments);B.loadStyleLink("dgrid",apiUrl+"dgrid/css/dgrid.css");this.NoTableMessageDiv=this.AttributeTableDiv=this._loadInfoDef=null;this._delayedLayerInfos=
[];this.layerTabPages=[];this.tabContainer=null;this.moveMode=!1;this.bottomPosition=this.noGridHeight=this.previousDomHeight=this.moveY=0;this.layerTabPagesIndex=-1;this.showing=!1;this.openHeight=this.normalHeight=this._getNormalHeight();this.arrowDivHeight=0;this._dragingHandlers=[];this._activeTable=null;this._activeTableHandles=[];this.filterManager=p.getInstance();this._createUtilitiesUI();this._resourceManager=new x({widgetId:this.id,map:this.map,nls:this.nls,parent:this});this._resourceManager.setConfig(this.config);
this._resourceManager.onFeatureSelectionChange=e.hitch(this,function(b){this.publishData({selectionInfo:b})});this.own(k.subscribe("changeMapPosition",e.hitch(this,this._onMapPositionChange)));E.readLayerInfosObj(this.map).then(e.hitch(this,function(b){this.domNode&&b&&(this.own(n(b,"layerInfosIsShowInMapChanged",e.hitch(this,this.onLayerInfosIsShowInMapChanged))),this.own(b.on("layerInfosChanged",e.hitch(this,this.onLayerInfosChanged))),this.own(b.on("layerInfosFilterChanged",e.hitch(this,this.onLayerInfosFilterChanged))))}))},
_createUtilitiesUI:function(){this._createSwitchUI();this._createBarUI()},_createBarUI:function(){this.arrowDiv=m.create("div");m.addClass(this.arrowDiv,"jimu-widget-attributetable-move");m.create("div",{"class":"jimu-widget-attributetable-thumb"},this.arrowDiv);m.place(this.arrowDiv,this.domNode);if(!this.arrowDivHeight){var b=m.getMarginBox(this.arrowDiv);this.arrowDivHeight=b&&b.h?b.h:7}this.own(n(this.arrowDiv,"mousedown",e.hitch(this,this._onDragStart)));this.own(n(this.arrowDiv,c.press,e.hitch(this,
this._onDragStart)))},_isOnlyTable:function(){return this.closeable||!this.isOnScreen},_createSwitchUI:function(){this._isOnlyTable()||(this.switchBtn=m.create("div",{className:"jimu-widget-attributetable-switch",tabindex:"0",role:"button"},this.domNode),this.own(n(this.switchBtn,"click",e.hitch(this,function(){this._switchTable();this.hasBeenActivated=this.showing;this.focusToDisplay=!this.showing}))))},_processOpenBarUI:function(){this._isOnlyTable()||(m.removeClass(this.switchBtn,"close"),m.addClass(this.switchBtn,
"open"),m.setAttr(this.switchBtn,"title",this.nls.closeTableTip),m.setAttr(this.switchBtn,"aria-label",this.nls.closeTableTip))},_processCloseBarUI:function(){this._isOnlyTable()||(m.removeClass(this.switchBtn,"open"),m.addClass(this.switchBtn,"close"),m.setAttr(this.switchBtn,"title",this.nls.openTableTip),m.setAttr(this.switchBtn,"aria-label",this.nls.openTableTip))},_switchTable:function(){this.showing?this._closeTable():this._openTable()},_openTable:function(){m.removeClass(this.domNode,"closed");
this._loadInfoDef?this._loadInfoDef&&this._loadInfoDef.isFulfilled()&&(this.showing=!0,this._processDelayedLayerInfos(),this._activeTable&&this._activeTable.active()):(this._loadInfoDef=new K,this.own(this._loadInfoDef),this.loading||(this.loading=new u),this.loading.placeAt(this.domNode),this._toggleLoading(!0),this._resourceManager.updateLayerInfoResources(!0).then(e.hitch(this,function(){this.domNode&&(this._init(),this.showRefreshing(!1),this.showing=!0,this._loadInfoDef.resolve())}),e.hitch(this,
function(b){console.error(b);this._loadInfoDef.reject(b)})));this._changeHeight(this.openHeight);this._processOpenBarUI();return this._loadInfoDef},_onCloseBtnClicked:function(){this.showing&&this._isOnlyTable()?this.widgetManager.closeWidget(this):this.showing&&this._closeTable();this._activeTable&&this._activeTable.deactive()},_closeTable:function(){m.addClass(this.domNode,"closed");this._changeHeight(0);this.showRefreshing(!1);this._processCloseBarUI();this._activeTable&&this._activeTable.deactive();
this.showing=!1;m.setStyle(this.arrowDiv,"display","none");m.setStyle(this.domNode,"overflow","hidden");setTimeout(e.hitch(this,function(){this.domNode&&(m.setStyle(this.domNode,"overflow","visible"),m.setStyle(this.arrowDiv,"display","block"))}),10)},_init:function(){this.initDiv();this._changeHeight(this.openHeight);this.resize();this.own(n(window.document,"mouseup",e.hitch(this,this._onDragEnd)));this.own(n(window.document,"mousemove",e.hitch(this,this._onDraging)));this.own(n(window.document,
c.move,e.hitch(this,this._onDraging)));this.own(n(window.document,c.release,e.hitch(this,this._onDragEnd)))},_processDelayedLayerInfos:function(){0<this._delayedLayerInfos.length&&(f.forEach(this._delayedLayerInfos,e.hitch(this,function(b){this._resourceManager.addLayerInfo(b)})),this._delayedLayerInfos=[])},onLayerInfosIsShowInMapChanged:function(b){this._activeTable&&this._activeTable.changeToolbarStatus();this.config.syncWithLayers&&f.forEach(b,e.hitch(this,function(r){if(!r.getSubLayers().length){var v=
r.isShowInMap(),z=E.getConfigInfoFromLayerInfo(r),G=this.getExistLayerTabPage(z.id);if(v)if(G)G.closable&&G.set("closable",!1);else{var R=this._resourceManager.getVisivleLayerInfoIndexById(r.id);v=this._resourceManager.getLayerInfoById(r.id);var Q={layer:r,closeable:!1,isActive:!1,index:R};v?this._addLayerToTable(Q):this._resourceManager.updateLayerInfoResources(!1).then(e.hitch(this,function(){R=this._resourceManager.getVisivleLayerInfoIndexById(r.id);Q.index=R;this._addLayerToTable(Q)}))}else G&&
this.layerTabPageClose(z.id,!0)}}))},onLayerInfosChanged:function(b,r,v){v&&b&&("added"===r?v.getSupportTableInfo().then(e.hitch(this,function(z){z.isSupportedLayer&&this._resourceManager.addLayerInfo(v)})):"removed"===r&&(b=v.id,this.getExistLayerTabPage(b)&&this.layerTabPageClose(b,!0),this._resourceManager.getLayerInfoById(b)&&this._resourceManager.removeLayerInfo(b),this._resourceManager.getConfigInfoById(b)&&this._resourceManager.removeConfigInfo(b)))},onLayerInfosFilterChanged:function(b){f.some(b,
e.hitch(this,function(r){if(this._activeTable&&r.id===this._activeTable.layerInfo.id)return this._activeTable._relatedQuery||this._activeTable.startQuery(),!0}))},destroy:function(){if(!this._destroyed){var b;if(this.layerTabPages&&0<this.layerTabPages.length){var r=this.layerTabPages.length;for(b=0;b<r;b++){var v=this.layerTabPages[b].paneId,z=e.getObject("_resourceManager.featureTableSet."+v,!1,this);z&&(z=z.getFilterObj())&&h.isDefined(z.expr)&&this.filterManager.applyWidgetFilter(v,this.id,"");
this.layerTabPages[b].destroy()}this.layerTabPages=null}this.tabContainer&&(this.tabContainer.destroy(),this.tabContainer=null);this._activeLayerInfoId=this._loadInfoDef=this.AttributeTableDiv=null;this._resourceManager&&this._resourceManager.empty();this.inherited(arguments)}},onOpen:function(){!this.showing&&this._isOnlyTable()&&(this._openTable(),this.hasBeenActivated=!0)},onClose:function(){this.showing&&(this._closeTable(),this.hasBeenActivated=!1)},_changeHeight:function(b){m.setStyle(this.domNode,
"height",b+"px");this.tabContainer&&this.tabContainer.domNode&&0<=b-this.arrowDivHeight&&m.setStyle(this.tabContainer.domNode,"height",b-this.arrowDivHeight+"px");this._activeTable&&this._activeTable.changeHeight(b-this.noGridHeight);k.publish("changeMapPosition",{bottom:b+this.bottomPosition});this.publishData({changeMapPosition:{bottom:b+this.bottomPosition}});0!==b&&(this.openHeight=b>=this.arrowDivHeight?b:this.normalHeight)},_onMapPositionChange:function(b){isFinite(b.left)&&"number"===typeof b.left&&
(window.isRTL?m.setStyle(this.domNode,"right",parseFloat(b.left)+"px"):m.setStyle(this.domNode,"left",parseFloat(b.left)+"px"));isFinite(b.right)&&"number"===typeof b.right&&(window.isRTL?m.setStyle(this.domNode,"left",parseFloat(b.right)+"px"):m.setStyle(this.domNode,"right",parseFloat(b.right)+"px"));this.tabContainer&&this.tabContainer.resize()},setPosition:function(b){this.position=b;this._isOnlyTable()?this.bottomPosition=0:this.bottomPosition="bottom"in b?parseInt(b.bottom,10):0;this.domNode.parentNode&&
this.domNode.parentNode.id===window.jimuConfig.layoutId||(m.place(this.domNode,window.jimuConfig.layoutId),this.setInitialPosition(b),this.showRefreshing(!1));m.setStyle(this.domNode,"bottom",this.bottomPosition+"px");this._resourceManager.isEmpty()||setTimeout(e.hitch(this,function(){var r=this._getGridTopSectionHeight(),v=m.getStyle(this.domNode,"height");0<r&&(this.noGridHeight=r);0<v&&this._changeHeight(v)}),20)},_startQueryOnLayerTab:function(b,r){var v=this._resourceManager.getLayerInfoById(b),
z=this.getExistLayerTabPage(b);v&&z&&(this.showRefreshing(!0),this._resourceManager.getQueryTable(b,this.config.filterByMapExtent,this.config.hideExportButton,this.config.allowTextSelection).then(e.hitch(this,function(G){this._activeLayerInfoId===b&&G&&(z=this.getExistLayerTabPage(b),G.isSupportQuery?(G=G.table,G.getParent()!==z&&G.placeAt(z),this.setActiveTable(G,{h:this.openHeight-this.noGridHeight,featureSet:r})):(G=m.toDom("\x3cdiv\x3e"+this.nls.unsupportQueryWarning+"\x3c/div\x3e"),z.set("content",
G),this._activeTable&&this._activeTable.changeToolbarStatus()),this.showRefreshing(!1))}),e.hitch(this,function(G){new F({message:G.message||G});this.showRefreshing(!1)})))},_startQueryOnRelationTab:function(b,r,v,z){var G=this._resourceManager.getLayerInfoById(z),R=this.getExistLayerTabPage(b);G&&G.layerObject&&R&&this._resourceManager.getRelationTable(z,r,!1,this.config.hideExportButton,this.config.allowTextSelection).then(e.hitch(this,function(Q){this._activeLayerInfoId===b&&Q&&(R=this.getExistLayerTabPage(b),
Q.isSupportQuery?(Q=Q.table,Q.getParent()!==R&&Q.placeAt(R),this.setActiveTable(Q,{h:this.openHeight-this.noGridHeight,layer:G.layerObject,selectedIds:v})):(Q=m.toDom("\x3cdiv\x3e"+this.nls.unsupportQueryWarning+"\x3c/div\x3e"),R.set("content",Q),this._activeTable&&this._activeTable.changeToolbarStatus()),this.showRefreshing(!1))}))},tabChanged:function(){if(this.tabContainer&&this.tabContainer.selectedChildWidget){0>=this.noGridHeight&&(this.noGridHeight=this._getGridTopSectionHeight()+5);var b=
this.tabContainer.selectedChildWidget.params,r=b.layerType,v=b.paneId,z=b.relKey;r===this._layerTypes.FEATURELAYER&&(this._activeLayerInfoId!==v||b.oids||b.featureSet)?(this.setActiveTable(null),delete b.oids,this._activeLayerInfoId=v,this._startQueryOnLayerTab(v,b.featureSet)):r===this._layerTypes.RELATIONSHIPTABLE&&(this.setActiveTable(null),r=b.oids,b=b.originalInfoId,this._activeLayerInfoId=v,this._startQueryOnRelationTab(v,z,r,b))}},showRefreshing:function(b){this.loading&&this._toggleLoading(b)},
_onDragStart:function(b){this.moveMode=!0;this.moveY=b.clientY;this.previousDomHeight=m.getStyle(this.domNode,"height");m.addClass(this.arrowDiv,"draging");this._dragingHandlers=this._dragingHandlers.concat([n(this.ownerDocument,"dragstart",function(r){r.stopPropagation();r.preventDefault()}),n(this.ownerDocumentBody,"selectstart",function(r){r.stopPropagation();r.preventDefault()})])},_onDraging:function(b){this.moveMode&&125<=b.clientY&&this._changeHeight(this.moveY-b.clientY+this.previousDomHeight)},
_onDragEnd:function(){this.moveMode=!1;m.removeClass(this.arrowDiv,"draging");for(var b=this._dragingHandlers.pop();b;)b.remove(),b=this._dragingHandlers.pop()},_getNormalHeight:function(){var b=document.body.clientHeight;return window.appInfo.isRunInMobile?b/2:b/3},setInitialPosition:function(){var b=m.getStyle(this.domNode,"left"),r=m.getStyle(this.domNode,"right");b||m.setStyle(this.domNode,"left","0px");r||m.setStyle(this.domNode,"right","0px");m.setStyle(this.domNode,"top","auto");m.setStyle(this.domNode,
"position","absolute");this._isOnlyTable()||(this.config&&this.config.initiallyExpand?this._openTable():this._closeTable())},_bindActiveTableEvents:function(){var b=this;b._activeTable&&(b._activeTableHandles.push(n(b._activeTable,"show-related-records",function(r){b._showRelatedRecordsByRelationship(r.layerInfoId,r.objectIds,r.relationshipObj)})),b._activeTableHandles.push(n(b._activeTable,"show-all-records",function(r){b.getExistLayerTabPage(r.layerInfoId).params.layerType=b._layerTypes.FEATURELAYER})),
b._activeTableHandles.push(n(b._activeTable,"refresh",function(r){delete b.getExistLayerTabPage(r.layerInfoId).params.featureSet})),b._activeTableHandles.push(n(b._activeTable,"apply-filter",function(r){b.filterManager.applyWidgetFilter(r.layerInfoId,b.id,r.expr);b._activeTable.startQuery()})))},_unbindActiveTableEvents:function(){for(var b=this._activeTableHandles;0<b.length;){var r=b.pop();r&&r.remove&&r.remove()}},setActiveTable:function(b,r){this._activeTable&&(this._activeTable.cancelThread(),
this._activeTable.deactive(),this._unbindActiveTableEvents(),this._activeTable=null);if(b){this._activeTable=b;this._activeTable.active();this._activeTable.changeHeight(r.h);if(!this._activeTable.tableCreated||this._activeTable.tableCreated&&this._activeTable.matchingMap||this._activeTable.tableCreated&&!this._activeTable.matchingMap&&r.featureSet||r.layer&&r.selectedIds)if(b=e.getObject("featureSet.features.length",!1,r),r.layer&&r.selectedIds)this._activeTable.queryRecordsByRelationship(r);else if(b){var v=
r.featureSet.displayFieldName;r=f.map(r.featureSet.features,function(z){return z.attributes[v]});this._activeTable.startQuery(r)}else this._activeTable.startQuery();this._bindActiveTableEvents();this._activeTable.changeToolbarStatus()}},initDiv:function(){this.AttributeTableDiv=m.create("div",{},this.domNode);m.addClass(this.AttributeTableDiv,"jimu-widget-attributetable-main");var b=m.create("div");m.place(b,this.AttributeTableDiv);this.tabContainer=new D({style:"width: 100%;"},b);m.setStyle(this.tabContainer.domNode,
"height",this.normalHeight+"px");this.tabContainer.startup();b=this._resourceManager.getConfigInfos();for(var r=b.length,v=0;v<r;v++){var z=b[v];if(z.show){z=e.clone(z);var G={};G.paneId=z.id;G.title=z.name;G.name=z.name;G.layerType=this._layerTypes.FEATURELAYER;G.style="height: 100%; width: 100%; overflow: visible;";z=new C(G);this.layerTabPages[v]=z;this.tabContainer.addChild(z)}}0<r?this.noGridHeight=this._getGridTopSectionHeight()+5:this._toggleNoTableMessage(!0);B.setVerticalCenter(this.tabContainer.domNode);
this.tabChanged();this.own(a.after(this.tabContainer,"selectChild",e.hitch(this,this.tabChanged)));this.applyA11y&&this.applyA11y()},getLayerInfoLabel:function(b){return b.name||b.title},getLayerInfoId:function(b){return b&&b.id||""},_getGridTopSectionHeight:function(){var b=q(".dijitTabPaneWrapper",this.domNode)[0];if(b){var r=m.position(this.domNode).y;return m.position(b).y-r}return 0},_getLayerInfoByIdFromConfigJSON:function(b){var r=f.filter(this.config.layerInfos,function(v){return v.id===b});
return r&&0<r.length&&r[0]},_showRelatedRecordsByRelationship:function(b,r,v){var z=this._activeTable;z&&(z=z.layerInfo)&&z.id===b&&z.layerObject&&f.some(z.layerObject.relationships,function(G){return B.isEqual(G,v)})&&this.addNewRelationTab(r,v,z.id,!0,!0)},addNewLayerTab:function(b,r,v,z,G,R){var Q=this._resourceManager.getLayerInfoById(b);if(Q){b=this.getExistLayerTabPage(b);var O={};O.title=this.getLayerInfoLabel(Q);O.name=O.title;O.paneId=this.getLayerInfoId(Q);O.closable=v;O.layerType=this._layerTypes.FEATURELAYER;
O.featureSet=r;O.viewInTableFlag=R;b?(e.mixin(b.params,O),this.onOpen()):(this._resourceManager.getConfigInfoById(Q.id)||this._resourceManager.addConfigInfo(Q),this._resourceManager.getLayerInfoById(Q.id)||this._resourceManager.addLayerInfo(Q),this.onOpen(),O.style="height: 100%; width: 100%; overflow: visible",b=new C(O),this.layerTabPages.push(b),b.set("title",O.name),this.own(n(b,"close",e.hitch(this,this.layerTabPageClose,O.paneId,!0))),this.tabContainer.addChild(b,G));z&&(this.tabContainer.selectChild(b),
this.__focusOnActiveTab());1===this.layerTabPages.length&&this._toggleNoTableMessage(!1)}},addNewRelationTab:function(b,r,v,z,G){var R=this._resourceManager.getRelationShipInfo(r),Q=r&&R;if(Q){R=this.getExistLayerTabPage(R.id);var O={};O.oids=b;O.title=Q.title||Q.name||r.name;O.name=O.title;O.paneId=Q.id;O.relKey=r._relKey;O.originalInfoId=v;O.closable=z;O.layerType=this._layerTypes.RELATIONSHIPTABLE;R?e.mixin(R.params,O):(this._resourceManager.getConfigInfoById(Q.id)||this._resourceManager.addConfigInfo(Q),
this._resourceManager.getLayerInfoById(Q.id)||this._resourceManager.addLayerInfo(Q),O.style="height: 100%; width: 100%; overflow: visible",R=new C(O),this.layerTabPages.push(R),R.set("title",O.name),this.own(n(R,"close",e.hitch(this,this.layerTabPageClose,O.paneId,!0))),this.tabContainer.addChild(R));G&&this.tabContainer.selectChild(R)}},onReceiveData:function(b,r,v){v&&"AttributeTable"===v.target&&(this._isOnlyTable()&&"closed"===this.state?console.warn("Please open Attribute Table!"):(v.layer=v.layer||
v.layerInfo,v.closeable=!0,v.isActive=!0,this.showing?this._resourceManager.updateLayerInfoResources(!1).then(e.hitch(this,function(){this._addLayerToTable(v)})):this._openTable().then(e.hitch(this,function(){this._resourceManager.getLayerInfoById(v.layer.id)?this._addLayerToTable(v):this._resourceManager.updateLayerInfoResources(!1).then(e.hitch(this,function(){this._addLayerToTable(v)}))}))))},_addLayerToTable:function(b){var r=null;if(e.getObject("layer.id",!1,b)||e.getObject("layerInfo.id",!1,
b)){var v=this._resourceManager.getLayerInfoById(b.layerInfo&&b.layerInfo.id||b.layer&&b.layer.id);v.getLayerObject().then(e.hitch(this,function(z){z?(z.id=b.layer.id,z.loaded?this.addNewLayerTab(v.id,b.featureSet,!!b.closeable,!!b.isActive,b.index,b.viewInTableFlag):this.own(n(z,"load",e.hitch(this,this.addNewLayerTab,v.id,b.featureSet,!!b.closeable,!!b.isActive,b.index,b.viewInTableFlag)))):b.url&&(r=new T(b.url),this.own(n(r,"load",e.hitch(this,this.addNewLayerTab,v.id,b.featureSet,!!b.closeable,
!!b.isActive,b.index,b.viewInTableFlag))))}),e.hitch(this,function(z){new F({message:z.message||z})}))}},getExistLayerTabPage:function(b){for(var r=this.layerTabPages.length,v=0;v<r;v++)if(this.layerTabPages[v]&&this.layerTabPages[v].get("paneId")===b)return this.layerTabPages[v];return null},layerTabPageClose:function(b,r){var v=this.layerTabPages.length;e.getObject("_activeTable.layerInfo.id",!1,this)===b&&this.setActiveTable(null);for(var z=0;z<v;z++)if(this.layerTabPages[z]&&this.layerTabPages[z].paneId===
b){var G=e.getObject("_resourceManager.featureTableSet."+b,!1,this);G&&(G=G.getFilterObj())&&h.isDefined(G.expr)&&this.filterManager.applyWidgetFilter(b,this.id,"");!0===r&&(this.tabContainer.removeChild(this.layerTabPages[z]),this.layerTabPages[z].destroyRecursive());this.layerTabPages&&this.layerTabPages[z]&&this.layerTabPages.splice(z,1);this._resourceManager.removeConfigInfo(b);this._resourceManager.removeLayerInfo(b);if(1===v){this._activeLayerInfoId=null;this.onClose();this._toggleNoTableMessage(!0);
break}else b===this._activeLayerInfoId&&this.tabContainer.selectChild(this.layerTabPages[v-2]);break}},_processRelatedRecordsFromPopup:function(b,r){if(b){var v=[];v.push(b.getLayerObject());v.push(b.getRelatedTableInfoArray());L(v).then(e.hitch(this,function(z){if(z){var G=z[0];this._resourceManager.collectRelationShips(b,z[1]);z=G.relationships;G=0;for(var R=z.length;G<R;G++)this.addNewRelationTab(r,z[G],b.id,!0,!0)}}))}},showRelatedRecordsFromPopup:function(b,r){this.showing?this._resourceManager.updateLayerInfoResources(!1).then(e.hitch(this,
function(){this._processRelatedRecordsFromPopup(b,r)})):this._openTable().then(e.hitch(this,function(){this._resourceManager.getLayerInfoById(b.id)?this._processRelatedRecordsFromPopup(b,r):this._resourceManager.updateLayerInfoResources(!1).then(e.hitch(this,function(){this._processRelatedRecordsFromPopup(b,r)}))}))},getRelationShipInfo:function(b){return this._resourceManager&&this._resourceManager.getRelationShipInfo(b)},_toggleNoTableMessage:function(b){if(!this.NoTableMessageDiv){var r=this.AttributeTableDiv||
this.domNode;this.NoTableMessageDiv=m.create("div",{innerHTML:this.nls.noTablesAvailable+"\x3cbr/\x3e\x3cbr/\x3e"+(this.config.syncWithLayers?this.nls.checkLayerListToSelectLayers:this.nls.checkConfigutationToSelectLayers),className:"jimu-widget-attributetable-notable hidden"});m.place(this.NoTableMessageDiv,r)}m[b?"removeClass":"addClass"](this.NoTableMessageDiv,"hidden")},_toggleLoading:function(b){void 0===b?this.loading.hidden?this.loading.show():this.loading.hide():b?this.loading.show():this.loading.hide()},
isLoading:function(){return this.loading&&!this.loading.hidden||this._activeTable&&this._activeTable.loading&&!this._activeTable.loading.hidden}});J.inPanel=!1;J.hasUIFile=!1;return J});