// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"widgets/DataAggregation/js/UI/PageContainer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/Evented dojo/query dojo/keys dojo/dom-class dojo/dom-attr dojo/Deferred dojo/_base/xhr dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/PageContainer.html jimu/dijit/ViewStack".split(" "),function(K,t,x,C,H,I,w,F,z,G,B,v,D,d,m,k){return K([D,d,I],{templateString:m,selected:"",tabs:null,average:!1,nls:null,baseClass:"jimu-tab3",
declaredClass:"PageContainer",views:[],_currentIndex:-1,_homeIndex:0,theme:"",styleColor:"",altHomeIndex:0,nextDisabled:!1,_backLabels:[],constructor:function(c){t.mixin(this,c);this.theme=this.appConfig.theme.name;this._darkThemes=["DartTheme","DashboardTheme"];this.own(H.subscribe("appConfigChanged",t.hitch(this,this._onAppConfigChanged)));this.own(H.subscribe("builder/styleChanged",t.hitch(this,this._onBuilderStyleChanged)))},postCreate:function(){this.inherited(arguments);this.displayControllerOnStart||
this.toggleController(!0);this._validateIsDark(this.appConfig)},startup:function(){this.inherited(arguments);this._started=!0;this._initSelf();this.selected?this.selectView(this.selected):0<this.views.length&&this.selectView(this._homeIndex);this._backLabels=[]},_onBuilderStyleChanged:function(c){this.setStyleColor(c.styleColor)},_onAppConfigChanged:function(c,a,e){this.appConfig=c?c:this.appConfig;switch(a){case "themeChange":this._validateIsDark(c);this.emit("theme-change",c,a,e);break;case "layoutChange":this.emit("layout-change",
c,a,e);break;case "styleChange":this._validateIsDark(c);this.emit("style-change",c,a,e);break;case "widgetChange":this.emit("widget-change",c,a,e);break;case "mapChange":this.emit("map-change",c,a,e)}},_validateIsDark:function(c){this._setThemeAndColors(c).then(t.hitch(this,function(){this.updateImageNodes();this._updateViewTheme(this.theme);for(var a=0;a<this.views.length;a++){var e=this.views[a];e.theme=this.theme;e.updateImageNodes()}}))},_setThemeAndColors:function(c){var a=new B;c=c&&c.theme&&
c.theme.name?c:this.appConfig;this.theme=c.theme.name;this._getStyleColor(c.theme.styles[0]).then(t.hitch(this,function(e){this.style=e;this._darkThemes="light"===e.name&&"DashboardTheme"===this.theme?["DartTheme"]:["DartTheme","DashboardTheme"];this.isDarkTheme=-1<this._darkThemes.indexOf(this.theme);this.styleColor=e.styleColor;a.resolve(!0)}));return a},_getStyleColor:function(c){var a=new B,e=c?c:this.appConfig.theme.styles[0];v.get({url:"./themes/"+this.theme+"/manifest.json",handleAs:"json",
load:t.hitch(this,function(l){l=l.styles;for(var p=0;p<l.length;p++){var q=l[p];q.name===e&&a.resolve(q)}})});return a},selectView:function(c,a){!a&&0<c&&(a=this.getSelectedTitle(),(a=this.getViewByTitle(a))&&this._backLabels[this._backLabels.length-1]!==a.label&&c!==a.index&&(this._backLabels.push(a.label),this.backDisabled=!1));this.viewStack.switchView(c);this._updateDomNodes(c);this._currentIndex=c;this.emit("view-changed",c)},showShelter:function(){C.setStyle(this.shelter,"display","block")},
hideShelter:function(){C.setStyle(this.shelter,"display","none")},_initSelf:function(){this.viewStack?this.viewStack._currentView=void 0:this.viewStack=new k(null,this.containerNode);this._initViews()},_initViews:function(){x.forEach(this.views,t.hitch(this,function(c){this.addView(c)}))},_prevView:function(c){c&&"keydown"===c.type&&c.keyCode!==F.ENTER&&c.keyCode!==F.SPACE||this._navView("back-view")},_homeView:function(c){c&&"keydown"===c.type&&c.keyCode!==F.ENTER&&c.keyCode!==F.SPACE||this._navView("home-view")},
_nextView:function(c){c&&"keydown"===c.type&&c.keyCode!==F.ENTER&&c.keyCode!==F.SPACE||this._navView("next-view")},_navView:function(c){var a=this.getSelectedTitle(),e=this.getViewByTitle(a),l="home-view"===c&&e.altHomeIndex?e.altHomeIndex:this._homeIndex,p,q=!1;if("back-view"===c&&0<this._backLabels.length){var h;for(p=this._backLabels.length-1;0<=p&&(!(h=this.getViewByTitle(this._backLabels[p]))||this._backLabels[p]===a);p--)this._backLabels.splice(p,1);p=h.index;q=!0}"next-view"===c&&"undefined"===
typeof e&&0<this._backLabels.length&&(this._currentIndex=(e=this.getViewByTitle(this._backLabels[this._backLabels.length-1]))&&e.index?e.index:this._currentIndex);"undefined"===typeof p&&(p="next-view"===c?e.altNextIndex:"back-view"===c?e.altBackIndex:void 0);if("undefined"!==typeof p&&"home-view"!==c)var n=this.getViewByIndex(p);else"next-view"===c?this._currentIndex<this.viewCount-1&&(n=this.getViewByIndex(this._currentIndex+1)):"back-view"===c?n=this._currentIndex-1<=this._homeIndex?this.getViewByIndex(this._homeIndex):
this.getViewByIndex(this._currentIndex-1):(l!==this._homeIndex&&this._backLabels&&0<this._backLabels.length&&(q=!0),n=this.getViewByIndex(l));n&&(a={currentView:e,navView:n},this.emit(c,a),e.validate?e.validate(c,a).then(t.hitch(this,function(b){b&&this._navigate(n.index,q,e.index,c,n.label)})):this._navigate(n.index,q,e.index,c,n.label))},_navigate:function(c,a,e,l,p){0<e&&"next-view"===l&&this._backLabels[this._backLabels.length-1]!==this.views[e].label&&(this._backLabels.push(this.views[e].label),
this.backDisabled=!1);if(a){for(a=this._backLabels.length-1;0<=a;a--)if(this._backLabels[a]===p){this._backLabels.splice(a,1);break}0===this._backLabels.length&&(this.backDisabled=!0)}this._currentIndex=c;this.selectView(c,!0);this.emit("nav-view",c)},getSelectedIndex:function(){return this._currentIndex},getSelectedTitle:function(){return this.viewStack.getSelectedLabel()},getViewByIndex:function(c){if(this.views.length>c)return this.views[c]},getViewByTitle:function(c){for(var a=0;a<this.views.length;a++){var e=
this.views[a];if(e.label===c)return e}},_updateControlImage:function(c,a){a?(C.addClass(c,"control-disbaled"),G.set(c,"tabindex","-1")):(C.removeClass(c,"control-disbaled"),G.set(c,"tabindex","0"))},_updateControl:function(c,a){a?C.addClass(c,"control-disbaled"):C.removeClass(c,"control-disbaled")},_updateViews:function(){this.viewCount=this.views.length;for(var c=0;c<this.views.length;c++){var a=this.views[c];a.setStyleColor(this.styleColor);"undefined"!==typeof a.index&&a.index!==c&&this.emit("view-index-change",
{oldIndex:a.index,newIndex:c});a.index=c}this.emit("views-updated",this)},addView:function(c){c.pageContainer=this;this._containsView(c.label)||this.views.push(c);this.viewStack.getViewByLabel(c.label)||this.viewStack.addView(c);this._updateViews();this.emit("view-added",c)},removeViewByTitle:function(c){c=this.getViewByTitle(c);this.removeViewByIndex(c.index)},removeView:function(c){this.removeViewByIndex(c.index)},removeViewByIndex:function(c){var a=this.getViewByIndex(c),e=a.label;this.viewStack.removeView(a);
this.views.splice(c,1);this._updateViews();this._backLabels=this._backLabels.filter(function(l){return l!==e});0===this._backLabels.length&&(this.backDisabled=!0);this._navView("next-view");this.emit("view-removed",a)},_clearViews:function(){x.forEach(this.views,t.hitch(this,function(c){this.viewStack.removeView(c)}));this.views=[];this._backLabels=[]},_containsView:function(c){for(var a=0;a<this.views.length;a++)if(this.views[a].label===c)return!0;return!1},setStyleColor:function(c){this.styleColor=
c;x.forEach(this.views,t.hitch(this,function(a){a.styleColor=c}))},updateImageNodes:function(){var c=this.isDarkTheme;this._updateImageNode(c,"bg-back-img","bg-back-img-white");this._updateImageNode(c,"bg-home-img","bg-home-img-white");this._updateImageNode(c,"bg-next-img","bg-next-img-white")},_updateDomNodes:function(c){var a=this.views[c],e=this._homeIndex,l=this.backDisabled?this.backDisabled:c===this._homeIndex?!0:!1;this._updateControl(this.backTd,l);this._updateControlImage(this.backImage,
l);l=c===e?!0:!1;this._updateControl(this.homeTd,l);this._updateControlImage(this.homeImage,l);a=a&&"undefined"!==typeof a.altNextIndex;c=this.nextDisabled?this.nextDisabled:c!==e||this.nextDisabled?a?!1:this.nextDisabled:!1;this._updateControl(this.nextTd,c);this._updateControlImage(this.nextImage,c)},_updateImageNode:function(c,a,e){var l=c?a:e,p=c?e:a;c=w("."+l,this.domNode);x.forEach(c,function(q){z.remove(q,l);z.add(q,p)})},_updateViewTheme:function(c){this.theme=c;x.forEach(this.views,t.hitch(this,
function(a){a.theme=c}))},toggleController:function(c){this.controlTable&&(c?z.contains(this.controlTable,"display-none")||z.add(this.controlTable,"display-none"):z.contains(this.controlTable,"display-none")&&z.remove(this.controlTable,"display-none"))},reset:function(){this._clearViews();this.views=[];this._currentIndex=-1;this._homeIndex=0;this.nextDisabled=!1;this.backDisabled=!0;this.selected="";this._validateIsDark(this.appConfig)}})})},"widgets/DataAggregation/js/UI/Home":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/keys dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/Home.html dojo/on dojo/dom-construct dojo/dom-class dojo/dom-attr ../csvStore ./Addresses ./Coordinates ./FieldMapping esri/lang jimu/dijit/Popup jimu/utils".split(" "),
function(K,t,x,C,H,I,w,F,z,G,B,v,D,d,m,k,c,a,e,l,p){return K([I,w,F,z],{baseClass:"cf-home",declaredClass:"CriticalFacilities.Home",templateString:G,_started:null,label:"Home",parent:null,nls:null,map:null,appConfig:null,config:null,theme:"",styleColor:"",_geocodeSources:null,_fsFields:[],_singleFields:[],_multiFields:[],_childViews:[],singleEnabled:!1,multiEnabled:!1,xyEnabled:!1,disabled:!1,userName:"",fieldMappingView:null,constructor:function(q){t.mixin(this,q);this._initBaseArgs()},_initBaseArgs:function(){this._baseArgs=
{nls:this.nls,map:this.map,parent:this.parent,config:this.config,appConfig:this.appConfig,theme:this.theme}},postCreate:function(){this.inherited(arguments);this.pageInstructionText&&(this.pageInstruction.innerHTML=this.pageInstructionText);d.set(this.schemaMapInstructions,"aria-label",p.stripHTML(this.pageInstruction.innerHTML));this.own(B(this.uploadLabel,"keydown",t.hitch(this,function(q){q.keyCode!==H.ENTER&&q.keyCode!==H.SPACE||this.fileNode.click()})));this.own(B(this.creditsLink,"keydown",
t.hitch(this,function(q){q.keyCode!==H.ENTER&&q.keyCode!==H.SPACE||this.creditsLinkTag.click()})));this.firstFocusNode=this.schemaMapInstructions;this.lastFocusNode=this.creditsLink},startup:function(){this._started=!0;this.inDrop=!1;if(this.fileNode.disabled=this.disabled)D.add(this.uploadLabel,"disabled"),d.set(this.uploadLabel,"tabindex","-1");this.parent.domNode&&(this.own(B(this.parent.domNode,"dragenter",this.onDragEnter)),this.own(B(this.parent.domNode,"dragover",this.onDragOver)),this.own(B(this.parent.domNode,
"drop",t.hitch(this,this.onDrop))));this.own(B(this.map.container,"dragenter",this.onDragEnter));this.own(B(this.map.container,"dragover",this.onDragOver));this.own(B(this.map.container,"drop",t.hitch(this,this.onDrop)));this.own(B(this.fileNode,"change",t.hitch(this,this.onDrop)))},onShown:function(){},_clearResults:function(q){q||(this.map.infoWindow.hide(),this.inDrop=!1)},setStyleColor:function(q){this.styleColor=q},updateImageNodes:function(){},validate:function(q,h){var n=new C;"next-view"===
q?n.resolve(this._nextView(h)):"back-view"===q?this._backView(h).then(function(b){n.resolve(b)}):this._homeView(h).then(function(b){n.resolve(b)});return n},_nextView:function(q){q.navView.label===this.pageContainer.views[1].label&&this.pageContainer.toggleController(!1);return!0},_backView:function(q){var h=new C;q.navView.label===this.label&&(this.pageContainer.toggleController(!0),h.resolve(!0));return h},_homeView:function(q){var h=new C;q.navView.label===this.label&&(this.pageContainer.toggleController(!0),
h.resolve(!0));return h},_clearMapping:function(){this.parent._locationMappingComplete=!1;this.parent._fieldMappingComplete=!1},onDragEnter:function(q){q.preventDefault()},onDragOver:function(q){q.preventDefault()},onDrop:function(q){if(this.disabled)this.parent._userCanEdit?(q=this.parent._getMessages(),this.parent._showPopup(q)):this.parent.showEditMessage();else if(!this.inDrop){this.inDrop=!0;this.csvStore&&this.csvStore.clear();if(q.dataTransfer){q.preventDefault();var h=q.dataTransfer.files}else q.currentTarget&&
(h=q.currentTarget.files);h&&0<h.length?(q=h[0],-1!==q.name.indexOf(".csv")?(this.csvStore=new m({file:q,fsFields:this._fsFields,map:this.map,geocodeSources:this._geocodeSources,nls:this.nls,appConfig:this.appConfig,editLayer:this.parent.editLayer,symbol:this.parent._symbol,parent:this.parent}),this.csvStore.handleCsv().then(t.hitch(this,function(n){this._updatePageContainer(n);this.inDrop=!1}),t.hitch(this,function(){this.parent.erroInCSV();this.inDrop=!1}))):this.inDrop=!1):this.inDrop=!1}},targetLayerUpdated:function(){this.fieldMappingView&&
this.csvStore&&(this.csvStore.editLayer=this.parent.editLayer,this.csvStore.symbol=this.parent._symbol,this.csvStore.fsFields=t.clone(this._fsFields),this.csvStore._getDuplicateFields(this.csvStore.fsFields),this.csvStore.handleCsv().then(t.hitch(this,function(q){var h=q.fsFields;q=this._getFields(q,!1);this.fieldMappingView.targetLayerUpdate(h,q)})))},_initCoordinatesView:function(q){return new c(t.mixin({fields:this._getFields(q,!0),xField:"X"===this.config.xyFields[0].fieldName?this.config.xyFields[0]:
this.config.xyFields[1],yField:"Y"===this.config.xyFields[0].fieldName?this.config.xyFields[0]:this.config.xyFields[1],firstField:this.config.xyFields[0].fieldName},this._baseArgs))},_initAddressView:function(q){return new k(t.mixin({singleFields:this._singleFields,multiFields:this._multiFields,fields:this._getFields(q,!1),multiEnabled:this.multiEnabled,singleEnabled:this.singleEnabled},this._baseArgs))},_initFieldMappingView:function(q){return new a(t.mixin({targetFields:q.fsFields,sourceFields:this._getFields(q,
!1)},this._baseArgs))},_getFields:function(q,h){var n=[];x.forEach(q.fields,function(b){var g=q.fieldTypes[b];(h&&g&&(g.supportsInt||g.supportsFloat)||!h)&&n.push({label:b,value:b,type:g})});return n},_updatePageContainer:function(q){this.pageContainer.getViewByTitle("StartPage").csvStore=this.csvStore;if(this.xyEnabled){var h=this._initCoordinatesView(q);this.pageContainer.addView(h)}if(this.singleEnabled||this.multiEnabled)h=this._initAddressView(q),this.pageContainer.addView(h);this.fieldMappingView=
this._initFieldMappingView(q);this.pageContainer.addView(this.fieldMappingView);this.pageContainer._nextView()},verifyClearSettings:function(q){var h=new C;if(q.navView.label===this.label){if(this.parent._locationMappingComplete||this.parent._fieldMappingComplete||this.parent._tempResultsAdded)var n=this.nls.warningsAndErrors.settingsCleared;if(n){var b=v.create("div");v.create("div",{className:"cf-warning-icon",style:"float: "+(window.isRTL?"right; margin-left":"left; margin-right")+": 10px;"},b);
var g="padding-"+(window.isRTL?"right":"left")+": 50px;";v.create("div",{innerHTML:n,style:g},b);v.create("div",{innerHTML:this.nls.warningsAndErrors.proceed,style:"padding-top:10px; "+g},b);var f=new l({width:325,autoHeight:!0,content:b,buttons:[{label:this.nls.yes,onClick:t.hitch(this,function(){this._clearMapping();this._clearStore(!0);this.pageContainer.toggleController(!0);f.close();f=null;h.resolve(!0)})},{label:this.nls.no,classNames:["jimu-btn-vacation"],onClick:t.hitch(this,function(){this.pageContainer.selectView(q.currentView.index);
f.close();f=null;h.resolve(!1)})}],onClose:function(){f=null}})}else this.pageContainer.toggleController(!0),this._clearStore(!0),h.resolve(!0)}else h.resolve(!0);return h},_clearStore:function(q){this.csvStore&&this.csvStore.clear();this.map.infoWindow&&this.map.infoWindow.clearFeatures&&this.map.infoWindow.clearFeatures();this.fileForm.reset();q&&(this.parent._initPageContainer(!0),this.inDrop=!1)}})})},"widgets/DataAggregation/js/csvStore":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/DeferredList dojo/Evented dojox/data/CsvStore dojo/store/Observable dojo/store/Memory esri/graphicsUtils esri/geometry/webMercatorUtils esri/geometry/Point esri/layers/FeatureLayer esri/tasks/locator esri/tasks/query esri/SpatialReference esri/dijit/PopupTemplate esri/geometry/geometryEngine esri/tasks/ProjectParameters esri/tasks/GeometryService esri/request jimu/utils moment/moment".split(" "),
function(K,t,x,C,H,I,w,F,z,G,B,v,D,d,m,k,c,a,e,l,p,q,h){return K([I],{file:null,map:null,spatialReference:null,fsFields:[],duplicateTestFields:[],geocodeSources:[],duplicateData:[],data:null,editLayer:null,parent:null,separatorCharacter:null,csvStore:null,storeItems:null,matchedFeatureLayer:null,mappedArrayFields:null,unMatchedFeatureLayer:null,duplicateFeatureLayer:null,addrFieldName:"",xFieldName:"",yFieldName:"",symbol:null,matchFieldPrefix:"MatchField_",_internalFields:[],_removeLocators:[],constructor:function(n){x.mixin(this,
n);this.useAddr=!0;this.objectIdField="ObjectID";this.nls=n.nls;this.minScore=90;this._getDuplicateFields(this.fsFields);this.spatialReference=this.map.spatialReference;this.decimalSeperator=/^1(.+)1$/.exec(q.localizeNumber(1.1))[1].toString()},_getDuplicateFields:function(n){var b=[];t.forEach(n,function(g){g.duplicate&&b.push(g.name)});this.duplicateTestFields=b},handleCsv:function(){var n=new C;if(this.file&&!this.file.data){var b=new FileReader;b.onload=x.hitch(this,function(){this.data=b.result;
this._processCsvData().then(function(g){n.resolve(g)},x.hitch(this,function(g){n.reject(g)}))});b.readAsText(this.file)}return n},_processCsvData:function(){var n=new C;this._convertSources();this._getSeparator();this._getCsvStore().then(function(b){n.resolve(b)},function(b){n.reject(b)});return n},processForm:function(){this._internalFields=["DestinationOID","matchScore","hasDuplicateUpdates","duplicateState"];this._matchFields=[];var n=new C;this._locateData(this.useAddr).then(x.hitch(this,function(b){var g=
[],f=[],r=[],u={},y=0,A=0;0<this._removeLocators.length&&(this._removeLocators.sort(function(N,Q){return Q-N}),t.forEach(this._removeLocators,x.hitch(this,function(N){this._geocodeSources.splice(N,1)})));for(var E=function(N,Q,R,X){var T=N;-1===[null,void 0,""].indexOf(N)&&N.indexOf&&-1<N.indexOf(Q)&&(R=R.filter(function(V){return V.keyField===X}))&&R.hasOwnProperty("length")&&1===R.length&&(T=N.toString?N.toString().replace(Q,"."):N);return T},J=Object.keys(b),L=0;L<J.length;L++){var M={},O=b[J[L]],
P=this.storeItems[O.csvIndex];t.forEach(this.fsFields,x.hitch(this,function(N){if(this.mappedArrayFields.hasOwnProperty(N.name))if(this.mappedArrayFields[N.name]){var Q=this.csvStore.getValue(P,this.mappedArrayFields[N.name]);if(N.domainValues){var R=N.domainValues.filter(x.hitch(this,function(X){return X.label===Q}));M[N.name]=R&&0<R.length?R[0].value:Q}else M[N.name]="."===this.decimalSeperator||this.useAddr?Q:E(Q,this.decimalSeperator,this._currentAddressFields,this.mappedArrayFields[N.name])}else M[N.name]=
void 0}));t.forEach(this._currentAddressFields,x.hitch(this,function(N){var Q=this.matchFieldPrefix+N.keyField;if("undefined"!==typeof N.value){var R=this.csvStore.getValue(P,N.value);M[Q]="."===this.decimalSeperator||this.useAddr?R:E(R,this.decimalSeperator,this._currentAddressFields,N.keyField)}else M[Q]=void 0;this._matchFields.push(Q)}));O&&O.score>this.minScore?(M.ObjectID=L-y-A,M.matchScore=O.score,g.push({geometry:O.location,attributes:x.clone(M)})):O.isDuplicate?(M.ObjectID=A,M.DestinationOID=
O.featureAttributes[this.editLayer.objectIdField],M.matchScore=100,M.hasDuplicateUpdates=!1,M.duplicateState="no-change",r.push({geometry:O.location,attributes:x.clone(M)}),u[A]=O.featureAttributes,A++):(M.ObjectID=y,M.matchScore=O.score?O.score:0,f.push({geometry:O.location&&O.location.type?O.location:new v(0,0,this.spatialReference),attributes:x.clone(M)}),y++)}this.matchedFeatureLayer=this._initLayer(g,this.file.name.replace(".csv",""));0<r.length&&(this.duplicateFeatureLayer=this._initLayer(r,
this.file.name.replace(".csv","")+"_Duplicate"));0<f.length&&(this.unMatchedFeatureLayer=this._initLayer(f,this.file.name.replace(".csv","")+"_UnMatched"));n.resolve({matchedLayer:this.matchedFeatureLayer,unMatchedLayer:this.unMatchedFeatureLayer,duplicateLayer:this.duplicateFeatureLayer,duplicateLookupList:u})}),function(b){n.reject(b,!0)});return n},_initLayer:function(n,b){n=this._generateFC(n);b=new D(n,{id:b,editable:!0,outFields:["*"]});this._initPopup(b);this.map.addLayers([b]);return b},_initPopup:function(n){var b=
{title:n.id+": {"+this.labelField+"}"},g=[];t.forEach(n.fields,x.hitch(this,function(f){f.name!==this.objectIdField&&-1===this._internalFields.indexOf(f.name)&&-1===this._matchFields.indexOf(f.name)&&g.push({fieldName:f.name,visible:!0})}));b.fieldInfos=g;n.infoTemplate=new c(b)},_findDuplicates:function(){var n=new C;this._getAllLayerFeatures(this.editLayer,this.fsFields).then(x.hitch(this,function(b){this.keys=Object.keys(this.mappedArrayFields);this.oidField=this.editLayer.objectIdField;var g=
[],f=[],r=this.duplicateTestFields;r&&r.hasOwnProperty("length")&&0<r.length&&t.forEach(this.storeItems,x.hitch(this,function(y){var A={compareValues:{},fileId:y._csvId,featureId:-1};t.forEach(r,x.hitch(this,function(E){var J=this.mappedArrayFields[E];"undefined"!==typeof J&&(A.compareValues[E]=this.csvStore.getValue(y,J),-1===f.indexOf(E)&&f.push(E))}));0<Object.keys(A.compareValues).length&&g.push(A)}));var u=[];0<g.length&&t.forEach(g,x.hitch(this,function(y){t.forEach(b,x.hitch(this,function(A){var E=
{};t.forEach(f,x.hitch(this,function(L){var M=A.attributes[L];E[L]=-1===[null,void 0].indexOf(M)&&M.toString?M.toString():M}));if(JSON.stringify(y.compareValues)===JSON.stringify(E)){var J=A.attributes[this.oidField];-1!==y.featureId?(y.hasMultiDuplicates=!0,"undefined"===typeof y.featureIds?(y.featureIds=[y.featureId,J],y.features=[y.feature,A]):(y.featureIds.push(J),y.features.push(A))):(y.featureId=J,y.feature=A,u.push(y))}}))}));n.resolve(u)}));return n},_getAllLayerFeatures:function(n,b){var g=
new C,f=[this.editLayer.objectIdField];t.forEach(b,function(u){u.name&&f.push(u.name)});2>f.length&&(f=b);var r=n.maxRecordCount;b=new m;b.where="1\x3d1";n.queryIds(b).then(function(u){var y=[],A;if(u&&0<u.length){var E=0;for(A=u.length;E<A;E+=r){var J=new m;J.outFields=f;J.objectIds=u.slice(E,E+r);J.returnGeometry=!0;y.push(n.queryFeatures(J))}(new H(y)).then(x.hitch(this,function(L){if(L){for(var M=[],O=0;O<L.length;O++)L[O][1].features&&M.push.apply(M,L[O][1].features.map(function(P){return{geometry:P.geometry,
attributes:P.attributes}}));g.resolve(M)}}))}else g.resolve([])},function(u){console.error(u);g.resolve({type:"error",message:u})});return g},_locateData:function(n){var b=new C;this._findDuplicates().then(x.hitch(this,function(g){this.duplicateData=g;if(n){var f=x.hitch(this,function(r,u,y){var A=new C,E=this._geocodeSources[u],J=E.locator;J.outSpatialReference=this.spatialReference;var L=[],M=[],O=0;var P=0;var N=r.length;for(;P<N;P+=500){var Q=r.slice(P,P+500),R=[];(E.singleEnabled||E.multiEnabled)&&
t.forEach(Q,x.hitch(this,function(T){var V=T._csvId,Y=null;a:for(S in this.duplicateData){var Z=this.duplicateData[S];if(Z.fileId===V){Y=x.mixin({},Z);delete this.duplicateData[S];break a}}var U={};U.OBJECTID=V;if(this.useMultiFields)t.forEach(this.multiFields,x.hitch(this,function(ba){this._currentAddressFields=this.multiFields;if(ba.value!==this.nls.noValue){var da=this.csvStore.getValue(T,ba.value);U[ba.keyField]=da}else U[ba.keyField]=void 0}));else if(this.singleFields[0].value!==this.nls.noValue){this._currentAddressFields=
this.singleFields;var S=this.csvStore.getValue(T,this.singleFields[0].value);"undefined"===typeof S&&(S=typeof S+V);U[E.singleLineFieldName]=S}S=x.mixin({},U);S=JSON.stringify(S);if(null===Y)R.push(U),y[S]={index:O,csvIndex:V,location:{}},O+=1;else if(null!==Y){Z=Y.feature.geometry;var aa=Y.feature.attributes;if(-1!==[null,void 0].indexOf(Z)&&Y.features){var W=0;a:for(;W<Y.features.length;W++){var ca=Y.features[W];if(-1===[null,void 0].indexOf(ca.geometry)){Z=ca.geometry;aa=ca.attributes;break a}}}y[S]=
{index:-1,csvIndex:V,isDuplicate:!0,location:x.mixin({},Z),featureAttributes:aa}}}));this.useMultiFields&&E.multiEnabled||!this.useMultiFields&&E.singleEnabled?M.push(J.addressesToLocations({addresses:R,countryCode:E.countryCode,outFields:["ResultID","Score"]})):(Q=new C,Q.reject(this.nls.warningsAndErrors.notConfigured,!0),M.push(Q))}var X=Object.keys(y);(new H(M)).then(x.hitch(this,function(T){this.minScore=this._geocodeSources[u]?this._geocodeSources[u].minCandidateScore:90;u+=1;var V=this._geocodeSources.length>
u;if(T&&T.length&&T[0].length&&!1===T[0][0])if(1<T[0].length&&console.error(T[0][1]),(this.useMultiFields&&E.multiEnabled||!this.useMultiFields&&E.singleEnabled)&&this.parent.locatorError(this._geocodeSources[u-1].locator.url,!1),this._removeLocators.push(u-1),V)f(this._remainingStoreItems||this.storeItems,u,this._currentFinalResults||{}).then(x.hitch(this,function(U){A.resolve(U)}));else return 1<this._geocodeSources.length?A.resolve(y):A.reject(this.nls.warningsAndErrors.noMoreLocators),A.promise;
else if(T){var Y=this.minScore,Z=0;t.forEach(T,x.hitch(this,function(U){U=U[1];t.forEach(U,function(S){S.ResultID=S.attributes.ResultID});U=F(new z({data:U,idProperty:"ResultID"})).query({},{sort:[{attribute:"ResultID"}]});t.forEach(U,x.hitch(this,function(S){for(var aa in X){var W=X[aa];if(y[W]&&y[W].index===Z){S.attributes.Score<Y?V?(L.push(r[y[W].csvIndex]),delete y[W]):y[W].score=S.attributes.Score:(y[W].location=S.location,y[W].score=S.attributes.Score,delete y[W].index);delete X[aa];break}}Z+=
1}))}));if(V&&0<L.length)this._remainingStoreItems=L,this._currentFinalResults=y,f(L,u,y).then(x.hitch(this,function(U){A.resolve(U)}));else return A.resolve(y),A.promise}}),x.hitch(this,function(T){console.log(T);u+=1;if(this._geocodeSources.length>u)f(this._remainingStoreItems||this.storeItems,u,this._currentFinalResults||{}).then(x.hitch(this,function(V){A.resolve(V)}));else return 1<this._geocodeSources.length?A.resolve(y):A.reject(this.nls.warningsAndErrors.noMoreLocators),A.promise}));return A});
this._removeLocators=[];f(this.storeItems,0,{}).then(x.hitch(this,function(r){b.resolve(r)}),x.hitch(this,function(r){b.reject(r)}))}else this._currentAddressFields=[{keyField:this.xFieldName,label:this.xFieldName,value:this.xFieldName},{keyField:this.yFieldName,label:this.yFieldName,value:this.yFieldName}],this._xyData({storeItems:this.storeItems,csvStore:this.csvStore,xFieldName:this.xFieldName,yFieldName:this.yFieldName,wkid:this.spatialReference.wkid}).then(x.hitch(this,function(r){if(this.isGeographic&&
!this.map.spatialReference.isWebMercator()&&4326!==this.spatialReference.wkid){var u=[];t.forEach(r,function(A){u.push(A.location)});var y=1<u.length?a.union(u):a.buffer(u[0],100,9001);this._projectPoints(y,u).then(function(A){for(var E=0;E<r.length;E++)r[E].location=A[E];b.resolve(r)})}else b.resolve(r)}),function(r){b.reject(r)})}));return b},_xyData:function(n){var b=new C,g=[],f=n.csvStore;t.forEach(n.storeItems,x.hitch(this,function(r){var u=r._csvId,y=null;a:for(J in this.duplicateData){var A=
this.duplicateData[J];if(A.fileId===u){y=x.mixin({},A);delete this.duplicateData[J];break a}}var E={};var J=f.getAttributes(r);t.forEach(J,function(O){E[O]=f.getValue(r,O)});J=!1;if(null!==y&&y.feature&&y.feature.geometry){A=y.feature.geometry;J=!0;var L=y.feature.attributes}else{y=f.getValue(r,n.xFieldName);var M=f.getValue(r,n.yFieldName);"."!==this.decimalSeperator&&(y=-1!==[null,void 0,""].indexOf(y)?void 0:y.toString().replace(this.decimalSeperator,"."),M=-1!==[null,void 0,""].indexOf(M)?void 0:
M.toString().replace(this.decimalSeperator,"."));y=parseFloat(y);M=parseFloat(M);A=this._getGeometry(y,M);M=isNaN(y)||isNaN(M)?0:100}A&&g.push({attributes:E,location:A,csvIndex:u,score:M,isDuplicate:J,featureAttributes:L})}));b.resolve(g);return b},_getGeometry:function(n,b){"undefined"===typeof this.isGeographic&&(this.isGeographic=/(?=^[-]?\d{1,3}\.)^[-]?\d{1,3}\.\d+|(?=^[-]?\d{4,})|^[-]?\d{1,3}/.exec(n)?!0:!1);n=new v(isNaN(n)?0:n,isNaN(b)?0:b);this.isGeographic&&this.spatialReference.isWebMercator()?
n=B.geographicToWebMercator(n):n.spatialReference=this.isGeographic&&4326!==this.spatialReference.wkid?new k(4326):new k({wkid:this.spatialReference.wkid});return n},_projectPoints:function(n,b){var g=new C;this.gsvc=new l(this.appConfig.geometryService);n={url:this.gsvc.url+"/findTransformations",content:{f:"json",inSR:n.spatialReference.wkid,outSR:this.spatialReference.wkid,extentOfInterest:JSON.stringify(n.getExtent().toJson())},handleAs:"json",callbackParamName:"callback"};p(n,{usePost:!1}).then(x.hitch(this,
function(f){f=(f=f&&f.transformations?f.transformations:void 0)&&0<f.length?f[0].wkid:void 0;var r=new e;r.outSR=this.spatialReference;r.geometries=b;r.transformForward=!0;r.transformation=f;this.gsvc.project(r,x.hitch(this,function(u){g.resolve(u)}),function(u){g.reject(u)})}),function(f){g.reject(f)});return g},_generateFC:function(n){var b={layerDefinition:{geometryType:"esriGeometryPoint",spatialReference:this.spatialReference,objectIdField:this.objectIdField,type:"Feature Layer",drawingInfo:{renderer:{type:"simple",
symbol:this.symbol}},fields:[{name:this.objectIdField,alias:this.objectIdField,type:"esriFieldTypeOID"}]},featureSet:{features:n,geometryType:"esriGeometryPoint"}};t.forEach(this.fsFields,x.hitch(this,function(g){b.layerDefinition.fields.push({name:g.name,alias:g.label,type:g.value,editable:!0,domain:null})}));return b},clear:function(){this._removeLayer(this.matchedFeatureLayer);this._removeLayer(this.unMatchedFeatureLayer);this._removeLayer(this.duplicateFeatureLayer);this.storeItems=this.csvStore=
this.separatorCharacter=this.data=this.fsFields=this.file=void 0;this.duplicateData=[];this.mappedArrayFields=this.duplicateFeatureLayer=this.unMatchedFeatureLayer=this.matchedFeatureLayer=void 0;this.useAddr=!0;this.yFieldName=this.xFieldName=this.addrFieldName=""},_removeLayer:function(n){n&&(this.map.removeLayer(n),n.clear())},_getSeparator:function(){var n=this.data.indexOf("\n"),b=x.trim(this.data.substr(0,n)),g=0,f="";t.forEach([",","      ",";","|"],function(r){var u=b.split(r).length;u>g&&
(g=u,f=r)});this.separatorCharacter=f},_getCsvStore:function(){var n=new C;this.csvStore=new w({data:this.data,separator:this.separatorCharacter});this.csvStore.fetch({onComplete:x.hitch(this,function(b){this.storeItems=b;this._fetchFieldsAndUpdateForm(this.storeItems,this.csvStore,this.fsFields).then(function(g){n.resolve(g)})}),onError:x.hitch(this,function(b){n.reject(b)})});return n},_fetchFieldsAndUpdateForm:function(n,b,g){var f=new C,r=b._attributes,u=this.decimalSeperator,y={};t.forEach(r,
function(A){t.forEach(n,function(E){var J=!0,L=!0,M=!0,O=!0;if(y.hasOwnProperty(A)){L=y[A].supportsInt;M=y[A].supportsFloat;O=y[A].supportsDate;var P=y[A].maxLength;L||M||O||(J=!1)}var N=b.getValue(E,A);if(N){E=N.toString().length;var Q=h(N);if(J){J=-1!==[null,void 0,""].indexOf(N);if(!J&&(O=O&&Q.isValid()))if(Q=N)try{O=!isNaN((new Date(Q)).getTime())}catch(R){console.error(R),O=!1}else O=-1<[null,void 0,""].indexOf(Q)?!0:!1;y[A]={supportsDate:O,supportsInt:J?L:!isNaN(parseInt(N,10))&&parseInt(N,
10).toString().length===E&&L};"."!==u&&(N=J?"":N.toString().replace(u,"."));y[A].supportsFloat=J?M:!isNaN(parseFloat(N))&&parseFloat(N).toString().length===E&&M}L=y[A];L.maxLength=P;"undefined"===typeof L.maxLength?L.maxLength=E:L.maxLength<E&&(L.maxLength=E)}})});f.resolve({fields:r,fieldTypes:y,fsFields:g});return f},_zoomToData:function(n,b){if(n&&0<n.length)try{var g=G.graphicsExtent(n);b?this.map.setExtent(g.expand(1.9),!0):this.map.setExtent(g,!0)}catch(f){console.log(f.message)}},_convertSources:function(){this.geocodeSources&&
0<this.geocodeSources.length&&(this._geocodeSources=t.map(this.geocodeSources,x.hitch(this,function(n){if(n&&n.url&&"locator"===n.type)return{locator:new d(n.url||""),outFields:["ResultID","Score"],singleLineFieldName:n.singleLineFieldName||"",name:q.stripHTML(n.name||""),placeholder:q.stripHTML(n.placeholder||""),countryCode:n.countryCode||"",addressFields:n.addressFields,singleEnabled:n.singleEnabled||!1,multiEnabled:n.multiEnabled||!1,minCandidateScore:n.minCandidateScore||90}})))}})})},"dojox/data/CsvStore":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/xhr dojo/_base/kernel dojo/data/util/filter dojo/data/util/simpleFetch".split(" "),
function(K,t,x,C,H,I){t=t("dojox.data.CsvStore",null,{constructor:function(w){this._attributes=[];this._attributeIndexes={};this._dataArray=[];this._arrayOfAllItems=[];this._loadFinished=!1;w.url&&(this.url=w.url);this._csvData=w.data;w.label?this.label=w.label:""===this.label&&(this.label=void 0);this._storeProp="_csvStore";this._idProp="_csvId";this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0};this._loadInProgress=!1;this._queuedFetches=[];this.identifier=w.identifier;""===this.identifier?
delete this.identifier:this._idMap={};"separator"in w&&(this.separator=w.separator);"urlPreventCache"in w&&(this.urlPreventCache=w.urlPreventCache?!0:!1)},url:"",label:"",identifier:"",separator:",",urlPreventCache:!1,_assertIsItem:function(w){if(!this.isItem(w))throw Error(this.declaredClass+": a function was passed an item argument that was not an item");},_getIndex:function(w){w=this.getIdentity(w);this.identifier&&(w=this._idMap[w]);return w},getValue:function(w,F,z){this._assertIsItem(w);var G=
z;if("string"===typeof F)F=this._attributeIndexes[F],null!=F&&(G=this._dataArray[this._getIndex(w)][F]||z);else throw Error(this.declaredClass+": a function was passed an attribute argument that was not a string");return G},getValues:function(w,F){return(w=this.getValue(w,F))?[w]:[]},getAttributes:function(w){this._assertIsItem(w);var F=[];w=this._dataArray[this._getIndex(w)];for(var z=0;z<w.length;z++)""!==w[z]&&F.push(this._attributes[z]);return F},hasAttribute:function(w,F){this._assertIsItem(w);
if("string"===typeof F)return F=this._attributeIndexes[F],w=this._dataArray[this._getIndex(w)],"undefined"!==typeof F&&F<w.length&&""!==w[F];throw Error(this.declaredClass+": a function was passed an attribute argument that was not a string");},containsValue:function(w,F,z){var G=void 0;"string"===typeof z&&(G=H.patternToRegExp(z,!1));return this._containsValue(w,F,z,G)},_containsValue:function(w,F,z,G){w=this.getValues(w,F);for(F=0;F<w.length;++F){var B=w[F];if("string"===typeof B&&G)return null!==
B.match(G);if(z===B)return!0}return!1},isItem:function(w){if(w&&w[this._storeProp]===this)if(w=w[this._idProp],this.identifier){if(this._dataArray[this._idMap[w]])return!0}else if(0<=w&&w<this._dataArray.length)return!0;return!1},isItemLoaded:function(w){return this.isItem(w)},loadItem:function(w){},getFeatures:function(){return this._features},getLabel:function(w){if(this.label&&this.isItem(w))return this.getValue(w,this.label)},getLabelAttributes:function(w){return this.label?[this.label]:null},
_fetchItems:function(w,F,z){var G=this,B=function(m,k){var c=null;if(m.query){var a;c=[];var e=m.queryOptions?m.queryOptions.ignoreCase:!1,l={};for(a in m.query){var p=m.query[a];"string"===typeof p&&(l[a]=H.patternToRegExp(p,e))}for(e=0;e<k.length;++e){var q=!0,h=k[e];for(a in m.query)p=m.query[a],G._containsValue(h,a,p,l[a])||(q=!1);q&&c.push(h)}}else c=k.slice(0,k.length);F(c,m)};if(this._loadFinished)B(w,this._arrayOfAllItems);else if(""!==this.url)if(this._loadInProgress)this._queuedFetches.push({args:w,
filter:B});else{this._loadInProgress=!0;var v=x.get({url:G.url,handleAs:"text",preventCache:G.urlPreventCache});v.addCallback(function(m){try{G._processData(m),B(w,G._arrayOfAllItems),G._handleQueuedFetches()}catch(k){z(k,w)}});v.addErrback(function(m){G._loadInProgress=!1;if(z)z(m,w);else throw m;});var D=null;w.abort&&(D=w.abort);w.abort=function(){var m=v;m&&-1===m.fired&&(m.cancel(),m=null);D&&D.call(w)}}else if(this._csvData)try{this._processData(this._csvData),this._csvData=null,B(w,this._arrayOfAllItems)}catch(m){z(m,
w)}else{var d=Error(this.declaredClass+": No CSV source data was provided as either URL or String data input.");if(z)z(d,w);else throw d;}},close:function(w){},_getArrayOfArraysFromCsvFileContents:function(w){if(K.isString(w)){var F=/^\s+/g,z=/\s+$/g,G=/""/g,B=[],v=this._splitLines(w);for(w=0;w<v.length;++w){var D=v[w];if(0<D.length){D=D.split(this.separator);for(var d=0;d<D.length;){var m=D[d].replace(F,""),k=m.replace(z,""),c=k.charAt(0),a=k.charAt(k.length-1),e=k.charAt(k.length-2),l=k.charAt(k.length-
3);if(2===k.length&&'""'==k)D[d]="";else if('"'==c&&('"'!=a||'"'==a&&'"'==e&&'"'!=l)){if(d+1===D.length)return;D[d]=m+this.separator+D[d+1];D.splice(d+1,1)}else'"'==c&&'"'==a&&(k=k.slice(1,k.length-1),k=k.replace(G,'"')),D[d]=k,d+=1}B.push(D)}}this._attributes=B.shift();for(w=0;w<this._attributes.length;w++)this._attributeIndexes[this._attributes[w]]=w;this._dataArray=B}},_splitLines:function(w){var F=[],z,G="",B=!1;for(z=0;z<w.length;z++){var v=w.charAt(z);switch(v){case '"':B=!B;G+=v;break;case "\r":B?
G+=v:(F.push(G),G="",z<w.length-1&&"\n"==w.charAt(z+1)&&z++);break;case "\n":B?G+=v:(F.push(G),G="");break;default:G+=v}}""!==G&&F.push(G);return F},_processData:function(w){this._getArrayOfArraysFromCsvFileContents(w);this._arrayOfAllItems=[];if(this.identifier&&void 0===this._attributeIndexes[this.identifier])throw Error(this.declaredClass+": Identity specified is not a column header in the data set.");for(w=0;w<this._dataArray.length;w++){var F=w;this.identifier&&(F=this._dataArray[w][this._attributeIndexes[this.identifier]],
this._idMap[F]=w);this._arrayOfAllItems.push(this._createItemFromIdentity(F))}this._loadFinished=!0;this._loadInProgress=!1},_createItemFromIdentity:function(w){var F={};F[this._storeProp]=this;F[this._idProp]=w;return F},getIdentity:function(w){return this.isItem(w)?w[this._idProp]:null},fetchItemByIdentity:function(w){var F=w.scope?w.scope:C.global;if(this._loadFinished){var z=this._createItemFromIdentity(w.identity);this.isItem(z)||(z=null);w.onItem&&w.onItem.call(F,z)}else{var G=this;if(""!==
this.url)this._loadInProgress?this._queuedFetches.push({args:w}):(this._loadInProgress=!0,z=x.get({url:G.url,handleAs:"text"}),z.addCallback(function(B){try{G._processData(B);var v=G._createItemFromIdentity(w.identity);G.isItem(v)||(v=null);w.onItem&&w.onItem.call(F,v);G._handleQueuedFetches()}catch(D){w.onError&&w.onError.call(F,D)}}),z.addErrback(function(B){this._loadInProgress=!1;w.onError&&w.onError.call(F,B)}));else if(this._csvData)try{G._processData(G._csvData),G._csvData=null,z=G._createItemFromIdentity(w.identity),
G.isItem(z)||(z=null),w.onItem&&w.onItem.call(F,z)}catch(B){w.onError&&w.onError.call(F,B)}}},getIdentityAttributes:function(w){return this.identifier?[this.identifier]:null},_handleQueuedFetches:function(){if(0<this._queuedFetches.length){for(var w=0;w<this._queuedFetches.length;w++){var F=this._queuedFetches[w],z=F.filter,G=F.args;z?z(G,this._arrayOfAllItems):this.fetchItemByIdentity(F.args)}this._queuedFetches=[]}}});K.extend(t,I);return t})},"esri/tasks/locator":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ./Task ./AddressCandidate".split(" "),
function(K,t,x,C,H,I,w,F,z,G,B){K=K(G,{declaredClass:"esri.tasks.Locator",_eventMap:{"address-to-locations-complete":["addresses"],"addresses-to-locations-complete":["addresses"],"location-to-address-complete":["address"],"suggest-locations-complete":["suggestions"]},constructor:function(v){this._geocodeHandler=t.hitch(this,this._geocodeHandler);this._geocodeAddressesHandler=t.hitch(this,this._geocodeAddressesHandler);this._reverseGeocodeHandler=t.hitch(this,this._reverseGeocodeHandler);this.registerConnectEvents()},
outSpatialReference:null,setOutSpatialReference:function(v){this.outSpatialReference=v},_geocodeHandler:function(v,D,d,m,k){try{var c=v.candidates;D=[];var a,e=c.length,l=v.spatialReference,p;for(a=0;a<e;a++){var q=c[a];if(p=q.location)p.spatialReference=l;D[a]=new B(q)}this._successHandler([D],"onAddressToLocationsComplete",d,k)}catch(h){this._errorHandler(h,m,k)}},_geocodeAddressesHandler:function(v,D,d,m,k){try{var c=v.locations;D=[];var a,e=c.length,l=v.spatialReference,p;for(a=0;a<e;a++){if(p=
c[a].location)p.spatialReference=l;D[a]=new B(c[a])}this._successHandler([D],"onAddressesToLocationsComplete",d,k)}catch(q){this._errorHandler(q,m,k)}},addressToLocations:function(v,D,d,m,k){var c;if(v.address){m=d;d=D;D=v.outFields;k=v.searchExtent;var a=v.countryCode;var e=v.magicKey;var l=v.distance;var p=v.categories;v.location&&this.normalization&&(c=v.location.normalize());var q=v.locationType;var h=v.maxLocations;var n=v.forStorage;v=v.address}k&&(k=k.shiftCentralMeridian());var b=this.outSpatialReference;
v=this._encode(t.mixin({},this._url.query,v,{f:"json",outSR:b&&H.toJson(b.toJson()),outFields:D&&D.join(",")||null,searchExtent:k&&H.toJson(k.toJson()),category:p&&p.join(",")||null,countryCode:a||null,magicKey:e||null,distance:l||null,location:c||null,locationType:q||null,maxLocations:h||null,forStorage:n||null}));var g=this._geocodeHandler,f=this._errorHandler,r=new C(z._dfdCanceller);r._pendingDfd=F({url:this._url.path+"/findAddressCandidates",content:v,callbackParamName:"callback",load:function(u,
y){g(u,y,d,m,r)},error:function(u){f(u,m,r)}});return r},suggestLocations:function(v){var D=new C(z._dfdCanceller);v.hasOwnProperty("location")&&this.normalization&&(v.location=v.location.normalize());v.searchExtent&&(v.searchExtent=v.searchExtent.shiftCentralMeridian());v=this._encode(t.mixin({},this._url.query,{f:"json",text:v.text,maxSuggestions:v.maxSuggestions,searchExtent:v.searchExtent&&H.toJson(v.searchExtent.toJson()),category:v.categories&&v.categories.join(",")||null,countryCode:v.countryCode||
null,location:v.location||null,distance:v.distance||null},{f:"json"}));v=F({url:this._url.path+"/suggest",content:v,callbackParamName:"callback"});D._pendingDfd=v;v.then(t.hitch(this,function(d){d=d.suggestions||[];this.onSuggestLocationsComplete(d);D.resolve(d)}),t.hitch(this,function(d){this._errorHandler(d);D.reject(d)}));return D},addressesToLocations:function(v,D,d){var m=this.outSpatialReference,k=[],c=v.categories,a=v.locationType,e=v.countryCode;x.forEach(v.addresses,function(h,n){k.push({attributes:h})});
v=this._encode(t.mixin({},this._url.query,{category:c&&c.join(",")||null,locationType:a||null,sourceCountry:e||null},{addresses:H.toJson({records:k})},{f:"json",outSR:m&&H.toJson(m.toJson())}));var l=this._geocodeAddressesHandler,p=this._errorHandler,q=new C(z._dfdCanceller);q._pendingDfd=F({url:this._url.path+"/geocodeAddresses",content:v,callbackParamName:"callback",load:function(h,n){l(h,n,D,d,q)},error:function(h){p(h,d,q)}});return q},_reverseGeocodeHandler:function(v,D,d,m,k){try{var c=new B({address:v.address,
location:v.location,score:100});this._successHandler([c],"onLocationToAddressComplete",d,k)}catch(a){this._errorHandler(a,m,k)}},locationToAddress:function(v,D,d,m){v&&this.normalization&&(v=v.normalize());var k=this.outSpatialReference;v=this._encode(t.mixin({},this._url.query,{outSR:k&&H.toJson(k.toJson()),location:v&&H.toJson(v.toJson()),distance:D,f:"json"}));var c=this._reverseGeocodeHandler,a=this._errorHandler,e=new C(z._dfdCanceller);e._pendingDfd=F({url:this._url.path+"/reverseGeocode",content:v,
callbackParamName:"callback",load:function(l,p){c(l,p,d,m,e)},error:function(l){a(l,m,e)}});return e},onSuggestLocationsComplete:function(){},onAddressToLocationsComplete:function(){},onAddressesToLocationsComplete:function(){},onLocationToAddressComplete:function(){}});I("extend-esri")&&t.setObject("tasks.Locator",K,w);return K})},"esri/tasks/AddressCandidate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../geometry/Point"],function(K,t,x,C,H){K=K(null,{declaredClass:"esri.tasks.AddressCandidate",
constructor:function(I){t.mixin(this,I);this.location=new H(this.location)}});x("extend-esri")&&t.setObject("tasks.AddressCandidate",K,C);return K})},"widgets/DataAggregation/js/UI/Addresses":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-class dojo/Deferred dojo/on dojo/query dojo/keys dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/Addresses.html jimu/dijit/formSelect dijit/form/RadioButton".split(" "),
function(K,t,x,C,H,I,w,F,z,G,B,v,D,d,m){return K([G,B,v,D],{baseClass:"cf-addresses",declaredClass:"CriticalFacilities.Addresses",templateString:d,_started:null,label:"Addresses",parent:null,nls:null,map:null,appConfig:null,config:null,singleFields:[],multiFields:[],fields:[],useSingle:!0,useMulti:!1,theme:"",styleColor:"",singleEnabled:!1,multiEnabled:!1,constructor:function(k){t.mixin(this,k)},postCreate:function(){this.inherited(arguments);this._initControls()},startup:function(){this._started=
!0;this._updateAltIndexes()},onShown:function(){this.pageContainer.nextDisabled=!1;this.prevResult=this._getResults()},validate:function(k,c){var a=new I;"next-view"===k?a.resolve(this._nextView(c)):"back-view"===k?a.resolve(this._backView(c)):this._homeView(c).then(function(e){a.resolve(e)});return a},_updateAltIndexes:function(){this.pageContainer&&!this._startPageView&&(this._startPageView=this.pageContainer.getViewByTitle("StartPage"),this._locationTypeView=this.pageContainer.getViewByTitle("LocationType"),
this._startPageView&&this._locationTypeView?(this.altNextIndex=this._startPageView.index,this.altBackIndex=this._locationTypeView.index):this._startPageView&&(this.altBackIndex=this.altNextIndex=this._startPageView.index))},_nextView:function(k){if(k.currentView.label===this.label){k=this._getResults();var c=!1;x.forEach(k.fields,function(a){"undefined"!==typeof a.value&&null!==a.value&&""!==a.value&&(c=!0)});this.parent._locationMappingComplete=c;this.emit("location-mapping-update",c)}return!0},
_backView:function(k){if(k.currentView.label===this.label){var c=!1;this._setPreviousResult(this.prevResult?this.prevResult.mappedArrayFields:{});this.prevResult&&(k=this.prevResult,c=!1,x.forEach(k.fields,function(a){"undefined"!==typeof a.value&&null!==a.value&&""!==a.value&&(c=!0)}));this.parent._locationMappingComplete=c;this.emit("location-mapping-update",c)}return!0},_homeView:function(k){var c=new I;this.pageContainer.getViewByTitle("Home").verifyClearSettings(k).then(function(a){c.resolve(a)});
return c},_rdoSingleAddressClick:function(){this.rdoSingleAddress.set("checked",!0)},_rdoSingleAddressChanged:function(k){this.useSingle=k;this._toggleVisibility(this.singleFieldTable,k);this.useSingle&&this.parent.updateFirstLastNode(!1)},_rdoMultiAddressClick:function(){this.rdoMultiAddress.set("checked",!0)},_rdoMultiAddressChanged:function(k){this.useMulti=k;this._toggleVisibility(this.multiFieldTable,k);this.useMulti&&this.parent.updateFirstLastNode(!1)},_toggleVisibility:function(k,c){var a=
c?"display-table-row-group":"display-none";H.contains(k,a)||H.add(k,a);a=c?"display-none":"display-table-row-group";H.contains(k,a)&&H.remove(k,a);c&&(this.lastFocusNode=F(".lastNode",k)[0])},_initControls:function(){this.own(w(this.rdoSingleAddress,"change",t.hitch(this,this._rdoSingleAddressChanged)));this.own(w(this.rdoMultiAddress,"change",t.hitch(this,this._rdoMultiAddressChanged)));var k=this.singleEnabled,c=this.multiEnabled;k&&c?(this.rdoSingleAddress.set("checked",this.useSingle),this._toggleVisibility(this.singleFieldTable,
this.useSingle),this.rdoMultiAddress.set("checked",this.useMulti),this._toggleVisibility(this.multiFieldTable,this.useMulti),this._setFields(this.singleFields,this.fields,this.singleFieldTable),this._setFields(this.multiFields,this.fields,this.multiFieldTable),H.contains(this.singleSubTaskHintTr,"bottom-border-bold")&&H.remove(this.singleSubTaskHintTr,"bottom-border-bold"),H.add(this.singleSubTaskHintTr,"bottom-border")):k?(this.useSingle=!0,this.useMulti=!1,this._setFields(this.singleFields,this.fields,
this.singleFieldTable),this._initTableDisplay([this.multiAddressRow,this.mainInstructionRow,this.singleRadioRow],[this.singleFieldHintTd,this.singleFieldTableRow],[],[this.singleSubTaskHintTd])):c&&(this.useMulti=!0,this.useSingle=!1,this._setFields(this.multiFields,this.fields,this.multiFieldTable),this._initTableDisplay([this.singleAddressRow,this.mainInstructionRow,this.multiRadioRow],[this.multiFieldHintTd,this.multiFieldTableRow],[],[this.multiSubTaskHintTd]))},_initTableDisplay:function(k,c,
a,e){x.forEach(k,t.hitch(this,function(l){this._toggleVisibility(l,!1)}));x.forEach(c,t.hitch(this,function(l){H.add(l,"no-padding")}));x.forEach(a,t.hitch(this,function(l){H.add(l,"pad-bottom-10")}));x.forEach(e,function(l){H.contains(l,"pad-left-20")&&H.remove(l,"pad-left-20");H.add(l,"pad-left-5")})},_setFields:function(k,c,a){var e=0;x.forEach(k,t.hitch(this,function(l,p){var q=C.create("tr",{},a);q.keyField=l.value;q.label=l.label;var h=C.create("td",{className:"field-control-td pad-left-15"},
q);C.create("div",{className:"main-text float-left min-width-80",innerHTML:l.label},h);h=C.create("td",{className:"field-control-td"},q);var n=new m({name:"field"+e,fieldName:l.label,className:"field-control","aria-label":l.label});p===k.length-1&&(H.add(n.domNode,"lastNode"),this.lastFocusNode=n.domNode,this.parent.updateFirstLastNode(!1));var b=[{label:this.nls.warningsAndErrors.noValue,value:this.nls.warningsAndErrors.noValue}],g=this._getDefaultFieldName(c,l);x.forEach(c,function(f){b.push({label:f.label,
value:f.value,selected:f.value===g})});n.addOption(b);n.placeAt(h);n.startup();q.fieldControl=n;e+=1;1<k.length&&H.add(q,"bottom-border")}))},_getDefaultFieldName:function(k,c){c=c.isRecognizedValues;for(var a=0;a<c.length;a++)for(var e=c[a],l=0;l<k.length;l++){var p=k[l];if(p.value.toString().toUpperCase()===e.toString().toUpperCase())return p.value}},setStyleColor:function(k){this.styleColor=k},updateImageNodes:function(){},_getResults:function(){var k=[],c={},a=this.nls.warningsAndErrors.noValue;
x.forEach((this.useSingle?this.singleFieldTable:this.multiFieldTable).rows,function(e){var l=e.fieldControl.get("value"),p=e.label;e=e.keyField;l!==a?(k.push({keyField:e,value:l,label:p}),c[e]=l):(k.push({keyField:e,value:void 0,label:p}),c[e]=void 0)});return{type:this.useSingle?"single":"multi",fields:k,mappedArrayFields:c}},_setPreviousResult:function(k){var c=this.nls.warningsAndErrors.noValue;x.forEach((this.useSingle?this.singleFieldTable:this.multiFieldTable).rows,function(a){var e=c,l=a.keyField;
k.hasOwnProperty(l)&&(e=k[l],void 0===e&&(e=c));a.fieldControl.set("value",e)})}})})},"widgets/DataAggregation/js/UI/Coordinates":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/dom-construct dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/Coordinates.html dojo/_base/array jimu/dijit/formSelect".split(" "),function(K,t,x,C,H,I,w,F,z,G,B){return K([H,I,w,F],{baseClass:"cf-coordinates",declaredClass:"CriticalFacilities.Coordinates",
templateString:z,_started:null,label:"Coordinates",parent:null,nls:null,map:null,appConfig:null,config:null,fields:[],xField:null,yField:null,theme:"",styleColor:"",firstField:"",constructor:function(v){t.mixin(this,v)},postCreate:function(){this.inherited(arguments);this._initUI()},_initUI:function(){"X"===this.firstField?(this._initXField(),this._initYField()):(this._initYField(),this._initXField());this._setFields(this.fields,this.xField,this.yField)},_initXField:function(){var v=this._initSelectTd(this.xField.label+
":");this.lblX=v.label;this.selectX=new B({name:"selectX",style:"min-width: 200px","aria-label":this.xField.label});this.selectX.placeAt(v.select);this.selectX.startup()},_initYField:function(){var v=this._initSelectTd(this.yField.label+":");this.lblY=v.label;this.selectY=new B({name:"selectY",style:"min-width: 200px","aria-label":this.yField.label});this.selectY.placeAt(v.select);this.selectY.startup();this.lastFocusNode=this.selectY.domNode},_initSelectTd:function(v){var D=C.create("tr",{className:"bottom-border"},
this.coordinateTable),d=C.create("td",{className:"field-control-td pad-left-10"},D);d=C.create("div",{className:"main-text float-left"},d);d.innerHTML=v;return{select:C.create("td",{className:"float-right field-control-td"},D),label:d}},startup:function(){this._started=!0;this._updateAltIndexes()},onShown:function(){this.pageContainer.nextDisabled=!1;this.prevResult=this._getResults()},validate:function(v,D){var d=new x;"next-view"===v?d.resolve(this._nextView(D)):"back-view"===v?d.resolve(this._backView(D)):
this._homeView(D).then(function(m){d.resolve(m)});return d},_updateAltIndexes:function(){this.pageContainer&&!this._startPageView&&(this._startPageView=this.pageContainer.getViewByTitle("StartPage"),this._locationTypeView=this.pageContainer.getViewByTitle("LocationType"),this._startPageView&&this._locationTypeView?(this.altNextIndex=this._startPageView.index,this.altBackIndex=this._locationTypeView.index):this._startPageView&&(this.altBackIndex=this.altNextIndex=this._startPageView.index))},_nextView:function(v){v.currentView.label===
this.label&&(v=0<this._getResults().fields.length,this.parent._locationMappingComplete=v,this.emit("location-mapping-update",v));return!0},_backView:function(v){v.currentView.label===this.label&&(v=!1,this._setPreviousResult(this.prevResult?this.prevResult.fields:[]),this.prevResult&&(v=0<this.prevResult.fields.length),this.parent._locationMappingComplete=v,this.emit("location-mapping-update",v));return!0},_homeView:function(v){var D=new x;this.pageContainer.getViewByTitle("Home").verifyClearSettings(v).then(function(d){D.resolve(d)});
return D},_setFields:function(v,D,d){var m=this._getDefaultFieldName(v,D),k=this._getDefaultFieldName(v,d),c=[{label:this.nls.warningsAndErrors.noValue,value:this.nls.warningsAndErrors.noValue}],a=[{label:this.nls.warningsAndErrors.noValue,value:this.nls.warningsAndErrors.noValue}];G.forEach(v,function(e){c.push({label:e.label,value:e.value,selected:m===e.value});a.push({label:e.label,value:e.value,selected:k===e.value})});this.selectX.addOption(c);this.selectY.addOption(a)},_getDefaultFieldName:function(v,
D){D=D.isRecognizedValues;for(var d=0;d<D.length;d++)for(var m=D[d],k=0;k<v.length;k++){var c=v[k];if(c.value.toString().toUpperCase()===m.toString().toUpperCase())return c.value}},setStyleColor:function(v){this.styleColor=v},updateImageNodes:function(){},_getResults:function(){return{type:"xy",fields:this.selectX.value!==this.nls.warningsAndErrors.noValue&&this.selectY.value!==this.nls.warningsAndErrors.noValue?[{targetField:"X",sourceField:this.selectX.value},{targetField:"Y",sourceField:this.selectY.value}]:
[]}},_setPreviousResult:function(v){if(0===v.length){v=this._getDefaultFieldName(this.fields,this.xField);var D=this._getDefaultFieldName(this.fields,this.yField);v=[{targetField:"X",sourceField:v},{targetField:"Y",sourceField:D}]}G.forEach(v,function(d){var m=d.sourceField;void 0===m&&(m=this.nls.warningsAndErrors.noValue);d=d.targetField;"X"===d?this.selectX.set("value",m):"Y"===d&&this.selectY.set("value",m)},this)}})})},"widgets/DataAggregation/js/UI/FieldMapping":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-class dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/FieldMapping.html jimu/dijit/SimpleTable jimu/dijit/formSelect".split(" "),
function(K,t,x,C,H,I,w,F,z,G,B,v,D){return K([w,F,z,G],{baseClass:"cf-field-mapping",declaredClass:"CriticalFacilities.FieldMapping",templateString:B,_started:null,label:"FieldMapping",parent:null,nls:null,map:null,appConfig:null,config:null,targetFields:[],sourceFields:[],_fieldsTable:null,theme:"",styleColor:"",constructor:function(d){t.mixin(this,d)},postCreate:function(){this.inherited(arguments);this._initFieldsTable();this._initFields(this.targetFields)},startup:function(){this._started=!0;
this._updateAltIndexes()},targetLayerUpdate:function(d,m){this._fieldsTable.clear();this.parent._fieldMappingComplete=!1;this.emit("field-mapping-update",!1);this.targetFields=d;this.sourceFields=m;this._initFields(this.targetFields)},onShown:function(){this.pageContainer.nextDisabled=!1;this.prevResult=this._getResults()},_updateAltIndexes:function(){this.pageContainer&&!this._startPageView&&(this._startPageView=this.pageContainer.getViewByTitle("StartPage"))&&(this.altBackIndex=this.altNextIndex=
this._startPageView.index)},validate:function(d,m){var k=new I;"next-view"===d?k.resolve(this._nextView(m)):"back-view"===d?k.resolve(this._backView(m)):this._homeView(m).then(function(c){k.resolve(c)});return k},_nextView:function(d){if(d.currentView.label===this.label){var m=this._getResults(),k=!1;d=Object.keys(m.results).map(function(c){return m.results[c]});x.forEach(d,function(c){"undefined"!==typeof c&&null!==c&&""!==c&&(k=!0)});this.parent._fieldMappingComplete=k;this.emit("field-mapping-update",
k,m.results)}return!0},_backView:function(d){if(d.currentView.label===this.label){var m=!1;this._setPreviousResult(this.prevResult?this.prevResult.results:{});if(this.prevResult){var k=this.prevResult;d=Object.keys(k.results).map(function(c){return k.results[c]});x.forEach(d,function(c){"undefined"!==typeof c&&null!==c&&""!==c&&(m=!0)})}this.parent._fieldMappingComplete=m;this.emit("field-mapping-update",m)}return!0},_homeView:function(d){var m=new I;this.pageContainer.getViewByTitle("Home").verifyClearSettings(d).then(function(k){m.resolve(k)});
return m},_initFieldsTable:function(){var d=[{name:"targetField",type:"extension",hidden:!0,create:t.hitch(this,this._createTargetField),setValue:t.hitch(this,this._setTargetFieldValue),getValue:t.hitch(this,this._getTargetFieldValue)},{name:"target",title:this.nls.fieldMapping.targetField,type:"text","class":"task-instruction-row"},{name:"label",title:this.nls.fieldMapping.sourceField,type:"extension",hidden:!1,create:t.hitch(this,this._createSelect),setValue:t.hitch(this,this._setSelectValue),getValue:t.hitch(this,
this._getSelectValue)}];this._fieldsTable=new v({fields:d,selectable:!1,autoHeight:!0,_rowHeight:"LaunchpadTheme"===this.appConfig.theme.name?36:30});this._fieldsTable.placeAt(this.fieldMappingTable);this._fieldsTable.startup()},_setTargetFieldValue:function(d,m){d.targetField=m},_getTargetFieldValue:function(d){return d.targetField},_createSelect:function(d){var m=d.parentNode.cells[0].targetField,k=new D({style:{display:"table",width:"100%",height:"28px"},"aria-label":m.label}),c=this._getSupportedFields(this.sourceFields,
m.type,m.length),a=[{label:this.nls.warningsAndErrors.noValue,value:this.nls.warningsAndErrors.noValue}],e=this._getDefaultFieldName(c,m);x.forEach(c,function(l){a.push({label:l.label,value:l.value,selected:e===l.value})});k.addOption(a);d.fieldsSelect=k;C.place(k.domNode,d);H.add(d,"float-left");H.add(d,"width-all");this.lastFieldSelect=k.domNode},_getSelectValue:function(d){return d.fieldsSelect.get("value")},_setSelectValue:function(d,m){d.fieldsSelect.set("value",m)},_initFields:function(d){x.forEach(d,
t.hitch(this,function(m){this._fieldsTable.addRow({target:m.label,targetField:m})}))},_getSupportedFields:function(d,m,k){return d.filter(function(c){if(c.type){var a=c.type.supportsInt,e=c.type.supportsFloat,l=c.type.supportsDate;c=c.type.maxLength;return"date"!==m&&c>k?!1:"other"===m||"domain"===m?!0:"int"===m||"domainInt"===m?a:"float"===m?e:"date"===m?l:!1}return!1})},_getDefaultFieldName:function(d,m){m=m.isRecognizedValues;for(var k=0;k<m.length;k++)for(var c=m[k],a=0;a<d.length;a++){var e=
d[a];if(e.value.toString().toUpperCase()===c.toString().toUpperCase())return e.value}},setStyleColor:function(d){this.styleColor=d},updateImageNodes:function(){},_getResults:function(){var d=this._fieldsTable.getRows(),m={},k=this.nls.warningsAndErrors.noValue,c=!1,a;x.forEach(d,function(e){var l=e.cells[2].fieldsSelect.getValue();l!==k?(e=e.cells[0].targetField.name,m[e]=l,c||(a=e,c=!0)):m[e.cells[0].targetField.name]=void 0});return{results:m,labelField:a}},_setPreviousResult:function(d){var m=
this._fieldsTable.getRows(),k=this.nls.warningsAndErrors.noValue;x.forEach(m,function(c){var a=k,e=c.cells[0].targetField.name;d.hasOwnProperty(e)&&(a=d[e],void 0===a&&(a=k));c.cells[2].fieldsSelect.set("value",a)})}})})},"widgets/DataAggregation/js/UI/StartPage":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/on dojo/Deferred dojo/keys dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/StartPage.html dojo/dom-class dojo/query esri/lang ./Review jimu/LayerInfos/LayerInfos jimu/utils jimu/dijit/formSelect".split(" "),
function(K,t,x,C,H,I,w,F,z,G,B,v,D,d,m,k,c){return K([w,F,z,G],{baseClass:"cf-startpage",declaredClass:"CriticalFacilities.StartPage",templateString:B,_started:null,label:"StartPage",parent:null,nls:null,map:null,appConfig:null,config:null,theme:"",styleColor:"",state:"mapping",csvStore:null,_syncFields:{},singleEnabled:!1,multiEnabled:!1,xyEnabled:!1,constructor:function(a){t.mixin(this,a)},postCreate:function(){this.inherited(arguments);k.getInstance(this.map,this.map.itemInfo).then(t.hitch(this,
function(a){this.operLayerInfos=a;this.populateTargetLayerSelector();this.own(C(this.targetLayerSelector,"change",t.hitch(this,function(e){this.emit("targetLayerChanged",e)})))}))},startup:function(){this._started=!0;this.pageContainer.backDisabled=0<this.pageContainer._backLabels.length?!1:!0;this.updateImageNodes();this.lastFocusNode=this.fieldMappingRow},populateTargetLayerSelector:function(){var a=this.config.layerSettings,e=[];a&&a.layerInfo&&a.layerInfo.featureLayer&&(a=[a]);for(var l=0;l<a.length;l++){var p;
a[l]&&a[l].layerInfo&&a[l].layerInfo.featureLayer&&(p=this.operLayerInfos.getLayerInfoById(a[l].layerInfo.featureLayer.id));p&&p.layerObject.isEditable()&&e.push({label:p.title,value:p.id})}this.targetLayerSelector.set("options",e);0<e.length&&this.targetLayerSelector.set("value",e[0].value)},onShown:function(){this._initDependencies();this._validateStatus();this.pageContainer.backDisabled=0<this.pageContainer._backLabels.length?!1:!0},setStyleColor:function(a){this.styleColor=a},updateImageNodes:function(){if(this.pageContainer){var a=
this.pageContainer.isDarkTheme,e=a?"next-arrow-img":"next-arrow-img-white",l=a?"next-arrow-img-white":"next-arrow-img";a=D("."+e,this.domNode);x.forEach(a,function(p){v.remove(p,e);v.add(p,l)})}},validate:function(a,e){var l=new H;"next-view"===a?l.resolve(this._nextView(e)):"back-view"===a?l.resolve(this._backView()):"home-view"===a&&this._homeView(e).then(function(p){l.resolve(p)});return l},_nextView:function(a){a.navView.label===this.label&&this.pageContainer.toggleController(!1);if(this.parent._locationMappingComplete&&
this.parent._fieldMappingComplete)return this.nextDisabled=!0,!1;this.pageContainer.backDisabled=!1;return!0},_backView:function(){return 0<this.pageContainer._backLabels.length},_homeView:function(a){var e=new H;this.pageContainer.getViewByTitle("Home").verifyClearSettings(a).then(function(l){e.resolve(l)});return e},_locationMappingClick:function(a){if("keydown"!==a.type||a.keyCode===I.ENTER||a.keyCode===I.SPACE)this._validateStatus(),this._setViewByTitle(this.xyEnabled&&(this.multiEnabled||this.singleEnabled)?
"LocationType":this.xyEnabled?"Coordinates":"Addresses")},_schemaMappingClick:function(a){if("keydown"!==a.type||a.keyCode===I.ENTER||a.keyCode===I.SPACE)this._validateStatus(),this._setViewByTitle("FieldMapping")},_setViewByTitle:function(a){a=this.pageContainer.getViewByTitle(a);this.pageContainer.selectView(a.index)},_initDependencies:function(){if(this.pageContainer&&!this._coordinatesView&&!this._addressView&&!this._fieldMappingView){this.xyEnabled&&(this._coordinatesView=this.pageContainer.getViewByTitle("Coordinates"),
this.own(C(this._coordinatesView,"location-mapping-update",t.hitch(this,function(a){this.parent._locationMappingComplete=a;this._validateStatus()}))));if(this.singleEnabled||this.multiEnabled)this._addressView=this.pageContainer.getViewByTitle("Addresses"),this.own(C(this._addressView,"location-mapping-update",t.hitch(this,function(a){this.parent._locationMappingComplete=a;this._validateStatus()})));this._fieldMappingView=this.pageContainer.getViewByTitle("FieldMapping");this.own(C(this._fieldMappingView,
"field-mapping-update",t.hitch(this,function(a){this.parent._fieldMappingComplete=a;this._validateStatus()})));(this._locationTypeView=this.xyEnabled&&(this.singleEnabled||this.multiEnabled)?this.pageContainer.getViewByTitle("LocationType"):this.xyEnabled?this._coordinatesView:this._addressView)&&!this.parent._locationMappingComplete&&(this.altNextIndex=this._locationTypeView.index)}},_updateDoneStatus:function(a,e){e?(v.remove(a,"jimu-icon jimu-icon-error incomplete-mark"),v.add(a,"done-mark")):
(v.add(a,"jimu-icon jimu-icon-error incomplete-mark"),v.remove(a,"done-mark"))},_validateStatus:function(){this._updateDoneStatus(this.locationMappingComplete,this.parent._locationMappingComplete);this._updateDoneStatus(this.fieldMappingComplete,this.parent._fieldMappingComplete);var a=this.pageContainer.backDisabled=!1;this.parent._locationMappingComplete&&this.parent._fieldMappingComplete&&"mapping"===this.state?(a=!0,this.pageContainer.nextDisabled=!0):!this.parent._locationMappingComplete&&this._locationTypeView?
this.altNextIndex=this._locationTypeView.index:!this.parent._fieldMappingComplete&&this._fieldMappingView&&(this.altNextIndex=this._fieldMappingView.index);a||(this.pageContainer.nextDisabled=!1);this._updateNode(this.addToMapButton,a);this.lastFocusNode=a?this.addToMapButton:this.fieldMappingRow},_updateNode:function(a,e){e?v.contains(a,"display-none")&&v.remove(a,"display-none"):v.contains(a,"display-none")||v.add(a,"display-none")},_addToMapClick:function(a){if("keydown"!==a.type||a.keyCode===
I.ENTER||a.keyCode===I.SPACE){this._updateNode(this.addToMapButton,!1);this._updateNode(this.progressNode,!0);a=this._fieldMappingView._getResults();var e=this._locationTypeView._getResults();this._syncFields=this._checkFields(a.results,e);this._locateFeatures(a,e)}},_checkFields:function(a,e){var l={};e&&e.fields&&x.forEach(e.fields,function(p){var q=p.value?p.value:p.sourceField;p=p.keyField?p.keyField:p.sourceField;if("undefined"!==typeof q&&"undefined"!==typeof p&&!l.hasOwnProperty(q)&&a)for(var h=
Object.keys(a),n=0;n<h.length;n++)if(a[h[n]]===q){l[p]={layerFieldName:h[n]};break}});return l},_locateFeatures:function(a,e){this.csvStore.useMultiFields="multi"===e.type?!0:!1;this.csvStore.mappedArrayFields=a.results;this.csvStore.labelField=a.labelField;if("single"===e.type)this.csvStore.addrFieldName=e.fields[0].keyField,this.csvStore.singleFields=e.fields;else if("multi"===e.type)this.csvStore.multiFields=e.fields;else if("xy"===e.type){this.csvStore.useAddr=!1;var l=e.fields[0];e=e.fields[1];
this.csvStore.xFieldName="X"===l.targetField?l.sourceField:e.sourceField;this.csvStore.yFieldName="Y"===e.targetField?e.sourceField:l.sourceField}this.csvStore.processForm().then(t.hitch(this,function(p){this._addResultView({matchedFeatures:this._formatFeatures(p.matchedLayer,a.labelField),matchedLayer:p.matchedLayer,unMatchedFeatures:this._formatFeatures(p.unMatchedLayer,a.labelField),unMatchedLayer:p.unMatchedLayer,duplicateFeatures:this._formatFeatures(p.duplicateLayer,a.labelField,p.duplicateLookupList),
duplicateLayer:p.duplicateLayer});this.state="review";this._reviewView=this.pageContainer.getViewByTitle("Review");this.pageContainer.nextDisabled=!1;this.pageContainer.backDisabled=!0;this.pageContainer._backLabels=[];this.pageContainer.altHomeIndex=this._reviewView.index;this._updateNode(this.progressNode,!1);this.pageContainer.selectView(this._reviewView.index,!0);this.pageContainer._backLabels=[]}),t.hitch(this,function(p){console.log(p);this._updateNode(this.progressNode,!1);this._updateNode(this.addToMapButton,
!0)}))},_formatFeatures:function(a,e,l){var p=[];if(a){var q=a.objectIdField;this._currentFields=a.fields;x.forEach(a.graphics,t.hitch(this,function(h){var n=[],b;l&&(b=l[h.attributes[q]]);x.forEach(Object.keys(h.attributes),t.hitch(this,function(f){var r=this._currentFields.filter(function(A){return A.name===f}),u=h.attributes[f],y=!1;"."!==this.csvStore.decimalSeperator&&(y=r&&r.hasOwnProperty("length")&&1===r.length&&r[0].hasOwnProperty("type")&&"esriFieldTypeDouble"===r[0].type)&&(u=-1===[null,
void 0,""].indexOf(u)?u.toString().replace(this.csvStore.decimalSeperator,"."):u);r={name:f,label:r&&r.hasOwnProperty("length")&&1===r.length&&r[0].alias?r[0].alias:f,formattedValue:y&&-1===[null,void 0].indexOf(u)?c.localizeNumber(u):u,value:u,needsFormat:y};b&&(r.duplicateFieldInfo={value:b[f]});n.push(r)}));var g=n.filter(function(f){return f.name===e&&f.needsFormat});p.push({label:g&&g.hasOwnProperty("length")&&1===g.length?g[0].formattedValue:h.attributes[e],fieldInfo:n,geometry:h.geometry,address:""})}))}return p},
_addResultView:function(a){var e=new m({nls:this.nls,map:this.map,parent:this.parent,config:this.config,appConfig:this.appConfig,matchedList:a.matchedFeatures,unMatchedList:a.unMatchedFeatures,duplicateList:a.duplicateFeatures,theme:this.theme,csvStore:this.csvStore,editLayer:this.parent.editLayer,matchedLayer:a.matchedLayer,unMatchedLayer:a.unMatchedLayer,duplicateLayer:a.duplicateLayer,duplicateLookupList:a.duplicateLookupList,_syncFields:this._syncFields});this.pageContainer.addView(e);this._zoomToAllFeatures([a.matchedLayer,
a.unMatchedLayer,a.duplicateLayer])},_zoomToAllFeatures:function(a){var e=[];x.forEach(a,function(l){if(l&&l.graphics)for(var p=0;p<l.graphics.length;p++)e.push(l.graphics[p])});this.csvStore._zoomToData(e)}})})},"widgets/DataAggregation/js/UI/Review":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-class dojo/dom-attr dojo/dom-style dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/Deferred dojo/text!./templates/Review.html dojo/query dojo/on dojo/string dojo/keys ./FeatureList jimu/dijit/Message jimu/CSVUtils esri/toolbars/edit esri/lang esri/graphic".split(" "),
function(K,t,x,C,H,I,w,F,z,G,B,v,D,d,m,k,c,a,e,l,p,q){return K([w,F,z,G],{baseClass:"cf-review",declaredClass:"CriticalFacilities.Review",templateString:v,_started:null,label:"Review",parent:null,nls:null,map:null,appConfig:null,config:null,matchedList:[],unMatchedList:[],duplicateList:[],theme:"",styleColor:"",csvStore:null,editLayer:null,matchedLayer:null,unMatchedLayer:null,duplicateLayer:null,_editToolbar:null,_syncFields:{},_currentIndex:0,constructor:function(h){t.mixin(this,h)},postCreate:function(){this.inherited(arguments);
this._initReviewRows();this._editToolbar=new l(this.map);window.isRTL&&C.add(this.progressNode,"margin-right-15")},startup:function(){this._started=!0;this._initNavPages();this._updateIndexesList();this.updateImageNodes();this.altNextIndex=this.altNextIndexes[this._currentIndex];this._currentIndex=this._currentIndex+1<this.altNextIndexes.length?this._currentIndex+1:0;this.own(d(this.pageContainer,"nav-view",t.hitch(this,this._navView)))},onShown:function(){this.pageContainer.backDisabled=0<this.pageContainer._backLabels.length?
!1:!0},_navView:function(h){h===this.index&&(this._updateIndexesList(),this._currentIndex<this.altNextIndexes.length?(this.altNextIndex=this.altNextIndexes[this._currentIndex],this._currentIndex=this._currentIndex+1<this.altNextIndexes.length?this._currentIndex+1:0):(this._currentIndex=0,this.altNextIndex=this.altNextIndexes[this._currentIndex]))},validate:function(h,n){var b=new B;"next-view"===h?b.resolve(this._nextView()):"back-view"===h?b.resolve(this._backView(n)):this._homeView(n).then(function(g){b.resolve(g)});
return b},_nextView:function(){return!0},_backView:function(h){return 0<this.pageContainer._backLabels.length?!0:h.navView>this.index},_homeView:function(h){var n=new B;this.pageContainer.getViewByTitle("Home").verifyClearSettings(h).then(function(b){n.resolve(b)});return n},_updateIndexesList:function(){this.altNextIndexes=[];0<this.unMatchedList.length&&this.altNextIndexes.push(this._unMatchedListView.index);0<this.duplicateList.length&&this.altNextIndexes.push(this._duplicateListView.index);0<
this.matchedList.length&&this.altNextIndexes.push(this._matchedListView.index)},_initNavPages:function(){this.pageContainer&&(this._addMatchedFeaturesList(),0<this.unMatchedList.length&&this._addUnmatchedFeatureList(),0<this.duplicateList.length&&this._addDuplicateFeatureList());this.pageContainer.selectView(this.index,!0)},_addMatchedFeaturesList:function(){this.matchedFeatureList=this._initFeatureList(this.matchedList,this.matchedLayer,"MatchedFeatures",this.nls.review.reviewMatchedHint,this.nls.review.reviewMatched,
!1);this.pageContainer.addView(this.matchedFeatureList);this._updateNode(this.submitButton,0<this.matchedList.length);this._matchedListView=this.pageContainer.getViewByTitle(this.matchedFeatureList.label);this.own(d(this.matchedFeatureList,"feature-list-updated",t.hitch(this,function(h){this.matchedCount.innerHTML=h;this._initReviewRow(this.matchedList,[this.matchedHintRow,this.matchedControlRow],this.matchedCount,"matched");this._updateNode(this.submitButton,0<this.matchedList.length)})))},_addUnmatchedFeatureList:function(){this.unMatchedFeatureList=
this._initFeatureList(this.unMatchedList,this.unMatchedLayer,"UnMatchedFeatures",this.nls.review.reviewUnMatchedHint,this.nls.review.reviewUnMatched,!1);this.pageContainer.addView(this.unMatchedFeatureList);this._unMatchedListView=this.pageContainer.getViewByTitle(this.unMatchedFeatureList.label);this.own(d(this.unMatchedFeatureList,"feature-list-updated",t.hitch(this,function(h){this.unMatchedCount.innerHTML=h;0===h&&this.pageContainer.removeView(this._unMatchedListView)})))},_addDuplicateFeatureList:function(){var h=
p.substitute({layerName:this.editLayer.name},this.nls.review.reviewDuplicateHint);this.duplicateFeatureList=this._initFeatureList(this.duplicateList,this.duplicateLayer,"DuplicateFeatures",h,this.nls.review.reviewDuplicate,!0);this.pageContainer.addView(this.duplicateFeatureList);this._duplicateListView=this.pageContainer.getViewByTitle(this.duplicateFeatureList.label);this.own(d(this.duplicateFeatureList,"feature-list-updated",t.hitch(this,function(n){this.duplicateCount.innerHTML=n;0===n&&this.pageContainer.removeView(this._duplicateListView)})))},
_initFeatureList:function(h,n,b,g,f,r){return new c({nls:this.nls,map:this.map,parent:this.parent,config:this.config,appConfig:this.appConfig,hint:g,_title:f,label:b,features:h,theme:this.theme,isDuplicate:r,layer:n,_editToolbar:this._editToolbar,csvStore:this.csvStore,_syncFields:this._syncFields})},_initReviewRows:function(){this._initReviewRow(this.matchedList,[this.matchedHintRow,this.matchedControlRow],this.matchedCount,"matched");this._initReviewRow(this.unMatchedList,[this.unMatchedHintRow,
this.unMatchedControlRow],this.unMatchedCount,"unmatched");this._initReviewRow(this.duplicateList,[this.duplicateHintRow,this.duplicateControlRow],this.duplicateCount,"duplicate")},_initReviewRow:function(h,n,b,g){0<h.length?(x.forEach(n,function(f){C.contains(f,"display-none")&&C.remove(f,"display-none")}),b.innerHTML=h.length,this._createOrUpdateReviewNodeAriaLabel(h.length,g)):x.forEach(n,function(f){C.contains(f,"display-none")||C.add(f,"display-none")})},_createOrUpdateReviewNodeAriaLabel:function(h,
n){switch(n){case "matched":var b=this.nls.review.reviewMatched;var g=this.nls.review.reviewMatchedHint;var f=this.matchedControlRow;break;case "unmatched":b=this.nls.review.reviewUnMatched;g=this.nls.review.reviewUnMatchedHint;f=this.unMatchedControlRow;break;case "duplicate":b=this.nls.review.reviewDuplicate,g=this.nls.review.reviewDuplicateHint,f=this.duplicateControlRow}h=m.substitute(this.nls.review.reviewLabelWithCount,{totalMatchedFeatures:h,headerString:b,headerStringHint:g});H.set(f,"aria-label",
h)},_updateReviewRows:function(h){this._initReviewRows();(h="unmatched"===h&&this.unMatchedFeatureList?this.unMatchedFeatureList:"duplicate"===h&&this.duplicateFeatureList?this.duplicateFeatureList:void 0)&&h.features&&0===h.features.length&&this.pageContainer.selectView(this.index,!0)},updateImageNodes:function(){var h=this.pageContainer.isDarkTheme,n=h?"next-arrow-img":"next-arrow-img-white",b=h?"next-arrow-img-white":"next-arrow-img";h=D("."+n,this.domNode);x.forEach(h,function(g){C.remove(g,n);
C.add(g,b)})},_download:function(h){if("keydown"!==h.type||h.keyCode===k.ENTER||h.keyCode===k.SPACE)0<this.matchedList.length&&(h=this.csvStore.matchedFeatureLayer.id.replace(".csv",""),this._export(this.csvStore.matchedFeatureLayer,h)),0<this.unMatchedList.length&&(h=this.csvStore.unMatchedFeatureLayer.id.replace(".csv",""),this._export(this.csvStore.unMatchedFeatureLayer,h)),0<this.duplicateList.length&&(h=this.csvStore.duplicateFeatureLayer.id.replace(".csv",""),this._export(this.csvStore.duplicateFeatureLayer,
h))},_export:function(h,n){var b=[];x.forEach(h.graphics,function(f){b.push(f.attributes)});var g={};g.datas=b;g.fromClient=!1;g.withGeometry=!1;g.outFields=h.fields;g.formatDate=!0;g.formatCodedValue=!0;g.formatNumber=!1;e.exportCSVFromFeatureLayer(n,h,g)},_submit:function(h){if("keydown"!==h.type||h.keyCode===k.ENTER||h.keyCode===k.SPACE){this._updateNode(this.submitButton,!1);this._updateNode(this.progressNode,!0);h=this._getFeatures(this.csvStore.matchedFeatureLayer);var n=this._getFeatures(this.csvStore.duplicateFeatureLayer);
this.editLayer.applyEdits(h,n,null,t.hitch(this,function(b,g){this._validateResults(b);this._validateResults(g);this._updateNode(this.progressNode,!1);this._disableUI();this.csvStore._zoomToData(this.editLayer.graphics,!0)}),t.hitch(this,function(){new a({type:"Error",message:this.nls.warningsAndErrors.saveError})}))}},_validateResults:function(h){var n=[],b=[];h&&h.hasOwnProperty("length")&&0<h.length&&(x.forEach(h,function(g){"undefined"!==typeof g.success&&(g.success?n.push(g):b.push(g))}),0<b.length&&
(h=0===n.length?this.nls.review.noFeaturesSaved:p.substitute({num:b.length},this.nls.review.someFeaturesNotSaved),new a({message:h})))},_disableUI:function(){this._updateNode(this.submitButton,!0);C.add(this.submitButton,"control-disbaled");H.set(this.submitButton,"tabindex","-1");C.add(this.reviewRowTable,"control-disbaled");H.set(this.reviewDataRow,"tabindex","-1");H.set(this.matchedControlRow,"tabindex","-1");H.set(this.unMatchedControlRow,"tabindex","-1");H.set(this.duplicateControlRow,"tabindex",
"-1");C.add(this.pageContainer.nextTd,"control-disbaled");H.set(this.pageContainer.nextImage,"tabindex","-1");C.add(this.pageContainer.backTd,"control-disbaled");C.add(this.pageContainer.backImage,"control-disbaled");H.set(this.pageContainer.backImage,"tabindex","-1");this.map.infoWindow&&this.map.infoWindow.clearFeatures&&this.map.infoWindow.clearFeatures();this.parent.updateFirstLastNode(!1)},_getFeatures:function(h){var n=[],b=this.csvStore.objectIdField;h&&h.graphics&&x.forEach(h.graphics,t.hitch(this,
function(g){g.hasOwnProperty("_graphicsLayer")&&delete g._graphicsLayer;g.hasOwnProperty("_layer")&&delete g._layer;var f=g.attributes;this._deleteProp(f,b);f.hasOwnProperty("hasDuplicateUpdates")&&f.hasOwnProperty("duplicateState")?f.hasDuplicateUpdates&&"make-change"===f.duplicateState&&(f.hasOwnProperty("DestinationOID")&&(f[this.editLayer.objectIdField]=f.DestinationOID),this._deleteProp(f,"hasDuplicateUpdates"),this._deleteProp(f,"duplicateState"),this._deleteProp(f,"matchScore"),this._deleteProp(f,
"DestinationOID"),x.forEach(this.csvStore._matchFields,t.hitch(this,function(r){this._deleteProp(f,r)})),n.push(g.toJson?new q(g.toJson()):g)):(this._deleteProp(f,"matchScore"),this._deleteProp(f,"DestinationOID"),n.push(g.toJson?new q(g.toJson()):g))}));return 0<n.length?n:null},_deleteProp:function(h,n){h.hasOwnProperty(n)&&delete h[n]},_navigateHome:function(){var h=this.pageContainer.getViewByTitle("Home");h._clearStore(!0);h._clearMapping();this.pageContainer.toggleController(!0);this.pageContainer.selectView(h.index)},
_updateNode:function(h,n){n?C.contains(h,"display-none")&&C.remove(h,"display-none"):C.contains(h,"display-none")||C.add(h,"display-none")},setStyleColor:function(h){this.styleColor=h},_reviewMatched:function(h){h&&"keydown"===h.type&&h.keyCode!==k.ENTER&&h.keyCode!==k.SPACE||this.pageContainer.selectView(this._matchedListView.index)},_reviewUnMatched:function(h){h&&"keydown"===h.type&&h.keyCode!==k.ENTER&&h.keyCode!==k.SPACE||this.pageContainer.selectView(this._unMatchedListView.index)},_reviewDuplicate:function(h){h&&
"keydown"===h.type&&h.keyCode!==k.ENTER&&h.keyCode!==k.SPACE||this.pageContainer.selectView(this._duplicateListView.index)}})})},"widgets/DataAggregation/js/UI/FeatureList":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-class dojo/dom-attr dojo/keys dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/FeatureList.html dojo/query dojo/Deferred dojo/on ./Feature".split(" "),function(K,t,x,C,H,I,w,
F,z,G,B,v,D,d,m,k){return K([F,z,G,B],{baseClass:"cf-feature-list",declaredClass:"CriticalFacilities.FeatureList",templateString:v,label:"FeatureList",parent:null,nls:null,map:null,appConfig:null,config:null,features:[],updateFeatures:[],hint:"",theme:"",styleColor:"",type:"",isDuplicate:!1,layer:null,_editToolbar:null,_syncFields:{},_started:!1,constructor:function(c){t.mixin(this,c)},postCreate:function(){this.inherited(arguments);this.pageHint.innerHTML=this.hint;this.pageTitle.innerHTML=this._title;
I.set(this.pageTitle,"aria-label",this._title+" "+this.hint)},onShown:function(){this.pageContainer.nextDisabled=!1;this.pageContainer.backDisabled=!1},startup:function(){this._started=!0;this._initFeatureList(this.features);this._updateAltIndexes();this.updateImageNodes();this.own(m(this,"feature-list-updated",t.hitch(this,this._updateAltIndexes)));this.own(m(this.pageContainer,"view-index-change",t.hitch(this,this._indexChanged)))},validate:function(c,a){var e=new d;"next-view"===c?e.resolve(this._nextView()):
"back-view"===c?e.resolve(this._backView()):this._homeView(a).then(function(l){e.resolve(l)});return e},_nextView:function(){return!0},_backView:function(){return!0},_homeView:function(c){var a=new d;this.pageContainer.getViewByTitle("Home").verifyClearSettings(c).then(function(e){a.resolve(e)});return a},_indexChanged:function(c){this._updateAltIndexes();c.oldIndex===this.altNextIndex&&(this.altNextIndex=c.newIndex)},_updateAltIndexes:function(){this.pageContainer&&!this._reviewView&&(this._reviewView=
this.pageContainer.getViewByTitle("Review"))&&(this.altHomeIndex=this.altBackIndex=this._reviewView.index);if(this.featureListTable&&this.featureListTable.rows){var c=this.featureListTable.rows;if(c.length&&0<c.length){var a=c[0].featureView;c=c[c.length-1].featureView;this.altNextIndex=a.index;this.finalFeatureIndex=c.index;c.altNextIndex=this._reviewView.index;a.altBackIndex=this.index}}},_initFeatureList:function(c){var a=0;this.featureListTable.rows.length!==this.features.length&&x.forEach(c,
t.hitch(this,function(e){this._initRow(e,a);a+=1}))},updateImageNodes:function(){var c=this.pageContainer.isDarkTheme,a=c?"next-arrow-img":"next-arrow-img-white",e=c?"next-arrow-img-white":"next-arrow-img";c=D("."+a,this.domNode);x.forEach(c,function(l){H.remove(l,a);H.add(l,e)})},setStyleColor:function(c){this.styleColor=c},_initFeatureView:function(c,a){c=new k({nls:this.nls,map:this.map,parent:this.parent,config:this.config,appConfig:this.appConfig,label:a,altBackIndex:this.index,isDuplicate:this.isDuplicate,
feature:c,theme:this.theme,layer:this.layer,_editToolbar:this._editToolbar,csvStore:this.csvStore,_parentFeatureList:this,pageContainer:this.pageContainer,pageHint:this.nls.review.reviewFeatureHint,pageTitle:c.label});this.pageContainer.addView(c);return this.pageContainer.getViewByTitle(a)},_initRow:function(c,a){var e=C.create("tr",{className:"bottom-border feature-list-row",tabindex:0,role:"button","aria-label":c.label,onclick:t.hitch(this,function(p){this.pageContainer.selectView(p.currentTarget.featureView.index)}),
onkeydown:t.hitch(this,function(p){p.keyCode!==w.ENTER&&p.keyCode!==w.SPACE||this.pageContainer.selectView(p.currentTarget.featureView.index)})},this.featureListTable);e.featureView=this._initFeatureView(c,this.label+"_"+a);e.fieldInfo=c.fieldInfo;for(a=0;a<c.fieldInfo.length;a++){var l=c.fieldInfo[a];if(l.name===this.layer.objectIdField){e._featureOID=l.value;break}}a=C.create("td",{className:"pad-10"},e);e.featureView.featureListLabel=C.create("div",{className:"main-text float-left text-left",innerHTML:c.label},
a);c=C.create("td",{className:"width-15"},e);C.create("div",{className:"next-arrow float-right next-arrow-img"},c);this.lastFocusNode=e},removeFeature:function(c,a){for(var e=new d,l=this.featureListTable.rows,p=0;p<l.length;p++){var q=l[p];if(q._featureOID===a){this.pageContainer._backLabelClone=t.clone(this.pageContainer._backLabels);this.pageContainer.removeView(q.featureView);this.featureListTable.deleteRow(p);c=this.features.indexOf(c);-1<c&&this.features.splice(c,1);this.emit("feature-list-updated",
this.features.length);p===this.features.length&&this.pageContainer.selectView(this.altBackIndex);break}}e.resolve("feature-removed");return e},resetFeatureList:function(){if(0<this.featureListTable.rows.length){for(var c=this.featureListTable.rows.length;0<c;c--)this.pageContainer.removeView(this.featureListTable.rows[c-1].featureView),this.featureListTable.deleteRow(c-1);this.altNextIndex=void 0;this._initFeatureList(this.features);this._updateAltIndexes();this.pageContainer._backLabels=this.pageContainer._backLabelClone;
this.updateImageNodes()}},addFeature:function(c){this.features.push(c);this.emit("feature-list-updated",this.features.length)}})})},"widgets/DataAggregation/js/UI/Feature":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-class dojo/dom-attr dojo/keys dijit/registry dijit/form/ValidationTextBox jimu/dijit/formSelect dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/query dojo/on dijit/form/DateTextBox dojo/text!./templates/Feature.html dojo/Deferred ./FeatureToolbar esri/tasks/query jimu/dijit/Popup jimu/utils esri/lang".split(" "),
function(K,t,x,C,H,I,w,F,z,G,B,v,D,d,m,k,c,a,e,l,p,q,h,n){return K([B,v,D,d],{baseClass:"cf-feature",declaredClass:"CriticalFacilities.Feature",templateString:a,_started:null,label:"Feature",parent:null,nls:null,map:null,appConfig:null,config:null,_featureToolbar:null,fields:[],feature:null,fileAddress:{},isDuplicate:!1,isDuplicateLocated:!1,isUnMatchedLocated:!1,isUnMatched:!1,_useGeomFromFile:!1,_useGeomFromLayer:!0,_useValuesFromFile:!1,_useValuesFromLayer:!0,_featureExpanded:!1,_locationExpanded:!1,
theme:"",styleColor:"black",layer:null,_changedFileAttributeRows:[],_changedLayerAttributeRows:[],_changedAddressRows:[],_editToolbar:null,_featureQuery:null,_skipFields:[],csvStore:null,constructor:function(b){t.mixin(this,b)},postCreate:function(){this.inherited(arguments);this.pageHintDiv.innerHTML=this.pageHint;this.pageTitleDiv.innerHTML=this.pageTitle;I.set(this.featureTitleTable,"aria-label",this.pageTitle+" "+this.pageHint);this._initUnMatched();this._initToolbar(this.featureToolbar);this._updateAltIndexes();
this.lastFocusNode=this.locationTr},_initUnMatched:function(){if((this.isUnMatched=-1!==this.label.indexOf("UnMatchedFeatures"))&&this.feature.fieldInfo&&this.feature.fieldInfo.length)for(var b=0;b<this.feature.fieldInfo.length;b++){var g=this.feature.fieldInfo[b];"matchScore"===g.name&&(this.isUnMatchedLocated=0!==g.value)}},_updateAltIndexes:function(){if(this.pageContainer){var b=this.pageContainer.getViewByTitle("Review");b&&(this.altHomeIndex=b.index)}},_initSkipFields:function(b){this._skipFields=
["DestinationOID","matchScore","hasDuplicateUpdates","duplicateState",this.layer.objectIdField];x.forEach(b,t.hitch(this,function(g){-1<g.name.indexOf(this.csvStore.matchFieldPrefix)&&this._skipFields.push(g.name)}))},startup:function(){var b=this.feature.fieldInfo;this._initSkipFields(b);this._initRows(b,this.featureControlTable);this.isDuplicate?this._initDuplicateReview(b):this._initStandardReview();this._getFeature().then(t.hitch(this,function(g){this._feature=g;this._featureToolbar._panToAndSelectFeature(g);
!this.isDuplicate&&this._feature&&this._feature.geometry&&this._toggleEditControls(!1)}));this._getEditFeature().then(t.hitch(this,function(g){this._editFeature=g;this.isDuplicate&&this._editFeature&&this._editFeature.geometry&&this._toggleLocationControls(!0)}));this.onShown()},onShown:function(){this._isReviewed=!0;this._showView();this._featureToolbar._panToAndSelectFeature(this.isDuplicate&&this._useGeomFromLayer?this._editFeature:this._feature);this.isShowing=!0;this.pageContainer.nextDisabled=
!1;this.pageContainer.backDisabled=!1;!this.isDuplicate&&this._feature&&this._feature.geometry&&this._toggleEditControls(!1);this.isDuplicate&&this._useGeomFromFile&&"make-change"===this._duplicateFlag.fromSelect.value&&this._toggleEditControls(!1)},onHidden:function(){this.isShowing=!1},validate:function(b,g){var f=new e;"next-view"===b?f.resolve(this._nextView()):"back-view"===b?f.resolve(this._backView()):this._homeView(g).then(function(r){f.resolve(r)});return f},_nextView:function(){return!0},
_backView:function(){return!0},_homeView:function(b){var g=new e;this.pageContainer.getViewByTitle("Home").verifyClearSettings(b).then(function(f){g.resolve(f)});return g},_showView:function(){H.remove(this.featureTitleTable,"display-none");H.remove(this.featureTable,"display-none");H.remove(this.featureToggleTable,"display-none");H.remove(this.locationSyncTable,"display-none");H.remove(this.locationControlTable,"display-none");H.remove(this.locationControlToggleTable,"display-none");H.remove(this.featureToolbarTable,
"display-none");this.isDuplicate&&H.remove(this.reviewText,"display-none");this._updateInfoRows()},_getFeature:function(){var b=new e,g=this.layer.objectIdField,f=this.feature.fieldInfo.filter(function(r){return r.name===g});this._featureQuery=new p;this._featureQuery.objectIds=[f[0].value];this.layer.queryFeatures(this._featureQuery).then(t.hitch(this,function(r){b.resolve(r.features[0])}));return b},_getEditFeature:function(){var b=new e,g=this.feature.fieldInfo.filter(function(f){return"DestinationOID"===
f.name});g&&0<g.length?(this._editQuery=new p,this._editQuery.objectIds=[g[0].value],this.parent.editLayer.queryFeatures(this._editQuery).then(t.hitch(this,function(f){b.resolve(f.features[0])}))):b.resolve();return b},_initStandardReview:function(){this._useValuesFromFile=!0;this._useValuesFromLayer=!1},_initDuplicateReview:function(b){this._initDuplicateSelect();this._initDuplicateReviewRows(b);H.add(this.featureToolbar,"display-none")},_initDuplicateSelect:function(){var b=new G({"aria-label":this.nls.review.item,
style:{display:"table","min-width":"100px",height:"28px"},options:[{label:this.nls.review.duplicateAction,value:"no-change",selected:!0},{label:this.nls.review.duplicateModify,value:"make-change"},{label:this.nls.review.duplicateSave,value:"not-duplicate"}],onChange:t.hitch(this,this._updateDuplicateUI)});this._duplicateFlag.fromSelect=b;C.place(b.domNode,this._duplicateFlag);b.startup();this._toggleEditControls(!0)},_updateDuplicateUI:function(b){this._updateDuplicateAttributes(b,null);"make-change"===
b?H.remove(this.featureToolbar,"display-none"):H.add(this.featureToolbar,"display-none");this._toggleEditControls("make-change"===b?!1:!0);"not-duplicate"===b&&this._showShouldLocateFeaturePopup().then(t.hitch(this,function(g){g?(this.resetAddressValues(this._featureToolbar._originalValues,b),this._featureToolbar._locateFeature(!0).then(t.hitch(this,function(){var f=new q({titleLabel:this.nls.review.featureLocated,width:400,autoHeight:!0,content:C.create("div",{innerHTML:this.nls.warningsAndErrors.itemMoveMatch,
style:"padding-bottom: 10px;"}),buttons:[{label:this.nls.ok,onClick:t.hitch(this,t.hitch(this,function(){f.close();f=null}))}],onClose:t.hitch(this,function(){f=null;this._featureToolbar._save({},!0)})})}))):this._duplicateFlag.fromSelect.set("value","no-change")}));this._updateLocationPanelLastNode()},_updateDuplicateAttributes:function(b,g){this._feature.attributes.duplicateState=null!==b?b:this._feature.attributes.duplicateState;this._feature.attributes.hasDuplicateUpdates=null!==g?g:this._feature.attributes.hasDuplicateUpdates},
_showShouldLocateFeaturePopup:function(){var b=new e,g=C.create("div");C.create("div",{innerHTML:this.nls.warningsAndErrors.itemWillBeLocated,style:"padding-bottom: 10px;"},g);C.create("div",{innerHTML:this.nls.warningsAndErrors.proceed},g);var f=new q({titleLabel:this.nls.review.locateFeature,width:400,autoHeight:!0,content:g,buttons:[{label:this.nls.yes,onClick:t.hitch(this,function(){f.close();f=null;b.resolve(!0)})},{label:this.nls.no,onClick:t.hitch(this,function(){f.close();f=null;b.resolve(!1)})}],
onClose:function(){f=null}});return b},_initDuplicateReviewRows:function(b){var g=C.create("tr",{className:"bottom-border",isHeaderRow:!0},this.reviewTable);C.create("td",{className:"text-left"},g);var f=C.create("td",{className:"text-left"},g);C.create("div",{className:"duplicate-col-headers main-text float-left",innerHTML:this.nls.review.target},f);g=C.create("td",{className:"text-left"},g);C.create("div",{className:"duplicate-col-headers main-text float-left",innerHTML:this.nls.review.source},
g);x.forEach(b,t.hitch(this,function(r){if(-1===this._skipFields.indexOf(r.name)){var u=C.create("tr",{className:"bottom-border",isLabelRow:!0,isControlRow:!0},this.reviewTable);u.fieldName=r.name;u.parent=this;var y=C.create("td",{className:"field-control-td text-left"},u);C.create("div",{className:"main-text float-left",innerHTML:r.label},y);this._initLabel(u,r.duplicateFieldInfo.value,!1,!1);this._initLabel(u,r.value,!0,!1)}}))},_initToolbar:function(b){this._featureToolbar=new l({nls:this.nls,
map:this.map,parent:this.parent,config:this.config,appConfig:this.appConfig,feature:this.feature,theme:this.theme,layer:this.layer,featureView:this,_editToolbar:this._editToolbar,csvStore:this.csvStore,_stageLayer:this.csvStore.matchedFeatureLayer,styleColor:this.styleColor,pageContainer:this.pageContainer});this._featureToolbar.placeAt(b);this._featureToolbar.startup()},_initRows:function(b,g){if(this.isDuplicate){this._initSelectRow(this.nls.review.use,this.locationControlTable,this._useGeomChanged,
"geom");this._initSelectRow(this.nls.review.use,this.featureControlTable,this._useValuesChanged,"values");var f=C.create("tr",{className:"bottom-border",isHeaderRow:!0},g);C.create("td",{className:"text-left"},f);var r=C.create("td",{className:"text-left"},f);C.create("div",{className:"duplicate-col-headers main-text float-left",innerHTML:this.nls.review.target},r);f=C.create("td",{className:"text-left"},f);C.create("div",{className:"duplicate-col-headers main-text float-left",innerHTML:this.nls.review.source},
f)}(this._syncEnabled=0<Object.keys(this._parentFeatureList._syncFields).length)?this._syncFields=this._parentFeatureList._syncFields:H.add(this.syncFields,"display-none");var u=0;x.forEach(b,t.hitch(this,function(y){if(-1===this._skipFields.indexOf(y.name)){var A=C.create("tr",{className:"bottom-border",isRadioRow:!1,isEditRow:!0,rowIndex:u},g);A.fieldName=y.name;A.parent=this;var E=C.create("td",{className:"field-control-td text-left field-row-width pad-left-5"},A);C.create("div",{className:"main-text float-left",
innerHTML:y.label},E);this.isDuplicate&&this._initValidationBox(y.label,A,y.duplicateFieldInfo.value,!1,!1);this._initValidationBox(y.label,A,y.value,!0,!1);u+=1}}));this.addressFields=this.csvStore.useMultiFields?this.csvStore.multiFields:this.csvStore.useAddr?this.csvStore.singleFields:this.getXYFields();x.forEach(this.addressFields,t.hitch(this,function(y){var A=C.create("tr",{className:"bottom-border",isRadioRow:!1,isEditRow:!1,isAddressRow:!0},this.locationControlTable);A.label=y.label;A.keyField=
y.keyField;A.parent=this;var E=C.create("td",{className:"field-control-td text-left pad-left-5"},A);C.create("div",{className:"main-text float-left",innerHTML:y.label},E);var J=this.csvStore.matchFieldPrefix;E=this.feature.fieldInfo.filter(function(L){return L.name===J+y.keyField})[0];this._initValidationBox(y.label,A,E.value,!1,!0)}))},_syncAddressInfo:function(b){"keydown"===b.type&&b.keyCode!==w.ENTER&&b.keyCode!==w.SPACE||this._featureToolbar._syncDisabled||(b=this._getAddress(),this._updateAddressFields(b,
!0),this._featureToolbar._hasAddressEdit=!1,this._featureToolbar._updateSync(!0))},_locate:function(b){this._featureToolbar._locate(b)},getXYFields:function(){this._featureToolbar._isAddressFeature=!1;var b=this.parent._pageContainer.getViewByTitle("Coordinates"),g=b.xField;b=b.yField;this._featureToolbar.xField=this.csvStore.xFieldName;this._featureToolbar.yField=this.csvStore.yFieldName;return[{keyField:this.csvStore.xFieldName,label:g.label,value:this.csvStore.xFieldName},{keyField:this.csvStore.yFieldName,
label:b.label,value:this.csvStore.yFieldName}]},_updateAddressFields:function(b,g){this._address=b;g?x.forEach(this.locationControlTable.rows,t.hitch(this,function(f){if(this._syncFields.hasOwnProperty(f.keyField))for(var r=this._syncFields[f.keyField],u=0;u<this.featureControlTable.rows.length;u++){var y=this.featureControlTable.rows[u];if(y.isEditRow&&y.fieldName===r.layerFieldName){f=this.csvStore.matchFieldPrefix+f.keyField;f=this._address&&this._address.hasOwnProperty(f)?this._address[f]:"";
this.isDuplicate&&this._useValuesFromLayer?(y.layerValueTextBox.set("value",f),y.layerValueTextBox.emit("keyUp")):(y.fileValueTextBox.set("value",f),y.fileValueTextBox.emit("keyUp"));break}}})):x.forEach(this.locationControlTable.rows,t.hitch(this,function(f){var r=this.csvStore.useAddr&&!this.csvStore.useMultiFields?"Match_addr":f.keyField;f.addressValueTextBox&&(this.csvStore.useAddr||(r=this.csvStore.xFieldName===r?"x":"y"),r=this._address&&this._address.hasOwnProperty(r)?this._address[r]:"",f.addressValueTextBox.set("value",
r))}))},_validateAddressDifference:function(){var b=!1;this.locationControlTable&&x.forEach(this.locationControlTable.rows,t.hitch(this,function(g){if(this._syncFields&&this._syncFields.hasOwnProperty(g.keyField)&&!b){var f=g.addressValueTextBox.displayedValue;g=this._syncFields[g.keyField];for(var r=0;r<this.featureControlTable.rows.length;r++){var u=this.featureControlTable.rows[r];if(u.isEditRow&&u.fieldName===g.layerFieldName&&!b){b=this.isDuplicate&&this._useValuesFromLayer?u.layerValueTextBox.displayedValue!==
f:u.fileValueTextBox.displayedValue!==f;break}}}}));return b},_getAddress:function(){this._address={};x.forEach(this.locationControlTable.rows,t.hitch(this,function(b){b.addressValueTextBox&&(this._address[this.csvStore.matchFieldPrefix+b.keyField]=b.addressValueTextBox.value)}));return this._address},_getAddressFieldsValues:function(){var b={};x.forEach(this.locationControlTable.rows,function(g){g.addressValueTextBox&&(b[g.keyField]=g.addressValueTextBox.value)});return b},_initLabel:function(b,
g,f,r){var u=this._getField(b),y=C.create("td",{className:"field-control-td field-row-width2"},b),A=new z({style:{width:"100%",height:"32px"},title:g,invalidMessage:this.nls.review.valuesDoNotMatch});A.decimalSeperator=this.csvStore.decimalSeperator;this._addLocalizeFloatSupport(A,g,r,u);A.set("value",g);A.set("readonly",!0);A.placeAt(y);A.startup();A.isFile=f;A.isAddress=r;A.row=b;A.parent=this;f?(b.fileValueTextBox=A,b.fileValue=g):r?(b.addressValueTextBox=A,b.addressValue=g):(b.layerValueTextBox=
A,b.layerValue=g);f&&(A.validator=this._valuesMatch,A.validate())},_initValidationBox:function(b,g,f,r,u){var y=this._getField(g),A=C.create("td",{className:"field-control-td",colspan:this.isDuplicate?1:2},g);if(y&&y.type&&"date"===y.type){var E=y.fieldInfo&&y.fieldInfo.format?y.fieldInfo:void 0;f=-1===[null,void 0,""].indexOf(f)?new Date(f):void 0;var J=-1===[null,void 0,""].indexOf(f)?!0:!1;b=new c({"aria-label":b,style:{width:"100%",height:"32px"},title:J?E?h.localizeDateByFieldInfo(f,E):h.localizeDate(f):
"",onChange:this._onChange})}else if(y&&y.domainValues){E=function(P){var N;-1<y.values.indexOf(P)&&(N=y.domainValues.filter(function(Q){return Q.label===P}));return N&&-1<N.length?N[0].value:P};f=-1<[null,void 0,""].indexOf(f)?"":-1<y.codes.indexOf(f)?f:E(f);var L=[{label:this.nls.review.selectValue,value:null,selected:!0}],M=f;x.forEach(y.domainValues,function(P){if(f.toString()===P.value.toString()||f.toString()===P.label.toString())M=P.label;L.push({label:P.label,value:P.value})});b=new G({"aria-label":b,
style:{width:"100%",height:"32px"},options:L,onChange:this._onChange,title:M});A.style.overflow="hidden"}else b=new z({"aria-label":b,style:{width:"100%",height:"32px"},title:f});b.decimalSeperator=this.csvStore.decimalSeperator;this._addLocalizeFloatSupport(b,f,u,y);b.set("intermediateChanges",!0);b.set("value",this.isDuplicate&&u?"":f);b.placeAt(A);b.startup();this.lastValueTextBox=b.domNode;b.isFile=r;b.isAddress=u;b.row=g;b.featureToolbar=this._featureToolbar;if(!u){var O;y&&y.length&&(O=n.substitute({num:y.length},
this.nls.warningsAndErrors.rangeMessage));b.invalidLengthMessage=O;b.invalidTypeMessage=this.nls.warningsAndErrors.invalidMessage;b.fieldLength=y.length;b.fieldType=y.type;b.fieldNullable=y.nullable;y&&y.type&&"date"!==y.type&&(b.validator=this._valuesValidForType)}b.parent=this;r?(g.fileValueTextBox=b,g.fileValue=f):u?(g.addressValueTextBox=b,g.addressValue=f):(g.layerValueTextBox=b,g.layerValue=f);b.on("keyUp",function(P){P="undefined"!==typeof P.target.value?this.parent._getValue(P.target.value):
"date"===this.fieldType?"":this.value;if(this.isAddress){P=P!==this.parent._getValue(this.row.addressValue);var N=this.parent._changedAddressRows.indexOf(this.row.rowIndex);-1===N&&P?this.parent._changedAddressRows.push(this.row.rowIndex):-1<N&&!P&&this.parent._changedAddressRows.splice(N,1);this.parent.emit("address-change",0<this.parent._changedAddressRows.length)}else if(N=this.validate(),this.row._isValid=N){N=this.parent._getValue(this.row.fileValue);var Q=this.parent._getValue(this.row.layerValue);
P=this.isFile?P!==N:P!==Q;Q=this.isFile?this.parent._changedFileAttributeRows:this.parent._changedLayerAttributeRows;N=Q.indexOf(this.row.rowIndex);-1===N&&P?Q.push(this.row.rowIndex):-1<N&&!P&&Q.splice(N,1);var R=!0;x.forEach(this.parent.featureControlTable.rows,function(X){"undefined"===typeof X._isValid||X._isValid||(R=!1)});R?this.parent.emit("attribute-change",0<Q.length):this.featureToolbar._updateSave(!0)}else this.featureToolbar._updateSave(!0)})},_getField:function(b){for(var g,f=0;f<this.csvStore.fsFields.length;f++){var r=
this.csvStore.fsFields[f];if(r.name===b.fieldName){g=r;break}}return g},_addLocalizeFloatSupport:function(b,g,f,r){"."!==b.decimalSeperator&&(f&&!this.csvStore.useAddr||r&&r.type&&"float"===r.type)&&(b.title=-1!==[null,void 0,""].indexOf(g)?"":isNaN(g)||"."===b.decimalSeperator?g:h.localizeNumber(g),b.format=function(u){return-1!==[null,void 0,""].indexOf(u)||isNaN(u)?u:h.localizeNumber(u).toString().replace(".","")},b.parse=function(u){return u&&u.toString&&-1<u.toString().indexOf(this.decimalSeperator)?
u.toString().replace(this.decimalSeperator,"."):u})},_onChange:function(b){b="undefined"!==typeof b?this.parent._getValue(b):"date"===this.fieldType?"":this.value;var g=this.validate();if(this.row._isValid=g){g=this.parent._getValue(this.row.fileValue);var f=this.parent._getValue(this.row.layerValue);b=this.isFile?b.toString()!==g.toString():b.toString()!==f.toString();f=this.isFile?this.parent._changedFileAttributeRows:this.parent._changedLayerAttributeRows;g=f.indexOf(this.row.rowIndex);-1===g&&
b?f.push(this.row.rowIndex):-1<g&&!b&&f.splice(g,1);var r=!0;x.forEach(this.parent.featureControlTable.rows,function(u){"undefined"===typeof u._isValid||u._isValid||(r=!1)});r?this.parent.emit("attribute-change",0<f.length):this.featureToolbar._updateSave(!0)}else this.featureToolbar._updateSave(!0)},_valuesValidForType:function(b){var g=b.toString();if(g.length>this.fieldLength)return this.invalidMessage=this.invalidLengthMessage,!1;if(0===g.length)return"undefined"!==typeof this.fieldNullable?this.fieldNullable:
!0;this.invalidMessage=this.invalidTypeMessage;switch(this.fieldType){case "int":return/^-?[0-9]+$/.exec(b);case "float":return"."!==this.decimalSeperator?/^-?[0-9]+[.,]?[0-9]*$/.exec(b):/^-?[0-9]+[.]?[0-9]*$/.exec(b);case "date":if(b)try{return!isNaN((new Date(b)).getTime())}catch(f){return console.error(f),!1}else return!0;case "domainInt":return/^-?[0-9]+$/.exec(b);case "domain":return!0;case "other":return!0}},_valuesMatch:function(){return this.row.fileValueTextBox&&this.row.layerValueTextBox?
this.row.fileValueTextBox.value===this.row.layerValueTextBox.value:!0},_validateValues:function(){var b=!0;x.forEach(this.featureControlTable.rows,t.hitch(this,function(f){if(f.isEditRow){"undefined"===typeof f._isValid||f._isValid||(b=!1);var r="date"===f.fileValueTextBox.fieldType&&f.fileValueTextBox.value.toString()===f.fileValueTextBox._invalidDate?"":this._getValue(f.fileValueTextBox.value),u=this._getValue(f.fileValue),y="date"===f.layerValueTextBox.fieldType&&f.layerValueTextBox.value.toString()===
f.layerValueTextBox._invalidDate?"":this._getValue(f.layerValueTextBox.value),A=this._getValue(f.layerValue);f.parent._useValuesFromFile&&(r!==u||r!==A)&&this._changedFileAttributeRows.push(f.rowIndex);f.parent._useValuesFromLayer&&y!==A&&this._changedLayerAttributeRows.push(f.rowIndex)}}));var g=this._useValuesFromFile?this._changedFileAttributeRows:this._changedLayerAttributeRows;b?this.emit("attribute-change",0<g.length):this._featureToolbar._updateSave(!0)},_getValue:function(b){return-1===[null,
void 0,""].indexOf(b)?b:""},_validateGeoms:function(){var b=this._featureToolbar._hasAttributeEdit,g=this._featureToolbar._hasGeometryEdit;this._useGeomFromLayer?this._featureToolbar._updateSaveAndCancel(!b):g?this._featureToolbar._updateSaveAndCancel(!b&&!g):this._featureToolbar._updateSaveAndCancel(!b)},_initSelectRow:function(b,g,f,r){g=C.create("tr",{className:"task-instruction-row bottom-border",isRadioRow:!0,isEditRow:!1},g);g.radioButtons=[];g.useType=r;var u=C.create("td",{},g);C.create("div",
{className:"main-text float-left pad-left-5",innerHTML:b},u);this._createSelect(g,f,r)},_createSelect:function(b,g,f){var r=C.create("td",{colspan:2,className:"field-control-td"},b);g=new G({style:{display:"table",width:"100%",height:"28px"},options:[{label:this.nls.review.fromLayer,value:"layer",selected:!0},{label:this.nls.review.fromFile,value:"file"}],onChange:t.hitch(this,g)});b.fromSelect=g;C.place(g.domNode,r);g.startup();"geom"===f&&this.own(k(b.fromSelect,"change",t.hitch(this,function(){this._updateLocationPanelLastNode()})))},
_useGeomChanged:function(b){this._useGeomFromFile=b="file"===b;this._useGeomFromLayer=!b;b&&this.resetAddressValues(this._featureToolbar._originalValues);b&&!this._hasBeenLocatedForFile?this._hasBeenLocatedForFile||this._featureToolbar._locateFeature().then(t.hitch(this,function(g){this._featureToolbar._originalValues.duplicateGeometry=g.feature.geometry;this._hasBeenLocatedForFile=!0;var f=[g.feature,this._editFeature];if(g.feature.geometry.x!==this._editFeature.geometry.x||g.feature.geometry.y!==
this._editFeature.geometry.y)this.map&&this.map.extent&&this.map.extent.contains?this.map.extent.contains(g.feature.geometry)&&this.map.extent.contains(this._editFeature.geometry)||this.csvStore._zoomToData(f):this.csvStore._zoomToData(f);this._featureToolbar._flashFeatures(f);this._validateGeoms()})):(this._featureToolbar._updateFeature(this._useGeomFromFile?this._featureToolbar._originalValues.duplicateGeometry:this._editFeature.geometry,!1,!0),this._featureToolbar._flashFeatures([b?this._feature:
this._editFeature]),this._validateGeoms());this._useGeomFromLayer&&this._updateAddressFields(this._featureToolbar._originalValues.editAddress,!1);this._toggleLocationControls(!1);this._syncFields&&this._featureToolbar._updateSync(!this._validateAddressDifference())},_toggleFeature:function(b){if("keydown"!==b.type||b.keyCode===w.ENTER||b.keyCode===w.SPACE)(this._featureExpanded=!this._featureExpanded)?(this._locationExpanded=!1,I.set(this.featureTr,"aria-expanded","true"),I.set(this.locationTr,"aria-expanded",
"false"),this.lastFocusNode=this.locationTr):I.set(this.featureTr,"aria-expanded","false"),this._updateInfoRows(),this.parent.updateFirstLastNode(!1)},_toggleLocation:function(b){if("keydown"!==b.type||b.keyCode===w.ENTER||b.keyCode===w.SPACE)(this._locationExpanded=!this._locationExpanded)?(this._featureExpanded=!1,I.set(this.featureTr,"aria-expanded","false"),I.set(this.locationTr,"aria-expanded","true")):(I.set(this.locationTr,"aria-expanded","false"),this.lastFocusNode=this.locationTr),this._updateInfoRows(),
this._updateLocationPanelLastNode()},_updateLocationPanelLastNode:function(){var b,g=!1;H.contains(this.toggleLocation,"bg-toggle-down-img")?this.lastFocusNode=this.locationTr:(b=F.findWidgets(this.locationInformation))&&0<b.length&&(b.reverse(),x.some(b,t.hitch(this,function(f){if(f&&!f.disabled)return g=!0,this.lastFocusNode=f.domNode,!0})));g||(this.lastFocusNode=this.locationTr);this.parent.updateFirstLastNode(!1)},_updateInfoRows:function(){this._updateRow(this._featureExpanded,this.featureInformation,
this.toggleFeature);this._updateRow(this._locationExpanded,this.locationInformation,this.toggleLocation)},_updateRow:function(b,g,f){var r=["bg-toggle-up-img","bg-toggle-up-img-white"],u=["bg-toggle-down-img","bg-toggle-down-img-white"];b?H.remove(g,"display-none"):H.add(g,"display-none");this._updateImageNode(b?r:u,b?u:r,f)},updateImageNodes:function(){var b=this.pageContainer.isDarkTheme,g=b?"next-arrow-img":"next-arrow-img-white",f=b?"next-arrow-img-white":"next-arrow-img",r=m("."+g,this.domNode);
x.forEach(r,function(u){H.remove(u,g);H.add(u,f)});g=b?"bg-toggle-up-img":"bg-toggle-up-img-white";f=b?"bg-toggle-up-img-white":"bg-toggle-up-img";r=m("."+g,this.domNode);x.forEach(r,function(u){H.remove(u,g);H.add(u,f)});g=b?"bg-toggle-down-img":"bg-toggle-down-img-white";f=b?"bg-toggle-down-img-white":"bg-toggle-down-img";r=m("."+g,this.domNode);x.forEach(r,function(u){H.remove(u,g);H.add(u,f)})},_updateImageNode:function(b,g,f){var r=this.pageContainer.isDarkTheme;H.remove(f,r?g[1]:g[0]);H.add(f,
r?b[1]:b[0])},_toggleLocationControls:function(b){var g=this.isDuplicate&&this._useGeomFromLayer?!0:b;this.locationControlTable&&x.forEach(this.locationControlTable.rows,function(f){f.fromSelect&&f.fromSelect.set("disabled",b);f.isAddressRow&&f.addressValueTextBox&&f.addressValueTextBox.set("disabled",g)});g?this._featureToolbar._disableEdit():this._featureToolbar._enableEdit()},_useValuesChanged:function(b){this._useValuesFromFile=b="file"===b;this._useValuesFromLayer=!b;this._toggleEnabled(b);this._validateValues();
this._syncFields&&this._featureToolbar._updateSync(!this._validateAddressDifference())},_toggleEnabled:function(b){x.forEach(this.featureControlTable.rows,function(g){g.isRadioRow||(g.fileValueTextBox&&g.fileValueTextBox.set("disabled",!b),g.layerValueTextBox&&g.layerValueTextBox.set("disabled",b))})},_toggleEditControls:function(b){this.featureControlTable&&x.forEach(this.featureControlTable.rows,function(g){g.isRadioRow&&g.fromSelect.set("disabled",b);g.isEditRow&&(g.fileValueTextBox&&(b?g.fileValueTextBox.set("disabled",
b):g.parent.isDuplicate&&g.parent._useValuesFromFile?g.fileValueTextBox.set("disabled",b):g.parent.isDuplicate||g.fileValueTextBox.set("disabled",b)),g.layerValueTextBox&&(b?g.layerValueTextBox.set("disabled",b):g.parent.isDuplicate&&g.parent._useValuesFromLayer?g.layerValueTextBox.set("disabled",b):g.parent.isDuplicate||g.layerValueTextBox.set("disabled",b)))});this._toggleLocationControls(b)},resetAttributeValues:function(){x.forEach(this.featureControlTable.rows,t.hitch(this,function(b){b.fileValueTextBox&&
b.fileValueTextBox.set("value",void 0===b.fileValue?"":b.fileValue);b.layerValueTextBox&&b.layerValueTextBox.set("value",b.layerValue)}));this._changedFileAttributeRows=[];this._changedLayerAttributeRows=[]},resetAddressValues:function(b,g){x.forEach(this.locationControlTable.rows,t.hitch(this,function(f){var r=this.csvStore.useAddr&&!this.csvStore.useMultiFields?"Match_addr":f.keyField;f.addressValueTextBox&&(r=this.isDuplicate&&this._useGeomFromLayer&&"not-duplicate"!==g?b.editAddress&&b.editAddress.hasOwnProperty(r)?
b.editAddress[r]:void 0:f.addressValue,f.addressValueTextBox.set("value",r))}))},resetGeometry:function(b){this._feature.geometry=b;this.feature.geometry=b;this._featureToolbar._updateLayer(this.layer,null,[this._feature],null,!1,!0).then(t.hitch(this,function(){this._featureToolbar._flashFeatures([this._feature])}));this.resetFromLayerRows()},resetFromLayerRows:function(){this.isDuplicate&&(this._featureToolbar._fileGeometryModified||(this._useGeomFromLayer=!0),this._featureToolbar._fileValuesModified||
(this._useValuesFromLayer=!0),x.forEach(this.featureControlTable.rows,t.hitch(this,function(b){b.fromSelect&&("geom"===b.useType&&this._useGeomFromLayer||"values"===b.useType&&this._useValuesFromLayer)&&b.fromSelect.set("value","layer")})),x.forEach(this.locationControlTable.rows,t.hitch(this,function(b){b.fromSelect&&("geom"===b.useType&&!this._useGeomFromLayer||"values"===b.useType&&this._useValuesFromLayer)&&b.fromSelect.set("value","layer")})))},setStyleColor:function(b){this.styleColor=b;this._featureToolbar.styleColor=
b}})})},"widgets/DataAggregation/js/UI/FeatureToolbar":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Evented dojo/query dojo/dom-class dojo/dom-attr dojo/dom-construct dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin dojo/on dojo/keys dojox/gfx/fx dojo/text!./templates/FeatureToolbar.html esri/toolbars/edit jimu/dijit/Message jimu/dijit/Popup jimu/portalUtils jimu/utils esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/Color esri/graphic esri/geometry/webMercatorUtils esri/request".split(" "),
function(K,t,x,C,H,I,w,F,z,G,B,v,D,d,m,k,c,a,e,l,p,q,h,n,b,g){return K([G,B,C],{templateString:m,baseClass:"cf-feature-toolbar",declaredClass:"FeatureToolbar",label:"FeatureToolbar",parent:null,nls:null,map:null,appConfig:null,config:null,feature:null,layer:null,theme:"",locators:[],styleColor:"",featureView:null,_editToolbar:null,csvStore:null,_isAddressFeature:!0,_stageLayer:null,constructor:function(f){t.mixin(this,f);this._syncDisabled=this._locateDisabled=this._cancelDisabled=this._saveDisabled=
!0;this._hasAttributeEdit=!1;this.own(v(this.featureView,"attribute-change",t.hitch(this,this._attributeChange)));this._hasAddressEdit=!1;this.own(v(this.featureView,"address-change",t.hitch(this,this._addressChange)));this._hasGeometryEdit=!1;this.own(v(this._editToolbar,"graphic-move-stop",t.hitch(this,this._graphicMoveStop)));this.own(v(this.featureView,"address-located",t.hitch(this,this._graphicMoveStop)));this.locator=this._getLocator(0);this._initOriginalValues()},postCreate:function(){this.inherited(arguments)},
startup:function(){this.inherited(arguments);this._started=!0;this.updateImageNodes()},_getLocator:function(f){for(var r;f<this.csvStore._geocodeSources.length;f++)if(this.locatorSource=this.csvStore._geocodeSources[f],this.locatorSource.locator.locationToAddress){r=this.locatorSource.locator;this._locatorIndex=f;break}r&&(r.outSpatialReference=this.map.spatialReference,r.countryCode=this.locatorSource.countryCode);return r},_initOriginalValues:function(){this._originalValues=t.clone(this.featureView.feature)},
_attributeChange:function(f){this._hasAttributeEdit=f;this.featureView.isDuplicate&&this.featureView._useGeomFromLayer?this._updateSaveAndCancel(!this._hasAttributeEdit):this._updateSaveAndCancel(!(this._hasAttributeEdit||this._hasGeometryEdit));this._updateSync(!this.featureView._validateAddressDifference())},_addressChange:function(f){this._hasAddressEdit=f;this._updateLocate(!f)},_graphicMoveStop:function(f){this.featureView.isShowing&&(this._hasGeometryEdit=!0,this.featureView.isDuplicate&&this.featureView._useGeomFromLayer?
this._updateSaveAndCancel(!this._hasAttributeEdit):this._updateSaveAndCancel(!(this._hasAttributeEdit||this._hasGeometryEdit)),this.map.infoWindow.setFeatures(this.featureView._feature),this.map.infoWindow.select(0),f?this._reverseLocate(f.graphic.geometry).then(t.hitch(this,function(){this._hasAddressEdit=!0;this._updateLocate(!0);this.featureView._validateAddressDifference()&&this._updateSync(!1);this.locator=this._getLocator(0)}),function(r){this.locator=this._getLocator(0);new c(r)}):this.featureView._validateAddressDifference()&&
this._updateSync(!1))},_reverseLocate:function(f){var r=new z;if(this._isAddressFeature){var u=this.parent.portal?this.parent.portal:this.appConfig.portalUrl?e.getPortal(this.appConfig.portalUrl):null,y=this.locatorSource&&this.locatorSource.isEsriLocator;g({url:this.locator.url+"/reverseGeocode",content:{f:"json",location:JSON.stringify(f),distance:100,outSR:JSON.stringify(f.spatialReference),forStorage:y?this.featureView.isDuplicate&&!this.featureView.isDuplicateLocated||this.featureView.isUnMatched&&
!this.featureView.isUnMatchedLocated:!1,token:y?u&&u.credential&&u.credential.token?u.credential.token:null:null},callbackParamName:"callback"}).then(t.hitch(this,function(A){this.featureView._updateAddressFields(A.address,!1);r.resolve({address:A.address})}),t.hitch(this,function(A){this._getNextLocator()?this._reverseLocate(f).then(function(E){r.resolve(E)}):(this.featureView._updateAddressFields({},!1),r.reject({message:A.message}))}))}else f.spatialReference.isWebMercator&&f.spatialReference.isWebMercator()&&
(u=b.webMercatorToGeographic(f)),this.featureView._updateAddressFields(u||f,!1),r.resolve({geometry:f});return r},_enableEdit:function(){this._editToolbar.activate(k.MOVE,this.featureView._feature)},_disableEdit:function(){this._editToolbar.deactivate()},_undoEdits:function(){this._hasAttributeEdit&&(this.featureView.resetAttributeValues(),this._hasAttributeEdit=!1);this._hasAddressEdit&&(this.featureView.resetAddressValues(this._originalValues),this._hasAddressEdit=!1);this._hasGeometryEdit?(this.featureView.resetGeometry(this._originalValues.geometry),
this._hasGeometryEdit=!1):this.featureView.resetFromLayerRows();this._updateSync(!this.featureView._validateAddressDifference());this._updateLocate(!0)},_locate:function(f){if("keydown"!==f.type||f.keyCode===D.ENTER||f.keyCode===D.SPACE)this._locateDisabled||this._locateFeature().then(t.hitch(this,function(){this._hasAddressEdit=!1;this._updateLocate(!0)}))},_cancel:function(f){if(("keydown"!==f.type||f.keyCode===D.ENTER||f.keyCode===D.SPACE)&&!this._cancelDisabled)var r=new a({titleLabel:this.nls.featureToolbar.cancelTitle,
width:400,autoHeight:!0,content:F.create("div",{innerHTML:this.nls.featureToolbar.cancelMessage,style:"padding-bottom: 10px;"}),buttons:[{label:this.nls.yes,onClick:t.hitch(this,function(){r.close();r=null;this._undoEdits();this._updateSaveAndCancel(!0);this._panToAndSelectFeature(this.featureView.isDuplicate&&this.featureView._useGeomFromLayer?this.featureView._editFeature:this.featureView._feature)})},{label:this.nls.no,onClick:t.hitch(this,function(){r.close()})}],onClose:t.hitch(this,function(){r=
null})})},_save:function(f,r){if("keydown"!==f.type||f.keyCode===D.ENTER||f.keyCode===D.SPACE){var u=this.featureView._feature;if(!this._saveDisabled||!0===r){!0!==r&&(this._setFieldValues(this.featureView),this._setAddressValues(this.featureView),this.featureView.feature.geometry=u.geometry,this._originalValues.geometry=u.geometry,this.featureView.isDuplicate&&(this._originalValues.duplicateGeometry=u.geometry));if(-1===this.featureView.label.indexOf("UnMatched")&&-1===this.featureView.label.indexOf("DuplicateFeatures"))this._updateLayer(this._stageLayer,
null,[u],null,!0,!1).then(t.hitch(this,function(A){A&&"success"===A.status&&this._updateFeatureListLabel(u)}));else if(this.featureView.isDuplicate&&!0!==r)this.featureView._updateDuplicateAttributes(null,!0),this._updateLayer(this.layer,null,[u],null,!0,!1).then(t.hitch(this,function(A){A&&"success"===A.status&&this._updateFeatureListLabel(u)}));else{var y=u.attributes[this.layer.objectIdField];this._updateLayer(this.layer,null,null,[u],!0,!1).then(t.hitch(this,function(A){A&&"success"===A.status&&
this.featureView._parentFeatureList.removeFeature(this.featureView.feature,y).then(t.hitch(this,function(){x.forEach(this.featureView._skipFields,t.hitch(this,function(E){delete u.attributes[E]}));this._updateLayer(this._stageLayer,[u],null,null,!0,!1).then(t.hitch(this,function(E){E&&"success"===E.status&&(E.hasOwnProperty("objectId")&&(this.featureView.feature.fieldInfo.filter(t.hitch(this,function(J){return J.name===this._stageLayer.objectIdField}))[0].value=E.objectId),this.featureView.feature.label=
u.attributes[this.csvStore.labelField],E=this.parent._pageContainer.getViewByTitle("Review"),E.matchedFeatureList.addFeature(this.featureView.feature),E.matchedFeatureList.resetFeatureList(),E._updateReviewRows(!0===r?"duplicate":"unmatched"))}))}))}))}!0!==r&&this._updateSaveAndCancel(!0)}}},_updateFeatureListLabel:function(f){var r=this.csvStore.labelField;f=f.attributes[r];var u=l.stripHTML(f.toString?f.toString():"");u!==this.featureView.featureListLabel.innerHTML&&("."!==this.csvStore.decimalSeperator&&
(f=this.feature.fieldInfo.filter(function(y){return y.name===r&&y.needsFormat&&-1===[null,void 0].indexOf(u)}))&&f.hasOwnProperty("length")&&0<f.length&&(u=l.localizeNumber(u),f[0].formattedValue=u),this.featureView.featureListLabel.innerHTML=u,this.featureView.pageTitleDiv.innerHTML=u)},_updateLayer:function(f,r,u,y,A,E){var J=new z;f.applyEdits(r,u,y).then(t.hitch(this,function(L){var M={status:"success"};this.featureView.isDuplicate&&(this._hasGeometryEdit&&this.featureView._useGeomFromFile&&(this._fileGeometryModified=
!0),this._hasAttributeEdit&&this.featureView._useValuesFromFile&&(this._fileValuesModified=!0));A&&(this._hasAttributeEdit=this._hasGeometryEdit=!1);L&&L.hasOwnProperty("length")&&0<L.length&&L[0].hasOwnProperty("objectId")&&(M.objectId=L[0].objectId);!E&&u&&u.hasOwnProperty("length")&&0<u.length&&(L=this.featureView.parent._pageContainer.getViewByTitle("Review"),L._updateNode(L.submitButton,!0));J.resolve(M)}),t.hitch(this,function(L){new c({message:this.nls.warningsAndErrors.saveError});J.resolve({status:"error",
error:L})}));return J},_setFieldValues:function(f){var r=f._useValuesFromFile,u=r?f._changedFileAttributeRows:f._changedLayerAttributeRows,y=f._feature,A=f.feature;x.forEach(f.featureControlTable.rows,function(E){if(E.isEditRow&&-1<u.indexOf(E.rowIndex)||E.parent&&E.parent.isDuplicate&&!r){var J=E.parent.isDuplicate&&!r?E.layerValueTextBox:E.fileValueTextBox;y.attributes[E.fieldName]=J.value;A.fieldInfo.filter(function(M){return M.name===E.fieldName})[0].value=J.value;E.parent.isDuplicate&&!r?E.layerValue=
J.value:E.fileValue=J.value;if(J.textbox)J.textbox.title=J.value;else if(J.domNode){var L=J.attr("displayedValue");J.domNode.title=L?L:J.value}}})},_setAddressValues:function(f){var r=f._getAddress(),u=this.csvStore.matchFieldPrefix;f.isDuplicate&&f._useGeomFromLayer||x.forEach(f.addressFields,function(y){var A=u+y.keyField;f.feature.fieldInfo.filter(function(L){return L.name===A})[0].value=r[A];for(var E,J=0;J<f.locationControlTable.rows.length&&(E=f.locationControlTable.rows[J],!E.isAddressRow||
E.keyField!==y.keyField);J++);E.addressValueTextBox.textbox?E.addressValueTextBox.textbox.title=r[A]:E.addressValueTextBox.domNode&&(y=E.addressValueTextBox.attr("displayedValue"),E.addressValueTextBox.domNode.title=y?y:E.addressValueTextBox.value);E.addressValue=r[A]})},_updateFeature:function(f,r,u){var y=this.featureView;y.feature.geometry=f;y._feature.geometry=f;f=[y._feature];y.isDuplicate?(y.isDuplicateLocated||(y.isDuplicateLocated=!0),this._hasGeometryEdit=y._editFeature.geometry.x!==y._feature.geometry.x||
y._editFeature.geometry.y!==y._feature.geometry.y):y.isUnMatched&&!y.isUnMatchedLocated&&(y.isUnMatchedLocated=!0);r||this._updateLayer(y.layer,null,f,null,!1,u).then(t.hitch(this,function(A){A&&"success"===A.status&&(this._panToAndSelectFeature(y._feature),y.emit("address-located"))}))},_locateFeature:function(f){var r=new z,u=this.featureView._getAddressFieldsValues();if(this._isAddressFeature){var y=this.parent.portal?this.parent.portal:this.appConfig.portalUrl?e.getPortal(this.appConfig.portalUrl):
null;this._addressToLocation({address:u,countryCode:this.locatorSource.countryCode,outFields:["ResultID","Score"],forStorage:this.featureView.isDuplicate&&!this.featureView.isDuplicateLocated||this.featureView.isUnMatched&&!this.featureView.isUnMatchedLocated,token:y&&y.credential&&y.credential.token?y.credential.token:null}).then(t.hitch(this,function(A){this.locator=this._getLocator(0);this._updateFeature(A.location,f,!0);r.resolve({feature:this.featureView.feature,address:A.address})}),function(A){new c({message:A.message})})}else u=
this.csvStore._getGeometry(u[this.xField],u[this.yField]),this._updateFeature(u,f,!0),r.resolve({feature:this.featureView.feature,geometry:u});return r},_addressToLocation:function(f){var r=new z;f.maxLocations=1;this.locator.addressToLocations(f,t.hitch(this,function(u){var y=this.csvStore.minScore,A;u&&0<u.length?(x.forEach(u,function(E){"undefined"===typeof A&&E.score>=y&&(A=E);A&&E.score>A.score&&(A=E)}),A?r.resolve(A):this._getNextLocator()?this._addressToLocation(f).then(function(E){r.resolve(E)}):
r.reject({message:this.nls.warningsAndErrors.cannotLocate})):this._getNextLocator()?this._addressToLocation(f).then(function(E){r.resolve(E)}):r.reject({message:this.nls.warningsAndErrors.cannotLocate})}),function(u){r.reject(u)});return r},_getNextLocator:function(){var f=!1,r=this._locatorIndex+1;r<this.csvStore._geocodeSources.length&&(this.locator=this._getLocator(r),f="undefined"!==typeof this.locator);return f},_flashFeatures:function(f){var r;x.forEach(f,t.hitch(this,function(u){if(u.geometry){var y=
h.fromHex(this.styleColor),A=t.clone(y);A.a=.4;y=new p(p.STYLE_CIRCLE,15,new q(q.STYLE_SOLID,y,1),A);u=new n(u.geometry,y);this.map.graphics.add(u);r=u.getLayer?u.getLayer():r;(u=u.getDojoShape())&&d.animateStroke({shape:u,duration:900,color:{start:u.strokeStyle.color,end:u.strokeStyle.color},width:{start:25,end:0}}).play()}}));setTimeout(t.hitch(this,function(u){u&&u.clear&&(u.clear(),f&&(f[0]._layer&&f[0]._layer.infoTemplate||f[0].infoTemplate)&&(this.map.infoWindow.setFeatures(f),this.map.infoWindow.select(0)))}),
1200,r)},_panToAndSelectFeature:function(f){if(f&&f.geometry){var r=this.map.getMaxZoom(),u=Math.round(.25*r);this.map.centerAndZoom(f.geometry,0<r-u?r-u:r).then(t.hitch(this,function(){this._flashFeatures([f])}))}},setStyleColor:function(f){this.styleColor=f},_updateCancel:function(f){this._cancelDisabled=f;this._updateImageNode("bg-cancel","bg-cancel-white","bg-cancel-disabled",this._cancelDisabled,this.domNode);this.cancelButton&&(f?w.set(this.cancelButton,"tabindex","-1"):w.set(this.cancelButton,
"tabindex","0"))},_updateSaveAndCancel:function(f){this._updateSave(f);this._updateCancel(f)},_updateSave:function(f){this._saveDisabled=f;this._updateImageNode("bg-save","bg-save-white","bg-save-disabled",this._saveDisabled,this.domNode);this.saveButton&&(f?w.set(this.saveButton,"tabindex","-1"):w.set(this.saveButton,"tabindex","0"))},_updateLocate:function(f){this._locateDisabled=f;this._updateImageNode("bg-locate","bg-locate-white","bg-locate-disabled",this._locateDisabled,this.featureView.domNode);
f?w.set(this.featureView.locateButton,"tabindex","-1"):w.set(this.featureView.locateButton,"tabindex","0")},_updateSync:function(f){this._syncDisabled=f;this.featureView.syncFields&&(this._updateImageNode("bg-sync","bg-sync-white","bg-sync-disabled",this._syncDisabled,this.featureView.domNode),f?w.set(this.featureView.syncFields,"tabindex","-1"):w.set(this.featureView.syncFields,"tabindex","0"))},updateImageNodes:function(){this._updateImageNode("bg-cancel","bg-cancel-white","bg-cancel-disabled",
this._cancelDisabled,this.domNode);this._updateImageNode("bg-save","bg-save-white","bg-save-disabled",this._saveDisabled,this.domNode);this._updateImageNode("bg-locate","bg-locate-white","bg-locate-disabled",this._locateDisabled,this.featureView.domNode);this._updateImageNode("bg-sync","bg-sync-white","bg-sync-disabled",this._syncDisabled,this.featureView.domNode)},_updateImageNode:function(f,r,u,y,A){var E=this.pageContainer.isDarkTheme,J=y?u:E?r:f,L=E?r:f;y=!1;E=H("."+f,A);E.hasOwnProperty("length")&&
0===E.length?E=H("."+u,A):(y=!0,L=f);!y&&E.hasOwnProperty("length")&&0===E.length?E=H("."+r,A):y||(y=!0,L=u);x.forEach(E,function(M){I.remove(M,L);I.add(M,J)})}})})},"dojox/gfx/fx":function(){define("dojo/_base/lang ./_base ./matrix dojo/_base/Color dojo/_base/array dojo/_base/fx dojo/_base/connect dojo/sniff".split(" "),function(K,t,x,C,H,I,w,F){function z(a,e){this.start=a;this.end=e}function G(a,e,l){this.start=a;this.end=e;this.units=l}function B(a,e){this.start=a;this.end=e;this.temp=new C}function v(a){this.values=
a;this.length=a.length}function D(a,e){this.values=a;this.def=e?e:{}}function d(a,e){this.stack=a;this.original=e}function m(a,e,l,p){if(a.values)return new v(a.values);var q;var h=a.start?t.normalizeColor(a.start):q=e?l?e[l]:e:p;a.end?a=t.normalizeColor(a.end):(q||(q=e?l?e[l]:e:p),a=q);return new B(h,a)}var k=t.fx={};z.prototype.getValue=function(a){return(this.end-this.start)*a+this.start};G.prototype.getValue=function(a){return(this.end-this.start)*a+this.start+this.units};B.prototype.getValue=
function(a){return C.blendColors(this.start,this.end,a,this.temp)};v.prototype.getValue=function(a){return this.values[Math.min(Math.floor(a*this.length),this.length-1)]};D.prototype.getValue=function(a){var e=K.clone(this.def),l;for(l in this.values)e[l]=this.values[l].getValue(a);return e};d.prototype.getValue=function(a){var e=[];H.forEach(this.stack,function(l){if(l instanceof x.Matrix2D)e.push(l);else if("original"==l.name&&this.original)e.push(this.original);else if("matrix"==l.name){if(l.start instanceof
x.Matrix2D&&l.end instanceof x.Matrix2D){var p=new x.Matrix2D;for(q in l.start)p[q]=(l.end[q]-l.start[q])*a+l.start[q];e.push(p)}}else if(l.name in x)if(p=x[l.name],"function"!=typeof p)e.push(p);else{var q=H.map(l.start,function(h,n){return(l.end[n]-h)*a+h});p=p.apply(x,q);p instanceof x.Matrix2D&&e.push(p)}},this);return e};var c=new C(0,0,0,0);k.animateStroke=function(a){a.easing||(a.easing=I._defaultEasing);var e=new I.Animation(a),l=a.shape,p;w.connect(e,"beforeBegin",e,function(){p=l.getStroke();
var q=a.color,h={};q&&(h.color=m(q,p,"color",c));(q=a.style)&&q.values&&(h.style=new v(q.values));if(q=a.width){var n=q,b=p;if(n.values)var g=new v(n.values);else q=n.start?n.start:g=b?b.width:1,n.end?g=n.end:"number"!=typeof g&&(g=b?b.width:1),g=new z(q,g);h.width=g}(q=a.cap)&&q.values&&(h.cap=new v(q.values));if(q=a.join)q.values?h.join=new v(q.values):(g=q.start?q.start:p&&p.join||0,q=q.end?q.end:p&&p.join||0,"number"==typeof g&&"number"==typeof q&&(h.join=new z(g,q)));this.curve=new D(h,p)});
w.connect(e,"onAnimate",l,"setStroke");return e};k.animateFill=function(a){a.easing||(a.easing=I._defaultEasing);var e=new I.Animation(a),l=a.shape,p;w.connect(e,"beforeBegin",e,function(){p=l.getFill();var q=a.color;q&&(this.curve=m(q,p,"",c))});w.connect(e,"onAnimate",l,"setFill");return e};k.animateFont=function(a){a.easing||(a.easing=I._defaultEasing);var e=new I.Animation(a),l=a.shape,p;w.connect(e,"beforeBegin",e,function(){p=l.getFont();var q=a.style,h={};q&&q.values&&(h.style=new v(q.values));
(q=a.variant)&&q.values&&(h.variant=new v(q.values));(q=a.weight)&&q.values&&(h.weight=new v(q.values));(q=a.family)&&q.values&&(h.family=new v(q.values));if((q=a.size)&&q.units){var n=parseFloat(q.start?q.start:l.font&&l.font.size||"0");var b=parseFloat(q.end?q.end:l.font&&l.font.size||"0");h.size=new G(n,b,q.units)}this.curve=new D(h,p)});w.connect(e,"onAnimate",l,"setFont");return e};k.animateTransform=function(a){a.easing||(a.easing=I._defaultEasing);var e=new I.Animation(a),l=a.shape,p;w.connect(e,
"beforeBegin",e,function(){p=l.getTransform();this.curve=new d(a.transform,p)});w.connect(e,"onAnimate",l,"setTransform");if("svg"===t.renderer&&(9<=F("ie")||F("ff")))var q=[w.connect(e,"onBegin",e,function(){for(var h=l.getParent();h&&h.getParent;)h=h.getParent();h&&(l.__svgContainer=h.rawNode.parentNode,l.__svgRoot=h.rawNode,l.__svgRoot&&l.__svgRoot.getAttribute&&(l.__svgWidth=parseInt(l.__svgRoot.getAttribute("width"),10),isNaN(l.__svgWidth)&&delete l.__svgWidth))}),w.connect(e,"onAnimate",e,function(){try{if(l.__svgContainer){var h=
l.__svgContainer.style.visibility;l.__svgContainer.style.visibility="visible";l.__svgContainer.style.visibility=h;var n=l.__svgWidth;if(!isNaN(n))try{l.__svgRoot.setAttribute("width",n-5E-6),l.__svgRoot.setAttribute("width",n)}catch(b){}}}catch(b){}}),w.connect(e,"onEnd",e,function(){H.forEach(q,w.disconnect);if(l.__svgContainer){var h=l.__svgContainer;if(null==h.getAttribute("__gotVis")){h.setAttribute("__gotVis",!0);var n=l.__svgContainer.style.visibility,b=l.__svgRoot,g=l.__svgWidth;h.style.visibility=
"visible";setTimeout(function(){try{h.style.visibility=n;h.removeAttribute("__gotVis");h=null;try{isNaN(g)||(b.setAttribute("width",g-5E-6),b.setAttribute("width",g))}catch(f){}}catch(f){}},100)}}delete l.__svgContainer;delete l.__svgRoot;delete l.__svgWidth})];return e};return k})},"esri/toolbars/edit":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/has dojo/dom-construct dojo/dom-style ../kernel ../lang ../sniff ./_toolbar ./_Box ./_GraphicMover ./_VertexEditor ./TextEditor ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/TextSymbol ../graphic".split(" "),
function(K,t,x,C,H,I,w,F,z,G,B,v,D,d,m,k,c,a,e,l,p){var q=t(D,{declaredClass:"esri.toolbars.Edit",constructor:function(h,n){this._map=h;this._tool=0;if(this._map.loaded)this._scratchGL=h.graphics;else var b=C.connect(this._map,"onLoad",this,function(){C.disconnect(b);b=null;this._scratchGL=this._map.graphics});h=w("esri-mobile");this._defaultOptions=x.mixin({vertexSymbol:new a(a.STYLE_CIRCLE,h?20:12,new e(e.STYLE_SOLID,new I([0,0,0,.5]),1),new I([128,128,128])),ghostVertexSymbol:new a(a.STYLE_CIRCLE,
h?18:10,new e(e.STYLE_SOLID,new I([0,0,0,.5]),1),new I([255,255,255,.75])),ghostLineSymbol:new e(e.STYLE_DOT,new I([128,128,128]),2),allowDeleteVertices:!0,allowAddVertices:!0,rotateHandleOffset:h?24:16,boxLineSymbol:new e(e.STYLE_DASH,new I([64,64,64]),1),boxHandleSymbol:new a(a.STYLE_SQUARE,h?16:9,new e(e.STYLE_SOLID,new I([0,0,0,.5]),1),new I([255,255,255,.75])),textAnchorSymbol:new a(a.STYLE_CIRCLE,10,null,new I([255,0,0]))},n||{})},activate:function(h,n,b){this.deactivate();this._graphic=n;this._options=
x.mixin(x.mixin({},this._defaultOptions),b||{});var g=q.MOVE;b=q.EDIT_VERTICES;var f=q.SCALE,r=q.ROTATE,u=q.EDIT_TEXT,y=!1,A=!1,E=!1,J=this._map,L=J.spatialReference,M=n.geometry.spatialReference;this._geo=!(!L||!M||L.equals(M)||!L.isWebMercator()||4326!==M.wkid);this._isTextPoint=this._prepareTextSymbolEditing(n,h);(h&g)===g&&(y=this._enableMove(n));g=(h&f)===f;r=(h&r)===r;if(g||r)E=this._enableBoxEditing(n,g,r);(h&b)===b&&(A=this._enableVertexEditing(n));(h&u)===u&&this._enableTextEditing(n);if(!(y||
A||E))throw Error("[esri.toolbars.Edit::activate] Unable to activate the tool. Check if the tool is valid for the given geometry type.");if(this._tool=h)this._mapPanEndHandle=C.connect(J,"onPanEnd",this,this._mapPanEndHandler),this._mapExtChgHandle=C.connect(J,"onExtentChange",this,this._mapExtentChangeHandler),this.onActivate(this._tool,n);J.snappingManager&&(y||A)&&J.snappingManager._startSelectionLayerQuery()},deactivate:function(){this._isTextPoint=null;var h=this._tool,n=this._graphic;if(h){var b=
!!this._modified;this._clear();C.disconnect(this._mapPanEndHandle);C.disconnect(this._mapExtChgHandle);this._graphic=this._geo=this._mapPanEndHandle=this._mapExtChgHandle=null;this.onDeactivate(h,n,{isModified:b});this._map.snappingManager&&this._map.snappingManager._stopSelectionLayerQuery()}},refresh:function(){this._refreshMoveables(!0)},getCurrentState:function(){return{tool:this._tool,graphic:this._graphic,isModified:!!this._modified}},onActivate:function(h,n){},onDeactivate:function(h,n,b){},
onGraphicMoveStart:function(h){},onGraphicFirstMove:function(h){this._modified=!0},onGraphicMove:function(h,n){},onGraphicMoveStop:function(h,n){},onGraphicClick:function(h,n){},onVertexMoveStart:function(h,n){},onVertexFirstMove:function(h,n){this._modified=!0},onVertexMove:function(h,n,b){},onVertexMoveStop:function(h,n,b){},onVertexAdd:function(h,n){this._modified=!0},onVertexClick:function(h,n){},onVertexMouseOver:function(h,n){},onVertexMouseOut:function(h,n){},onVertexDelete:function(h,n){this._modified=
!0},onTextEditStart:function(h,n){},onTextEditEnd:function(h){},onScaleStart:function(h){},onScaleFirstMove:function(h){this._modified=!0},onScale:function(h,n){},onScaleStop:function(h,n){},onRotateStart:function(h){},onRotateFirstMove:function(h){this._modified=!0},onRotate:function(h,n){},onRotateStop:function(h,n){},_eventMap:{activate:["tool","graphic"],deactivate:["tool","graphic","info"],"graphic-move-start":["graphic"],"graphic-first-move":["graphic"],"graphic-move":["graphic","transform"],
"graphic-move-stop":["graphic","transform"],"graphic-click":["graphic","info"],"vertex-move-start":["graphic","vertexinfo"],"vertex-first-move":["graphic","vertexinfo"],"vertex-move":["graphic","vertexinfo","transform"],"vertex-move-stop":["graphic","vertexinfo","transform"],"vertex-add":["graphic","vertexinfo"],"vertex-click":["graphic","vertexinfo"],"vertex-mouse-over":["graphic","vertexinfo"],"vertex-mouse-out":["graphic","vertexinfo"],"vertex-delete":["graphic","vertexinfo"],"scale-start":["graphic"],
"scale-first-move":["graphic"],scale:["graphic","info"],"scale-stop":["graphic","info"],"rotate-start":["graphic"],"rotate-first-move":["graphic"],rotate:["graphic","info"],"rotate-stop":["graphic","info"]},_prepareTextSymbolEditing:function(h,n){if("point"===h.geometry.type||"multipoint"===h.geometry.type){var b=h.getLayer(),g=b.renderer;b=h.symbol||b._getSymbol(h);!b&&(g.hasVisualVariables("sizeInfo",!1)||g.hasVisualVariables("colorInfo",!1)||g.hasVisualVariables("opacityInfo",!1))&&g.addBreak&&
g.infos&&1===g.infos.length&&(b=g.infos[0].symbol||g.defaultSymbol);if(b&&"textsymbol"===b.type){if((n&q.SCALE)===q.SCALE||(n&q.ROTATE)===q.ROTATE||(n&q.EDIT_TEXT)===q.EDIT_TEXT){h.setSymbol(new l(b.toJson()));var f=this;this._textSymbolEditor?(this._textSymbolEditor.createForm(h),this._textSymbolEditor.show()):this._options&&this._options.textSymbolEditor?(this._textSymbolEditor=this._options.textSymbolEditor,this._textSymbolEditor.on("symbol-change",function(){f._boxEditor&&f._boxEditor.refresh()})):
K(["../dijit/SymbolEditor"],function(r){if(!f._textSymbolEditor){var u=f._options.textSymbolEditorHolder?F.create("div",null,f._options.textSymbolEditorHolder):F.create("div",null,f._map.root);f._textSymbolEditor=new r({graphic:h},u);r=f._textSymbolEditor.domNode.parentNode.id;z.set(f._textSymbolEditor.domNode,{position:"map_root"===r?"absolute":"relative",left:"map_root"===r?f._map.width/2-100+"px":"5px",top:"20px","z-index":50});f._textSymbolEditor.startup();f._textSymbolEditor.createForm(h);f._textSymbolEditor.show();
f._textSymbolEditor.on("symbol-change",function(){f._boxEditor&&f._boxEditor.refresh()})}})}if((n&q.MOVE)===q.MOVE||(n&q.ROTATE)===q.ROTATE||(n&q.SCALE)===q.SCALE)this._textAnchor=new p(h.geometry,this._options.textAnchorSymbol),this._scratchGL.add(this._textAnchor);return!0}}return!1},_enableMove:function(h){var n=this._map;switch(h.geometry.type){case "point":case "polyline":case "polygon":return this._graphicMover=new m(h,n,this,this._textAnchor),!0}return!1},_enableVertexEditing:function(h){var n=
this._map;switch(h.geometry.type){case "multipoint":case "polyline":case "polygon":return this._vertexEditor=k.create(h,n,this),!0}return!1},_enableBoxEditing:function(h,n,b){var g=this._map,f=h.geometry.type;return"polyline"===f||"polygon"===f||this._isTextPoint?(this._boxEditor=new d(h,g,this,n,b,this._options.uniformScaling,this._isTextPoint),!0):!1},_enableTextEditing:function(h){return this._isTextPoint?(this._textEditor=new c(h,this._map,this),C.connect(this._textEditor,"onEditStart",x.hitch(this,
function(){this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._map.disableKeyboardNavigation();this._disableMove();this._disableBoxEditing()})),!0):!1},_disableMove:function(){var h=this._graphicMover;h&&(h.destroy(),this._graphicMover=null)},_disableVertexEditing:function(){var h=this._vertexEditor;h&&(h.destroy(),this._vertexEditor=null)},_disableBoxEditing:function(){var h=this._boxEditor;h&&(h.destroy(),this._boxEditor=null)},_disableTextEditing:function(){this._textEditor&&
(this._textEditor.destroy(),this._textEditor=null);this._map.enableKeyboardNavigation()},_disableSymbolEditing:function(){this._textSymbolEditor&&this._textSymbolEditor.hide()},_clear:function(){this._disableMove();this._disableVertexEditing();this._disableBoxEditing();this._disableTextEditing();this._disableSymbolEditing();this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._tool=0;this._modified=!1},_mapPanEndHandler:function(){this._refreshMoveables()},
_mapExtentChangeHandler:function(h,n,b){b&&this._refreshMoveables()},_refreshMoveables:function(h){var n=H.filter([this._graphicMover,this._vertexEditor,this._boxEditor],B.isDefined);H.forEach(n,function(b){b.refresh(h)})},_beginOperation:function(h){H.forEach(this._getAffectedTools(h),function(n){n.suspend()})},_endOperation:function(h){H.forEach(this._getAffectedTools(h),function(n){n.resume()})},_getAffectedTools:function(h){var n=[];switch(h){case "MOVE":n=[this._vertexEditor,this._boxEditor];
break;case "VERTICES":n=[this._boxEditor];break;case "BOX":n=[this._vertexEditor]}return n=H.filter(n,B.isDefined)}});x.mixin(q,{MOVE:1,EDIT_VERTICES:2,SCALE:4,ROTATE:8,EDIT_TEXT:16});w("extend-esri")&&x.setObject("toolbars.Edit",q,G);return q})},"esri/toolbars/_Box":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../lang ../geometry/Point ../geometry/Polyline ../symbols/SimpleMarkerSymbol ../geometry/webMercatorUtils ../geometry/jsonUtils ../graphic".split(" "),
function(K,t,x,C,H,I,w,F,z,G,B,v,D,d,m,k,c){K=K(null,{declaredClass:"esri.toolbars._Box",constructor:function(a,e,l,p,q,h,n){this._graphic=a;this._map=e;this._toolbar=l;this._scale=p;this._rotate=q;this._defaultEventArgs={};this._scaleEvent="Scale";this._rotateEvent="Rotate";this._uniformScaling=h;a=l._options;this._markerSymbol=a.boxHandleSymbol;this._lineSymbol=a.boxLineSymbol;this._moveStartHandler=t.hitch(this,this._moveStartHandler);this._firstMoveHandler=t.hitch(this,this._firstMoveHandler);
this._moveStopHandler=t.hitch(this,this._moveStopHandler);this._moveHandler=t.hitch(this,this._moveHandler);this._isTextPoint=n;this._init()},destroy:function(){this._cleanUp();this._graphic=this._map=this._toolbar=this._markerSymbol=this._lineSymbol=null},refresh:function(){this._draw()},suspend:function(){x.forEach(this._getAllGraphics(),function(a){a.hide()})},resume:function(){x.forEach(this._getAllGraphics(),function(a){a.show()});this._draw()},_init:function(){this._draw()},_cleanUp:function(){this._connects&&
x.forEach(this._connects,C.disconnect);var a=this._toolbar._scratchGL;this._anchors&&x.forEach(this._anchors,function(e){a.remove(e.graphic);(e=e.moveable)&&e.destroy()});this._box&&a.remove(this._box);this._box=this._anchors=this._connects=null},_draw:function(){if(this._graphic.getDojoShape()){var a=this._map,e=this._toolbar._scratchGL,l=this._getBoxCoords(),p=new D(a.spatialReference),q=t.clone(x.filter(l,function(h,n){return 8!==n&&0===n%2}));q[0]&&q.push([q[0][0],q[0][1]]);p.addPath(q);this._rotate&&
p.addPath([l[1],l[8]]);this._box?this._box.setGeometry(p):(this._box=new c(p,this._lineSymbol),e.add(this._box));this._anchors?x.forEach(this._anchors,function(h,n){this._scale||(n=8);var b=new v(l[n],a.spatialReference);h.graphic.setGeometry(b);b=h.moveable;var g=h.graphic.getDojoShape();g&&(b?g!==b.shape&&(b.destroy(),h.moveable=this._getMoveable(h.graphic,n)):h.moveable=this._getMoveable(h.graphic,n))},this):(this._anchors=[],this._connects=[],x.forEach(l,function(h,n){!this._scale&&8>n||(h=new v(h,
a.spatialReference),h=new c(h,this._markerSymbol),this._isTextPoint&&1===n%2&&h.hide(),e.add(h),this._anchors.push({graphic:h,moveable:this._getMoveable(h,n)}))},this))}else this._cleanUp()},_getBoxCoords:function(a){var e=this._map,l=[],p,q,h;if(this._isTextPoint){var n=this._graphic.getNode().getBoundingClientRect();var b=e.__container.getBoundingClientRect();n=[{x:n.left-b.left,y:n.top-b.top},{x:n.right-b.left,y:n.top-b.top},{x:n.right-b.left,y:n.bottom-b.top},{x:n.left-b.left,y:n.bottom-b.top}]}else n=
this._getTransformedBoundingBox(this._graphic);x.forEach(n,function(g,f,r){p=g;(q=r[f+1])||(q=r[0]);h={x:(p.x+q.x)/2,y:(p.y+q.y)/2};a||(p=e.toMap(p),h=e.toMap(h));l.push([p.x,p.y]);l.push([h.x,h.y])});this._rotate&&(n=t.clone(l[1]),n=a?{x:n[0],y:n[1]}:e.toScreen({x:n[0],y:n[1],spatialReference:e.spatialReference}),n.y-=this._toolbar._options.rotateHandleOffset,a||(n=e.toMap(n)),l.push([n.x,n.y]));return l},_getTransformedBoundingBox:function(a){var e=this._map,l=a.geometry.getExtent(),p=a.geometry.spatialReference;
a=new v(l.xmin,l.ymax,p);l=new v(l.xmax,l.ymin,p);a=e.toScreen(a);l=e.toScreen(l);return[{x:a.x,y:a.y},{x:l.x,y:a.y},{x:l.x,y:l.y},{x:a.x,y:l.y}]},_getAllGraphics:function(){var a=[this._box];this._anchors&&x.forEach(this._anchors,function(e){a.push(e.graphic)});return a=x.filter(a,B.isDefined)},_getMoveable:function(a,e){var l=a.getDojoShape();if(l)return a=new F(l),a._index=e,this._connects.push(C.connect(a,"onMoveStart",this._moveStartHandler)),this._connects.push(C.connect(a,"onFirstMove",this._firstMoveHandler)),
this._connects.push(C.connect(a,"onMoveStop",this._moveStopHandler)),a.onMove=this._moveHandler,(l=l.getEventSource())&&w.set(l,"cursor",this._toolbar._cursors["box"+e]),a},_moveStartHandler:function(a){this._toolbar["on"+(8===a.host._index?this._rotateEvent:this._scaleEvent)+"Start"](this._graphic)},_firstMoveHandler:function(a){this._toolbar._deactivateScrollWheel();var e=a.host._index,l=this._wrapOffset=a.host.shape._wrapOffsets[0]||0,p=this._graphic.getLayer().getNavigationTransform();a=x.map(this._getBoxCoords(!0),
function(h){return{x:h[0]+l,y:h[1]}});var q=this._isTextPoint?this._map.toScreen(this._graphic.geometry):{x:a[1].x,y:a[3].y};this._centerCoord=z.multiplyPoint(z.invert(p),q);if(8===e)q=z.multiplyPoint(z.invert(p),a[1]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,q)),this._startLine=[this._centerCoord,q],this._moveLine=t.clone(this._startLine);else if(q=z.multiplyPoint(z.invert(p),a[e]),p=z.multiplyPoint(z.invert(p),a[(e+4)%8]),this._isTextPoint&&(this._centerCoord=
this._deNormalizePoint(this._centerCoord,q)),this._firstMoverToAnchor=Math.sqrt((q.x-this._centerCoord.x)*(q.x-this._centerCoord.x)+(q.y-this._centerCoord.y)*(q.y-this._centerCoord.y)),this._startBox=p,this._startBox.width=a[4].x-a[0].x,this._startBox.height=a[4].y-a[0].y,this._moveBox=t.clone(this._startBox),this._xfactor=q.x>p.x?1:-1,this._yfactor=q.y>p.y?1:-1,1===e||5===e)this._xfactor=0;else if(3===e||7===e)this._yfactor=0;this._toolbar._beginOperation("BOX");this._toolbar["on"+(8===e?this._rotateEvent:
this._scaleEvent)+"FirstMove"](this._graphic)},_moveHandler:function(a,e){a=a.host._index;var l=this._defaultEventArgs;l.angle=0;l.scaleX=1;l.scaleY=1;if(8===a){var p=this._startLine;var q=this._moveLine;var h=q[1];h.x+=e.dx;h.y+=e.dy;e=this._getAngle(p,q);this._isTextPoint&&(e+=this._graphic.symbol.angle);q=z.rotategAt(e,p[0]);this._graphic.getDojoShape().setTransform(q);l.transform=q;l.angle=e;l.around=p[0]}else{p=this._startBox;q=this._moveBox;q.width+=e.dx*this._xfactor;q.height+=e.dy*this._yfactor;
this._uniformScaling||this._isTextPoint?(p=q.x+this._xfactor*q.width,q=q.y+this._yfactor*q.height,p=Math.sqrt((p-this._centerCoord.x)*(p-this._centerCoord.x)+(q-this._centerCoord.y)*(q-this._centerCoord.y)),this._scaleRatio=e=h=p/this._firstMoverToAnchor,p=this._centerCoord):(e=q.width/p.width,h=q.height/p.height,p={x:p.x,y:p.y});if(isNaN(e)||Infinity===e||-Infinity===e)e=1;if(isNaN(h)||Infinity===h||-Infinity===h)h=1;q=z.scaleAt(e,h,p);if(this._isTextPoint){var n=z.rotategAt(this._graphic.symbol.angle,
p);this._graphic.getDojoShape().setTransform([n,q])}else this._graphic.getDojoShape().setTransform(q);l.transform=q;l.scaleX=e;l.scaleY=h;l.around=p}this._toolbar["on"+(8===a?this._rotateEvent:this._scaleEvent)](this._graphic,l)},_moveStopHandler:function(a){this._toolbar._activateScrollWheel();var e=this._graphic,l=this._toolbar,p=l._geo?m.geographicToWebMercator(e.geometry):e.geometry,q=p.spatialReference,h=e.getDojoShape(),n=h.getTransform(),b=e.getLayer().getNavigationTransform();this._isTextPoint?
(e=this._graphic.symbol,8===a.host._index?e.angle+=this._getAngle(this._startLine,this._moveLine):e.font.setSize(Math.round(e.font.size*this._scaleRatio*100)/100),this._graphic.setSymbol(e)):(p=p.toJson(),this._updateSegments(p.paths||p.rings,n,b,q),h.setTransform(null),p=k.fromJson(p),e.setGeometry(l._geo?m.webMercatorToGeographic(p,!0):p));this._draw();this._startLine=this._moveLine=this._startBox=this._moveBox=this._xfactor=this._yfactor=null;l._endOperation("BOX");this._defaultEventArgs.transform=
n;l["on"+(8===a.host._index?this._rotateEvent:this._scaleEvent)+"Stop"](this._graphic,this._defaultEventArgs)},_updateSegments:function(a,e,l,p){var q=this._map,h=this._wrapOffset||0;x.forEach(a,function(n){x.forEach(n,function(b){this._updatePoint(b,p,h,z,q,l,e)},this)},this)},_updatePoint:function(a,e,l,p,q,h,n){e=q.toScreen({x:a[0],y:a[1],spatialReference:e},!0);e.x+=l;e=p.multiplyPoint([h,n,p.invert(h)],e);e.x-=l;l=q.toMap(e);a[0]=l.x;a[1]=l.y},_getAngle:function(a,e){return 180*Math.atan2(e[0].y-
e[1].y,e[0].x-e[1].x)/Math.PI-180*Math.atan2(a[0].y-a[1].y,a[0].x-a[1].x)/Math.PI},_deNormalizePoint:function(a,e){var l=this._map._getFrameWidth();if(-1===l)return a;for(a={x:a.x,y:a.y};Math.abs(a.x-e.x)>=l;)a.x=a.x<e.x?a.x+l:a.x-l;var p=Math.abs(a.x-e.x);Math.abs(a.x-e.x+l)<p?a.x+=l:Math.abs(a.x-e.x-l)<p&&(a.x-=l);return a}});I("extend-esri")&&t.setObject("toolbars._Box",K,G);return K})},"dojox/gfx/Moveable":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/_base/event dojo/topic dojo/touch dojo/dom-class dojo/_base/window ./Mover dojo/mouse".split(" "),
function(K,t,x,C,H,I,w,F,z,G){return t("dojox.gfx.Moveable",null,{constructor:function(B,v){this.shape=B;this.delay=v&&0<v.delay?v.delay:0;this.mover=v&&v.mover?v.mover:z;this.leftButtonOnly=v&&v.leftButtonOnly;this.events=[this.shape.on(I.press,K.hitch(this,"onMouseDown"))]},destroy:function(){x.forEach(this.events,function(B){B.remove()});this.events=this.shape=null},onMouseDown:function(B){this.delay?(this.events.push(this.shape.on(I.move,K.hitch(this,"onMouseMove")),this.shape.on(I.release,K.hitch(this,
"onMouseUp"))),this._lastX=B.clientX,this._lastY=B.clientY):this.leftButtonOnly&&!G.isLeft(B)||new this.mover(this.shape,B,this);C.stop(B)},onMouseMove:function(B){var v=B.clientY;if(Math.abs(B.clientX-this._lastX)>this.delay||Math.abs(v-this._lastY)>this.delay)this.onMouseUp(B),new this.mover(this.shape,B,this);C.stop(B)},onMouseUp:function(B){this.events.pop().remove()},onMoveStart:function(B){H.publish("/gfx/move/start",B);w.add(F.body(),"dojoMove")},onMoveStop:function(B){H.publish("/gfx/move/stop",
B);w.remove(F.body(),"dojoMove")},onFirstMove:function(B){},onMove:function(B,v,D){this.onMoving(B,v,D);this.shape.applyLeftTransform(v);this.onMoved(B,v)},onMoving:function(B,v){},onMoved:function(B,v){}})})},"dojox/gfx/Mover":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/on dojo/touch dojo/_base/event".split(" "),function(K,t,x,C,H,I){return x("dojox.gfx.Mover",null,{constructor:function(w,F,z){this.shape=w;this.lastX=F.clientX;this.lastY=F.clientY;w=this.host=z;F=
document;z=C(F,H.move,K.hitch(this,"onFirstMove"));this.events=[C(F,H.move,K.hitch(this,"onMouseMove")),C(F,H.release,K.hitch(this,"destroy")),C(F,"dragstart",K.hitch(I,"stop")),C(F,"selectstart",K.hitch(I,"stop")),z];if(w&&w.onMoveStart)w.onMoveStart(this)},onMouseMove:function(w){var F=w.clientX,z=w.clientY;this.host.onMove(this,{dx:F-this.lastX,dy:z-this.lastY},w);this.lastX=F;this.lastY=z;I.stop(w)},onFirstMove:function(){this.host.onFirstMove(this);this.events.pop().remove()},destroy:function(){t.forEach(this.events,
function(F){F.remove()});var w=this.host;if(w&&w.onMoveStop)w.onMoveStop(this);this.events=this.shape=null}})})},"esri/toolbars/_GraphicMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/dom-style dojox/gfx/Moveable dojox/gfx/Mover dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/webMercatorUtils ../geometry/ScreenPoint ../geometry/Point".split(" "),function(K,t,x,C,H,I,w,F,z,G,B,v,D,d){var m=K(null,{declaredClass:"esri.toolbars._GraphicMover",
constructor:function(k,c,a,e){this.graphic=k;this.map=c;this.toolbar=a;this.tempPt=e;this._enableGraphicMover();this._moved=!1},refresh:function(k){var c=this.graphic.getDojoShape();!c||!k&&c._hostGraphic||(this._disableGraphicMover(),this._enableGraphicMover())},destroy:function(){this._disableGraphicMover()},hasMoved:function(){return this._moved},_enableGraphicMover:function(){var k=this.graphic,c=k.getDojoShape();c&&(c._hostGraphic=k,this._moveable=new I(c,{mover:m.Mover}),this._moveStartHandle=
x.connect(this._moveable,"onMoveStart",this,this._moveStartHandler),this._firstMoveHandle=x.connect(this._moveable,"onFirstMove",this,this._firstMoveHandler),this._movingHandle=x.connect(this._moveable,"onMoving",this,this._movingHandler),this._moveStopHandle=x.connect(this._moveable,"onMoveStop",this,this._moveStopHandler),(k=c.getEventSource())&&H.set(k,"cursor",this.toolbar._cursors.move))},_disableGraphicMover:function(){var k=this._moveable;if(k){x.disconnect(this._moveStartHandle);x.disconnect(this._firstMoveHandle);
x.disconnect(this._movingHandle);x.disconnect(this._moveStopHandle);var c=k.shape;c&&(c._hostGraphic=null,(c=c.getEventSource())&&H.set(c,"cursor","inherit"));k.destroy()}this._moveable=null},_moveStartHandler:function(){var k=this.graphic,c=this.map;this._startTx=k.getDojoShape().getTransform();"point"===this.graphic.geometry.type&&c.snappingManager&&c.snappingManager._setUpSnapping();this.toolbar.onGraphicMoveStart(k)},_firstMoveHandler:function(){this.toolbar._beginOperation("MOVE");this.toolbar.onGraphicFirstMove(this.graphic)},
_movingHandler:function(k,c,a){k=k.shape.getTransform();c=this.map;var e;B("esri-pointer")?e=c.navigationManager.pointerEvents._processTouchEvent(a,a):a&&"pointermove"===a.type&&(e=G.prototype._processTouchEvent.call({map:c},a,a));e&&c.snappingManager&&c.snappingManager._onSnappingMouseMoveHandler(e);this.tempPt&&this.tempPt.getDojoShape().setTransform(k);this.toolbar.onGraphicMove(this.graphic,k)},_moveStopHandler:function(k){var c=this.graphic,a=this.toolbar,e=this.map,l=a._geo?v.geographicToWebMercator(c.geometry):
c.geometry,p=l.type,q=c.getDojoShape(),h=q.getTransform();if(C.toJson(h)!==C.toJson(this._startTx)){this._moved=!0;switch(p){case "point":p=[h,F.invert(this._startTx)];if(e.snappingManager)var n=e.snappingManager._snappingPoint;l=n||e.toMap(F.multiplyPoint(p,e.toScreen(l,!0)));e.snappingManager&&e.snappingManager._killOffSnapping();break;case "polyline":l=this._updatePolyGeometry(l,l.paths,h);break;case "polygon":l=this._updatePolyGeometry(l,l.rings,h)}q.setTransform(null);c.setGeometry(a._geo?v.webMercatorToGeographic(l,
!0):l);this.tempPt&&this.tempPt.setGeometry(new d(c.geometry.toJson()))}else this._moved=!1;a._endOperation("MOVE");a.onGraphicMoveStop(c,h);this._moved||(k=k.__e,e=this.map.position,k=new D(k.pageX-e.x,k.pageY-e.y),a.onGraphicClick(c,{screenPoint:k,mapPoint:this.map.toMap(k)}))},_updatePolyGeometry:function(k,c,a){var e=this.map,l=k.getPoint(0,0);e=e.toMap(e.toScreen(l).offset(a.dx,a.dy));a=e.x-l.x;l=e.y-l.y;var p;for(e=0;e<c.length;e++){var q=c[e];for(p=0;p<q.length;p++){var h=k.getPoint(e,p);k.setPoint(e,
p,h.offset(a,l))}}return k}});m.Mover=K(w,{declaredClass:"esri.toolbars._Mover",constructor:function(k,c,a){this.__e=c}});B("extend-esri")&&(t.setObject("toolbars._GraphicMover",m,z),t.setObject("toolbars._Mover",m.Mover,z));return m})},"esri/toolbars/_VertexEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dijit/Menu dijit/MenuItem ../kernel ./_VertexMover ../geometry/Point ../geometry/jsonUtils dojo/i18n!../nls/jsapi".split(" "),function(K,
t,x,C,H,I,w,F,z,G,B,v){var D=K(null,{declaredClass:"esri.toolbars._GraphicVertexEditor",constructor:function(d,m,k){this.graphic=d;this.map=m;this.toolbar=k;d=k._options;this._symbol1=d.vertexSymbol;this._symbol2=d.ghostVertexSymbol;m=d.ghostLineSymbol;this._lineStroke={style:m.style,width:m.width,color:m.color};this._canDel=d.allowDeleteVertices;this._canAdd=d.allowAddVertices;this._addControllers()},destroy:function(){this._removeControllers()},refresh:function(d){d?(this._removeControllers(),this._addControllers()):
(this._refresh(this._vertexMovers),this._refresh(this._mpVertexMovers))},suspend:function(){this._suspended||this._removeControllers();this._suspended=!0},resume:function(){this._suspended&&this._addControllers();this._suspended=!1},_addControllers:function(){this._firstMoveHandle=x.connect(z,"onFirstMove",this,this._firstMoveHandler);this._moveStopHandle=x.connect(z,"onMoveStop",this,this._moveStopHandler);this._vertexMovers=this._add(this._getSegments(this.graphic.geometry),this._symbol1);this._canAdd&&
(this._mpVertexMovers=this._add(this._getMidpointSegments(this.graphic.geometry),this._symbol2,!0));var d=this._getGraphicsLayer();this._mouseOverHandle=x.connect(d,"onMouseOver",this,this._mouseOverHandler);this._mouseOutHandle=x.connect(d,"onMouseOut",this,this._mouseOutHandler);this._canDel&&(this._ctxMenu=new I({style:"font-size: 12px; margin-left: 5px; margin-top: 5px;"}),d=this._ctxDelete=new w({label:v.toolbars.edit.deleteLabel,iconClass:"vertexDeleteIcon",style:"outline: none;"}),this._deleteHandle=
x.connect(d,"onClick",this,this._deleteHandler),this._ctxMenu.addChild(d),this._ctxMenu.startup())},_removeControllers:function(){x.disconnect(this._firstMoveHandle);x.disconnect(this._moveStopHandle);x.disconnect(this._mouseOverHandle);x.disconnect(this._mouseOutHandle);x.disconnect(this._deleteHandle);this._ctxMenu&&(this._ctxDelete=null,this._unbindCtxNode(),this._ctxMenu.destroyRecursive());this._remove(this._vertexMovers);this._remove(this._mpVertexMovers);this._vertexMovers=this._mpVertexMovers=
null},_add:function(d,m,k){var c,a,e=this.graphic,l=[];for(c=0;c<d.length;c++){var p=d[c],q=[];for(a=0;a<p.length;a++)q.push(new z(p[a],m,e,c,a,p.length,this,k));l.push(q)}return l},_remove:function(d){d&&C.forEach(d,function(m){C.forEach(m,function(k){k.destroy()})})},_refresh:function(d){d&&C.forEach(d,function(m){C.forEach(m,function(k){k.refresh()})})},_isNew:function(d){return-1===C.indexOf(this._vertexMovers[d.segIndex],d)?!0:!1},_getGraphicsLayer:function(){return this.toolbar._scratchGL},
_deleteHandler:function(d){d=this._selectedMover;this._updateRelatedGraphic(d,d.relatedGraphic,d.graphic.geometry,d.segIndex,d.ptIndex,d.segLength,!1,!0);this._canAdd&&this._deleteMidpoints(d);this._deleteVertex(d);this.toolbar._endOperation("VERTICES")},_mouseOverHandler:function(d){d=d.graphic;var m=this._findMover(d);m&&(this.toolbar.onVertexMouseOver(this.graphic,m._getInfo()),m._placeholder||(this._selectedMover=m,this._canDel&&this._bindCtxNode(d.getDojoShape().getNode())))},_mouseOutHandler:function(d){if(d=
this._findMover(d.graphic))this.toolbar.onVertexMouseOut(this.graphic,d._getInfo())},_bindCtxNode:function(d){this._unbindCtxNode();this._ctxDelete.set("disabled",this._selectedMover.segLength<=this.minLength?!0:!1);this._ctxMenu.bindDomNode(d);this._bindNode=d},_unbindCtxNode:function(){var d=this._bindNode;d&&this._ctxMenu.unBindDomNode(d)},_findMover:function(d){var m=[];var k=this._mpVertexMovers;C.forEach(this._vertexMovers,function(a){m=m.concat(a)});k&&C.forEach(k,function(a){m=m.concat(a)});
for(k=0;k<m.length;k++){var c=m[k];if(c.graphic===d)return c}},_firstMoveHandler:function(d){!this._isNew(d)&&this._canAdd&&this._hideRelatedMidpoints(d);this.toolbar._beginOperation("VERTICES")},_moveStopHandler:function(d,m){var k=this._isNew(d);m&&(m.dx||m.dy)?(this._updateRelatedGraphic(d,d.relatedGraphic,d.graphic.geometry,d.segIndex,d.ptIndex,d.segLength,k),this._canAdd&&(k?this._addMidpoints(d):(this._repositionRelatedMidpoints(d),this._showRelatedMidpoints(d))),this.toolbar._endOperation("VERTICES")):
!k&&this._canAdd&&this._showRelatedMidpoints(d)},_showRelatedMidpoints:function(d){var m=this._getAdjacentMidpoints(d.ptIndex,d.segLength),k=this._mpVertexMovers[d.segIndex];for(d=0;d<m.length;d++){var c=k[m[d]];c.graphic.show();c.refresh()}},_hideRelatedMidpoints:function(d){var m=this._getAdjacentMidpoints(d.ptIndex,d.segLength),k=this._mpVertexMovers[d.segIndex];for(d=0;d<m.length;d++)k[m[d]].graphic.hide()},_repositionRelatedMidpoints:function(d){var m,k=this._getAdjacentMidpoints(d.ptIndex,d.segLength),
c=this._mpVertexMovers[d.segIndex];for(m=0;m<k.length;m++){var a=this._getAdjacentVertices(k[m],d.segLength),e=d.relatedGraphic.geometry.getPoint(d.segIndex,a[0]);a=d.relatedGraphic.geometry.getPoint(d.segIndex,a[1]);e=new G({x:(e.x+a.x)/2,y:(e.y+a.y)/2,spatialReference:e.spatialReference.toJson()});c[k[m]].graphic.setGeometry(e)}},_addMidpoints:function(d){var m=d.segIndex,k=d.ptIndex,c=d.segLength,a=k+1,e,l=c+1;this._mpVertexMovers[m].splice(k,1);var p=this._vertexMovers[m];for(e=0;e<a;e++)p[e].segLength+=
1;for(e=a;e<p.length;e++)p[e].ptIndex+=1,p[e].segLength+=1;d.ptIndex=a;d.segLength=p.length+1;p.splice(a,0,d);d.graphic.setSymbol(this._symbol1);p=this._mpVertexMovers[m];for(e=0;e<k;e++)p[e].segLength+=1;for(e=k;e<c-1;e++)p[e].ptIndex+=1,p[e].segLength+=1;a=this._getAdjacentVertices(k,l);m=this._getAdjacentVertices(k+1,l);c=d.relatedGraphic.geometry.getPoint(d.segIndex,a[0]);e=d.relatedGraphic.geometry.getPoint(d.segIndex,a[1]);a=new G({x:(c.x+e.x)/2,y:(c.y+e.y)/2,spatialReference:c.spatialReference.toJson()});
c=d.relatedGraphic.geometry.getPoint(d.segIndex,m[0]);e=d.relatedGraphic.geometry.getPoint(d.segIndex,m[1]);m=new G({x:(c.x+e.x)/2,y:(c.y+e.y)/2,spatialReference:c.spatialReference.toJson()});c=new z(a,this._symbol2,this.graphic,d.segIndex,k,l,this,!0);d=new z(m,this._symbol2,this.graphic,d.segIndex,k+1,l,this,!0);p.splice(k,0,c,d)},_deleteVertex:function(d){var m,k=d.ptIndex,c=this._vertexMovers[d.segIndex];for(m=0;m<k;m++)--c[m].segLength;for(m=k+1;m<c.length;m++){var a=c[m];--a.ptIndex;--a.segLength}c.splice(k,
1);m=d._getInfo();d.destroy();this.toolbar.onVertexDelete(this.graphic,m)}});t.mixin(D,{create:function(d,m,k){switch(d.geometry.type){case "multipoint":return new D.MultipointVertexEditor(d,m,k);case "polyline":return new D.PolylineVertexEditor(d,m,k);case "polygon":return new D.PolygonVertexEditor(d,m,k)}}});D.MultipointVertexEditor=K(D,{declaredClass:"esri.toolbars._MultipointVertexEditor",minLength:1,constructor:function(){this._moveStartHandle=x.connect(z,"onMoveStart",this,this._moveStartHandler);
x.disconnect(this._firstMoveHandle)},destroy:function(){this.inherited(arguments);x.disconnect(this._moveStartHandle)},_getSegments:function(d){var m=d.points,k=[],c=d.spatialReference;for(d=0;d<m.length;d++){var a=m[d];k.push(new G({x:a[0],y:a[1],spatialReference:c.toJson()}))}return[k]},_getMidpointSegments:function(d){return[]},_getControlPoints:function(d,m,k,c,a){return[]},_getGraphicsLayer:function(){return this.graphic._graphicsLayer},_mouseOverHandler:function(d){var m=d.graphic;if(d=this._findMover(d))this.toolbar.onVertexMouseOver(m,
d._getInfo()),this._selectedMover=d,this._canDel&&this._bindCtxNode(d.graphic.getDojoShape().getNode())},_mouseOutHandler:function(d){var m=d.graphic;if(d=this._findMover(d))this.toolbar.onVertexMouseOut(m,d._getInfo())},_findMover:function(d){var m=[].concat(this._vertexMovers[0]),k=d.target;for(d=0;d<m.length;d++){var c=m[d];if(c.graphic.getDojoShape().getNode()===k)return c}},_moveStartHandler:function(d){var m=d.ptIndex,k=d.segLength-1,c=d.relatedGraphic.geometry.points;d=c.splice(m,1);c.push(d[0]);
c=this._vertexMovers[0];for(d=k;d>m;d--)--c[d].ptIndex;d=c.splice(m,1);c.push(d[0]);d[0].ptIndex=k},_moveStopHandler:function(d){this._updateRelatedGraphic(d,d.relatedGraphic,d.graphic.geometry,d.segIndex,d.ptIndex,d.segLength);this.toolbar._endOperation("VERTICES")},_updateRelatedGraphic:function(d,m,k,c,a,e,l,p){d=m.geometry;p?d.removePoint(a):d.setPoint(a,k);m.setGeometry(d)},_deleteMidpoints:function(d){}});D.PolylineVertexEditor=K(D,{declaredClass:"esri.toolbars._PolylineVertexEditor",minLength:2,
_getSegments:function(d){var m,k,c=d.paths,a=[];for(m=0;m<c.length;m++){var e=c[m],l=[];for(k=0;k<e.length;k++)l.push(d.getPoint(m,k));a.push(l)}return a},_getMidpointSegments:function(d){var m,k,c=d.paths,a=[],e=d.spatialReference;for(m=0;m<c.length;m++){var l=c[m],p=[];for(k=0;k<l.length-1;k++){var q=d.getPoint(m,k),h=d.getPoint(m,k+1);q=new G({x:(q.x+h.x)/2,y:(q.y+h.y)/2,spatialReference:e.toJson()});p.push(q)}a.push(p)}return a},_getControlPoints:function(d,m,k,c,a){var e=this.map,l,p;this._isNew(d)?
(d=c,c+=1,0<=d&&(l=e.toScreen(m.getPoint(k,d))),c<=a&&(p=e.toScreen(m.getPoint(k,c)))):(d=c-1,c+=1,0<=d&&(l=e.toScreen(m.getPoint(k,d))),c<a&&(p=e.toScreen(m.getPoint(k,c))));return[l,p]},_getAdjacentMidpoints:function(d,m){var k=[],c=d-1;0<=c&&k.push(c);d<m-1&&k.push(d);return k},_getAdjacentVertices:function(d,m){return[d,d+1]},_deleteMidpoints:function(d){var m=this._mpVertexMovers[d.segIndex],k=m.length-1,c=this._getAdjacentMidpoints(d.ptIndex,d.segLength).sort(),a,e=c[0];for(a=0;a<e;a++)--m[a].segLength;
for(a=e+1;a<m.length;a++){var l=m[a];--l.ptIndex;--l.segLength}if(1===c.length)m.splice(e,1)[0].destroy();else for(l=this._getAdjacentVertices(e,k),a=d.relatedGraphic.geometry.getPoint(d.segIndex,l[0]),l=d.relatedGraphic.geometry.getPoint(d.segIndex,l[1]),a=new G({x:(a.x+l.x)/2,y:(a.y+l.y)/2,spatialReference:a.spatialReference.toJson()}),d=new z(a,this._symbol2,this.graphic,d.segIndex,e,k,this,!0),m=m.splice(e,c.length,d),a=0;a<m.length;a++)m[a].destroy()},_updateRelatedGraphic:function(d,m,k,c,a,
e,l,p){d=m.geometry;l?d.insertPoint(c,a+1,B.fromJson(k.toJson())):p?d.removePoint(c,a):d.setPoint(c,a,B.fromJson(k.toJson()));m.setGeometry(d)}});D.PolygonVertexEditor=K(D,{declaredClass:"esri.toolbars._PolygonVertexEditor",minLength:3,_getSegments:function(d){var m,k,c=d.rings,a=[];for(m=0;m<c.length;m++){var e=c[m],l=[];for(k=0;k<e.length-1;k++)l.push(d.getPoint(m,k));a.push(l)}return a},_getMidpointSegments:function(d){var m,k,c=d.rings,a=[],e=d.spatialReference;for(m=0;m<c.length;m++){var l=c[m],
p=[];for(k=0;k<l.length-1;k++){var q=d.getPoint(m,k),h=d.getPoint(m,k+1);q=new G({x:(q.x+h.x)/2,y:(q.y+h.y)/2,spatialReference:e.toJson()});p.push(q)}a.push(p)}return a},_getControlPoints:function(d,m,k,c,a){var e=this.map;this._isNew(d)?d=c:(d=c-1,d=0>d?(a+d)%a:d);c=(c+1)%a;a=e.toScreen(m.getPoint(k,d));m=e.toScreen(m.getPoint(k,c));return[a,m]},_getAdjacentMidpoints:function(d,m){var k=d-1;return[0>k?(m+k)%m:k,d]},_getAdjacentVertices:function(d,m){return[d,(d+1)%m]},_deleteMidpoints:function(d){var m=
d.ptIndex,k=this._mpVertexMovers[d.segIndex],c=k.length-1,a=this._getAdjacentMidpoints(m,d.segLength).sort();var e=a[0];var l=a[a.length-1];if(0===m){var p=this._getAdjacentVertices(c-1,c);m=d.relatedGraphic.geometry.getPoint(d.segIndex,p[0]);p=d.relatedGraphic.geometry.getPoint(d.segIndex,p[1]);m=new G({x:(m.x+p.x)/2,y:(m.y+p.y)/2,spatialReference:m.spatialReference.toJson()});d=new z(m,this._symbol2,this.graphic,d.segIndex,c-1,c,this,!0);k.splice(l,1,d)[0].destroy();k.splice(e,1)[0].destroy();for(a=
0;a<k.length-1;a++)e=k[a],--e.ptIndex,--e.segLength}else{p=this._getAdjacentVertices(e,c);m=d.relatedGraphic.geometry.getPoint(d.segIndex,p[0]);p=d.relatedGraphic.geometry.getPoint(d.segIndex,p[1]);m=new G({x:(m.x+p.x)/2,y:(m.y+p.y)/2,spatialReference:m.spatialReference.toJson()});d=new z(m,this._symbol2,this.graphic,d.segIndex,e,c,this,!0);l=k.splice(e,a.length,d);for(a=0;a<l.length;a++)l[a].destroy();for(a=0;a<e;a++)--k[a].segLength;for(a=e+1;a<k.length;a++)e=k[a],--e.ptIndex,--e.segLength}},_updateRelatedGraphic:function(d,
m,k,c,a,e,l,p){d=m.geometry;l?d.insertPoint(c,a+1,B.fromJson(k.toJson())):p?(d.removePoint(c,a),0===a&&d.setPoint(c,e-1,B.fromJson(d.getPoint(c,0).toJson()))):(d.setPoint(c,a,B.fromJson(k.toJson())),0===a&&d.setPoint(c,e,B.fromJson(k.toJson())));m.setGeometry(d)}});H("extend-esri")&&(t.setObject("toolbars._GraphicVertexEditor",D,F),t.setObject("toolbars._MultipointVertexEditor",D.MultipointVertexEditor,F),t.setObject("toolbars._PolylineVertexEditor",D.PolylineVertexEditor,F),t.setObject("toolbars._PolygonVertexEditor",
D.PolygonVertexEditor,F));return D})},"esri/toolbars/_VertexMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/sniff dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/Point ../graphic ../geometry/webMercatorUtils".split(" "),function(K,t,x,C,H,I,w,F,z,G,B,v,D){K=K(null,{declaredClass:"esri.toolbars.VertexMover",constructor:function(d,m,k,c,a,e,l,p){this.point=d;this.symbol=m;this.relatedGraphic=k;this.segIndex=c;this.ptIndex=
a;this.segLength=e;this.editor=l;this.map=l.map;this._scratchGL=l.toolbar._scratchGL;this._placeholder=p||!1;this._type=k.geometry.type;this._init();this._enable()},refresh:function(d){if(d||this._needRefresh())this._disable(),this._enable()},destroy:function(){this._disable();this.graphic&&this._scratchGL.remove(this.graphic);this.point=this.symbol=this.graphic=this.relatedGraphic=this.segIndex=this.ptIndex=this.segLength=this.editor=this.map=this._scratchGL=null},_init:function(){var d=new B(this.point.toJson());
d=new v(d,this.symbol);switch(this._type){case "multipoint":d._shape=this.relatedGraphic.getDojoShape().children[this.ptIndex];break;case "polyline":case "polygon":this._scratchGL.add(d)}this.graphic=d},_enable:function(){var d=this.graphic.getDojoShape();d&&(d._hasMover=!0,this._moveable=this._getMoveable(d),(d=d.getEventSource())&&H.set(d,"cursor",this.editor.toolbar._cursors[this._placeholder?"move-gv":"move-v"]))},_disable:function(){var d=this._moveable;if(d){x.disconnect(this._startHandle);
x.disconnect(this._firstHandle);x.disconnect(this._movingHandle);x.disconnect(this._stopHandle);var m=d.shape;m&&(m=m.getEventSource())&&H.set(m,"cursor","inherit");d.destroy();this._moveable=null}},_needRefresh:function(){var d=this.graphic.getDojoShape(),m=!1;if(d)switch(this._type){case "multipoint":var k=this.relatedGraphic.getDojoShape();k&&(k=k.children[this.ptIndex],d!==k&&(this.graphic._shape=k,m=!0));break;case "polyline":case "polygon":m=!d._hasMover}return m},_getMoveable:function(d){d=
new I(d,C("mac")&&C("ff")&&!G("esri-touch")&&{leftButtonOnly:!0});this._startHandle=x.connect(d,"onMoveStart",this,this._moveStartHandler);this._firstHandle=x.connect(d,"onFirstMove",this,this._firstMoveHandler);this._movingHandle=x.connect(d,"onMoving",this,this._movingHandler);this._stopHandle=x.connect(d,"onMoveStop",this,this._moveStopHandler);return d},_getPtIndex:function(){return this.ptIndex+(this._placeholder?1:0)},_getInfo:function(){return{graphic:this.graphic,isGhost:this._placeholder,
segmentIndex:this.segIndex,pointIndex:this._getPtIndex()}},_moveStartHandler:function(d){var m=this.map;m.snappingManager&&m.snappingManager._setUpSnapping();this.editor.toolbar._deactivateScrollWheel();this._startTx=this.graphic.getDojoShape().getTransform();d.shape.moveToFront();this.constructor.onMoveStart(this);this.editor.toolbar.onVertexMoveStart(this.relatedGraphic,this._getInfo())},_firstMoveHandler:function(d){var m=d.shape,k=this._getControlEdges(),c=this._scratchGL._div,a,e=[],l=d.host.shape._wrapOffsets[0]||
0;for(a=0;a<k.length;a++){var p=k[a];p.x1+=l;p.x2+=l;e.push([c.createLine({x1:p.x1,y1:p.y1,x2:p.x2,y2:p.y2}).setStroke(this.editor._lineStroke),p.x1,p.y1,p.x2,p.y2])}m._lines=e;d.shape.moveToFront();this.constructor.onFirstMove(this);this.editor.toolbar.onVertexFirstMove(this.relatedGraphic,this._getInfo())},_movingHandler:function(d,m,k){m=this.map;var c;G("esri-pointer")?c=m.navigationManager.pointerEvents._processTouchEvent(k,k):k&&"pointermove"===k.type&&(c=z.prototype._processTouchEvent.call({map:m},
k,k));c&&m.snappingManager&&m.snappingManager._onSnappingMouseMoveHandler(c);k=d.shape;d=k.getTransform();k=k._lines;for(c=0;c<k.length;c++)m=k[c],m[0].setShape({x1:m[1]+d.dx,y1:m[2]+d.dy,x2:m[3],y2:m[4]});this.editor.toolbar.onVertexMove(this.relatedGraphic,this._getInfo(),d)},_moveStopHandler:function(d){d=d.shape;var m=this.editor.toolbar,k=d.getTransform(),c=this.map,a=this.graphic,e=m._geo?D.geographicToWebMercator(a.geometry):a.geometry;m._activateScrollWheel();var l,p=d._lines;if(p){for(l=
0;l<p.length;l++)p[l][0].removeShape();d._lines=null}l=!1;p=!0;var q=this._getInfo();k&&(k.dx||k.dy)?this._placeholder&&(this._placeholder=!1,l=!0):p=!1;if(c.snappingManager)var h=c.snappingManager._snappingPoint;var n=[k,w.invert(this._startTx)];h=h||c.toMap(w.multiplyPoint(n,c.toScreen(e,!0)));c.snappingManager&&c.snappingManager._killOffSnapping();d.setTransform(null);a.setGeometry(m._geo?D.webMercatorToGeographic(h,!0):h);this.constructor.onMoveStop(this,k);m.onVertexMoveStop(this.relatedGraphic,
q,k);if(!p)m.onVertexClick(this.relatedGraphic,q);if(l)m.onVertexAdd(this.relatedGraphic,this._getInfo())},_getControlEdges:function(){var d=this.map,m=this.relatedGraphic.geometry,k=this.segIndex,c=this.ptIndex,a=this.segLength,e=this._scratchGL.getNavigationTransform(),l=e.dx;e=e.dy;var p=d.toScreen(this.graphic.geometry);d=p.x-l;p=p.y-e;var q=[];m=this.editor._getControlPoints(this,m,k,c,a);m[0]&&q.push({x1:d,y1:p,x2:m[0].x-l,y2:m[0].y-e});m[1]&&q.push({x1:d,y1:p,x2:m[1].x-l,y2:m[1].y-e});return q}});
G("extend-esri")&&t.setObject("toolbars.VertexMover",K,F);t.mixin(K,{onMoveStart:function(){},onFirstMove:function(){},onMoveStop:function(){}});return K})},"esri/toolbars/TextEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/has dojo/dom-construct dojo/dom-class dojo/dom-style dojo/keys ../kernel".split(" "),function(K,t,x,C,H,I,w,F,z,G){K=K(null,{declaredClass:"esri.toolbars.TextEditor",constructor:function(B,v,D){this._graphic=B;this._map=v;
this._toolbar=D;this._enable(this._graphic)},destroy:function(){this._disable()},onEditStart:function(){},onEditEnd:function(){},_enable:function(B){this._editBox?(x.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null):(this._map.navigationManager.setImmediateClick(!0),this._addEditBoxHandler=x.connect(B.getLayer(),"onDblClick",this,function(v){this._map.navigationManager.setImmediateClick(!1);v.graphic==B&&(C.stop(v),x.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null,
this._addTextBox(B))}))},_disable:function(){this._applyEdit();this._addEditBoxHandler&&(x.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null);this._removeTextBox();this.onEditEnd(this._graphic);this._toolbar.onTextEditEnd(this._graphic)},_addTextBox:function(B,v){if(!this._editBox){if(!B.symbol.text){B.symbol.text="Tempt text";B.setSymbol(B.symbol);var D=""}var d=this._createInputTextStyle(B,this._map);""!==D&&(D=v||B.symbol.text);this._editBox=I.create("input",{type:"text",value:D});
F.set(this._editBox,d);w.add(this._editBox,"esriTextEditorInput");this._map.container.appendChild(this._editBox);this._editBox.focus();this._editBoxKeyHandler=x.connect(this._editBox,"onkeyup",t.hitch(this,function(k){k.keyCode!=z.ENTER&&k.keyCode!==z.TAB||this._disable()}));this._editBoxBlurHandler=x.connect(this._editBox,"onblur",t.hitch(this,function(k){this._disable()}));B.symbol.text="";B.setSymbol(B.symbol);B.hide();var m=this._editBox;this._disableBoxHandler||(this._disableBoxHandler=this._map.on("zoom-start",
t.hitch(this,function(){this._disable()})));this._moveBoxHandler=this._map.on("pan",function(k){F.set(m,{left:this._editBoxLeft+k.delta.x+"px",top:this._editBoxTop+k.delta.y+"px"})});this._moveBoxStartHandler=this._map.on("pan-start",function(){this._editBoxLeft=parseFloat(F.get(m,"left"));this._editBoxTop=parseFloat(F.get(m,"top"))});this.onEditStart(B,this._editBox);this._toolbar.onTextEditStart(B,this._editBox)}},_removeTextBox:function(){this._editBoxBlurHandler&&(x.disconnect(this._editBoxBlurHandler),
this._editBoxBlurHandler=null);this._editBox&&(this._editBox.parentNode.removeChild(this._editBox),this._editBox=null);this._disableBoxHandler&&(this._disableBoxHandler.remove(),this._disableBoxHandler=null);this._moveBoxHandler&&(this._moveBoxHandler.remove(),this._moveBoxHandler=null);this._moveBoxStartHandler&&(this._moveBoxStartHandler.remove(),this._moveBoxStartHandler=null);this._editBoxKeyHandler&&(x.disconnect(this._editBoxKeyHandler),this._editBoxKeyHandler=null)},_createInputTextStyle:function(B,
v){v=B.getDojoShape().getTransformedBoundingBox();var D=B.getLayer();D=D.hasLocalNavigationTransform()?{dx:0,dy:0}:D.getNavigationTransform();var d=B.symbol.font;return{"font-family":d.family,"font-size":d.size+"px","font-style":d.style,"font-variant":d.variant,"font-weight":d.weight,left:v[0].x+D.dx+"px",top:v[0].y+D.dy+"px",width:Math.abs(v[0].x-v[1].x)/Math.cos(B.symbol.angle/180*Math.PI)+"px"}},_applyEdit:function(){if(this._editBox)if(this._editBox.value){this._graphic.show();var B=this._graphic.symbol;
B.text=this._editBox.value;this._graphic.setSymbol(B)}else this._graphic.getLayer().remove(this._graphic)}});H("extend-esri")&&t.setObject("toolbars.TextEditor",K,G);return K})},"widgets/DataAggregation/js/UI/LocationType":function(){define("dojo/_base/declare dojo/_base/lang dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/Deferred dojo/on dojo/keys dojo/text!./templates/LocationType.html dijit/form/RadioButton".split(" "),function(K,t,x,C,H,I,w,F,z,G){return K([x,
C,H,I],{baseClass:"cf-location-type",declaredClass:"CriticalFacilities.LocationType",templateString:G,_started:null,label:"LocationType",parent:null,nls:null,map:null,appConfig:null,config:null,useAddress:!0,useCoordinates:!1,theme:"",styleColor:"",_coordinatesView:void 0,_addressView:void 0,constructor:function(B){t.mixin(this,B)},postCreate:function(){this.inherited(arguments);this._initRadioButtons()},_initRadioButtons:function(){this.own(F(this.rdoAddress,"change",t.hitch(this,this._rdoAddressChanged)));
this.own(F(this.rdoCoordinates,"change",t.hitch(this,this._rdoCoordinateChanged)));this.rdoAddress.set("checked",this.useAddress);this.useAddress&&(this.lastFocusNode=this.rdoAddress.focusNode);this.rdoCoordinates.set("checked",this.useCoordinates)},startup:function(){this._started=!0;this._updateAltIndexes()},onShown:function(){this.pageContainer.nextDisabled=!1},validate:function(B,v){var D=new w;"next-view"===B?D.resolve(this._nextView()):"back-view"===B?D.resolve(this._backView()):this._homeView(v).then(function(d){D.resolve(d)});
return D},_nextView:function(){return!0},_backView:function(){return!0},_homeView:function(B){var v=new w;this.pageContainer.getViewByTitle("Home").verifyClearSettings(B).then(function(D){v.resolve(D)});return v},_updateAltIndexes:function(){if(this.pageContainer&&!this._coordinatesView&&!this._addressView){this._coordinatesView=this.pageContainer.getViewByTitle("Coordinates");this._addressView=this.pageContainer.getViewByTitle("Addresses");var B=this.rdoAddress.get("checked");this._addressView&&
this._coordinatesView&&(this._addressView.altBackIndex=this.index,this._coordinatesView.altBackIndex=this.index,this.altNextIndex=B?this._addressView.index:this._coordinatesView.index)}},_rdoAddressClick:function(){this.rdoAddress.set("checked",!0)},_rdoAddressChanged:function(B){this.useAddress=B;this._addressView&&this._coordinatesView&&(this.altNextIndex=B?this._addressView.index:this._coordinatesView.index);B&&(this.lastFocusNode=this.rdoAddress.focusNode,this.parent.updateFirstLastNode(!1));
this.parent._locationMappingComplete=!1},_rdoCoordinateClick:function(){this.rdoCoordinates.set("checked",!0)},_rdoCoordinateChanged:function(B){this.useCoordinates=B;this._addressView&&this._coordinatesView&&(this.altNextIndex=B?this._coordinatesView.index:this._addressView.index);B&&(this.lastFocusNode=this.rdoCoordinates.focusNode,this.parent.updateFirstLastNode(!1));this.parent._locationMappingComplete=!1},setStyleColor:function(B){this.styleColor=B},updateImageNodes:function(){},_getResults:function(){return this.useAddress?
this._addressView._getResults():this._coordinatesView._getResults()}})})},"jimu/dijit/EditorXssFilter":function(){define("dojo/_base/declare dojo/_base/array dijit/_WidgetBase dojo/_base/lang dojo/Evented libs/arcgis-html-sanitizer/arcgis-html-sanitizer".split(" "),function(K,t,x,C,H,I){var w=null,F=K([x,H],{baseClass:"jimu-editor-xss-filter",declaredClass:"jimu.dijit.EditorXssFilter",sanitizer:null,xss:null,whiteList:{},graphicsWhiteList:{},postCreate:function(){this.whiteList=this._getWhiteList();
this.sanitizer=new I({whiteList:this.whiteList,safeAttrValue:C.hitch(this,function(z,G,B,v){return"style"===G?this.xss.friendlyAttrValue(B).replace(/"/g,"'"):"img"===z&&"src"===G?this.xss.escapeAttrValue(B):this.xss.safeAttrValue(z,G,B,v)}),onTag:C.hitch(this,function(z,G,B){if(B.isWhite&&this._isInWhiteList(z,this.graphicsWhiteList))return G}),onIgnoreTagAttr:C.hitch(this,function(z,G,B,v){if("data-"===G.substr(0,5))return G+'\x3d"'+this.xss.escapeAttrValue(B)+'"'}),onIgnoreTag:C.hitch(this,function(z,
G,B){if("o:"===z.substr(0,2)||"!--[if"===z||"!--[endif]--"===z)return G})},!0);this.xss=this.sanitizer.xss},sanitize:function(z){return this.sanitizer.sanitize(z)},_getWhiteList:function(){var z="title height width class style font-family id align text-align".split(" "),G={div:z,h1:z,h2:z,h3:z,h4:z,h5:z,h6:z,span:z,p:z,s:z,strong:z,em:z,u:z,ol:z,ul:z,li:z,a:["href","target"].concat(z),img:["src","alt","border"].concat(z),blockquote:z,font:["face","size","color"].concat(z),pre:z,code:z,b:z,i:z,wbr:z,
video:"autoplay controls loop muted poster preload".split(" ").concat(z),audio:["autoplay","controls","loop","muted","preload"].concat(z),source:["media","src","type"].concat(z),table:["cellpadding","cellspacing","border"].concat(z),tbody:[].concat(z),tr:["valign"].concat(z),td:["valign","colspan","rowspan","nowrap"].concat(z),th:["valign","colspan","rowspan","nowrap"].concat(z),hr:z,html:z,title:z,link:["rel","href"],style:["type"].concat(z),body:z};this.graphicsWhiteList={animate:[],animateMotion:[],
animateTransform:[],circle:[],clipPath:[],"color-profile":[],defs:[],desc:[],discard:[],ellipse:[],feBlend:[],feColorMatrix:[],feComponentTransfer:[],feComposite:[],feConvolveMatrix:[],feDiffuseLighting:[],feDisplacementMap:[],feDistantLight:[],feDropShadow:[],feFlood:[],feFuncA:[],feFuncB:[],feFuncG:[],feFuncR:[],feGaussianBlur:[],feImage:[],feMerge:[],feMergeNode:[],feMorphology:[],feOffset:[],fePointLight:[],feSpecularLighting:[],feSpotLight:[],feTile:[],feTurbulence:[],filter:[],foreignObject:[],
g:[],hatch:[],hatchpath:[],line:[],linearGradient:[],marker:[],mask:[],mesh:[],meshgradient:[],meshpatch:[],meshrow:[],metadata:[],mpath:[],path:[],pattern:[],polygon:[],polyline:[],radialGradient:[],rect:[],set:[],solidcolor:[],stop:[],svg:[],switch:[],symbol:[],text:[],textPath:[],title:[],tspan:[],use:[],view:[],object:[],canvas:z};return this._extendObjectOfArrays([G,{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay",
"controls","loop","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],
sub:[],summary:[],sup:[],strong:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:"autoplay controls loop preload src height width".split(" ")},this.graphicsWhiteList])},_extendObjectOfArrays:function(z){var G={};t.forEach(z,function(B){var v=Object.keys(B);t.forEach(v,function(D){Array.isArray(B[D])&&
Array.isArray(G[D])?G[D]=G[D].concat(B[D]):G[D]=B[D]},this)},this);return G},_isInWhiteList:function(z,G){G=Object.keys(G);var B=!1;t.forEach(G,function(v){z===v&&(B=!0)},this);return B}});F.getInstance=function(){null===w&&(w=new F);return w};return F})},"widgets/DataAggregation/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/DataAggregation/js/UI/templates/PageContainer.html":'\x3cdiv style\x3d"height: 100%;" class\x3d"no-select"\x3e\r\n  \x3cdiv class\x3d"control-node" data-dojo-attach-point\x3d"controlNode"\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"controlTable" class\x3d"control-table" cellpading\x3d"0"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"controlTr" style\x3d"line-height:20px;"\x3e\r\n          \x3c!--BACK--\x3e\r\n          \x3ctd nowrap class\x3d"page-item-td-left" data-dojo-attach-point\x3d"backTd"\r\n            data-dojo-attach-event\x3d"onclick:_prevView , onkeydown:_prevView" \x3e\r\n            \x3cdiv class\x3d"float-left bg-img bg-back-img margin-right-5" data-dojo-attach-point\x3d"backImage" tabindex\x3d"0"\r\n            role\x3d"button" aria-label\x3d"${nls.back}"\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"page-item-div main-text" title\x3d"${nls.back}" label\x3d"${nls.back}"\x3e${nls.back}\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3c!--HOME--\x3e\r\n          \x3ctd nowrap align\x3d"center" class\x3d"page-item-td-center " data-dojo-attach-point\x3d"homeTd"\r\n            data-dojo-attach-event\x3d"onclick:_homeView , onkeydown:_homeView"\x3e\r\n            \x3cdiv\x3e\r\n              \x3cdiv class\x3d"bg-home bg-home-img" data-dojo-attach-point\x3d"homeImage" tabindex\x3d"0"\r\n                role\x3d"button" aria-label\x3d"${nls.startPage.homeButtonLabel}"\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"page-item-div"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3c!--NEXT--\x3e\r\n          \x3ctd nowrap class\x3d"page-item-td-right" data-dojo-attach-point\x3d"nextTd"\r\n            data-dojo-attach-event\x3d"onclick:_nextView , onkeydown:_nextView"\x3e\r\n            \x3cdiv class\x3d"float-right bg-img bg-next-img margin-left-5" data-dojo-attach-point\x3d"nextImage" tabindex\x3d"0"\r\n              role\x3d"button" aria-label\x3d"${nls.next}"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"page-item-div main-text" title\x3d"${nls.next}" label\x3d"${nls.next}"\x3e${nls.next}\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"container-node" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"tab-shelter" data-dojo-attach-point\x3d"shelter"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/Home.html":'\x3cdiv style\x3d"height: 100%;" class\x3d"no-select"\x3e\r\n  \x3c!-- aria-label added at runtime--\x3e\r\n  \x3cdiv class\x3d"bottom-border-mid esriCTSchemaMapInstructions" data-dojo-attach-point\x3d"schemaMapInstructions" tabindex\x3d"0" role\x3d"region"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"pageInstruction" class\x3d"main-instruction"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"upload-tab-node" data-dojo-attach-point\x3d"uploadTabNode"\x3e\r\n    \x3cdiv class\x3d"schema-map-instructions"\x3e\r\n      \x3cdiv class\x3d"usage-instruction"\x3e\r\n        ${nls.startPage.dragDrop}\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"drop-or-browse"\x3e\r\n        ${nls.startPage.or}\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"browseContainer"\x3e\r\n        \x3cform class\x3d"file-form" enctype\x3d"multipart/form-data" method\x3d"post" data-dojo-attach-point\x3d"fileForm"\x3e\r\n          \x3clabel for\x3d"${id}_file" class\x3d"jimu-btn" data-dojo-attach-point\x3d"uploadLabel" \r\n          tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.startPage.browse}" \x3e${nls.startPage.browse}\x3c/label\x3e\r\n          \x3cinput id\x3d"${id}_file" name\x3d"file" type\x3d"file" class\x3d"upload-input" data-dojo-attach-point\x3d"fileNode"/\x3e\r\n        \x3c/form\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"warning-instruction" data-dojo-attach-point\x3d"loadWarning"\x3e\r\n      \x3cspan\x3e${nls.warningsAndErrors.loadWarning}\x3c/span\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"credit-warning-container" data-dojo-attach-point\x3d"creditsLink" tabindex\x3d"0" role\x3d"link" aria-label\x3d"${nls.warningsAndErrors.consumesCredits}"\x3e\r\n    \x3ca  data-dojo-attach-point\x3d"creditsLinkTag" class\x3d"credit-warning" target\x3d"_blank" \r\n      href\x3d"http://www.esri.com/software/arcgis/arcgisonline/credits"\x3e${nls.warningsAndErrors.consumesCredits}\x3c/a\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/Addresses.html":'\x3cdiv class\x3d"pad-left-5 no-select"\x3e\r\n  \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd class\x3d"panel-title-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text" tabindex\x3d"0" role\x3d"region" aria-label\x3d"${nls.mapping.locationMapping} ${nls.address.addressPageHint}"\x3e${nls.mapping.locationMapping}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border-bold task-instruction-row" data-dojo-attach-point\x3d"mainInstructionRow"\x3e\r\n        \x3ctd colspan\x3d"2" class\x3d"panel-title-hint-td"\x3e\r\n          \x3cdiv class\x3d"instruction"\x3e${nls.address.addressPageHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"task-row task-instruction-row" data-dojo-attach-point\x3d"singleAddressRow"\x3e\r\n        \x3ctd colspan\x3d"2" data-dojo-attach-point\x3d"singleFieldHintTd"\x3e\r\n          \x3c!--table for single field--\x3e\r\n          \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n            \x3ctbody\x3e\r\n              \x3ctr class\x3d"task-row task-instruction-row" data-dojo-attach-point\x3d"singleRadioRow"\x3e\r\n                \x3ctd colspan\x3d"2" class\x3d"pad-left-10 field-control-td"\x3e\r\n                  \x3cinput name\x3d"addr" data-dojo-type\x3d"dijit/form/RadioButton" class\x3d"jimu-radio-btn" id\x3d"rdo-single"\r\n                    type\x3d"radio" data-dojo-attach-point\x3d"rdoSingleAddress" title\x3d"${nls.address.singleField}"\r\n                    tabindex\x3d"0" aria-label\x3d"${nls.address.singleField} ${nls.address.singleFieldHint}" role\x3d"radio"\r\n                    data-dojo-attach-event\x3d"onClick:_rdoSingleAddressClick"/\x3e\r\n                  \x3clabel class\x3d"main-text" for\x3d"rdo-single"\x3e${nls.address.singleField}\x3c/label\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr class\x3d"bottom-border-bold sub-task-hint panel-title-hint"\r\n                data-dojo-attach-point\x3d"singleSubTaskHintTr"\x3e\r\n                \x3ctd colspan\x3d"2" class\x3d"pad-left-20 panel-title-hint-td float-left"\r\n                  data-dojo-attach-point\x3d"singleSubTaskHintTd"\x3e\r\n                  \x3cspan class\x3d"instruction"\x3e${nls.address.singleFieldHint}\x3c/span\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr class\x3d"bottom-border"\x3e\r\n                \x3ctd data-dojo-attach-point\x3d"singleFieldTableRow"\x3e\r\n                  \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n                    \x3ccolgroup\x3e\r\n                      \x3ccol width\x3d"40%" /\x3e\r\n                      \x3ccol width\x3d"60%" /\x3e\r\n                    \x3c/colgroup\x3e\r\n                    \x3ctbody data-dojo-attach-point\x3d"singleFieldTable"\x3e\r\n                    \x3c/tbody\x3e\r\n                  \x3c/table\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n            \x3c/tbody\x3e\r\n          \x3c/table\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"multiAddressRow"\x3e\r\n        \x3ctd colspan\x3d"2" data-dojo-attach-point\x3d"multiFieldHintTd"\x3e\r\n          \x3c!--table for multi field--\x3e\r\n          \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n            \x3ctbody\x3e\r\n              \x3ctr class\x3d"task-row task-instruction-row" data-dojo-attach-event\x3d"onClick:_rdoMultiAddressClick"\r\n                data-dojo-attach-point\x3d"multiRadioRow"\x3e\r\n                \x3ctd colspan\x3d"2" class\x3d"pad-left-10 field-control-td"\x3e\r\n                  \x3cinput name\x3d"addr" data-dojo-type\x3d"dijit/form/RadioButton" class\x3d"jimu-radio-btn" id\x3d"rdo-multi"\r\n                    type\x3d"radio" data-dojo-attach-point\x3d"rdoMultiAddress" title\x3d"${nls.address.multiField}" \r\n                    tabindex\x3d"0" aria-label\x3d"${nls.address.multiField} ${nls.address.multiFieldHint}" role\x3d"radio"/\x3e\r\n                  \x3clabel class\x3d"main-text" for\x3d"rdo-multi"\x3e${nls.address.multiField}\x3c/label\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr class\x3d"bottom-border sub-task-hint panel-title-hint"\x3e\r\n                \x3ctd colspan\x3d"2" class\x3d"pad-left-20 panel-title-hint-td float-left"\r\n                  data-dojo-attach-point\x3d"multiSubTaskHintTd"\x3e\r\n                  \x3cspan class\x3d"instruction"\x3e${nls.address.multiFieldHint}\x3c/span\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr\x3e\r\n                \x3ctd data-dojo-attach-point\x3d"multiFieldTableRow"\x3e\r\n                  \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n                    \x3ccolgroup\x3e\r\n                      \x3ccol width\x3d"40%" /\x3e\r\n                      \x3ccol width\x3d"60%" /\x3e\r\n                    \x3c/colgroup\x3e\r\n                    \x3ctbody data-dojo-attach-point\x3d"multiFieldTable"\x3e\x3c/tbody\x3e\r\n                  \x3c/table\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n            \x3c/tbody\x3e\r\n          \x3c/table\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/Coordinates.html":'\x3cdiv class\x3d"pad-left-5 no-select"\x3e\r\n  \x3ctable class\x3d"page-table" cellpading\x3d"0" data-dojo-attach-point\x3d"coordinateTable"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"2" class\x3d"panel-title-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.mapping.locationMapping} ${nls.coordinates.coordinatesPageHint}"\x3e${nls.mapping.locationMapping}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border-bold task-instruction-row"\x3e\r\n        \x3ctd colspan\x3d"2" class\x3d"panel-title-hint-td"\x3e\r\n          \x3cdiv class\x3d"instruction"\x3e${nls.coordinates.coordinatesPageHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/FieldMapping.html":'\x3cdiv class\x3d"pad-left-5 no-select"\x3e\r\n  \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd class\x3d"panel-title-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text" tabindex\x3d"0" role\x3d"region" aria-label\x3d"${nls.mapping.schemaMapping}${nls.fieldMapping.fieldMappingPageHint}"\x3e\r\n            ${nls.mapping.schemaMapping}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"task-instruction-row bottom-border-bold"\x3e\r\n        \x3ctd colspan\x3d"2" class\x3d"panel-title-hint-td"\x3e\r\n          \x3cdiv class\x3d"instruction"\x3e${nls.fieldMapping.fieldMappingPageHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd class\x3d"pad-top-10"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"fieldMappingTable"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/StartPage.html":'\x3cdiv class\x3d"pad-left-5 no-select"\x3e\r\n  \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"3" class\x3d"panel-title-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text" tabindex\x3d"0" role\x3d"region"\r\n            aria-label\x3d"${nls.startPage.locationAndField} ${nls.startPage.locationAndFieldHint}"\x3e\r\n            ${nls.startPage.locationAndField}\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border-bold task-instruction-row"\x3e\r\n        \x3ctd colspan\x3d"3" class\x3d"panel-title-hint-td"\x3e\r\n          \x3cdiv class\x3d"instruction" data-dojo-attach-point\x3d"locationAndFieldHint"\x3e\r\n            ${nls.startPage.locationAndFieldHint}\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n\r\n      \x3ctr class\x3d"task-instruction-row"\x3e\r\n        \x3ctd colspan\x3d"3" class\x3d"field-control-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text"\x3e${nls.startPage.targetLayerLabel}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n\r\n      \x3ctr class\x3d"bottom-border-bold task-instruction-row"\x3e\r\n        \x3ctd colspan\x3d"3" class\x3d"panel-title-hint-td"\x3e\r\n          \x3cdiv class\x3d"esriCTTargetLayerParent"\x3e\r\n            \x3cdiv class\x3d"esriCTTargetLayerSelector" aria-label\x3d"${nls.startPage.targetLayerLabel}" style\x3d"width: 100%;"\r\n              data-dojo-attach-point\x3d"targetLayerSelector" data-dojo-type\x3d"jimu/dijit/formSelect"\x3e\x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n\r\n      \x3ctr class\x3d"task-row" data-dojo-attach-event\x3d"onClick:_locationMappingClick , onkeydown:_locationMappingClick"\r\n        tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.mapping.locationMapping} ${nls.mapping.locationMappingHint}"\x3e\r\n        \x3ctd class\x3d"field-control-td"\x3e\r\n          \x3cdiv class\x3d"task-text"\x3e${nls.mapping.locationMapping}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"jimu-icon jimu-icon-error incomplete-mark" data-dojo-attach-point\x3d"locationMappingComplete" title\x3d"${nls.startPage.mappingErrorMsg}"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"next-arrow float-right next-arrow-img"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border task-instruction-row"\x3e\r\n        \x3ctd colspan\x3d"3" class\x3d"instruction-padding"\x3e\r\n          \x3cdiv class\x3d"instruction"\x3e${nls.mapping.locationMappingHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n\r\n      \x3ctr class\x3d"task-row" data-dojo-attach-point\x3d"fieldMappingRow" data-dojo-attach-event\x3d"onClick:_schemaMappingClick , onkeydown:_schemaMappingClick"\r\n        tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.mapping.schemaMapping} ${nls.mapping.schemaMappingHint}"\x3e\r\n        \x3ctd class\x3d"field-control-td"\x3e\r\n          \x3cdiv class\x3d"task-text"\x3e${nls.mapping.schemaMapping}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"jimu-icon jimu-icon-error incomplete-mark" data-dojo-attach-point\x3d"fieldMappingComplete" title\x3d"${nls.startPage.mappingErrorMsg}"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"next-arrow float-right next-arrow-img"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border pad-top-10 task-instruction-row"\x3e\r\n        \x3ctd colspan\x3d"3" class\x3d"instruction-padding"\x3e\r\n          \x3cdiv class\x3d"instruction"\x3e${nls.mapping.schemaMappingHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\r\n  \x3cdiv class\x3d"pad-top-10"\x3e\r\n    \x3cdiv class\x3d"jimu-btn float-right display-none" data-dojo-attach-point\x3d"addToMapButton"\r\n      data-dojo-attach-event\x3d"onClick:_addToMapClick , onkeydown:_addToMapClick" tabindex\x3d"0" aria-label\x3d"${nls.buttons.addToMap}" role\x3d"button"\x3e\r\n      ${nls.buttons.addToMap}\x3c/div\x3e\r\n    \x3cdiv class\x3d"float-right bg-loading-img bg-loading pad-top-10 display-none" data-dojo-attach-point\x3d"progressNode"\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/Review.html":'\x3cdiv class\x3d"pad-left-5 no-select" style\x3d"height: 100%"\x3e\r\n  \x3ctable class\x3d"page-table" cellpading\x3d"0" data-dojo-attach-point\x3d"reviewRowTable"\x3e\r\n    \x3ctbody\x3e\r\n\r\n      \x3ctr data-dojo-attach-point\x3d"reviewDataRow" tabindex\x3d"0" role\x3d"region" aria-label\x3d"${nls.review.reviewData} ${nls.review.reviewDataHint}"\x3e\r\n        \x3ctd colspan\x3d"3" class\x3d"panel-title-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text"\x3e${nls.review.reviewData}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border-bold task-instruction-row"\x3e\r\n        \x3ctd colspan\x3d"3" class\x3d"panel-title-hint-td"\x3e\r\n          \x3cdiv class\x3d"instruction" data-dojo-attach-point\x3d"reviewDataHint"\x3e${nls.review.reviewDataHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n\r\n      \x3ctr class\x3d"pad-bottom-10 task-row" data-dojo-attach-point\x3d"unMatchedControlRow"\r\n        data-dojo-attach-event\x3d"onclick:_reviewUnMatched , onkeydown:_reviewUnMatched" tabindex\x3d"0" role\x3d"button"\x3e\r\n        \x3ctd class\x3d"field-control-td width-100"\x3e\r\n          \x3cdiv class\x3d"task-text"\x3e${nls.review.reviewUnMatched}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"pad-right-15 float-right main-text field-control-td"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"unMatchedCount"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"next-arrow float-right next-arrow-img"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border pad-bottom-10 task-instruction-row" data-dojo-attach-point\x3d"unMatchedHintRow"\x3e\r\n        \x3ctd colspan\x3d"3" data-dojo-attach-point\x3d"unMatchedHintTd" class\x3d"instruction-padding"\x3e\r\n          \x3cdiv class\x3d"instruction"\x3e${nls.review.reviewUnMatchedHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n\r\n      \x3ctr class\x3d"pad-bottom-10 task-row" data-dojo-attach-point\x3d"duplicateControlRow" tabindex\x3d"0" role\x3d"button" \r\n        data-dojo-attach-event\x3d"onclick:_reviewDuplicate , onkeydown:_reviewDuplicate"\x3e\r\n        \x3ctd class\x3d"field-control-td width-100"\x3e\r\n          \x3cdiv class\x3d"task-text"\x3e${nls.review.reviewDuplicate}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"pad-right-15 float-right main-text field-control-td"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"duplicateCount"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"next-arrow float-right next-arrow-img"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border pad-bottom-10 task-instruction-row" data-dojo-attach-point\x3d"duplicateHintRow"\x3e\r\n        \x3ctd colspan\x3d"3" data-dojo-attach-point\x3d"duplicateHintTd" class\x3d"instruction-padding"\x3e\r\n          \x3cdiv class\x3d"instruction" data-dojo-attach-point\x3d"reviewDuplicateHint"\x3e${nls.review.reviewDuplicateHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n\r\n      \x3ctr class\x3d"pad-bottom-10 task-row" data-dojo-attach-point\x3d"matchedControlRow"\r\n        data-dojo-attach-event\x3d"onclick:_reviewMatched , onkeydown:_reviewMatched" tabindex\x3d"0" role\x3d"button"\x3e\r\n        \x3ctd class\x3d"field-control-td width-100"\x3e\r\n          \x3cdiv class\x3d"task-text"\x3e${nls.review.reviewMatched}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"pad-right-15 float-right main-text field-control-td"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"matchedCount"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"next-arrow float-right next-arrow-img"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border pad-bottom-10 task-instruction-row" data-dojo-attach-point\x3d"matchedHintRow"\x3e\r\n        \x3ctd colspan\x3d"3" class\x3d"instruction-padding"\x3e\r\n          \x3cdiv class\x3d"instruction"\x3e${nls.review.reviewMatchedHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\r\n  \x3cdiv class\x3d"pad-top-10 float-right"\x3e\r\n    \x3cdiv style\x3d"margin-right: 15px;" class\x3d"float-left bg-loading-img bg-loading pad-top-10 display-none" data-dojo-attach-point\x3d"progressNode"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"jimu-btn float-left margin-right-15" data-dojo-attach-point\x3d"submitButton" tabindex\x3d"0" role\x3d"button"\r\n      aria-label\x3d"${nls.buttons.submit}" data-dojo-attach-event\x3d"onclick:_submit , onkeydown:_submit"\x3e\r\n      ${nls.buttons.submit}\x3c/div\x3e\r\n    \x3cdiv class\x3d"jimu-btn float-left" data-dojo-attach-point\x3d"downloadButton" tabindex\x3d"0" role\x3d"button"\r\n      aria-label\x3d"${nls.buttons.download}" data-dojo-attach-event\x3d"onclick:_download , keydown:_download"\x3e${nls.buttons.download}\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/FeatureList.html":'\x3cdiv class\x3d"pad-left-5 no-select"\x3e\r\n  \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"2" class\x3d"panel-title-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text" data-dojo-attach-point\x3d"pageTitle" tabindex\x3d"0" role\x3d"region" \r\n          aria-label\x3d"${nls.review.reviewMatched} ${nls.review.reviewMatchedHint}"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border-bold task-instruction-row"\x3e\r\n        \x3ctd colspan\x3d"2" class\x3d"panel-title-hint-td"\x3e\r\n          \x3cdiv class\x3d"instruction" data-dojo-attach-point\x3d"pageHint"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd\x3e\r\n          \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n            \x3ctbody data-dojo-attach-point\x3d"featureListTable"\x3e\r\n            \x3c/tbody\x3e\r\n          \x3c/table\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/Feature.html":'\x3cdiv class\x3d"pad-left-5 no-select"\x3e\r\n\r\n  \x3c!-- Title table --\x3e\r\n  \x3ctable class\x3d"page-table display-none table-layout" cellpading\x3d"0" data-dojo-attach-point\x3d"featureTitleTable"\r\n    tabindex\x3d"0" role\x3d"region"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd class\x3d"panel-title-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text" data-dojo-attach-point\x3d"pageTitleDiv"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border-bold task-instruction-row"\x3e\r\n        \x3ctd class\x3d"panel-title-hint-td"\x3e\r\n          \x3cdiv class\x3d"instruction" data-dojo-attach-point\x3d"pageHintDiv"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\r\n  \x3c!--Feature toolbar table--\x3e\r\n  \x3ctable class\x3d"page-table display-none table-layout" cellpading\x3d"0" data-dojo-attach-point\x3d"featureToolbarTable"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr class\x3d"bottom-border task-instruction-row"\x3e\r\n        \x3ctd data-dojo-attach-point\x3d"reviewRowRecordTd" class\x3d"pad-bottom-10 pad-top-10"\x3e\r\n          \x3cspan class\x3d"float-left main-text pad-right-10 display-none pad-left-5" data-dojo-attach-point\x3d"reviewText"\r\n            style\x3d"line-height:30px;"\x3e${nls.review.item}\x3c/span\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_duplicateFlag" class\x3d"pad-bottom-10 duplicate-flag"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"pad-bottom-10 pad-top-10 feature-toolbar-td"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"featureToolbar"\x3e\r\n\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\r\n  \x3c!--feature toggle table--\x3e\r\n  \x3ctable data-dojo-attach-point\x3d"featureToggleTable" class\x3d"page-table display-none table-layout" cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr class\x3d"bottom-border toggle-expand-row" data-dojo-attach-point\x3d"featureTr" data-dojo-attach-event\x3d"onclick:_toggleFeature  , onkeydown:_toggleFeature" tabindex\x3d"0"\r\n        role\x3d"button" aria-label\x3d"${nls.review.feature}" aria-expanded\x3d"false"\x3e\r\n        \x3ctd colspan\x3d"2" class\x3d"field-control-td text-left field-row-width pad-left-5"\x3e\r\n          \x3cdiv class\x3d"font-size-med main-text float-left"\x3e\r\n            ${nls.review.feature}\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd style\x3d"width: 20px;" nowrap class\x3d"page-item-td-nav" data-dojo-attach-point\x3d"featureTd"\x3e\r\n          \x3cdiv class\x3d"float-right bg-img-toggle bg-toggle-down-img margin-left-5"\r\n            data-dojo-attach-point\x3d"toggleFeature"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\r\n  \x3cdiv data-dojo-attach-point\x3d"featureInformation" class\x3d"display-none"\x3e\r\n\r\n    \x3c!--feature controls table--\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"featureTable" class\x3d"page-table display-none table-layout" cellpading\x3d"0"\x3e\r\n      \x3ccolgroup\x3e\r\n        \x3ccol width\x3d"30%" /\x3e\r\n        \x3ccol width\x3d"35%" /\x3e\r\n        \x3ccol width\x3d"35%" /\x3e\r\n      \x3c/colgroup\x3e\r\n      \x3ctbody data-dojo-attach-point\x3d"featureControlTable"\x3e\x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3c!--location toggle table--\x3e\r\n  \x3ctable data-dojo-attach-point\x3d"locationControlToggleTable" class\x3d"page-table display-none table-layout"\r\n    cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr class\x3d"bottom-border toggle-expand-row"  data-dojo-attach-point\x3d"locationTr" data-dojo-attach-event\x3d"onclick:_toggleLocation , onkeydown:_toggleLocation" tabindex\x3d"0"\r\n        role\x3d"button" aria-label\x3d"${nls.review.locationInfo}" aria-expanded\x3d"false"\x3e\r\n        \x3ctd class\x3d"field-control-td text-left field-row-width pad-left-5"\x3e\r\n          \x3cdiv class\x3d"font-size-med main-text float-left"\x3e\r\n            ${nls.review.locationInfo}\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd style\x3d"width: 20px;" class\x3d"page-item-td-nav" data-dojo-attach-point\x3d"locationTd"\x3e\r\n          \x3cdiv class\x3d"float-right bg-img-toggle bg-toggle-down-img margin-left-5"\r\n            data-dojo-attach-point\x3d"toggleLocation"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n  \x3c/table\x3e\r\n\r\n  \x3cdiv data-dojo-attach-point\x3d"locationInformation" class\x3d"display-none"\x3e\r\n\r\n    \x3c!--location toolbar--\x3e\r\n    \x3ctable class\x3d"page-table display-none" cellpading\x3d"0" data-dojo-attach-point\x3d"locationSyncTable"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr class\x3d"bottom-border task-instruction-row"\x3e\r\n          \x3ctd class\x3d"field-control-td pad-left-5"\x3e\r\n            \x3cdiv class\x3d"instruction" data-dojo-attach-point\x3d"locationHint"\x3e${nls.review.locationControlHint}\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"field-control-td" title\x3d"${nls.review.sync}"\x3e\r\n            \x3cdiv class\x3d"float-right bg-ft-img bg-sync feature-toolbar-btn" data-dojo-attach-point\x3d"syncFields"\r\n              data-dojo-attach-event\x3d"onclick:_syncAddressInfo , keydown:_syncAddressInfo"\r\n              role\x3d"button" aria-label\x3d"${nls.review.sync}"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd title\x3d"${nls.featureToolbar.locate}"\x3e\r\n            \x3cdiv class\x3d"bg-ft-img bg-locate feature-toolbar-btn float-right" data-dojo-attach-point\x3d"locateButton"\r\n              data-dojo-attach-event\x3d"onclick:_locate , keydown:_locate" role\x3d"button" aria-label\x3d"${nls.featureToolbar.locate}"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n\r\n    \x3c!--location controls table--\x3e\r\n    \x3ctable class\x3d"page-table display-none" cellpading\x3d"0" data-dojo-attach-point\x3d"locationControlTable"\x3e\r\n      \x3ccolgroup\x3e\r\n        \x3ccol width\x3d"35%" /\x3e\r\n        \x3ccol width\x3d"65%" /\x3e\r\n      \x3c/colgroup\x3e\r\n      \x3ctbody\x3e\x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n\r\n  \x3c/div\x3e\r\n\r\n\x3c/div\x3e\r\n\r\n',
"url:widgets/DataAggregation/js/UI/templates/FeatureToolbar.html":'\x3cdiv class\x3d"float-right no-select"\x3e\r\n  \x3ctable class\x3d"control-table table-layout" cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr class\x3d"feature-toolbar-row"\x3e\r\n        \x3ctd title\x3d"${nls.featureToolbar.cancel}"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"cancelButton" role\x3d"button" tabindex\x3d"-1" class\x3d"bg-ft-img bg-cancel feature-toolbar-btn" \r\n          aria-label\x3d"${nls.featureToolbar.cancel}" data-dojo-attach-event\x3d"onclick:_cancel, onkeydown:_cancel"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd title\x3d"${nls.featureToolbar.save}"\x3e\r\n          \x3cdiv  data-dojo-attach-point\x3d"saveButton" role\x3d"button" tabindex\x3d"-1" class\x3d"float-right bg-ft-img bg-save feature-toolbar-btn"\r\n          aria-label\x3d"${nls.featureToolbar.save}" data-dojo-attach-event\x3d"onclick:_save, onkeydown:_save"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/LocationType.html":'\x3cdiv class\x3d"pad-left-5 no-select"\x3e\r\n  \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"3" class\x3d"panel-title-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text" tabindex\x3d"0" role\x3d"region"\r\n            aria-label\x3d"${nls.mapping.locationMapping} ${nls.locationMapping.locationMappingPageHint}"\x3e\r\n            ${nls.mapping.locationMapping}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border-bold task-instruction-row"\x3e\r\n        \x3ctd colspan\x3d"3" class\x3d"panel-title-hint-td"\x3e\r\n          \x3cdiv class\x3d"instruction"\x3e${nls.locationMapping.locationMappingPageHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"task-row task-instruction-row" \x3e \r\n        \x3ctd class\x3d"field-control-td pad-left-10"\x3e\r\n          \x3cinput name\x3d"lt" data-dojo-type\x3d"dijit/form/RadioButton"\r\n                 class\x3d"jimu-radio-btn"\r\n                 id\x3d"${id}_rdo-address"\r\n                 type\x3d"radio"\r\n                 data-dojo-attach-point\x3d"rdoAddress"\r\n                 title\x3d"${nls.locationMapping.useAddress}" \r\n                 tabindex\x3d"0" \r\n                 aria-label\x3d"${nls.locationMapping.useAddress} ${nls.locationMapping.useAddressHint}"\r\n                 data-dojo-attach-event\x3d"onClick:_rdoAddressClick"\r\n                 role\x3d"radio"/\x3e\r\n          \x3clabel class\x3d"main-text" for\x3d"${id}_rdo-address"\x3e${nls.locationMapping.useAddress}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border task-instruction-row"\x3e\r\n        \x3ctd class\x3d"pad-left-20 pad-bottom-10"\x3e\r\n          \x3cspan class\x3d"instruction"\x3e${nls.locationMapping.useAddressHint}\x3c/span\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"task-instruction-row task-row"\x3e\r\n        \x3ctd class\x3d"field-control-td pad-left-10"\x3e\r\n          \x3cinput name\x3d"lt" data-dojo-type\x3d"dijit/form/RadioButton"\r\n                 class\x3d"jimu-radio-btn"\r\n                 id\x3d"${id}_rdo-coordinate"\r\n                 type\x3d"radio"\r\n                 data-dojo-attach-point\x3d"rdoCoordinates"\r\n                 title\x3d"${nls.locationMapping.useCoordinates}" \r\n                 tabindex\x3d"0"\r\n                 aria-label\x3d"${nls.locationMapping.useCoordinates} ${nls.locationMapping.useCoordinatesHint}"\r\n                 data-dojo-attach-event\x3d"onClick:_rdoCoordinateClick"\r\n                 role\x3d"radio"/\x3e\r\n          \x3clabel class\x3d"main-text" for\x3d"${id}_rdo-coordinate"\x3e${nls.locationMapping.useCoordinates}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border task-instruction-row"\x3e\r\n        \x3ctd class\x3d"pad-left-20 pad-bottom-10"\x3e\r\n          \x3cspan class\x3d"instruction"\x3e${nls.locationMapping.useCoordinatesHint}\x3c/span\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/Widget.html":'\x3cdiv style\x3d"width: 100%; height: 100%;" class\x3d"no-select"\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"pageNavigation"\x3e\x3c/div\x3e\r\n\x3c/div\x3e\r\n',"url:widgets/DataAggregation/css/style.css":".jimu-widget-critical-facilities .disabled{cursor: default; background-color: #a0acbf;}.jimu-widget-critical-facilities-ui .credit-warning{color: #86909c; margin-bottom: 10px;}.jimu-widget-critical-facilities-ui .credit-warning-container{margin-top: 20px; margin-bottom: 10px; position: absolute; bottom: 0px;}.jimu-widget-critical-facilities .processing {background-image: url('images/loading.gif'); background-repeat: no-repeat; background-position: center center; height: 22px; width: 100%;}.jimu-widget-critical-facilities-ui .no-select {-webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;}.jimu-widget-critical-facilities-ui .font-size-large {font-size: 16px;}.jimu-widget-critical-facilities-ui .font-size-med {font-size: 14px;}.jimu-widget-critical-facilities-ui .bottom-border {border-bottom: 1px solid;}.jimu-widget-critical-facilities-ui .bottom-border-bold {border-bottom: 3px solid;}.jimu-widget-critical-facilities-ui .bottom-border-mid {border-bottom: 2px solid;}.jimu-widget-critical-facilities-ui .width-all {width: 100%;}.jimu-widget-critical-facilities-ui .table-layout {table-layout: fixed;}.jimu-widget-critical-facilities-ui .feature-toolbar-btn {padding: 10px; display: block;}.jimu-widget-critical-facilities-ui .feature-toolbar-row {line-height: 25px;}.jimu-widget-critical-facilities-ui .duplicate-col-headers {overflow: hidden; width: 100%; white-space: normal !important; line-height: 1.5; text-align: center;}.jimu-widget-critical-facilities-ui .page-item-td {cursor: pointer; min-width: 0; white-space: nowrap;}.jimu-widget-critical-facilities-ui .float-left {float: left;}.jimu-rtl .jimu-widget-critical-facilities-ui .float-left {float: right;}.jimu-widget-critical-facilities-ui .float-right {float: right;}.jimu-rtl .jimu-widget-critical-facilities-ui .float-right {float: left;}.jimu-widget-critical-facilities-ui .text-left {text-align: left;}.jimu-rtl .jimu-widget-critical-facilities-ui .text-left {text-align: right;}.jimu-widget-critical-facilities-ui .field-row-width {word-break: break-word;}.jimu-widget-critical-facilities-ui .field-row-width2 {word-break: break-word;}.jimu-widget-critical-facilities-ui .pad-side-15 {padding-left: 15px;}.jimu-rtl .jimu-widget-critical-facilities-ui .pad-side-15 {padding-right: 15px;}.jimu-widget-critical-facilities-ui .bg-home-img {background-image: url('../images/home_black.png');}.jimu-widget-critical-facilities-ui .page-item-td-center:hover .bg-home-img {background-image: url('../images/home_hover.png');}.jimu-widget-critical-facilities-ui .bg-home-img-white {background-image: url('../images/home_white.png');}.jimu-widget-critical-facilities-ui .page-item-td-center:hover .bg-home-img-white {background-image: url('../images/home_hover.png');}.jimu-widget-critical-facilities-ui .bg-home {width: 20px; height: 20px; position: relative; background-size: contain; background-repeat: no-repeat; cursor: pointer; margin: auto; margin-top: 2px;}.jimu-widget-critical-facilities-ui .bg-img {width: 12px; height: 20px; position: relative; background-size: contain; background-repeat: no-repeat; cursor: pointer; margin-left: 2px;}.jimu-widget-critical-facilities-ui .esriCTSchemaMapInstructions {max-height: 150px; overflow: auto; padding-bottom: 10px;}.jimu-widget-critical-facilities-ui .toggle-expand-row {cursor: pointer;}.jimu-widget-critical-facilities-ui .bg-img-toggle {width: 16px; height: 12px; position: relative; background-size: contain; background-repeat: no-repeat; cursor: pointer;}.jimu-widget-critical-facilities-ui .page-item-td-nav {cursor: pointer; min-width: 0; white-space: nowrap;}.jimu-widget-critical-facilities-ui .bg-toggle-down-img {background-image: url('../images/nav_down_black.png');}.jimu-widget-critical-facilities-ui .toggle-expand-row:hover .bg-toggle-down-img {background-image: url('../images/nav_down_hover.png');}.jimu-widget-critical-facilities-ui .bg-toggle-down-img-white {background-image: url('../images/nav_down_white.png');}.jimu-widget-critical-facilities-ui .toggle-expand-row:hover .bg-toggle-down-img-white {background-image: url('../images/nav_down_hover.png');}.jimu-widget-critical-facilities-ui .bg-toggle-up-img {background-image: url('../images/nav_up_black.png');}.jimu-widget-critical-facilities-ui .toggle-expand-row:hover .bg-toggle-up-img {background-image: url('../images/nav_up_hover.png');}.jimu-widget-critical-facilities-ui .bg-toggle-up-img-white {background-image: url('../images/nav_up_white.png');}.jimu-widget-critical-facilities-ui .toggle-expand-row:hover .bg-toggle-up-img-white {background-image: url('../images/nav_up_hover.png');}.jimu-widget-critical-facilities-ui .feature-toolbar-td {width: 58px;}.jimu-widget-critical-facilities-ui .duplicate-flag {padding-bottom: 9px; float: left; display: inline-table;}.jimu-widget-critical-facilities-ui .bg-ft-img {width: 15px; height: 15px; position: relative; background-size: contain; background-repeat: no-repeat; cursor: pointer; margin: auto;}.jimu-widget-critical-facilities-ui .bg-locate {background-image: url('../images/locate_black.png');}.jimu-widget-critical-facilities-ui .bg-locate:hover {background-image: url('../images/locate_hover.png');}.jimu-widget-critical-facilities-ui .bg-locate-white {background-image: url('../images/locate_white.png');}.jimu-widget-critical-facilities-ui .bg-locate-white:hover {background-image: url('../images/locate_hover.png');}.jimu-widget-critical-facilities-ui .bg-locate-disabled {background-image: url('../images/locate_disabled.png'); cursor: default;}.jimu-widget-critical-facilities-ui .bg-save {background-image: url('../images/save_black.png');}.jimu-widget-critical-facilities-ui .bg-save:hover {background-image: url('../images/save_hover.png');}.jimu-widget-critical-facilities-ui .bg-save-white {background-image: url('../images/save_white.png');}.jimu-widget-critical-facilities-ui .bg-save-white:hover {background-image: url('../images/save_hover.png');}.jimu-widget-critical-facilities-ui .bg-save-disabled {background-image: url('../images/save_disabled.png'); cursor: default;}.jimu-widget-critical-facilities-ui .bg-sync {background-image: url('../images/sync_black.png');}.jimu-widget-critical-facilities-ui .bg-sync:hover {background-image: url('../images/sync_hover.png');}.jimu-widget-critical-facilities-ui .bg-sync-white {background-image: url('../images/sync_white.png');}.jimu-widget-critical-facilities-ui .bg-sync-white:hover {background-image: url('../images/sync_hover.png');}.jimu-widget-critical-facilities-ui .bg-sync-disabled {background-image: url('../images/sync_disabled.png'); cursor: default;}.jimu-widget-critical-facilities-ui .bg-cancel {background-image: url('../images/cancel_black.png');}.jimu-widget-critical-facilities-ui .bg-cancel:hover {background-image: url('../images/cancel_hover.png');}.jimu-widget-critical-facilities-ui .bg-cancel-white {background-image: url('../images/cancel_white.png');}.jimu-widget-critical-facilities-ui .bg-cancel-white:hover {background-image: url('../images/cancel_hover.png');}.jimu-widget-critical-facilities-ui .bg-cancel-disabled {background-image: url('../images/cancel_disabled.png'); cursor: default;}.jimu-widget-critical-facilities-ui .feature-list-row {}.jimu-widget-critical-facilities-ui .feature-list-row:hover {cursor:pointer;}.jimu-widget-critical-facilities-ui .feature-list-row:hover .next-arrow-img {background-image: url('../images/nav_right_hover.png'); cursor: pointer;}.jimu-rtl .jimu-widget-critical-facilities-ui .feature-list-row:hover .next-arrow-img {background-image: url('../images/nav_left_hover.png'); cursor: pointer;}.jimu-widget-critical-facilities-ui .page-item-td-left {cursor: pointer; min-width: 0; white-space: nowrap; text-align: left;}.jimu-rtl .jimu-widget-critical-facilities-ui .page-item-td-left {cursor: pointer; min-width: 0; white-space: nowrap; text-align: right;}.jimu-widget-critical-facilities-ui .bg-back-img {background-image: url('../images/nav_left_black.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .bg-back-img {background-image: url('../images/nav_right_black.png');}.jimu-widget-critical-facilities-ui .bg-back-img-white {background-image: url('../images/nav_left_white.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .bg-back-img-white {background-image: url('../images/nav_right_white.png');}.jimu-widget-critical-facilities-ui .page-item-td-left:hover .bg-back-img {background-image: url('../images/nav_left_hover.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .page-item-td-left:hover .bg-back-img {background-image: url('../images/nav_right_hover.png');}.jimu-widget-critical-facilities-ui .page-item-td-left:hover .bg-back-img-white {background-image: url('../images/nav_left_hover.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .page-item-td-left:hover .bg-back-img-white {background-image: url('../images/nav_right_hover.png');}.jimu-widget-critical-facilities-ui .page-item-td-right {cursor: pointer; min-width: 0; white-space: nowrap; text-align: right;}.jimu-rtl .jimu-widget-critical-facilities-ui .page-item-td-right {cursor: pointer; min-width: 0; white-space: nowrap; text-align: left;}.jimu-widget-critical-facilities-ui .bg-next-img {background-image: url('../images/nav_right_black.png'); margin-right: 2px;}.jimu-rtl .jimu-widget-critical-facilities-ui .bg-next-img {background-image: url('../images/nav_left_black.png');}.jimu-widget-critical-facilities-ui .bg-next-img-white {background-image: url('../images/nav_right_white.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .bg-next-img-white {background-image: url('../images/nav_left_white.png');}.jimu-widget-critical-facilities-ui .page-item-td-right:hover .bg-next-img {background-image: url('../images/nav_right_hover.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .page-item-td-right:hover .bg-next-img {background-image: url('../images/nav_left_hover.png');}.jimu-widget-critical-facilities-ui .page-item-td-right:hover .bg-next-img-white {background-image: url('../images/nav_right_hover.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .page-item-td-right:hover .bg-next-img-white {background-image: url('../images/nav_left_hover.png');}.jimu-widget-critical-facilities-ui .jimu-tab3 .page-item-td.jimu-state-active {color: #48494B;}.jimu-widget-critical-facilities-ui .control-node {padding-bottom: 10px; border-bottom: 2px solid;}.jimu-widget-critical-facilities-ui .container-node {padding-top: 10px;}.jimu-widget-critical-facilities-ui .control-disbaled {opacity: .3; cursor: default; pointer-events: none;}.jimu-widget-critical-facilities-ui .min-width-200 {min-width: 200px;}.jimu-widget-critical-facilities-ui .main-text {font-weight: bold; display: inline-block;}.jimu-widget-critical-facilities-ui .panel-title-td {padding: 0px 0px 5px 0px;}.jimu-widget-critical-facilities-ui .panel-title-text {font-weight: bold; display: inline-block; font-size: 15px;}.jimu-widget-critical-facilities-ui .panel-title-hint-td {padding-bottom: 10px; padding-left: 5px;}.jimu-rtl .jimu-widget-critical-facilities-ui .panel-title-hint-td {padding-right: 5px; padding-bottom: 10px;}.jimu-widget-critical-facilities-ui .main-instruction {color: #898989; font-size: 13px;}.jimu-widget-critical-facilities-ui .instruction {color: #898989; font-size: 11px;}.jimu-widget-critical-facilities-ui .instruction-padding {padding-left: 15px; padding-bottom: 10px;}.jimu-rtl .jimu-widget-critical-facilities-ui .instruction-padding {padding-right: 15px; padding-bottom: 10px;}.jimu-widget-critical-facilities-ui .width-100 {width: 100%;}.jimu-widget-critical-facilities-ui .pad-10 {padding: 10px;}.jimu-widget-critical-facilities-ui .pad-top-10 {padding-top: 10px;}.jimu-widget-critical-facilities-ui .pad-bottom-10 {padding-bottom: 10px;}.jimu-widget-critical-facilities-ui .pad-left-5 {padding-left: 5px;}.jimu-rtl .jimu-widget-critical-facilities-ui .pad-left-5 {padding-right: 5px;}.jimu-widget-critical-facilities-ui .pad-left-10 {padding-left: 10px;}.jimu-rtl .jimu-widget-critical-facilities-ui .pad-left-10 {padding-right: 10px;}.jimu-widget-critical-facilities-ui .pad-left-15 {padding-left: 15px;}.jimu-rtl .jimu-widget-critical-facilities-ui .pad-left-15 {padding-right: 15px;}.jimu-widget-critical-facilities-ui .pad-left-20 {padding-left: 20px;}.jimu-rtl .jimu-widget-critical-facilities-ui .pad-left-20 {padding-right: 20px;}.jimu-widget-critical-facilities-ui .pad-left-30 {padding-left: 30px;}.jimu-rtl .jimu-widget-critical-facilities-ui .pad-left-30 {padding-right: 30px;}.jimu-widget-critical-facilities-ui .pad-right-10 {padding-right: 10px;}.jimu-rtl .jimu-widget-critical-facilities-ui .pad-right-10 {padding-left: 10px;}.jimu-widget-critical-facilities-ui .pad-right-15 {padding-right: 15px !important;}.jimu-rtl .jimu-widget-critical-facilities-ui .pad-right-15 {padding-left: 15px !important;}.jimu-widget-critical-facilities-ui .margin-right-5 {margin-right: 5px;}.jimu-rtl .jimu-widget-critical-facilities-ui .margin-right-5 {margin-left: 5px;}.jimu-widget-critical-facilities-ui .margin-left-5 {margin-left: 5px;}.jimu-rtl .jimu-widget-critical-facilities-ui .margin-left-5 {margin-right: 5px;}.jimu-widget-critical-facilities-ui .margin-right-15 {margin-right: 15px;}.jimu-rtl .jimu-widget-critical-facilities-ui .margin-right-15 {margin-left: 15px;}.jimu-widget-critical-facilities-ui .field-control {min-width: 150px; width: 100%; float: right;}.jimu-rtl .jimu-widget-critical-facilities-ui .field-control {min-width: 150px; width: 100%; float: left;}.jimu-widget-critical-facilities-ui .field-control-td {padding-top: 10px; padding-bottom: 10px;}.jimu-widget-critical-facilities-ui .sub-field-control-td {padding-bottom: 10px; padding-left: 10px;}.jimu-rtl .jimu-widget-critical-facilities-ui .sub-field-control-td {padding-right: 10px; padding-bottom: 10px;}.jimu-widget-critical-facilities-ui .min-width-80 {min-width: 80px;}.jimu-widget-critical-facilities-ui .task-text {float: left; padding-left: 10px; font-weight: bold; font-size: 14px;}.jimu-rtl .jimu-widget-critical-facilities-ui .task-text {float: right; padding-right: 10px; font-weight: bold; font-size: 14px;}.jimu-widget-critical-facilities-ui .task-row {cursor: pointer;}.jimu-widget-critical-facilities-ui .dijitSelectLabel {text-align: left; text-overflow: ellipsis; overflow: hidden;}.jimu-widget-critical-facilities-ui .next-arrow {width: 15px; height: 16px; position: relative; background-size: contain; background-repeat: no-repeat; cursor: pointer;}.jimu-widget-critical-facilities-ui .next-arrow-img {background-image: url('../images/nav_right_black.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .next-arrow-img {background-image: url('../images/nav_left_black.png');}.jimu-widget-critical-facilities-ui .next-arrow-img-white {background-image: url('../images/nav_right_white.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .next-arrow-img-white {background-image: url('../images/nav_left_white.png');}.jimu-widget-critical-facilities-ui .task-row:hover .next-arrow-img {background-image: url('../images/nav_right_hover.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .task-row:hover .next-arrow-img {background-image: url('../images/nav_left_hover.png');}.jimu-widget-critical-facilities-ui .task-row:hover .next-arrow-img-white {background-image: url('../images/nav_right_hover.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .task-row:hover .next-arrow-img-white {background-image: url('../images/nav_left_hover.png');}.jimu-widget-critical-facilities-ui .sub-task-hint {text-align: left; margin: auto; line-height: 20px; color: #898989; font-size: 11px;}.jimu-widget-critical-facilities-ui .panel-title-hint {padding-left: 5px;}.jimu-rtl .jimu-widget-critical-facilities-ui .panel-title-hint {padding-right: 5px;}.jimu-widget-critical-facilities-ui .task-instruction-row {text-align: left; margin: auto;}.jimu-rtl .jimu-widget-critical-facilities-ui .task-instruction-row {text-align: right; margin: auto;}.jimu-widget-critical-facilities-ui .page-table {width: 100%; border-collapse: collapse; font-size: 13px;}.jimu-widget-critical-facilities-ui .width-15 {width: 15px;}.jimu-widget-critical-facilities-ui .display-none {display: none;}.jimu-widget-critical-facilities-ui .display-table-row-group {display: table-row-group;}.jimu-widget-critical-facilities-ui .no-padding {padding: 0px;}.jimu-widget-critical-facilities-ui .cf-page-container {position: relative; width: 100%;}.jimu-widget-critical-facilities-ui .cf-home .disabled {cursor: default; background-color: #a0acbf;}.jimu-widget-critical-facilities-ui .cf-home .upload-tab-node {margin-top: 20px;}.jimu-widget-critical-facilities-ui .cf-home .schema-map-instructions {text-align: center;}.jimu-widget-critical-facilities-ui .cf-home .drop-or-browse {display: block; margin-top: 10px; margin-bottom: 10px; font-size: 11px; color: #898989; line-height: 20px; position: relative;}.jimu-widget-critical-facilities-ui .cf-home .drop-or-browse:before,.jimu-widget-critical-facilities-ui .cf-home .drop-or-browse:after {content: \"\"; display: block; height: 1px; width: 45%; background: #eee; position: absolute; top: 9px; left: 0;}.jimu-rtl .jimu-widget-critical-facilities-ui .cf-home .drop-or-browse:before,.jimu-rtl .jimu-widget-critical-facilities-ui .cf-home .drop-or-browse:after {content: \"\"; display: block; height: 1px; width: 45%; background: #eee; position: absolute; top: 9px; right: 0;}.jimu-widget-critical-facilities-ui .cf-home .drop-or-browse:after {right: 0; left: auto;}.jimu-rtl .jimu-widget-critical-facilities-ui .cf-home .drop-or-browse:after {right: auto; left: 0;}.jimu-widget-critical-facilities-ui .cf-home .drop-or-browse b {display: inline-block; padding-right: 5px;}.jimu-rtl .jimu-widget-critical-facilities-ui .cf-home .drop-or-browse b {display: inline-block; padding-left: 5px;}.jimu-widget-critical-facilities-ui .cf-home .file-form {display: inline-block;}.jimu-widget-critical-facilities-ui .cf-home .file-form label {display: inline-block; font-size: 11px; text-transform: uppercase; padding: 5px; margin-right: 5px; min-width: 180px; line-height: 20px; white-space: normal;}.jimu-rtl .jimu-widget-critical-facilities-ui .cf-home .file-form label {display: inline-block; font-size: 11px; text-transform: uppercase; padding: 5px; margin-left: 5px; min-width: 180px; line-height: 20px; white-space: normal;}.jimu-widget-critical-facilities-ui .cf-home .upload-input {display: none;}.jimu-widget-critical-facilities-ui .cf-home .warning-instruction {color: firebrick; display: none;}.jimu-widget-critical-facilities-ui .cf-home .usage-instruction {font-size: 14px; font-weight: bold;}.jimu-widget-critical-facilities-ui .cf-home .startpage-hint {padding-top: 10px; padding-bottom: 10px;}.jimu-widget-critical-facilities-ui .cf-home .bottom {padding-top: 10px; padding-bottom: 10px;}.jimu-popup .cf-warning-icon {width: 30px; height: 30px; position: relative; background-size: contain; background-repeat: no-repeat; margin-top: 10px; background-image: url('../images/warning.png');} .jimu-widget-critical-facilities-ui .cf-home .address-search {display: inline-block;}.jimu-widget-critical-facilities-ui .esriCTSearchOuterContainer {padding: 0px 0px 15px 0px; clear: both;}.jimu-widget-critical-facilities-ui .esriCTSearchDiv {float: left; clear: both; margin-right: 10px;}.jimu-widget-critical-facilities-ui .esriCTSearchHeader {margin-bottom: 10px;}.jimu-widget-critical-facilities-ui .esriCTSearchDiv .arcgisSearch {float: left; width: 100% !important;}.jimu-widget-critical-facilities-ui .esriCTSearchContainer {width: 100%; height: 35px;}.jimu-widget-critical-facilities-ui .arcgisSearch .searchGroup .searchInput {width: 170px; padding: 6px 24px 6px 12px !important;}.esriRtl .jimu-widget-critical-facilities-ui .arcgisSearch .searchGroup .searchInput {padding: 6px 12px 6px 24px !important;}.jimu-widget-critical-facilities-ui .arcgisSearch .searchBtn {padding: 6px;}.jimu-widget-critical-facilities-ui .jimu-widget-search .arcgisSearch .searchGroup .searchInputGroup .searchInput {width: auto;}.jimu-widget-critical-facilities-ui .esriCTSearchContainer .searchClear {top: 2px !important;}.jimu-widget-critical-facilities-ui .done-mark {background-image: url('../images/check.png'); width: 15px; height: 16px; position: relative; background-size: contain; float: right; margin-right: 10px; background-repeat: no-repeat;}.jimu-rtl .jimu-widget-critical-facilities-ui .done-mark {background-image: url('../images/check.png'); width: 15px; height: 16px; position: relative; background-size: contain; float: left; margin-left: 10px; background-repeat: no-repeat;}.jimu-widget-critical-facilities-ui .incomplete-mark{margin-right: 10px;}.jimu-rtl .jimu-widget-critical-facilities-ui .incomplete-mark{margin-left: 10px; margin-right: 0px;}.jimu-widget-critical-facilities-ui .bg-loading {background-image: url('../css/images/loading.gif');}.jimu-widget-critical-facilities-ui .bg-loading-img {width: 75px; height: 15px; position: relative; background-size: contain; background-repeat: no-repeat; cursor: pointer; margin: auto;}.LaunchpadTheme .jimu-widget-critical-facilities-ui .jimu-simple-table .simple-table-cell {border-bottom: none !important; padding-top: 1px; padding-bottom: 1px; height: 33px;}.LaunchpadTheme .jimu-widget-critical-facilities-ui .simple-table-row {border-bottom: 1px solid #ddd !important;}.LaunchpadTheme .jimu-widget-critical-facilities-ui .dijitTextBoxDisabled .dijitInputInner {color: black !important;}.DartTheme .jimu-widget-critical-facilities-ui .dijitTextBoxDisabled .dijitInputInner {color: #8e8d8d !important;}.DartTheme .jimu-popup {color: white !important;}.DartTheme .jimu-popup .title {color: white !important;}.DartTheme .jimu-widget-critical-facilities-ui .jimu-simple-table .simple-table-row .normal-text-div {color: white !important;}.DartTheme .jimu-widget-critical-facilities-ui .jimu-simple-table .simple-table-row:hover .normal-text-div {color: black !important;}.DartTheme .jimu-widget-critical-facilities-ui .main-text {font-weight: normal !important;}.DartTheme .jimu-widget-critical-facilities-ui .panel-title-text {font-weight: normal !important;}.DartTheme .jimu-widget-critical-facilities-ui .task-text {font-weight: normal !important;}.DartTheme .jimu-rtl .jimu-widget-critical-facilities-ui .task-text {font-weight: normal !important;}.DartTheme .jimu-widget-critical-facilities-ui .cf-home .usage-instruction {font-weight: normal !important;}",
"*now":function(K){K(['dojo/i18n!*preload*widgets/DataAggregation/nls/Widget*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/on jimu/BaseWidget dijit/_WidgetsInTemplateMixin dojo/Deferred dojo/DeferredList dojo/dom-construct dojo/dom-class dojo/dom-attr jimu/LayerStructure jimu/LayerInfos/LayerInfos jimu/portalUtils jimu/dijit/Message jimu/dijit/Popup esri/lang esri/request ./js/UI/PageContainer ./js/UI/Home ./js/UI/StartPage ./js/UI/LocationType jimu/dijit/EditorXssFilter jimu/utils".split(" "),function(K,t,x,C,H,I,w,F,z,G,B,v,D,d,m,k,c,a,e,l,p,q,h,n){return K([H,
I],{baseClass:"jimu-widget-critical-facilities-ui",portal:null,editLayer:null,_configLayerInfo:null,_url:"",_geocodeSources:null,_fsFields:null,_singleFields:null,_multiFields:null,_pageContainer:null,_userCanEdit:!0,_userHasCredits:!1,_hasLocators:!0,_locationMappingComplete:!1,_fieldMappingComplete:!1,_tempResultsAdded:!1,postCreate:function(){this.inherited(arguments);this.editorXssFilter=h.getInstance();this.nls=t.mixin(this.nls,window.jimuNls.common);this.openAtStartAysn=!0;D.getInstance(this.map,
this.map.itemInfo).then(t.hitch(this,function(b){this.operLayerInfos=b;this._initEditLayerNode();this.editLayerNode&&this._initUserProperties().then(t.hitch(this,function(){this._initThemeAndConfig()}))}))},_initUserProperties:function(){var b=new w;this.validatePrivileges().then(t.hitch(this,function(g){this._userCanEdit=g.canEdit;this._userHasCredits=g.hasCredits;this._userCanEdit&&this._userHasCredits?b.resolve(!0):this._alertUser().then(t.hitch(this,function(f){this._hasLocators=f;b.resolve(!0)}))}));
return b},_initEditLayerNode:function(){var b=this.config.layerSettings;b&&b.layerInfo&&b.layerInfo.featureLayer&&(b=[b]);var g=!0;b&&0<b.length&&(this.layerStructure=v.getInstance(),x.some(b,t.hitch(this,function(f){var r;if(f&&f.layerInfo&&f.layerInfo.featureLayer&&f.layerInfo.featureLayer.id){var u=this.operLayerInfos.getLayerInfoById(f.layerInfo.featureLayer.id);if((r=this.layerStructure.getNodeById(f.layerInfo.featureLayer.id))&&u&&u.layerObject&&u.layerObject.isEditable())return this._configLayerInfo=
f.layerInfo,this._symbol=f.symbol,this.editLayerNode=r,g=!1,!0}})));g?this._showPopup([this.nls.warningsAndErrors.noLayersWarning],""):-1!==[null,void 0].indexOf(this.editLayerNode)&&this._showNoEditLayerMessage()},_showNoEditLayerMessage:function(){this._userHasCredits=this._userCanEdit=!1;var b=[this.nls.startPage.appropriateCredentials+"\x3c/br\x3e\x3c/br\x3e",this.nls.startPage.or+"\x3c/br\x3e\x3c/br\x3e",c.substitute({layerName:this.config.layerSettings.layerInfo.featureLayer.title},this.nls.startPage.shared)];
this._showPopup(b,c.substitute({layerName:this.config.layerSettings.layerInfo.featureLayer.title},this.nls.startPage.unableToAccess))},_initThemeAndConfig:function(){this._initConfigInfo();this._initEditLayerInfo().then(t.hitch(this,function(){this._initBaseArgs();this._initPageContainer(!1)}))},_alertUser:function(){var b=new w;this._userCanEdit?this._removeWorldLocator(!0).then(function(g){b.resolve(0<g.length)}):(this.showEditMessage(),b.resolve(!1));return b},_removeWorldLocator:function(){var b=
new w,g=[],f=[];x.forEach(this.config.sources,function(r){f.push(r.url);g.push(a({url:r.url,content:{f:"json"},handleAs:"json"}))});(new F(g)).then(t.hitch(this,function(r){if(r){for(var u=[],y=[],A=0;A<r.length;A++)y.push(this._validateLocator(r[A][1],f[A]));(new F(y)).then(t.hitch(this,function(E){x.forEach(E,t.hitch(this,function(J){J[1]&&u.push(J[1])}));this._updateSources(u);b.resolve(this.config.sources)}))}}));return b},_validateLocator:function(b,g){var f=new w;b&&b.locatorProperties?b.locatorProperties.isAGOWorldLocator?
(b=(b=/\/[0-9A-Fa-f]{32}\//.exec(g))&&b.length?b[0].substr(1).slice(0,-1):!1)?a({url:this.appConfig.portalUrl+"sharing/rest/content/items/"+b,content:{f:"json"},handleAs:"json"}).then(t.hitch(this,function(r){f.resolve(r.access&&"public"===r.access?!1:g)}),function(r){console.log(r)}):f.resolve(g):f.resolve(!1):f.resolve(g);return f},_updateSources:function(b){if(0<b.length){var g=[];this.config.sources=this.config.sources.filter(function(r){if(-1===b.indexOf(r.url))return!0;g.push(r.name);return!1});
var f=this._getMessages(g);this._showPopup(f,c.substitute({widgetName:this.label},this.nls.startPage.cannotUseLocator),!0)}},_getMessages:function(b){var g=[],f="";b?x.forEach(b,t.hitch(this,function(r){f+=c.substitute({widgetName:this.label,locator:r},this.nls.startPage.userCredits);f+="\x3c/br\x3e\x3c/br\x3e"})):(f+=this.nls.startPage.notEnoughCredits,f+="\x3c/br\x3e\x3c/br\x3e");""!==f&&(g.push(f),g.push(this.nls.startPage.contactAdmin+"\x3c/br\x3e\x3c/br\x3e"),0<this.config.sources.length&&(f=
"",x.forEach(this.config.sources,t.hitch(this,function(r){f+=c.substitute({locator:r.name},this.nls.startPage.canUseLocator);f+="\x3c/br\x3e\x3c/br\x3e"})),g.push(f)));return g},_showPopup:function(b,g,f){var r=this,u=z.create("div",{tabindex:"0",role:"region",style:"outline-offset:-2px"}),y="";z.create("div",{className:"cf-warning-icon",style:"float: "+(window.isRTL?"right; margin-left":"left; margin-right")+": 10px;"},u);for(var A="padding-"+(window.isRTL?"right":"left")+": 50px;",E=0;E<b.length;E++){var J=
b[E];y+=J;z.create("div",{innerHTML:J,style:(0===E?"padding-top:10px; ":"")+A+"word-wrap: break-word;"},u)}y&&B.set(u,"aria-label",n.stripHTML(y));var L=new k({width:500,autoHeight:!0,content:u,titleLabel:g,buttons:[{label:this.nls.ok,onClick:t.hitch(this,function(){L.close();L=null})}],onClose:function(){L=null;setTimeout(t.hitch(this,function(){f&&n.focusFirstFocusNode(r.domNode)}),200)}})},_initBaseArgs:function(){this._baseArgs={nls:this.nls,map:this.map,parent:this,config:this.config,appConfig:this.appConfig,
theme:this.theme,styleColor:this.styleColor,singleEnabled:this.singleEnabled,multiEnabled:this.multiEnabled,xyEnabled:this.xyEnabled}},onAppConfigChanged:function(b,g,f){switch(g){case "widgetChange":this._clearResults()}},_initConfigInfo:function(){if(this._configLayerInfo){this._valid=!0;this._url=this._configLayerInfo.featureLayer.url;this._geocodeSources=this.config.sources;this.xyEnabled=this.config.xyEnabled;this.singleEnabled=this.multiEnabled=!1;this._fsFields=[];x.forEach(this._configLayerInfo.fieldInfos,
t.hitch(this,function(y){y&&y.visible&&this._fsFields.push({name:y.fieldName,label:y.label,value:y.type,isRecognizedValues:y.isRecognizedValues,duplicate:y.duplicate})}));var b=function(y,A){x.forEach(y.isRecognizedValues,function(E){-1===A.isRecognizedValues.indexOf(E)&&A.isRecognizedValues.push(E)})};this._singleFields=[];this._multiFields=[];var g=[],f=[],r=[],u=[];this._geocodeSources&&x.forEach(this._geocodeSources,t.hitch(this,function(y){this.singleEnabled=this.singleEnabled?this.singleEnabled:
y.singleEnabled;this.multiEnabled=this.multiEnabled?this.multiEnabled:y.multiEnabled;if(y.singleEnabled){var A=y.singleAddressFields[0],E=A.label||A.alias,J=r.indexOf(E),L=A.fieldName||A.name,M=u.indexOf(L);-1<J||-1<M?b(A,this._singleFields[-1<J?J:M]):(r.push(E),u.push(L),this._singleFields.push({label:E,value:L,type:"STRING",isRecognizedValues:A.isRecognizedValues}))}y.multiEnabled&&(x.forEach(y.addressFields,t.hitch(this,function(O){if(O&&O.visible){var P=O.label||O.alias,N=g.indexOf(P),Q=O.fieldName||
O.name,R=f.indexOf(Q);-1<N||-1<R?(P=this._multiFields[-1<N?N:R],"undefined"===typeof P.fieldList?P.fieldList=[P.value,Q]:P.fieldList.push(Q),b(O,this._multiFields[-1<N?N:R])):(g.push(P),f.push(Q),this._multiFields.push({label:P,value:Q,type:"STRING",isRecognizedValues:O.isRecognizedValues}))}})),this.multiEnabled=0<this._multiFields.length)}))}},_initEditLayerInfo:function(){var b=new w;this.editLayerNode.getLayerObject().then(t.hitch(this,function(g){this.infoTemplate=this.editLayerNode.getInfoTemplate();
this.editLayer=g;this.editLayerDefinition=n.getFeatureLayerDefinition(g);this._updateFsFields(this.editLayer,this.infoTemplate);b.resolve(!0)}));return b},_updateFsFields:function(b,g){var f=b.typeIdField,r=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle"],u=["esriFieldTypeDouble"],y=this.editLayer||this.editLayerDefinition;x.forEach(this._fsFields,function(A){var E=0;a:for(;E<b.fields.length;E++){var J=b.fields[E];if(J.name===A.name){A.domain=J.domain;A.length=J.length;A.isTypeIdField=
A.name===f;A.subtypes=b.subtypes;var L=!0;E=A.domain;var M=!0;if(E||A.isTypeIdField)var O=n.getCodedValueListForCodedValueOrSubTypes(y,A.name,{});if(O){A.domainValues=O;A.codes=[];A.values=[];for(var P=0;P<O.length;P++){var N=O[P];A.codes.push(N.value);M&&(M=!isNaN(parseInt(N.label,10))&&!isNaN(parseFloat(N.label))&&parseFloat(N.label).toString().length===N.label.toString().length);A.values.push(N.label)}P=0;b:for(;P<O.length;P++)if(L=O[P].value,L=!isNaN(parseInt(L,10))&&parseInt(L,10).toString().length===
L.toString().length,!L)break b}O=J.type;A.type=-1<r.indexOf(O)&&M?"int":-1<u.indexOf(O)&&M?"float":"esriFieldTypeDate"===O?"date":E&&L&&M?"domainInt":E?"domain":"other";A.esriFieldType=O;if("date"===A.type){b:{if(g&&g.info&&g.info.fieldInfos)for(E=g.info.fieldInfos,M=0;M<E.length;M++)if(O=E[M],O.fieldName===A.name){E=O;break b}E=void 0}A.fieldInfo=E}A.nullable=J.nullable;break a}}})},updateFirstLastNode:function(b){var g=this._pageContainer.getSelectedTitle();view=this._pageContainer.getViewByTitle(g);
var f=G.contains(this._pageContainer.backImage,"control-disbaled")?this._pageContainer.homeImage:this._pageContainer.backImage;if(g.indexOf(!1)){var r=f;var u=view.lastFocusNode}switch(g){case "Home":r=view.firstFocusNode;u=view.lastFocusNode;break;case "StartPage":r=f;u=view.lastFocusNode;break;case "LocationType":r=f;u=view.lastFocusNode;break;case "FieldMapping":g=this._pageContainer.getViewByTitle("Home");r=this._pageContainer.backImage;u=g.fieldMappingView.lastFieldSelect;break;case "Addresses":r=
f;u=view.lastFocusNode;break;case "Coordinate":r=f;u=view.lastFocusNode;break;case "Review":r=f;u=view.downloadButton;break;case "MatchedFeatures":r=f;u=view.lastFocusNode;break;case "UnMatchedFeatures":r=f;u=view.lastFocusNode;break;case "DuplicateFeatures":r=f,u=view.lastFocusNode}r&&u&&this.domNode&&(n.initFirstFocusNode(this.domNode,r),n.initLastFocusNode(this.domNode,u),b&&n.isAutoFocusFirstNodeWidget(this)&&n.focusFirstFocusNode(this.domNode))},_initPageContainer:function(b){this._initHomeView(b).then(t.hitch(this,
function(g){this._pageContainer&&!this._pageContainer._destroyed?(this._tempResultsAdded=this._fieldMappingComplete=this._locationMappingComplete=!1,this._pageContainer.reset(),this._pageContainer.displayControllerOnStart=!1,this._pageContainer.toggleController(!0)):(this._pageContainer=new e({nls:this.nls,appConfig:this.appConfig,displayControllerOnStart:!1,parent:this,styleColor:this.styleColor},this.pageNavigation),this.own(C(this._pageContainer,"view-changed",t.hitch(this,function(){this.updateFirstLastNode(!0)}))));
var f=this._initStartPageView();this.own(C(f,"targetLayerChanged",t.hitch(this,function(u){var y=this.config.layerSettings;y&&y.layerInfo&&y.layerInfo.featureLayer&&(y=[y]);for(var A=0;A<y.length;A++)y[A].layerInfo.featureLayer.id===u&&(this._configLayerInfo=y[A].layerInfo,this._symbol=y[A].symbol,this.editLayerNode=this.layerStructure.getNodeById(this._configLayerInfo.featureLayer.id));this._initConfigInfo();this._initEditLayerInfo().then(t.hitch(this,function(){this._configLayerInfo&&(g._fsFields=
t.clone(this._fsFields),g.targetLayerUpdated())}))})));f=[g,f];if(this.xyEnabled&&(this.multiEnabled||this.singleEnabled)){var r=this._initLocationTypeView();f.push(r)}this._pageContainer.views=f;this._pageContainer.startup()}))},_initHomeView:function(b){var g=new w;b?this._initUserProperties().then(t.hitch(this,function(){g.resolve(this._getHome())})):g.resolve(this._getHome());return g},_getHome:function(){this.config.hasOwnProperty("editorDescription")&&this.config.editorDescription||(this.config.editorDescription=
this.nls.startPage.defaultStartPageInstructions);return new l(t.mixin({pageInstructionText:this.editorXssFilter.sanitize(this.config.editorDescription),_geocodeSources:this._geocodeSources,_fsFields:this._fsFields,_singleFields:this._singleFields,_multiFields:this._multiFields,userName:this.userName,disabled:!this._userCanEdit||!this._userHasCredits&&!this._hasLocators},this._baseArgs))},_initStartPageView:function(){return new p(this._baseArgs)},_initLocationTypeView:function(){return new q(this._baseArgs)},
_clearResults:function(){if(this._pageContainer){var b=this._pageContainer.getViewByTitle("Home");b&&(b._clearStore(!0),b._clearMapping())}},validatePrivileges:function(){var b=new w;this.portal=this.portal||d.getPortal(this.appConfig.portalUrl);this.portal.getUser().then(t.hitch(this,function(g){this.userName=g.username;this.userCredits="undefined"!==typeof g.availableCredits?g.availableCredits:"undefined"!==typeof this.portal.availableCredits?this.portal.availableCredits:0;!this.userCredits&&this.portal.isPortal&&
(this.userCredits=1);this._checkLayerEditable(0<this.userCredits).then(function(f){b.resolve(f)})}),t.hitch(this,function(g){console.log(g);this._checkLayerEditable(!1).then(function(f){b.resolve(f)})}));return b},_checkLayerEditable:function(b){var g=new w;this.editLayerNode.isEditable().then(t.hitch(this,function(f){g.resolve({canEdit:f,hasCredits:b})}));return g},showEditMessage:function(){var b=[];"undefined"!==typeof this.userName?b=[this.nls.startPage.userPrivilege+"\x3c/br\x3e\x3c/br\x3e",
this.nls.startPage.contactAdminEdit]:(this.portal=this.portal||d.getPortal(this.appConfig.portalUrl),b=[c.substitute({layerName:this.editLayer.name},this.nls.startPage.noAnonymousEdit+"\x3c/br\x3e\x3c/br\x3e"),c.substitute({org:this.portal.name},this.nls.startPage.pleaseLogin)]);this._showPopup(b,this.nls.startPage.invalidEdit)},locatorError:function(b,g){b=[b+"\x3c/br\x3e\x3c/br\x3e"];g&&b.push(c.substitute({locator:g},this.nls.startPage.canUseLocator));this._showPopup(b,this.nls.warningsAndErrors.locatorError)},
erroInCSV:function(){this._showPopup([this.nls.warningsAndErrors.invalidCSV+"\x3c/br\x3e"],"")}})});