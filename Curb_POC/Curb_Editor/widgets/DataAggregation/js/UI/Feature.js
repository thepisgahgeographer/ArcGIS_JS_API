// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/DataAggregation/js/UI/templates/Feature.html":'\x3cdiv class\x3d"pad-left-5 no-select"\x3e\r\n\r\n  \x3c!-- Title table --\x3e\r\n  \x3ctable class\x3d"page-table display-none table-layout" cellpading\x3d"0" data-dojo-attach-point\x3d"featureTitleTable"\r\n    tabindex\x3d"0" role\x3d"region"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd class\x3d"panel-title-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text" data-dojo-attach-point\x3d"pageTitleDiv"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border-bold task-instruction-row"\x3e\r\n        \x3ctd class\x3d"panel-title-hint-td"\x3e\r\n          \x3cdiv class\x3d"instruction" data-dojo-attach-point\x3d"pageHintDiv"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\r\n  \x3c!--Feature toolbar table--\x3e\r\n  \x3ctable class\x3d"page-table display-none table-layout" cellpading\x3d"0" data-dojo-attach-point\x3d"featureToolbarTable"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr class\x3d"bottom-border task-instruction-row"\x3e\r\n        \x3ctd data-dojo-attach-point\x3d"reviewRowRecordTd" class\x3d"pad-bottom-10 pad-top-10"\x3e\r\n          \x3cspan class\x3d"float-left main-text pad-right-10 display-none pad-left-5" data-dojo-attach-point\x3d"reviewText"\r\n            style\x3d"line-height:30px;"\x3e${nls.review.item}\x3c/span\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_duplicateFlag" class\x3d"pad-bottom-10 duplicate-flag"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"pad-bottom-10 pad-top-10 feature-toolbar-td"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"featureToolbar"\x3e\r\n\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\r\n  \x3c!--feature toggle table--\x3e\r\n  \x3ctable data-dojo-attach-point\x3d"featureToggleTable" class\x3d"page-table display-none table-layout" cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr class\x3d"bottom-border toggle-expand-row" data-dojo-attach-point\x3d"featureTr" data-dojo-attach-event\x3d"onclick:_toggleFeature  , onkeydown:_toggleFeature" tabindex\x3d"0"\r\n        role\x3d"button" aria-label\x3d"${nls.review.feature}" aria-expanded\x3d"false"\x3e\r\n        \x3ctd colspan\x3d"2" class\x3d"field-control-td text-left field-row-width pad-left-5"\x3e\r\n          \x3cdiv class\x3d"font-size-med main-text float-left"\x3e\r\n            ${nls.review.feature}\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd style\x3d"width: 20px;" nowrap class\x3d"page-item-td-nav" data-dojo-attach-point\x3d"featureTd"\x3e\r\n          \x3cdiv class\x3d"float-right bg-img-toggle bg-toggle-down-img margin-left-5"\r\n            data-dojo-attach-point\x3d"toggleFeature"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\r\n  \x3cdiv data-dojo-attach-point\x3d"featureInformation" class\x3d"display-none"\x3e\r\n\r\n    \x3c!--feature controls table--\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"featureTable" class\x3d"page-table display-none table-layout" cellpading\x3d"0"\x3e\r\n      \x3ccolgroup\x3e\r\n        \x3ccol width\x3d"30%" /\x3e\r\n        \x3ccol width\x3d"35%" /\x3e\r\n        \x3ccol width\x3d"35%" /\x3e\r\n      \x3c/colgroup\x3e\r\n      \x3ctbody data-dojo-attach-point\x3d"featureControlTable"\x3e\x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3c!--location toggle table--\x3e\r\n  \x3ctable data-dojo-attach-point\x3d"locationControlToggleTable" class\x3d"page-table display-none table-layout"\r\n    cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr class\x3d"bottom-border toggle-expand-row"  data-dojo-attach-point\x3d"locationTr" data-dojo-attach-event\x3d"onclick:_toggleLocation , onkeydown:_toggleLocation" tabindex\x3d"0"\r\n        role\x3d"button" aria-label\x3d"${nls.review.locationInfo}" aria-expanded\x3d"false"\x3e\r\n        \x3ctd class\x3d"field-control-td text-left field-row-width pad-left-5"\x3e\r\n          \x3cdiv class\x3d"font-size-med main-text float-left"\x3e\r\n            ${nls.review.locationInfo}\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd style\x3d"width: 20px;" class\x3d"page-item-td-nav" data-dojo-attach-point\x3d"locationTd"\x3e\r\n          \x3cdiv class\x3d"float-right bg-img-toggle bg-toggle-down-img margin-left-5"\r\n            data-dojo-attach-point\x3d"toggleLocation"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n  \x3c/table\x3e\r\n\r\n  \x3cdiv data-dojo-attach-point\x3d"locationInformation" class\x3d"display-none"\x3e\r\n\r\n    \x3c!--location toolbar--\x3e\r\n    \x3ctable class\x3d"page-table display-none" cellpading\x3d"0" data-dojo-attach-point\x3d"locationSyncTable"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr class\x3d"bottom-border task-instruction-row"\x3e\r\n          \x3ctd class\x3d"field-control-td pad-left-5"\x3e\r\n            \x3cdiv class\x3d"instruction" data-dojo-attach-point\x3d"locationHint"\x3e${nls.review.locationControlHint}\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"field-control-td" title\x3d"${nls.review.sync}"\x3e\r\n            \x3cdiv class\x3d"float-right bg-ft-img bg-sync feature-toolbar-btn" data-dojo-attach-point\x3d"syncFields"\r\n              data-dojo-attach-event\x3d"onclick:_syncAddressInfo , keydown:_syncAddressInfo"\r\n              role\x3d"button" aria-label\x3d"${nls.review.sync}"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd title\x3d"${nls.featureToolbar.locate}"\x3e\r\n            \x3cdiv class\x3d"bg-ft-img bg-locate feature-toolbar-btn float-right" data-dojo-attach-point\x3d"locateButton"\r\n              data-dojo-attach-event\x3d"onclick:_locate , keydown:_locate" role\x3d"button" aria-label\x3d"${nls.featureToolbar.locate}"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n\r\n    \x3c!--location controls table--\x3e\r\n    \x3ctable class\x3d"page-table display-none" cellpading\x3d"0" data-dojo-attach-point\x3d"locationControlTable"\x3e\r\n      \x3ccolgroup\x3e\r\n        \x3ccol width\x3d"35%" /\x3e\r\n        \x3ccol width\x3d"65%" /\x3e\r\n      \x3c/colgroup\x3e\r\n      \x3ctbody\x3e\x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n\r\n  \x3c/div\x3e\r\n\r\n\x3c/div\x3e\r\n\r\n'}});
define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-class dojo/dom-attr dojo/keys dijit/registry dijit/form/ValidationTextBox jimu/dijit/formSelect dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/query dojo/on dijit/form/DateTextBox dojo/text!./templates/Feature.html dojo/Deferred ./FeatureToolbar esri/tasks/query jimu/dijit/Popup jimu/utils esri/lang".split(" "),function(I,k,l,g,m,t,u,J,B,y,K,L,M,N,z,O,P,Q,v,R,C,D,w,S){return I([K,
L,M,N],{baseClass:"cf-feature",declaredClass:"CriticalFacilities.Feature",templateString:Q,_started:null,label:"Feature",parent:null,nls:null,map:null,appConfig:null,config:null,_featureToolbar:null,fields:[],feature:null,fileAddress:{},isDuplicate:!1,isDuplicateLocated:!1,isUnMatchedLocated:!1,isUnMatched:!1,_useGeomFromFile:!1,_useGeomFromLayer:!0,_useValuesFromFile:!1,_useValuesFromLayer:!0,_featureExpanded:!1,_locationExpanded:!1,theme:"",styleColor:"black",layer:null,_changedFileAttributeRows:[],
_changedLayerAttributeRows:[],_changedAddressRows:[],_editToolbar:null,_featureQuery:null,_skipFields:[],csvStore:null,constructor:function(a){k.mixin(this,a)},postCreate:function(){this.inherited(arguments);this.pageHintDiv.innerHTML=this.pageHint;this.pageTitleDiv.innerHTML=this.pageTitle;t.set(this.featureTitleTable,"aria-label",this.pageTitle+" "+this.pageHint);this._initUnMatched();this._initToolbar(this.featureToolbar);this._updateAltIndexes();this.lastFocusNode=this.locationTr},_initUnMatched:function(){if((this.isUnMatched=
-1!==this.label.indexOf("UnMatchedFeatures"))&&this.feature.fieldInfo&&this.feature.fieldInfo.length)for(var a=0;a<this.feature.fieldInfo.length;a++){var b=this.feature.fieldInfo[a];"matchScore"===b.name&&(this.isUnMatchedLocated=0!==b.value)}},_updateAltIndexes:function(){if(this.pageContainer){var a=this.pageContainer.getViewByTitle("Review");a&&(this.altHomeIndex=a.index)}},_initSkipFields:function(a){this._skipFields=["DestinationOID","matchScore","hasDuplicateUpdates","duplicateState",this.layer.objectIdField];
l.forEach(a,k.hitch(this,function(b){-1<b.name.indexOf(this.csvStore.matchFieldPrefix)&&this._skipFields.push(b.name)}))},startup:function(){var a=this.feature.fieldInfo;this._initSkipFields(a);this._initRows(a,this.featureControlTable);this.isDuplicate?this._initDuplicateReview(a):this._initStandardReview();this._getFeature().then(k.hitch(this,function(b){this._feature=b;this._featureToolbar._panToAndSelectFeature(b);!this.isDuplicate&&this._feature&&this._feature.geometry&&this._toggleEditControls(!1)}));
this._getEditFeature().then(k.hitch(this,function(b){this._editFeature=b;this.isDuplicate&&this._editFeature&&this._editFeature.geometry&&this._toggleLocationControls(!0)}));this.onShown()},onShown:function(){this._isReviewed=!0;this._showView();this._featureToolbar._panToAndSelectFeature(this.isDuplicate&&this._useGeomFromLayer?this._editFeature:this._feature);this.isShowing=!0;this.pageContainer.nextDisabled=!1;this.pageContainer.backDisabled=!1;!this.isDuplicate&&this._feature&&this._feature.geometry&&
this._toggleEditControls(!1);this.isDuplicate&&this._useGeomFromFile&&"make-change"===this._duplicateFlag.fromSelect.value&&this._toggleEditControls(!1)},onHidden:function(){this.isShowing=!1},validate:function(a,b){var c=new v;"next-view"===a?c.resolve(this._nextView()):"back-view"===a?c.resolve(this._backView()):this._homeView(b).then(function(d){c.resolve(d)});return c},_nextView:function(){return!0},_backView:function(){return!0},_homeView:function(a){var b=new v;this.pageContainer.getViewByTitle("Home").verifyClearSettings(a).then(function(c){b.resolve(c)});
return b},_showView:function(){m.remove(this.featureTitleTable,"display-none");m.remove(this.featureTable,"display-none");m.remove(this.featureToggleTable,"display-none");m.remove(this.locationSyncTable,"display-none");m.remove(this.locationControlTable,"display-none");m.remove(this.locationControlToggleTable,"display-none");m.remove(this.featureToolbarTable,"display-none");this.isDuplicate&&m.remove(this.reviewText,"display-none");this._updateInfoRows()},_getFeature:function(){var a=new v,b=this.layer.objectIdField,
c=this.feature.fieldInfo.filter(function(d){return d.name===b});this._featureQuery=new C;this._featureQuery.objectIds=[c[0].value];this.layer.queryFeatures(this._featureQuery).then(k.hitch(this,function(d){a.resolve(d.features[0])}));return a},_getEditFeature:function(){var a=new v,b=this.feature.fieldInfo.filter(function(c){return"DestinationOID"===c.name});b&&0<b.length?(this._editQuery=new C,this._editQuery.objectIds=[b[0].value],this.parent.editLayer.queryFeatures(this._editQuery).then(k.hitch(this,
function(c){a.resolve(c.features[0])}))):a.resolve();return a},_initStandardReview:function(){this._useValuesFromFile=!0;this._useValuesFromLayer=!1},_initDuplicateReview:function(a){this._initDuplicateSelect();this._initDuplicateReviewRows(a);m.add(this.featureToolbar,"display-none")},_initDuplicateSelect:function(){var a=new y({"aria-label":this.nls.review.item,style:{display:"table","min-width":"100px",height:"28px"},options:[{label:this.nls.review.duplicateAction,value:"no-change",selected:!0},
{label:this.nls.review.duplicateModify,value:"make-change"},{label:this.nls.review.duplicateSave,value:"not-duplicate"}],onChange:k.hitch(this,this._updateDuplicateUI)});this._duplicateFlag.fromSelect=a;g.place(a.domNode,this._duplicateFlag);a.startup();this._toggleEditControls(!0)},_updateDuplicateUI:function(a){this._updateDuplicateAttributes(a,null);"make-change"===a?m.remove(this.featureToolbar,"display-none"):m.add(this.featureToolbar,"display-none");this._toggleEditControls("make-change"===
a?!1:!0);"not-duplicate"===a&&this._showShouldLocateFeaturePopup().then(k.hitch(this,function(b){b?(this.resetAddressValues(this._featureToolbar._originalValues,a),this._featureToolbar._locateFeature(!0).then(k.hitch(this,function(){var c=new D({titleLabel:this.nls.review.featureLocated,width:400,autoHeight:!0,content:g.create("div",{innerHTML:this.nls.warningsAndErrors.itemMoveMatch,style:"padding-bottom: 10px;"}),buttons:[{label:this.nls.ok,onClick:k.hitch(this,k.hitch(this,function(){c.close();
c=null}))}],onClose:k.hitch(this,function(){c=null;this._featureToolbar._save({},!0)})})}))):this._duplicateFlag.fromSelect.set("value","no-change")}));this._updateLocationPanelLastNode()},_updateDuplicateAttributes:function(a,b){this._feature.attributes.duplicateState=null!==a?a:this._feature.attributes.duplicateState;this._feature.attributes.hasDuplicateUpdates=null!==b?b:this._feature.attributes.hasDuplicateUpdates},_showShouldLocateFeaturePopup:function(){var a=new v,b=g.create("div");g.create("div",
{innerHTML:this.nls.warningsAndErrors.itemWillBeLocated,style:"padding-bottom: 10px;"},b);g.create("div",{innerHTML:this.nls.warningsAndErrors.proceed},b);var c=new D({titleLabel:this.nls.review.locateFeature,width:400,autoHeight:!0,content:b,buttons:[{label:this.nls.yes,onClick:k.hitch(this,function(){c.close();c=null;a.resolve(!0)})},{label:this.nls.no,onClick:k.hitch(this,function(){c.close();c=null;a.resolve(!1)})}],onClose:function(){c=null}});return a},_initDuplicateReviewRows:function(a){var b=
g.create("tr",{className:"bottom-border",isHeaderRow:!0},this.reviewTable);g.create("td",{className:"text-left"},b);var c=g.create("td",{className:"text-left"},b);g.create("div",{className:"duplicate-col-headers main-text float-left",innerHTML:this.nls.review.target},c);b=g.create("td",{className:"text-left"},b);g.create("div",{className:"duplicate-col-headers main-text float-left",innerHTML:this.nls.review.source},b);l.forEach(a,k.hitch(this,function(d){if(-1===this._skipFields.indexOf(d.name)){var e=
g.create("tr",{className:"bottom-border",isLabelRow:!0,isControlRow:!0},this.reviewTable);e.fieldName=d.name;e.parent=this;var f=g.create("td",{className:"field-control-td text-left"},e);g.create("div",{className:"main-text float-left",innerHTML:d.label},f);this._initLabel(e,d.duplicateFieldInfo.value,!1,!1);this._initLabel(e,d.value,!0,!1)}}))},_initToolbar:function(a){this._featureToolbar=new R({nls:this.nls,map:this.map,parent:this.parent,config:this.config,appConfig:this.appConfig,feature:this.feature,
theme:this.theme,layer:this.layer,featureView:this,_editToolbar:this._editToolbar,csvStore:this.csvStore,_stageLayer:this.csvStore.matchedFeatureLayer,styleColor:this.styleColor,pageContainer:this.pageContainer});this._featureToolbar.placeAt(a);this._featureToolbar.startup()},_initRows:function(a,b){if(this.isDuplicate){this._initSelectRow(this.nls.review.use,this.locationControlTable,this._useGeomChanged,"geom");this._initSelectRow(this.nls.review.use,this.featureControlTable,this._useValuesChanged,
"values");var c=g.create("tr",{className:"bottom-border",isHeaderRow:!0},b);g.create("td",{className:"text-left"},c);var d=g.create("td",{className:"text-left"},c);g.create("div",{className:"duplicate-col-headers main-text float-left",innerHTML:this.nls.review.target},d);c=g.create("td",{className:"text-left"},c);g.create("div",{className:"duplicate-col-headers main-text float-left",innerHTML:this.nls.review.source},c)}(this._syncEnabled=0<Object.keys(this._parentFeatureList._syncFields).length)?
this._syncFields=this._parentFeatureList._syncFields:m.add(this.syncFields,"display-none");var e=0;l.forEach(a,k.hitch(this,function(f){if(-1===this._skipFields.indexOf(f.name)){var h=g.create("tr",{className:"bottom-border",isRadioRow:!1,isEditRow:!0,rowIndex:e},b);h.fieldName=f.name;h.parent=this;var q=g.create("td",{className:"field-control-td text-left field-row-width pad-left-5"},h);g.create("div",{className:"main-text float-left",innerHTML:f.label},q);this.isDuplicate&&this._initValidationBox(f.label,
h,f.duplicateFieldInfo.value,!1,!1);this._initValidationBox(f.label,h,f.value,!0,!1);e+=1}}));this.addressFields=this.csvStore.useMultiFields?this.csvStore.multiFields:this.csvStore.useAddr?this.csvStore.singleFields:this.getXYFields();l.forEach(this.addressFields,k.hitch(this,function(f){var h=g.create("tr",{className:"bottom-border",isRadioRow:!1,isEditRow:!1,isAddressRow:!0},this.locationControlTable);h.label=f.label;h.keyField=f.keyField;h.parent=this;var q=g.create("td",{className:"field-control-td text-left pad-left-5"},
h);g.create("div",{className:"main-text float-left",innerHTML:f.label},q);var A=this.csvStore.matchFieldPrefix;q=this.feature.fieldInfo.filter(function(x){return x.name===A+f.keyField})[0];this._initValidationBox(f.label,h,q.value,!1,!0)}))},_syncAddressInfo:function(a){"keydown"===a.type&&a.keyCode!==u.ENTER&&a.keyCode!==u.SPACE||this._featureToolbar._syncDisabled||(a=this._getAddress(),this._updateAddressFields(a,!0),this._featureToolbar._hasAddressEdit=!1,this._featureToolbar._updateSync(!0))},
_locate:function(a){this._featureToolbar._locate(a)},getXYFields:function(){this._featureToolbar._isAddressFeature=!1;var a=this.parent._pageContainer.getViewByTitle("Coordinates"),b=a.xField;a=a.yField;this._featureToolbar.xField=this.csvStore.xFieldName;this._featureToolbar.yField=this.csvStore.yFieldName;return[{keyField:this.csvStore.xFieldName,label:b.label,value:this.csvStore.xFieldName},{keyField:this.csvStore.yFieldName,label:a.label,value:this.csvStore.yFieldName}]},_updateAddressFields:function(a,
b){this._address=a;b?l.forEach(this.locationControlTable.rows,k.hitch(this,function(c){if(this._syncFields.hasOwnProperty(c.keyField))for(var d=this._syncFields[c.keyField],e=0;e<this.featureControlTable.rows.length;e++){var f=this.featureControlTable.rows[e];if(f.isEditRow&&f.fieldName===d.layerFieldName){c=this.csvStore.matchFieldPrefix+c.keyField;c=this._address&&this._address.hasOwnProperty(c)?this._address[c]:"";this.isDuplicate&&this._useValuesFromLayer?(f.layerValueTextBox.set("value",c),f.layerValueTextBox.emit("keyUp")):
(f.fileValueTextBox.set("value",c),f.fileValueTextBox.emit("keyUp"));break}}})):l.forEach(this.locationControlTable.rows,k.hitch(this,function(c){var d=this.csvStore.useAddr&&!this.csvStore.useMultiFields?"Match_addr":c.keyField;c.addressValueTextBox&&(this.csvStore.useAddr||(d=this.csvStore.xFieldName===d?"x":"y"),d=this._address&&this._address.hasOwnProperty(d)?this._address[d]:"",c.addressValueTextBox.set("value",d))}))},_validateAddressDifference:function(){var a=!1;this.locationControlTable&&
l.forEach(this.locationControlTable.rows,k.hitch(this,function(b){if(this._syncFields&&this._syncFields.hasOwnProperty(b.keyField)&&!a){var c=b.addressValueTextBox.displayedValue;b=this._syncFields[b.keyField];for(var d=0;d<this.featureControlTable.rows.length;d++){var e=this.featureControlTable.rows[d];if(e.isEditRow&&e.fieldName===b.layerFieldName&&!a){a=this.isDuplicate&&this._useValuesFromLayer?e.layerValueTextBox.displayedValue!==c:e.fileValueTextBox.displayedValue!==c;break}}}}));return a},
_getAddress:function(){this._address={};l.forEach(this.locationControlTable.rows,k.hitch(this,function(a){a.addressValueTextBox&&(this._address[this.csvStore.matchFieldPrefix+a.keyField]=a.addressValueTextBox.value)}));return this._address},_getAddressFieldsValues:function(){var a={};l.forEach(this.locationControlTable.rows,function(b){b.addressValueTextBox&&(a[b.keyField]=b.addressValueTextBox.value)});return a},_initLabel:function(a,b,c,d){var e=this._getField(a),f=g.create("td",{className:"field-control-td field-row-width2"},
a),h=new B({style:{width:"100%",height:"32px"},title:b,invalidMessage:this.nls.review.valuesDoNotMatch});h.decimalSeperator=this.csvStore.decimalSeperator;this._addLocalizeFloatSupport(h,b,d,e);h.set("value",b);h.set("readonly",!0);h.placeAt(f);h.startup();h.isFile=c;h.isAddress=d;h.row=a;h.parent=this;c?(a.fileValueTextBox=h,a.fileValue=b):d?(a.addressValueTextBox=h,a.addressValue=b):(a.layerValueTextBox=h,a.layerValue=b);c&&(h.validator=this._valuesMatch,h.validate())},_initValidationBox:function(a,
b,c,d,e){var f=this._getField(b),h=g.create("td",{className:"field-control-td",colspan:this.isDuplicate?1:2},b);if(f&&f.type&&"date"===f.type){var q=f.fieldInfo&&f.fieldInfo.format?f.fieldInfo:void 0;c=-1===[null,void 0,""].indexOf(c)?new Date(c):void 0;var A=-1===[null,void 0,""].indexOf(c)?!0:!1;a=new P({"aria-label":a,style:{width:"100%",height:"32px"},title:A?q?w.localizeDateByFieldInfo(c,q):w.localizeDate(c):"",onChange:this._onChange})}else if(f&&f.domainValues){q=function(n){var p;-1<f.values.indexOf(n)&&
(p=f.domainValues.filter(function(r){return r.label===n}));return p&&-1<p.length?p[0].value:n};c=-1<[null,void 0,""].indexOf(c)?"":-1<f.codes.indexOf(c)?c:q(c);var x=[{label:this.nls.review.selectValue,value:null,selected:!0}],E=c;l.forEach(f.domainValues,function(n){if(c.toString()===n.value.toString()||c.toString()===n.label.toString())E=n.label;x.push({label:n.label,value:n.value})});a=new y({"aria-label":a,style:{width:"100%",height:"32px"},options:x,onChange:this._onChange,title:E});h.style.overflow=
"hidden"}else a=new B({"aria-label":a,style:{width:"100%",height:"32px"},title:c});a.decimalSeperator=this.csvStore.decimalSeperator;this._addLocalizeFloatSupport(a,c,e,f);a.set("intermediateChanges",!0);a.set("value",this.isDuplicate&&e?"":c);a.placeAt(h);a.startup();this.lastValueTextBox=a.domNode;a.isFile=d;a.isAddress=e;a.row=b;a.featureToolbar=this._featureToolbar;if(!e){var F;f&&f.length&&(F=S.substitute({num:f.length},this.nls.warningsAndErrors.rangeMessage));a.invalidLengthMessage=F;a.invalidTypeMessage=
this.nls.warningsAndErrors.invalidMessage;a.fieldLength=f.length;a.fieldType=f.type;a.fieldNullable=f.nullable;f&&f.type&&"date"!==f.type&&(a.validator=this._valuesValidForType)}a.parent=this;d?(b.fileValueTextBox=a,b.fileValue=c):e?(b.addressValueTextBox=a,b.addressValue=c):(b.layerValueTextBox=a,b.layerValue=c);a.on("keyUp",function(n){n="undefined"!==typeof n.target.value?this.parent._getValue(n.target.value):"date"===this.fieldType?"":this.value;if(this.isAddress){n=n!==this.parent._getValue(this.row.addressValue);
var p=this.parent._changedAddressRows.indexOf(this.row.rowIndex);-1===p&&n?this.parent._changedAddressRows.push(this.row.rowIndex):-1<p&&!n&&this.parent._changedAddressRows.splice(p,1);this.parent.emit("address-change",0<this.parent._changedAddressRows.length)}else if(p=this.validate(),this.row._isValid=p){p=this.parent._getValue(this.row.fileValue);var r=this.parent._getValue(this.row.layerValue);n=this.isFile?n!==p:n!==r;r=this.isFile?this.parent._changedFileAttributeRows:this.parent._changedLayerAttributeRows;
p=r.indexOf(this.row.rowIndex);-1===p&&n?r.push(this.row.rowIndex):-1<p&&!n&&r.splice(p,1);var G=!0;l.forEach(this.parent.featureControlTable.rows,function(H){"undefined"===typeof H._isValid||H._isValid||(G=!1)});G?this.parent.emit("attribute-change",0<r.length):this.featureToolbar._updateSave(!0)}else this.featureToolbar._updateSave(!0)})},_getField:function(a){for(var b,c=0;c<this.csvStore.fsFields.length;c++){var d=this.csvStore.fsFields[c];if(d.name===a.fieldName){b=d;break}}return b},_addLocalizeFloatSupport:function(a,
b,c,d){"."!==a.decimalSeperator&&(c&&!this.csvStore.useAddr||d&&d.type&&"float"===d.type)&&(a.title=-1!==[null,void 0,""].indexOf(b)?"":isNaN(b)||"."===a.decimalSeperator?b:w.localizeNumber(b),a.format=function(e){return-1!==[null,void 0,""].indexOf(e)||isNaN(e)?e:w.localizeNumber(e).toString().replace(".","")},a.parse=function(e){return e&&e.toString&&-1<e.toString().indexOf(this.decimalSeperator)?e.toString().replace(this.decimalSeperator,"."):e})},_onChange:function(a){a="undefined"!==typeof a?
this.parent._getValue(a):"date"===this.fieldType?"":this.value;var b=this.validate();if(this.row._isValid=b){b=this.parent._getValue(this.row.fileValue);var c=this.parent._getValue(this.row.layerValue);a=this.isFile?a.toString()!==b.toString():a.toString()!==c.toString();c=this.isFile?this.parent._changedFileAttributeRows:this.parent._changedLayerAttributeRows;b=c.indexOf(this.row.rowIndex);-1===b&&a?c.push(this.row.rowIndex):-1<b&&!a&&c.splice(b,1);var d=!0;l.forEach(this.parent.featureControlTable.rows,
function(e){"undefined"===typeof e._isValid||e._isValid||(d=!1)});d?this.parent.emit("attribute-change",0<c.length):this.featureToolbar._updateSave(!0)}else this.featureToolbar._updateSave(!0)},_valuesValidForType:function(a){var b=a.toString();if(b.length>this.fieldLength)return this.invalidMessage=this.invalidLengthMessage,!1;if(0===b.length)return"undefined"!==typeof this.fieldNullable?this.fieldNullable:!0;this.invalidMessage=this.invalidTypeMessage;switch(this.fieldType){case "int":return/^-?[0-9]+$/.exec(a);
case "float":return"."!==this.decimalSeperator?/^-?[0-9]+[.,]?[0-9]*$/.exec(a):/^-?[0-9]+[.]?[0-9]*$/.exec(a);case "date":if(a)try{return!isNaN((new Date(a)).getTime())}catch(c){return console.error(c),!1}else return!0;case "domainInt":return/^-?[0-9]+$/.exec(a);case "domain":return!0;case "other":return!0}},_valuesMatch:function(){return this.row.fileValueTextBox&&this.row.layerValueTextBox?this.row.fileValueTextBox.value===this.row.layerValueTextBox.value:!0},_validateValues:function(){var a=!0;
l.forEach(this.featureControlTable.rows,k.hitch(this,function(c){if(c.isEditRow){"undefined"===typeof c._isValid||c._isValid||(a=!1);var d="date"===c.fileValueTextBox.fieldType&&c.fileValueTextBox.value.toString()===c.fileValueTextBox._invalidDate?"":this._getValue(c.fileValueTextBox.value),e=this._getValue(c.fileValue),f="date"===c.layerValueTextBox.fieldType&&c.layerValueTextBox.value.toString()===c.layerValueTextBox._invalidDate?"":this._getValue(c.layerValueTextBox.value),h=this._getValue(c.layerValue);
c.parent._useValuesFromFile&&(d!==e||d!==h)&&this._changedFileAttributeRows.push(c.rowIndex);c.parent._useValuesFromLayer&&f!==h&&this._changedLayerAttributeRows.push(c.rowIndex)}}));var b=this._useValuesFromFile?this._changedFileAttributeRows:this._changedLayerAttributeRows;a?this.emit("attribute-change",0<b.length):this._featureToolbar._updateSave(!0)},_getValue:function(a){return-1===[null,void 0,""].indexOf(a)?a:""},_validateGeoms:function(){var a=this._featureToolbar._hasAttributeEdit,b=this._featureToolbar._hasGeometryEdit;
this._useGeomFromLayer?this._featureToolbar._updateSaveAndCancel(!a):b?this._featureToolbar._updateSaveAndCancel(!a&&!b):this._featureToolbar._updateSaveAndCancel(!a)},_initSelectRow:function(a,b,c,d){b=g.create("tr",{className:"task-instruction-row bottom-border",isRadioRow:!0,isEditRow:!1},b);b.radioButtons=[];b.useType=d;var e=g.create("td",{},b);g.create("div",{className:"main-text float-left pad-left-5",innerHTML:a},e);this._createSelect(b,c,d)},_createSelect:function(a,b,c){var d=g.create("td",
{colspan:2,className:"field-control-td"},a);b=new y({style:{display:"table",width:"100%",height:"28px"},options:[{label:this.nls.review.fromLayer,value:"layer",selected:!0},{label:this.nls.review.fromFile,value:"file"}],onChange:k.hitch(this,b)});a.fromSelect=b;g.place(b.domNode,d);b.startup();"geom"===c&&this.own(O(a.fromSelect,"change",k.hitch(this,function(){this._updateLocationPanelLastNode()})))},_useGeomChanged:function(a){this._useGeomFromFile=a="file"===a;this._useGeomFromLayer=!a;a&&this.resetAddressValues(this._featureToolbar._originalValues);
a&&!this._hasBeenLocatedForFile?this._hasBeenLocatedForFile||this._featureToolbar._locateFeature().then(k.hitch(this,function(b){this._featureToolbar._originalValues.duplicateGeometry=b.feature.geometry;this._hasBeenLocatedForFile=!0;var c=[b.feature,this._editFeature];if(b.feature.geometry.x!==this._editFeature.geometry.x||b.feature.geometry.y!==this._editFeature.geometry.y)this.map&&this.map.extent&&this.map.extent.contains?this.map.extent.contains(b.feature.geometry)&&this.map.extent.contains(this._editFeature.geometry)||
this.csvStore._zoomToData(c):this.csvStore._zoomToData(c);this._featureToolbar._flashFeatures(c);this._validateGeoms()})):(this._featureToolbar._updateFeature(this._useGeomFromFile?this._featureToolbar._originalValues.duplicateGeometry:this._editFeature.geometry,!1,!0),this._featureToolbar._flashFeatures([a?this._feature:this._editFeature]),this._validateGeoms());this._useGeomFromLayer&&this._updateAddressFields(this._featureToolbar._originalValues.editAddress,!1);this._toggleLocationControls(!1);
this._syncFields&&this._featureToolbar._updateSync(!this._validateAddressDifference())},_toggleFeature:function(a){if("keydown"!==a.type||a.keyCode===u.ENTER||a.keyCode===u.SPACE)(this._featureExpanded=!this._featureExpanded)?(this._locationExpanded=!1,t.set(this.featureTr,"aria-expanded","true"),t.set(this.locationTr,"aria-expanded","false"),this.lastFocusNode=this.locationTr):t.set(this.featureTr,"aria-expanded","false"),this._updateInfoRows(),this.parent.updateFirstLastNode(!1)},_toggleLocation:function(a){if("keydown"!==
a.type||a.keyCode===u.ENTER||a.keyCode===u.SPACE)(this._locationExpanded=!this._locationExpanded)?(this._featureExpanded=!1,t.set(this.featureTr,"aria-expanded","false"),t.set(this.locationTr,"aria-expanded","true")):(t.set(this.locationTr,"aria-expanded","false"),this.lastFocusNode=this.locationTr),this._updateInfoRows(),this._updateLocationPanelLastNode()},_updateLocationPanelLastNode:function(){var a,b=!1;m.contains(this.toggleLocation,"bg-toggle-down-img")?this.lastFocusNode=this.locationTr:(a=
J.findWidgets(this.locationInformation))&&0<a.length&&(a.reverse(),l.some(a,k.hitch(this,function(c){if(c&&!c.disabled)return b=!0,this.lastFocusNode=c.domNode,!0})));b||(this.lastFocusNode=this.locationTr);this.parent.updateFirstLastNode(!1)},_updateInfoRows:function(){this._updateRow(this._featureExpanded,this.featureInformation,this.toggleFeature);this._updateRow(this._locationExpanded,this.locationInformation,this.toggleLocation)},_updateRow:function(a,b,c){var d=["bg-toggle-up-img","bg-toggle-up-img-white"],
e=["bg-toggle-down-img","bg-toggle-down-img-white"];a?m.remove(b,"display-none"):m.add(b,"display-none");this._updateImageNode(a?d:e,a?e:d,c)},updateImageNodes:function(){var a=this.pageContainer.isDarkTheme,b=a?"next-arrow-img":"next-arrow-img-white",c=a?"next-arrow-img-white":"next-arrow-img",d=z("."+b,this.domNode);l.forEach(d,function(e){m.remove(e,b);m.add(e,c)});b=a?"bg-toggle-up-img":"bg-toggle-up-img-white";c=a?"bg-toggle-up-img-white":"bg-toggle-up-img";d=z("."+b,this.domNode);l.forEach(d,
function(e){m.remove(e,b);m.add(e,c)});b=a?"bg-toggle-down-img":"bg-toggle-down-img-white";c=a?"bg-toggle-down-img-white":"bg-toggle-down-img";d=z("."+b,this.domNode);l.forEach(d,function(e){m.remove(e,b);m.add(e,c)})},_updateImageNode:function(a,b,c){var d=this.pageContainer.isDarkTheme;m.remove(c,d?b[1]:b[0]);m.add(c,d?a[1]:a[0])},_toggleLocationControls:function(a){var b=this.isDuplicate&&this._useGeomFromLayer?!0:a;this.locationControlTable&&l.forEach(this.locationControlTable.rows,function(c){c.fromSelect&&
c.fromSelect.set("disabled",a);c.isAddressRow&&c.addressValueTextBox&&c.addressValueTextBox.set("disabled",b)});b?this._featureToolbar._disableEdit():this._featureToolbar._enableEdit()},_useValuesChanged:function(a){this._useValuesFromFile=a="file"===a;this._useValuesFromLayer=!a;this._toggleEnabled(a);this._validateValues();this._syncFields&&this._featureToolbar._updateSync(!this._validateAddressDifference())},_toggleEnabled:function(a){l.forEach(this.featureControlTable.rows,function(b){b.isRadioRow||
(b.fileValueTextBox&&b.fileValueTextBox.set("disabled",!a),b.layerValueTextBox&&b.layerValueTextBox.set("disabled",a))})},_toggleEditControls:function(a){this.featureControlTable&&l.forEach(this.featureControlTable.rows,function(b){b.isRadioRow&&b.fromSelect.set("disabled",a);b.isEditRow&&(b.fileValueTextBox&&(a?b.fileValueTextBox.set("disabled",a):b.parent.isDuplicate&&b.parent._useValuesFromFile?b.fileValueTextBox.set("disabled",a):b.parent.isDuplicate||b.fileValueTextBox.set("disabled",a)),b.layerValueTextBox&&
(a?b.layerValueTextBox.set("disabled",a):b.parent.isDuplicate&&b.parent._useValuesFromLayer?b.layerValueTextBox.set("disabled",a):b.parent.isDuplicate||b.layerValueTextBox.set("disabled",a)))});this._toggleLocationControls(a)},resetAttributeValues:function(){l.forEach(this.featureControlTable.rows,k.hitch(this,function(a){a.fileValueTextBox&&a.fileValueTextBox.set("value",void 0===a.fileValue?"":a.fileValue);a.layerValueTextBox&&a.layerValueTextBox.set("value",a.layerValue)}));this._changedFileAttributeRows=
[];this._changedLayerAttributeRows=[]},resetAddressValues:function(a,b){l.forEach(this.locationControlTable.rows,k.hitch(this,function(c){var d=this.csvStore.useAddr&&!this.csvStore.useMultiFields?"Match_addr":c.keyField;c.addressValueTextBox&&(d=this.isDuplicate&&this._useGeomFromLayer&&"not-duplicate"!==b?a.editAddress&&a.editAddress.hasOwnProperty(d)?a.editAddress[d]:void 0:c.addressValue,c.addressValueTextBox.set("value",d))}))},resetGeometry:function(a){this._feature.geometry=a;this.feature.geometry=
a;this._featureToolbar._updateLayer(this.layer,null,[this._feature],null,!1,!0).then(k.hitch(this,function(){this._featureToolbar._flashFeatures([this._feature])}));this.resetFromLayerRows()},resetFromLayerRows:function(){this.isDuplicate&&(this._featureToolbar._fileGeometryModified||(this._useGeomFromLayer=!0),this._featureToolbar._fileValuesModified||(this._useValuesFromLayer=!0),l.forEach(this.featureControlTable.rows,k.hitch(this,function(a){a.fromSelect&&("geom"===a.useType&&this._useGeomFromLayer||
"values"===a.useType&&this._useValuesFromLayer)&&a.fromSelect.set("value","layer")})),l.forEach(this.locationControlTable.rows,k.hitch(this,function(a){a.fromSelect&&("geom"===a.useType&&!this._useGeomFromLayer||"values"===a.useType&&this._useValuesFromLayer)&&a.fromSelect.set("value","layer")})))},setStyleColor:function(a){this.styleColor=a;this._featureToolbar.styleColor=a}})});