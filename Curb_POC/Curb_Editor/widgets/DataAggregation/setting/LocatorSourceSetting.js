// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/DataAggregation/setting/LocatorSourceSetting.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"source-url-section"\x3e\r\n    \x3ctable class\x3d"source-table" cellspacing\x3d"0"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"first"\x3e\r\n            \x3cspan class\x3d"source-label"\x3e${nls.locatorUrl}\x3c/span\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"second"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"locatorUrl" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"required:true,trim:true,disabled:true,style:{width:\'100%\'}"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"third"\x3e\r\n            \x3cspan title\x3d"${nls.set}" class\x3d"jimu-btn" data-dojo-attach-event\x3d"click:_onSetLocatorUrlClick"\x3e${nls.set}\x3c/span\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"first"\x3e\x3c/td\x3e\r\n          \x3ctd class\x3d"second"\x3e\r\n            \x3cspan data-dojo-attach-point\x3d"messageNode" class\x3d"tip"\x3e\x3c/span\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv class\x3d"source-details-section" data-dojo-attach-point\x3d"detailsSection"\x3e\r\n    \x3ctable class\x3d"source-table" cellspacing\x3d"0"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"first"\x3e${nls.locatorName}\x3c/td\x3e\r\n          \x3ctd class\x3d"second"\x3e\r\n            \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-attach-point\x3d"locatorName" data-dojo-attach-event\x3d"Blur: _onLocatorNameBlur"\r\n                   placeHolder\x3d"${nls.locatorName}"\r\n                   required\x3d"true" data-dojo-props\x3d\'style:{width:"100%"}\' /\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr class\x3d"hide-country-code-row country-code-row" data-dojo-attach-point\x3d"countryCodeRow"\x3e\r\n          \x3ctd class\x3d"first"\x3e${nls.countryCode}\x3c/td\x3e\r\n          \x3ctd class\x3d"second"\x3e\r\n            \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-attach-point\x3d"countryCode"\r\n            data-dojo-attach-event\x3d"Blur:_onCountryCodeBlur"\r\n            placeHolder\x3d"${nls.eg} USA,CHN" data-dojo-props\x3d\'style:{width:"97%"}\'/\x3e\r\n            \x3ca class\x3d"jimu-float-trailing" target\x3d"_blank" href\x3d"https://developers.arcgis.com/rest/geocode/api-reference/geocode-coverage.htm" style\x3d"line-height:30px;"\x3e?\x3c/a\x3e\r\n            \x3cspan class\x3d"tip"\x3e${nls.countryCodeHint}\x3c/span\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n\r\n        \x3ctr class\x3d"hide-country-code-row country-code-row" data-dojo-attach-point\x3d"minCandidateScoreRow"\x3e\r\n          \x3ctd class\x3d"first"\x3e${nls.minCandidateScore}\x3c/td\x3e\r\n          \x3ctd class\x3d"second"\x3e\r\n            \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-point\x3d"minCandidateScore"\r\n                   data-dojo-attach-event\x3d"Blur:_onMinCandidateScoreBlur"\r\n                   placeHolder\x3d"${nls.eg} 90" data-dojo-props\x3d"style:{width:\'97%\'}, constraints:{min:0,max:100}, invalidMessage:\'${nls.requiresInteger0100}\'"/\x3e\r\n            \x3cspan class\x3d"tip"\x3e${nls.minCandidateScoreHint}\x3c/span\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e  \r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv class\x3d"source-fields-section"\x3e\r\n    \x3ctable class\x3d"fields-table" cellspacing\x3d"0"\x3e\r\n      \x3ccolgroup\x3e\r\n        \x3ccol width\x3d"55%"\x3e\x3c/col\x3e\r\n        \x3ccol width\x3d"45%"\x3e\x3c/col\x3e\r\n      \x3c/colgroup\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr\x3e\r\n\r\n          \x3ctd colspan\x3d"1"\x3e\r\n            \x3cdiv\x3e\r\n              \x3cdiv class\x3d"field-option-label" data-dojo-attach-point\x3d"enableSingleField"\x3e\x3c/div\x3e\r\n              \x3cdiv data-dojo-attach-point\x3d"editSingleFields" class\x3d"edit-fields" title\x3d"${nls.configureSingleFields}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n\r\n          \x3ctd colspan\x3d"1"\x3e\r\n            \x3cdiv\x3e\r\n              \x3cdiv class\x3d"source-edit-fields field-option-label" data-dojo-attach-point\x3d"enableMultiField" title\x3d"${nls.configureMultiFields}"\x3e\x3c/div\x3e\r\n              \x3cdiv data-dojo-attach-point\x3d"editMultiFields" class\x3d"edit-fields"\x3e\x3c/div\x3e\r\n              \x3cdiv data-dojo-attach-point\x3d"noFields" class\x3d"display-none no-fields-alert" title\x3d"${nls.noFields}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"1"\x3e\r\n            \x3cspan class\x3d"tip"\x3e${nls.singleFieldHint}\x3c/span\x3e\r\n          \x3c/td\x3e\r\n\r\n          \x3ctd colspan\x3d"1"\x3e\r\n            \x3cspan class\x3d"tip"\x3e${nls.multiFieldHint}\x3c/span\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n\r\n\x3c/div\x3e'}});
define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/dom-class dojo/Evented dojo/Deferred dojo/query dojo/dom-style dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin jimu/portalUrlUtils jimu/dijit/Message jimu/dijit/_GeocodeServiceChooserContent jimu/dijit/Popup jimu/dijit/LoadingShelter jimu/dijit/CheckBox esri/request esri/lang ./EditFields jimu/utils dojo/text!./LocatorSourceSetting.html dijit/form/ValidationTextBox dijit/form/NumberTextBox".split(" "),
function(v,e,m,f,h,w,x,y,k,z,A,B,C,p,q,D,E,r,F,n,t,u,g,G){return v([A,B,C,x],{baseClass:"jimu-widget-search-locator-source-setting",tr:null,nls:null,config:null,singleLineFieldName:null,templateString:G,parent:null,_locatorDefinition:null,_esriLocatorRegExp:/http(s)?:\/\/geocode(.){0,3}\.arcgis.com\/arcgis\/rest\/services\/World\/GeocodeServer/g,serviceChooserContent:null,geocoderPopup:null,addressFields:null,_clickSet:!1,postCreate:function(){this.inherited(arguments);this.exampleHint=this.nls.locatorExample+
": http://\x26lt;myServerName\x26gt;/arcgis/rest/services/World/GeocodeServer";this.multiEnabled=this.singleEnabled=!1;this.enableSingleField=this._initCheckBox(this.enableSingleField,this.nls.enableSingleField,this.editSingleFields);this.enableMultiField=this._initCheckBox(this.enableMultiField,this.nls.enableMultiField,this.editMultiFields);this.own(h(this.editSingleFields,"click",e.hitch(this,this._editFields,"single")));this.own(h(this.editMultiFields,"click",e.hitch(this,this._editFields,"multi")));
this._setMessageNodeContent(this.exampleHint);this.config=this.config?this.config:{};this.setConfig(this.config)},_initCheckBox:function(a,b,c){a=new F({checked:!1,label:b},a);this._toggleNode(c,!1);this.own(h(a,"change",e.hitch(this,function(){var d=a.getValue();switch(a.label){case this.nls.enableSingleField:this.singleEnabled=d;this.tr&&(this.tr.singleEnabled=d);break;case this.nls.enableMultiField:this.multiEnabled=d,this.tr&&(this.tr.multiEnabled=d)}this._toggleNode(c,d);this.parent.validateAddressOptions()})));
return a},setRelatedTr:function(a){this.tr=a;this._setDefaultRowOptions()},_setDefaultRowOptions:function(){this.tr.singleEnabled=this.singleEnabled;this.tr.multiEnabled=this.multiEnabled;this.tr.addressFields=this.addressFields;this.tr.noFieldsNode=this.noFields;this.parent.validateAddressOptions()},getRelatedTr:function(){return this.tr},setDefinition:function(a){this._locatorDefinition=a||{}},getDefinition:function(){return this._locatorDefinition},setConfig:function(a){if("[object Object]"===
Object.prototype.toString.call(a)){var b=a.url;b&&(this.config=a,"undefined"!==typeof this.config.singleEnabled&&(this.singleEnabled=this.config.singleEnabled),this.enableSingleField.setValue(this.singleEnabled),"undefined"!==typeof this.config.multiEnabled&&(this.multiEnabled=this.config.multiEnabled),this.enableMultiField.setValue(this.multiEnabled),"undefined"!==typeof this.config.addressFields&&(this.addressFields=this.config.addressFields),"undefined"!==typeof this.config.singleLineFieldName&&
(this.singleLineFieldName=this.config.singleLineFieldName),"undefined"!==typeof this.config.singleAddressFields&&this.config.singleAddressFields.hasOwnProperty("length")&&0<this.config.singleAddressFields.length&&(this.singleLineField=this.config.singleAddressFields[0]),"undefined"!==typeof this.config.singleAddressFields&&(this.singleAddressFields=this.config.singleAddressFields),this.shelter||(this.shelter=new r({hidden:!0}),this.shelter.placeAt(this.detailsSection)),this.shelter.show(),this._locatorDefinition.url!==
b?this._getDefinitionFromRemote(b).then(e.hitch(this,function(c){b&&c&&"error"!==c.type?(this._locatorDefinition=c,this._locatorDefinition.url=b,this._setSourceItems(),this._setAddressFields(b,this.config),this._setMessageNodeContent(this.exampleHint),this._updateNameText(!1)):b&&c&&"error"===c.type&&(this._setSourceItems(),this._disableSourceItems(),this._updateNameText(!0),this._setMessageNodeContent(t.substitute({URL:c.url},e.clone(this.nls.invalidUrlTip)),!0));this.shelter.hide()})):(this._setSourceItems(),
this._setMessageNodeContent(this.exampleHint),this.shelter.hide()))}},_updateNameText:function(a){if(this.tr){var b=k(".normal-text-div",this.tr)[0];b&&(b.title=a?this.nls.locatorError:b.textContent,z.set(b,"color",a?"red":""));this.tr.isDisabled=a}},isValidConfig:function(){var a=this.getConfig();return a.url&&a.name&&a.singleLineFieldName&&(this.enableSingleField.checked||this.enableMultiField.checked||this.enableXYField.checked)&&a.isValidMultiFieldOptions?!0:!1},showValidationTip:function(){this._showValidationErrorTip(this.locatorUrl);
this._showValidationErrorTip(this.locatorName)},getConfig:function(){return{url:this.locatorUrl.get("value"),name:g.stripHTML(this.locatorName.get("value")),singleEnabled:this.singleEnabled,multiEnabled:this.multiEnabled,singleLineFieldName:this.singleLineFieldName,addressFields:this.addressFields,singleAddressFields:this.singleAddressFields,countryCode:g.stripHTML(this.countryCode.get("value")),minCandidateScore:parseInt(g.stripHTML(this.minCandidateScore.get("value").toString()),10),type:"locator",
isValidMultiFieldOptions:this.multiEnabled?!w.contains(this.noFields,"display-block"):!0}},_editFields:function(a){switch(a){case "single":a=k(".jimu-state-disabled",this.enableSingleField.domNode);this.singleEnabled&&0===a.length&&this._editSingleAddressFieldsTableValues(this.singleAddressFields);break;case "multi":a=k(".jimu-state-disabled",this.enableMultiField.domNode),this.multiEnabled&&0===a.length&&this._editMultiAddressFieldsTableValues()}},_editSingleAddressFieldsTableValues:function(a){if(this.singleLineField){var b=
new u({nls:this.nls,type:"locatorFields",addressFields:a||[this.singleLineField],popupTitle:this.nls.configureSingleFields,disableDisplayOption:!0,disableDuplicateOption:!0});this.own(h(b,"edit-fields-popup-ok",e.hitch(this,function(){this.singleAddressFields=b.fieldInfos;this.tr.singleAddressFields=b.fieldInfos;this.parent.validateAddressOptions()})));b.popupEditPage()}},_editMultiAddressFieldsTableValues:function(){var a=new u({nls:this.nls,type:"locatorFields",addressFields:this.addressFields,
popupTitle:this.nls.configureMultiFields,disableDisplayOption:!1,disableDuplicateOption:!0});this.own(h(a,"edit-fields-popup-ok",e.hitch(this,function(){this.addressFields=a.fieldInfos;this.tr.addressFields=a.fieldInfos;this.parent.validateAddressOptions()})));a.popupEditPage()},_onLocatorNameBlur:function(){this.locatorName.set("value",g.stripHTML(this.locatorName.get("value")))},_onCountryCodeBlur:function(){this.countryCode.set("value",g.stripHTML(this.countryCode.get("value")))},_onMinCandidateScoreBlur:function(){var a=
parseInt(g.stripHTML(this.minCandidateScore.get("value").toString()),10);this.minCandidateScore.set("value",a)},_disableSourceItems:function(){this.locatorName.set("disabled",!0);this.countryCode.set("disabled",!0);this.minCandidateScore.set("disabled",!0);this._toggleSourceFields([this.enableSingleField.domNode,this.enableMultiField.domNode],[".checkbox",".label"],!0);this._toggleNode(this.editSingleFields,!1);this._toggleNode(this.editMultiFields,!1)},_toggleSourceFields:function(a,b,c){m.forEach(a,
function(d){m.forEach(b,function(l){l=k(l,d)[0];c&&(f.addClass(l,"jimu-state-disabled"),f.addClass(l,"pointer-events-none"))})})},_enableSourceItems:function(){this.locatorName.set("disabled",!1);this.countryCode.set("disabled",!1);this.minCandidateScore.set("disabled",!1);this.enableSingleField.set("disabled",!1);this.enableMultiField.set("disabled",!1)},_setSourceItems:function(){var a=this.config;a.url&&(this.locatorUrl.set("value",a.url),this._processCountryCodeRow(a.url),this._processMinCandidateScoreRow(a.url),
this._setAddressFields(a.url,this.config));a.name&&this.locatorName.set("value",g.stripHTML(a.name));a.singleLineFieldName&&(this.singleLineFieldName=a.singleLineFieldName);a.countryCode&&this.countryCode.set("value",g.stripHTML(a.countryCode));a.minCandidateScore&&this.minCandidateScore.set("value",parseInt(g.stripHTML(a.minCandidateScore.toString()),10));this._enableSourceItems()},_setAddressFields:function(a,b){if(a||b)b&&b.addressFields&&b.singleAddressFields?(this.addressFields=b.addressFields,
this.singleLineFieldName=b.singleLineFieldName,this.singleLineField=b.singleAddressFields[0],this.singleAddressFields=b.singleAddressFields,this.parent.validateAddressOptions()):n({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(e.hitch(this,function(c){c&&c.addressFields&&(this.addressFields=c.addressFields,m.forEach(this.addressFields,e.hitch(this,function(d){d.isRecognizedValues=this._getIsRecognizedValues(d)})));c&&c.singleLineAddressField&&c.singleLineAddressField.name&&
(this.singleLineField=c.singleLineAddressField,this.singleLineFieldName=this.singleLineField.name,this.singleAddressFields=[this.singleLineField],this.singleLineField.isRecognizedValues=this._getIsRecognizedValues(this.singleLineField))}),e.hitch(this,function(c){console.error(c)}))},_getIsRecognizedValues:function(a){var b=navigator.language.toLowerCase(),c=a.recognizedNames&&a.recognizedNames.hasOwnProperty(b),d=a.isRecognizedValues;return d?d:c?a.recognizedNames[b]:[a.name]},_isEsriLocator:function(a){this._esriLocatorRegExp.lastIndex=
0;return this._esriLocatorRegExp.test(a)},_getDefinitionFromRemote:function(a){var b=new y;if(this._isEsriLocator(a))b.resolve({singleLineAddressField:{name:"SingleLine",fieldName:"SingleLine",type:"esriFieldTypeString",alias:"Single Line Input",label:"Single Line Input",required:!1,length:200,localizedNames:{},recognizedNames:{}},capabilities:"Geocode,ReverseGeocode,Suggest"});else{var c=n({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"});this.own(c);c.then(e.hitch(this,function(d){b.resolve(d)}),
e.hitch(this,function(d){console.error(d);b.resolve({type:"error",url:this._getRequestUrl(a)})}))}return b.promise},_setMessageNodeContent:function(a,b){f.empty(this.messageNode);a.nodeType||(a=f.toDom(a));f.place(a,this.messageNode);b?f.addClass(this.messageNode,"error-message"):f.removeClass(this.messageNode,"error-message")},_getRequestUrl:function(a){var b=window.location.protocol;return"http:"===b?p.setHttpProtocol(a):"https:"===b?p.setHttpsProtocol(a):a},_onSetLocatorUrlClick:function(){this._clickSet=
!0;this._openServiceChooser()},_openLocatorChooser:function(){this._clickSet=!1;this._openServiceChooser()},_openServiceChooser:function(){this.serviceChooserContent=new D({url:this.locatorUrl.get("value")||""});this.shelter=new r({hidden:!0});this.geocoderPopup=new E({titleLabel:this.nls.setGeocoderURL,autoHeight:!0,content:this.serviceChooserContent.domNode,container:window.jimuConfig.layoutId,width:640});this.shelter.placeAt(this.geocoderPopup.domNode);f.setStyle(this.serviceChooserContent.domNode,
"width","580px");f.addClass(this.serviceChooserContent.domNode,"override-geocode-service-chooser-content");this.serviceChooserContent.own(h(this.serviceChooserContent,"validate-click",e.hitch(this,function(){f.removeClass(this.serviceChooserContent.domNode,"override-geocode-service-chooser-content")})));this.serviceChooserContent.own(h(this.serviceChooserContent,"ok",e.hitch(this,"_onSelectLocatorUrlOk")));this.serviceChooserContent.own(h(this.serviceChooserContent,"cancel",e.hitch(this,"_onSelectLocatorUrlCancel")))},
_onSelectLocatorUrlOk:function(a){if(a&&a[0]&&a[0].url&&this.domNode){this.shelter.show();var b=a[0].url;n({url:b,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(e.hitch(this,function(c){this.shelter.hide();if(c&&c.singleLineAddressField&&c.singleLineAddressField.name){this._enableSourceItems();this.locatorUrl.set("value",b);if(!this.locatorName.get("value")){if("string"!==typeof b)return"geocoder";var d=b.split("/");this.locatorName.set("value",d[d.length-2]||"geocoder")}this.singleLineFieldName=
c.singleLineAddressField.name;this.singleLineField=c.singleLineAddressField;this._processCountryCodeRow(b);this._processMinCandidateScoreRow(b);this._locatorDefinition=c;this._locatorDefinition.url=b;this._setAddressFields(b,this.config);this._clickSet?this.emit("reselect-locator-url-ok",this.getConfig()):this.emit("select-locator-url-ok",this.getConfig());this.geocoderPopup&&(this.geocoderPopup.close(),this.geocoderPopup=null);this._setMessageNodeContent(this.exampleHint)}else new q({message:this.nls.locatorWarning})}),
e.hitch(this,function(c){console.error(c);this.shelter.hide();new q({message:t.substitute({URL:this._getRequestUrl(b)},e.clone(this.nls.invalidUrlTip))})}))}},_onSelectLocatorUrlCancel:function(){this.geocoderPopup&&(this.geocoderPopup.close(),this.geocoderPopup=null,this.emit("select-locator-url-cancel"))},_toggleNode:function(a,b){a&&(f.removeClass(a,b?"edit-fields-disabled":"edit-fields"),f.addClass(a,b?"edit-fields":"edit-fields-disabled"))},_processCountryCodeRow:function(a){this._isEsriLocator(a)?
(this.countryCode.set("value",""),f.removeClass(this.countryCodeRow,"hide-country-code-row")):f.addClass(this.countryCodeRow,"hide-country-code-row")},_processMinCandidateScoreRow:function(a){this._isEsriLocator(a)?(this.minCandidateScore.set("value",""),f.removeClass(this.minCandidateScoreRow,"hide-country-code-row")):f.addClass(this.minCandidateScoreRow,"hide-country-code-row")},_showValidationErrorTip:function(a){if(!a.validate()&&a.domNode&&a.focusNode){var b=a.get("disabled");b&&a.set("disabled",
!1);a.focusNode.focus();setTimeout(e.hitch(this,function(){a.focusNode.blur();b&&a.set("disabled",!0);a=null}),100)}}})});