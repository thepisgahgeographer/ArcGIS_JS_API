// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/topic esri/graphic esri/toolbars/draw esri/geometry/Circle esri/geometry/Polyline esri/geometry/geometryEngine ./Feedback".split(" "),function(h,d,k,g,m,l,n,p,q,e){e=h([e],{constructor:function(a){h.safeMixin(this,a);this.syncEvents();this.initGeometryService()},clearGraphics:function(){this.map.graphics.clear()},syncEvents:function(){g.subscribe("MANUAL_CIRCLE_RADIUS_INPUT",d.hitch(this,this.manualRadiusUpdate));g.subscribe("manual-circle-center-point-input",
d.hitch(this,this.onCenterPointManualInputHandler));g.subscribe("clear-points",d.hitch(this,this.clearPoints))},clearPoints:function(a){a&&(this._points=[],this.map.graphics.clear())},onCenterPointManualInputHandler:function(a){this._points=[];this._points.push(a.offset(0,0));this.set("startPoint",this._points[0]);this.map.centerAt(a)},manualRadiusUpdate:function(){this.circleGraphic&&this.map.graphics.remove(this.circleGraphic)},_onClickHandler:function(a){if(this.map.snappingManager)var c=this.map.snappingManager._snappingPoint;
var b=c||a.mapPoint;this._processAfterMapClick(b).then(d.hitch(this,function(f){this._points.push(b);switch(this._geometryType){case l.POINT:this.set("startPoint",b);this.set("startPointDD",f);this._drawEnd(b.offset(0,0));this._setTooltipMessage(0);break;case l.POLYLINE:switch(this._points.length){case 1:this.set("startPoint",b);this.set("startPointDD",f);this.startPoint=f;this.canProjectLocally&&(this.startPoint=b,this._onMouseMoveHandlerConnect=k.connect(this.map,"onMouseMove",this._onMouseMoveHandler));
break;case 2:this.endPoint=f,this._onDoubleClickHandler()}this._setTooltipMessage(this._points.length)}}))},_onMouseMoveHandler:function(a){if(this.map.snappingManager)var c=this.map.snappingManager._snappingPoint;a=this.setCircleGeometry(this.startPoint,c||a.mapPoint);this.cleanup();this.circleGraphic=new m(a,this.fillSymbol);this.map.graphics.add(this.circleGraphic)},_onDoubleClickHandler:function(){this.disconnectOnMouseMoveHandler();this.cleanup();this._clear();this._setTooltipMessage(0);if(this.circleGraphic)this._drawEnd(this.circleGraphic.geometry);
else{var a=this.setCircleGeometry(this.startPoint,this.endPoint);this._drawEnd(a)}},disconnectOnMouseMoveHandler:function(){k.disconnect(this._onMouseMoveHandlerConnect)},cleanup:function(){this.circleGraphic&&this.map.graphics.remove(this.circleGraphic)},setCircleGeometry:function(a,c){var b=new p(a.spatialReference);b.addPath([a,c]);c=q.geodesicLength(b,9001);b=this.coordTool.convertMetersToUnits(c,this.lengthUnit);this.isDiameter&&(b*=2);this.set("length",b);return new n(a,{radius:c,geodesic:!0,
numberOfPoints:360})}});e.DD_CIRCLE_LENGTH_DID_CHANGE="DD_CIRCLE_LENGTH_DID_CHANGE";return e});