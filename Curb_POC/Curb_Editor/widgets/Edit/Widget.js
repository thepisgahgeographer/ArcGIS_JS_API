// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"esri/dijit/editing/Editor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/DeferredList dojo/dom-class dojo/dom-construct dojo/string dijit/_Widget dijit/_Templated ../../domUtils ../../graphicsUtils ../../geometry/Polyline ../../geometry/Polygon ../../graphic ../../undoManager ../../tasks/query ../../layers/FeatureLayer ../../layers/FeatureTemplate ../../toolbars/draw ../../toolbars/edit ../AttributeInspector ./Util ./Add ./Update ./Delete ./Cut ./Union ./toolbars/Drawing ./SelectionHelper ./TemplatePicker ../../kernel ../../config dojo/i18n!../../nls/jsapi dojo/text!./templates/Editor.html dijit/ProgressBar dojo/NodeList-dom".split(" "),
function(N,v,z,y,m,c,f,a,n,l,b,u,w,e,q,h,r,d,x,C,L,t,p,G,T,D,P,O,X,H,g,B,A,I,M,R,S,W){var V=N([u,w],{declaredClass:"esri.dijit.editing.Editor",widgetsInTemplate:!0,templateString:W,onLoad:function(){},constructor:function(k,F){k=k||{};k.settings||console.error("Editor: please provide 'settings' parameter in the constructor");k.settings.layerInfos||console.error("Editor: please provide 'layerInfos' parameter in the constructor");this._settings=k.settings;this._eConnects=[]},startup:function(){this.inherited(arguments);
this._setDefaultOptions();this._settings.map.setInfoWindowOnClick(!1);var k=this._settings.layerInfos;this.featureReductionEnabledLayers=[];z.forEach(k,function(K){K=K.featureLayer;K.isFeatureReductionEnabled()&&(K.disableFeatureReduction(),this.featureReductionEnabledLayers.push(K))},this);if(z.every(k,function(K){return K.featureLayer.loaded}))this._initLayers(),this._connectEvents(),this._createWidgets(),this.onLoad(),this.loaded=!0;else{var F=k.length;z.forEach(k,function(K){K=K.featureLayer;
if(K.loaded)F--;else var E=y.connect(K,"onLoad",this,function(J){y.disconnect(E);E=null;F--;F||(this._initLayers(),this._connectEvents(),this._createWidgets(),this.onLoad(),this.loaded=!0)})},this)}this._reset();this._enableMapClickHandler()},stopEditing:function(k){this._updateCurrentFeature(v.hitch(this,function(){this._clearSelection(!1);k&&k()}))},destroy:function(){this._settings.map.setInfoWindowOnClick(!0);this.drawingToolbar&&this.drawingToolbar.destroy();this.attributeInspector&&this.attributeInspector.destroy();
this.templatePicker&&this.templatePicker.destroy();this._selectionHelper&&this._selectionHelper.destroy();this._drawToolbar&&this._drawToolbar.deactivate();this._reset();this._disableMapClickHandler();z.forEach(this._eConnects,y.disconnect);y.disconnect(this._dtConnect);y.disconnect(this._templatePickerOnSelectionChangeEvent);this._layer=this._currentGraphic=this._activeType=this._activeTemplate=this._drawingTool=this._drawToolbar=this.editToolbar=this.drawingToolbar=this.attributeInspector=this.templatePicker=
this.undoManager=null;this._settings.map.infoWindow&&this._settings.map.infoWindow.clearFeatures&&this._settings.map.infoWindow.clearFeatures();z.forEach(this.featureReductionEnabledLayers,function(k){k.enableFeatureReduction()});this.inherited(arguments)},_setDefaultOptions:function(){this._drawToolbar=this._settings.drawToolbar||new p(this._settings.map);this._settings.drawToolbar=this._drawToolbar;this.editToolbar=this._settings.editToolbar||new G(this._settings.map,{textSymbolEditorHolder:this.domNode});
this._settings.editToolbar=this.editToolbar;this._settings.toolbarVisible=this._settings.toolbarVisible||!1;this._settings.toolbarOptions=v.mixin({reshapeVisible:!1,cutVisible:!1,mergeVisible:!1},this._settings.toolbarOptions);this._settings.createOptions=v.mixin({polylineDrawTools:[V.CREATE_TOOL_POLYLINE],polygonDrawTools:[V.CREATE_TOOL_POLYGON],editAttributesImmediately:!0},this._settings.createOptions);this._settings.singleSelectionTolerance=this._settings.singleSelectionTolerance||3;this._settings.maxUndoRedoOperations=
this._settings.maxUndoRedoOperations||10;this._settings.editor=this;this._usePopup=this._settings.usePopup=this._settings.map.infoWindow._setPagerCallbacks?!0:!1;this._datePackage=this._settings.datePackage;var k=R.defaults;this._settings.geometryService=this._settings.geometryService||k.geometryService;k.geometryService=k.geometryService||this._settings.geometryService},_initLayers:function(){this._settings.layers=[];this._settings.userIds={};this._settings.createOnlyLayer={};z.forEach(this._settings.layerInfos,
function(k){if(k.featureLayer&&k.featureLayer.loaded){this._settings.layers.push(k.featureLayer);var F=k.featureLayer.id;k.featureLayer.credential&&(this._settings.userIds[F]=k.featureLayer.credential.userId);k.userId&&(this._settings.userIds[F]=k.userId);var K=k.featureLayer.getEditCapabilities();this._settings.createOnlyLayer[F]=K.canCreate&&!K.canUpdate?!0:!1;this._isTextSymbolPointLayer(k.featureLayer)&&(k.disableAttributeUpdate=!0)}},this)},_reset:function(){this._hideAttributeInspector();this.editToolbar.deactivate();
this._editVertices=!0;this._drawingTool=this._activeTemplate=this._activeType=this._currentGraphic=this._layer=null;this._attributeChanged=!1},_saveFeatureOnClient:function(k){var F=this.templatePicker.getSelected();var K=F.template?F.featureLayer.renderer.getSymbol(F.template.prototype):F.symbolInfo.symbol;this._tempGraphic=new d(k,K,null,null);this._tempGraphic.setAttributes(v.mixin({},F.template.prototype.attributes));K=this._settings.map;K.graphics.add(this._tempGraphic);k=this._findCenterPoint(k);
this._createAttributeInspector();K.infoWindow.setTitle(F.featureLayer?F.featureLayer.name:S.widgets.attributeInspector.NLS_title);this.attributeInspector.showFeature(this._tempGraphic,F.featureLayer);this._showInfoWindow(k,K.getInfoWindowAnchor(k));if(this._settings.createOnlyLayer[F.featureLayer.id]||this._settings.invalidTemplate)this._infoWindowHideEvent=y.connect(K.infoWindow,"onHide",this,"_infoWindowHide");y.disconnect(this._templatePickerOnSelectionChangeEvent);this.templatePicker.clearSelection();
this._drawToolbar.deactivate();this._enableMapClickHandler();this.drawingToolbar&&this.drawingToolbar.deactivate();this._templatePickerOnSelectionChangeEvent=y.connect(this.templatePicker,"onSelectionChange",v.hitch(this,"_onCreateFeature"))},_saveAttributesOnClient:function(k,F,K){this._tempGraphic.attributes[F]="number"===typeof K&&isNaN(K)?null:K},_infoWindowHide:function(){this._createFeature(this._tempGraphic.geometry,this._tempGraphic.attributes);y.disconnect(this._infoWindowHideEvent)},_createFeature:function(k,
F){this._editClickPoint=this._findCenterPoint(k);k.rings?this._simplify(k,v.hitch(this,function(K){this._drawingTool!==t.TOOL_AUTO_COMPLETE_POLYGON?this._applyEdits([{layer:this._layer,adds:[this._createGraphic(K,F)]}],v.hitch(this,function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer)})):this._autoComplete(K,v.hitch(this,function(E){E&&E.length&&this._applyEdits([{layer:this._layer,adds:z.map(E,v.hitch(this,function(J){return this._createGraphic(J,
F)}))}],function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer)})}))})):this._applyEdits([{layer:this._layer,adds:[this._createGraphic(k,F)]}],v.hitch(this,function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer);this._layer&&this._layer.renderer&&"heatmap"===this._layer.renderer.type&&this._layer.refresh()}))},_chainAttachment:function(k,F){this.attributeInspector&&
this.attributeInspector._attachmentEditor&&this.attributeInspector._attachmentEditor._tempUpload&&this.attributeInspector._attachmentEditor._chainAttachment(k,F)},_updateCurrentFeature:function(k){var F=this._isModified();F?this._updateFeature(F,k):k&&k(!1)},_updateFeature:function(k,F,K){var E=k.geometry,J=k.getLayer();J.hasZ&&!J.enableZDefaults||J.hasM&&!J.allowUpdateWithoutMValues||K&&!this._isModified()?(K=new d,K.setAttributes(k.attributes),this._applyEdits([{layer:k.getLayer(),updates:[K]}],
F)):E.rings?this._simplify(E,v.hitch(this,function(Q){this._applyEdits([{layer:k.getLayer(),updates:[v.mixin(k,{geometry:Q})]}],F)})):this._applyEdits([{layer:k.getLayer(),updates:[k]}],F)},_deleteFeature:function(k,F){if(this._settings.invalidTemplate&&k===this._tempGraphic)this._settings.map.graphics.remove(this._tempGraphic),this._hideAttributeInspector();else{var K=[];k?K.push({layer:k.getLayer(),deletes:[k]}):(K=z.map(z.filter(this._settings.layers,function(E){return 0<E.getSelectedFeatures().length}),
function(E){return{layer:E,deletes:E.getSelectedFeatures()}}))&&K.length||!this._currentGraphic||K.push({layer:this._layer,deletes:[this._currentGraphic]});this._applyEdits(K,F)}},_stopEditing:function(k,F,K,E){e.hide(this.progressBar.domNode);this._settings.createOnlyLayer[k.id]||this._undoRedoAdd();if(!0===k._isSelOnly||1===k.mode||6===k.mode){if(F&&F.length){this.templatePicker.clearSelection();var J=new C;J.objectIds=[F[0].objectId];this._settings.createOnlyLayer[k.id]||this._settings.invalidTemplate?
this._settings.map.graphics.remove(this._tempGraphic):this._selectFeatures([k],J,v.hitch(this,"_onEditFeature"))}}else(J=this._selectionHelper.findMapService(this._settings.map,k))&&J.refresh(),F&&F.length&&(this.templatePicker.clearSelection(),this._settings.createOnlyLayer[k.id]||this._settings.invalidTemplate?this._settings.map.graphics.remove(this._tempGraphic):D.findFeatures(F,k,v.hitch(this,"_onEditFeature")));E&&E.length&&(this._clearSelection(!0),this._undoRedo&&(J=this._selectionHelper.findMapService(k,
this._settings.map))&&J.refresh());this._undoRedo&&K&&K.length&&((J=this._selectionHelper.findMapService(k,this._settings.map))&&J.refresh(),this.attributeInspector.refresh(),this._undoRedo=!1);this.drawingToolbar&&this.drawingToolbar._updateUI();this._undoRedo=!1;this._settings.invalidTemplate=!1},_undoRedoAdd:function(){this._settings._isApplyEditsCall=!1;if(this._settings.undoManager){var k=this._edits&&this._edits.length?this._edits[0]:null;if(k){var F=k.adds||[],K=k.updates||[],E=k.deletes||
[],J=k.preUpdates||[];k={featureLayer:k.layer};"CUT"===this._activeTool?F.length&&K.length&&J.length&&this.undoManager.add(new H(v.mixin(k,{preUpdatedGraphics:J,addedGraphics:F,postUpdatedGraphics:K}))):"UNION"===this._activeTool?E.length&&K.length&&J.length&&this.undoManager.add(new g(v.mixin(k,{preUpdatedGraphics:J,deletedGraphics:E,postUpdatedGraphics:K}))):F.length?this.undoManager.add(new P(v.mixin(k,{addedGraphics:F}))):E.length?this.undoManager.add(new X(v.mixin(k,{deletedGraphics:E}))):K.length&&
(this._rollbackGraphic||J.length)&&this.undoManager.add(new O(v.mixin(k,{preUpdatedGraphics:J.length?J:[this._rollbackGraphic],postUpdatedGraphics:K})));this._rollbackGraphic=this._edits=null}}},_activateDrawToolbar:function(k){this._layer=k.featureLayer;this._activeType=k.type;this._drawingTool=(this._activeTemplate=k.template)?this._activeTemplate.drawingTool:null;this._drawTool=this._toDrawTool(this._drawingTool,k.featureLayer);y.disconnect(this._dtConnect);var F=this._layer.fields;this._settings.invalidTemplate=
!1;if(this._activeTemplate&&this._activeTemplate.prototype){var K=v.mixin({},this._activeTemplate.prototype.attributes);F=F.filter(function(E){return!1===E.nullable&&!0===E.editable});this._settings.invalidTemplate=F.some(function(E){E=K[E.name];return null===E||void 0===E})}this._dtConnect=this._settings.createOnlyLayer[k.featureLayer.id]||this._settings.invalidTemplate?y.connect(this._drawToolbar,"onDrawEnd",this,"_saveFeatureOnClient"):y.connect(this._drawToolbar,"onDrawEnd",this,"_createFeature");
this.editToolbar.deactivate();this._disableMapClickHandler();this.drawingToolbar?this.drawingToolbar.activateEditing(this._drawTool,this._layer):this._drawToolbar.activate(this._drawTool)},_activateEditToolbar:function(k,F){var K=k.getLayer(),E=K?K.geometryType:null,J=this._isTextSymbolPoint(k),Q=G.MOVE;"esriGeometryPoint"!==E&&!0===this._isNotesFeature(k)?(Q=Q|G.ROTATE|G.SCALE,this._editVertices=!1):"esriGeometryPoint"!==E&&!0===this._editVertices?(Q=Q|G.ROTATE|G.SCALE,this._editVertices=!1):J?(Q=
Q|G.ROTATE|G.SCALE|G.EDIT_TEXT,this._editVertices=!1):(Q|=G.EDIT_VERTICES,this._editVertices=!0);this._attributeChanged=this._isModified();this._rollbackGraphic=new d(k.toJson());E=K.getEditCapabilities({feature:k,userId:this._settings.userIds[K.id]});var U=z.filter(this._settings.layerInfos,function(Y){return Y.featureLayer.layerId===K.layerId})[0];E.canUpdate&&!U.disableGeometryUpdate&&E.canUpdateGeometry&&(this.editToolbar.activate(Q,k),J&&(this.editToolbar._textEditor._addTextBox(k),this.editToolbar._textSymbolEditor&&
this.editToolbar._textSymbolEditor.hide()));this._settings.map.infoWindow.isShowing||this._updateAttributeDisabled(k)||(k=F&&F.screenPoint||this._findCenterPoint(k),this._showInfoWindow(k,this._settings.map.getInfoWindowAnchor(k)))},_createGraphic:function(k,F){var K=new d(k,this._activeType&&this._activeType.symbol||this._layer.defaultSymbol,F);this._activeTemplate||F?K.attributes=F||v.mixin({},this._activeTemplate.prototype.attributes):(K.attributes=K.attributes||[],z.forEach(this._layer.fields,
function(E){K.attributes[E.name]=null},this));return K},_connectEvents:function(){var k=this._settings.layers;z.forEach(k,function(F){this._connect(F,"onEditsComplete",v.hitch(this,"_stopEditing",F))},this);z.forEach(k,function(F){this._connect(F,"onBeforeApplyEdits",v.hitch(this,function(){e.show(this.progressBar.domNode);this._settings._isApplyEditsCall=!0}))},this);this._connect(this.editToolbar,"onGraphicClick",v.hitch(this,"_activateEditToolbar"));this._connect(this.editToolbar,"onGraphicFirstMove",
v.hitch(this,"_hideAttributeInspector"));this._connect(this.editToolbar,"onVertexFirstMove",v.hitch(this,"_hideAttributeInspector"));this._connect(this.editToolbar,"onScaleStart",v.hitch(this,"_hideAttributeInspector"));this._connect(this.editToolbar,"onRotateStart",v.hitch(this,"_hideAttributeInspector"))},_connect:function(k,F,K){this._eConnects.push(y.connect(k,F,K))},_createWidgets:function(){this._selectionHelper=new A(this._settings);this._createTemplatePicker();this._createAttributeInspector();
this._createDrawingToolbar();this._createUndoRedoManager()},_createTemplatePicker:function(){if(this._settings.templatePicker)this.templatePicker=this._settings.templatePicker,e.hide(this.templatePickerDiv);else{var k=z.filter(this._settings.layers,function(F){return F.getEditCapabilities().canCreate});this.templatePicker=new I({"class":"esriTemplatePicker",featureLayers:k,showTooltip:!0,maxLabelLength:this._settings.typesCharacterLimit,columns:"auto",rows:"auto"},this.templatePickerDiv);this.templatePicker.startup();
this._settings.templatePicker=this.templatePicker}this._templatePickerOnSelectionChangeEvent=y.connect(this.templatePicker,"onSelectionChange",v.hitch(this,"_onCreateFeature"))},_createAttributeInspector:function(){var k=this._settings.map;this._settings.attributeInspector?(this._customAttributeInspector=!0,this.attributeInspector=this._settings.attributeInspector):(this._customAttributeInspector=!1,this.attributeInspector=new T({layerInfos:this._settings.layerInfos,hideNavButtons:this._usePopup,
datePackage:this._datePackage},l.create("div")),this.attributeInspector.startup(),k.infoWindow.setContent(this.attributeInspector.domNode),k.infoWindow.setTitle(S.widgets.attributeInspector.NLS_title),k.infoWindow.resize(350,375),m.query(".esriAttributeInspector .atiLayerName").style({display:"none"}));this._connect(this.attributeInspector,"onDelete",v.hitch(this,"_deleteFeature"));this._connect(this.attributeInspector,"onNext",v.hitch(this,function(F){this._updateCurrentFeature(v.hitch(this,function(){this._attributeChanged=
!1;this._onEditFeature(F)}))}));this._usePopup&&k.infoWindow._setPagerCallbacks(this.attributeInspector,v.hitch(this.attributeInspector,"previous"),v.hitch(this.attributeInspector,"next"));this._connect(this.attributeInspector,"onAttributeChange",v.hitch(this,function(F,K,E){if(this._settings.createOnlyLayer[this._layer.id]||this._settings.invalidTemplate)this._saveAttributesOnClient(F,K,E);else{var J=F.getLayer();(J=z.filter(J.fields,function(Q){return Q.name===K})[0])&&""===E&&(E=null);this._rollbackGraphic=
new d(v.clone(F.toJson()));this.attributeInspector._rollbackInfo={field:J,graphic:this._rollbackGraphic};this._currentGraphic.attributes[K]="number"===typeof E&&isNaN(E)?null:E;this._currentGraphic.setAttributes(this._currentGraphic.attributes);this._updateFeature(this._currentGraphic,null,!0);this._attributeChanged=!1}}))},_createDrawingToolbar:function(){!0===this._settings.toolbarVisible&&(this.drawingToolbar=new B({"class":"esriDrawingToolbar",drawToolbar:this._drawToolbar,editToolbar:this.editToolbar,
settings:this._settings,onDelete:v.hitch(this,"_deleteFeature"),onApplyEdits:v.hitch(this,"_applyEdits"),onShowAttributeInspector:v.hitch(this,"_onEditFeature")},this.drawingToolbarDiv))},_createUndoRedoManager:function(){if(this._settings.enableUndoRedo||this._settings.undoManager)this._settings.enableUndoRedo=!0,this.undoManager=this._settings.undoManager,this.undoManager||(this.undoManager=this._settings.undoManager=new x({maxOperations:this._settings.maxUndoRedoOperations})),this._connect(this.undoManager,
"onUndoComplete",v.hitch(this,this._updateUndoRedoOperations)),this._connect(this.undoManager,"onRedoComplete",v.hitch(this,this._updateUndoRedoOperations)),this._connect(document,"onkeypress",v.hitch(this,function(k){if(k.metaKey||k.ctrlKey)"z"===k.charOrCode&&this._undo(),"y"===k.charOrCode&&this._redo()}))},_updateUndoRedoOperations:function(k){if(k&&k.addedIds){var F;for(F=0;F<this.undoManager.length;F++){var K=this.undoManager.get(F);K&&k.layer===K._featureLayer&&K.updateObjectIds(k.oldIds,k.addedIds)}}k&&
"Update Features"===k.operation.label&&this.attributeInspector.refresh()},_enableMapClickHandler:function(){this._mapClickHandler=y.connect(this._settings.map,"onClick",v.hitch(this,function(k){this._drawToolbar._geometryType||("SELECT"===this._activeTool?this._activeTool="":this._updateCurrentFeature(v.hitch(this,function(){this._reset();this._updateSelection(k)})))}))},_disableMapClickHandler:function(){y.disconnect(this._mapClickHandler)},_onCreateFeature:function(){var k=this.templatePicker.getSelected();
k?this._updateCurrentFeature(v.hitch(this,function(){this._currentGraphic&&this._clearSelection(!1);this._reset();this._activateDrawToolbar(k)})):(this._reset(),y.disconnect(this._dtConnect),this._drawToolbar.deactivate(),this._enableMapClickHandler(),this.drawingToolbar&&this.drawingToolbar.deactivate())},_isTextSymbolPoint:function(k){if("point"===k.geometry.type||"multipoint"===k.geometry.type){var F=k.getLayer(),K=F.renderer;k=k.symbol||F._getSymbol(k);!k&&(K.hasVisualVariables("sizeInfo",!1)||
K.hasVisualVariables("colorInfo",!1)||K.hasVisualVariables("opacityInfo",!1))&&K.addBreak&&K.infos&&1===K.infos.length&&(k=K.infos[0].symbol||K.defaultSymbol);if(k&&"textsymbol"===k.type)return!0}return!1},_isTextSymbolPointLayer:function(k){return"esriGeometryPoint"===k.geometryType&&k.renderer&&k.renderer._symbols&&k.renderer._symbols[0]&&k.renderer._symbols[0].symbol&&"textsymbol"===k.renderer._symbols[0].symbol.type?!0:!1},_updateAttributeDisabled:function(k){k=k.getLayer();if(!k)return!1;var F,
K=!1;for(F=0;F<this._settings.layerInfos.length;F++){var E=this._settings.layerInfos[F];if(E.featureLayer==k){K=E.disableAttributeUpdate;break}}return K},_onEditFeature:function(k,F){if(k=(v.isArray(k)?k[0]:k)||null){this._layer=k.getLayer();if(!this._customAttributeInspector&&!this._updateAttributeDisabled(k)){F=F||this._editClickPoint||this._findCenterPoint(k);if(1<this._currentFeatureCount){var K=this._popupFeatures.indexOf(k);K=b.substitute(S.widgets.popup.NLS_pagingInfo,{index:K+1,total:this._currentFeatureCount})}else K=
this._layer?this._layer.name:S.widgets.attributeInspector.NLS_title;this._settings.map.infoWindow.setTitle(K);if(this.drawingToolbar||!this._settings.map.infoWindow.isShowing)this.attributeInspector.refresh(),this._showInfoWindow(F,this._settings.map.getInfoWindowAnchor(F));this._editClickPoint=null}k!==this._currentGraphic&&(this._editVertices=!0,this._currentGraphic=k,k.getDojoShape()&&k.getDojoShape().moveToFront(),F=this._layer.hasM,this._layer.hasZ&&!this._layer.enableZDefaults||F&&!this._layer.allowUpdateWithoutMValues||
this._activateEditToolbar(k))}},_applyEdits:function(k,F){k=k||[];if(!(0>=k.length)){this._edits=this._oEdits=k;var K=[];z.forEach(k,function(E){E.layer&&K.push(E.layer.applyEdits(E.adds,E.updates,E.deletes))});0<K.length&&(this._deferredsList=(new a(K)).addCallback(v.hitch(this,function(){e.hide(this.progressBar.domNode);F&&F();var E=this._settings.map;E&&E.infoWindow.reposition&&E.infoWindow.isShowing&&E.infoWindow.reposition()})))}},_undo:function(){this._settings.undoManager&&!this._settings._isApplyEditsCall&&
(this.editToolbar.deactivate(),this._undoRedo=!0,this._settings.undoManager.undo())},_redo:function(){this._settings.undoManager&&!this._settings._isApplyEditsCall&&(this.editToolbar.deactivate(),this._undoRedo=!0,this._settings.undoManager.redo())},_simplify:function(k,F){r.prototype.isSelfIntersecting(k)?this._settings.geometryService.simplify([k],function(K){var E=K&&K.length?K[0]:E;F&&F(E)}):F&&F(k)},_autoComplete:function(k,F){var K=this._getLayers("esriGeometryPolygon"),E=new C;E.geometry=k;
E.returnGeometry=!0;this._selectFeatures(K,E,v.hitch(this,function(J){!J||0>=J.length?F&&F([k]):this._settings.geometryService.autoComplete(q.getGeometries(J),this._toPolylines([E.geometry]),function(Q){F&&F(Q)})}))},_getLayers:function(k){return z.filter(this._settings.layers,function(F){return F.geometryType===k})},_selectFeatures:function(k,F,K,E){this._selectionHelper.selectFeatures(k,F,E||L.SELECTION_NEW,K)},_updateSelection:function(k){var F=k.mapPoint,K=k.graphic,E=this._settings.layerInfos,
J;this._selectionHelper.selectFeaturesByGeometry(this._settings.layers,F,L.SELECTION_NEW,v.hitch(this,function(Q){var U=z.some(Q,v.hitch(this,function(Z){return Z==K}));if(K&&!U)if(U=K.getLayer(),this._isValidLayer(U)){var Y=new C;Y.objectIds=[K.attributes[U.objectIdField]];this._selectionHelper.selectFeatures([U],Y,L.SELECTION_ADD,v.hitch(this,function(Z){Z&&Z.length&&(Z=Z.concat(Q),J=D.sortFeaturesById(E,Z),this._updatePopupButtons(J),this._onEditFeature(J,F))}))}else Q&&Q.length?(J=D.sortFeaturesById(E,
Q),this._updatePopupButtons(J),this._onEditFeature(J,F)):this._clearSelection();else Q&&Q.length?(J=D.sortFeaturesById(E,Q),this._updatePopupButtons(J),this._onEditFeature(J,F)):this._clearSelection()}));K&&this._isTextSymbolPoint(K)&&this._isValidLayer(K.getLayer())&&this.editToolbar.activate(0|G.MOVE|G.ROTATE|G.SCALE|G.EDIT_TEXT,K)},_updatePopupButtons:function(k){if(this._usePopup&&k){var F=k.length;z.forEach([this._settings.map.infoWindow._prevFeatureButton,this._settings.map.infoWindow._nextFeatureButton],
v.hitch(this,function(E){1<F?n.remove(E,"hidden"):n.add(E,"hidden")}));var K=1<F?"block":"none";m.query(".esriAttributeInspector .atiLayerName").style({display:K});this._currentFeatureCount=F;this._popupFeatures=k}else this._currentFeatureCount=this._popupFeatures=null},_clearSelection:function(k){this._currentFeatureCount=0;this._popupFeatures=null;this._selectionHelper.clearSelection(k||!1);this._reset()},_findCenterPoint:function(k){k=k.geometry||k;switch(k.type){case "point":var F=k;break;case "polyline":F=
k.getPoint(0,Math.ceil(k.paths[0].length/2));break;case "polygon":F=k.rings.length-1,F=k.getPoint(F,k.rings[F].length-1)}return this._settings.map.toScreen(F)},_hideAttributeInspector:function(){!this._customAttributeInspector&&this._settings.map.infoWindow&&this._settings.map.infoWindow.hide()},_toPolylines:function(k){return z.map(k,function(F){var K=new h(F.spatialReference);z.forEach(F.rings,function(E){K.addPath(E)});return K})},_isNotesFeature:function(k){var F=k.getLayer(),K=F?F.types||null:
null;if(!K)return!1;var E=k.attributes[F.typeIdField],J;z.some(K,function(Q){return Q.id===E?(J=Q.templates,!0):!1});return J?(k=J[0]||null)?this._isShapeTool(k.drawingTool)?!0:!1:!1:!1},_isValidLayer:function(k){var F,K=this._settings.layerInfos;for(F=0;F<K.length;F++){var E=K[F];if(k.id==(E.featureLayer?E.featureLayer.id:E.layerId))return!0}return!1},_isShapeTool:function(k){switch(k){case t.TOOL_ARROW:return p.ARROW;case t.TOOL_LEFT_ARROW:return p.LEFT_ARROW;case t.TOOL_RIGHT_ARROW:return p.RIGHT_ARROW;
case t.TOOL_UP_ARROW:return p.UP_ARROW;case t.TOOL_DOWN_ARROW:return p.DOWN_ARROW;case t.TOOL_CIRCLE:return p.CIRCLE;case t.TOOL_ELLIPSE:return p.ELLIPSE;case t.TOOL_TRIANGLE:return p.TRIANGLE;case t.TOOL_RECTANGLE:return p.RECTANGLE;default:return null}},_toDrawTool:function(k,F){F=F.geometryType;switch(k){case t.TOOL_POINT:return p.POINT;case t.TOOL_ARROW:return p.ARROW;case t.TOOL_LEFT_ARROW:return p.LEFT_ARROW;case t.TOOL_RIGHT_ARROW:return p.RIGHT_ARROW;case t.TOOL_UP_ARROW:return p.UP_ARROW;
case t.TOOL_DOWN_ARROW:return p.DOWN_ARROW;case t.TOOL_CIRCLE:return p.CIRCLE;case t.TOOL_ELLIPSE:return p.ELLIPSE;case t.TOOL_TRIANGLE:return p.TRIANGLE;case t.TOOL_RECTANGLE:return p.RECTANGLE;case t.TOOL_LINE:return p.POLYLINE;case t.TOOL_POLYGON:return p.POLYGON;case t.TOOL_FREEHAND:return"esriGeometryPolyline"===F?p.FREEHAND_POLYLINE:p.FREEHAND_POLYGON;default:return k=p.POINT,"esriGeometryPolyline"===F?(k=p.POLYLINE,this._settings.createOptions.polylineDrawTools[0]===V.CREATE_TOOL_FREEHAND_POLYLINE&&
(k=p.FREEHAND_POLYLINE)):"esriGeometryPolygon"===F&&(k=p.POLYGON,this._settings.createOptions.polygonDrawTools[0]===V.CREATE_TOOL_FREEHAND_POLYGON&&(k=p.FREEHAND_POLYGON)),k}},_isModified:function(){var k=this.editToolbar.getCurrentState();return(k.isModified||this._attributeChanged)&&k.graphic?k.graphic:null},_showInfoWindow:function(k,F){this._customAttributeInspector||this._settings.map.infoWindow.show(k,F)}});v.mixin(V,{CREATE_TOOL_POLYLINE:"polyline",CREATE_TOOL_FREEHAND_POLYLINE:"freehandpolyline",
CREATE_TOOL_POLYGON:"polygon",CREATE_TOOL_FREEHAND_POLYGON:"freehandpolygon",CREATE_TOOL_AUTOCOMPLETE:"autocomplete",CREATE_TOOL_RECTANGLE:"rectangle",CREATE_TOOL_TRIANGLE:"triangle",CREATE_TOOL_CIRCLE:"circle",CREATE_TOOL_ELLIPSE:"ellipse",CREATE_TOOL_ARROW:"arrow",CREATE_TOOL_UP_ARROW:"uparrow",CREATE_TOOL_DOWN_ARROW:"downarrow",CREATE_TOOL_RIGHT_ARROW:"rightarrow",CREATE_TOOL_LEFT_ARROW:"leftarrow"});c("extend-esri")&&v.setObject("dijit.editing.Editor",V,M);return V})},"esri/toolbars/edit":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/has dojo/dom-construct dojo/dom-style ../kernel ../lang ../sniff ./_toolbar ./_Box ./_GraphicMover ./_VertexEditor ./TextEditor ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/TextSymbol ../graphic".split(" "),
function(N,v,z,y,m,c,f,a,n,l,b,u,w,e,q,h,r,d,x,C,L){var t=v(w,{declaredClass:"esri.toolbars.Edit",constructor:function(p,G){this._map=p;this._tool=0;if(this._map.loaded)this._scratchGL=p.graphics;else var T=y.connect(this._map,"onLoad",this,function(){y.disconnect(T);T=null;this._scratchGL=this._map.graphics});p=f("esri-mobile");this._defaultOptions=z.mixin({vertexSymbol:new d(d.STYLE_CIRCLE,p?20:12,new x(x.STYLE_SOLID,new c([0,0,0,.5]),1),new c([128,128,128])),ghostVertexSymbol:new d(d.STYLE_CIRCLE,
p?18:10,new x(x.STYLE_SOLID,new c([0,0,0,.5]),1),new c([255,255,255,.75])),ghostLineSymbol:new x(x.STYLE_DOT,new c([128,128,128]),2),allowDeleteVertices:!0,allowAddVertices:!0,rotateHandleOffset:p?24:16,boxLineSymbol:new x(x.STYLE_DASH,new c([64,64,64]),1),boxHandleSymbol:new d(d.STYLE_SQUARE,p?16:9,new x(x.STYLE_SOLID,new c([0,0,0,.5]),1),new c([255,255,255,.75])),textAnchorSymbol:new d(d.STYLE_CIRCLE,10,null,new c([255,0,0]))},G||{})},activate:function(p,G,T){this.deactivate();this._graphic=G;this._options=
z.mixin(z.mixin({},this._defaultOptions),T||{});var D=t.MOVE;T=t.EDIT_VERTICES;var P=t.SCALE,O=t.ROTATE,X=t.EDIT_TEXT,H=!1,g=!1,B=!1,A=this._map,I=A.spatialReference,M=G.geometry.spatialReference;this._geo=!(!I||!M||I.equals(M)||!I.isWebMercator()||4326!==M.wkid);this._isTextPoint=this._prepareTextSymbolEditing(G,p);(p&D)===D&&(H=this._enableMove(G));D=(p&P)===P;O=(p&O)===O;if(D||O)B=this._enableBoxEditing(G,D,O);(p&T)===T&&(g=this._enableVertexEditing(G));(p&X)===X&&this._enableTextEditing(G);if(!(H||
g||B))throw Error("[esri.toolbars.Edit::activate] Unable to activate the tool. Check if the tool is valid for the given geometry type.");if(this._tool=p)this._mapPanEndHandle=y.connect(A,"onPanEnd",this,this._mapPanEndHandler),this._mapExtChgHandle=y.connect(A,"onExtentChange",this,this._mapExtentChangeHandler),this.onActivate(this._tool,G);A.snappingManager&&(H||g)&&A.snappingManager._startSelectionLayerQuery()},deactivate:function(){this._isTextPoint=null;var p=this._tool,G=this._graphic;if(p){var T=
!!this._modified;this._clear();y.disconnect(this._mapPanEndHandle);y.disconnect(this._mapExtChgHandle);this._graphic=this._geo=this._mapPanEndHandle=this._mapExtChgHandle=null;this.onDeactivate(p,G,{isModified:T});this._map.snappingManager&&this._map.snappingManager._stopSelectionLayerQuery()}},refresh:function(){this._refreshMoveables(!0)},getCurrentState:function(){return{tool:this._tool,graphic:this._graphic,isModified:!!this._modified}},onActivate:function(p,G){},onDeactivate:function(p,G,T){},
onGraphicMoveStart:function(p){},onGraphicFirstMove:function(p){this._modified=!0},onGraphicMove:function(p,G){},onGraphicMoveStop:function(p,G){},onGraphicClick:function(p,G){},onVertexMoveStart:function(p,G){},onVertexFirstMove:function(p,G){this._modified=!0},onVertexMove:function(p,G,T){},onVertexMoveStop:function(p,G,T){},onVertexAdd:function(p,G){this._modified=!0},onVertexClick:function(p,G){},onVertexMouseOver:function(p,G){},onVertexMouseOut:function(p,G){},onVertexDelete:function(p,G){this._modified=
!0},onTextEditStart:function(p,G){},onTextEditEnd:function(p){},onScaleStart:function(p){},onScaleFirstMove:function(p){this._modified=!0},onScale:function(p,G){},onScaleStop:function(p,G){},onRotateStart:function(p){},onRotateFirstMove:function(p){this._modified=!0},onRotate:function(p,G){},onRotateStop:function(p,G){},_eventMap:{activate:["tool","graphic"],deactivate:["tool","graphic","info"],"graphic-move-start":["graphic"],"graphic-first-move":["graphic"],"graphic-move":["graphic","transform"],
"graphic-move-stop":["graphic","transform"],"graphic-click":["graphic","info"],"vertex-move-start":["graphic","vertexinfo"],"vertex-first-move":["graphic","vertexinfo"],"vertex-move":["graphic","vertexinfo","transform"],"vertex-move-stop":["graphic","vertexinfo","transform"],"vertex-add":["graphic","vertexinfo"],"vertex-click":["graphic","vertexinfo"],"vertex-mouse-over":["graphic","vertexinfo"],"vertex-mouse-out":["graphic","vertexinfo"],"vertex-delete":["graphic","vertexinfo"],"scale-start":["graphic"],
"scale-first-move":["graphic"],scale:["graphic","info"],"scale-stop":["graphic","info"],"rotate-start":["graphic"],"rotate-first-move":["graphic"],rotate:["graphic","info"],"rotate-stop":["graphic","info"]},_prepareTextSymbolEditing:function(p,G){if("point"===p.geometry.type||"multipoint"===p.geometry.type){var T=p.getLayer(),D=T.renderer;T=p.symbol||T._getSymbol(p);!T&&(D.hasVisualVariables("sizeInfo",!1)||D.hasVisualVariables("colorInfo",!1)||D.hasVisualVariables("opacityInfo",!1))&&D.addBreak&&
D.infos&&1===D.infos.length&&(T=D.infos[0].symbol||D.defaultSymbol);if(T&&"textsymbol"===T.type){if((G&t.SCALE)===t.SCALE||(G&t.ROTATE)===t.ROTATE||(G&t.EDIT_TEXT)===t.EDIT_TEXT){p.setSymbol(new C(T.toJson()));var P=this;this._textSymbolEditor?(this._textSymbolEditor.createForm(p),this._textSymbolEditor.show()):this._options&&this._options.textSymbolEditor?(this._textSymbolEditor=this._options.textSymbolEditor,this._textSymbolEditor.on("symbol-change",function(){P._boxEditor&&P._boxEditor.refresh()})):
N(["../dijit/SymbolEditor"],function(O){if(!P._textSymbolEditor){var X=P._options.textSymbolEditorHolder?a.create("div",null,P._options.textSymbolEditorHolder):a.create("div",null,P._map.root);P._textSymbolEditor=new O({graphic:p},X);O=P._textSymbolEditor.domNode.parentNode.id;n.set(P._textSymbolEditor.domNode,{position:"map_root"===O?"absolute":"relative",left:"map_root"===O?P._map.width/2-100+"px":"5px",top:"20px","z-index":50});P._textSymbolEditor.startup();P._textSymbolEditor.createForm(p);P._textSymbolEditor.show();
P._textSymbolEditor.on("symbol-change",function(){P._boxEditor&&P._boxEditor.refresh()})}})}if((G&t.MOVE)===t.MOVE||(G&t.ROTATE)===t.ROTATE||(G&t.SCALE)===t.SCALE)this._textAnchor=new L(p.geometry,this._options.textAnchorSymbol),this._scratchGL.add(this._textAnchor);return!0}}return!1},_enableMove:function(p){var G=this._map;switch(p.geometry.type){case "point":case "polyline":case "polygon":return this._graphicMover=new q(p,G,this,this._textAnchor),!0}return!1},_enableVertexEditing:function(p){var G=
this._map;switch(p.geometry.type){case "multipoint":case "polyline":case "polygon":return this._vertexEditor=h.create(p,G,this),!0}return!1},_enableBoxEditing:function(p,G,T){var D=this._map,P=p.geometry.type;return"polyline"===P||"polygon"===P||this._isTextPoint?(this._boxEditor=new e(p,D,this,G,T,this._options.uniformScaling,this._isTextPoint),!0):!1},_enableTextEditing:function(p){return this._isTextPoint?(this._textEditor=new r(p,this._map,this),y.connect(this._textEditor,"onEditStart",z.hitch(this,
function(){this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._map.disableKeyboardNavigation();this._disableMove();this._disableBoxEditing()})),!0):!1},_disableMove:function(){var p=this._graphicMover;p&&(p.destroy(),this._graphicMover=null)},_disableVertexEditing:function(){var p=this._vertexEditor;p&&(p.destroy(),this._vertexEditor=null)},_disableBoxEditing:function(){var p=this._boxEditor;p&&(p.destroy(),this._boxEditor=null)},_disableTextEditing:function(){this._textEditor&&
(this._textEditor.destroy(),this._textEditor=null);this._map.enableKeyboardNavigation()},_disableSymbolEditing:function(){this._textSymbolEditor&&this._textSymbolEditor.hide()},_clear:function(){this._disableMove();this._disableVertexEditing();this._disableBoxEditing();this._disableTextEditing();this._disableSymbolEditing();this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._tool=0;this._modified=!1},_mapPanEndHandler:function(){this._refreshMoveables()},
_mapExtentChangeHandler:function(p,G,T){T&&this._refreshMoveables()},_refreshMoveables:function(p){var G=m.filter([this._graphicMover,this._vertexEditor,this._boxEditor],b.isDefined);m.forEach(G,function(T){T.refresh(p)})},_beginOperation:function(p){m.forEach(this._getAffectedTools(p),function(G){G.suspend()})},_endOperation:function(p){m.forEach(this._getAffectedTools(p),function(G){G.resume()})},_getAffectedTools:function(p){var G=[];switch(p){case "MOVE":G=[this._vertexEditor,this._boxEditor];
break;case "VERTICES":G=[this._boxEditor];break;case "BOX":G=[this._vertexEditor]}return G=m.filter(G,b.isDefined)}});z.mixin(t,{MOVE:1,EDIT_VERTICES:2,SCALE:4,ROTATE:8,EDIT_TEXT:16});f("extend-esri")&&z.setObject("toolbars.Edit",t,l);return t})},"esri/toolbars/_Box":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../lang ../geometry/Point ../geometry/Polyline ../symbols/SimpleMarkerSymbol ../geometry/webMercatorUtils ../geometry/jsonUtils ../graphic".split(" "),
function(N,v,z,y,m,c,f,a,n,l,b,u,w,e,q,h,r){N=N(null,{declaredClass:"esri.toolbars._Box",constructor:function(d,x,C,L,t,p,G){this._graphic=d;this._map=x;this._toolbar=C;this._scale=L;this._rotate=t;this._defaultEventArgs={};this._scaleEvent="Scale";this._rotateEvent="Rotate";this._uniformScaling=p;d=C._options;this._markerSymbol=d.boxHandleSymbol;this._lineSymbol=d.boxLineSymbol;this._moveStartHandler=v.hitch(this,this._moveStartHandler);this._firstMoveHandler=v.hitch(this,this._firstMoveHandler);
this._moveStopHandler=v.hitch(this,this._moveStopHandler);this._moveHandler=v.hitch(this,this._moveHandler);this._isTextPoint=G;this._init()},destroy:function(){this._cleanUp();this._graphic=this._map=this._toolbar=this._markerSymbol=this._lineSymbol=null},refresh:function(){this._draw()},suspend:function(){z.forEach(this._getAllGraphics(),function(d){d.hide()})},resume:function(){z.forEach(this._getAllGraphics(),function(d){d.show()});this._draw()},_init:function(){this._draw()},_cleanUp:function(){this._connects&&
z.forEach(this._connects,y.disconnect);var d=this._toolbar._scratchGL;this._anchors&&z.forEach(this._anchors,function(x){d.remove(x.graphic);(x=x.moveable)&&x.destroy()});this._box&&d.remove(this._box);this._box=this._anchors=this._connects=null},_draw:function(){if(this._graphic.getDojoShape()){var d=this._map,x=this._toolbar._scratchGL,C=this._getBoxCoords(),L=new w(d.spatialReference),t=v.clone(z.filter(C,function(p,G){return 8!==G&&0===G%2}));t[0]&&t.push([t[0][0],t[0][1]]);L.addPath(t);this._rotate&&
L.addPath([C[1],C[8]]);this._box?this._box.setGeometry(L):(this._box=new r(L,this._lineSymbol),x.add(this._box));this._anchors?z.forEach(this._anchors,function(p,G){this._scale||(G=8);var T=new u(C[G],d.spatialReference);p.graphic.setGeometry(T);T=p.moveable;var D=p.graphic.getDojoShape();D&&(T?D!==T.shape&&(T.destroy(),p.moveable=this._getMoveable(p.graphic,G)):p.moveable=this._getMoveable(p.graphic,G))},this):(this._anchors=[],this._connects=[],z.forEach(C,function(p,G){!this._scale&&8>G||(p=new u(p,
d.spatialReference),p=new r(p,this._markerSymbol),this._isTextPoint&&1===G%2&&p.hide(),x.add(p),this._anchors.push({graphic:p,moveable:this._getMoveable(p,G)}))},this))}else this._cleanUp()},_getBoxCoords:function(d){var x=this._map,C=[],L,t,p;if(this._isTextPoint){var G=this._graphic.getNode().getBoundingClientRect();var T=x.__container.getBoundingClientRect();G=[{x:G.left-T.left,y:G.top-T.top},{x:G.right-T.left,y:G.top-T.top},{x:G.right-T.left,y:G.bottom-T.top},{x:G.left-T.left,y:G.bottom-T.top}]}else G=
this._getTransformedBoundingBox(this._graphic);z.forEach(G,function(D,P,O){L=D;(t=O[P+1])||(t=O[0]);p={x:(L.x+t.x)/2,y:(L.y+t.y)/2};d||(L=x.toMap(L),p=x.toMap(p));C.push([L.x,L.y]);C.push([p.x,p.y])});this._rotate&&(G=v.clone(C[1]),G=d?{x:G[0],y:G[1]}:x.toScreen({x:G[0],y:G[1],spatialReference:x.spatialReference}),G.y-=this._toolbar._options.rotateHandleOffset,d||(G=x.toMap(G)),C.push([G.x,G.y]));return C},_getTransformedBoundingBox:function(d){var x=this._map,C=d.geometry.getExtent(),L=d.geometry.spatialReference;
d=new u(C.xmin,C.ymax,L);C=new u(C.xmax,C.ymin,L);d=x.toScreen(d);C=x.toScreen(C);return[{x:d.x,y:d.y},{x:C.x,y:d.y},{x:C.x,y:C.y},{x:d.x,y:C.y}]},_getAllGraphics:function(){var d=[this._box];this._anchors&&z.forEach(this._anchors,function(x){d.push(x.graphic)});return d=z.filter(d,b.isDefined)},_getMoveable:function(d,x){var C=d.getDojoShape();if(C)return d=new a(C),d._index=x,this._connects.push(y.connect(d,"onMoveStart",this._moveStartHandler)),this._connects.push(y.connect(d,"onFirstMove",this._firstMoveHandler)),
this._connects.push(y.connect(d,"onMoveStop",this._moveStopHandler)),d.onMove=this._moveHandler,(C=C.getEventSource())&&f.set(C,"cursor",this._toolbar._cursors["box"+x]),d},_moveStartHandler:function(d){this._toolbar["on"+(8===d.host._index?this._rotateEvent:this._scaleEvent)+"Start"](this._graphic)},_firstMoveHandler:function(d){this._toolbar._deactivateScrollWheel();var x=d.host._index,C=this._wrapOffset=d.host.shape._wrapOffsets[0]||0,L=this._graphic.getLayer().getNavigationTransform();d=z.map(this._getBoxCoords(!0),
function(p){return{x:p[0]+C,y:p[1]}});var t=this._isTextPoint?this._map.toScreen(this._graphic.geometry):{x:d[1].x,y:d[3].y};this._centerCoord=n.multiplyPoint(n.invert(L),t);if(8===x)t=n.multiplyPoint(n.invert(L),d[1]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,t)),this._startLine=[this._centerCoord,t],this._moveLine=v.clone(this._startLine);else if(t=n.multiplyPoint(n.invert(L),d[x]),L=n.multiplyPoint(n.invert(L),d[(x+4)%8]),this._isTextPoint&&(this._centerCoord=
this._deNormalizePoint(this._centerCoord,t)),this._firstMoverToAnchor=Math.sqrt((t.x-this._centerCoord.x)*(t.x-this._centerCoord.x)+(t.y-this._centerCoord.y)*(t.y-this._centerCoord.y)),this._startBox=L,this._startBox.width=d[4].x-d[0].x,this._startBox.height=d[4].y-d[0].y,this._moveBox=v.clone(this._startBox),this._xfactor=t.x>L.x?1:-1,this._yfactor=t.y>L.y?1:-1,1===x||5===x)this._xfactor=0;else if(3===x||7===x)this._yfactor=0;this._toolbar._beginOperation("BOX");this._toolbar["on"+(8===x?this._rotateEvent:
this._scaleEvent)+"FirstMove"](this._graphic)},_moveHandler:function(d,x){d=d.host._index;var C=this._defaultEventArgs;C.angle=0;C.scaleX=1;C.scaleY=1;if(8===d){var L=this._startLine;var t=this._moveLine;var p=t[1];p.x+=x.dx;p.y+=x.dy;x=this._getAngle(L,t);this._isTextPoint&&(x+=this._graphic.symbol.angle);t=n.rotategAt(x,L[0]);this._graphic.getDojoShape().setTransform(t);C.transform=t;C.angle=x;C.around=L[0]}else{L=this._startBox;t=this._moveBox;t.width+=x.dx*this._xfactor;t.height+=x.dy*this._yfactor;
this._uniformScaling||this._isTextPoint?(L=t.x+this._xfactor*t.width,t=t.y+this._yfactor*t.height,L=Math.sqrt((L-this._centerCoord.x)*(L-this._centerCoord.x)+(t-this._centerCoord.y)*(t-this._centerCoord.y)),this._scaleRatio=x=p=L/this._firstMoverToAnchor,L=this._centerCoord):(x=t.width/L.width,p=t.height/L.height,L={x:L.x,y:L.y});if(isNaN(x)||Infinity===x||-Infinity===x)x=1;if(isNaN(p)||Infinity===p||-Infinity===p)p=1;t=n.scaleAt(x,p,L);if(this._isTextPoint){var G=n.rotategAt(this._graphic.symbol.angle,
L);this._graphic.getDojoShape().setTransform([G,t])}else this._graphic.getDojoShape().setTransform(t);C.transform=t;C.scaleX=x;C.scaleY=p;C.around=L}this._toolbar["on"+(8===d?this._rotateEvent:this._scaleEvent)](this._graphic,C)},_moveStopHandler:function(d){this._toolbar._activateScrollWheel();var x=this._graphic,C=this._toolbar,L=C._geo?q.geographicToWebMercator(x.geometry):x.geometry,t=L.spatialReference,p=x.getDojoShape(),G=p.getTransform(),T=x.getLayer().getNavigationTransform();this._isTextPoint?
(x=this._graphic.symbol,8===d.host._index?x.angle+=this._getAngle(this._startLine,this._moveLine):x.font.setSize(Math.round(x.font.size*this._scaleRatio*100)/100),this._graphic.setSymbol(x)):(L=L.toJson(),this._updateSegments(L.paths||L.rings,G,T,t),p.setTransform(null),L=h.fromJson(L),x.setGeometry(C._geo?q.webMercatorToGeographic(L,!0):L));this._draw();this._startLine=this._moveLine=this._startBox=this._moveBox=this._xfactor=this._yfactor=null;C._endOperation("BOX");this._defaultEventArgs.transform=
G;C["on"+(8===d.host._index?this._rotateEvent:this._scaleEvent)+"Stop"](this._graphic,this._defaultEventArgs)},_updateSegments:function(d,x,C,L){var t=this._map,p=this._wrapOffset||0;z.forEach(d,function(G){z.forEach(G,function(T){this._updatePoint(T,L,p,n,t,C,x)},this)},this)},_updatePoint:function(d,x,C,L,t,p,G){x=t.toScreen({x:d[0],y:d[1],spatialReference:x},!0);x.x+=C;x=L.multiplyPoint([p,G,L.invert(p)],x);x.x-=C;C=t.toMap(x);d[0]=C.x;d[1]=C.y},_getAngle:function(d,x){return 180*Math.atan2(x[0].y-
x[1].y,x[0].x-x[1].x)/Math.PI-180*Math.atan2(d[0].y-d[1].y,d[0].x-d[1].x)/Math.PI},_deNormalizePoint:function(d,x){var C=this._map._getFrameWidth();if(-1===C)return d;for(d={x:d.x,y:d.y};Math.abs(d.x-x.x)>=C;)d.x=d.x<x.x?d.x+C:d.x-C;var L=Math.abs(d.x-x.x);Math.abs(d.x-x.x+C)<L?d.x+=C:Math.abs(d.x-x.x-C)<L&&(d.x-=C);return d}});c("extend-esri")&&v.setObject("toolbars._Box",N,l);return N})},"dojox/gfx/Moveable":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/_base/event dojo/topic dojo/touch dojo/dom-class dojo/_base/window ./Mover dojo/mouse".split(" "),
function(N,v,z,y,m,c,f,a,n,l){return v("dojox.gfx.Moveable",null,{constructor:function(b,u){this.shape=b;this.delay=u&&0<u.delay?u.delay:0;this.mover=u&&u.mover?u.mover:n;this.leftButtonOnly=u&&u.leftButtonOnly;this.events=[this.shape.on(c.press,N.hitch(this,"onMouseDown"))]},destroy:function(){z.forEach(this.events,function(b){b.remove()});this.events=this.shape=null},onMouseDown:function(b){this.delay?(this.events.push(this.shape.on(c.move,N.hitch(this,"onMouseMove")),this.shape.on(c.release,N.hitch(this,
"onMouseUp"))),this._lastX=b.clientX,this._lastY=b.clientY):this.leftButtonOnly&&!l.isLeft(b)||new this.mover(this.shape,b,this);y.stop(b)},onMouseMove:function(b){var u=b.clientY;if(Math.abs(b.clientX-this._lastX)>this.delay||Math.abs(u-this._lastY)>this.delay)this.onMouseUp(b),new this.mover(this.shape,b,this);y.stop(b)},onMouseUp:function(b){this.events.pop().remove()},onMoveStart:function(b){m.publish("/gfx/move/start",b);f.add(a.body(),"dojoMove")},onMoveStop:function(b){m.publish("/gfx/move/stop",
b);f.remove(a.body(),"dojoMove")},onFirstMove:function(b){},onMove:function(b,u,w){this.onMoving(b,u,w);this.shape.applyLeftTransform(u);this.onMoved(b,u)},onMoving:function(b,u){},onMoved:function(b,u){}})})},"dojox/gfx/Mover":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/on dojo/touch dojo/_base/event".split(" "),function(N,v,z,y,m,c){return z("dojox.gfx.Mover",null,{constructor:function(f,a,n){this.shape=f;this.lastX=a.clientX;this.lastY=a.clientY;f=this.host=n;a=
document;n=y(a,m.move,N.hitch(this,"onFirstMove"));this.events=[y(a,m.move,N.hitch(this,"onMouseMove")),y(a,m.release,N.hitch(this,"destroy")),y(a,"dragstart",N.hitch(c,"stop")),y(a,"selectstart",N.hitch(c,"stop")),n];if(f&&f.onMoveStart)f.onMoveStart(this)},onMouseMove:function(f){var a=f.clientX,n=f.clientY;this.host.onMove(this,{dx:a-this.lastX,dy:n-this.lastY},f);this.lastX=a;this.lastY=n;c.stop(f)},onFirstMove:function(){this.host.onFirstMove(this);this.events.pop().remove()},destroy:function(){v.forEach(this.events,
function(a){a.remove()});var f=this.host;if(f&&f.onMoveStop)f.onMoveStop(this);this.events=this.shape=null}})})},"esri/toolbars/_GraphicMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/dom-style dojox/gfx/Moveable dojox/gfx/Mover dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/webMercatorUtils ../geometry/ScreenPoint ../geometry/Point".split(" "),function(N,v,z,y,m,c,f,a,n,l,b,u,w,e){var q=N(null,{declaredClass:"esri.toolbars._GraphicMover",
constructor:function(h,r,d,x){this.graphic=h;this.map=r;this.toolbar=d;this.tempPt=x;this._enableGraphicMover();this._moved=!1},refresh:function(h){var r=this.graphic.getDojoShape();!r||!h&&r._hostGraphic||(this._disableGraphicMover(),this._enableGraphicMover())},destroy:function(){this._disableGraphicMover()},hasMoved:function(){return this._moved},_enableGraphicMover:function(){var h=this.graphic,r=h.getDojoShape();r&&(r._hostGraphic=h,this._moveable=new c(r,{mover:q.Mover}),this._moveStartHandle=
z.connect(this._moveable,"onMoveStart",this,this._moveStartHandler),this._firstMoveHandle=z.connect(this._moveable,"onFirstMove",this,this._firstMoveHandler),this._movingHandle=z.connect(this._moveable,"onMoving",this,this._movingHandler),this._moveStopHandle=z.connect(this._moveable,"onMoveStop",this,this._moveStopHandler),(h=r.getEventSource())&&m.set(h,"cursor",this.toolbar._cursors.move))},_disableGraphicMover:function(){var h=this._moveable;if(h){z.disconnect(this._moveStartHandle);z.disconnect(this._firstMoveHandle);
z.disconnect(this._movingHandle);z.disconnect(this._moveStopHandle);var r=h.shape;r&&(r._hostGraphic=null,(r=r.getEventSource())&&m.set(r,"cursor","inherit"));h.destroy()}this._moveable=null},_moveStartHandler:function(){var h=this.graphic,r=this.map;this._startTx=h.getDojoShape().getTransform();"point"===this.graphic.geometry.type&&r.snappingManager&&r.snappingManager._setUpSnapping();this.toolbar.onGraphicMoveStart(h)},_firstMoveHandler:function(){this.toolbar._beginOperation("MOVE");this.toolbar.onGraphicFirstMove(this.graphic)},
_movingHandler:function(h,r,d){h=h.shape.getTransform();r=this.map;var x;b("esri-pointer")?x=r.navigationManager.pointerEvents._processTouchEvent(d,d):d&&"pointermove"===d.type&&(x=l.prototype._processTouchEvent.call({map:r},d,d));x&&r.snappingManager&&r.snappingManager._onSnappingMouseMoveHandler(x);this.tempPt&&this.tempPt.getDojoShape().setTransform(h);this.toolbar.onGraphicMove(this.graphic,h)},_moveStopHandler:function(h){var r=this.graphic,d=this.toolbar,x=this.map,C=d._geo?u.geographicToWebMercator(r.geometry):
r.geometry,L=C.type,t=r.getDojoShape(),p=t.getTransform();if(y.toJson(p)!==y.toJson(this._startTx)){this._moved=!0;switch(L){case "point":L=[p,a.invert(this._startTx)];if(x.snappingManager)var G=x.snappingManager._snappingPoint;C=G||x.toMap(a.multiplyPoint(L,x.toScreen(C,!0)));x.snappingManager&&x.snappingManager._killOffSnapping();break;case "polyline":C=this._updatePolyGeometry(C,C.paths,p);break;case "polygon":C=this._updatePolyGeometry(C,C.rings,p)}t.setTransform(null);r.setGeometry(d._geo?u.webMercatorToGeographic(C,
!0):C);this.tempPt&&this.tempPt.setGeometry(new e(r.geometry.toJson()))}else this._moved=!1;d._endOperation("MOVE");d.onGraphicMoveStop(r,p);this._moved||(h=h.__e,x=this.map.position,h=new w(h.pageX-x.x,h.pageY-x.y),d.onGraphicClick(r,{screenPoint:h,mapPoint:this.map.toMap(h)}))},_updatePolyGeometry:function(h,r,d){var x=this.map,C=h.getPoint(0,0);x=x.toMap(x.toScreen(C).offset(d.dx,d.dy));d=x.x-C.x;C=x.y-C.y;var L;for(x=0;x<r.length;x++){var t=r[x];for(L=0;L<t.length;L++){var p=h.getPoint(x,L);h.setPoint(x,
L,p.offset(d,C))}}return h}});q.Mover=N(f,{declaredClass:"esri.toolbars._Mover",constructor:function(h,r,d){this.__e=r}});b("extend-esri")&&(v.setObject("toolbars._GraphicMover",q,n),v.setObject("toolbars._Mover",q.Mover,n));return q})},"esri/toolbars/_VertexEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dijit/Menu dijit/MenuItem ../kernel ./_VertexMover ../geometry/Point ../geometry/jsonUtils dojo/i18n!../nls/jsapi".split(" "),function(N,
v,z,y,m,c,f,a,n,l,b,u){var w=N(null,{declaredClass:"esri.toolbars._GraphicVertexEditor",constructor:function(e,q,h){this.graphic=e;this.map=q;this.toolbar=h;e=h._options;this._symbol1=e.vertexSymbol;this._symbol2=e.ghostVertexSymbol;q=e.ghostLineSymbol;this._lineStroke={style:q.style,width:q.width,color:q.color};this._canDel=e.allowDeleteVertices;this._canAdd=e.allowAddVertices;this._addControllers()},destroy:function(){this._removeControllers()},refresh:function(e){e?(this._removeControllers(),this._addControllers()):
(this._refresh(this._vertexMovers),this._refresh(this._mpVertexMovers))},suspend:function(){this._suspended||this._removeControllers();this._suspended=!0},resume:function(){this._suspended&&this._addControllers();this._suspended=!1},_addControllers:function(){this._firstMoveHandle=z.connect(n,"onFirstMove",this,this._firstMoveHandler);this._moveStopHandle=z.connect(n,"onMoveStop",this,this._moveStopHandler);this._vertexMovers=this._add(this._getSegments(this.graphic.geometry),this._symbol1);this._canAdd&&
(this._mpVertexMovers=this._add(this._getMidpointSegments(this.graphic.geometry),this._symbol2,!0));var e=this._getGraphicsLayer();this._mouseOverHandle=z.connect(e,"onMouseOver",this,this._mouseOverHandler);this._mouseOutHandle=z.connect(e,"onMouseOut",this,this._mouseOutHandler);this._canDel&&(this._ctxMenu=new c({style:"font-size: 12px; margin-left: 5px; margin-top: 5px;"}),e=this._ctxDelete=new f({label:u.toolbars.edit.deleteLabel,iconClass:"vertexDeleteIcon",style:"outline: none;"}),this._deleteHandle=
z.connect(e,"onClick",this,this._deleteHandler),this._ctxMenu.addChild(e),this._ctxMenu.startup())},_removeControllers:function(){z.disconnect(this._firstMoveHandle);z.disconnect(this._moveStopHandle);z.disconnect(this._mouseOverHandle);z.disconnect(this._mouseOutHandle);z.disconnect(this._deleteHandle);this._ctxMenu&&(this._ctxDelete=null,this._unbindCtxNode(),this._ctxMenu.destroyRecursive());this._remove(this._vertexMovers);this._remove(this._mpVertexMovers);this._vertexMovers=this._mpVertexMovers=
null},_add:function(e,q,h){var r,d,x=this.graphic,C=[];for(r=0;r<e.length;r++){var L=e[r],t=[];for(d=0;d<L.length;d++)t.push(new n(L[d],q,x,r,d,L.length,this,h));C.push(t)}return C},_remove:function(e){e&&y.forEach(e,function(q){y.forEach(q,function(h){h.destroy()})})},_refresh:function(e){e&&y.forEach(e,function(q){y.forEach(q,function(h){h.refresh()})})},_isNew:function(e){return-1===y.indexOf(this._vertexMovers[e.segIndex],e)?!0:!1},_getGraphicsLayer:function(){return this.toolbar._scratchGL},
_deleteHandler:function(e){e=this._selectedMover;this._updateRelatedGraphic(e,e.relatedGraphic,e.graphic.geometry,e.segIndex,e.ptIndex,e.segLength,!1,!0);this._canAdd&&this._deleteMidpoints(e);this._deleteVertex(e);this.toolbar._endOperation("VERTICES")},_mouseOverHandler:function(e){e=e.graphic;var q=this._findMover(e);q&&(this.toolbar.onVertexMouseOver(this.graphic,q._getInfo()),q._placeholder||(this._selectedMover=q,this._canDel&&this._bindCtxNode(e.getDojoShape().getNode())))},_mouseOutHandler:function(e){if(e=
this._findMover(e.graphic))this.toolbar.onVertexMouseOut(this.graphic,e._getInfo())},_bindCtxNode:function(e){this._unbindCtxNode();this._ctxDelete.set("disabled",this._selectedMover.segLength<=this.minLength?!0:!1);this._ctxMenu.bindDomNode(e);this._bindNode=e},_unbindCtxNode:function(){var e=this._bindNode;e&&this._ctxMenu.unBindDomNode(e)},_findMover:function(e){var q=[];var h=this._mpVertexMovers;y.forEach(this._vertexMovers,function(d){q=q.concat(d)});h&&y.forEach(h,function(d){q=q.concat(d)});
for(h=0;h<q.length;h++){var r=q[h];if(r.graphic===e)return r}},_firstMoveHandler:function(e){!this._isNew(e)&&this._canAdd&&this._hideRelatedMidpoints(e);this.toolbar._beginOperation("VERTICES")},_moveStopHandler:function(e,q){var h=this._isNew(e);q&&(q.dx||q.dy)?(this._updateRelatedGraphic(e,e.relatedGraphic,e.graphic.geometry,e.segIndex,e.ptIndex,e.segLength,h),this._canAdd&&(h?this._addMidpoints(e):(this._repositionRelatedMidpoints(e),this._showRelatedMidpoints(e))),this.toolbar._endOperation("VERTICES")):
!h&&this._canAdd&&this._showRelatedMidpoints(e)},_showRelatedMidpoints:function(e){var q=this._getAdjacentMidpoints(e.ptIndex,e.segLength),h=this._mpVertexMovers[e.segIndex];for(e=0;e<q.length;e++){var r=h[q[e]];r.graphic.show();r.refresh()}},_hideRelatedMidpoints:function(e){var q=this._getAdjacentMidpoints(e.ptIndex,e.segLength),h=this._mpVertexMovers[e.segIndex];for(e=0;e<q.length;e++)h[q[e]].graphic.hide()},_repositionRelatedMidpoints:function(e){var q,h=this._getAdjacentMidpoints(e.ptIndex,e.segLength),
r=this._mpVertexMovers[e.segIndex];for(q=0;q<h.length;q++){var d=this._getAdjacentVertices(h[q],e.segLength),x=e.relatedGraphic.geometry.getPoint(e.segIndex,d[0]);d=e.relatedGraphic.geometry.getPoint(e.segIndex,d[1]);x=new l({x:(x.x+d.x)/2,y:(x.y+d.y)/2,spatialReference:x.spatialReference.toJson()});r[h[q]].graphic.setGeometry(x)}},_addMidpoints:function(e){var q=e.segIndex,h=e.ptIndex,r=e.segLength,d=h+1,x,C=r+1;this._mpVertexMovers[q].splice(h,1);var L=this._vertexMovers[q];for(x=0;x<d;x++)L[x].segLength+=
1;for(x=d;x<L.length;x++)L[x].ptIndex+=1,L[x].segLength+=1;e.ptIndex=d;e.segLength=L.length+1;L.splice(d,0,e);e.graphic.setSymbol(this._symbol1);L=this._mpVertexMovers[q];for(x=0;x<h;x++)L[x].segLength+=1;for(x=h;x<r-1;x++)L[x].ptIndex+=1,L[x].segLength+=1;d=this._getAdjacentVertices(h,C);q=this._getAdjacentVertices(h+1,C);r=e.relatedGraphic.geometry.getPoint(e.segIndex,d[0]);x=e.relatedGraphic.geometry.getPoint(e.segIndex,d[1]);d=new l({x:(r.x+x.x)/2,y:(r.y+x.y)/2,spatialReference:r.spatialReference.toJson()});
r=e.relatedGraphic.geometry.getPoint(e.segIndex,q[0]);x=e.relatedGraphic.geometry.getPoint(e.segIndex,q[1]);q=new l({x:(r.x+x.x)/2,y:(r.y+x.y)/2,spatialReference:r.spatialReference.toJson()});r=new n(d,this._symbol2,this.graphic,e.segIndex,h,C,this,!0);e=new n(q,this._symbol2,this.graphic,e.segIndex,h+1,C,this,!0);L.splice(h,0,r,e)},_deleteVertex:function(e){var q,h=e.ptIndex,r=this._vertexMovers[e.segIndex];for(q=0;q<h;q++)--r[q].segLength;for(q=h+1;q<r.length;q++){var d=r[q];--d.ptIndex;--d.segLength}r.splice(h,
1);q=e._getInfo();e.destroy();this.toolbar.onVertexDelete(this.graphic,q)}});v.mixin(w,{create:function(e,q,h){switch(e.geometry.type){case "multipoint":return new w.MultipointVertexEditor(e,q,h);case "polyline":return new w.PolylineVertexEditor(e,q,h);case "polygon":return new w.PolygonVertexEditor(e,q,h)}}});w.MultipointVertexEditor=N(w,{declaredClass:"esri.toolbars._MultipointVertexEditor",minLength:1,constructor:function(){this._moveStartHandle=z.connect(n,"onMoveStart",this,this._moveStartHandler);
z.disconnect(this._firstMoveHandle)},destroy:function(){this.inherited(arguments);z.disconnect(this._moveStartHandle)},_getSegments:function(e){var q=e.points,h=[],r=e.spatialReference;for(e=0;e<q.length;e++){var d=q[e];h.push(new l({x:d[0],y:d[1],spatialReference:r.toJson()}))}return[h]},_getMidpointSegments:function(e){return[]},_getControlPoints:function(e,q,h,r,d){return[]},_getGraphicsLayer:function(){return this.graphic._graphicsLayer},_mouseOverHandler:function(e){var q=e.graphic;if(e=this._findMover(e))this.toolbar.onVertexMouseOver(q,
e._getInfo()),this._selectedMover=e,this._canDel&&this._bindCtxNode(e.graphic.getDojoShape().getNode())},_mouseOutHandler:function(e){var q=e.graphic;if(e=this._findMover(e))this.toolbar.onVertexMouseOut(q,e._getInfo())},_findMover:function(e){var q=[].concat(this._vertexMovers[0]),h=e.target;for(e=0;e<q.length;e++){var r=q[e];if(r.graphic.getDojoShape().getNode()===h)return r}},_moveStartHandler:function(e){var q=e.ptIndex,h=e.segLength-1,r=e.relatedGraphic.geometry.points;e=r.splice(q,1);r.push(e[0]);
r=this._vertexMovers[0];for(e=h;e>q;e--)--r[e].ptIndex;e=r.splice(q,1);r.push(e[0]);e[0].ptIndex=h},_moveStopHandler:function(e){this._updateRelatedGraphic(e,e.relatedGraphic,e.graphic.geometry,e.segIndex,e.ptIndex,e.segLength);this.toolbar._endOperation("VERTICES")},_updateRelatedGraphic:function(e,q,h,r,d,x,C,L){e=q.geometry;L?e.removePoint(d):e.setPoint(d,h);q.setGeometry(e)},_deleteMidpoints:function(e){}});w.PolylineVertexEditor=N(w,{declaredClass:"esri.toolbars._PolylineVertexEditor",minLength:2,
_getSegments:function(e){var q,h,r=e.paths,d=[];for(q=0;q<r.length;q++){var x=r[q],C=[];for(h=0;h<x.length;h++)C.push(e.getPoint(q,h));d.push(C)}return d},_getMidpointSegments:function(e){var q,h,r=e.paths,d=[],x=e.spatialReference;for(q=0;q<r.length;q++){var C=r[q],L=[];for(h=0;h<C.length-1;h++){var t=e.getPoint(q,h),p=e.getPoint(q,h+1);t=new l({x:(t.x+p.x)/2,y:(t.y+p.y)/2,spatialReference:x.toJson()});L.push(t)}d.push(L)}return d},_getControlPoints:function(e,q,h,r,d){var x=this.map,C,L;this._isNew(e)?
(e=r,r+=1,0<=e&&(C=x.toScreen(q.getPoint(h,e))),r<=d&&(L=x.toScreen(q.getPoint(h,r)))):(e=r-1,r+=1,0<=e&&(C=x.toScreen(q.getPoint(h,e))),r<d&&(L=x.toScreen(q.getPoint(h,r))));return[C,L]},_getAdjacentMidpoints:function(e,q){var h=[],r=e-1;0<=r&&h.push(r);e<q-1&&h.push(e);return h},_getAdjacentVertices:function(e,q){return[e,e+1]},_deleteMidpoints:function(e){var q=this._mpVertexMovers[e.segIndex],h=q.length-1,r=this._getAdjacentMidpoints(e.ptIndex,e.segLength).sort(),d,x=r[0];for(d=0;d<x;d++)--q[d].segLength;
for(d=x+1;d<q.length;d++){var C=q[d];--C.ptIndex;--C.segLength}if(1===r.length)q.splice(x,1)[0].destroy();else for(C=this._getAdjacentVertices(x,h),d=e.relatedGraphic.geometry.getPoint(e.segIndex,C[0]),C=e.relatedGraphic.geometry.getPoint(e.segIndex,C[1]),d=new l({x:(d.x+C.x)/2,y:(d.y+C.y)/2,spatialReference:d.spatialReference.toJson()}),e=new n(d,this._symbol2,this.graphic,e.segIndex,x,h,this,!0),q=q.splice(x,r.length,e),d=0;d<q.length;d++)q[d].destroy()},_updateRelatedGraphic:function(e,q,h,r,d,
x,C,L){e=q.geometry;C?e.insertPoint(r,d+1,b.fromJson(h.toJson())):L?e.removePoint(r,d):e.setPoint(r,d,b.fromJson(h.toJson()));q.setGeometry(e)}});w.PolygonVertexEditor=N(w,{declaredClass:"esri.toolbars._PolygonVertexEditor",minLength:3,_getSegments:function(e){var q,h,r=e.rings,d=[];for(q=0;q<r.length;q++){var x=r[q],C=[];for(h=0;h<x.length-1;h++)C.push(e.getPoint(q,h));d.push(C)}return d},_getMidpointSegments:function(e){var q,h,r=e.rings,d=[],x=e.spatialReference;for(q=0;q<r.length;q++){var C=r[q],
L=[];for(h=0;h<C.length-1;h++){var t=e.getPoint(q,h),p=e.getPoint(q,h+1);t=new l({x:(t.x+p.x)/2,y:(t.y+p.y)/2,spatialReference:x.toJson()});L.push(t)}d.push(L)}return d},_getControlPoints:function(e,q,h,r,d){var x=this.map;this._isNew(e)?e=r:(e=r-1,e=0>e?(d+e)%d:e);r=(r+1)%d;d=x.toScreen(q.getPoint(h,e));q=x.toScreen(q.getPoint(h,r));return[d,q]},_getAdjacentMidpoints:function(e,q){var h=e-1;return[0>h?(q+h)%q:h,e]},_getAdjacentVertices:function(e,q){return[e,(e+1)%q]},_deleteMidpoints:function(e){var q=
e.ptIndex,h=this._mpVertexMovers[e.segIndex],r=h.length-1,d=this._getAdjacentMidpoints(q,e.segLength).sort();var x=d[0];var C=d[d.length-1];if(0===q){var L=this._getAdjacentVertices(r-1,r);q=e.relatedGraphic.geometry.getPoint(e.segIndex,L[0]);L=e.relatedGraphic.geometry.getPoint(e.segIndex,L[1]);q=new l({x:(q.x+L.x)/2,y:(q.y+L.y)/2,spatialReference:q.spatialReference.toJson()});e=new n(q,this._symbol2,this.graphic,e.segIndex,r-1,r,this,!0);h.splice(C,1,e)[0].destroy();h.splice(x,1)[0].destroy();for(d=
0;d<h.length-1;d++)x=h[d],--x.ptIndex,--x.segLength}else{L=this._getAdjacentVertices(x,r);q=e.relatedGraphic.geometry.getPoint(e.segIndex,L[0]);L=e.relatedGraphic.geometry.getPoint(e.segIndex,L[1]);q=new l({x:(q.x+L.x)/2,y:(q.y+L.y)/2,spatialReference:q.spatialReference.toJson()});e=new n(q,this._symbol2,this.graphic,e.segIndex,x,r,this,!0);C=h.splice(x,d.length,e);for(d=0;d<C.length;d++)C[d].destroy();for(d=0;d<x;d++)--h[d].segLength;for(d=x+1;d<h.length;d++)x=h[d],--x.ptIndex,--x.segLength}},_updateRelatedGraphic:function(e,
q,h,r,d,x,C,L){e=q.geometry;C?e.insertPoint(r,d+1,b.fromJson(h.toJson())):L?(e.removePoint(r,d),0===d&&e.setPoint(r,x-1,b.fromJson(e.getPoint(r,0).toJson()))):(e.setPoint(r,d,b.fromJson(h.toJson())),0===d&&e.setPoint(r,x,b.fromJson(h.toJson())));q.setGeometry(e)}});m("extend-esri")&&(v.setObject("toolbars._GraphicVertexEditor",w,a),v.setObject("toolbars._MultipointVertexEditor",w.MultipointVertexEditor,a),v.setObject("toolbars._PolylineVertexEditor",w.PolylineVertexEditor,a),v.setObject("toolbars._PolygonVertexEditor",
w.PolygonVertexEditor,a));return w})},"esri/toolbars/_VertexMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/sniff dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/Point ../graphic ../geometry/webMercatorUtils".split(" "),function(N,v,z,y,m,c,f,a,n,l,b,u,w){N=N(null,{declaredClass:"esri.toolbars.VertexMover",constructor:function(e,q,h,r,d,x,C,L){this.point=e;this.symbol=q;this.relatedGraphic=h;this.segIndex=r;this.ptIndex=
d;this.segLength=x;this.editor=C;this.map=C.map;this._scratchGL=C.toolbar._scratchGL;this._placeholder=L||!1;this._type=h.geometry.type;this._init();this._enable()},refresh:function(e){if(e||this._needRefresh())this._disable(),this._enable()},destroy:function(){this._disable();this.graphic&&this._scratchGL.remove(this.graphic);this.point=this.symbol=this.graphic=this.relatedGraphic=this.segIndex=this.ptIndex=this.segLength=this.editor=this.map=this._scratchGL=null},_init:function(){var e=new b(this.point.toJson());
e=new u(e,this.symbol);switch(this._type){case "multipoint":e._shape=this.relatedGraphic.getDojoShape().children[this.ptIndex];break;case "polyline":case "polygon":this._scratchGL.add(e)}this.graphic=e},_enable:function(){var e=this.graphic.getDojoShape();e&&(e._hasMover=!0,this._moveable=this._getMoveable(e),(e=e.getEventSource())&&m.set(e,"cursor",this.editor.toolbar._cursors[this._placeholder?"move-gv":"move-v"]))},_disable:function(){var e=this._moveable;if(e){z.disconnect(this._startHandle);
z.disconnect(this._firstHandle);z.disconnect(this._movingHandle);z.disconnect(this._stopHandle);var q=e.shape;q&&(q=q.getEventSource())&&m.set(q,"cursor","inherit");e.destroy();this._moveable=null}},_needRefresh:function(){var e=this.graphic.getDojoShape(),q=!1;if(e)switch(this._type){case "multipoint":var h=this.relatedGraphic.getDojoShape();h&&(h=h.children[this.ptIndex],e!==h&&(this.graphic._shape=h,q=!0));break;case "polyline":case "polygon":q=!e._hasMover}return q},_getMoveable:function(e){e=
new c(e,y("mac")&&y("ff")&&!l("esri-touch")&&{leftButtonOnly:!0});this._startHandle=z.connect(e,"onMoveStart",this,this._moveStartHandler);this._firstHandle=z.connect(e,"onFirstMove",this,this._firstMoveHandler);this._movingHandle=z.connect(e,"onMoving",this,this._movingHandler);this._stopHandle=z.connect(e,"onMoveStop",this,this._moveStopHandler);return e},_getPtIndex:function(){return this.ptIndex+(this._placeholder?1:0)},_getInfo:function(){return{graphic:this.graphic,isGhost:this._placeholder,
segmentIndex:this.segIndex,pointIndex:this._getPtIndex()}},_moveStartHandler:function(e){var q=this.map;q.snappingManager&&q.snappingManager._setUpSnapping();this.editor.toolbar._deactivateScrollWheel();this._startTx=this.graphic.getDojoShape().getTransform();e.shape.moveToFront();this.constructor.onMoveStart(this);this.editor.toolbar.onVertexMoveStart(this.relatedGraphic,this._getInfo())},_firstMoveHandler:function(e){var q=e.shape,h=this._getControlEdges(),r=this._scratchGL._div,d,x=[],C=e.host.shape._wrapOffsets[0]||
0;for(d=0;d<h.length;d++){var L=h[d];L.x1+=C;L.x2+=C;x.push([r.createLine({x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2}).setStroke(this.editor._lineStroke),L.x1,L.y1,L.x2,L.y2])}q._lines=x;e.shape.moveToFront();this.constructor.onFirstMove(this);this.editor.toolbar.onVertexFirstMove(this.relatedGraphic,this._getInfo())},_movingHandler:function(e,q,h){q=this.map;var r;l("esri-pointer")?r=q.navigationManager.pointerEvents._processTouchEvent(h,h):h&&"pointermove"===h.type&&(r=n.prototype._processTouchEvent.call({map:q},
h,h));r&&q.snappingManager&&q.snappingManager._onSnappingMouseMoveHandler(r);h=e.shape;e=h.getTransform();h=h._lines;for(r=0;r<h.length;r++)q=h[r],q[0].setShape({x1:q[1]+e.dx,y1:q[2]+e.dy,x2:q[3],y2:q[4]});this.editor.toolbar.onVertexMove(this.relatedGraphic,this._getInfo(),e)},_moveStopHandler:function(e){e=e.shape;var q=this.editor.toolbar,h=e.getTransform(),r=this.map,d=this.graphic,x=q._geo?w.geographicToWebMercator(d.geometry):d.geometry;q._activateScrollWheel();var C,L=e._lines;if(L){for(C=
0;C<L.length;C++)L[C][0].removeShape();e._lines=null}C=!1;L=!0;var t=this._getInfo();h&&(h.dx||h.dy)?this._placeholder&&(this._placeholder=!1,C=!0):L=!1;if(r.snappingManager)var p=r.snappingManager._snappingPoint;var G=[h,f.invert(this._startTx)];p=p||r.toMap(f.multiplyPoint(G,r.toScreen(x,!0)));r.snappingManager&&r.snappingManager._killOffSnapping();e.setTransform(null);d.setGeometry(q._geo?w.webMercatorToGeographic(p,!0):p);this.constructor.onMoveStop(this,h);q.onVertexMoveStop(this.relatedGraphic,
t,h);if(!L)q.onVertexClick(this.relatedGraphic,t);if(C)q.onVertexAdd(this.relatedGraphic,this._getInfo())},_getControlEdges:function(){var e=this.map,q=this.relatedGraphic.geometry,h=this.segIndex,r=this.ptIndex,d=this.segLength,x=this._scratchGL.getNavigationTransform(),C=x.dx;x=x.dy;var L=e.toScreen(this.graphic.geometry);e=L.x-C;L=L.y-x;var t=[];q=this.editor._getControlPoints(this,q,h,r,d);q[0]&&t.push({x1:e,y1:L,x2:q[0].x-C,y2:q[0].y-x});q[1]&&t.push({x1:e,y1:L,x2:q[1].x-C,y2:q[1].y-x});return t}});
l("extend-esri")&&v.setObject("toolbars.VertexMover",N,a);v.mixin(N,{onMoveStart:function(){},onFirstMove:function(){},onMoveStop:function(){}});return N})},"esri/toolbars/TextEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/has dojo/dom-construct dojo/dom-class dojo/dom-style dojo/keys ../kernel".split(" "),function(N,v,z,y,m,c,f,a,n,l){N=N(null,{declaredClass:"esri.toolbars.TextEditor",constructor:function(b,u,w){this._graphic=b;this._map=u;
this._toolbar=w;this._enable(this._graphic)},destroy:function(){this._disable()},onEditStart:function(){},onEditEnd:function(){},_enable:function(b){this._editBox?(z.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null):(this._map.navigationManager.setImmediateClick(!0),this._addEditBoxHandler=z.connect(b.getLayer(),"onDblClick",this,function(u){this._map.navigationManager.setImmediateClick(!1);u.graphic==b&&(y.stop(u),z.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null,
this._addTextBox(b))}))},_disable:function(){this._applyEdit();this._addEditBoxHandler&&(z.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null);this._removeTextBox();this.onEditEnd(this._graphic);this._toolbar.onTextEditEnd(this._graphic)},_addTextBox:function(b,u){if(!this._editBox){if(!b.symbol.text){b.symbol.text="Tempt text";b.setSymbol(b.symbol);var w=""}var e=this._createInputTextStyle(b,this._map);""!==w&&(w=u||b.symbol.text);this._editBox=c.create("input",{type:"text",value:w});
a.set(this._editBox,e);f.add(this._editBox,"esriTextEditorInput");this._map.container.appendChild(this._editBox);this._editBox.focus();this._editBoxKeyHandler=z.connect(this._editBox,"onkeyup",v.hitch(this,function(h){h.keyCode!=n.ENTER&&h.keyCode!==n.TAB||this._disable()}));this._editBoxBlurHandler=z.connect(this._editBox,"onblur",v.hitch(this,function(h){this._disable()}));b.symbol.text="";b.setSymbol(b.symbol);b.hide();var q=this._editBox;this._disableBoxHandler||(this._disableBoxHandler=this._map.on("zoom-start",
v.hitch(this,function(){this._disable()})));this._moveBoxHandler=this._map.on("pan",function(h){a.set(q,{left:this._editBoxLeft+h.delta.x+"px",top:this._editBoxTop+h.delta.y+"px"})});this._moveBoxStartHandler=this._map.on("pan-start",function(){this._editBoxLeft=parseFloat(a.get(q,"left"));this._editBoxTop=parseFloat(a.get(q,"top"))});this.onEditStart(b,this._editBox);this._toolbar.onTextEditStart(b,this._editBox)}},_removeTextBox:function(){this._editBoxBlurHandler&&(z.disconnect(this._editBoxBlurHandler),
this._editBoxBlurHandler=null);this._editBox&&(this._editBox.parentNode.removeChild(this._editBox),this._editBox=null);this._disableBoxHandler&&(this._disableBoxHandler.remove(),this._disableBoxHandler=null);this._moveBoxHandler&&(this._moveBoxHandler.remove(),this._moveBoxHandler=null);this._moveBoxStartHandler&&(this._moveBoxStartHandler.remove(),this._moveBoxStartHandler=null);this._editBoxKeyHandler&&(z.disconnect(this._editBoxKeyHandler),this._editBoxKeyHandler=null)},_createInputTextStyle:function(b,
u){u=b.getDojoShape().getTransformedBoundingBox();var w=b.getLayer();w=w.hasLocalNavigationTransform()?{dx:0,dy:0}:w.getNavigationTransform();var e=b.symbol.font;return{"font-family":e.family,"font-size":e.size+"px","font-style":e.style,"font-variant":e.variant,"font-weight":e.weight,left:u[0].x+w.dx+"px",top:u[0].y+w.dy+"px",width:Math.abs(u[0].x-u[1].x)/Math.cos(b.symbol.angle/180*Math.PI)+"px"}},_applyEdit:function(){if(this._editBox)if(this._editBox.value){this._graphic.show();var b=this._graphic.symbol;
b.text=this._editBox.value;this._graphic.setSymbol(b)}else this._graphic.getLayer().remove(this._graphic)}});m("extend-esri")&&v.setObject("toolbars.TextEditor",N,l);return N})},"esri/dijit/AttributeInspector":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/sniff dojo/_base/kernel dojo/has dojo/dom-style dojo/dom-construct ../kernel ../lang ../domUtils ../layers/InheritedDomain ../layers/FeatureLayer dojo/i18n!../nls/jsapi dojo/fx dojox/gfx dijit/_Widget dijit/_Templated dijit/Editor dijit/_editor/plugins/LinkDialog dijit/_editor/plugins/TextColor ./_EventedWidget ./editing/AttachmentEditor ./editing/Util ../tasks/query dijit/form/DateTextBox dijit/form/TextBox dijit/form/NumberTextBox dijit/form/FilteringSelect dijit/form/NumberSpinner dijit/form/Button dijit/form/SimpleTextarea dijit/form/ValidationTextBox dijit/form/TimeTextBox dijit/Tooltip dojo/data/ItemFileReadStore dojox/date/islamic dojox/date/islamic/Date dojox/date/islamic/locale dojo/text!./templates/AttributeInspector.html".split(" "),
function(N,v,z,y,m,c,f,a,n,l,b,u,w,e,q,h,r,d,x,C,L,t,p,G,T,D,P,O,X,H,g,B,A,I,M,R,S,W,V,k,F){var K=N([p,d,x],{declaredClass:"esri.dijit.AttributeInspector",widgetsInTemplate:!0,templateString:F,onUpdate:function(){},onDelete:function(){},onAttributeChange:function(){},onNext:function(){},onReset:function(){},onCancel:function(){},_navMessage:"( ${idx} ${of} ${numFeatures} )",_currentAttributeFieldName:null,_aiConnects:[],_selection:[],_toolTips:[],_numFeatures:0,_featureIdx:0,_currentLInfo:null,_currentFeature:null,
_rollbackInfo:null,_eventMap:{update:!0,"delete":["feature"],"attribute-change":["feature","fieldName","fieldValue"],next:["feature"],reset:!0,cancel:!0},_defaultRichTextPlugins:"bold italic underline foreColor hiliteColor | justifyLeft justifyCenter justifyRight justifyFull | insertOrderedList insertUnorderedList indent outdent | createLink".split(" "),css:{label:"atiLabel",field:"atiField",textArea:"atiTextAreaField",richText:"atiRichTextField",attachmentEditor:"atiAttachmentEditor",red:"atiRequiredField"},
constructor:function(E,J){v.mixin(this,q.widgets.attributeInspector);E=E||{};E.featureLayer||E.layerInfos||console.error("esri.AttributeInspector: please provide correct parameter in the constructor");this._datePackage=this._getDatePackage(E);this._layerInfos=E.layerInfos||[{featureLayer:E.featureLayer,options:E.options||[]}];this._layerInfos=z.filter(this._layerInfos,function(Q){return!Q.disableAttributeUpdate});this._hideNavButtons=E.hideNavButtons||!1},postCreate:function(){if(z.every(this._layerInfos,
function(J){return J.featureLayer.loaded}))this._initLayerInfos(),this._createAttachmentEditor(),this.onFirstFeature();else{var E=this._layerInfos.length;z.forEach(this._layerInfos,function(J){J=J.featureLayer;if(J.loaded)E--;else var Q=y.connect(J,"onLoad",this,function(U){y.disconnect(Q);Q=null;E--;E||(this._initLayerInfos(),this._createAttachmentEditor(),this.onFirstFeature())})},this)}},destroy:function(){this._destroyAttributeTable();z.forEach(this._aiConnects,y.disconnect);delete this._aiConnects;
this._attachmentEditor&&(this._attachmentEditor.destroy(),delete this._attachmentEditor);delete this._layerInfos;this._selection=this._currentFeature=this._currentLInfo=this._attributes=this._layerInfos=null;this.inherited(arguments)},refresh:function(){this._updateSelection()},first:function(){this.onFirstFeature()},last:function(){this.onLastFeature()},next:function(){this.onNextFeature()},previous:function(){this.onPreviousFeature()},showFeature:function(E,J){J&&(this._createOnlyFirstTime=!0);
this._updateSelection([E],J);this._updateUI()},onLayerSelectionChange:function(E,J,Q){this._createOnlyFirstTime=!1;this._featureIdx=Q===e.SELECTION_NEW?0:this._featureIdx;this._updateSelection();this._updateUI()},onLayerSelectionClear:function(){!this._selection||0>=this._selection.length||(this._featureIdx=this._numFeatures=0,this._selection=[],this._currentLInfo=this._currentFeature=null,this._updateUI())},onLayerUpdateEnd:function(E,J,Q,U){},onLayerError:function(E,J,Q,U){},onLayerEditsError:function(E,
J,Q,U){},onLayerEditsComplete:function(E,J,Q,U){U=U||[];if(U.length){var Y=this._selection,Z=E.featureLayer.objectIdField;z.forEach(U,v.hitch(this,function(ca){z.some(Y,v.hitch(this,function(ba,da){if(ba.attributes[Z]!==ca.objectId)return!1;this._selection.splice(da,1);return!0}))}))}J=J||[];J.length&&(this._selection=T.findFeatures(J,E.featureLayer),this._featureIdx=0);U=this._numFeatures=(this._selection=T.sortFeaturesById(this._layerInfos,this._selection))?this._selection.length:0;if(J.length){if(J=
U?this._selection[this._featureIdx]:null)U=J.getLayer().getEditCapabilities(),U.canCreate&&!U.canUpdate||this._showFeature(J);this._updateUI()}Q=Q||[];if(Q.length){var aa=this._rollbackInfo;z.forEach(Q,function(ca){var ba=T.findFeatures(Q,E.featureLayer)[0];if(!ca.success&&ba.attributes[E.featureLayer.objectIdField]===ca.objectId&&aa){var da=aa.field;ca=aa.graphic.attributes[da.name];var ea=z.filter(this._currentLInfo.fieldInfos,function(fa){return fa.fieldName===da.name},this)[0].dijit;ba.attributes[da.name]=
ca;"esriFieldTypeDate"===da.type&&(ca=new Date(ca));this._setValue(ea,ca)}},this)}this._rollbackInfo=null},onFieldValueChange:function(E,J){var Q=E.field,U=E.dijit,Y=this._currentFeature,Z=this._currentLInfo,aa=Q.name;E=this._isFieldRequired(Q,E);if(""===U.displayedValue||"dijit.form.ValidationTextBox"!==U.declaredClass||U.isValid())if(""!==U.displayedValue&&U.displayedValue!==J&&U.isValid&&!U.isValid())this._setValue(U,Y.attributes[Q.name]);else{var ca=!("esriFieldTypeInteger"!==Q.type&&"esriFieldTypeSmallInteger"!==
Q.type&&"esriFieldTypeSingle"!==Q.type&&"esriFieldTypeDouble"!==Q.type);if(E&&(null===J||""===J||"undefined"===typeof J||ca&&isNaN(J))){aa=Y.attributes[Q.name];if("esriFieldTypeDate"===Q.type&&(aa=new Date(aa),U instanceof Array)){this._setValue(U[0],aa);this._setValue(U[1],aa);return}this._setValue(U,aa)}else{if(ca){if(isNaN(J)||""===J)J=null;ca&&null!==J&&(J=Number(J))}"esriFieldTypeDate"===Q.type&&(U instanceof Array?(J=U[0].getValue(),U=U[1].getValue(),J=J&&U?new Date(J.getFullYear(),J.getMonth(),
J.getDate(),U.getHours(),U.getMinutes(),U.getSeconds(),U.getMilliseconds()):J||U||null):(J=U.getValue(),Q.domain&&(J=Number(J))),J=J&&J.getTime?J.getTime():J&&J.toGregorian?J.toGregorian().getTime():J);if(this._currentFeature.attributes[Q.name]!==J){if(aa===Z.typeIdField){var ba=this._findFirst(Z.types,"id",J);z.forEach(Z.fieldInfos,function(da){(Q=da.field)&&Q.name!==Z.typeIdField&&(da=da.dijit,this._setFieldDomain(da,ba,Q)&&da&&(this._setValue(da,Y.attributes[Q.name]+""),!1===da.isValid()&&this._setValue(da,
null)))},this)}this.onAttributeChange(Y,aa,J)}}}else this._setValue(U,Y.attributes[Q.name])},onDeleteBtn:function(E){this._deleteFeature()},onNextFeature:function(E){this._onNextFeature(1)},onPreviousFeature:function(E){this._onNextFeature(-1)},onFirstFeature:function(E){this._onNextFeature(-1*this._featureIdx)},onLastFeature:function(E){this._onNextFeature(this._numFeatures-1-this._featureIdx)},_initLayerInfos:function(){var E=this._layerInfos;this._editorTrackingInfos={};z.forEach(E,this._initLayerInfo,
this)},_initLayerInfo:function(E){var J=E.featureLayer,Q;this._userIds={};var U=J.id;J.credential&&(this._userIds[U]=J.credential.userId);E.userId&&(this._userIds[U]=E.userId);this._connect(J,"onSelectionComplete",v.hitch(this,"onLayerSelectionChange",E));this._connect(J,"onSelectionClear",v.hitch(this,"onLayerSelectionClear",E));this._connect(J,"onEditsComplete",v.hitch(this,"onLayerEditsComplete",E));this._connect(J,"error",v.hitch(this,"onLayerError",E));this._connect(J,"onUpdateEnd",v.hitch(this,
"onLayerUpdateEnd",E));E.showAttachments=J.hasAttachments?b.isDefined(E.showAttachments)?E.showAttachments:!0:!1;E.hideFields=E.hideFields||[];E.htmlFields=E.htmlFields||[];E.isEditable=J.isEditable()?b.isDefined(E.isEditable)?E.isEditable:!0:!1;E.typeIdField=J.typeIdField;E.layerId=J.id;E.types=J.types;J.globalIdField&&((Q=this._findFirst(E.fieldInfos,"fieldName",J.globalIdField))||E.showGlobalID||E.hideFields.push(J.globalIdField));(U=this._findFirst(E.fieldInfos,"fieldName",J.objectIdField))||
E.showObjectID||E.hideFields.push(J.objectIdField);var Y=this._getFields(E.featureLayer);if(Y){var Z=E.fieldInfos||[];Z=z.map(Z,function(aa){return v.mixin({},aa)});Z.length?E.fieldInfos=z.filter(z.map(Z,v.hitch(this,function(aa){var ca=aa.stringFieldOption||(this._isInFields(aa.fieldName,E.htmlFields)?K.STRING_FIELD_OPTION_RICHTEXT:K.STRING_FIELD_OPTION_TEXTBOX);return v.mixin(aa,{field:this._findFirst(Y,"name",aa.fieldName),stringFieldOption:ca})})),"return item.field;"):(Y=z.filter(Y,v.hitch(this,
function(aa){return!this._isInFields(aa.name,E.hideFields)})),E.fieldInfos=z.map(Y,v.hitch(this,function(aa){var ca=this._isInFields(aa.name,E.htmlFields)?K.STRING_FIELD_OPTION_RICHTEXT:K.STRING_FIELD_OPTION_TEXTBOX;return{fieldName:aa.name,field:aa,stringFieldOption:ca}})));E.showGlobalID&&!Q&&Z.push(this._findFirst(Y,"name",J.globalIdField));E.showObjectID&&!U&&Z.push(this._findFirst(Y,"name",J.objectIdField));Q=[];J.editFieldsInfo&&(J.editFieldsInfo.creatorField&&Q.push(J.editFieldsInfo.creatorField),
J.editFieldsInfo.creationDateField&&Q.push(J.editFieldsInfo.creationDateField),J.editFieldsInfo.editorField&&Q.push(J.editFieldsInfo.editorField),J.editFieldsInfo.editDateField&&Q.push(J.editFieldsInfo.editDateField));this._editorTrackingInfos[J.id]=Q}},_createAttachmentEditor:function(){this._attachmentEditor=null;var E=z.filter(this._layerInfos,function(J){return J.showAttachments});E&&E.length&&(this._attachmentEditor=new G({"class":this.css.attachmentEditor},this.attachmentEditor),this._attachmentEditor.startup())},
_setCurrentLInfo:function(E){var J=this._currentLInfo?this._currentLInfo.featureLayer:null,Q=E.featureLayer;if(J&&J.id===Q.id&&!J.ownershipBasedAccessControlForFeatures&&(J=Q.getEditCapabilities(),!J.canCreate||J.canUpdate))return;this._currentLInfo=E;this._createTable()},_updateSelection:function(E,J){this._selection=E||[];z.forEach(this._layerInfos,this._getSelection,this);this._selection=T.sortFeaturesById(this._layerInfos,this._selection);this._numFeatures=this._selection.length;this._showFeature(this._numFeatures?
this._selection[this._featureIdx]:null,J)},_getSelection:function(E){E=E.featureLayer.getSelectedFeatures();this._selection=this._selection.concat(E)},_updateUI:function(){var E=this._numFeatures,J=this._currentLInfo;this.layerName.innerHTML=J&&0!==E?J.featureLayer?J.featureLayer.name:"":this.NLS_noFeaturesSelected;a.set(this.attributeTable,"display",E?"":"none");a.set(this.editButtons,"display",E?"":"none");a.set(this.navButtons,"display",!this._hideNavButtons&&1<E?"":"none");this.navMessage.innerHTML=
b.substitute({idx:this._featureIdx+1,of:this.NLS_of,numFeatures:this._numFeatures},this._navMessage);this._attachmentEditor&&a.set(this._attachmentEditor.domNode,"display",J&&J.showAttachments&&E?"":"none");a.set(this.deleteBtn.domNode,"display",J&&!1===J.showDeleteButton||!this._canDelete?"none":"");this.domNode.parentNode&&0<this.domNode.parentNode.scrollTop&&(this.domNode.parentNode.scrollTop=0)},_onNextFeature:function(E){this._featureIdx+=E;0>this._featureIdx?this._featureIdx=this._numFeatures-
1:this._featureIdx>=this._numFeatures&&(this._featureIdx=0);E=this._selection.length?this._selection[this._featureIdx]:null;this._showFeature(E);this._updateUI();this.onNext(E)},_deleteFeature:function(){this.onDelete(this._currentFeature)},_showFeature:function(E,J){if(E){this._currentFeature=E;J=J?J:E.getLayer();var Q=J.getEditCapabilities({feature:E,userId:this._userIds[J.id]});this._canUpdate=Q.canUpdate;this._canDelete=Q.canDelete;if(Q=this._getLInfoFromFeatureLayer(J)){this._setCurrentLInfo(Q);
var U=E.attributes,Y=this._findFirst(Q.types,"id",U[Q.typeIdField]),Z=null;z.forEach(Q.fieldInfos,function(aa){Z=aa.field;var ca=[];aa.dijit&&1<aa.dijit.length?z.forEach(aa.dijit,function(ba){ca.push(ba)}):ca.push(aa.dijit);z.forEach(ca,v.hitch(this,function(ba){if(ba){var da=this._setFieldDomain(ba,Y,Z),ea=U[Z.name];ea=ea&&da&&da.codedValues&&da.codedValues.length?da.codedValues[ea]?da.codedValues[ea].name:ea:ea;b.isDefined(ea)||(ea="");"dijit.form.DateTextBox"===ba.declaredClass||"dijit.form.TimeTextBox"===
ba.declaredClass?ea=""===ea?null:new Date(ea):"dijit.form.FilteringSelect"===ba.declaredClass&&(ba._lastValueReported=null,ea=U[Z.name]+"");try{this._setValue(ba,ea),"dijit.form.FilteringSelect"===ba.declaredClass&&!1===ba.isValid()&&this._setValue(ba,null)}catch(fa){ba.set("displayedValue",this.NLS_errorInvalid,!1)}}}))},this);this._attachmentEditor&&Q.showAttachments&&this._attachmentEditor.showAttachments(this._currentFeature,J);(E=J.getEditSummary(E))?(this.editorTrackingInfoDiv.innerHTML=E,u.show(this.editorTrackingInfoDiv)):
u.hide(this.editorTrackingInfoDiv)}}},_setFieldDomain:function(E,J,Q){if(!E)return null;var U=Q.domain;J&&J.domains&&J.domains[Q.name]&&!1===J.domains[Q.name]instanceof w&&(U=J.domains[Q.name]);if(!U)return null;U.codedValues&&0<U.codedValues.length?(E.set("store",this._toStore(z.map(U.codedValues,function(Y){return{id:Y.code+"",name:Y.name}}))),this._setValue(E,U.codedValues[0].code+"")):(E.constraints={min:b.isDefined(U.minValue)?U.minValue:Number.MIN_VALUE,max:b.isDefined(U.maxValue)?U.maxValue:
Number.MAX_VALUE},this._setValue(E,E.constraints.min));return U},_setValue:function(E,J){E.set&&(E._onChangeActive=!1,E.set("value",J,!0),E._onChangeActive=!0)},_getFields:function(E){var J=E._getOutFields();if(!J)return null;E=E.fields;return"*"==J?E:z.filter(z.map(J,v.hitch(this,"_findFirst",E,"name")),b.isDefined)},_isInFields:function(E,J){return E&&(J||J.length)?z.some(J,function(Q){return Q.toLowerCase()===E.toLowerCase()}):!1},_isFieldNullable:function(E,J){return!(!1===E.nullable||J.field&&
!1===J.field.nullable)},_isFieldRequired:function(E,J){return!1!==E.editable&&!1!==J.isEditable&&!this._isFieldNullable(E,J)},_findFirst:function(E,J,Q){return(E=z.filter(E,function(U){return U.hasOwnProperty(J)&&U[J]===Q}))&&E.length?E[0]:null},_getLInfoFromFeatureLayer:function(E){return this._findFirst(this._layerInfos,"layerId",E?E.id:null)},_createTable:function(){this._destroyAttributeTable();this.attributeTable.innerHTML="";this._attributes=n.create("table",{cellspacing:"0",cellpadding:"0"},
this.attributeTable);var E=n.create("tbody",null,this._attributes),J=this._currentLInfo,Q=this._findFirst(J.types,"id",this._currentFeature.attributes[J.typeIdField]);z.forEach(J.fieldInfos,v.hitch(this,"_createField",Q,E),this);this._createOnlyFirstTime=!1},_createField:function(E,J,Q){var U=this._currentLInfo,Y=Q.field;if(!this._isInFields(Y.name,U.hideFields)&&!this._isInFields(Y.name,this._editorTrackingInfos[U.featureLayer.id])){var Z=!1,aa;J=n.create("tr",null,J);var ca=n.create("td",{innerHTML:Q.label||
Y.alias||Y.name,"class":this.css.label,"data-fieldname":Y.name},J);this._isFieldRequired(Y,Q)&&n.create("span",{"class":this.css.red,innerHTML:" *"},ca);J=n.create("td",null,J);if(Q.customField){n.place(Q.customField.domNode||Q.customField,n.create("div",null,J),"first");var ba=Q.customField}else if(!1===U.isEditable||!1===Y.editable||!1===Q.isEditable||"esriFieldTypeOID"===Y.type||"esriFieldTypeGlobalID"===Y.type||!this._canUpdate&&!this._createOnlyFirstTime)Z=!0;U=U.typeIdField&&Y.name.toLowerCase()==
U.typeIdField.toLowerCase();ca=!!this._getDomainForField(Y,E);!ba&&U?ba=this._createTypeField(Y,Q,J):!ba&&ca&&(ba=this._createDomainField(Y,Q,E,J));if(!ba)switch(Y.type){case "esriFieldTypeString":ba=this._createStringField(Y,Q,J);break;case "esriFieldTypeDate":ba=this._createDateField(Y,Q,J);Q.format&&Q.format.time&&(aa=this._createTimeField(Y,Q,J));break;case "esriFieldTypeInteger":case "esriFieldTypeSmallInteger":ba=this._createIntField(Y,Q,J);break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":ba=
this._createFltField(Y,Q,J);break;default:ba=this._createStringField(Y,Q,J)}Q.tooltip&&Q.tooltip.length&&this._toolTips.push(new R({connectId:[ba.id],label:Q.tooltip}));ba.onChange=v.hitch(this,"onFieldValueChange",Q);ba.set("disabled",Z);aa?(Q.dijit=[ba,aa],aa.onChange=v.hitch(this,"onFieldValueChange",Q),aa.set("disabled",Z)):Q.dijit=ba}},_createTypeField:function(E,J,Q){Q=n.create("div",null,Q);var U=E.domain;return U&&"range"===U.type&&U.minValue===U.maxValue?new I({"class":this.css.field,trim:!0,
maxLength:E.length,name:E.alias||E.name,required:this._isFieldRequired(E,J)},Q):new H({"class":this.css.field,name:E.alias||E.name,required:this._isFieldRequired(E,J),store:this._toStore(z.map(this._currentLInfo.types,function(Y){return{id:Y.id,name:Y.name}})),searchAttr:"name"},Q)},_getDomainForField:function(E,J){var Q=E.domain;(E=E.name)&&J&&J.domains&&J.domains[E]&&!1===J.domains[E]instanceof w&&(Q=J.domains[E]);return Q||null},_createDomainField:function(E,J,Q,U){Q=this._getDomainForField(E,
Q);U=n.create("div",null,U);return Q.codedValues?new H({"class":this.css.field,name:E.alias||E.name,searchAttr:"name",required:this._isFieldRequired(E,J)},U):new g({"class":this.css.field},U)},_createStringField:function(E,J,Q){Q=n.create("div",null,Q);var U={trim:!0,maxLength:E.length,required:this._isFieldRequired(E,J)};if(J.stringFieldOption===K.STRING_FIELD_OPTION_TEXTAREA)return U["class"]=this.css.field+" "+this.css.textArea,new A(U,Q);if(J.stringFieldOption===K.STRING_FIELD_OPTION_RICHTEXT)return U["class"]=
this.css.field+" "+this.css.richText,U.height="100%",U.width="100%",U.plugins=J.richTextPlugins||this._defaultRichTextPlugins,Q=new C(U,Q),Q.startup(),Q;var Y=this;U.validator=function(Z,aa){this._maskValidSubsetError=!1;this._hasBeenBlurred=!0;return Y._isFieldNullable(E,J)||!(""===Z||null===Z)};return new I(U,Q)},_createTimeField:function(E,J,Q){Q=n.create("div",null,Q);E={"class":this.css.field,trim:!0,required:this._isFieldRequired(E,J),constraints:{formatLength:"medium"}};this._datePackage&&
(E.datePackage=this._datePackage);return new M(E,Q)},_createDateField:function(E,J,Q){Q=n.create("div",null,Q);E={"class":this.css.field,trim:!0,required:this._isFieldRequired(E,J)};this._datePackage&&(E.datePackage=this._datePackage);return new P(E,Q)},_createIntField:function(E,J,Q){Q=n.create("div",null,Q);return new X({"class":this.css.field,constraints:"esriFieldTypeSmallInteger"===E.type?{min:-32768,max:32767,places:0}:{places:0},trim:!0,invalidMessage:this.NLS_validationInt,required:this._isFieldRequired(E,
J)},Q)},_createFltField:function(E,J,Q){Q=n.create("div",null,Q);return new X({"class":this.css.field,constraints:{max:Infinity,min:-Infinity,places:"0,20"},trim:!0,invalidMessage:this.NLS_validationFlt,required:this._isFieldRequired(E,J)},Q)},_toStore:function(E){return new S({data:{identifier:"id",label:"name",items:E}})},_connect:function(E,J,Q){this._aiConnects.push(y.connect(E,J,Q))},_getDatePackage:function(E){return null===E.datePackage?null:E.datePackage?E.datePackage:"ar"===c.locale?"dojox.date.islamic":
null},_destroyAttributeTable:function(){z.forEach(this._layerInfos,function(E){z.forEach(E.fieldInfos,function(J){var Q=J.dijit;if(Q){Q._onChangeHandle=null;if(J.customField)return;Q instanceof Array?z.forEach(Q,v.hitch(this,function(U){U.destroyRecursive?U.destroyRecursive():U.destroy&&U.destroy();U._onChangeHandle=null})):Q.destroyRecursive?Q.destroyRecursive():Q.destroy&&Q.destroy()}J.dijit=null},this)},this);z.forEach(this._toolTips,function(E){E.destroy()});this._toolTips=[];this._attributes&&
n.destroy(this._attributes)}});v.mixin(K,{STRING_FIELD_OPTION_RICHTEXT:"richtext",STRING_FIELD_OPTION_TEXTAREA:"textarea",STRING_FIELD_OPTION_TEXTBOX:"textbox"});f("extend-esri")&&v.setObject("dijit.AttributeInspector",K,l);return K})},"dijit/Editor":function(){define("require dojo/_base/array dojo/_base/declare dojo/Deferred dojo/i18n dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/string dojo/topic ./_Container ./Toolbar ./ToolbarSeparator ./layout/_LayoutWidget ./form/ToggleButton ./_editor/_Plugin ./_editor/plugins/EnterKeyHandling ./_editor/html ./_editor/range ./_editor/RichText ./main dojo/i18n!./_editor/nls/commands".split(" "),
function(N,v,z,y,m,c,f,a,n,l,b,u,w,e,q,h,r,d,x,C,L,t,p,G,T){function D(O){return new C({command:O.name})}function P(O){return new C({buttonClass:x,command:O.name})}z=z("dijit.Editor",G,{plugins:null,extraPlugins:null,constructor:function(){b.isArray(this.plugins)||(this.plugins=["undo","redo","|","cut","copy","paste","|","bold","italic","underline","strikethrough","|","insertOrderedList","insertUnorderedList","indent","outdent","|","justifyLeft","justifyRight","justifyCenter","justifyFull",L]);this._plugins=
[];this._editInterval=1E3*this.editActionInterval;if(u("ie")||u("trident")||u("edge"))this.events.push("onBeforeDeactivate"),this.events.push("onBeforeActivate")},postMixInProperties:function(){this.setValueDeferred=new y;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._steps=this._steps.slice(0);this._undoedSteps=this._undoedSteps.slice(0);b.isArray(this.extraPlugins)&&(this.plugins=this.plugins.concat(this.extraPlugins));this.commands=m.getLocalization("dijit._editor",
"commands",this.lang);u("webkit")&&n.set(this.domNode,"KhtmlUserSelect","none")},startup:function(){this.inherited(arguments);this.toolbar||(this.toolbar=new h({ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,"aria-label":this.id}),this.header.appendChild(this.toolbar.domNode));v.forEach(this.plugins,this.addPlugin,this);this.setValueDeferred.resolve(!0);f.add(this.iframe.parentNode,"dijitEditorIFrameContainer");f.add(this.iframe,"dijitEditorIFrame");c.set(this.iframe,"allowTransparency",
!0);this.toolbar.startup();this.onNormalizedDisplayChanged()},destroy:function(){v.forEach(this._plugins,function(O){O&&O.destroy&&O.destroy()});this._plugins=[];this.toolbar.destroyRecursive();delete this.toolbar;this.inherited(arguments)},addPlugin:function(O,X){var H=b.isString(O)?{name:O}:b.isFunction(O)?{ctor:O}:O;if(!H.setEditor){var g={args:H,plugin:null,editor:this};H.name&&(C.registry[H.name]?g.plugin=C.registry[H.name](H):e.publish(T._scopeName+".Editor.getPlugin",g));if(!g.plugin)try{var B=
H.ctor||b.getObject(H.name)||N(H.name);B&&(g.plugin=new B(H))}catch(A){throw Error(this.id+": cannot find plugin ["+H.name+"]");}if(!g.plugin)throw Error(this.id+": cannot find plugin ["+H.name+"]");O=g.plugin}1<arguments.length?this._plugins[X]=O:this._plugins.push(O);O.setEditor(this);b.isFunction(O.setToolbar)&&O.setToolbar(this.toolbar)},resize:function(O){O&&d.prototype.resize.apply(this,arguments)},layout:function(){var O=this._contentBox.h-(this.getHeaderHeight()+this.getFooterHeight()+a.getPadBorderExtents(this.iframe.parentNode).h+
a.getMarginExtents(this.iframe.parentNode).h);this.editingArea.style.height=O+"px";this.iframe&&(this.iframe.style.height="100%");this._layoutMode=!0},_onIEMouseDown:function(O){var X,H=this.document.body,g=H.clientWidth,B=H.clientHeight,A=H.clientLeft,I=H.offsetWidth,M=H.offsetHeight,R=H.offsetLeft;/^rtl$/i.test(H.dir||"")?g<I&&O.x>g&&O.x<I&&(X=!0):O.x<A&&O.x>R&&(X=!0);X||B<M&&O.y>B&&O.y<M&&(X=!0);X||(delete this._cursorToStart,delete this._savedSelection,"BODY"==O.target.tagName&&this.defer("placeCursorAtEnd"),
this.inherited(arguments))},onBeforeActivate:function(){this._restoreSelection()},onBeforeDeactivate:function(O){this.customUndo&&this.endEditing(!0);"BODY"!=O.target.tagName&&this._saveSelection()},customUndo:!0,editActionInterval:3,beginEditing:function(O){this._inEditing||(this._inEditing=!0,this._beginEditing(O));0<this.editActionInterval&&(this._editTimer&&this._editTimer.remove(),this._editTimer=this.defer("endEditing",this._editInterval))},_steps:[],_undoedSteps:[],execCommand:function(O){if(!this.customUndo||
"undo"!=O&&"redo"!=O){this.customUndo&&(this.endEditing(),this._beginEditing());var X=this.inherited(arguments);this.customUndo&&this._endEditing();return X}return this[O]()},_pasteImpl:function(){return this._clipboardCommand("paste")},_cutImpl:function(){return this._clipboardCommand("cut")},_copyImpl:function(){return this._clipboardCommand("copy")},_clipboardCommand:function(O){try{var X=this.document.execCommand(O,!1,null);if(u("webkit")&&!X)throw{};}catch(H){X=w.substitute,alert(X(this.commands.systemShortcut,
[this.commands[O],X(this.commands[u("mac")?"appleKey":"ctrlKey"],[{cut:"X",copy:"C",paste:"V"}[O]])])),X=!1}return X},queryCommandEnabled:function(O){return!this.customUndo||"undo"!=O&&"redo"!=O?this.inherited(arguments):"undo"==O?1<this._steps.length:0<this._undoedSteps.length},_moveToBookmark:function(O){var X=O.mark,H=O.mark;O=O.isCollapsed;var g;if(H)if(9>u("ie")||9===u("ie")&&u("quirks"))if(b.isArray(H))X=[],v.forEach(H,function(I){X.push(p.getNode(I,this.editNode))},this),this.selection.moveToBookmark({mark:X,
isCollapsed:O});else{if(H.startContainer&&H.endContainer&&(g=p.getSelection(this.window))&&g.removeAllRanges){g.removeAllRanges();O=p.create(this.window);var B=p.getNode(H.startContainer,this.editNode);var A=p.getNode(H.endContainer,this.editNode);B&&A&&(O.setStart(B,H.startOffset),O.setEnd(A,H.endOffset),g.addRange(O))}}else(g=p.getSelection(this.window))&&g.removeAllRanges&&(g.removeAllRanges(),O=p.create(this.window),B=p.getNode(H.startContainer,this.editNode),A=p.getNode(H.endContainer,this.editNode),
B&&A&&(O.setStart(B,H.startOffset),O.setEnd(A,H.endOffset),g.addRange(O)))},_changeToStep:function(O,X){this.setValue(X.text);(O=X.bookmark)&&this._moveToBookmark(O)},undo:function(){var O=!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var X=this._steps.pop();X&&0<this._steps.length&&(this.focus(),this._changeToStep(X,this._steps[this._steps.length-1]),this._undoedSteps.push(X),this.onDisplayChanged(),delete this._undoRedoActive,O=!0);delete this._undoRedoActive}return O},
redo:function(){var O=!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var X=this._undoedSteps.pop();X&&0<this._steps.length&&(this.focus(),this._changeToStep(this._steps[this._steps.length-1],X),this._steps.push(X),this.onDisplayChanged(),O=!0);delete this._undoRedoActive}return O},endEditing:function(O){this._editTimer&&(this._editTimer=this._editTimer.remove());this._inEditing&&(this._endEditing(O),this._inEditing=!1)},_getBookmark:function(){var O=this.selection.getBookmark(),
X=[];if(O&&O.mark){var H=O.mark;if(9>u("ie")||9===u("ie")&&u("quirks")){var g=p.getSelection(this.window);if(b.isArray(H))v.forEach(O.mark,function(A){X.push(p.getIndex(A,this.editNode).o)},this),O.mark=X;else if(g){var B;g.rangeCount&&(B=g.getRangeAt(0));O.mark=B?B.cloneRange():this.selection.getBookmark()}}try{O.mark&&O.mark.startContainer&&(X=p.getIndex(O.mark.startContainer,this.editNode).o,O.mark={startContainer:X,startOffset:O.mark.startOffset,endContainer:O.mark.endContainer===O.mark.startContainer?
X:p.getIndex(O.mark.endContainer,this.editNode).o,endOffset:O.mark.endOffset})}catch(A){O.mark=null}}return O},_beginEditing:function(){0===this._steps.length&&this._steps.push({text:t.getChildrenHtml(this.editNode),bookmark:this._getBookmark()})},_endEditing:function(){var O=t.getChildrenHtml(this.editNode);this._undoedSteps=[];this._steps.push({text:O,bookmark:this._getBookmark()})},onKeyDown:function(O){u("ie")||this.iframe||O.keyCode!=l.TAB||this.tabIndent||this._saveSelection();if(this.customUndo){var X=
O.keyCode;if(O.ctrlKey&&!O.shiftKey&&!O.altKey){if(90==X||122==X){O.stopPropagation();O.preventDefault();this.undo();return}if(89==X||121==X){O.stopPropagation();O.preventDefault();this.redo();return}}this.inherited(arguments);switch(X){case l.ENTER:case l.BACKSPACE:case l.DELETE:this.beginEditing();break;case 88:case 86:if(O.ctrlKey&&!O.altKey&&!O.metaKey){this.endEditing();88==O.keyCode?this.beginEditing("cut"):this.beginEditing("paste");this.defer("endEditing",1);break}default:if(!O.ctrlKey&&!O.altKey&&
!O.metaKey&&(O.keyCode<l.F1||O.keyCode>l.F15)){this.beginEditing();break}case l.ALT:this.endEditing();break;case l.UP_ARROW:case l.DOWN_ARROW:case l.LEFT_ARROW:case l.RIGHT_ARROW:case l.HOME:case l.END:case l.PAGE_UP:case l.PAGE_DOWN:this.endEditing(!0);case l.CTRL:case l.SHIFT:case l.TAB:}}else this.inherited(arguments)},_onBlur:function(){this.inherited(arguments);this.endEditing(!0)},_saveSelection:function(){try{this._savedSelection=this._getBookmark()}catch(O){}},_restoreSelection:function(){this._savedSelection&&
(delete this._cursorToStart,this.selection.isCollapsed()&&this._moveToBookmark(this._savedSelection),delete this._savedSelection)},onClick:function(){this.endEditing(!0);this.inherited(arguments)},replaceValue:function(O){this.customUndo?this.isClosed?this.setValue(O):(this.beginEditing(),O||(O="\x26#160;"),this.setValue(O),this.endEditing()):this.inherited(arguments)},_setDisabledAttr:function(O){this.setValueDeferred.then(b.hitch(this,function(){!this.disabled&&O||!this._buttonEnabledPlugins&&O?
v.forEach(this._plugins,function(X){X.set("disabled",!0)}):this.disabled&&!O&&v.forEach(this._plugins,function(X){X.set("disabled",!1)})}));this.inherited(arguments)},_setStateClass:function(){try{this.inherited(arguments),this.document&&this.document.body&&(n.set(this.document.body,"color",n.get(this.iframe,"color")),n.set(this.document.body,"background-color",n.get(this.iframe,"background-color")))}catch(O){}}});b.mixin(C.registry,{undo:D,redo:D,cut:D,copy:D,paste:D,insertOrderedList:D,insertUnorderedList:D,
indent:D,outdent:D,justifyCenter:D,justifyFull:D,justifyLeft:D,justifyRight:D,"delete":D,selectAll:D,removeFormat:D,unlink:D,insertHorizontalRule:D,bold:P,italic:P,underline:P,strikethrough:P,subscript:P,superscript:P,"|":function(){return new C({setEditor:function(O){this.editor=O;this.button=new r({ownerDocument:O.ownerDocument})}})}});return z})},"dijit/Toolbar":function(){define("require dojo/_base/declare dojo/has dojo/keys dojo/ready ./_Widget ./_KeyNavContainer ./_TemplatedMixin".split(" "),
function(N,v,z,y,m,c,f,a){z("dijit-legacy-requires")&&m(0,function(){N(["dijit/ToolbarSeparator"])});return v("dijit.Toolbar",[c,a,f],{templateString:'\x3cdiv class\x3d"dijit" role\x3d"toolbar" tabIndex\x3d"${tabIndex}" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e',baseClass:"dijitToolbar",_onLeftArrow:function(){this.focusPrev()},_onRightArrow:function(){this.focusNext()}})})},"dijit/ToolbarSeparator":function(){define(["dojo/_base/declare","dojo/dom","./_Widget","./_TemplatedMixin"],
function(N,v,z,y){return N("dijit.ToolbarSeparator",[z,y],{templateString:'\x3cdiv class\x3d"dijitToolbarSeparator dijitInline" role\x3d"presentation"\x3e\x3c/div\x3e',buildRendering:function(){this.inherited(arguments);v.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"dijit/_editor/_Plugin":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","../Destroyable","../form/Button"],function(N,v,z,y,m){v=v("dijit._editor._Plugin",y,{constructor:function(c){this.params=
c||{};z.mixin(this,this.params);this._attrPairNames={}},editor:null,iconClassPrefix:"dijitEditorIcon",button:null,command:"",useDefaultCommand:!0,buttonClass:m,disabled:!1,getLabel:function(c){return this.editor.commands[c]},_initButton:function(){if(this.command.length){var c=this.getLabel(this.command),f=this.editor,a=this.iconClassPrefix+" "+this.iconClassPrefix+this.command.charAt(0).toUpperCase()+this.command.substr(1);this.button||(c=z.mixin({label:c,ownerDocument:f.ownerDocument,dir:f.dir,
lang:f.lang,showLabel:!1,iconClass:a,dropDown:this.dropDown,tabIndex:"-1"},this.params||{}),delete c.name,this.button=new this.buttonClass(c))}this.get("disabled")&&this.button&&this.button.set("disabled",this.get("disabled"))},destroy:function(){this.dropDown&&this.dropDown.destroyRecursive();this.inherited(arguments)},connect:function(c,f,a){this.own(N.connect(c,f,this,a))},updateState:function(){var c=this.editor,f=this.command;if(c&&c.isLoaded&&f.length){var a=this.get("disabled");if(this.button)try{var n=
c._implCommand(f);var l=!a&&(this[n]?this[n](f):c.queryCommandEnabled(f));this.enabled!==l&&(this.enabled=l,this.button.set("disabled",!l));if(l&&"boolean"==typeof this.button.checked){var b=c.queryCommandState(f);this.checked!==b&&(this.checked=b,this.button.set("checked",c.queryCommandState(f)))}}catch(u){console.log(u)}}},setEditor:function(c){this.editor=c;this._initButton();this.button&&this.useDefaultCommand&&(this.editor.queryCommandAvailable(this.command)?this.own(this.button.on("click",z.hitch(this.editor,
"execCommand",this.command,this.commandArg))):this.button.domNode.style.display="none");this.own(this.editor.on("NormalizedDisplayChanged",z.hitch(this,"updateState")))},setToolbar:function(c){this.button&&c.addChild(this.button)},set:function(c,f){if("object"===typeof c){for(var a in c)this.set(a,c[a]);return this}a=this._getAttrNames(c);if(this[a.s])var n=this[a.s].apply(this,Array.prototype.slice.call(arguments,1));else this._set(c,f);return n||this},get:function(c){var f=this._getAttrNames(c);
return this[f.g]?this[f.g]():this[c]},_setDisabledAttr:function(c){this._set("disabled",c);this.updateState()},_getAttrNames:function(c){var f=this._attrPairNames;if(f[c])return f[c];var a=c.charAt(0).toUpperCase()+c.substr(1);return f[c]={s:"_set"+a+"Attr",g:"_get"+a+"Attr"}},_set:function(c,f){this[c]=f}});v.registry={};return v})},"dijit/_editor/plugins/EnterKeyHandling":function(){define("dojo/_base/declare dojo/dom-construct dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ../_Plugin ../RichText ../range".split(" "),
function(N,v,z,y,m,c,f,a,n,l,b){return N("dijit._editor.plugins.EnterKeyHandling",n,{blockNodeForEnter:"BR",constructor:function(u){u&&("blockNodeForEnter"in u&&(u.blockNodeForEnter=u.blockNodeForEnter.toUpperCase()),y.mixin(this,u))},setEditor:function(u){if(this.editor!==u)if(this.editor=u,"BR"==this.blockNodeForEnter)this.editor.customUndo=!0,u.onLoadDeferred.then(y.hitch(this,function(e){this.own(m(u.document,"keydown",y.hitch(this,function(q){if(q.keyCode==z.ENTER){var h=y.mixin({},q);h.shiftKey=
!0;this.handleEnterKey(h)||(q.stopPropagation(),q.preventDefault())}})));9<=c("ie")&&10>=c("ie")&&this.own(m(u.document,"paste",y.hitch(this,function(q){setTimeout(y.hitch(this,function(){var h=this.editor.document.selection.createRange();h.move("character",-1);h.select();h.move("character",1);h.select()}),0)})));return e}));else if(this.blockNodeForEnter){var w=y.hitch(this,"handleEnterKey");u.addKeyHandler(13,0,0,w);u.addKeyHandler(13,0,1,w);this.own(this.editor.on("KeyPressed",y.hitch(this,"onKeyPressed")))}},
onKeyPressed:function(){if(this._checkListLater){if(this.editor.selection.isCollapsed()){var u=this.editor.selection.getAncestorElement("LI");if(u){c("mozilla")&&"LI"==u.parentNode.parentNode.nodeName&&(u=u.parentNode.parentNode);var w=u.firstChild;!w||1!=w.nodeType||"UL"!=w.nodeName&&"OL"!=w.nodeName||(u.insertBefore(w.ownerDocument.createTextNode("\u00a0"),w),w=b.create(this.editor.window),w.setStart(u.firstChild,0),u=b.getSelection(this.editor.window,!0),u.removeAllRanges(),u.addRange(w))}else l.prototype.execCommand.call(this.editor,
"formatblock",this.blockNodeForEnter),(u=this.editor.selection.getAncestorElement(this.blockNodeForEnter))?(u.innerHTML=this.bogusHtmlContent,9>=c("ie")&&(u=this.editor.document.selection.createRange(),u.move("character",-1),u.select())):console.error("onKeyPressed: Cannot find the new block node")}this._checkListLater=!1}this._pressedEnterInBlock&&(this._pressedEnterInBlock.previousSibling&&this.removeTrailingBr(this._pressedEnterInBlock.previousSibling),delete this._pressedEnterInBlock)},bogusHtmlContent:"\x26#160;",
blockNodes:/^(?:P|H1|H2|H3|H4|H5|H6|LI)$/,handleEnterKey:function(u){var w,e=this.editor.document,q;if(u.shiftKey){u=this.editor.selection.getParentElement();if(w=b.getAncestor(u,this.blockNodes)){if("LI"==w.tagName)return!0;u=b.getSelection(this.editor.window);var h=u.getRangeAt(0);h.collapsed||(h.deleteContents(),u=b.getSelection(this.editor.window),h=u.getRangeAt(0));if(b.atBeginningOfContainer(w,h.startContainer,h.startOffset)){var r=e.createElement("br");h=b.create(this.editor.window);w.insertBefore(r,
w.firstChild);h.setStartAfter(r);u.removeAllRanges();u.addRange(h)}else if(b.atEndOfContainer(w,h.startContainer,h.startOffset))h=b.create(this.editor.window),r=e.createElement("br"),w.appendChild(r),w.appendChild(e.createTextNode("\u00a0")),h.setStart(w.lastChild,0),u.removeAllRanges(),u.addRange(h);else{if((q=h.startContainer)&&3==q.nodeType){var d=q.nodeValue;var x=e.createTextNode(d.substring(0,h.startOffset));var C=e.createTextNode(d.substring(h.startOffset));w=e.createElement("br");""==C.nodeValue&&
c("webkit")&&(C=e.createTextNode("\u00a0"));v.place(x,q,"after");v.place(w,x,"after");v.place(C,w,"after");v.destroy(q);h=b.create(this.editor.window);h.setStart(C,0);u.removeAllRanges();u.addRange(h);return!1}return!0}}else u=b.getSelection(this.editor.window),u.rangeCount?(h=u.getRangeAt(0))&&h.startContainer&&(h.collapsed||(h.deleteContents(),u=b.getSelection(this.editor.window),h=u.getRangeAt(0)),(q=h.startContainer)&&3==q.nodeType?(w=h.startOffset,q.length<w&&(C=this._adjustNodeAndOffset(q,w),
q=C.node,w=C.offset),d=q.nodeValue,x=e.createTextNode(d.substring(0,w)),C=e.createTextNode(d.substring(w)),w=e.createElement("br"),C.length||(C=e.createTextNode("\u00a0")),x.length?v.place(x,q,"after"):x=q,v.place(w,x,"after"),v.place(C,w,"after"),v.destroy(q)):(0<=h.startOffset&&(r=q.childNodes[h.startOffset]),w=e.createElement("br"),C=e.createTextNode("\u00a0"),r?(v.place(w,r,"before"),v.place(C,w,"after")):(q.appendChild(w),q.appendChild(C))),h=b.create(this.editor.window),h.setStart(C,0),h.setEnd(C,
C.length),u.removeAllRanges(),u.addRange(h),this.editor.selection.collapse(!0)):l.prototype.execCommand.call(this.editor,"inserthtml","\x3cbr\x3e");return!1}var L=!0;u=b.getSelection(this.editor.window);h=u.getRangeAt(0);h.collapsed||(h.deleteContents(),u=b.getSelection(this.editor.window),h=u.getRangeAt(0));r=b.getBlockAncestor(h.endContainer,null,this.editor.editNode);var t=r.blockNode;if(this._checkListLater=t&&("LI"==t.nodeName||"LI"==t.parentNode.nodeName))return c("mozilla")&&(this._pressedEnterInBlock=
t),/^(\s|&nbsp;|&#160;|\xA0|<span\b[^>]*\bclass=['"]Apple-style-span['"][^>]*>(\s|&nbsp;|&#160;|\xA0)<\/span>)?(<br>)?$/.test(t.innerHTML)&&(t.innerHTML="",c("webkit")&&(h=b.create(this.editor.window),h.setStart(t,0),u.removeAllRanges(),u.addRange(h)),this._checkListLater=!1),!0;if(!r.blockNode||r.blockNode===this.editor.editNode){try{l.prototype.execCommand.call(this.editor,"formatblock",this.blockNodeForEnter)}catch(p){}r={blockNode:this.editor.selection.getAncestorElement(this.blockNodeForEnter),
blockContainer:this.editor.editNode};if(r.blockNode){if(r.blockNode!=this.editor.editNode&&!(r.blockNode.textContent||r.blockNode.innerHTML).replace(/^\s+|\s+$/g,"").length)return this.removeTrailingBr(r.blockNode),!1}else r.blockNode=this.editor.editNode;u=b.getSelection(this.editor.window);h=u.getRangeAt(0)}t=e.createElement(this.blockNodeForEnter);t.innerHTML=this.bogusHtmlContent;this.removeTrailingBr(r.blockNode);C=h.endOffset;L=h.endContainer;L.length<C&&(C=this._adjustNodeAndOffset(L,C),L=
C.node,C=C.offset);if(b.atEndOfContainer(r.blockNode,L,C))r.blockNode===r.blockContainer?r.blockNode.appendChild(t):v.place(t,r.blockNode,"after"),L=!1,h=b.create(this.editor.window),h.setStart(t,0),u.removeAllRanges(),u.addRange(h),this.editor.height&&a.scrollIntoView(t);else if(b.atBeginningOfContainer(r.blockNode,h.startContainer,h.startOffset))v.place(t,r.blockNode,r.blockNode===r.blockContainer?"first":"before"),t.nextSibling&&this.editor.height&&(h=b.create(this.editor.window),h.setStart(t.nextSibling,
0),u.removeAllRanges(),u.addRange(h),a.scrollIntoView(t.nextSibling)),L=!1;else{r.blockNode===r.blockContainer?r.blockNode.appendChild(t):v.place(t,r.blockNode,"after");L=!1;r.blockNode.style&&t.style&&r.blockNode.style.cssText&&(t.style.cssText=r.blockNode.style.cssText);if((q=h.startContainer)&&3==q.nodeType){C=h.endOffset;q.length<C&&(C=this._adjustNodeAndOffset(q,C),q=C.node,C=C.offset);d=q.nodeValue;x=e.createTextNode(d.substring(0,C));C=e.createTextNode(d.substring(C,d.length));v.place(x,q,
"before");v.place(C,q,"after");v.destroy(q);for(h=x.parentNode;h!==r.blockNode;){d=e.createElement(h.tagName);h.style&&d.style&&h.style.cssText&&(d.style.cssText=h.style.cssText);"FONT"===h.tagName&&(h.color&&(d.color=h.color),h.face&&(d.face=h.face),h.size&&(d.size=h.size));for(;C;)q=C.nextSibling,d.appendChild(C),C=q;v.place(d,h,"after");x=h;C=d;h=h.parentNode}if(1==C.nodeType||3==C.nodeType&&C.nodeValue)t.innerHTML="";for(x=C;C;)q=C.nextSibling,t.appendChild(C),C=q}h=b.create(this.editor.window);
e=x;if("BR"!==this.blockNodeForEnter){for(;e;)w=e,e=q=e.firstChild;w&&w.parentNode?(t=w.parentNode,h.setStart(t,0),u.removeAllRanges(),u.addRange(h),this.editor.height&&a.scrollIntoView(t),c("mozilla")&&(this._pressedEnterInBlock=r.blockNode)):L=!0}else h.setStart(t,0),u.removeAllRanges(),u.addRange(h),this.editor.height&&a.scrollIntoView(t),c("mozilla")&&(this._pressedEnterInBlock=r.blockNode)}return L},_adjustNodeAndOffset:function(u,w){for(;u.length<w&&u.nextSibling&&3==u.nextSibling.nodeType;)w-=
u.length,u=u.nextSibling;return{node:u,offset:w}},removeTrailingBr:function(u){if(u=/P|DIV|LI/i.test(u.tagName)?u:this.editor.selection.getParentOfType(u,["P","DIV","LI"]))u.lastChild&&(1<u.childNodes.length&&3==u.lastChild.nodeType&&/^[\s\xAD]*$/.test(u.lastChild.nodeValue)||"BR"==u.lastChild.tagName)&&v.destroy(u.lastChild),u.childNodes.length||(u.innerHTML=this.bogusHtmlContent)}})})},"dijit/_editor/RichText":function(){define("dojo/_base/array dojo/_base/config dojo/_base/declare dojo/_base/Deferred dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/query dojo/domReady dojo/sniff dojo/string dojo/topic dojo/_base/unload dojo/_base/url dojo/window ../_Widget ../_CssStateMixin ../selection ./range ./html ../focus ../main".split(" "),
function(N,v,z,y,m,c,f,a,n,l,b,u,w,e,q,h,r,d,x,C,L,t,p,G,T,D,P,O,X){var H=z("dijit._editor.RichText",[p,G],{constructor:function(g){this.contentPreFilters=[];this.contentPostFilters=[];this.contentDomPreFilters=[];this.contentDomPostFilters=[];this.editingAreaStyleSheets=[];this.events=[].concat(this.events);this._keyHandlers={};g&&w.isString(g.value)&&(this.value=g.value);this.onLoadDeferred=new y},baseClass:"dijitEditor",inheritWidth:!1,focusOnLoad:!1,name:"",styleSheets:"",height:"300px",minHeight:"1em",
isClosed:!0,isLoaded:!1,_SEPARATOR:"@@**%%__RICHTEXTBOUNDRY__%%**@@",_NAME_CONTENT_SEP:"@@**%%:%%**@@",onLoadDeferred:null,isTabIndent:!1,disableSpellCheck:!1,postCreate:function(){"textarea"===this.domNode.tagName.toLowerCase()&&console.warn("RichText should not be used with the TEXTAREA tag.  See dijit._editor.RichText docs.");this.contentPreFilters=[w.trim,w.hitch(this,"_preFixUrlAttributes")].concat(this.contentPreFilters);r("mozilla")&&(this.contentPreFilters=[this._normalizeFontStyle].concat(this.contentPreFilters),
this.contentPostFilters=[this._removeMozBogus].concat(this.contentPostFilters));r("webkit")&&(this.contentPreFilters=[this._removeWebkitBogus].concat(this.contentPreFilters),this.contentPostFilters=[this._removeWebkitBogus].concat(this.contentPostFilters));if(r("ie")||r("trident"))this.contentPostFilters=[this._normalizeFontStyle].concat(this.contentPostFilters),this.contentDomPostFilters=[w.hitch(this,"_stripBreakerNodes")].concat(this.contentDomPostFilters);this.contentDomPostFilters=[w.hitch(this,
"_stripTrailingEmptyNodes")].concat(this.contentDomPostFilters);this.inherited(arguments);x.publish(X._scopeName+"._editor.RichText::init",this)},startup:function(){this.inherited(arguments);this.open();this.setupDefaultShortcuts()},setupDefaultShortcuts:function(){var g=w.hitch(this,function(I,M){return function(){return!this.execCommand(I,M)}}),B={b:g("bold"),i:g("italic"),u:g("underline"),a:g("selectall"),s:function(){this.save(!0)},m:function(){this.isTabIndent=!this.isTabIndent},1:g("formatblock",
"h1"),2:g("formatblock","h2"),3:g("formatblock","h3"),4:g("formatblock","h4"),"\\":g("insertunorderedlist")};r("ie")||(B.Z=g("redo"));for(var A in B)this.addKeyHandler(A,!0,!1,B[A])},events:["onKeyDown","onKeyUp"],captureEvents:[],_editorCommandsLocalized:!1,_localizeEditorCommands:function(){if(H._editorCommandsLocalized)this._local2NativeFormatNames=H._local2NativeFormatNames,this._native2LocalFormatNames=H._native2LocalFormatNames;else{H._editorCommandsLocalized=!0;H._local2NativeFormatNames={};
H._native2LocalFormatNames={};this._local2NativeFormatNames=H._local2NativeFormatNames;this._native2LocalFormatNames=H._native2LocalFormatNames;for(var g="div p pre h1 h2 h3 h4 h5 h6 ol ul address".split(" "),B="",A,I=0;A=g[I++];)B="l"!==A.charAt(1)?B+("\x3c"+A+"\x3e\x3cspan\x3econtent\x3c/span\x3e\x3c/"+A+"\x3e\x3cbr/\x3e"):B+("\x3c"+A+"\x3e\x3cli\x3econtent\x3c/li\x3e\x3c/"+A+"\x3e\x3cbr/\x3e");var M=a.create("div",{style:{position:"absolute",top:"0px",zIndex:10,opacity:.01},innerHTML:B});this.ownerDocumentBody.appendChild(M);
g=w.hitch(this,function(){for(var R=M.firstChild;R;)try{this.selection.selectElement(R.firstChild);var S=R.tagName.toLowerCase();this._local2NativeFormatNames[S]=document.queryCommandValue("formatblock");this._native2LocalFormatNames[this._local2NativeFormatNames[S]]=S;R=R.nextSibling.nextSibling}catch(W){}a.destroy(M)});this.defer(g)}},open:function(g){if(!this.onLoadDeferred||0<=this.onLoadDeferred.fired)this.onLoadDeferred=new y;this.isClosed||this.close();x.publish(X._scopeName+"._editor.RichText::open",
this);1===arguments.length&&g.nodeName&&(this.domNode=g);var B=this.domNode;if(w.isString(this.value)){var A=this.value;B.innerHTML=""}else if(B.nodeName&&"textarea"==B.nodeName.toLowerCase()){var I=this.textarea=B;this.name=I.name;A=I.value;B=this.domNode=this.ownerDocument.createElement("div");B.setAttribute("widgetId",this.id);I.removeAttribute("widgetId");B.cssText=I.cssText;B.className+=" "+I.className;a.place(B,I,"before");var M=w.hitch(this,function(){l.set(I,{display:"block",position:"absolute",
top:"-1000px"});if(r("ie")){var V=I.style;this.__overflow=V.overflow;V.overflow="hidden"}});r("ie")?this.defer(M,10):M();if(I.form){var R=I.value;this.reset=function(){this.getValue()!==R&&this.replaceValue(R)};e(I.form,"submit",w.hitch(this,function(){c.set(I,"disabled",this.disabled);I.value=this.getValue()}))}}else A=P.getChildrenHtml(B),B.innerHTML="";this.value=A;B.nodeName&&"LI"===B.nodeName&&(B.innerHTML=" \x3cbr\x3e");this.header=B.ownerDocument.createElement("div");B.appendChild(this.header);
this.editingArea=B.ownerDocument.createElement("div");B.appendChild(this.editingArea);this.footer=B.ownerDocument.createElement("div");B.appendChild(this.footer);this.name||(this.name=this.id+"_AUTOGEN");if(""!==this.name&&(!v.useXDomain||v.allowXdRichTextSave)){if((A=m.byId(X._scopeName+"._editor.RichText.value"))&&""!==A.value){M=A.value.split(this._SEPARATOR);for(var S=0,W;W=M[S++];)if(W=W.split(this._NAME_CONTENT_SEP),W[0]===this.name){this.value=W[1];M=M.splice(S,1);A.value=M.join(this._SEPARATOR);
break}}H._globalSaveHandler||(H._globalSaveHandler={},C.addOnUnload(function(){for(var V in H._globalSaveHandler){var k=H._globalSaveHandler[V];w.isFunction(k)&&k()}}));H._globalSaveHandler[this.id]=w.hitch(this,"_saveContent")}this.isClosed=!1;A=this.editorObject=this.iframe=this.ownerDocument.createElement("iframe");A.id=this.id+"_iframe";A.style.border="none";A.style.width="100%";this._layoutMode?A.style.height="100%":7<=r("ie")?(this.height&&(A.style.height=this.height),this.minHeight&&(A.style.minHeight=
this.minHeight)):A.style.height=this.height?this.height:this.minHeight;A.frameBorder=0;A._loadFunc=w.hitch(this,function(V){this.window=V;this.document=V.document;this.selection=new T.SelectionManager(V);r("ie")&&this._localizeEditorCommands();this.onLoad(this.get("value"))});M=this._getIframeDocTxt().replace(/\\/g,"\\\\").replace(/'/g,"\\'");M=11>r("ie")?'javascript:document.open();try{parent.window;}catch(e){document.domain\x3d"'+document.domain+"\";}document.write('"+M+"');document.close()":"javascript: '"+
M+"'";this.editingArea.appendChild(A);A.src=M;"LI"===B.nodeName&&(B.lastChild.style.marginTop="-1.2em");f.add(this.domNode,this.baseClass)},_local2NativeFormatNames:{},_native2LocalFormatNames:{},_getIframeDocTxt:function(){var g=l.getComputedStyle(this.domNode);if(this["aria-label"])var B=this["aria-label"];else{var A=q('label[for\x3d"'+this.id+'"]',this.ownerDocument)[0]||m.byId(this["aria-labelledby"],this.ownerDocument);A&&(B=A.textContent||A.innerHTML||"")}A="\x3cdiv id\x3d'dijitEditorBody' role\x3d'textbox' aria-multiline\x3d'true' "+
(B?" aria-label\x3d'"+d.escape(B)+"'":"")+"\x3e\x3c/div\x3e";var I=[g.fontWeight,g.fontSize,g.fontFamily].join(" "),M=g.lineHeight;M=0<=M.indexOf("px")?parseFloat(M)/parseFloat(g.fontSize):0<=M.indexOf("em")?parseFloat(M):"normal";var R="",S=this;this.style.replace(/(^|;)\s*(line-|font-?)[^;]+/ig,function(W){W=W.replace(/^;/ig,"")+";";var V=W.split(":")[0];if(V){V=w.trim(V);V=V.toLowerCase();var k,F="";for(k=0;k<V.length;k++){var K=V.charAt(k);switch(K){case "-":k++,K=V.charAt(k).toUpperCase();default:F+=
K}}l.set(S.domNode,F,"")}R+=W+";"});this.iframe.setAttribute("title",B);return["\x3c!DOCTYPE html\x3e","\x3chtml lang\x3d'"+(this.lang||b.locale.replace(/-.*/,""))+"'"+(this.isLeftToRight()?"":" dir\x3d'rtl'")+"\x3e\n","\x3chead\x3e\n\x3cmeta http-equiv\x3d'Content-Type' content\x3d'text/html'\x3e\n",B?"\x3ctitle\x3e"+d.escape(B)+"\x3c/title\x3e":"","\x3cstyle\x3e\n\tbody,html {\n\t\tbackground:transparent;\n\t\tpadding: 1px 0 0 0;\n\t\tmargin: -1px 0 0 0;\n\t}\n\tbody,html,#dijitEditorBody { outline: none; }html { height: 100%; width: 100%; overflow: hidden; }\n",
this.height?"\tbody,#dijitEditorBody { height: 100%; width: 100%; overflow: auto; }\n":"\tbody,#dijitEditorBody { min-height: "+this.minHeight+"; width: 100%; overflow-x: auto; overflow-y: hidden; }\n","\tbody{\n\t\ttop:0px;\n\t\tleft:0px;\n\t\tright:0px;\n\t\tfont:",I,";\n",this.height||r("opera")?"":"\t\tposition: fixed;\n","\t\tline-height:",M,";\n\t}\n\tp{ margin: 1em 0; }\n\tli \x3e ul:-moz-first-node, li \x3e ol:-moz-first-node{ padding-top: 1.2em; }\n",r("ie")||r("trident")||r("edge")?"":"\tli{ min-height:1.2em; }\n",
"\x3c/style\x3e\n",this._applyEditingAreaStyleSheets(),"\n\x3c/head\x3e\n\x3cbody role\x3d'application'",B?" aria-label\x3d'"+d.escape(B)+"'":"","onload\x3d'try{frameElement \x26\x26 frameElement._loadFunc(window,document)}catch(e){document.domain\x3d\""+document.domain+"\";frameElement._loadFunc(window,document)}' ","style\x3d'"+R+"'\x3e",A,"\x3c/body\x3e\n\x3c/html\x3e"].join("")},_applyEditingAreaStyleSheets:function(){var g=[];this.styleSheets&&(g=this.styleSheets.split(";"),this.styleSheets=
"");g=g.concat(this.editingAreaStyleSheets);this.editingAreaStyleSheets=[];for(var B="",A=0,I,M=t.get(this.ownerDocument);I=g[A++];)I=(new L(M.location,I)).toString(),this.editingAreaStyleSheets.push(I),B+='\x3clink rel\x3d"stylesheet" type\x3d"text/css" href\x3d"'+I+'"/\x3e';return B},addStyleSheet:function(g){var B=g.toString(),A=t.get(this.ownerDocument);if("."===B.charAt(0)||"/"!==B.charAt(0)&&!g.host)B=(new L(A.location,B)).toString();-1<N.indexOf(this.editingAreaStyleSheets,B)||(this.editingAreaStyleSheets.push(B),
this.onLoadDeferred.then(w.hitch(this,function(){if(this.document.createStyleSheet)this.document.createStyleSheet(B);else{var I=this.document.getElementsByTagName("head")[0],M=this.document.createElement("link");M.rel="stylesheet";M.type="text/css";M.href=B;I.appendChild(M)}})))},removeStyleSheet:function(g){var B=g.toString(),A=t.get(this.ownerDocument);if("."===B.charAt(0)||"/"!==B.charAt(0)&&!g.host)B=(new L(A.location,B)).toString();g=N.indexOf(this.editingAreaStyleSheets,B);-1!==g&&(delete this.editingAreaStyleSheets[g],
q('link[href\x3d"'+B+'"]',this.window.document).orphan())},disabled:!1,_mozSettingProps:{styleWithCSS:!1},_setDisabledAttr:function(g){g=!!g;this._set("disabled",g);if(this.isLoaded){var B=r("ie")&&(this.isLoaded||!this.focusOnLoad);B&&(this.editNode.unselectable="on");this.editNode.contentEditable=!g;this.editNode.tabIndex=g?"-1":this.tabIndex;B&&this.defer(function(){this.editNode&&(this.editNode.unselectable="off")});if(r("mozilla")&&!g&&this._mozSettingProps){g=this._mozSettingProps;for(var A in g)if(g.hasOwnProperty(A))try{this.document.execCommand(A,
!1,g[A])}catch(I){}}this._disabledOK=!0}},onLoad:function(g){this.window.__registeredWindow||(this.window.__registeredWindow=!0,this._iframeRegHandle=O.registerIframe(this.iframe));this.editNode=this.document.body.firstChild;var B=this;this.beforeIframeNode=a.place("\x3cdiv tabIndex\x3d-1\x3e\x3c/div\x3e",this.iframe,"before");this.afterIframeNode=a.place("\x3cdiv tabIndex\x3d-1\x3e\x3c/div\x3e",this.iframe,"after");this.iframe.onfocus=this.document.onfocus=function(){B.editNode.focus()};this.focusNode=
this.editNode;var A=this.events.concat(this.captureEvents),I=this.iframe?this.document:this.editNode;this.own.apply(this,N.map(A,function(M){var R=M.toLowerCase().replace(/^on/,"");return e(I,R,w.hitch(this,M))},this));this.own(e(I,"mouseup",w.hitch(this,"onClick")));r("ie")&&(this.own(e(this.document,"mousedown",w.hitch(this,"_onIEMouseDown"))),this.editNode.style.zoom=1);r("webkit")&&(this._webkitListener=this.own(e(this.document,"mouseup",w.hitch(this,"onDisplayChanged")))[0],this.own(e(this.document,
"mousedown",w.hitch(this,function(M){M=M.target;!M||M!==this.document.body&&M!==this.document||this.defer("placeCursorAtEnd")}))));if(r("ie"))try{this.document.execCommand("RespectVisibilityInDesign",!0,null)}catch(M){}this.isLoaded=!0;this.set("disabled",this.disabled);A=w.hitch(this,function(){this.setValue(g);this.onLoadDeferred&&!this.onLoadDeferred.isFulfilled()&&this.onLoadDeferred.resolve(!0);this.onDisplayChanged();this.focusOnLoad&&h(w.hitch(this,"defer","focus",this.updateInterval));this.value=
this.getValue(!0)});this.setValueDeferred?this.setValueDeferred.then(A):A()},onKeyDown:function(g){if(g.keyCode===u.SHIFT||g.keyCode===u.ALT||g.keyCode===u.META||g.keyCode===u.CTRL)return!0;g.keyCode===u.TAB&&this.isTabIndent&&(g.stopPropagation(),g.preventDefault(),this.queryCommandEnabled(g.shiftKey?"outdent":"indent")&&this.execCommand(g.shiftKey?"outdent":"indent"));if(g.keyCode==u.TAB&&!this.isTabIndent&&!g.ctrlKey&&!g.altKey)return g.shiftKey?this.beforeIframeNode.focus():this.afterIframeNode.focus(),
!0;9>r("ie")&&g.keyCode===u.BACKSPACE&&"Control"===this.document.selection.type&&(g.stopPropagation(),g.preventDefault(),this.execCommand("delete"));r("ff")&&(g.keyCode===u.PAGE_UP||g.keyCode===u.PAGE_DOWN)&&this.editNode.clientHeight>=this.editNode.scrollHeight&&g.preventDefault();var B=this._keyHandlers[g.keyCode],A=arguments;B&&!g.altKey&&N.some(B,function(I){if(!(I.shift^g.shiftKey||I.ctrl^(g.ctrlKey||g.metaKey)))return I.handler.apply(this,A)||g.preventDefault(),!0},this);this.defer("onKeyPressed",
1);return!0},onKeyUp:function(){},setDisabled:function(g){b.deprecated("dijit.Editor::setDisabled is deprecated",'use dijit.Editor::attr("disabled",boolean) instead',2);this.set("disabled",g)},_setValueAttr:function(g){this.setValue(g)},_setDisableSpellCheckAttr:function(g){this.document?c.set(this.document.body,"spellcheck",!g):this.onLoadDeferred.then(w.hitch(this,function(){c.set(this.document.body,"spellcheck",!g)}));this._set("disableSpellCheck",g)},addKeyHandler:function(g,B,A,I){"string"==
typeof g&&(g=g.toUpperCase().charCodeAt(0));w.isArray(this._keyHandlers[g])||(this._keyHandlers[g]=[]);this._keyHandlers[g].push({shift:A||!1,ctrl:B||!1,handler:I})},onKeyPressed:function(){this.onDisplayChanged()},onClick:function(g){this.onDisplayChanged(g)},_onIEMouseDown:function(){this.focused||this.disabled||this.focus()},_onBlur:function(g){(r("ie")||r("trident"))&&this.defer(function(){O.curNode||this.ownerDocumentBody.focus()});this.inherited(arguments);var B=this.getValue(!0);if(B!==this.value)this.onChange(B);
this._set("value",B)},_onFocus:function(g){this.disabled||(this._disabledOK||this.set("disabled",!1),this.inherited(arguments))},blur:function(){!r("ie")&&this.window.document.documentElement&&this.window.document.documentElement.focus?this.window.document.documentElement.focus():this.ownerDocumentBody.focus&&this.ownerDocumentBody.focus()},focus:function(){this.isLoaded?9>r("ie")?this.iframe.fireEvent("onfocus",document.createEventObject()):this.editNode.focus():this.focusOnLoad=!0},updateInterval:200,
_updateTimer:null,onDisplayChanged:function(){this._updateTimer&&this._updateTimer.remove();this._updateTimer=this.defer("onNormalizedDisplayChanged",this.updateInterval)},onNormalizedDisplayChanged:function(){delete this._updateTimer},onChange:function(){},_normalizeCommand:function(g,B){g=g.toLowerCase();"formatblock"===g?r("safari")&&void 0===B&&(g="heading"):"hilitecolor"!==g||r("mozilla")||(g="backcolor");return g},_implCommand:function(g){return"_"+this._normalizeCommand(g)+"EnabledImpl"},_qcaCache:{},
queryCommandAvailable:function(g){var B=this._qcaCache[g];return void 0!==B?B:this._qcaCache[g]=this._queryCommandAvailable(g)},_queryCommandAvailable:function(g){switch(g.toLowerCase()){case "bold":case "italic":case "underline":case "subscript":case "superscript":case "fontname":case "fontsize":case "forecolor":case "hilitecolor":case "justifycenter":case "justifyfull":case "justifyleft":case "justifyright":case "delete":case "selectall":case "toggledir":case "createlink":case "unlink":case "removeformat":case "inserthorizontalrule":case "insertimage":case "insertorderedlist":case "insertunorderedlist":case "indent":case "outdent":case "formatblock":case "inserthtml":case "undo":case "redo":case "strikethrough":case "tabindent":case "cut":case "copy":case "paste":return!0;
case "blockdirltr":case "blockdirrtl":case "dirltr":case "dirrtl":case "inlinedirltr":case "inlinedirrtl":return r("ie")||r("trident")||r("edge");case "inserttable":case "insertcell":case "insertcol":case "insertrow":case "deletecells":case "deletecols":case "deleterows":case "mergecells":case "splitcell":return!r("webkit");default:return!1}},execCommand:function(g,B){this.focused&&this.focus();g=this._normalizeCommand(g,B);if(void 0!==B){if("heading"===g)throw Error("unimplemented");"formatblock"===
g&&(r("ie")||r("trident"))&&(B="\x3c"+B+"\x3e")}var A="_"+g+"Impl";if(this[A])var I=this[A](B);else if((B=1<arguments.length?B:null)||"createlink"!==g)I=this.document.execCommand(g,!1,B);this.onDisplayChanged();return I},queryCommandEnabled:function(g){if(this.disabled||!this._disabledOK)return!1;g=this._normalizeCommand(g);var B=this._implCommand(g);return this[B]?this[B](g):this._browserQueryCommandEnabled(g)},queryCommandState:function(g){if(this.disabled||!this._disabledOK)return!1;g=this._normalizeCommand(g);
try{return this.document.queryCommandState(g)}catch(B){return!1}},queryCommandValue:function(g){if(this.disabled||!this._disabledOK)return!1;g=this._normalizeCommand(g);if(r("ie")&&"formatblock"===g)g=this._native2LocalFormatNames[this.document.queryCommandValue(g)];else if(r("mozilla")&&"hilitecolor"===g){try{var B=this.document.queryCommandValue("styleWithCSS")}catch(A){B=!1}this.document.execCommand("styleWithCSS",!1,!0);g=this.document.queryCommandValue(g);this.document.execCommand("styleWithCSS",
!1,B)}else g=this.document.queryCommandValue(g);return g},_sCall:function(g,B){return this.selection[g].apply(this.selection,B)},placeCursorAtStart:function(){this.focus();var g=!1;if(r("mozilla"))for(var B=this.editNode.firstChild;B;){if(3===B.nodeType){if(0<B.nodeValue.replace(/^\s+|\s+$/g,"").length){g=!0;this.selection.selectElement(B);break}}else if(1===B.nodeType){g=!0;var A=B.tagName?B.tagName.toLowerCase():"";/br|input|img|base|meta|area|basefont|hr|link/.test(A)?this.selection.selectElement(B):
this.selection.selectElementChildren(B);break}B=B.nextSibling}else g=!0,this.selection.selectElementChildren(this.editNode);g&&this.selection.collapse(!0)},placeCursorAtEnd:function(){this.focus();var g=!1;if(r("mozilla"))for(var B=this.editNode.lastChild;B;){if(3===B.nodeType){if(0<B.nodeValue.replace(/^\s+|\s+$/g,"").length){g=!0;this.selection.selectElement(B);break}}else if(1===B.nodeType){g=!0;this.selection.selectElement(B.lastChild||B);break}B=B.previousSibling}else g=!0,this.selection.selectElementChildren(this.editNode);
g&&this.selection.collapse(!1)},getValue:function(g){return!this.textarea||!this.isClosed&&this.isLoaded?this.isLoaded?this._postFilterContent(null,g):this.value:this.textarea.value},_getValueAttr:function(){return this.getValue(!0)},setValue:function(g){if(this.isLoaded){if(!this.textarea||!this.isClosed&&this.isLoaded){g=this._preFilterContent(g);var B=this.isClosed?this.domNode:this.editNode;B.innerHTML=g;this._preDomFilterContent(B)}else this.textarea.value=g;this.onDisplayChanged();this._set("value",
this.getValue(!0))}else this.onLoadDeferred.then(w.hitch(this,function(){this.setValue(g)}))},replaceValue:function(g){this.isClosed?this.setValue(g):this.window&&this.window.getSelection&&!r("mozilla")?this.setValue(g):this.window&&this.window.getSelection?(g=this._preFilterContent(g),this.execCommand("selectall"),this.execCommand("inserthtml",g),this._preDomFilterContent(this.editNode)):this.document&&this.document.selection&&this.setValue(g);this._set("value",this.getValue(!0))},_preFilterContent:function(g){var B=
g;N.forEach(this.contentPreFilters,function(A){A&&(B=A(B))});return B},_preDomFilterContent:function(g){g=g||this.editNode;N.forEach(this.contentDomPreFilters,function(B){B&&w.isFunction(B)&&B(g)},this)},_postFilterContent:function(g,B){if(w.isString(g))var A=g;else g=g||this.editNode,this.contentDomPostFilters.length&&(B&&(g=w.clone(g)),N.forEach(this.contentDomPostFilters,function(I){g=I(g)})),A=P.getChildrenHtml(g);w.trim(A.replace(/^\xA0\xA0*/,"").replace(/\xA0\xA0*$/,"")).length||(A="");N.forEach(this.contentPostFilters,
function(I){A=I(A)});return A},_saveContent:function(){var g=m.byId(X._scopeName+"._editor.RichText.value");g&&(g.value&&(g.value+=this._SEPARATOR),g.value+=this.name+this._NAME_CONTENT_SEP+this.getValue(!0))},escapeXml:function(g,B){g=g.replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;");B||(g=g.replace(/'/gm,"\x26#39;"));return g},getNodeHtml:function(g){b.deprecated("dijit.Editor::getNodeHtml is deprecated","use dijit/_editor/html::getNodeHtml instead",
2);return P.getNodeHtml(g)},getNodeChildrenHtml:function(g){b.deprecated("dijit.Editor::getNodeChildrenHtml is deprecated","use dijit/_editor/html::getChildrenHtml instead",2);return P.getChildrenHtml(g)},close:function(g){if(!this.isClosed){arguments.length||(g=!0);g&&this._set("value",this.getValue(!0));this.interval&&clearInterval(this.interval);this._webkitListener&&(this._webkitListener.remove(),delete this._webkitListener);r("ie")&&(this.iframe.onfocus=null);this.iframe._loadFunc=null;this._iframeRegHandle&&
(this._iframeRegHandle.remove(),delete this._iframeRegHandle);if(this.textarea){var B=this.textarea.style;B.position="";B.left=B.top="";r("ie")&&(B.overflow=this.__overflow,this.__overflow=null);this.textarea.value=this.value;a.destroy(this.domNode);this.domNode=this.textarea}else this.domNode.innerHTML=this.value;delete this.iframe;f.remove(this.domNode,this.baseClass);this.isClosed=!0;this.isLoaded=!1;delete this.editNode;delete this.focusNode;this.window&&this.window._frameElement&&(this.window._frameElement=
null);this.editorObject=this.editingArea=this.document=this.window=null}},destroy:function(){this.isClosed||this.close(!1);this._updateTimer&&this._updateTimer.remove();this.inherited(arguments);H._globalSaveHandler&&delete H._globalSaveHandler[this.id]},_removeMozBogus:function(g){return g.replace(/\stype="_moz"/gi,"").replace(/\s_moz_dirty=""/gi,"").replace(/_moz_resizing="(true|false)"/gi,"")},_removeWebkitBogus:function(g){g=g.replace(/\sclass="webkit-block-placeholder"/gi,"");g=g.replace(/\sclass="apple-style-span"/gi,
"");return g=g.replace(/<meta charset="utf-8" \/>/gi,"")},_normalizeFontStyle:function(g){return g.replace(/<(\/)?strong([ >])/gi,"\x3c$1b$2").replace(/<(\/)?em([ >])/gi,"\x3c$1i$2")},_preFixUrlAttributes:function(g){return g.replace(/(?:(<a(?=\s).*?\shref=)("|')(.*?)\2)|(?:(<a\s.*?href=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl\x3d$2$3$5$2").replace(/(?:(<img(?=\s).*?\ssrc=)("|')(.*?)\2)|(?:(<img\s.*?src=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl\x3d$2$3$5$2")},_browserQueryCommandEnabled:function(g){if(!g)return!1;
if(r("ie")||r("trident")||r("edge"))return this.focused&&!this.disabled;var B=9>r("ie")?this.document.selection.createRange():this.document;try{return B.queryCommandEnabled(g)}catch(A){return!1}},_createlinkEnabledImpl:function(){var g=!0;return g=r("opera")?this.window.getSelection().isCollapsed?!0:this.document.queryCommandEnabled("createlink"):this._browserQueryCommandEnabled("createlink")},_unlinkEnabledImpl:function(){var g=!0;return g=r("mozilla")||r("webkit")||r("ie")||r("trident")||r("edge")?
this.selection.hasAncestorElement("a"):this._browserQueryCommandEnabled("unlink")},_inserttableEnabledImpl:function(){var g=!0;return g=r("mozilla")||r("webkit")?!0:this._browserQueryCommandEnabled("inserttable")},_cutEnabledImpl:function(){var g=!0;r("webkit")?((g=this.window.getSelection())&&(g=g.toString()),g=!!g):g=this._browserQueryCommandEnabled("cut");return g},_copyEnabledImpl:function(){var g=!0;r("webkit")?((g=this.window.getSelection())&&(g=g.toString()),g=!!g):g=this._browserQueryCommandEnabled("copy");
return g},_pasteEnabledImpl:function(){var g=!0;return r("webkit")?!0:g=this._browserQueryCommandEnabled("paste")},_inserthorizontalruleImpl:function(g){return r("ie")?this._inserthtmlImpl("\x3chr\x3e"):this.document.execCommand("inserthorizontalrule",!1,g)},_unlinkImpl:function(g){return this.queryCommandEnabled("unlink")&&(r("mozilla")||r("webkit"))?(g=this.selection.getAncestorElement("a"),this.selection.selectElement(g),this.document.execCommand("unlink",!1,null)):this.document.execCommand("unlink",
!1,g)},_hilitecolorImpl:function(g){if(!this._handleTextColorOrProperties("hilitecolor",g))if(r("mozilla")){this.document.execCommand("styleWithCSS",!1,!0);console.log("Executing color command.");var B=this.document.execCommand("hilitecolor",!1,g);this.document.execCommand("styleWithCSS",!1,!1)}else B=this.document.execCommand("hilitecolor",!1,g);return B},_backcolorImpl:function(g){r("ie")&&(g=g?g:null);var B=this._handleTextColorOrProperties("backcolor",g);B||(B=this.document.execCommand("backcolor",
!1,g));return B},_forecolorImpl:function(g){r("ie")&&(g=g?g:null);var B=!1;(B=this._handleTextColorOrProperties("forecolor",g))||(B=this.document.execCommand("forecolor",!1,g));return B},_inserthtmlImpl:function(g){g=this._preFilterContent(g);var B=!0;if(9>r("ie")){var A=this.document.selection.createRange();if("CONTROL"===this.document.selection.type.toUpperCase()){for(var I=A.item(0);A.length;)A.remove(A.item(0));I.outerHTML=g}else A.pasteHTML(g);A.select()}else if(8>r("trident")){var M=D.getSelection(this.window);
if(M&&M.rangeCount&&M.getRangeAt){A=M.getRangeAt(0);A.deleteContents();var R=a.create("div");R.innerHTML=g;for(I=this.document.createDocumentFragment();g=R.firstChild;)var S=I.appendChild(g);A.insertNode(I);S&&(A=A.cloneRange(),A.setStartAfter(S),A.collapse(!1),M.removeAllRanges(),M.addRange(A))}}else r("mozilla")&&!g.length?this.selection.remove():B=this.document.execCommand("inserthtml",!1,g);return B},_boldImpl:function(g){var B=!1;if(r("ie")||r("trident"))this._adaptIESelection(),B=this._adaptIEFormatAreaAndExec("bold");
B||(B=this.document.execCommand("bold",!1,g));return B},_italicImpl:function(g){var B=!1;if(r("ie")||r("trident"))this._adaptIESelection(),B=this._adaptIEFormatAreaAndExec("italic");B||(B=this.document.execCommand("italic",!1,g));return B},_underlineImpl:function(g){var B=!1;if(r("ie")||r("trident"))this._adaptIESelection(),B=this._adaptIEFormatAreaAndExec("underline");B||(B=this.document.execCommand("underline",!1,g));return B},_strikethroughImpl:function(g){var B=!1;if(r("ie")||r("trident"))this._adaptIESelection(),
B=this._adaptIEFormatAreaAndExec("strikethrough");B||(B=this.document.execCommand("strikethrough",!1,g));return B},_superscriptImpl:function(g){var B=!1;if(r("ie")||r("trident"))this._adaptIESelection(),B=this._adaptIEFormatAreaAndExec("superscript");B||(B=this.document.execCommand("superscript",!1,g));return B},_subscriptImpl:function(g){var B=!1;if(r("ie")||r("trident"))this._adaptIESelection(),B=this._adaptIEFormatAreaAndExec("subscript");B||(B=this.document.execCommand("subscript",!1,g));return B},
_fontnameImpl:function(g){if(r("ie")||r("trident"))var B=this._handleTextColorOrProperties("fontname",g);B||(B=this.document.execCommand("fontname",!1,g));return B},_fontsizeImpl:function(g){if(r("ie")||r("trident"))var B=this._handleTextColorOrProperties("fontsize",g);B||(B=this.document.execCommand("fontsize",!1,g));return B},_insertorderedlistImpl:function(g){var B=!1;if(r("ie")||r("trident")||r("edge"))B=this._adaptIEList("insertorderedlist",g);B||(B=this.document.execCommand("insertorderedlist",
!1,g));return B},_insertunorderedlistImpl:function(g){var B=!1;if(r("ie")||r("trident")||r("edge"))B=this._adaptIEList("insertunorderedlist",g);B||(B=this.document.execCommand("insertunorderedlist",!1,g));return B},getHeaderHeight:function(){return this._getNodeChildrenHeight(this.header)},getFooterHeight:function(){return this._getNodeChildrenHeight(this.footer)},_getNodeChildrenHeight:function(g){var B=0;if(g&&g.childNodes){var A;for(A=0;A<g.childNodes.length;A++){var I=n.position(g.childNodes[A]);
B+=I.h}}return B},_isNodeEmpty:function(g,B){return 1===g.nodeType?0<g.childNodes.length?this._isNodeEmpty(g.childNodes[0],B):!0:3===g.nodeType?""===g.nodeValue.substring(B):!1},_removeStartingRangeFromRange:function(g,B){if(g.nextSibling)B.setStart(g.nextSibling,0);else{for(g=g.parentNode;g&&null==g.nextSibling;)g=g.parentNode;g&&B.setStart(g.nextSibling,0)}return B},_adaptIESelection:function(){var g=D.getSelection(this.window);if(g&&g.rangeCount&&!g.isCollapsed){for(var B=g.getRangeAt(0),A=B.startContainer,
I=B.startOffset;3===A.nodeType&&I>=A.length&&A.nextSibling;)I-=A.length,A=A.nextSibling;for(var M=null;this._isNodeEmpty(A,I)&&A!==M;)M=A,B=this._removeStartingRangeFromRange(A,B),A=B.startContainer,I=0;g.removeAllRanges();g.addRange(B)}},_adaptIEFormatAreaAndExec:function(g){var B=D.getSelection(this.window),A=this.document,I;if(g&&B&&B.isCollapsed){if(this.queryCommandValue(g)){g=this._tagNamesForCommand(g);var M=B.getRangeAt(0);var R=M.startContainer;if(3===R.nodeType){var S=M.endOffset;R.length<
S&&(S=this._adjustNodeAndOffset(W,S),R=S.node,S=S.offset)}for(;R&&R!==this.editNode;){var W=R.tagName?R.tagName.toLowerCase():"";if(-1<N.indexOf(g,W)){var V=R;break}R=R.parentNode}if(V&&(W=M.startContainer,g=A.createElement(V.tagName),a.place(g,V,"after"),W&&3===W.nodeType)){S=M.endOffset;W.length<S&&(S=this._adjustNodeAndOffset(W,S),W=S.node,S=S.offset);R=W.nodeValue;M=A.createTextNode(R.substring(0,S));var k=R.substring(S,R.length);k&&(I=A.createTextNode(k));a.place(M,W,"before");if(I){var F=A.createElement("span");
F.className="ieFormatBreakerSpan";a.place(F,W,"after");a.place(I,F,"after");I=F}a.destroy(W);S=M.parentNode;for(W=[];S!==V;){R=S.tagName;M={tagName:R};W.push(M);R=A.createElement(R);S.style&&R.style&&S.style.cssText&&(R.style.cssText=S.style.cssText,M.cssText=S.style.cssText);"FONT"===S.tagName&&(S.color&&(R.color=S.color,M.color=S.color),S.face&&(R.face=S.face,M.face=S.face),S.size&&(R.size=S.size,M.size=S.size));S.className&&(R.className=S.className,M.className=S.className);if(I)for(;I;)M=I.nextSibling,
R.appendChild(I),I=M;R.tagName==S.tagName?(F=A.createElement("span"),F.className="ieFormatBreakerSpan",a.place(F,S,"after"),a.place(R,F,"after")):a.place(R,S,"after");M=S;I=R;S=S.parentNode}if(I){if(1===I.nodeType||3===I.nodeType&&I.nodeValue)g.innerHTML="";for(;I;)M=I.nextSibling,g.appendChild(I),I=M}if(W.length){M=W.pop();I=A.createElement(M.tagName);M.cssText&&I.style&&(I.style.cssText=M.cssText);M.className&&(I.className=M.className);"FONT"===M.tagName&&(M.color&&(I.color=M.color),M.face&&(I.face=
M.face),M.size&&(I.size=M.size));for(a.place(I,g,"before");W.length;)M=W.pop(),V=A.createElement(M.tagName),M.cssText&&V.style&&(V.style.cssText=M.cssText),M.className&&(V.className=M.className),"FONT"===M.tagName&&(M.color&&(V.color=M.color),M.face&&(V.face=M.face),M.size&&(V.size=M.size)),I.appendChild(V),I=V;V=A.createTextNode(".");F.appendChild(V);I.appendChild(V)}else F=A.createElement("span"),F.className="ieFormatBreakerSpan",V=A.createTextNode("."),F.appendChild(V),a.place(F,g,"before");I=
D.create(this.window);I.setStart(V,0);I.setEnd(V,V.length);B.removeAllRanges();B.addRange(I);this.selection.collapse(!1);V.parentNode.innerHTML="";g.firstChild||a.destroy(g);return!0}return!1}M=B.getRangeAt(0);if((W=M.startContainer)&&3===W.nodeType)return S=M.startOffset,W.length<S&&(S=this._adjustNodeAndOffset(W,S),W=S.node,S=S.offset),R=W.nodeValue,M=A.createTextNode(R.substring(0,S)),k=R.substring(S),""!==k&&(I=A.createTextNode(R.substring(S))),F=A.createElement("span"),V=A.createTextNode("."),
F.appendChild(V),M.length?a.place(M,W,"after"):M=W,a.place(F,M,"after"),I&&a.place(I,F,"after"),a.destroy(W),I=D.create(this.window),I.setStart(V,0),I.setEnd(V,V.length),B.removeAllRanges(),B.addRange(I),A.execCommand(g),a.place(F.firstChild,F,"before"),a.destroy(F),I.setStart(V,0),I.setEnd(V,V.length),B.removeAllRanges(),B.addRange(I),this.selection.collapse(!1),V.parentNode.innerHTML="",!0}else return!1},_adaptIEList:function(g){var B=D.getSelection(this.window);if(B.isCollapsed&&B.rangeCount&&
!this.queryCommandValue(g)){var A=B.getRangeAt(0),I=A.startContainer;if(I&&3==I.nodeType&&!A.startOffset)return A="ul","insertorderedlist"===g&&(A="ol"),g=this.document.createElement(A),A=a.create("li",null,g),a.place(g,I,"before"),A.appendChild(I),a.create("br",null,g,"after"),g=D.create(this.window),g.setStart(I,0),g.setEnd(I,I.length),B.removeAllRanges(),B.addRange(g),this.selection.collapse(!0),!0}return!1},_handleTextColorOrProperties:function(g,B){var A=D.getSelection(this.window),I=this.document,
M,R;B=B||null;if(g&&A&&A.isCollapsed&&A.rangeCount){var S=A.getRangeAt(0);if((M=S.startContainer)&&3===M.nodeType){var W=S.startOffset;M.length<W&&(S=this._adjustNodeAndOffset(M,W),M=S.node,W=S.offset);var V=M.nodeValue;S=I.createTextNode(V.substring(0,W));""!==V.substring(W)&&(R=I.createTextNode(V.substring(W)));V=I.createElement("span");W=I.createTextNode(".");V.appendChild(W);I=I.createElement("span");V.appendChild(I);S.length?a.place(S,M,"after"):S=M;a.place(V,S,"after");R&&a.place(R,V,"after");
a.destroy(M);M=D.create(this.window);M.setStart(W,0);M.setEnd(W,W.length);A.removeAllRanges();A.addRange(M);if(r("webkit")){A="color";if("hilitecolor"===g||"backcolor"===g)A="backgroundColor";l.set(V,A,B);this.selection.remove();a.destroy(I);V.innerHTML="\x26#160;";this.selection.selectElement(V);this.focus()}else this.execCommand(g,B),a.place(V.firstChild,V,"before"),a.destroy(V),M.setStart(W,0),M.setEnd(W,W.length),A.removeAllRanges(),A.addRange(M),this.selection.collapse(!1),W.parentNode.removeChild(W);
return!0}}return!1},_adjustNodeAndOffset:function(g,B){for(;g.length<B&&g.nextSibling&&3===g.nextSibling.nodeType;)B-=g.length,g=g.nextSibling;return{node:g,offset:B}},_tagNamesForCommand:function(g){return"bold"===g?["b","strong"]:"italic"===g?["i","em"]:"strikethrough"===g?["s","strike"]:"superscript"===g?["sup"]:"subscript"===g?["sub"]:"underline"===g?["u"]:[]},_stripBreakerNodes:function(g){if(this.isLoaded)return q(".ieFormatBreakerSpan",g).forEach(function(B){for(;B.firstChild;)a.place(B.firstChild,
B,"before");a.destroy(B)}),g},_stripTrailingEmptyNodes:function(g){function B(A){return/^(p|div|br)$/i.test(A.nodeName)&&0==A.children.length&&/^[\s\xA0]*$/.test(A.textContent||A.innerText||"")||3===A.nodeType&&/^[\s\xA0]*$/.test(A.nodeValue)}for(;g.lastChild&&B(g.lastChild);)a.destroy(g.lastChild);return g},_setTextDirAttr:function(g){this._set("textDir",g);this.onLoadDeferred.then(w.hitch(this,function(){this.editNode.dir=g}))}});return H})},"dijit/_editor/range":function(){define(["dojo/_base/array",
"dojo/_base/declare","dojo/_base/lang"],function(N,v,z){var y={getIndex:function(f,a){for(var n=[],l=[],b=f,u,w;f!=a;){var e=0;for(u=f.parentNode;w=u.childNodes[e++];)if(w===f){--e;break}n.unshift(e);l.unshift(e-u.childNodes.length);f=u}if(0<n.length&&3==b.nodeType){for(w=b.previousSibling;w&&3==w.nodeType;)n[n.length-1]--,w=w.previousSibling;for(w=b.nextSibling;w&&3==w.nodeType;)l[l.length-1]++,w=w.nextSibling}return{o:n,r:l}},getNode:function(f,a){if(!z.isArray(f)||0==f.length)return a;var n=a;
N.every(f,function(l){if(0<=l&&l<n.childNodes.length)n=n.childNodes[l];else return n=null,!1;return!0});return n},getCommonAncestor:function(f,a,n){n=n||f.ownerDocument.body;var l=function(w){for(var e=[];w;)if(e.unshift(w),w!==n)w=w.parentNode;else break;return e};f=l(f);a=l(a);l=Math.min(f.length,a.length);for(var b=f[0],u=1;u<l;u++)if(f[u]===a[u])b=f[u];else break;return b},getAncestor:function(f,a,n){for(n=n||f.ownerDocument.body;f&&f!==n;){var l=f.nodeName.toUpperCase();if(a.test(l))return f;
f=f.parentNode}return null},BlockTagNames:/^(?:P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|DT|DE)$/,getBlockAncestor:function(f,a,n){n=n||f.ownerDocument.body;a=a||y.BlockTagNames;for(var l=null,b;f&&f!==n;){var u=f.nodeName.toUpperCase();!l&&a.test(u)&&(l=f);!b&&/^(?:BODY|TD|TH|CAPTION)$/.test(u)&&(b=f);f=f.parentNode}return{blockNode:l,blockContainer:b||f.ownerDocument.body}},atBeginningOfContainer:function(f,a,n){var l=!1,b=0==n;b||3!=a.nodeType||/^[\s\xA0]+$/.test(a.nodeValue.substr(0,n))&&(b=
!0);if(b)for(l=!0;a&&a!==f;){if(a.previousSibling){l=!1;break}a=a.parentNode}return l},atEndOfContainer:function(f,a,n){var l=!1,b=n==(a.length||a.childNodes.length);b||3!=a.nodeType||/^[\s\xA0]+$/.test(a.nodeValue.substr(n))&&(b=!0);if(b)for(l=!0;a&&a!==f;){if(a.nextSibling){l=!1;break}a=a.parentNode}return l},adjacentNoneTextNode:function(f,a){var n=f;f=0-f.length||0;for(a=a?"nextSibling":"previousSibling";n&&3==n.nodeType;)f+=n.length,n=n[a];return[n,f]},create:function(f){f=f||window;return f.getSelection?
f.document.createRange():new c},getSelection:function(f,a){if(f.getSelection)return f.getSelection();f=new m.selection(f);a||f._getCurrentSelection();return f}};if(!window.getSelection)var m=y.ie={cachedSelection:{},selection:function(f){this._ranges=[];this.addRange=function(a,n){this._ranges.push(a);n||a._select();this.rangeCount=this._ranges.length};this.removeAllRanges=function(){this._ranges=[];this.rangeCount=0};this.getRangeAt=function(a){return this._ranges[a]};this._getCurrentSelection=function(){this.removeAllRanges();
var a=f.document.selection.createRange();a="CONTROL"==f.document.selection.type.toUpperCase()?new c(m.decomposeControlRange(a)):new c(m.decomposeTextRange(a));this.addRange(a,!0),this.isCollapsed=a.collapsed}},decomposeControlRange:function(f){var a=f.item(0),n=f.item(f.length-1);f=a.parentNode;var l=n.parentNode;a=y.getIndex(a,f).o[0];n=y.getIndex(n,l).o[0]+1;return[f,a,l,n]},getEndPoint:function(f,a){var n=f.duplicate();n.collapse(!a);var l="EndTo"+(a?"End":"Start"),b=n.parentElement(),u;if(0<b.childNodes.length)N.every(b.childNodes,
function(q,h){if(3!=q.nodeType)if(n.moveToElementText(q),0<n.compareEndPoints(l,f))if(u&&3==u.nodeType){w=u;var r=!0}else return w=b,e=h,!1;else{if(h==b.childNodes.length-1)return w=b,e=b.childNodes.length,!1}else h==b.childNodes.length-1&&(w=q,r=!0);if(r&&w)return w=(q=y.adjacentNoneTextNode(w)[0])?q.nextSibling:b.firstChild,h=y.adjacentNoneTextNode(w),q=h[0],h=h[1],q?(n.moveToElementText(q),n.collapse(!1)):n.moveToElementText(b),n.setEndPoint(l,f),e=n.text.length-h,!1;u=q;return!0});else{var w=
b;var e=0}a||1!=w.nodeType||e!=w.childNodes.length||(a=w.nextSibling)&&3==a.nodeType&&(w=a,e=0);return[w,e]},setEndPoint:function(f,a,n){f=f.duplicate();var l;if(3!=a.nodeType)if(0<n){if(l=a.childNodes[n-1])if(3==l.nodeType)a=l,n=l.length;else if(l.nextSibling&&3==l.nextSibling.nodeType)a=l.nextSibling,n=0;else{f.moveToElementText(l.nextSibling?l:a);var b=l.parentNode;l=b.insertBefore(l.ownerDocument.createTextNode(" "),l.nextSibling);f.collapse(!1);b.removeChild(l)}}else f.moveToElementText(a),f.collapse(!0);
3==a.nodeType&&(l=y.adjacentNoneTextNode(a),b=l[0],l=l[1],b?(f.moveToElementText(b),f.collapse(!1),"inherit"!=b.contentEditable&&l++):(f.moveToElementText(a.parentNode),f.collapse(!0),f.move("character",1),f.move("character",-1)),n+=l,0<n&&f.move("character",n)!=n&&console.error("Error when moving!"));return f},decomposeTextRange:function(f){var a=m.getEndPoint(f),n=a[0],l=a[1],b=a[0];a=a[1];f.htmlText.length&&(f.htmlText==f.text?a=l+f.text.length:(a=m.getEndPoint(f,!0),b=a[0],a=a[1]));return[n,l,
b,a]},setRange:function(f,a,n,l,b,u){a=m.setEndPoint(f,a,n);f.setEndPoint("StartToStart",a);if(!u)var w=m.setEndPoint(f,l,b);f.setEndPoint("EndToEnd",w||a);return f}},c=y.W3CRange=v(null,{constructor:function(){0<arguments.length?(this.setStart(arguments[0][0],arguments[0][1]),this.setEnd(arguments[0][2],arguments[0][3])):(this.startContainer=this.commonAncestorContainer=null,this.startOffset=0,this.endContainer=null,this.endOffset=0,this.collapsed=!0)},_updateInternal:function(){this.commonAncestorContainer=
this.startContainer!==this.endContainer?y.getCommonAncestor(this.startContainer,this.endContainer):this.startContainer;this.collapsed=this.startContainer===this.endContainer&&this.startOffset==this.endOffset},setStart:function(f,a){a=parseInt(a);if(this.startContainer!==f||this.startOffset!=a)delete this._cachedBookmark,this.startContainer=f,this.startOffset=a,this.endContainer?this._updateInternal():this.setEnd(f,a)},setEnd:function(f,a){a=parseInt(a);if(this.endContainer!==f||this.endOffset!=a)delete this._cachedBookmark,
this.endContainer=f,this.endOffset=a,this.startContainer?this._updateInternal():this.setStart(f,a)},setStartAfter:function(f,a){this._setPoint("setStart",f,a,1)},setStartBefore:function(f,a){this._setPoint("setStart",f,a,0)},setEndAfter:function(f,a){this._setPoint("setEnd",f,a,1)},setEndBefore:function(f,a){this._setPoint("setEnd",f,a,0)},_setPoint:function(f,a,n,l){n=y.getIndex(a,a.parentNode).o;this[f](a.parentNode,n.pop()+l)},_getIERange:function(){var f=(this._body||this.endContainer.ownerDocument.body).createTextRange();
m.setRange(f,this.startContainer,this.startOffset,this.endContainer,this.endOffset,this.collapsed);return f},getBookmark:function(){this._getIERange();return this._cachedBookmark},_select:function(){this._getIERange().select()},deleteContents:function(){var f=this.startContainer,a=this._getIERange();3!==f.nodeType||this.startOffset||this.setStartBefore(f);a.pasteHTML("");this.endContainer=this.startContainer;this.endOffset=this.startOffset;this.collapsed=!0},cloneRange:function(){var f=new c([this.startContainer,
this.startOffset,this.endContainer,this.endOffset]);f._body=this._body;return f},detach:function(){this.startContainer=this.commonAncestorContainer=this._body=null;this.startOffset=0;this.endContainer=null;this.endOffset=0;this.collapsed=!0}});z.setObject("dijit.range",y);return y})},"dijit/_editor/html":function(){define(["dojo/_base/array","dojo/_base/lang","dojo/sniff"],function(N,v,z){var y={};v.setObject("dijit._editor.html",y);var m=y.escapeXml=function(c,f){c=c.replace(/&/gm,"\x26amp;").replace(/</gm,
"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;");f||(c=c.replace(/'/gm,"\x26#39;"));return c};y.getNodeHtml=function(c){var f=[];y.getNodeHtmlHelper(c,f);return f.join("")};y.getNodeHtmlHelper=function(c,f){switch(c.nodeType){case 1:var a=c.nodeName.toLowerCase();if(!a||"/"==a.charAt(0))return"";f.push("\x3c",a);var n=[],l={},b;if(z("dom-attributes-explicit")||z("dom-attributes-specified-flag"))for(var u=0;b=c.attributes[u++];){var w=b.name;"_dj"===w.substr(0,3)||z("dom-attributes-specified-flag")&&
!b.specified||w in l||(b=b.value,("src"==w||"href"==w)&&c.getAttribute("_djrealurl")&&(b=c.getAttribute("_djrealurl")),8===z("ie")&&"style"===w&&(b=b.replace("HEIGHT:","height:").replace("WIDTH:","width:")),n.push([w,b]),l[w]=b)}else{var e=(/^input$|^img$/i.test(c.nodeName)?c:c.cloneNode(!1)).outerHTML;l=e.match(/[\w-]+=("[^"]*"|'[^']*'|\S*)/gi);e=e.substr(0,e.indexOf("\x3e"));N.forEach(l,function(q){if(q){var h=q.indexOf("\x3d");if(0<h&&(q=q.substring(0,h),"_dj"!=q.substr(0,3)))if("src"!=q&&"href"!=
q||!c.getAttribute("_djrealurl")){switch(q){case "style":var r=c.style.cssText.toLowerCase();break;case "class":r=c.className;break;case "width":if("img"===a){(h=/width=(\S+)/i.exec(e))&&(r=h[1]);break}case "height":if("img"===a){(h=/height=(\S+)/i.exec(e))&&(r=h[1]);break}default:r=c.getAttribute(q)}null!=r&&n.push([q,r.toString()])}else n.push([q,c.getAttribute("_djrealurl")])}},this)}n.sort(function(q,h){return q[0]<h[0]?-1:q[0]==h[0]?0:1});for(l=0;b=n[l++];)f.push(" ",b[0],'\x3d"',"string"===
typeof b[1]?m(b[1],!0):b[1],'"');switch(a){case "br":case "hr":case "img":case "input":case "base":case "meta":case "area":case "basefont":f.push(" /\x3e");break;case "script":f.push("\x3e",c.innerHTML,"\x3c/",a,"\x3e");break;default:f.push("\x3e"),c.hasChildNodes()&&y.getChildrenHtmlHelper(c,f),f.push("\x3c/",a,"\x3e")}break;case 4:case 3:f.push(m(c.nodeValue,!0));break;case 8:f.push("\x3c!--",m(c.nodeValue,!0),"--\x3e");break;default:f.push("\x3c!-- Element not recognized - Type: ",c.nodeType," Name: ",
c.nodeName,"--\x3e")}};y.getChildrenHtml=function(c){var f=[];y.getChildrenHtmlHelper(c,f);return f.join("")};y.getChildrenHtmlHelper=function(c,f){if(c)for(var a=c.childNodes||c,n=!z("ie")||a!==c,l,b=0;l=a[b++];)n&&l.parentNode!=c||y.getNodeHtmlHelper(l,f)};return y})},"dijit/_editor/plugins/LinkDialog":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/query dojo/string ../_Plugin ../../form/DropDownButton ../range".split(" "),
function(N,v,z,y,m,c,f,a,n,l,b,u,w){var e=z("dijit._editor.plugins.LinkDialog",b,{allowUnsafeHtml:!1,linkFilter:[[/</g,"\x26lt;"]],buttonClass:u,useDefaultCommand:!1,urlRegExp:"((https?|ftps?|file)\\://|./|../|/|)(/[a-zA-Z]{1,1}:/|)(((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)*(?:[a-zA-Z](?:[-\\da-zA-Z]{0,80}[\\da-zA-Z])?)\\.?)|(((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])|(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]|(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]|(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])|0[xX]0*[\\da-fA-F]{1,8}|([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}|([\\da-fA-F]{1,4}\\:){6}((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])))(\\:\\d+)?(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]{0,}(?:\\?[^?#\\s/]*)?(?:#.*)?)?)?",
emailRegExp:"\x3c?(mailto\\:)([!#-'*+\\-\\/-9\x3d?A-Z^-~]+[.])*[!#-'*+\\-\\/-9\x3d?A-Z^-~]+@((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)+(?:[a-zA-Z](?:[-\\da-zA-Z]{0,6}[\\da-zA-Z])?)\\.?)|localhost|^[^-][a-zA-Z0-9_-]*\x3e?",htmlTemplate:'\x3ca href\x3d"${urlInput}" _djrealurl\x3d"${urlInput}" target\x3d"${targetSelect}"\x3e${textInput}\x3c/a\x3e',tag:"a",_hostRxp:/^((([^\[:]+):)?([^@]+)@)?(\[([^\]]+)\]|([^\[:]*))(:([0-9]+))?$/,_userAtRxp:/^([!#-'*+\-\/-9=?A-Z^-~]+[.])*[!#-'*+\-\/-9=?A-Z^-~]+@/i,
linkDialogTemplate:"\x3ctable role\x3d'presentation'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_urlInput'\x3e${url}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'true' id\x3d'${id}_urlInput' name\x3d'urlInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_textInput'\x3e${text}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'true' id\x3d'${id}_textInput' name\x3d'textInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_targetSelect'\x3e${target}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cselect id\x3d'${id}_targetSelect' name\x3d'targetSelect' data-dojo-type\x3d'dijit.form.Select'\x3e\x3coption selected\x3d'selected' value\x3d'_self'\x3e${currentWindow}\x3c/option\x3e\x3coption value\x3d'_blank'\x3e${newWindow}\x3c/option\x3e\x3coption value\x3d'_top'\x3e${topWindow}\x3c/option\x3e\x3coption value\x3d'_parent'\x3e${parentWindow}\x3c/option\x3e\x3c/select\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d'2'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'submit' id\x3d'${id}_setButton'\x3e${set}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'button' id\x3d'${id}_cancelButton'\x3e${buttonCancel}\x3c/button\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",
_initButton:function(){this.inherited(arguments);this.button.loadDropDown=c.hitch(this,"_loadDropDown");this._connectTagEvents()},_loadDropDown:function(h){N("dojo/i18n ../../TooltipDialog ../../registry ../../form/Button ../../form/Select ../../form/ValidationTextBox dojo/i18n!../../nls/common dojo/i18n!../nls/LinkDialog".split(" "),c.hitch(this,function(r,d,x){var C=this;this.tag="insertImage"==this.command?"img":"a";r=c.delegate(r.getLocalization("dijit","common",this.lang),r.getLocalization("dijit._editor",
"LinkDialog",this.lang));var L=this.dropDown=this.button.dropDown=new d({title:r[this.command+"Title"],ownerDocument:this.editor.ownerDocument,dir:this.editor.dir,execute:c.hitch(this,"setValue"),onOpen:function(){C._onOpenDialog();d.prototype.onOpen.apply(this,arguments)},onCancel:function(){setTimeout(c.hitch(C,"_onCloseDialog"),0)}});r.urlRegExp=this.urlRegExp;r.id=x.getUniqueId(this.editor.id);this._uniqueId=r.id;this._setContent(L.title+"\x3cdiv style\x3d'border-bottom: 1px black solid;padding-bottom:2pt;margin-bottom:4pt'\x3e\x3c/div\x3e"+
l.substitute(this.linkDialogTemplate,r));L.startup();this._urlInput=x.byId(this._uniqueId+"_urlInput");this._textInput=x.byId(this._uniqueId+"_textInput");this._setButton=x.byId(this._uniqueId+"_setButton");this.own(x.byId(this._uniqueId+"_cancelButton").on("click",c.hitch(this.dropDown,"onCancel")));this._urlInput&&this.own(this._urlInput.on("change",c.hitch(this,"_checkAndFixInput")));this._textInput&&this.own(this._textInput.on("change",c.hitch(this,"_checkAndFixInput")));this._urlRegExp=new RegExp("^"+
this.urlRegExp+"$","i");this._emailRegExp=new RegExp("^"+this.emailRegExp+"$","i");this._urlInput.isValid=c.hitch(this,function(){var t=this._urlInput.get("value");return this._urlRegExp.test(t)||this._emailRegExp.test(t)});this.own(f(L.domNode,"keydown",c.hitch(this,c.hitch(this,function(t){!t||t.keyCode!=m.ENTER||t.shiftKey||t.metaKey||t.ctrlKey||t.altKey||this._setButton.get("disabled")||(L.onExecute(),L.execute(L.get("value")))}))));h()}))},_checkAndFixInput:function(){var h=this,r=this._urlInput.get("value");
this._delayedCheck&&(clearTimeout(this._delayedCheck),this._delayedCheck=null);this._delayedCheck=setTimeout(function(){var d=r,x=!1,C=!1;d&&1<d.length&&(d=c.trim(d),0!==d.indexOf("mailto:")&&(0<d.indexOf("/")?-1===d.indexOf("://")&&"/"!==d.charAt(0)&&d.indexOf("./")&&0!==d.indexOf("../")&&h._hostRxp.test(d)&&(x=!0):h._userAtRxp.test(d)&&(C=!0)));x&&h._urlInput.set("value","http://"+d);C&&h._urlInput.set("value","mailto:"+d);h._setButton.set("disabled",!h._isValid())},250)},_connectTagEvents:function(){this.editor.onLoadDeferred.then(c.hitch(this,
function(){this.own(f(this.editor.editNode,"mouseup",c.hitch(this,"_onMouseUp")));this.own(f(this.editor.editNode,"dblclick",c.hitch(this,"_onDblClick")))}))},_isValid:function(){return this._urlInput.isValid()&&this._textInput.isValid()},_setContent:function(h){this.dropDown.set({parserScope:"dojo",content:h})},_checkValues:function(h){h&&h.urlInput&&(h.urlInput=h.urlInput.replace(/"/g,"\x26quot;"));!this.allowUnsafeHtml&&h&&h.textInput&&("function"===typeof this.linkFilter?h.textInput=this.linkFilter(h.textInput):
v.forEach(this.linkFilter,function(r){h.textInput=h.textInput.replace(r[0],r[1])}));return h},_createlinkEnabledImpl:function(){return!0},setValue:function(h){this._onCloseDialog();if(9>a("ie")){var r=w.getSelection(this.editor.window).getRangeAt(0).endContainer;3===r.nodeType&&(r=r.parentNode);r&&r.nodeName&&r.nodeName.toLowerCase()!==this.tag&&(r=this.editor.selection.getSelectedElement(this.tag));r&&r.nodeName&&r.nodeName.toLowerCase()===this.tag&&this.editor.queryCommandEnabled("unlink")&&(this.editor.selection.selectElementChildren(r),
this.editor.execCommand("unlink"))}h=this._checkValues(h);this.editor.execCommand("inserthtml",l.substitute(this.htmlTemplate,h));n("a",this.editor.document).forEach(function(d){d.innerHTML||y.has(d,"name")||d.parentNode.removeChild(d)},this)},_onCloseDialog:function(){this.editor.focused&&this.editor.focus()},_getCurrentValues:function(h){if(h&&h.tagName.toLowerCase()===this.tag){var r=h.getAttribute("_djrealurl")||h.getAttribute("href");var d=h.getAttribute("target")||"_self";var x=h.textContent||
h.innerText;this.editor.selection.selectElement(h,!0)}else x=this.editor.selection.getSelectedText();return{urlInput:r||"",textInput:x||"",targetSelect:d||""}},_onOpenDialog:function(){if(a("ie")){var h=w.getSelection(this.editor.window);if(h.rangeCount){var r=h.getRangeAt(0);var d=r.endContainer;3===d.nodeType&&(d=d.parentNode);d&&d.nodeName&&d.nodeName.toLowerCase()!==this.tag&&(d=this.editor.selection.getSelectedElement(this.tag));if(!d||d.nodeName&&d.nodeName.toLowerCase()!==this.tag)(h=this.editor.selection.getAncestorElement(this.tag))&&
h.nodeName&&h.nodeName.toLowerCase()==this.tag?(d=h,this.editor.selection.selectElement(d)):r.startContainer===r.endContainer&&(h=r.startContainer.firstChild)&&h.nodeName&&h.nodeName.toLowerCase()==this.tag&&(d=h,this.editor.selection.selectElement(d))}}else d=this.editor.selection.getAncestorElement(this.tag);this.dropDown.reset();this._setButton.set("disabled",!0);this.dropDown.set("value",this._getCurrentValues(d))},_onDblClick:function(h){if(h&&h.target&&(h=h.target,(h.tagName?h.tagName.toLowerCase():
"")===this.tag&&y.get(h,"href"))){var r=this.editor;this.editor.selection.selectElement(h);r.onDisplayChanged();r._updateTimer&&(r._updateTimer.remove(),delete r._updateTimer);r.onNormalizedDisplayChanged();var d=this.button;setTimeout(function(){d.set("disabled",!1);d.loadAndOpenDropDown().then(function(){d.dropDown.focus&&d.dropDown.focus()})},10)}},_onMouseUp:function(){if(a("ff")){var h=this.editor.selection.getAncestorElement(this.tag);if(h){var r=w.getSelection(this.editor.window).getRangeAt(0);
if(r.collapsed&&h.childNodes.length){var d=r.cloneRange();d.selectNodeContents(h.childNodes[h.childNodes.length-1]);d.setStart(h.childNodes[0],0);1!==r.compareBoundaryPoints(d.START_TO_START,d)?r.setStartBefore(h):-1!==r.compareBoundaryPoints(d.END_TO_START,d)&&r.setStartAfter(h)}}}}}),q=z("dijit._editor.plugins.ImgLinkDialog",[e],{linkDialogTemplate:"\x3ctable role\x3d'presentation'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_urlInput'\x3e${url}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput dojoType\x3d'dijit.form.ValidationTextBox' regExp\x3d'${urlRegExp}' required\x3d'true' id\x3d'${id}_urlInput' name\x3d'urlInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_textInput'\x3e${text}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'false' id\x3d'${id}_textInput' name\x3d'textInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3c/td\x3e\x3ctd\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d'2'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'submit' id\x3d'${id}_setButton'\x3e${set}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'button' id\x3d'${id}_cancelButton'\x3e${buttonCancel}\x3c/button\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",
htmlTemplate:'\x3cimg src\x3d"${urlInput}" _djrealurl\x3d"${urlInput}" alt\x3d"${textInput}" /\x3e',tag:"img",_getCurrentValues:function(h){if(h&&h.tagName.toLowerCase()===this.tag){var r=h.getAttribute("_djrealurl")||h.getAttribute("src");var d=h.getAttribute("alt");this.editor.selection.selectElement(h,!0)}else d=this.editor.selection.getSelectedText();return{urlInput:r||"",textInput:d||""}},_isValid:function(){return this._urlInput.isValid()},_connectTagEvents:function(){this.inherited(arguments);
this.editor.onLoadDeferred.then(c.hitch(this,function(){this.own(f(this.editor.editNode,"mousedown",c.hitch(this,"_selectTag")))}))},_selectTag:function(h){h&&h.target&&(h=h.target,(h.tagName?h.tagName.toLowerCase():"")===this.tag&&this.editor.selection.selectElement(h))},_checkValues:function(h){h&&h.urlInput&&(h.urlInput=h.urlInput.replace(/"/g,"\x26quot;"));h&&h.textInput&&(h.textInput=h.textInput.replace(/"/g,"\x26quot;"));return h},_onDblClick:function(h){if(h&&h.target&&(h=h.target,(h.tagName?
h.tagName.toLowerCase():"")===this.tag&&y.get(h,"src"))){var r=this.editor;this.editor.selection.selectElement(h);r.onDisplayChanged();r._updateTimer&&(r._updateTimer.remove(),delete r._updateTimer);r.onNormalizedDisplayChanged();var d=this.button;setTimeout(function(){d.set("disabled",!1);d.loadAndOpenDropDown().then(function(){d.dropDown.focus&&d.dropDown.focus()})},10)}}});b.registry.createLink=function(h){var r={command:"createLink",allowUnsafeHtml:"allowUnsafeHtml"in h?h.allowUnsafeHtml:!1};
"linkFilter"in h&&(r.linkFilter=h.linkFilter);return new e(r)};b.registry.insertImage=function(){return new q({command:"insertImage"})};e.ImgLinkDialog=q;return e})},"dijit/_editor/plugins/TextColor":function(){define("require dojo/colors dojo/_base/declare dojo/_base/lang ../_Plugin ../../form/DropDownButton".split(" "),function(N,v,z,y,m,c){var f=z("dijit._editor.plugins.TextColor",m,{buttonClass:c,colorPicker:"dijit/ColorPalette",useDefaultCommand:!1,_initButton:function(){this.command=this.name;
this.inherited(arguments);var a=this;this.button.loadDropDown=function(n){function l(b){a.button.dropDown=new b({dir:a.editor.dir,ownerDocument:a.editor.ownerDocument,value:a.value,onChange:function(u){a.editor.execCommand(a.command,u)},onExecute:function(){a.editor.execCommand(a.command,this.get("value"))}});n()}"string"==typeof a.colorPicker?N([a.colorPicker],l):l(a.colorPicker)}},updateState:function(){var a=this.editor,n=this.command;if(a&&a.isLoaded&&n.length){if(this.button){var l=this.get("disabled");
this.button.set("disabled",l);if(l)return;try{var b=a.queryCommandValue(n)||""}catch(u){b=""}}""==b&&(b="#000000");"transparent"==b&&(b="#ffffff");"string"==typeof b?-1<b.indexOf("rgb")&&(b=v.fromRgb(b).toHex()):(b=((b&255)<<16|b&65280|(b&16711680)>>>16).toString(16),b="#000000".slice(0,7-b.length)+b);this.value=b;(a=this.button.dropDown)&&a.get&&b!==a.get("value")&&a.set("value",b,!1)}}});m.registry.foreColor=function(a){return new f(a)};m.registry.hiliteColor=function(a){return new f(a)};return f})},
"esri/dijit/editing/AttachmentEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/io-query dojo/dom-attr dijit/_Widget dijit/_Templated dijit/ProgressBar ../../kernel ../../lang ../../domUtils dojo/text!./templates/AttachmentEditor.html dojo/i18n!../../nls/jsapi dojo/NodeList-dom".split(" "),function(N,v,z,y,m,c,f,a,n,l,b,u,w,e,q,h,r){N=N([l,b],{declaredClass:"esri.dijit.editing.AttachmentEditor",widgetsInTemplate:!0,
templateString:h,_listHtml:"\x3cspan id\x3d'node_${oid}_${attid}' style\x3d'display: flex;'\x3e\x3ca href\x3d'${href}' target\x3d'_blank'\x3e${name}\x3c/a\x3e",_deleteBtnHtml:"\x3cspan style\x3d'cursor:pointer;color:red;font-weight:bold;padding:0 2px;' class\x3d'deleteAttachment' id\x3d'${attid}');'\x3eX\x3c/span\x3e",_endHtml:"\x3cbr/\x3e\x3c/span\x3e",_aeConnects:[],_layerEditingCapChecked:{},_layerEditingCap:{},constructor:function(d,x){v.mixin(this,r.widgets.attachmentEditor)},startup:function(){this.inherited(arguments);
this._uploadField_connect=z.connect(this._uploadField,"onchange",this,function(){0<this._uploadField.value.length&&this._addAttachment()});this._uploadFieldFocus_connect=z.connect(this._uploadField,"onfocus",v.hitch(this,function(d){q.hide(this._attachmentError)}))},destroy:function(){y.forEach(this._aeConnects,z.disconnect);z.disconnect(this._uploadField_connect);z.disconnect(this._uploadFieldFocus_connect);this.inherited(arguments)},showAttachments:function(d,x){this._attachmentList.innerHTML=this.NLS_none;
this._uploadField.value="";y.forEach(this.domNode.children,function(C,L){q.show(C)});q.hide(this._attachmentError);d&&(this._featureLayer=d.getLayer()||x)&&("esri.layers.FeatureLayer"===this._featureLayer.declaredClass&&this._featureLayer.getEditCapabilities?(this._currentLayerId=this._featureLayer.id,this._layerEditingCapChecked[this._currentLayerId]||(this._layerEditingCap[this._currentLayerId]=this._featureLayer.getEditCapabilities(),this._layerEditingCapChecked[this._currentLayerId]=!0),this._featureCanUpdate=
this._featureLayer.getEditCapabilities({feature:d}).canUpdate,this._oid=d.attributes[this._featureLayer.objectIdField],this._getAttachments(d)):x&&x.getEditCapabilities()||(q.hide(this._uploadForm),y.forEach(this.domNode.children,function(C,L){q.hide(C)})))},_getAttachments:function(d){this._featureLayer&&this._featureLayer.queryAttachmentInfos&&this._featureLayer.queryAttachmentInfos(this._oid,v.hitch(this,"_onQueryAttachmentInfosComplete"))},_addAttachment:function(){q.hide(this._attachmentError);
this._featureLayer&&this._featureLayer.addAttachment?(q.show(this._attachmentProgress),this._featureLayer.addAttachment(this._oid,this._uploadForm,v.hitch(this,"_onAddAttachmentComplete"),v.hitch(this,"_onAddAttachmentError"))):this._tempUpload=this._uploadForm},_chainAttachment:function(d,x){this._tempUpload&&(q.show(this._attachmentProgress),x.addAttachment(d,this._tempUpload,v.hitch(this,"_onAddAttachmentComplete"),v.hitch(this,"_onAddAttachmentError")));this._tempUpload=null},_deleteAttachment:function(d,
x){q.show(this._attachmentProgress);this._featureLayer.deleteAttachments(d,[x],v.hitch(this,"_onDeleteAttachmentComplete"))},_onQueryAttachmentInfosComplete:function(d){var x=this._listHtml+this._deleteBtnHtml+this._endHtml;this._uploadForm.style.display="block";!this._featureCanUpdate&&this._layerEditingCap[this._currentLayerId].canUpdate||!this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate?(x=this._listHtml+this._endHtml,this._uploadForm.style.display=
"none"):this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate&&(x=this._listHtml+this._endHtml);var C=this._attachmentList;d=y.map(d,v.hitch(this,function(L){return e.substitute({href:L.url,name:L.name,oid:L.objectId,attid:L.id},x)}));C.innerHTML=d.join("")||this.NLS_none;this._updateConnects()},_onAddAttachmentComplete:function(d){q.hide(this._attachmentProgress.domNode);var x=this._attachmentList,C=this._uploadField,L=C.value,t=L.lastIndexOf("\\");
-1<t&&(L=L.substring(t+1,L.length));L=L.replace(/ /g,"_");t=a.objectToQuery({gdbVersion:this._featureLayer.gdbVersion,token:this._featureLayer._getToken()});var p=this._listHtml+this._deleteBtnHtml+this._endHtml;this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate&&(p=this._listHtml+this._endHtml);d=e.substitute({href:this._featureLayer._url.path+"/"+d.objectId+"/attachments/"+d.attachmentId+(t?"?"+t:""),name:L,oid:d.objectId,attid:d.attachmentId},
p);x.innerHTML=x.innerHTML==this.NLS_none?d:x.innerHTML+d;this._updateConnects();C.value=""},_onAddAttachmentError:function(d){q.hide(this._attachmentProgress.domNode);if(d){var x=this.NLS_error,C=this._attachmentError;e.isDefined(d.code)&&400===d.code&&(x=this.NLS_fileNotSupported);n.set(C,"innerHTML",x);q.show(C)}},_onDeleteAttachmentComplete:function(d){q.hide(this._attachmentProgress.domNode);var x=this._attachmentList;y.every(d,function(C){return C.success})&&(m.query("#node_"+d[0].objectId+
"_"+d[0].attachmentId).orphan(),x.children&&x.children.length||(x.innerHTML=this.NLS_none))},_updateConnects:function(){y.forEach(this._aeConnects,z.disconnect);m.query(".deleteAttachment").forEach(function(d){this._aeConnects.push(z.connect(d,"onclick",v.hitch(this,"_deleteAttachment",this._oid,d.id)))},this)}});c("extend-esri")&&v.setObject("dijit.editing.AttachmentEditor",N,w);return N})},"dijit/ProgressBar":function(){define("require dojo/_base/declare dojo/dom-class dojo/_base/lang dojo/number ./_Widget ./_TemplatedMixin dojo/text!./templates/ProgressBar.html".split(" "),
function(N,v,z,y,m,c,f,a){return v("dijit.ProgressBar",[c,f],{progress:"0",value:"",maximum:100,places:0,indeterminate:!1,label:"",name:"",templateString:a,_indeterminateHighContrastImagePath:N.toUrl("./themes/a11y/indeterminate_progress.gif"),postMixInProperties:function(){this.inherited(arguments);this.params&&"value"in this.params||(this.value=this.indeterminate?Infinity:this.progress)},buildRendering:function(){this.inherited(arguments);this.indeterminateHighContrastImage.setAttribute("src",this._indeterminateHighContrastImagePath.toString());
this.update()},_setDirAttr:function(n){var l="rtl"==n.toLowerCase();z.toggle(this.domNode,"dijitProgressBarRtl",l);z.toggle(this.domNode,"dijitProgressBarIndeterminateRtl",this.indeterminate&&l);this.inherited(arguments)},update:function(n){y.mixin(this,n||{});n=this.internalProgress;var l=this.domNode,b=1;this.indeterminate?l.removeAttribute("aria-valuenow"):(-1!=String(this.progress).indexOf("%")?(b=Math.min(parseFloat(this.progress)/100,1),this.progress=b*this.maximum):(this.progress=Math.min(this.progress,
this.maximum),b=this.maximum?this.progress/this.maximum:0),l.setAttribute("aria-valuenow",this.progress));l.setAttribute("aria-labelledby",this.labelNode.id);l.setAttribute("aria-valuemin",0);l.setAttribute("aria-valuemax",this.maximum);this.labelNode.innerHTML=this.report(b);z.toggle(this.domNode,"dijitProgressBarIndeterminate",this.indeterminate);z.toggle(this.domNode,"dijitProgressBarIndeterminateRtl",this.indeterminate&&!this.isLeftToRight());n.style.width=100*b+"%";this.onChange()},_setValueAttr:function(n){this._set("value",
n);Infinity==n?this.update({indeterminate:!0}):this.update({indeterminate:!1,progress:n})},_setLabelAttr:function(n){this._set("label",n);this.update()},_setIndeterminateAttr:function(n){this._set("indeterminate",n);this.update()},report:function(n){return this.label?this.label:this.indeterminate?"\x26#160;":m.format(n,{type:"percent",places:this.places,locale:this.lang})},onChange:function(){}})})},"esri/dijit/editing/Util":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/has","../../kernel"],
function(N,v,z,y){var m={};m={findFeatures:function(c,f,a){var n=f.objectIdField;f=v.filter(f.graphics,function(l){return v.some(c,function(b){return l.attributes[n]===b.objectId})});if(a)a(f);else return f},getSelection:function(c){var f=[];v.forEach(c,function(a){a=a.getSelectedFeatures();v.forEach(a,function(n){f.push(n)})});return f},sortFeaturesById:function(c,f){var a=v.map(c,function(n){return n.featureLayer});f.sort(function(n,l){var b=n.getLayer(),u=l.getLayer();if(!b)return-1;if(!u)return 1;
var w=v.indexOf(a,b);u=v.indexOf(a,u);w-=u;w||(b=b.objectIdField,w=n.attributes[b]-l.attributes[b]);return w});return f}};z("extend-esri")&&N.setObject("dijit.editing.Util.LayerHelper",m,y);return m})},"dojox/date/islamic":function(){define(["dojox/main","dojo/_base/lang","dojo/date","./islamic/Date"],function(N,v,z,y){var m=v.getObject("date.islamic",!0,N);m.getDaysInMonth=function(c){return c.getDaysInIslamicMonth(c.getMonth(),c.getFullYear())};m.compare=function(c,f,a){c instanceof y&&(c=c.toGregorian());
f instanceof y&&(f=f.toGregorian());return z.compare.apply(null,arguments)};m.add=function(c,f,a){var n=new y(c);switch(f){case "day":n.setDate(c.getDate()+a);break;case "weekday":var l=c.getDay();if(5>l+a&&0<l+a)n.setDate(c.getDate()+a);else{var b=f=0;5==l?(l=4,b=0<a?-1:1):6==l&&(l=4,b=0<a?-2:2);l=0<a?5-l-1:-l;var u=a-l,w=parseInt(u/5);0!=u%5&&(f=0<a?2:-2);f=f+7*w+u%5+l;n.setDate(c.getDate()+f+b)}break;case "year":n.setFullYear(c.getFullYear()+a);break;case "week":a*=7;n.setDate(c.getDate()+a);break;
case "month":c=c.getMonth();n.setMonth(c+a);break;case "hour":n.setHours(c.getHours()+a);break;case "minute":n._addMinutes(a);break;case "second":n._addSeconds(a);break;case "millisecond":n._addMilliseconds(a)}return n};m.difference=function(c,f,a){f=f||new y;a=a||"day";var n=f.getFullYear()-c.getFullYear(),l=1;switch(a){case "weekday":n=Math.round(m.difference(c,f,"day"));l=parseInt(m.difference(c,f,"week"));if(0==n%7)n=5*l;else{a=0;var b=c.getDay(),u=f.getDay();l=parseInt(n/7);f=n%7;c=new y(c);
c.setDate(c.getDate()+7*l);c=c.getDay();if(0<n)switch(!0){case 5==b:a=-1;break;case 6==b:a=0;break;case 5==u:a=-1;break;case 6==u:a=-2;break;case 5<c+f:a=-2}else if(0>n)switch(!0){case 5==b:a=0;break;case 6==b:a=1;break;case 5==u:a=2;break;case 6==u:a=1;break;case 0>c+f:a=2}n=n+a-2*l}l=n;break;case "year":l=n;break;case "month":a=f.toGregorian()>c.toGregorian()?f:c;b=f.toGregorian()>c.toGregorian()?c:f;l=a.getMonth();u=b.getMonth();if(0==n)l=a.getMonth()-b.getMonth();else for(l=12-u+l,n=b.getFullYear()+
1,a=a.getFullYear(),n;n<a;n++)l+=12;f.toGregorian()<c.toGregorian()&&(l=-l);break;case "week":l=parseInt(m.difference(c,f,"day")/7);break;case "day":l/=24;case "hour":l/=60;case "minute":l/=60;case "second":l/=1E3;case "millisecond":l*=f.toGregorian().getTime()-c.toGregorian().getTime()}return Math.round(l)};return m})},"dojox/date/islamic/Date":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/date"],function(N,v,z){var y=v("dojox.date.islamic.Date",null,{_date:0,_month:0,_year:0,_hours:0,
_minutes:0,_seconds:0,_milliseconds:0,_day:0,_GREGORIAN_EPOCH:1721425.5,_ISLAMIC_EPOCH:1948439.5,constructor:function(){var m=arguments.length;m?1==m?(m=arguments[0],"number"==typeof m&&(m=new Date(m)),m instanceof Date?this.fromGregorian(m):""==m?this._date=new Date(""):(this._year=m._year,this._month=m._month,this._date=m._date,this._hours=m._hours,this._minutes=m._minutes,this._seconds=m._seconds,this._milliseconds=m._milliseconds)):3<=m&&(this._year+=arguments[0],this._month+=arguments[1],this._date+=
arguments[2],this._hours+=arguments[3]||0,this._minutes+=arguments[4]||0,this._seconds+=arguments[5]||0,this._milliseconds+=arguments[6]||0):this.fromGregorian(new Date)},getDate:function(){return this._date},getMonth:function(){return this._month},getFullYear:function(){return this._year},getDay:function(){return this.toGregorian().getDay()},getHours:function(){return this._hours},getMinutes:function(){return this._minutes},getSeconds:function(){return this._seconds},getMilliseconds:function(){return this._milliseconds},
setDate:function(m){m=parseInt(m);if(!(0<m&&m<=this.getDaysInIslamicMonth(this._month,this._year))){var c;if(0<m)for(c=this.getDaysInIslamicMonth(this._month,this._year);m>c;m-=c,c=this.getDaysInIslamicMonth(this._month,this._year))this._month++,12<=this._month&&(this._year++,this._month-=12);else for(c=this.getDaysInIslamicMonth(0<=this._month-1?this._month-1:11,0<=this._month-1?this._year:this._year-1);0>=m;c=this.getDaysInIslamicMonth(0<=this._month-1?this._month-1:11,0<=this._month-1?this._year:
this._year-1))this._month--,0>this._month&&(this._year--,this._month+=12),m+=c}this._date=m;return this},setFullYear:function(m){this._year=+m},setMonth:function(m){this._year+=Math.floor(m/12);this._month=0<m?Math.floor(m%12):Math.floor((m%12+12)%12)},setHours:function(){var m=arguments.length,c=0;1<=m&&(c=parseInt(arguments[0]));2<=m&&(this._minutes=parseInt(arguments[1]));3<=m&&(this._seconds=parseInt(arguments[2]));4==m&&(this._milliseconds=parseInt(arguments[3]));for(;24<=c;)this._date++,m=this.getDaysInIslamicMonth(this._month,
this._year),this._date>m&&(this._month++,12<=this._month&&(this._year++,this._month-=12),this._date-=m),c-=24;this._hours=c},_addMinutes:function(m){m+=this._minutes;this.setMinutes(m);this.setHours(this._hours+parseInt(m/60));return this},_addSeconds:function(m){m+=this._seconds;this.setSeconds(m);this._addMinutes(parseInt(m/60));return this},_addMilliseconds:function(m){m+=this._milliseconds;this.setMilliseconds(m);this._addSeconds(parseInt(m/1E3));return this},setMinutes:function(m){this._minutes=
m%60;return this},setSeconds:function(m){this._seconds=m%60;return this},setMilliseconds:function(m){this._milliseconds=m%1E3;return this},toString:function(){if(isNaN(this._date))return"Invalidate Date";var m=new Date;m.setHours(this._hours);m.setMinutes(this._minutes);m.setSeconds(this._seconds);m.setMilliseconds(this._milliseconds);return this._month+" "+this._date+" "+this._year+" "+m.toTimeString()},toGregorian:function(){var m=this._year;m=Math.floor(this._date+Math.ceil(29.5*this._month)+354*
(m-1)+Math.floor((3+11*m)/30)+this._ISLAMIC_EPOCH-1-.5)+.5;var c=m-this._GREGORIAN_EPOCH,f=Math.floor(c/146097),a=this._mod(c,146097);c=Math.floor(a/36524);var n=this._mod(a,36524);a=Math.floor(n/1461);n=this._mod(n,1461);n=Math.floor(n/365);f=400*f+100*c+4*a+n;4!=c&&4!=n&&f++;c=m-(this._GREGORIAN_EPOCH+365*(f-1)+Math.floor((f-1)/4)-Math.floor((f-1)/100)+Math.floor((f-1)/400));a=this._GREGORIAN_EPOCH-1+365*(f-1)+Math.floor((f-1)/4)-Math.floor((f-1)/100)+Math.floor((f-1)/400)+Math.floor(739/12+(z.isLeapYear(new Date(f,
3,1))?-1:-2)+1);a=m<a?0:z.isLeapYear(new Date(f,3,1))?1:2;c=Math.floor((12*(c+a)+373)/367);a=this._GREGORIAN_EPOCH-1+365*(f-1)+Math.floor((f-1)/4)-Math.floor((f-1)/100)+Math.floor((f-1)/400)+Math.floor((367*c-362)/12+(2>=c?0:z.isLeapYear(new Date(f,c-1,1))?-1:-2)+1);return new Date(f,c-1,m-a+1,this._hours,this._minutes,this._seconds,this._milliseconds)},fromGregorian:function(m){m=new Date(m);var c=m.getFullYear(),f=m.getMonth(),a=m.getDate();c=this._GREGORIAN_EPOCH-1+365*(c-1)+Math.floor((c-1)/4)+
-Math.floor((c-1)/100)+Math.floor((c-1)/400)+Math.floor((367*(f+1)-362)/12+(2>=f+1?0:z.isLeapYear(m)?-1:-2)+a);c=Math.floor(c)+.5;c-=this._ISLAMIC_EPOCH;f=Math.floor((30*c+10646)/10631);a=Math.ceil((c-29-this._yearStart(f))/29.5);a=Math.min(a,11);this._date=Math.ceil(c-this._monthStart(f,a))+1;this._month=a;this._year=f;this._hours=m.getHours();this._minutes=m.getMinutes();this._seconds=m.getSeconds();this._milliseconds=m.getMilliseconds();this._day=m.getDay();return this},valueOf:function(){return this.toGregorian().valueOf()},
_yearStart:function(m){return 354*(m-1)+Math.floor((3+11*m)/30)},_monthStart:function(m,c){return Math.ceil(29.5*c)+354*(m-1)+Math.floor((3+11*m)/30)},_civilLeapYear:function(m){return 11>(14+11*m)%30},getDaysInIslamicMonth:function(m,c){var f=0;f=29+(m+1)%2;11==m&&this._civilLeapYear(c)&&f++;return f},_mod:function(m,c){return m-c*Math.floor(m/c)}});y.getDaysInIslamicMonth=function(m){return(new y).getDaysInIslamicMonth(m.getMonth(),m.getFullYear())};return y})},"dojox/date/islamic/locale":function(){define("dojox/main dojo/_base/lang dojo/_base/array dojo/date dojo/i18n dojo/regexp dojo/string ./Date dojo/i18n!dojo/cldr/nls/islamic".split(" "),
function(N,v,z,y,m,c,f,a,n){function l(q,h,r,d,x){return x.replace(/([a-z])\1*/ig,function(C){var L=C.charAt(0);C=C.length;var t=["abbr","wide","narrow"];switch(L){case "G":var p=h.eraAbbr[0];break;case "y":p=String(q.getFullYear());break;case "M":p=q.getMonth();if(3>C){p+=1;var G=!0}else L=["months-format",t[C-3]].join("-"),p=h[L][p];break;case "d":p=q.getDate(!0);G=!0;break;case "E":p=q.getDay();3>C?(p+=1,G=!0):(L=["days-format",t[C-3]].join("-"),p=h[L][p]);break;case "a":p=12>q.getHours()?"am":
"pm";p=h["dayPeriods-format-wide-"+p];break;case "h":case "H":case "K":case "k":G=q.getHours();switch(L){case "h":p=G%12||12;break;case "H":p=G;break;case "K":p=G%12;break;case "k":p=G||24}G=!0;break;case "m":p=q.getMinutes();G=!0;break;case "s":p=q.getSeconds();G=!0;break;case "S":p=Math.round(q.getMilliseconds()*Math.pow(10,C-3));G=!0;break;case "z":if(p=y.getTimezoneName(q.toGregorian()))break;C=4;case "Z":p=q.toGregorian().getTimezoneOffset();p=[0>=p?"+":"-",f.pad(Math.floor(Math.abs(p)/60),2),
f.pad(Math.abs(p)%60,2)];4==C&&(p.splice(0,0,"GMT"),p.splice(3,0,":"));p=p.join("");break;default:throw Error("dojox.date.islamic.locale.formatPattern: invalid pattern char: "+x);}G&&(p=f.pad(p,C));return p})}function b(q,h,r,d){var x=function(t){return t};h=h||x;r=r||x;d=d||x;var C=q.match(/(''|[^'])+/g),L="'"==q.charAt(0);z.forEach(C,function(t,p){t?(C[p]=(L?r:h)(t),L=!L):C[p]=""});return d(C.join(""))}function u(q,h,r,d){d=c.escapeString(d);m.normalizeLocale(r.locale);return d.replace(/([a-z])\1*/ig,
function(x){var C=x.charAt(0);var L=x.length,t="";r.strict?1<L&&(t="0{"+(L-1)+"}"):t="0?";switch(C){case "y":C="\\d+";break;case "M":C=2<L?"\\S+ ?\\S+":t+"[1-9]|1[0-2]";break;case "d":C="[12]\\d|"+t+"[1-9]|3[01]";break;case "E":C="\\S+";break;case "h":C=t+"[1-9]|1[0-2]";break;case "k":C=t+"\\d|1[01]";break;case "H":C=t+"\\d|1\\d|2[0-3]";break;case "K":C=t+"[1-9]|1\\d|2[0-4]";break;case "m":case "s":C=t+"\\d|[0-5]\\d";break;case "S":C="\\d{"+L+"}";break;case "a":L=r.am||h["dayPeriods-format-wide-am"];
t=r.pm||h["dayPeriods-format-wide-pm"];r.strict?C=L+"|"+t:(C=L+"|"+t,L!=L.toLowerCase()&&(C+="|"+L.toLowerCase()),t!=t.toLowerCase()&&(C+="|"+t.toLowerCase()));break;default:C=".*"}q&&q.push(x);return"("+C+")"}).replace(/[\xa0 ]/g,"[\\s\\xa0]")}var w=v.getObject("date.islamic.locale",!0,N);w.format=function(q,h){h=h||{};var r=m.normalizeLocale(h.locale),d=h.formatLength||"short",x=w._getIslamicBundle(r),C=[];r=v.hitch(this,l,q,x,r,h.fullYear);if("year"==h.selector)return q.getFullYear();"time"!=h.selector&&
(q=h.datePattern||x["dateFormat-"+d])&&C.push(b(q,r));"date"!=h.selector&&(h=h.timePattern||x["timeFormat-"+d])&&C.push(b(h,r));return C.join(" ")};w.regexp=function(q){return w._parseInfo(q).regexp};w._parseInfo=function(q){q=q||{};var h=m.normalizeLocale(q.locale);h=w._getIslamicBundle(h);var r=q.formatLength||"short",d=q.datePattern||h["dateFormat-"+r];r=q.timePattern||h["timeFormat-"+r];var x=[];return{regexp:b("date"==q.selector?d:"time"==q.selector?r:"undefined"==typeof r?d:d+" "+r,v.hitch(this,
u,x,h,q)),tokens:x,bundle:h}};w.parse=function(q,h){q=q.replace(/[\u200E\u200F\u202A\u202E]/g,"");h||(h={});var r=w._parseInfo(h),d=r.tokens,x=r.bundle;r=r.regexp.replace(/[\u200E\u200F\u202A\u202E]/g,"");q=(new RegExp("^"+r+"$")).exec(q);m.normalizeLocale(h.locale);if(!q)return null;var C=[1389,0,1,0,0,0,0],L="",t=["abbr","wide","narrow"];z.every(q,function(p,G){if(!G)return!0;G=d[G-1];var T=G.length;switch(G.charAt(0)){case "y":C[0]=Number(p);break;case "M":if(2<T){if(G=x["months-format-"+t[T-3]].concat(),
h.strict||(p=p.replace(".","").toLowerCase(),G=z.map(G,function(P){return P?P.replace(".","").toLowerCase():P})),p=z.indexOf(G,p),-1==p)return!1}else p--;C[1]=Number(p);break;case "D":C[1]=0;case "d":C[2]=Number(p);break;case "a":G=h.am||x["dayPeriods-format-wide-am"];T=h.pm||x["dayPeriods-format-wide-pm"];if(!h.strict){var D=/\./g;p=p.replace(D,"").toLowerCase();G=G.replace(D,"").toLowerCase();T=T.replace(D,"").toLowerCase()}if(h.strict&&p!=G&&p!=T)return!1;L=p==T?"p":p==G?"a":"";break;case "K":24==
p&&(p=0);case "h":case "H":case "k":C[3]=Number(p);break;case "m":C[4]=Number(p);break;case "s":C[5]=Number(p);break;case "S":C[6]=Number(p)}return!0});q=+C[3];"p"===L&&12>q?C[3]=q+12:"a"===L&&12==q&&(C[3]=0);return new a(C[0],C[1],C[2],C[3],C[4],C[5],C[6])};var e=[];w.addCustomFormats=function(q,h){e.push({pkg:q,name:h})};w._getIslamicBundle=function(q){var h={};z.forEach(e,function(r){r=m.getLocalization(r.pkg,r.name,q);h=v.mixin(h,r)},this);return h};w.addCustomFormats("dojo.cldr","islamic");w.getNames=
function(q,h,r,d,x){d=w._getIslamicBundle(d);q=[q,r,h];if("standAlone"==r){r=q.join("-");var C=d[r];1==C[0]&&(C=void 0)}q[1]="format";return(C||d[q.join("-")]).concat()};w.weekDays=w.getNames("days","wide","format");w.months=w.getNames("months","wide","format");return w})},"esri/dijit/editing/Add":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ./EditOperationBase".split(" "),function(N,v,z,y,m,c){v=v(c,{declaredClass:"esri.dijit.editing.Add",type:"edit",
label:"Add Features",constructor:function(f){f=f||{};f.featureLayer?(this._featureLayer=f.featureLayer,f.addedGraphics?this._addedGraphics=f.addedGraphics:console.error("In constructor of 'esri.dijit.editing.Add', no graphics provided")):console.error("In constructor of 'esri.dijit.editing.Add', featureLayer is not provided")},updateObjectIds:function(f,a){this.updateIds(this._featureLayer,this._addedGraphics,f,a)},performUndo:function(){return this._featureLayer.applyEdits(null,null,this._addedGraphics).then(z.hitch(this,
function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var f=N.map(this._addedGraphics,function(a){return a.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._addedGraphics,null,null).then(z.hitch(this,function(a,n,l){a=N.map(a,function(b){return b.objectId});return{oldIds:f,addedIds:a,layer:this._featureLayer,operation:this}}))}});y("extend-esri")&&z.setObject("dijit.editing.Add",v,m);return v})},"esri/dijit/editing/EditOperationBase":function(){define(["dojo/_base/array",
"dojo/_base/declare","dojo/has","../../kernel","../../OperationBase"],function(N,v,z,y,m){v=v(m,{declaredClass:"esri.EditOperationBase",updateIds:function(c,f,a,n){N.forEach(f,function(l,b){var u=l[c.objectIdField];N.forEach(a,function(w,e){u===w&&(l[c.objectIdField]=n[e])})})}});z("extend-esri")&&(y.EditOperationBase=v);return v})},"esri/dijit/editing/Update":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),
function(N,v,z,y,m,c,f){N=v(f,{declaredClass:"esri.dijit.editing.Update",type:"edit",label:"Update Features",constructor:function(a){var n;a=a||{};if(a.featureLayer)if(this._featureLayer=a.featureLayer,a.preUpdatedGraphics){this._preUpdatedGraphicsGeometries=[];this._preUpdatedGraphicsAttributes=[];for(n=0;n<a.preUpdatedGraphics.length;n++)this._preUpdatedGraphicsGeometries.push(a.preUpdatedGraphics[n].geometry.toJson()),this._preUpdatedGraphicsAttributes.push(a.preUpdatedGraphics[n].attributes);
if(a.postUpdatedGraphics)for(this._postUpdatedGraphics=a.postUpdatedGraphics,this._postUpdatedGraphicsGeometries=[],this._postUpdatedGraphicsAttributes=[],n=0;n<a.postUpdatedGraphics.length;n++)a.postUpdatedGraphics[n].geometry?this._postUpdatedGraphicsGeometries.push(a.postUpdatedGraphics[n].geometry.toJson()):this._postUpdatedGraphicsGeometries.push(a.postUpdatedGraphics[n].geometry),this._postUpdatedGraphicsAttributes.push(z.clone(a.postUpdatedGraphics[n].attributes));else console.error("In constructor of 'esri.dijit.editing.Update', postUpdatedGraphics not provided")}else console.error("In constructor of 'esri.dijit.editing.Update', preUpdatedGraphics not provided");
else console.error("In constructor of 'esri.dijit.editing.Update', featureLayer not provided")},updateObjectIds:function(a,n){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,a,n);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,a,n)},performUndo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._preUpdatedGraphicsGeometries[a]?this._postUpdatedGraphics[a].setGeometry(c.fromJson(this._preUpdatedGraphicsGeometries[a])):this._postUpdatedGraphics[a].setGeometry(this._preUpdatedGraphicsGeometries[a]),
this._postUpdatedGraphics[a].setAttributes(this._preUpdatedGraphicsAttributes[a]);return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,null).then(z.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphicsGeometries[a]?this._postUpdatedGraphics[a].setGeometry(c.fromJson(this._postUpdatedGraphicsGeometries[a])):this._postUpdatedGraphics[a].setGeometry(this._postUpdatedGraphicsGeometries[a]),
this._postUpdatedGraphics[a].setAttributes(this._postUpdatedGraphicsAttributes[a]);return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,null).then(z.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))}});y("extend-esri")&&z.setObject("dijit.editing.Update",N,m);return N})},"esri/dijit/editing/Delete":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ./EditOperationBase".split(" "),function(N,v,z,y,m,c){v=v(c,{declaredClass:"esri.dijit.editing.Delete",
type:"edit",label:"Delete Features",constructor:function(f){f=f||{};f.featureLayer?(this._featureLayer=f.featureLayer,f.deletedGraphics?this._deletedGraphics=f.deletedGraphics:console.error("In constructor of 'esri.dijit.editing.Delete', no graphics provided")):console.error("In constructor of 'esri.dijit.editing.Delete', featureLayer is not provided")},updateObjectIds:function(f,a){this.updateIds(this._featureLayer,this._deletedGraphics,f,a)},performUndo:function(){var f=N.map(this._deletedGraphics,
function(a){return a.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._deletedGraphics,null,null).then(z.hitch(this,function(a,n,l){a=N.map(a,function(b){return b.objectId});return{oldIds:f,addedIds:a,layer:this._featureLayer,operation:this}}))},performRedo:function(){return this._featureLayer.applyEdits(null,null,this._deletedGraphics).then(z.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))}});y("extend-esri")&&z.setObject("dijit.editing.Delete",
v,m);return v})},"esri/dijit/editing/Cut":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),function(N,v,z,y,m,c,f){v=v(f,{declaredClass:"esri.dijit.editing.Cut",type:"edit",label:"Cut Features",constructor:function(a){var n;a=a||{};if(a.featureLayer)if(this._featureLayer=a.featureLayer,a.addedGraphics)if(this._addedGraphics=a.addedGraphics,a.preUpdatedGraphics){this._preUpdatedGraphicsGeometries=[];
this._preUpdatedGraphicsAttributes=[];for(n=0;n<a.preUpdatedGraphics.length;n++)this._preUpdatedGraphicsGeometries.push(a.preUpdatedGraphics[n].geometry.toJson()),this._preUpdatedGraphicsAttributes.push(a.preUpdatedGraphics[n].attributes);if(a.postUpdatedGraphics)for(this._postUpdatedGraphics=a.postUpdatedGraphics,this._postUpdatedGraphicsGeometries=[],this._postUpdatedGraphicsAttributes=[],n=0;n<a.postUpdatedGraphics.length;n++)this._postUpdatedGraphicsGeometries.push(a.postUpdatedGraphics[n].geometry.toJson()),
this._postUpdatedGraphicsAttributes.push(z.clone(a.postUpdatedGraphics[n].attributes));else console.error("In constructor of 'esri.dijit.editing.Cut', postUpdatedGraphics not provided")}else console.error("In constructor of 'esri.dijit.editing.Cut', preUpdatedGraphics not provided");else console.error("In constructor of 'esri.dijit.editing.Cut', addedGraphics for cut not provided");else console.error("In constructor of 'esri.dijit.editing.Cut', featureLayer not provided")},updateObjectIds:function(a,
n){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,a,n);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,a,n);this.updateIds(this._featureLayer,this._addedGraphics,a,n)},performUndo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphics[a].setGeometry(c.fromJson(this._preUpdatedGraphicsGeometries[a])),this._postUpdatedGraphics[a].setAttributes(this._preUpdatedGraphicsAttributes[a]);return this._featureLayer.applyEdits(null,
this._postUpdatedGraphics,this._addedGraphics).then(z.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphics[a].setGeometry(c.fromJson(this._postUpdatedGraphicsGeometries[a])),this._postUpdatedGraphics[a].setAttributes(this._postUpdatedGraphicsAttributes[a]);var n=N.map(this._addedGraphics,function(l){return l.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._addedGraphics,
this._postUpdatedGraphics,null).then(z.hitch(this,function(l,b,u){l=N.map(l,function(w){return w.objectId});return{oldIds:n,addedIds:l,layer:this._featureLayer,operation:this}}))}});y("extend-esri")&&z.setObject("dijit.editing.Cut",v,m);return v})},"esri/dijit/editing/Union":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),function(N,v,z,y,m,c,f){v=v(f,{declaredClass:"esri.dijit.editing.Union",type:"edit",
label:"Union Features",constructor:function(a){a=a||{};this._featureLayer=a.featureLayer;this._deletedGraphics=a.deletedGraphics;this._preUpdatedGraphics=a.preUpdatedGraphics;this._postUpdatedGraphics=a.postUpdatedGraphics;this._preUpdatedGraphicsGeometries=[];this._preUpdatedGraphicsAttributes=[];this._postUpdatedGraphicsGeometries=[];this._postUpdatedGraphicsAttributes=[];var n;for(n=0;n<a.preUpdatedGraphics.length;n++)this._preUpdatedGraphicsGeometries.push(a.preUpdatedGraphics[n].geometry.toJson()),
this._preUpdatedGraphicsAttributes.push(a.preUpdatedGraphics[n].attributes);for(n=0;n<a.postUpdatedGraphics.length;n++)this._postUpdatedGraphicsGeometries.push(a.postUpdatedGraphics[n].geometry.toJson()),this._postUpdatedGraphicsAttributes.push(z.clone(a.postUpdatedGraphics[n].attributes))},updateObjectIds:function(a,n){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,a,n);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,a,n);this.updateIds(this._featureLayer,
this._deletedGraphics,a,n)},performUndo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphics[a].setGeometry(c.fromJson(this._preUpdatedGraphicsGeometries[a])),this._postUpdatedGraphics[a].setAttributes(this._preUpdatedGraphicsAttributes[a]);var n=N.map(this._deletedGraphics,function(l){return l.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._deletedGraphics,this._postUpdatedGraphics,null).then(z.hitch(this,function(l,
b,u){l=N.map(l,function(w){return w.objectId});return{oldIds:n,addedIds:l,layer:this._featureLayer,operation:this}}))},performRedo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphics[a].setGeometry(c.fromJson(this._postUpdatedGraphicsGeometries[a])),this._postUpdatedGraphics[a].setAttributes(this._postUpdatedGraphicsAttributes[a]);return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,this._deletedGraphics).then(z.hitch(this,function(){return{layer:this._featureLayer,
operation:this}}))}});y("extend-esri")&&z.setObject("dijit.editing.Union",v,m);return v})},"esri/dijit/editing/toolbars/Drawing":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dijit/_CssStateMixin ../Util ./ToolbarBase ../tools/ButtonToolBase ../tools/Cut ../tools/Union ../tools/Reshape ../tools/Editing ../tools/EditingTools ../tools/Selection ../tools/SelectionTools ../../../kernel".split(" "),function(N,v,z,y,m,c,f,a,n,l,b,u,w,e,q,h,r){N=N([a,
c],{declaredClass:"esri.dijit.editing.toolbars.Drawing",onShowAttributeInspector:function(){},_activateTool:function(d,x){this._settings.editor._activeTool=d;"EDITING"!==d&&this._settings.templatePicker.clearSelection();"ATTRIBUTES"!==d&&this._settings.editor._hideAttributeInspector();"CLEAR"!==d&&this.inherited(arguments)},_initializeToolbar:function(){z.forEach(this._settings.layers,function(d){this._tbConnects.push(y.connect(d,"onSelectionComplete",this,"_updateUI"))},this)},activateEditing:function(d,
x){this._tools.EDITING._activateTool(d,x.geometryType);this._activeTool=this._tools.EDITING;this._activeTool.setChecked(!0)},_updateUI:function(){this._settings.undoManager&&(this._tools.UNDO.set("disabled",!1===this._settings.undoManager.canUndo),this._tools.REDO.set("disabled",!1===this._settings.undoManager.canRedo));this._selectedFeatures=f.getSelection(this._settings.layers);var d=this._selectedFeatures.length;this._tools.DELETE&&this._tools.DELETE.set("disabled",0>=d);this._tools.CLEAR&&this._tools.CLEAR.set("disabled",
0>=d);this._tools.ATTRIBUTES&&this._tools.ATTRIBUTES.set("disabled",0>=d);this._tools.UNION&&this._tools.UNION.set("disabled",2>d)},_toolFinished:function(d){if("ATTRIBUTES"===d&&this._selectedFeatures&&this._selectedFeatures.length)this.onShowAttributeInspector(this._selectedFeatures[0]);if("SELECT"===d||"CUT"===d||"RESHAPING"===d||"EDITING"===d)this._activeTool.deactivate(),this._activeTool.setChecked(!1),this._activeTool=null;if("DELETE"===d)this.onDelete();this._settings.editor._activeTool=null;
this._updateUI()},_createTools:function(){this._tools.SELECT=new q({settings:this._settings,onClick:v.hitch(this,"_activateTool","SELECT",!0),onFinished:v.hitch(this,"_toolFinished","SELECT")});this.addChild(this._tools.SELECT);this._tools.CLEAR=new n(v.mixin(h.selectClear,{settings:this._settings,onClick:v.hitch(this._settings.editor,"_clearSelection",!1)}));this.addChild(this._tools.CLEAR);this._createSeparator();this._tools.ATTRIBUTES=new n(v.mixin(e.attributes,{settings:this._settings,onClick:v.hitch(this,
"_toolFinished","ATTRIBUTES")}));this.addChild(this._tools.ATTRIBUTES);this._createSeparator();this._tools.EDITING=new w({settings:this._settings,onClick:v.hitch(this,"_activateTool","EDITING",!0),onApplyEdits:v.hitch(this,"onApplyEdits"),onFinished:v.hitch(this,"_toolFinished","EDITING")});this.addChild(this._tools.EDITING);this._tools.DELETE=new n(v.mixin(e.del,{settings:this._settings,onClick:v.hitch(this,"_toolFinished","DELETE")}));this.addChild(this._tools.DELETE);this._settings.toolbarOptions&&
((this._settings.toolbarOptions.cutVisible||this._settings.toolbarOptions.mergeVisible||this._settings.toolbarOptions.reshapeVisible)&&this._createSeparator(),this._settings.toolbarOptions.cutVisible&&(this._tools.CUT=new l({settings:this._settings,onFinished:v.hitch(this,"_toolFinished","CUT"),onClick:v.hitch(this,"_activateTool","CUT",!0),onApplyEdits:v.hitch(this,"onApplyEdits")}),this.addChild(this._tools.CUT)),this._settings.toolbarOptions.mergeVisible&&(this._tools.UNION=new b({settings:this._settings,
onFinished:v.hitch(this,"_toolFinished","UNION"),onApplyEdits:v.hitch(this,"onApplyEdits")}),this.addChild(this._tools.UNION)),this._settings.toolbarOptions.reshapeVisible&&(this._tools.RESHAPING=new u({settings:this._settings,onClick:v.hitch(this,"_activateTool","RESHAPING",!0),onFinished:v.hitch(this,"_toolFinished","RESHAPING"),onApplyEdits:v.hitch(this,"onApplyEdits")}),this.addChild(this._tools.RESHAPING)));this._settings.enableUndoRedo&&(this._createSeparator(),this._tools.UNDO=new n(v.mixin(e.undo,
{settings:this._settings,disabled:!0,onClick:v.hitch(this,function(){this._tools.UNDO.set("disabled",!0);this._tools.REDO.set("disabled",!0);this._settings.editor._undo()})})),this.addChild(this._tools.UNDO),this._tools.REDO=new n(v.mixin(e.redo,{settings:this._settings,disabled:!0,onClick:v.hitch(this,function(){this._tools.UNDO.set("disabled",!0);this._tools.REDO.set("disabled",!0);this._settings.editor._redo()})})),this.addChild(this._tools.REDO))}});m("extend-esri")&&v.setObject("dijit.editing.toolbars.Drawing",
N,r);return N})},"esri/dijit/editing/toolbars/ToolbarBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dijit/Toolbar dijit/ToolbarSeparator ../../../kernel ../../../lang".split(" "),function(N,v,z,y,m,c,f,a,n){N=N([c],{declaredClass:"esri.dijit.editing.toolbars.ToolbarBase",_enabled:!0,graphicsAdded:function(){},drawEnd:function(){},onApplyEdits:function(){},onDelete:function(){},constructor:function(l,b){l&&l.settings&&(this._tools=[],this._tbConnects=
[],this._initialize(l.settings))},postCreate:function(){this._createTools();this.deactivate()},destroy:function(){var l,b=this._tools;for(l in b)b.hasOwnProperty(l)&&n.isDefined(this._tools[l])&&this._tools[l].destroy();z.forEach(this._tbConnects,y.disconnect);this.inherited(arguments)},activate:function(l){this._enabled=!0},deactivate:function(){var l;this._enabled=!1;this._geometryType=this._layer=null;var b=this._tools;for(l in b)b.hasOwnProperty(l)&&(this._tools[l].deactivate(),this._tools[l].setChecked(!1))},
isEnabled:function(){return this._enabled},setActiveSymbol:function(l){this._activeSymbol=l},_getSymbol:function(){},_createTools:function(){},_initialize:function(l){this._settings=l;this._toolbar=l.drawToolbar;this._editToolbar=l.editToolbar;this._initializeToolbar()},_activateTool:function(l,b){this._activeTool&&this._activeTool.deactivate();!0===b&&this._activeTool==this._tools[l]?(this._activeTool.setChecked(!1),this._activeTool=null):(this._activeTool=this._tools[l],this._activeTool.setChecked(!0),
this._activeTool.activate(null))},_createSeparator:function(){this.addChild(new f)}});m("extend-esri")&&v.setObject("dijit.editing.toolbars.ToolbarBase",N,a);return N})},"esri/dijit/editing/tools/ButtonToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/form/Button ./ToolBase ../../../kernel".split(" "),function(N,v,z,y,m,c){N=N([y,m],{declaredClass:"esri.dijit.editing.tools.ButtonToolBase",postCreate:function(){this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},
destroy:function(){y.prototype.destroy.apply(this,arguments);m.prototype.destroy.apply(this,arguments)}});z("extend-esri")&&v.setObject("dijit.editing.tools.ButtonToolBase",N,c);return N})},"esri/dijit/editing/tools/ToolBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../../../kernel","dojo/i18n!../../../nls/jsapi"],function(N,v,z,y,m){N=N(null,{declaredClass:"esri.dijit.editing.tools.ToolBase",_enabled:!0,showLabel:!1,constructor:function(c,f){c=c||{};v.mixin(this,c);this.label=
this._label?m.widgets.editor.tools[this._label]:"";this._settings=c.settings;this._toolbar=c.settings.drawToolbar;this._editToolbar=c.settings.editToolbar;this._initializeTool()},onFinished:function(){},onDrawEnd:function(){},onApplyEdits:function(){},postCreate:function(){this.deactivate();this.inherited(arguments)},destroy:function(){},activate:function(c){this._toolbar&&this._toolbar.deactivate();this._editToolbar&&this._editToolbar.deactivate();this._enabled&&(this._checked=!0,this._layer=c,this._toolbar&&
this._drawType&&this._toolbar.activate(this._drawType))},deactivate:function(){this._toolbar&&this._toolbar.deactivate();this._editToolbar&&this._editToolbar.deactivate();this.setChecked(!1);this._updateUI()},setEnabled:function(c){this._enabled=c;this._updateUI()},setChecked:function(c){this._checked=c},enable:function(c){this._updateUI()},isEnabled:function(){return this._enabled},getToolName:function(){return this._toolName},_initializeTool:function(){},_updateUI:function(){this.disabled=!this._enabled;
this.attr("iconClass",this._enabled?this._enabledIcon:this._disabledIcon)}});z("extend-esri")&&v.setObject("dijit.editing.tools.ToolBase",N,y);return N})},"esri/dijit/editing/tools/Cut":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dojo/DeferredList ../../../graphicsUtils ../../../graphic ../../../tasks/query ../../../layers/FeatureLayer ../../../toolbars/draw ../Cut ./ToggleToolBase ../../../kernel".split(" "),function(N,v,z,y,m,c,f,a,n,l,b,u,
w,e){N=N([w],{declaredClass:"esri.dijit.editing.tools.Cut",id:"btnFeatureCut",_enabledIcon:"toolbarIcon cutIcon",_disabledIcon:"toolbarIcon cutIcon",_drawType:b.POLYLINE,_enabled:!0,_label:"NLS_cutLbl",_cutConnects:[],activate:function(){this._cutConnects.push(y.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd"));this.inherited(arguments)},deactivate:function(){this.inherited(arguments);z.forEach(this._cutConnects,y.disconnect);this._cutConnects=[];this._edits=[]},_onDrawEnd:function(q){var h=this._cutLayers=
z.filter(this._settings.layers,function(d){return"esriGeometryPolygon"===d.geometryType||"esriGeometryPolyline"===d.geometryType&&d.visible&&d._isMapAtVisibleScale()});this._cutConnects=this._cutConnects.concat(z.map(h,v.hitch(this,function(d){return y.connect(d,"onEditsComplete",v.hitch(this,function(x,C,L){if(this._settings.undoRedoManager){var t=this._settings.undoRedoManager;z.forEach(this._edits,v.hitch(this,function(p){t.add(new u({featureLayer:p.layer,addedGraphics:p.adds,preUpdatedGraphics:p.preUpdates,
postUpdatedGraphics:p.updates}))}),this)}this.onFinished()}))})));var r=new n;r.geometry=q;z.forEach(h,function(d,x){this._settings.editor._selectionHelper.selectFeatures([d],r,l.SELECTION_NEW,v.hitch(this,"_cutFeatures",d,r))},this)},_cutFeatures:function(q,h,r){if(r&&r.length){this._edits=[];var d=[];d.push(this._settings.geometryService.cut(f.getGeometries(r),h.geometry,v.hitch(this,"_cutHandler",q,r)));(new c(d)).addCallback(v.hitch(this,function(){this.onApplyEdits(this._edits)}))}},_cutHandler:function(q,
h,r){var d=[],x=[],C=z.map(h,function(p){return new a(v.clone(p.toJson()))}),L,t;z.forEach(r.cutIndexes,function(p,G){L!=p?(L=p,x.push(h[p].setGeometry(r.geometries[G]))):(t=new a(r.geometries[G],null,v.mixin({},h[p].attributes),null),t.attributes[h[0].getLayer().objectIdField]=null,d.push(t))},this);this._edits.push({layer:q,adds:d,updates:x,preUpdates:C})}});m("extend-esri")&&v.setObject("dijit.editing.tools.Cut",N,e);return N})},"esri/dijit/editing/tools/ToggleToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/form/ToggleButton ./ToolBase ../../../kernel".split(" "),
function(N,v,z,y,m,c){N=N([y,m],{declaredClass:"esri.dijit.editing.tools.ToggleToolBase",postCreate:function(){this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},destroy:function(){y.prototype.destroy.apply(this,arguments);m.prototype.destroy.apply(this,arguments)},setChecked:function(f){y.prototype.setChecked.apply(this,arguments)}});z("extend-esri")&&v.setObject("dijit.editing.tools.ToggleToolBase",N,c);return N})},"esri/dijit/editing/tools/Union":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../../../graphicsUtils ../../../graphic ../../../toolbars/draw ../Union ./ButtonToolBase ../../../kernel".split(" "),
function(N,v,z,y,m,c,f,a,n,l){N=N([n],{declaredClass:"esri.dijit.editing.tools.Union",id:"btnFeatureUnion",_enabledIcon:"toolbarIcon unionIcon",_disabledIcon:"toolbarIcon unionIcon",_drawType:f.POLYLINE,_enabled:!0,_label:"NLS_unionLbl",_onClick:function(b){this._settings.editor._activeTool="UNION";b=z.filter(this._settings.layers,function(e){return"esriGeometryPolygon"===e.geometryType&&e.visible&&e._isMapAtVisibleScale()});var u=[],w=0;z.forEach(b,function(e,q){var h=e.getSelectedFeatures();2<=
h.length&&(w++,this._settings.geometryService.union(m.getGeometries(h),v.hitch(this,function(r){var d=h.shift(),x=[],C=[];x.push(new c(d.toJson()));C.push(d.setGeometry(r));u.push({layer:e,updates:C,deletes:h,preUpdates:x});w--;if(0>=w)this.onApplyEdits(u,v.hitch(this,function(){if(this._settings.undoRedoManager){var L=this._settings.undoRedoManager;z.forEach(this._edits,v.hitch(this,function(t){L.add(new a({featureLayer:t.layer,deletedGraphics:t.deletes,preUpdatedGraphics:t.preUpdates,postUpdatedGraphics:t.updates}))}),
this)}this._settings.editor._selectionHelper.clearSelection(!1);this.onFinished()}))})))},this)}});y("extend-esri")&&v.setObject("dijit.editing.tools.Union",N,l);return N})},"esri/dijit/editing/tools/Reshape":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has ../../../graphic ../../../layers/FeatureLayer ../../../tasks/query ../../../toolbars/draw ./ToggleToolBase ../../../kernel".split(" "),function(N,v,z,y,m,c,f,a,n,l,b){N=N([l],{declaredClass:"esri.dijit.editing.tools.Reshape",
id:"btnFeatureReshape",_enabledIcon:"toolbarIcon reshapeIcon",_disabledIcon:"toolbarIcon reshapeIcon",_drawType:n.POLYLINE,_enabled:!0,_label:"NLS_reshapeLbl",activate:function(){y.disconnect(this._rConnect);this._rConnect=y.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd");this.inherited(arguments)},deactivate:function(){this.inherited(arguments);y.disconnect(this._rConnect);delete this._rConnect},_onDrawEnd:function(u){var w=this._settings.layers,e=new a;e.geometry=u;u=this._reshapeLayers=z.filter(w,
function(q){return"esriGeometryPolygon"===q.geometryType||"esriGeometryPolyline"});this._settings.editor._selectionHelper.selectFeatures(u,e,f.SELECTION_NEW,v.hitch(this,"_reshape",e))},_reshape:function(u,w){if(1===w.length){var e=[],q=[],h=[],r=w[0],d=r.getLayer();this._settings.geometryService.reshape(r.geometry,u.geometry,v.hitch(this,function(x){"polyline"===x.type&&x.paths&&0===x.paths.length?(this._settings.editor._selectionHelper.clearSelection(!1),this.onFinished()):"polygon"===x.type&&x.rings&&
0===x.rings.length?(this._settings.editor._selectionHelper.clearSelection(!1),this.onFinished()):(h.push(new c(r.toJson())),q.push(r.setGeometry(x)),e.push({layer:d,updates:q,preUpdates:h}),this.onApplyEdits(e,v.hitch(this,function(){this._settings.editor._selectionHelper.clearSelection(!1);this.onFinished()})))}))}}});m("extend-esri")&&v.setObject("dijit.editing.tools.Reshape",N,b);return N})},"esri/dijit/editing/tools/Editing":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../../../layers/FeatureTemplate ./Edit ./EditingTools ./DropDownToolBase ../../../kernel ../../../lang".split(" "),
function(N,v,z,y,m,c,f,a,n,l){N=N([a],{declaredClass:"esri.dijit.editing.tools.Editing",_enabled:!1,deactivate:function(){this._enabled&&(this._enabled=!1,this.inherited(arguments),this._settings.templatePicker.clearSelection())},onItemClicked:function(b,u){this.inherited(arguments);this._activeTool===this._tools.AUTOCOMPLETE&&(this._settings.editor._drawingTool=m.TOOL_AUTO_COMPLETE_POLYGON)},_activateTool:function(b,u){var w;this.enable(u);for(w in this._tools)this._tools.hasOwnProperty(w)&&(this.dropDown.removeChild(this._tools[w]),
!0===this._tools[w]._enabled&&this.dropDown.addChild(this._tools[w]));if(this._geometryType!==u||!1===this._activeTool._enabled)this._activeTool=this._tools[b.toUpperCase()];this._geometryType=u;this._activeTool.activate();this._activeTool.setChecked(!0);this._updateUI()},_initializeTool:function(b){this.inherited(arguments);this._initializeTools()},_initializeTools:function(){var b=this._settings.layers,u=this._settings.editor,w=!1,e=!1,q=!1,h=this._toolTypes=[],r;z.forEach(b,function(d){r=d.geometryType;
w=w||"esriGeometryPoint"===r;e=e||"esriGeometryPolyline"===r;q=q||"esriGeometryPolygon"===r;h=h.concat(z.map(this._getTemplatesFromLayer(d),v.hitch(this,function(x){return u._toDrawTool(x.drawingTool,d)})))},this);b=this._settings.createOptions;w&&this._toolTypes.push("point");e&&(this._toolTypes=this._toolTypes.concat(b.polylineDrawTools));q&&(this._toolTypes=this._toolTypes.concat(b.polygonDrawTools));this._toolTypes=this._toUnique(this._toolTypes.concat(h))},_toUnique:function(b){var u={};return z.filter(b,
function(w){return u[w]?!1:u[w]=!0})},_getTemplatesFromLayer:function(b){var u=b.templates||[];z.forEach(b.types,function(w){u=u.concat(w.templates)});return z.filter(u,l.isDefined)},_createTools:function(){z.forEach(this._toolTypes,this._createTool,this);this.inherited(arguments)},_createTool:function(b){var u=v.mixin(f[b],{settings:this._settings,onClick:v.hitch(this,"onItemClicked",f[b].id)});this._tools[b.toUpperCase()]=new c(u)}});y("extend-esri")&&v.setObject("dijit.editing.tools.Editing",N,
n);return N})},"esri/dijit/editing/tools/Edit":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","./MenuItemBase","../../../kernel"],function(N,v,z,y,m){N=N([y],{declaredClass:"esri.dijit.editing.tools.Edit",enable:function(c){this._enabled=c===this._geomType;this.inherited(arguments)}});z("extend-esri")&&v.setObject("dijit.editing.tools.Edit",N,m);return N})},"esri/dijit/editing/tools/MenuItemBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/MenuItem ./ToolBase ../../../kernel".split(" "),
function(N,v,z,y,m,c){N=N([y,m],{declaredClass:"esri.dijit.editing.tools.MenuItemBase",destroy:function(){y.prototype.destroy.apply(this,arguments);m.prototype.destroy.apply(this,arguments)}});z("extend-esri")&&v.setObject("dijit.editing.tools.MenuItemBase",N,c);return N})},"esri/dijit/editing/tools/EditingTools":function(){define(["dojo/_base/lang","dojo/has","../../../toolbars/draw","../../../kernel"],function(N,v,z,y){z={point:{id:"esriPointTool",_enabledIcon:"toolbarIcon pointIcon",_disabledIcon:"toolbarIcon pointIconDisabled",
_drawType:z.POINT,_geomType:"esriGeometryPoint",_label:"NLS_pointLbl"},polyline:{id:"toolDrawFreehandPolyline",_enabledIcon:"toolbarIcon polylineIcon",_disabledIcon:"toolbarIcon polylineIconDisabled",_drawType:z.POLYLINE,_geomType:"esriGeometryPolyline",_label:"NLS_polylineLbl"},freehandpolyline:{id:"toolDrawPolyline",_enabledIcon:"toolbarIcon freehandPolylineIcon",_disabledIcon:"toolbarIcon freehandPolylineIcon",_drawType:z.FREEHAND_POLYLINE,_geomType:"esriGeometryPolyline",_label:"NLS_freehandPolylineLbl"},
polygon:{id:"toolDrawPolygon",_enabledIcon:"toolbarIcon polygonIcon",_disabledIcon:"toolbarIcon polygonIconDisabled",_drawType:z.POLYGON,_geomType:"esriGeometryPolygon",_label:"NLS_polygonLbl"},freehandpolygon:{id:"toolDrawFreehandPolygon",_enabledIcon:"toolbarIcon freehandPolygonIcon",_disabledIcon:"toolbarIcon freehandPolygonIconDisabled",_drawType:z.FREEHAND_POLYGON,_label:"NLS_freehandPolygonLbl",_geomType:"esriGeometryPolygon"},autocomplete:{id:"btnFeatureAutoComplete",_enabledIcon:"toolbarIcon autoCompleteIcon",
_disabledIcon:"toolbarIcon autoCompleteIcon",_drawType:z.POLYGON,_label:"NLS_autoCompleteLbl",_geomType:"esriGeometryPolygon"},rectangle:{id:"toolDrawRect",_enabledIcon:"toolbarIcon rectangleIcon",_disabledIcon:"toolbarIcon rectangleIcon",_drawType:z.RECTANGLE,_geomType:"esriGeometryPolygon",_label:"NLS_rectangleLbl"},arrow:{id:"toolDrawArrow",_enabledIcon:"toolbarIcon arrowIcon",_disabledIcon:"toolbarIcon arrowIcon",_drawType:z.ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowLbl"},uparrow:{id:"toolDrawArrowUp",
_enabledIcon:"toolbarIcon arrowUpIcon",_disabledIcon:"toolbarIcon arrowUpIcon",_drawType:z.UP_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowUpLbl"},downarrow:{id:"toolDrawDownArrow",_enabledIcon:"toolbarIcon arrowDownIcon",_disabledIcon:"toolbarIcon arrowDownIcon",_drawType:z.DOWN_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowDownLbl"},leftarrow:{id:"toolDrawLeftArrow",_enabledIcon:"toolbarIcon arrowLeftIcon",_disabledIcon:"toolbarIcon arrowLeftIcon",_drawType:z.LEFT_ARROW,_geomType:"esriGeometryPolygon",
_label:"NLS_arrowLeftLbl"},rightarrow:{id:"toolDrawRightArrow",_enabledIcon:"toolbarIcon arrowIcon",_disabledIcon:"toolbarIcon arrowIcon",_drawType:z.RIGHT_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowRightLbl"},circle:{id:"toolDrawCircle",_enabledIcon:"toolbarIcon circleIcon",_disabledIcon:"toolbarIcon circleIcon",_drawType:z.CIRCLE,_geomType:"esriGeometryPolygon",_label:"NLS_circleLbl"},ellipse:{id:"toolDrawEllipse",_enabledIcon:"toolbarIcon ellipseIcon",_disabledIcon:"toolbarIcon ellipseIcon",
_drawType:z.ELLIPSE,_geomType:"esriGeometryPolygon",_label:"NLS_ellipseLbl"},triangle:{id:"toolDrawTriangle",_enabledIcon:"toolbarIcon triangleIcon",_disabledIcon:"toolbarIcon triangleIcon",_drawType:z.TRIANGLE,_geomType:"esriGeometryPolygon",_label:"NLS_triangleLbl"},attributes:{id:"btnAttributes",_enabledIcon:"toolbarIcon attributesIcon",_disabledIcon:"toolbarIcon attributesIcon",_enabled:!1,_label:"NLS_attributesLbl"},del:{id:"btnDelete2",_enabledIcon:"toolbarIcon deleteFeatureIcon",_disabledIcon:"toolbarIcon deleteFeatureIcon",
_enabled:!1,_label:"NLS_deleteLbl"},undo:{id:"btnUndo",_enabledIcon:"dijitEditorIcon dijitEditorIconUndo",_disabledIcon:"dijitEditorIcon dijitEditorIconUndo",_enabled:!1,_label:"NLS_undoLbl"},redo:{id:"btnRedo",_enabledIcon:"dijitEditorIcon dijitEditorIconRedo",_disabledIcon:"dijitEditorIcon dijitEditorIconRedo",_enabled:!1,_label:"NLS_redoLbl"}};v("extend-esri")&&N.setObject("dijit.editing.tools.EditingTools",z,y);return z})},"esri/dijit/editing/tools/DropDownToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-style dijit/registry dijit/Menu dijit/form/ComboButton ./ToolBase ../../../kernel ../../../lang".split(" "),
function(N,v,z,y,m,c,f,a,n,l){N=N([f,a],{declaredClass:"esri.dijit.editing.tools.DropDownToolBase",_enabled:!1,_checked:!1,postCreate:function(){this._tools=[];this._createTools();this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},destroy:function(){var b,u=this._tools;for(b in u)u.hasOwnProperty(b)&&l.isDefined(u[b])&&u[b].destroy();this.inherited(arguments)},_createTools:function(){var b,u=new c;this.dropDown=u;for(b in this._tools)this._tools.hasOwnProperty(b)&&u.addChild(this._tools[b]);
this._activeTool=u.getChildren()[0];this._updateUI()},activate:function(b){this.inherited(arguments);this._activeTool?this._activeTool.activate():this._activateDefaultTool()},deactivate:function(){this.inherited(arguments);this._activeTool&&this._activeTool.deactivate()},enable:function(b){for(var u in this._tools)this._tools.hasOwnProperty(u)&&this._tools[u].enable(b);this.setEnabled(!0);this.inherited(arguments)},setChecked:function(b){this._checked=b;this._updateUI()},_onDrawEnd:function(b){},
onLayerChange:function(b,u,w){this._activeTool=null;this._activeType=u;this._activeTemplate=w;this._activeLayer=b},onItemClicked:function(b,u){this._activeTool&&this._activeTool.deactivate();this._activeTool=m.byId(b);!1===this._checked?this._onClick():(this._updateUI(),this._activeTool&&(this._activeTool.activate(),this._activeTool.setChecked(!0)))},_onClick:function(b){!1!==this._enabled&&(this._checked=!this._checked,this.inherited(arguments))},_updateUI:function(){this.attr("disabled",!this._enabled);
y.set(this.focusNode,{outline:"none"});y.set(this.titleNode,{padding:"0px",border:"none"});this._checked?y.set(this.titleNode,{backgroundColor:"#D4DFF2",border:"1px solid #316AC5"}):y.set(this.titleNode,{backgroundColor:"",border:""});this._activeTool&&(this.attr("iconClass",this._checked?this._activeTool._enabledIcon:this._activeTool._disabledIcon),this.attr("label",this._activeTool.label))}});z("extend-esri")&&v.setObject("dijit.editing.tools.DropDownToolBase",N,n);return N})},"esri/dijit/editing/tools/Selection":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has ../../../symbols/SimpleMarkerSymbol ../../../symbols/SimpleLineSymbol ../../../symbols/SimpleFillSymbol ./Edit ./SelectionTools ./DropDownToolBase ../../../kernel".split(" "),
function(N,v,z,y,m,c,f,a,n,l,b,u,w){N=N([u],{declaredClass:"esri.dijit.editing.tools.Selection",_enabled:!0,activate:function(){this.inherited(arguments);this._sConnect=y.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd")},deactivate:function(){this.inherited(arguments);y.disconnect(this._sConnect);delete this._sConnect},_initializeTool:function(){this._createSymbols();this._initializeLayers();this._toolTypes=["select","selectadd","selectremove"]},_onDrawEnd:function(e){this.inherited(arguments);
this._settings.editor._hideAttributeInspector();var q=this._settings.layers;this._selectMethod=this._activeTool._selectMethod;this._settings.editor._selectionHelper.selectFeaturesByGeometry(q,e,this._selectMethod,v.hitch(this,"onFinished"))},_createSymbols:function(){this._pointSelectionSymbol=new f(f.STYLE_CIRCLE,10,new a(a.STYLE_SOLID,new m([0,0,0]),1),new m([255,0,0,.5]));this._polylineSelectionSymbol=new a(a.STYLE_SOLID,new m([0,200,255]),2);this._polygonSelectionSymbol=new n(n.STYLE_SOLID,new a(a.STYLE_SOLID,
new m([0,0,0]),1),new m([0,200,255,.5]))},_initializeLayers:function(){z.forEach(this._settings.layers,this._setSelectionSymbol,this)},_setSelectionSymbol:function(e){var q=null;switch(e.geometryType){case "esriGeometryPoint":q=this._pointSelectionSymbol;break;case "esriGeometryPolyline":q=this._polylineSelectionSymbol;break;case "esriGeometryPolygon":q=this._polygonSelectionSymbol}e.setSelectionSymbol(e._selectionSymbol||q)},_createTools:function(){z.forEach(this._toolTypes,this._createTool,this);
this.inherited(arguments)},_createTool:function(e){var q=v.mixin(b[e],{settings:this._settings,onClick:v.hitch(this,"onItemClicked",b[e].id)});this._tools[e.toUpperCase()]=new l(q)}});c("extend-esri")&&v.setObject("dijit.editing.tools.Selection",N,w);return N})},"esri/dijit/editing/tools/SelectionTools":function(){define(["dojo/_base/lang","dojo/has","../../../layers/FeatureLayer","../../../toolbars/draw","../../../kernel"],function(N,v,z,y,m){z={select:{id:"btnNewSelection",_enabledIcon:"toolbarIcon newSelectionIcon",
_disabledIcon:"toolbarIcon newSelectionIcon",_drawType:y.EXTENT,_selectMethod:z.SELECTION_NEW,_label:"NLS_selectionNewLbl"},selectadd:{id:"btnAddToSelection",_enabledIcon:"toolbarIcon addToSelectionIcon",_disabledIcon:"toolbarIcon addToSelectionIcon",_drawType:y.EXTENT,_selectMethod:z.SELECTION_ADD,_label:"NLS_selectionAddLbl"},selectremove:{id:"btnSubtractFromSelection",_enabledIcon:"toolbarIcon removeFromSelectionIcon",_disabledIcon:"toolbarIcon removeFromSelectionIcon",_drawType:y.EXTENT,_selectMethod:z.SELECTION_SUBTRACT,
_label:"NLS_selectionRemoveLbl"},selectClear:{id:"btnClearSelection",_enabledIcon:"toolbarIcon clearSelectionIcon",_disabledIcon:"toolbarIcon clearSelectionIcon",_enabled:!1,_label:"NLS_selectionClearLbl"}};v("extend-esri")&&N.setObject("dijit.editing.tools.SelectionTools",z,m);return z})},"esri/dijit/editing/SelectionHelper":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dojo/DeferredList ../../geometry/Extent ../../geometry/Point ../../geometry/ScreenPoint ../../layers/FeatureLayer ../../tasks/query ../../kernel".split(" "),
function(N,v,z,y,m,c,f,a,n,l,b,u){N=N(null,{declaredClass:"esri.dijit.editing.SelectionHelper",constructor:function(w){this._settings=w||{};this._sConnects=[];this._mapServiceCount=0;this._map=this._settings.map;this._tolerance=this._settings.singleSelectionTolerance;this._initMapServiceInfos(this._settings.layers)},destroy:function(){for(var w in this._sConnects)this._sConnects.hasOwnProperty(w)&&z.disconnect(this._sConnects[w])},selectFeatures:function(w,e,q,h){q===l.SELECTION_NEW&&(this._resetMapServiceInfos(),
this.getSelection(w));var r=[];y.forEach(w,function(d){if(!0===d.visible&&!0===d._isMapAtVisibleScale()){var x=q;d._isSelOnly&&x===l.SELECTION_NEW&&(x=l.SELECTION_ADD);r.push(d.selectFeatures(e,x))}});(new c(r)).addCallback(v.hitch(this,function(d){var x=[];y.forEach(d,function(C,L){y.forEach(C[1],function(t){(t=w[L]._mode._getFeature(t.attributes[w[L].objectIdField])||null)&&x.push(t)},this)},this);this._mapServiceCount?((d=q===l.SELECTION_SUBTRACT)?(this._resetMapServiceInfos(),this._createLayerDefs(this._getLayerInfosFromSelection(w))):
this._createLayerDefs(this._getLayerInfosFromFeatures(x)),this._updateLayerDefs(this._mapServiceInfos,!1,!(x&&x.length||d),v.hitch(this,h,x))):h(x)}))},selectFeaturesByGeometry:function(w,e,q,h){var r=e;-1!==e.declaredClass.indexOf("Extent")&&e.xmax===e.xmin&&e.ymax===e.ymin&&(r=new a(e.xmax,e.ymax,e.spatialReference));r=-1!==r.declaredClass.indexOf("Point")?this._extentFromPoint(r):r;e=new b;e.geometry=r;this.selectFeatures(w,e,q,h)},clearSelection:function(w){y.forEach(this._nonSelOnlyLayers,function(q){q.clearSelection&&
q.clearSelection()});if(this._mapServiceCount){this._resetMapServiceInfos();var e=this._getLayerInfosFromSelection(this._settings.layers);y.some(e,function(q){return q.oids&&q.oids.length})&&(this._createLayerDefs(e),this._updateLayerDefs(this._mapServiceInfos,!0,w||!1))}},findMapService:function(w){var e=this._map,q=e.layerIds;w=w&&w._url&&w._url.path?w._url.path.toLowerCase():"";var h;for(h in q)if(q.hasOwnProperty(h)){var r=e.getLayer(q[h]);var d=r._url?r._url.path?r._url.path.toLowerCase().replace("mapserver",
"featureserver"):r._url.toLowerCase().replace("mapserver","featureserver"):"";if(w.substr(0,d.length)===d&&"esri.layers.ArcGISDynamicMapServiceLayer"===r.declaredClass)return r}},getSelection:function(w){var e=[];y.forEach(w,function(q){q._isSelOnly&&e.push(this._createLayerInfo(q))},this);y.forEach(e,function(q){var h=this._createMapServiceInfo(this.findMapService(q.layer));h&&(h.layerInfos[q.layer.layerId]=q)},this)},_initMapServiceInfos:function(w){this._nonSelOnlyLayers=[];this._mapServiceInfos=
[];y.forEach(w,function(e){var q=this.findMapService(e);q?(this._mapServiceCount++,this._createMapServiceInfo(q),q&&q.setDisableClientCaching(!0)):this._nonSelOnlyLayers.push(e)},this)},_createMapServiceInfo:function(w){if(!w)return null;var e=this._mapServiceInfos,q=e[w.id];q||(q=e[w.id]={mapService:w,layerInfos:[],layerDefs:v.mixin([],w.layerDefinitions||[]),origLayerDefs:v.mixin([],w.layerDefinitions||[])});return q},_resetMapServiceInfo:function(w){y.forEach(w.layerInfos,this._resetLayerInfo);
w.layerDefs=v.mixin([],w.origLayerDefs||[])},_resetMapServiceInfos:function(){var w=this._mapServiceInfos,e;for(e in w)w.hasOwnProperty(e)&&this._resetMapServiceInfo(w[e])},_createLayerInfo:function(w,e){var q=w.objectIdField;e=e?[]:w.getSelectedFeatures();return{layer:w,selectedFeatures:e||[],oids:y.map(e,function(h){return h.attributes[q]})}},_resetLayerInfo:function(w){w&&(w.selectedFeatures=[],w.oids=[])},_updateLayerDefs:function(w,e,q,h){for(var r in w)if(w.hasOwnProperty(r)){var d=w[r],x=d.mapService,
C=d.layerDefs=e?v.mixin([],d.origLayerDefs||[]):d.layerDefs;C?(q?h&&h():this._sConnects[x.id]=z.connect(x,"onUpdateEnd",v.hitch(this,"_onMapServiceUpdate",d,e,h)),x.setLayerDefinitions(C,q||!1)):h&&h()}},_onMapServiceUpdate:function(w,e,q){z.disconnect(this._sConnects[w.mapService.id]);y.forEach(w.layerInfos,function(h){if(e)h&&h.layer.clearSelection();else{var r=new b;r.objectIds=h?h.oids:[];r.objectIds.length&&h.layer.selectFeatures(r,l.SELECTION_SUBTRACT)}},this);e&&this._resetMapServiceInfo(w);
q&&q()},_createLayerDefs:function(w){y.forEach(w,function(e){var q=e.layer,h=this._createMapServiceInfo(this.findMapService(e.layer));if(h){h=h.layerDefs;var r=q.layerId,d='("'+q.objectIdField+'" NOT IN (',x=e.oids;x&&x.length&&(y.forEach(e.oids,function(C,L){x=!0;L&&(d+=",");d+="'"+C+"'"}),d+="))",h[r]=h.length&&h[r]&&h[r].length?h[r]+(" AND"+d):d)}},this)},_getLayerInfosFromFeatures:function(w){var e=[];y.forEach(w,function(h){var r=h.getLayer();r&&r._isSelOnly&&(e[r.id]||(e[r.id]=this._createLayerInfo(r,
!0)),e[r.id].selectedFeatures.push(h),e[r.id].oids.push(h.attributes[r.objectIdField]))},this);w=[];for(var q in e)e.hasOwnProperty(q)&&w.push(e[q]);return w},_getLayerInfosFromSelection:function(w){var e=[];y.forEach(w,function(q){q._isSelOnly&&e.push(this._createLayerInfo(q,!1))},this);return e},_extentFromPoint:function(w){var e=this._tolerance,q=this._map,h=q.toScreen(w);w=new n(h.x-e,h.y+e);e=new n(h.x+e,h.y-e);w=q.toMap(w);e=q.toMap(e);return new f(w.x,w.y,e.x,e.y,q.spatialReference)}});m("extend-esri")&&
v.setObject("dijit.editing.SelectionHelper",N,u);return N})},"esri/dijit/editing/TemplatePicker":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/html dojo/_base/array dojo/_base/json dojo/_base/kernel dojo/has dojo/query dojo/sniff dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dijit/_Widget dijit/_Templated dojo/data/ItemFileReadStore dojox/grid/DataGrid dojox/gfx ../../layers/FeatureLayer ../../symbols/SimpleMarkerSymbol ../../symbols/PictureMarkerSymbol ../../symbols/SimpleFillSymbol ../../symbols/SimpleLineSymbol ./TemplatePickerItem ../../kernel ../../lang ../../request ../_EventedWidget dojo/i18n!../../nls/jsapi dojo/text!./templates/TemplatePicker.html".split(" "),
function(N,v,z,y,m,c,f,a,n,l,b,u,w,e,q,h,r,d,x,C,L,t,p,G,T,D,P,O,X,H,g){var B=N([X,q,h],{declaredClass:"esri.dijit.editing.TemplatePicker",widgetsInTemplate:!0,templateString:g,featureLayers:null,items:null,grouping:!0,showTooltip:!1,maxLabelLength:0,rows:4,_rows:0,columns:3,surfaceWidth:30,surfaceHeight:30,emptyMessage:"",useLegend:!0,legendCache:{},_uniqueId:{id:0},_assumedCellWidth:90,_initialAutoWidth:300,_initialAutoHeight:200,_ieTimer:150,constructor:function(A,I){A=A||{};A.items||A.featureLayers||
console.error("TemplatePicker: please provide 'featureLayers' or 'items' parameter in the constructor");this._dojo14x=4<=f.version.minor;this._itemWidgets={};A.featureLayers&&A.featureLayers.length&&(this._flChanged=1);this._nls=H.widgets.templatePicker;this.emptyMessage=A.emptyMessage||this._nls&&this._nls.creationDisabled||""},postMixInProperties:function(){this.inherited(arguments);this._preprocess()},startup:function(){this.inherited(arguments);if("auto"===this.rows&&"auto"===this.columns){var A=
w.getContentBox(this.domNode);A.w||(this.domNode.style.width=this._initialAutoWidth+"px");if(!A.h||1>=A.h)this.domNode.style.height=this._initialAutoHeight+"px";A=w.getContentBox(this.domNode);this._columns=Math.floor(A.w/this._assumedCellWidth)||1}this._applyGridPatches();this._setGridLayout();z.connect(this.grid,"onRowClick",this,this._rowClicked);this._setGridData();this._toggleTooltip();9>a("ie")&&(this._repaintItems=v.hitch(this,this._repaintItems),setTimeout(this._repaintItems,this._ieTimer))},
destroy:function(){this.showTooltip=!1;this._toggleTooltip();this._clearLegendInfo();this.featureLayers=this.items=this.grid=this._flItems=this._itItems=this._groupRowIndices=this._selectedCell=this._selectedInfo=this._selectedItem=null;this.inherited(arguments)},getSelected:function(){return this._selectedCell?this._selectedItem:null},clearSelection:function(){var A=this._selectedCell,I=this._selectedInfo;A&&this._rowClicked({cellNode:A,rowIndex:I.selRow,cellIndex:I.selCol})},update:function(A){A=
"auto"===this.rows&&"auto"===this.columns&&A?!0:!1;var I=this.grid;if(A){var M=this.domNode;var R=f.query("#"+M.id+".templatePicker div.item")[0];M=w.getContentBox(M);R=(R=R&&R.parentNode)?y.coords(R).w:this._assumedCellWidth;this._columns=(this._columns=Math.floor((M.w-I.views.views[0].getScrollbarWidth())/R))||1}R=this._rows;this._preprocess();var S=this._rows;this._setGridLayout();this._setGridData();S!==R&&I.set("autoHeight",this._rows,!1);A?(I._resize({w:M.w,h:M.h}),I.viewsHeaderNode.style.display=
"none"):I.update();this._toggleTooltip();var W=this,V=this.getSelected();V&&I.store.fetch({onComplete:function(k){var F=(k=W._locate(V,W._selectedInfo,k))&&I.views.views[0].getCellNode(k[0],k[1]);F&&W._rowClicked({cellNode:F,rowIndex:k[0],cellIndex:k[1]},!0)}});9>a("ie")&&setTimeout(this._repaintItems,this._ieTimer);A=this.featureLayers;M=this.items;A&&A.length||M&&M.length||!I||!this.emptyMessage||I.showMessage(this.emptyMessage)},_eventMap:{"selection-change":!0},onSelectionChange:function(){},
_setUseLegendAttr:function(A){var I=this.useLegend;this._started&&I===A||(A?this._flChanged=1:this._clearLegendInfo());this.useLegend=A},_setFeatureLayersAttr:function(A){var I=this.featureLayers;this._started&&I===A||(this._flChanged=1);this.featureLayers=A},_adjustRowsCols:function(A){if("auto"===this.rows&&"auto"===this.columns)this._started||(this._rows=!1,this._columns=null,this._autoWidth=!1);else{var I=0;this._rows=this.rows;this._columns=this.columns;"auto"===this.rows?(this.featureLayers?
this.grouping?(I=A.length,m.forEach(A,function(M){I+=Math.ceil(M.length/this.columns)},this)):(m.forEach(A,function(M){I+=M.length},this),I=Math.ceil(I/this.columns)):I=Math.ceil(A.length/this.columns),this._rows=I):"auto"===this.columns&&(this.featureLayers?this.grouping?I=3:(m.forEach(A,function(M){I+=M.length},this),I=Math.ceil(I/this.rows)):I=Math.ceil(A.length/this.rows),this._columns=I)}},_preprocess:function(){this.items&&(this.grouping=!1);this._autoWidth=!1;if("auto"===this.rows||"auto"===
this.columns)this._autoWidth=!0;if(this.featureLayers)if(this.useLegend&&this._flChanged&&(this._legendIndices=[],this._loadingIndices=[],this._legendSymbols={},this._ignoreLegends(),this._loadingLegends=[],clearTimeout(this._legendTimer),this._legendTimer=null,this._processSelectionLayers(),this._flChanged=0),m.every(this.featureLayers,function(M){return M.loaded})){this.featureLayers=m.filter(this.featureLayers,function(M){return!(M.hasZ&&!M.enableZDefaults)});var A=this._flItems=this._getItemsFromLayers(this.featureLayers);
this._adjustRowsCols(A)}else{var I=this.featureLayers.length;m.forEach(this.featureLayers,function(M){if(M.loaded)I--;else var R=z.connect(M,"onLoad",this,function(){z.disconnect(R);R=null;I--;I||this.update()})},this)}else A=this._itItems=this._getItemsFromItems(this.items),this._adjustRowsCols(A)},_processSelectionLayers:function(){var A,I,M,R,S,W,V,k={};m.forEach(this.featureLayers,function(F,K){F.mode===C.MODE_SELECTION&&F._map&&F.url&&F._params.drawMode&&!F.source&&(I=v.trim(F._url.path).replace(/\/(MapServer|FeatureServer).*/ig,
"/MapServer").replace(/^https?:\/\//ig,"").toLowerCase(),M=k[I]=k[I]||{},R=M.featureLayers=M.featureLayers||{},W=M.indices=M.indices||[],R[K]=F,W.push(K),A=F._map)});A&&m.forEach(A.layerIds,function(F){(F=A.getLayer(F))&&F.url&&(F.getImageUrl||F.getTileUrl)&&F.loaded&&10.1<=F.version&&(I=v.trim(F._url.path).replace(/(\/MapServer).*/ig,"$1"),S=I.replace(/^https?:\/\//ig,"").toLowerCase(),k[S]&&!k[S].mapServiceUrl&&(M=k[S],M.mapServiceUrl=I,M.mapServiceLayer=F,this._legendIndices=this._legendIndices.concat(M.indices),
V=this._fetchLegend({pickerInstance:this,info:M},S),V.then?(this._loadingIndices=this._loadingIndices.concat(M.indices),this._loadingLegends.push(V)):this._processLegendResponse(V,M)))},this)},_fetchLegend:function(A,I){var M=B.prototype,R=M.legendCache[I];R?R.then&&R._contexts.push(A):(R=M.legendCache[I]=O({url:A.info.mapServiceUrl+"/legend",content:{f:"json"},callbackParamName:"callback"}),R._contexts=[A],R.addBoth(function(S){if(!R.canceled){M.legendCache[I]=S;var W=R._contexts;R._contexts=null;
m.forEach(W,function(V){var k=V.pickerInstance;V=V.info;if(!k._destroyed){m.forEach(V.indices,function(K){F=m.indexOf(k._loadingIndices,K);-1<F&&k._loadingIndices.splice(F,1)});var F=m.indexOf(k._loadingLegends,R);-1<F&&k._loadingLegends.splice(F,1);k._processLegendResponse(S,V)}})}}));return R},_clearLegendInfo:function(){clearTimeout(this._legendTimer);this._ignoreLegends();this._legendIndices=this._loadingIndices=this._legendSymbols=this._loadingLegends=this._legendTimer=null},_ignoreLegends:function(){this._loadingLegends&&
m.forEach(this._loadingLegends,function(A){var I=-1;m.some(A._contexts,function(M,R){M.pickerInstance===this&&(I=R);return-1<I},this);-1<I&&A._contexts.splice(I,1)},this)},_processLegendResponse:function(A,I){if(!A||A instanceof Error){var M;m.forEach(I.indices,function(S){M=m.indexOf(this._legendIndices,S);-1<M&&this._legendIndices.splice(M,1)},this)}else m.forEach(I.indices,function(S){var W=I.featureLayers[S].layerId,V,k=I.mapServiceUrl+"/"+W+"/images/",F=I.mapServiceLayer._getToken(),K,E;if(!this._legendSymbols[S]){var J=
null;m.some(A.layers,function(U){U.layerId==W&&(J=U);return!!J});if(J){var Q=this._legendSymbols[S]={};m.forEach(J.legend,function(U){if((K=U.values)&&K.length)for(V=0;V<K.length;V++)Q[K[V]]=U;else Q.defaultSymbol=U;(E=U.url)&&!U._fixed&&(U._fixed=1,-1===E.search(/https?:/)&&(U.url=k+E),F&&-1!==U.url.search(/https?:/)&&(U.url+=(-1<U.url.indexOf("?")?"\x26":"?")+"token\x3d"+F))})}}},this);var R=this;R._started&&!R._legendTimer&&(R._legendTimer=setTimeout(function(){clearTimeout(R._legendTimer);R._legendTimer=
null;R._destroyed||R.update()},0))},_applyGridPatches:function(){var A=this.grid,I=A.adaptWidth,M,R,S;A.adaptWidth=function(){M=this.views.views;for(R=0;S=M[R];R++)e.set(S.headerNode,"display","block");I.apply(this,arguments);for(R=0;S=M[R];R++)e.set(S.headerNode,"display","none")};if(this._dojo14x){if("auto"!==this.rows&&"auto"!==this.columns)var W=z.connect(A,"_onFetchComplete",this,function(){z.disconnect(W);this.grid.set("autoHeight",this._rows)});z.connect(A,"_onDelete",this,this._destroyItems);
z.connect(A,"_clearData",this,this._destroyItems);z.connect(A,"destroy",this,this._destroyItems);(A=A.focus)&&A.findAndFocusGridCell&&(A.findAndFocusGridCell=function(){return!1})}},_setGridLayout:function(){var A=function(W){return function(V,k){return this._cellGet(W,V,k)}},I=v.hitch(this,this._cellFormatter),M=[],R=this._columns,S;for(S=0;S<R;S++)M.push({field:"cell"+S,get:v.hitch(this,A(S)),formatter:I});A={cells:[M]};this.grouping&&(R={field:"groupName",colSpan:R,get:v.hitch(this,this._cellGetGroup),
formatter:v.hitch(this,this._cellGroupFormatter)},A.cells.push([R]));R=this.grid;I=d.prototype.rowsPerPage;R.set("rowsPerPage",this._rows>I?this._rows:I);R.set("structure",A)},_setGridData:function(){var A=[];if(this.grouping){this._groupRowIndices=[];var I,M,R=this._columns;m.forEach(this._flItems,function(W,V){A.push({});V=0===V?0:I+M+1;this._groupRowIndices.push(V);I=V;M=Math.ceil(W.length/R);A=A.concat(this._getStoreItems(W))},this)}else this.featureLayers?(m.forEach(this._flItems,function(W){A=
A.concat(W)}),A=this._getStoreItems(A)):A=this._getStoreItems(this._itItems);var S=new r({data:{items:A}});this.grid.setStore(S)},_toggleTooltip:function(){if(this.showTooltip){if(!this.tooltip){this.tooltip=u.create("div",{"class":"esriMapTooltip"},this.domNode);this.tooltip.style.display="none";this.tooltip.style.position="fixed";var A=this.grid;this._mouseOverConnect=z.connect(A,"onCellMouseOver",this,this._cellMouseOver);this._mouseOutConnect=z.connect(A,"onCellMouseOut",this,this._cellMouseOut)}}else this.tooltip&&
(z.disconnect(this._mouseOverConnect),z.disconnect(this._mouseOutConnect),u.destroy(this.tooltip),this.tooltip=null)},_rowClicked:function(A,I){var M=A.cellNode,R=A.rowIndex;A=A.cellIndex;var S=this._getCellInfo(M,R,A);if(S){var W=this.grid.store;if(!W.getValue(S,"loadingCell")&&(this._selectedCell&&b.remove(this._selectedCell,"selectedItem"),M!==this._selectedCell?(b.add(M,"selectedItem"),this._selectedCell=M,this._selectedItem={featureLayer:W.getValue(S,"layer"),type:W.getValue(S,"type"),template:W.getValue(S,
"template"),symbolInfo:W.getValue(S,"symbolInfo"),item:this._getItem(S)},this._selectedInfo={selRow:R,selCol:A,index1:W.getValue(S,"index1"),index2:W.getValue(S,"index2"),index:W.getValue(S,"index")}):this._selectedCell=this._selectedInfo=this._selectedItem=null,!I))this.onSelectionChange()}},_locate:function(A,I,M){var R=this.grid.store,S=Array(this._columns),W,V=I.index1,k=I.index2,F=I.index,K=A.item;m.some(M,function(E,J){return m.some(S,function(Q,U){return(Q=R.getValue(E,"cell"+U))&&(K?F===R.getValue(Q,
"index"):V===R.getValue(Q,"index1")&&k===R.getValue(Q,"index2"))?(W=[J,U],!0):!1})});return W},_getCellInfo:function(A,I,M){if(A)return A=this.grid,I=A.getItem(I),A.store.getValue(I,"cell"+M)},_getItem:function(A){var I=this.items;if(I)return I[this.grid.store.getValue(A,"index")]},_cellMouseOver:function(A){var I=this.tooltip,M=A.cellNode,R=this._getCellInfo(M,A.rowIndex,A.cellIndex);if(I&&R){var S=this.grid.store;A=S.getValue(R,"template");var W=S.getValue(R,"type"),V=S.getValue(R,"symbolInfo");
S=S.getValue(R,"layer");A=(R=this._getItem(R))&&R.label+(R.description?": "+R.description:"")||A&&A.name+(A.description?": "+A.description:"")||W&&W.name||V&&V.label+(V.description?": "+V.description:"")||(S&&S.name+": ")+"Default";I.style.display="none";I.innerHTML=A;M=y.coords(M.firstChild);e.set(I,{left:M.x+"px",top:M.y+M.h+5+"px"});I.style.display=""}},_cellMouseOut:function(){var A=this.tooltip;A&&(A.style.display="none")},_destroyItems:function(){var A=this._itemWidgets,I;for(I in A)A[I]&&(A[I].destroy(),
delete A[I])},_repaintItems:function(){var A=this._itemWidgets,I;for(I in A){var M=A[I];M&&M._repaint(M._surface)}},_getStoreItems:function(A){var I=this._uniqueId;A=m.map(A,function(E){return v.mixin({surfaceId:"tpick-surface-"+I.id++},E)});for(var M=A.length,R=0,S={},W=0,V,k=[],F=!0,K=this._columns;R<M;)F=!0,V="cell"+W,S[V]=A[R],R++,W++,0===W%K&&(F=!1,k.push(S),S={},W=0);F&&M&&k.push(S);return k},_getItemsFromLayers:function(A){var I=[];m.forEach(A,function(M,R){I.push(this._getItemsFromLayer(M,
R))},this);return I},_getItemsFromLayer:function(A,I){var M=[];if(this.useLegend&&-1<m.indexOf(this._loadingIndices,I))return[{label:this._nls&&this._nls.loading||"",symbol:null,layer:A,type:null,template:null,index1:I,index2:0,loadingCell:1}];var R=[];R=R.concat(A.templates);m.forEach(A.types,function(k){var F=k.templates;m.forEach(F,function(K){K._type_=k});R=R.concat(F)});R=m.filter(R,P.isDefined);var S=A.renderer;if(S){var W=S.declaredClass.replace("esri.renderer.","");if(0<R.length)m.forEach(R,
function(k){var F=k.prototype;if(F){var K;if(K=this._isUnclassedRenderer(S)?S.infos[0].symbol:S.valueExpression?this._createSimpleSymbol(A):S.getSymbol(F)||this._createSimpleSymbol(A)){var E=null,J;if(!(9>l("ie"))&&k.thumbnail&&k.thumbnail.imageData)E=new t(k.thumbnail);else if(this.useLegend&&-1<m.indexOf(this._legendIndices,I)){if(J=this._legendSymbols&&this._legendSymbols[I])switch(W){case "SimpleRenderer":E=J.defaultSymbol;break;case "UniqueValueRenderer":m.some(S.infos,function(Q){Q.symbol===
K&&(E=J[Q.value]);return!!E});break;case "ClassBreaksRenderer":m.some(S.infos,function(Q){Q.symbol===K&&(E=J[Q.maxValue]);return!!E})}E&&(F=c.fromJson(c.toJson(t.defaultProps)),F.url=E.url,F.imageData=E.imageData,F.contentType=E.contentType,F.width=E.width,F.height=E.height,P.isDefined(F.width)&&P.isDefined(F.height)||(F.width=15,F.height=15),E=new t(F))}M.push({label:this._trimLabel(k.name),symbol:E||K,legendOverride:!!E,layer:A,type:k._type_,template:k,index1:I,index2:M.length})}else switch(W){case "HeatmapRenderer":M.push({label:this._trimLabel(k.name),
symbol:new L,legendOverride:!!E,layer:A,type:k._type_,template:k,index1:I,index2:M.length})}}delete k._type_},this);else{var V=[];"TemporalRenderer"===W&&(S=S.observationRenderer)&&(W=S.declaredClass.replace("esri.renderer.",""));switch(W){case "SimpleRenderer":V=[{symbol:S.symbol,label:S.label,description:S.description}];break;case "UniqueValueRenderer":case "ClassBreaksRenderer":V=S.infos}M=m.map(V,function(k,F){return{label:this._trimLabel(k.label),description:k.description,symbolInfo:v.mixin({constructor:function(){}},
k),symbol:k.symbol,layer:A,index1:I,index2:F}},this)}}return M},_isUnclassedRenderer:function(A){return!!((A.hasVisualVariables("sizeInfo",!1)||A.hasVisualVariables("colorInfo",!1)||A.hasVisualVariables("opacityInfo",!1))&&A.addBreak&&A.infos&&1===A.infos.length)},_createSimpleSymbol:function(A){switch(A.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":var I=new L;break;case "esriGeometryPolyline":I=new G;break;case "esriGeometryPolygon":I=new p;break;default:A.hasXYFootprint&&
A.hasXYFootprint()&&(I=new p)}return I},_getItemsFromItems:function(A){return m.map(A,function(I,M){I=v.mixin({index:M},I);I.label=this._trimLabel(I.label);return I},this)},_trimLabel:function(A){var I=this.maxLabelLength;I&&A&&A.length>I&&(A=A.substr(0,I)+"...");return A||""},_cellGet:function(A,I,M){return M?this.grid.store.getValue(M,"cell"+A):""},_cellFormatter:function(A){if(A){var I=this._itemWidgets,M=this.grid.store,R=M.getValue(A,"surfaceId"),S=I[R];S||(S=I[R]=new T({id:R,label:M.getValue(A,
"label"),symbol:M.getValue(A,"symbol"),legendOverride:M.getValue(A,"legendOverride"),surfaceWidth:this.surfaceWidth,surfaceHeight:this.surfaceHeight,template:M.getValue(A,"template")}));return S||""}return""},_cellGetGroup:function(A,I){if(!this._groupRowIndices)return"";A=m.indexOf(this._groupRowIndices,A);return I&&-1!==A?(I=this.featureLayers[A])&&(this.groupLabelFunction?this.groupLabelFunction(I):I.name)||"":""},_cellGroupFormatter:function(A){return A?"\x3cdiv class\x3d'groupLabel'\x3e"+A+"\x3c/div\x3e":
""}});a("extend-esri")&&v.setObject("dijit.editing.TemplatePicker",B,D);return B})},"dojox/grid/DataGrid":function(){define("../main dojo/_base/array dojo/_base/lang dojo/_base/json dojo/_base/sniff dojo/_base/declare ./_Grid ./DataSelection dojo/_base/html dojo/has dojo/has!dojo-bidi?./bidi/_BidiMixin".split(" "),function(N,v,z,y,m,c,f,a,n){var l=c("dojox.grid.DataGrid",f,{store:null,query:null,queryOptions:null,fetchText:"...",sortFields:null,updateDelay:1,items:null,_store_connects:null,_by_idty:null,
_by_idx:null,_cache:null,_pages:null,_pending_requests:null,_bop:-1,_eop:-1,_requests:0,rowCount:0,_isLoaded:!1,_isLoading:!1,keepSelection:!1,postCreate:function(){this._pages=[];this._store_connects=[];this._by_idty={};this._by_idx=[];this._cache=[];this._pending_requests={};this._setStore(this.store);this.inherited(arguments)},destroy:function(){this.selection.destroy();this.inherited(arguments)},createSelection:function(){this.selection=new a(this)},get:function(b,u){if(u&&"_item"==this.field&&
!this.fields)return u;if(u&&this.fields){var w=[],e=this.grid.store;v.forEach(this.fields,function(q){w=w.concat(e.getValues(u,q))});return w}return u||"string"!==typeof b?u?this.field?"_item"==this.field?u:this.grid.store.getValue(u,this.field):this.value:this.defaultValue:this.inherited(arguments)},_checkUpdateStatus:function(){if(0<this.updateDelay){var b=!1;this._endUpdateDelay&&(clearTimeout(this._endUpdateDelay),delete this._endUpdateDelay,b=!0);this.updating||(this.beginUpdate(),b=!0);if(b){var u=
this;this._endUpdateDelay=setTimeout(function(){delete u._endUpdateDelay;u.endUpdate()},this.updateDelay)}}},_onSet:function(b,u,w,e){this._checkUpdateStatus();b=this.getItemIndex(b);-1<b&&this.updateRow(b)},_createItem:function(b,u){u=this._hasIdentity?this.store.getIdentity(b):y.toJson(this.query)+":idx:"+u+":sort:"+y.toJson(this.getSortProps());return this._by_idty[u]={idty:u,item:b}},_addItem:function(b,u,w){this._by_idx[u]=this._createItem(b,u);w||this.updateRow(u)},_onNew:function(b,u){this._checkUpdateStatus();
u=this.get("rowCount");this._addingItem=!0;this.updateRowCount(u+1);this._addingItem=!1;this._addItem(b,u);this.showMessage()},_onDelete:function(b){this._checkUpdateStatus();b=this._getItemIndex(b,!0);if(0<=b){this._pages=[];this._eop=this._bop=-1;var u=this._by_idx[b];this._by_idx.splice(b,1);delete this._by_idty[u.idty];this.updateRowCount(this.get("rowCount")-1);0===this.get("rowCount")&&this.showMessage(this.noDataMessage)}this.selection.isSelected(b)&&(this.selection.deselect(b),this.selection.selected.splice(b,
1))},_onRevert:function(){this._refresh()},setStore:function(b,u,w){this._requestsPending(0)||(this._setQuery(u,w),this._setStore(b),this._refresh(!0))},setQuery:function(b,u){this._requestsPending(0)||(this._setQuery(b,u),this._refresh(!0))},setItems:function(b){this.items=b;this._setStore(this.store);this._refresh(!0)},_setQuery:function(b,u){this.query=b;this.queryOptions=u||this.queryOptions},_setStore:function(b){this.store&&this._store_connects&&v.forEach(this._store_connects,this.disconnect,
this);if(this.store=b){b=this.store.getFeatures();var u=[];this._canEdit=!!b["dojo.data.api.Write"]&&!!b["dojo.data.api.Identity"];this._hasIdentity=!!b["dojo.data.api.Identity"];b["dojo.data.api.Notification"]&&!this.items&&(u.push(this.connect(this.store,"onSet","_onSet")),u.push(this.connect(this.store,"onNew","_onNew")),u.push(this.connect(this.store,"onDelete","_onDelete")));this._canEdit&&u.push(this.connect(this.store,"revert","_onRevert"));this._store_connects=u}},_onFetchBegin:function(b,
u){this.scroller&&(this.rowCount!=b&&(u.isRender?(this.scroller.init(b,this.keepRows,this.rowsPerPage),this.rowCount=b,this._setAutoHeightAttr(this.autoHeight,!0),this._skipRowRenormalize=!0,this.prerender(),this._skipRowRenormalize=!1):this.updateRowCount(b)),b?this.showMessage():(this.views.render(),this._resize(),this.showMessage(this.noDataMessage),this.focus.initFocusView()))},_onFetchComplete:function(b,u){this.scroller&&(b&&0<b.length&&(v.forEach(b,function(w,e){this._addItem(w,u.start+e,!0)},
this),this.updateRows(u.start,b.length),u.isRender?(this.setScrollTop(0),this.postrender()):this._lastScrollTop&&this.setScrollTop(this._lastScrollTop),m("ie")&&n.setSelectable(this.domNode,this.selectable)),delete this._lastScrollTop,this._isLoaded||(this._isLoading=!1,this._isLoaded=!0),this._pending_requests[u.start]=!1)},_onFetchError:function(b,u){console.log(b);delete this._lastScrollTop;this._isLoaded||(this._isLoading=!1,this._isLoaded=!0,this.showMessage(this.errorMessage));this._pending_requests[u.start]=
!1;this.onFetchError(b,u)},onFetchError:function(b,u){},_fetch:function(b,u){b=b||0;if(this.store&&!this._pending_requests[b]){this._isLoaded||this._isLoading||(this._isLoading=!0,this.showMessage(this.loadingMessage));this._pending_requests[b]=!0;try{if(this.items){var w=this.items,e=this.store;this.rowsPerPage=w.length;var q={start:b,count:this.rowsPerPage,isRender:u};this._onFetchBegin(w.length,q);var h=0;v.forEach(w,function(d){e.isItemLoaded(d)||h++});if(0===h)this._onFetchComplete(w,q);else{var r=
function(d){h--;0===h&&this._onFetchComplete(w,q)};v.forEach(w,function(d){e.isItemLoaded(d)||e.loadItem({item:d,onItem:r,scope:this})},this)}}else this.store.fetch({start:b,count:this.rowsPerPage,query:this.query,sort:this.getSortProps(),queryOptions:this.queryOptions,isRender:u,onBegin:z.hitch(this,"_onFetchBegin"),onComplete:z.hitch(this,"_onFetchComplete"),onError:z.hitch(this,"_onFetchError")})}catch(d){this._onFetchError(d,{start:b,count:this.rowsPerPage})}}},_clearData:function(){this.updateRowCount(0);
this._by_idty={};this._by_idx=[];this._pages=[];this._bop=this._eop=-1;this._isLoading=this._isLoaded=!1},getItem:function(b){var u=this._by_idx[b];return!u||u&&!u.item?(this._preparePage(b),null):u.item},getItemIndex:function(b){return this._getItemIndex(b,!1)},_getItemIndex:function(b,u){if(!u&&!this.store.isItem(b))return-1;u=this._hasIdentity?this.store.getIdentity(b):null;for(var w=0,e=this._by_idx.length;w<e;w++){var q=this._by_idx[w];if(q&&(u&&q.idty==u||q.item===b))return w}return-1},filter:function(b,
u){this.query=b;u&&this._clearData();this._fetch()},_getItemAttr:function(b,u){return(b=this.getItem(b))?this.store.getValue(b,u):this.fetchText},_render:function(){this.domNode.parentNode&&(this.scroller.init(this.get("rowCount"),this.keepRows,this.rowsPerPage),this.prerender(),this._fetch(0,!0))},_requestsPending:function(b){return this._pending_requests[b]},_rowToPage:function(b){return this.rowsPerPage?Math.floor(b/this.rowsPerPage):b},_pageToRow:function(b){return this.rowsPerPage?this.rowsPerPage*
b:b},_preparePage:function(b){(b<this._bop||b>=this._eop)&&!this._addingItem&&(b=this._rowToPage(b),this._needPage(b),this._bop=b*this.rowsPerPage,this._eop=this._bop+(this.rowsPerPage||this.get("rowCount")))},_needPage:function(b){this._pages[b]||(this._pages[b]=!0,this._requestPage(b))},_requestPage:function(b){b=this._pageToRow(b);0<Math.min(this.rowsPerPage,this.get("rowCount")-b)&&(this._requests++,this._requestsPending(b)||setTimeout(z.hitch(this,"_fetch",b,!1),1))},getCellName:function(b){return b.field},
_refresh:function(b){this._clearData();this._fetch(0,b)},sort:function(){this.edit.apply();this._lastScrollTop=this.scrollTop;this._refresh()},canSort:function(){return!this._isLoading},getSortProps:function(){var b=this.getCell(this.getSortIndex());if(b){var u=b.sortDesc,w=!(0<this.sortInfo);return[{attribute:b.field,descending:"undefined"==typeof u?w:w?!u:u}]}return this.sortFields?this.sortFields:null},styleRowState:function(b){if(this.store&&this.store.getState){for(var u=this.store.getState(b.index),
w="",e=0,q=["inflight","error","inserting"],h;h=q[e];e++)if(u[h]){w=" dojoxGridRow-"+h;break}b.customClasses+=w}},onStyleRow:function(b){this.styleRowState(b);this.inherited(arguments)},canEdit:function(b,u){return this._canEdit},_copyAttr:function(b,u){b=this.getItem(b);return this.store.getValue(b,u)},doStartEdit:function(b,u){this._cache[u]||(this._cache[u]=this._copyAttr(u,b.field));this.onStartEdit(b,u)},doApplyCellEdit:function(b,u,w){this.store.fetchItemByIdentity({identity:this._by_idx[u].idty,
onItem:z.hitch(this,function(e){var q=this.store.getValue(e,w);"number"==typeof q?b=isNaN(b)?b:parseFloat(b):"boolean"==typeof q?b="true"==b?!0:"false"==b?!1:b:q instanceof Date&&(q=new Date(b),b=isNaN(q.getTime())?b:q);this.store.setValue(e,w,b);this.onApplyCellEdit(b,u,w)})})},doCancelEdit:function(b){this._cache[b]&&(this.updateRow(b),delete this._cache[b]);this.onCancelEdit.apply(this,arguments)},doApplyEdit:function(b,u){this.onApplyEdit(b)},removeSelectedRows:function(){if(this._canEdit){this.edit.apply();
var b=z.hitch(this,function(u){u.length&&(v.forEach(u,this.store.deleteItem,this.store),this.selection.clear())});this.allItemsSelected?this.store.fetch({query:this.query,queryOptions:this.queryOptions,onComplete:b}):b(this.selection.getSelected())}}});l.cell_markupFactory=function(b,u,w){var e=z.trim(n.attr(u,"field")||"");e&&(w.field=e);w.field=w.field||w.name;if(e=z.trim(n.attr(u,"fields")||""))w.fields=e.split(",");b&&b(u,w)};l.markupFactory=function(b,u,w,e){return f.markupFactory(b,u,w,z.partial(l.cell_markupFactory,
e))};return l})},"dojox/grid/_Grid":function(){define("dojo/_base/kernel ../main dojo/_base/declare ./_Events ./_Scroller ./_Layout ./_View ./_ViewManager ./_RowManager ./_FocusManager ./_EditManager ./Selection ./_RowSelector ./util dijit/_Widget dijit/_TemplatedMixin dijit/CheckedMenuItem dojo/text!./resources/_Grid.html dojo/string dojo/_base/array dojo/_base/lang dojo/_base/sniff dojox/html/metrics dojo/_base/html dojo/query dojo/dnd/common dojo/i18n!dijit/nls/loading".split(" "),function(N,v,
z,y,m,c,f,a,n,l,b,u,w,e,q,h,r,d,x,C,L,t,p,G,T){N.isCopyKey||(N.isCopyKey=N.dnd.getCopyKeyState);z=z("dojox.grid._Grid",[q,h,y],{templateString:d,classTag:"dojoxGrid",rowCount:5,keepRows:75,rowsPerPage:25,autoWidth:!1,initialWidth:"",autoHeight:"",rowHeight:0,autoRender:!0,defaultHeight:"15em",height:"",structure:null,elasticView:-1,singleClickEdit:!1,selectionMode:"extended",rowSelector:"",columnReordering:!1,headerMenu:null,placeholderLabel:"GridColumns",selectable:!1,_click:null,loadingMessage:"\x3cspan class\x3d'dojoxGridLoading'\x3e${loadingState}\x3c/span\x3e",
errorMessage:"\x3cspan class\x3d'dojoxGridError'\x3e${errorState}\x3c/span\x3e",noDataMessage:"",escapeHTMLInData:!0,formatterScope:null,editable:!1,summary:"",_setSummaryAttr:"domNode",sortInfo:0,_placeholders:null,_layoutClass:c,buildRendering:function(){this.inherited(arguments);this.domNode.getAttribute("tabIndex")||(this.domNode.tabIndex="0");this.createScroller();this.createLayout();this.createViews();this.createManagers();this.createSelection();this.connect(this.selection,"onSelected","onSelected");
this.connect(this.selection,"onDeselected","onDeselected");this.connect(this.selection,"onChanged","onSelectionChanged");p.initOnFontResize();this.connect(p,"onFontResize","textSizeChanged");e.funnelEvents(this.domNode,this,"doKeyEvent",e.keyEvents);"none"!=this.selectionMode&&this.domNode.setAttribute("aria-multiselectable","single"==this.selectionMode?"false":"true");G.addClass(this.domNode,this.classTag);this.isLeftToRight()||G.addClass(this.domNode,this.classTag+"Rtl");0<this.rowHeight&&G.addClass(this.viewsNode,
this.classTag+"FixedRowHeight")},postMixInProperties:function(){this.inherited(arguments);var D=N.i18n.getLocalization("dijit","loading",this.lang);this.loadingMessage=x.substitute(this.loadingMessage,D);this.errorMessage=x.substitute(this.errorMessage,D);this.srcNodeRef&&this.srcNodeRef.style.height&&(this.height=this.srcNodeRef.style.height);this._setAutoHeightAttr(this.autoHeight,!0);this.lastScrollTop=this.scrollTop=0},postCreate:function(){this._placeholders=[];this._setHeaderMenuAttr(this.headerMenu);
this._setStructureAttr(this.structure);this._click=[];this.inherited(arguments);this.domNode&&this.autoWidth&&this.initialWidth&&(this.domNode.style.width=this.initialWidth);this.domNode&&!this.editable&&G.attr(this.domNode,"aria-readonly","true")},destroy:function(){this.domNode.onReveal=null;this.domNode.onSizeChange=null;delete this._click;this.scroller&&(this.scroller.destroy(),delete this.scroller);this.edit.destroy();delete this.edit;this.views.destroyViews();this.focus&&(this.focus.destroy(),
delete this.focus);this.headerMenu&&this._placeholders.length&&(C.forEach(this._placeholders,function(D){D.unReplace(!0)}),this.headerMenu.unBindDomNode(this.viewsHeaderNode));this.inherited(arguments)},_setAutoHeightAttr:function(D,P){"string"==typeof D&&(D=D&&"false"!=D?"true"==D?!0:window.parseInt(D,10):!1);"number"==typeof D&&(isNaN(D)&&(D=!1),0>D?D=!0:0===D&&(D=!1));this.autoHeight=D;this._autoHeight="boolean"==typeof D?D:"number"==typeof D?D>=this.get("rowCount"):!1;this._started&&!P&&this.render()},
_getRowCountAttr:function(){return this.updating&&this.invalidated&&void 0!=this.invalidated.rowCount?this.invalidated.rowCount:this.rowCount},textSizeChanged:function(){this.render()},sizeChange:function(){this.update()},createManagers:function(){this.rows=new n(this);this.focus=new l(this);this.edit=new b(this)},createSelection:function(){this.selection=new u(this)},createScroller:function(){this.scroller=new m;this.scroller.grid=this;this.scroller.renderRow=L.hitch(this,"renderRow");this.scroller.removeRow=
L.hitch(this,"rowRemoved")},createLayout:function(){this.layout=new this._layoutClass(this);this.connect(this.layout,"moveColumn","onMoveColumn")},onMoveColumn:function(){this.update()},onResizeColumn:function(D){},createViews:function(){this.views=new a(this);this.views.createView=L.hitch(this,"createView")},createView:function(D,P){D=new (L.getObject(D))({grid:this,index:P});this.viewsNode.appendChild(D.domNode);this.viewsHeaderNode.appendChild(D.headerNode);this.views.addView(D);G.attr(this.domNode,
"align",this.isLeftToRight()?"left":"right");return D},buildViews:function(){for(var D=0,P;P=this.layout.structure[D];D++)this.createView(P.type||v._scopeName+".grid._View",D).setStructure(P);this.scroller.setContentNodes(this.views.getContentNodes())},_setStructureAttr:function(D){D&&L.isString(D)&&(N.deprecated("dojox.grid._Grid.set('structure', 'objVar')","use dojox.grid._Grid.set('structure', objVar) instead","2.0"),D=L.getObject(D));this.structure=D;if(!D)if(this.layout.structure)D=this.layout.structure;
else return;this.views.destroyViews();this.focus.focusView=null;D!==this.layout.structure&&this.layout.setStructure(D);this._structureChanged()},setStructure:function(D){N.deprecated("dojox.grid._Grid.setStructure(obj)","use dojox.grid._Grid.set('structure', obj) instead.","2.0");this._setStructureAttr(D)},getColumnTogglingItems:function(){var D=[];var P=C.map(this.layout.cells,function(O){O.menuItems||(O.menuItems=[]);var X=this,H=new r({label:O.name,checked:!O.hidden,_gridCell:O,onChange:function(g){if(X.layout.setColumnVisibility(this._gridCell.index,
g)){var B=this._gridCell.menuItems;1<B.length&&C.forEach(B,function(A){A!==this&&A.setAttribute("checked",g)},this);g=C.filter(X.layout.cells,function(A){1<A.menuItems.length?C.forEach(A.menuItems,"item.set('disabled', false);"):A.menuItems[0].set("disabled",!1);return!A.hidden});1==g.length&&C.forEach(g[0].menuItems,"item.set('disabled', true);")}},destroy:function(){var g=C.indexOf(this._gridCell.menuItems,this);this._gridCell.menuItems.splice(g,1);delete this._gridCell;r.prototype.destroy.apply(this,
arguments)}});O.menuItems.push(H);O.hidden||D.push(H);return H},this);1==D.length&&D[0].set("disabled",!0);return P},_setHeaderMenuAttr:function(D){this._placeholders&&this._placeholders.length&&(C.forEach(this._placeholders,function(P){P.unReplace(!0)}),this._placeholders=[]);this.headerMenu&&this.headerMenu.unBindDomNode(this.viewsHeaderNode);if(this.headerMenu=D)this.headerMenu.bindDomNode(this.viewsHeaderNode),this.headerMenu.getPlaceholders&&(this._placeholders=this.headerMenu.getPlaceholders(this.placeholderLabel))},
setHeaderMenu:function(D){N.deprecated("dojox.grid._Grid.setHeaderMenu(obj)","use dojox.grid._Grid.set('headerMenu', obj) instead.","2.0");this._setHeaderMenuAttr(D)},setupHeaderMenu:function(){this._placeholders&&this._placeholders.length&&C.forEach(this._placeholders,function(D){D._replaced&&D.unReplace(!0);D.replace(this.getColumnTogglingItems())},this)},_fetch:function(D){this.setScrollTop(0)},getItem:function(D){return null},showMessage:function(D){D?(this.messagesNode.innerHTML=D,this.messagesNode.style.display=
""):(this.messagesNode.innerHTML="",this.messagesNode.style.display="none")},_structureChanged:function(){this.buildViews();this.autoRender&&this._started&&this.render()},hasLayout:function(){return this.layout.cells.length},resize:function(D,P){this._pendingChangeSize=D;this._pendingResultSize=P;this.sizeChange()},_getPadBorder:function(){return this._padBorder=this._padBorder||G._getPadBorderExtents(this.domNode)},_getHeaderHeight:function(){var D=this.viewsHeaderNode.style,P="none"==D.display?
0:this.views.measureHeader();D.height=P+"px";this.views.normalizeHeaderNodeHeight();return P},_resize:function(D,P){D=D||this._pendingChangeSize;P=P||this._pendingResultSize;delete this._pendingChangeSize;delete this._pendingResultSize;if(this.domNode){var O=this.domNode.parentNode;if(O&&1==O.nodeType&&this.hasLayout()&&"hidden"!=O.style.visibility&&"none"!=O.style.display){var X=this._getPadBorder(),H=void 0;if(this._autoHeight)this.domNode.style.height="auto";else if("number"==typeof this.autoHeight){var g=
H=this._getHeaderHeight();g+=this.scroller.averageRowHeight*this.autoHeight;this.domNode.style.height=g+"px"}else this.domNode.clientHeight<=X.h&&(O==document.body?this.domNode.style.height=this.defaultHeight:this.height?this.domNode.style.height=this.height:this.fitTo="parent");P&&(D=P);!this._autoHeight&&D?(G.marginBox(this.domNode,D),this.height=this.domNode.style.height,delete this.fitTo):"parent"==this.fitTo&&(g=this._parentContentBoxHeight=0<this._parentContentBoxHeight?this._parentContentBoxHeight:
G._getContentBox(O).h,this.domNode.style.height=Math.max(0,g)+"px");D=C.some(this.views.views,function(B){return B.flexCells});this._autoHeight||0!==(g||G._getContentBox(this.domNode).h)?(this.viewsHeaderNode.style.display="block",D||void 0!==H||(H=this._getHeaderHeight())):this.viewsHeaderNode.style.display="none";D&&(H=void 0);this.adaptWidth();this.adaptHeight(H);this.postresize()}}},adaptWidth:function(){var D=!this.initialWidth&&this.autoWidth,P=D?0:this.domNode.clientWidth||this.domNode.offsetWidth-
this._getPadBorder().w;P=this.views.arrange(1,P);this.views.onEach("adaptWidth");D&&(this.domNode.style.width=P+"px")},adaptHeight:function(D){D=void 0===D?this._getHeaderHeight():D;var P=this._autoHeight?-1:Math.max(this.domNode.clientHeight-D,0)||0;this.views.onEach("setSize",[0,P]);this.views.onEach("adaptHeight");if(!this._autoHeight){var O=0,X=0,H=C.filter(this.views.views,function(g){(g=g.hasHScrollbar())?O++:X++;return!g});0<O&&0<X&&C.forEach(H,function(g){g.adaptHeight(!0)})}!0===this.autoHeight||
-1!=P||"number"==typeof this.autoHeight&&this.autoHeight>=this.get("rowCount")?this.scroller.windowHeight=P:this.scroller.windowHeight=Math.max(this.domNode.clientHeight-D,0)},startup:function(){this._started||(this.inherited(arguments),this.autoRender&&this.render())},render:function(){this.domNode&&this._started&&(this.hasLayout()?(this.update=this.defaultUpdate,this._render()):this.scroller.init(0,this.keepRows,this.rowsPerPage))},_render:function(){this.scroller.init(this.get("rowCount"),this.keepRows,
this.rowsPerPage);this.prerender();this.setScrollTop(0);this.postrender()},prerender:function(){this.keepRows=this._autoHeight?0:this.keepRows;this.scroller.setKeepInfo(this.keepRows);this.views.render();this._resize()},postrender:function(){this.postresize();this.focus.initFocusView();G.setSelectable(this.domNode,this.selectable)},postresize:function(){if(this._autoHeight){var D=Math.max(this.views.measureContent())+"px";this.viewsNode.style.height=D}},renderRow:function(D,P){this.views.renderRow(D,
P,this._skipRowRenormalize)},rowRemoved:function(D){this.views.rowRemoved(D)},invalidated:null,updating:!1,beginUpdate:function(){this.invalidated=[];this.updating=!0},endUpdate:function(){this.updating=!1;var D=this.invalidated,P;if(D.all)this.update();else if(void 0!=D.rowCount)this.updateRowCount(D.rowCount);else for(P in D)this.updateRow(Number(P));this.invalidated=[]},defaultUpdate:function(){this.domNode&&(this.updating?this.invalidated.all=!0:(this.lastScrollTop=this.scrollTop,this.prerender(),
this.scroller.invalidateNodes(),this.setScrollTop(this.lastScrollTop),this.postrender()))},update:function(){this.render()},updateRow:function(D){D=Number(D);this.updating?this.invalidated[D]=!0:(this.views.updateRow(D),this.scroller.rowHeightChanged(D))},updateRows:function(D,P){D=Number(D);P=Number(P);var O;if(this.updating)for(O=0;O<P;O++)this.invalidated[O+D]=!0;else{for(O=0;O<P;O++)this.views.updateRow(O+D,this._skipRowRenormalize);this.scroller.rowHeightChanged(D)}},updateRowCount:function(D){this.updating?
this.invalidated.rowCount=D:(this.rowCount=D,this._setAutoHeightAttr(this.autoHeight,!0),this.layout.cells.length&&this.scroller.updateRowCount(D),this.layout.cells.length&&this.setScrollTop(this.scrollTop),this._resize())},updateRowStyles:function(D){this.views.updateRowStyles(D)},getRowNode:function(D){if(!this.focus.focusView||this.focus.focusView instanceof w)for(var P=0,O;O=this.views.views[P];P++){if(!(O instanceof w))return O.rowNodes[D]}else return this.focus.focusView.rowNodes[D];return null},
rowHeightChanged:function(D){this.views.renormalizeRow(D);this.scroller.rowHeightChanged(D)},fastScroll:!0,delayScroll:!1,scrollRedrawThreshold:t("ie")?100:50,scrollTo:function(D){if(this.fastScroll){var P=Math.abs(this.lastScrollTop-D);this.lastScrollTop=D;if(P>this.scrollRedrawThreshold||this.delayScroll){this.delayScroll=!0;this.scrollTop=D;this.views.setScrollTop(D);this._pendingScroll&&window.clearTimeout(this._pendingScroll);var O=this;this._pendingScroll=window.setTimeout(function(){delete O._pendingScroll;
O.finishScrollJob()},200)}else this.setScrollTop(D)}else this.setScrollTop(D)},finishScrollJob:function(){this.delayScroll=!1;this.setScrollTop(this.scrollTop)},setScrollTop:function(D){this.scroller.scroll(this.views.setScrollTop(D))},scrollToRow:function(D){this.setScrollTop(this.scroller.findScrollTop(D)+1)},styleRowNode:function(D,P){P&&this.rows.styleRowNode(D,P)},_mouseOut:function(D){this.rows.setOverRow(-2)},getCell:function(D){return this.layout.cells[D]},setCellWidth:function(D,P){this.getCell(D).unitWidth=
P},getCellName:function(D){return"Cell "+D.index},canSort:function(D){},sort:function(){},getSortAsc:function(D){D=void 0==D?this.sortInfo:D;return 0<D},getSortIndex:function(D){D=void 0==D?this.sortInfo:D;return Math.abs(D)-1},setSortIndex:function(D,P){var O=D+1;void 0!=P?O*=P?1:-1:this.getSortIndex()==D&&(O=-this.sortInfo);this.setSortInfo(O)},setSortInfo:function(D){this.canSort(D)&&(this.sortInfo=D,this.sort(),this.update())},doKeyEvent:function(D){D.dispatch="do"+D.type;this.onKeyEvent(D)},
_dispatch:function(D,P){return D in this?this[D](P):!1},dispatchKeyEvent:function(D){this._dispatch(D.dispatch,D)},dispatchContentEvent:function(D){this.edit.dispatchEvent(D)||D.sourceView.dispatchContentEvent(D)||this._dispatch(D.dispatch,D)},dispatchHeaderEvent:function(D){D.sourceView.dispatchHeaderEvent(D)||this._dispatch("doheader"+D.type,D)},dokeydown:function(D){this.onKeyDown(D)},doclick:function(D){if(D.cellNode)this.onCellClick(D);else this.onRowClick(D)},dodblclick:function(D){if(D.cellNode)this.onCellDblClick(D);
else this.onRowDblClick(D)},docontextmenu:function(D){if(D.cellNode)this.onCellContextMenu(D);else this.onRowContextMenu(D)},doheaderclick:function(D){if(D.cellNode)this.onHeaderCellClick(D);else this.onHeaderClick(D)},doheaderdblclick:function(D){if(D.cellNode)this.onHeaderCellDblClick(D);else this.onHeaderDblClick(D)},doheadercontextmenu:function(D){if(D.cellNode)this.onHeaderCellContextMenu(D);else this.onHeaderContextMenu(D)},doStartEdit:function(D,P){this.onStartEdit(D,P)},doApplyCellEdit:function(D,
P,O){this.onApplyCellEdit(D,P,O)},doCancelEdit:function(D){this.onCancelEdit(D)},doApplyEdit:function(D){this.onApplyEdit(D)},addRow:function(){this.updateRowCount(this.get("rowCount")+1)},removeSelectedRows:function(){this.allItemsSelected?this.updateRowCount(0):this.updateRowCount(Math.max(0,this.get("rowCount")-this.selection.getSelected().length));this.selection.clear()}});z.markupFactory=function(D,P,O,X){var H=function(g){g=G.attr(g,"width")||"auto";"auto"!=g&&"em"!=g.slice(-2)&&"%"!=g.slice(-1)&&
(g=parseInt(g,10)+"px");return g};D.structure||"table"!=P.nodeName.toLowerCase()||(D.structure=T("\x3e colgroup",P).map(function(g){var B=G.attr(g,"span");B={noscroll:"true"==G.attr(g,"noscroll")?!0:!1,__span:B?parseInt(B,10):1,cells:[]};G.hasAttr(g,"width")&&(B.width=H(g));return B}),D.structure.length||D.structure.push({__span:Infinity,cells:[]}),T("thead \x3e tr",P).forEach(function(g,B){var A=0,I=0,M,R=null;T("\x3e th",g).map(function(S){R?A>=M+R.__span&&(I++,M+=R.__span,R=D.structure[I]):(M=
0,R=D.structure[0]);var W={name:L.trim(G.attr(S,"name")||S.innerHTML),colSpan:parseInt(G.attr(S,"colspan")||1,10),type:L.trim(G.attr(S,"cellType")||""),id:L.trim(G.attr(S,"id")||"")};A+=W.colSpan;var V=G.attr(S,"rowspan");V&&(W.rowSpan=V);G.hasAttr(S,"width")&&(W.width=H(S));G.hasAttr(S,"relWidth")&&(W.relWidth=window.parseInt(G.attr(S,"relWidth"),10));G.hasAttr(S,"hidden")&&(W.hidden="true"==G.attr(S,"hidden")||!0===G.attr(S,"hidden"));X&&X(S,W);W.type=W.type?L.getObject(W.type):v.grid.cells.Cell;
W.type&&W.type.markupFactory&&W.type.markupFactory(S,W);R.cells[B]||(R.cells[B]=[]);R.cells[B].push(W)})}));return new O(D,P)};return z})},"dojox/grid/_Events":function(){define(["dojo/keys","dojo/dom-class","dojo/_base/declare","dojo/_base/event","dojo/_base/sniff"],function(N,v,z,y,m){return z("dojox.grid._Events",null,{cellOverClass:"dojoxGridCellOver",onKeyEvent:function(c){this.dispatchKeyEvent(c)},onContentEvent:function(c){this.dispatchContentEvent(c)},onHeaderEvent:function(c){this.dispatchHeaderEvent(c)},
onStyleRow:function(c){c.customClasses+=(c.odd?" dojoxGridRowOdd":"")+(c.selected?" dojoxGridRowSelected":"")+(c.over?" dojoxGridRowOver":"");this.focus.styleRow(c);this.edit.styleRow(c)},onKeyDown:function(c){if(!c.altKey&&!c.metaKey)switch(c.keyCode){case N.ESCAPE:this.edit.cancel();break;case N.ENTER:if(!this.edit.isEditing()){var f=this.focus.getHeaderIndex();if(0<=f){this.setSortIndex(f);break}else this.selection.clickSelect(this.focus.rowIndex,dojo.isCopyKey(c),c.shiftKey);y.stop(c)}c.shiftKey||
(f=this.edit.isEditing(),this.edit.apply(),f||this.edit.setEditCell(this.focus.cell,this.focus.rowIndex));this.edit.isEditing()||((this.focus.focusView||this.views.views[0]).content.decorateEvent(c),this.onRowClick(c),y.stop(c));break;case N.SPACE:this.edit.isEditing()||(f=this.focus.getHeaderIndex(),0<=f?this.setSortIndex(f):(this.selection.clickSelect(this.focus.rowIndex,dojo.isCopyKey(c),c.shiftKey),this.focus._focusifyCellNode(!0),this.focus.setFocusCell(this.focus.cell,this.focus.rowIndex),y.stop(c)));
break;case N.TAB:this.focus[c.shiftKey?"previousKey":"nextKey"](c);break;case N.LEFT_ARROW:case N.RIGHT_ARROW:if(!this.edit.isEditing()){var a=c.keyCode;y.stop(c);f=this.focus.getHeaderIndex();0<=f&&c.shiftKey&&c.ctrlKey?this.focus.colSizeAdjust(c,f,5*(a==N.LEFT_ARROW?-1:1)):(c=a==N.LEFT_ARROW?1:-1,this.isLeftToRight()&&(c*=-1),this.focus.move(0,c))}break;case N.UP_ARROW:this.edit.isEditing()||0===this.focus.rowIndex||(y.stop(c),this.focus.move(-1,0));break;case N.DOWN_ARROW:this.edit.isEditing()||
this.focus.rowIndex+1==this.rowCount||(y.stop(c),this.focus.move(1,0));break;case N.PAGE_UP:this.edit.isEditing()||0===this.focus.rowIndex||(y.stop(c),this.focus.rowIndex!=this.scroller.firstVisibleRow+1?this.focus.move(this.scroller.firstVisibleRow-this.focus.rowIndex,0):(this.setScrollTop(this.scroller.findScrollTop(this.focus.rowIndex-1)),this.focus.move(this.scroller.firstVisibleRow-this.scroller.lastVisibleRow+1,0)));break;case N.PAGE_DOWN:this.edit.isEditing()||this.focus.rowIndex+1==this.rowCount||
(y.stop(c),this.focus.rowIndex!=this.scroller.lastVisibleRow-1?this.focus.move(this.scroller.lastVisibleRow-this.focus.rowIndex-1,0):(this.setScrollTop(this.scroller.findScrollTop(this.focus.rowIndex+1)),this.focus.move(this.scroller.lastVisibleRow-this.scroller.firstVisibleRow-1,0)))}},onMouseOver:function(c){-1==c.rowIndex?this.onHeaderCellMouseOver(c):this.onCellMouseOver(c)},onMouseOut:function(c){-1==c.rowIndex?this.onHeaderCellMouseOut(c):this.onCellMouseOut(c)},onMouseDown:function(c){-1==
c.rowIndex?this.onHeaderCellMouseDown(c):this.onCellMouseDown(c)},onMouseOverRow:function(c){this.rows.isOver(c.rowIndex)||(this.rows.setOverRow(c.rowIndex),-1==c.rowIndex?this.onHeaderMouseOver(c):this.onRowMouseOver(c))},onMouseOutRow:function(c){if(this.rows.isOver(-1))this.onHeaderMouseOut(c);else this.rows.isOver(-2)||(this.rows.setOverRow(-2),this.onRowMouseOut(c))},onMouseDownRow:function(c){if(-1!=c.rowIndex)this.onRowMouseDown(c)},onCellMouseOver:function(c){c.cellNode&&v.add(c.cellNode,
this.cellOverClass)},onCellMouseOut:function(c){c.cellNode&&v.remove(c.cellNode,this.cellOverClass)},onCellMouseDown:function(c){},onCellClick:function(c){this._click[0]=this._click[1];this._click[1]=c;this.edit.isEditCell(c.rowIndex,c.cellIndex)||this.focus.setFocusCell(c.cell,c.rowIndex);1<this._click.length&&null==this._click[0]&&this._click.shift();this.onRowClick(c)},onCellDblClick:function(c){var f=1<this._click.length&&m("ie")?this._click[1]:1<this._click.length&&this._click[0].rowIndex!=this._click[1].rowIndex?
this._click[0]:c;this.focus.setFocusCell(f.cell,f.rowIndex);this.edit.setEditCell(f.cell,f.rowIndex);this.onRowDblClick(c)},onCellContextMenu:function(c){this.onRowContextMenu(c)},onCellFocus:function(c,f){this.edit.cellFocus(c,f)},onRowClick:function(c){this.edit.rowClick(c);this.selection.clickSelectEvent(c)},onRowDblClick:function(c){},onRowMouseOver:function(c){},onRowMouseOut:function(c){},onRowMouseDown:function(c){},onRowContextMenu:function(c){y.stop(c)},onHeaderMouseOver:function(c){},onHeaderMouseOut:function(c){},
onHeaderCellMouseOver:function(c){c.cellNode&&v.add(c.cellNode,this.cellOverClass)},onHeaderCellMouseOut:function(c){c.cellNode&&v.remove(c.cellNode,this.cellOverClass)},onHeaderCellMouseDown:function(c){},onHeaderClick:function(c){},onHeaderCellClick:function(c){this.setSortIndex(c.cell.index);this.onHeaderClick(c)},onHeaderDblClick:function(c){},onHeaderCellDblClick:function(c){this.onHeaderDblClick(c)},onHeaderCellContextMenu:function(c){this.onHeaderContextMenu(c)},onHeaderContextMenu:function(c){this.headerMenu||
y.stop(c)},onStartEdit:function(c,f){},onApplyCellEdit:function(c,f,a){},onCancelEdit:function(c){},onApplyEdit:function(c){},onCanSelect:function(c){return!0},onCanDeselect:function(c){return!0},onSelected:function(c){this.updateRowStyles(c)},onDeselected:function(c){this.updateRowStyles(c)},onSelectionChanged:function(){}})})},"dojox/grid/_Scroller":function(){define(["dijit/registry","dojo/_base/declare","dojo/_base/lang","./util","dojo/_base/html"],function(N,v,z,y,m){var c=function(a){a&&dojo.forEach(N.toArray(),
function(n){n.domNode&&m.isDescendant(n.domNode,a,!0)&&n.destroy()})},f=function(a,n){for(var l=[],b=0,u;u=a.childNodes[b];){b++;var w=m.byId(u);(w&&w.tagName?w.tagName.toLowerCase():"")==n&&l.push(u)}return l};return v("dojox.grid._Scroller",null,{constructor:function(a){this.setContentNodes(a);this.pageHeights=[];this.pageNodes=[];this.stack=[]},rowCount:0,defaultRowHeight:32,keepRows:100,contentNode:null,scrollboxNode:null,defaultPageHeight:0,keepPages:10,pageCount:0,windowHeight:0,firstVisibleRow:0,
lastVisibleRow:0,averageRowHeight:0,page:0,pageTop:0,init:function(a,n,l){switch(arguments.length){case 3:this.rowsPerPage=l;case 2:this.keepRows=n;case 1:this.rowCount=a}this.defaultPageHeight=(0<this.grid.rowHeight?this.grid.rowHeight:this.defaultRowHeight)*this.rowsPerPage;this.pageCount=this._getPageCount(this.rowCount,this.rowsPerPage);this.setKeepInfo(this.keepRows);this.invalidate();this.scrollboxNode&&(this.scrollboxNode.scrollTop=0,this.scroll(0),this.scrollboxNode.onscroll=z.hitch(this,
"onscroll"))},_getPageCount:function(a,n){return a?Math.ceil(a/n)||1:0},destroy:function(){this.invalidateNodes();delete this.contentNodes;delete this.contentNode;delete this.scrollboxNode},setKeepInfo:function(a){this.keepPages=(this.keepRows=a)?Math.max(Math.ceil(this.keepRows/this.rowsPerPage),2):this.keepPages},setContentNodes:function(a){this.colCount=(this.contentNodes=a)?this.contentNodes.length:0;this.pageNodes=[];for(a=0;a<this.colCount;a++)this.pageNodes[a]=[]},getDefaultNodes:function(){return this.pageNodes[0]||
[]},invalidate:function(){this._invalidating=!0;this.invalidateNodes();this.pageHeights=[];this.height=this.pageCount?(this.pageCount-1)*this.defaultPageHeight+this.calcLastPageHeight():0;this.resize();this._invalidating=!1},updateRowCount:function(a){this.invalidateNodes();this.rowCount=a;a=this.pageCount;0===a&&(this.height=1);this.pageCount=this._getPageCount(this.rowCount,this.rowsPerPage);if(this.pageCount<a)for(--a;a>=this.pageCount;a--)this.height-=this.getPageHeight(a),delete this.pageHeights[a];
else this.pageCount>a&&(this.height+=this.defaultPageHeight*(this.pageCount-a-1)+this.calcLastPageHeight());this.resize()},pageExists:function(a){return!!this.getDefaultPageNode(a)},measurePage:function(a){return this.grid.rowHeight?((a+1)*this.rowsPerPage>this.rowCount?this.rowCount-a*this.rowsPerPage:this.rowsPerPage)*this.grid.rowHeight:(a=this.getDefaultPageNode(a))&&a.innerHTML?a.offsetHeight:void 0},positionPage:function(a,n){for(var l=0;l<this.colCount;l++)this.pageNodes[l][a].style.top=n+
"px"},repositionPages:function(a){for(var n=this.getDefaultNodes(),l=0,b=0;b<this.stack.length;b++)l=Math.max(this.stack[b],l);var u=(b=n[a])?this.getPageNodePosition(b)+this.getPageHeight(a):0;for(a+=1;a<=l;a++){if(b=n[a]){if(this.getPageNodePosition(b)==u)break;this.positionPage(a,u)}u+=this.getPageHeight(a)}},installPage:function(a){for(var n=0;n<this.colCount;n++)this.contentNodes[n].appendChild(this.pageNodes[n][a])},preparePage:function(a,n){n=n?this.popPage():null;for(var l=0;l<this.colCount;l++){var b=
this.pageNodes[l],u=null===n?this.createPageNode():this.invalidatePageNode(n,b);u.pageIndex=a;b[a]=u}},renderPage:function(a){var n=[],l;for(l=0;l<this.colCount;l++)n[l]=this.pageNodes[l][a];l=0;for(a*=this.rowsPerPage;l<this.rowsPerPage&&a<this.rowCount;l++,a++)this.renderRow(a,n)},removePage:function(a){var n=0;for(a*=this.rowsPerPage;n<this.rowsPerPage;n++,a++)this.removeRow(a)},destroyPage:function(a){for(var n=0;n<this.colCount;n++){var l=this.invalidatePageNode(a,this.pageNodes[n]);l&&m.destroy(l)}},
pacify:function(a){},pacifying:!1,pacifyTicks:200,setPacifying:function(a){this.pacifying!=a&&(this.pacifying=a,this.pacify(this.pacifying))},startPacify:function(){this.startPacifyTicks=(new Date).getTime()},doPacify:function(){var a=(new Date).getTime()-this.startPacifyTicks>this.pacifyTicks;this.setPacifying(!0);this.startPacify();return a},endPacify:function(){this.setPacifying(!1)},resize:function(){this.scrollboxNode&&(this.windowHeight=this.scrollboxNode.clientHeight);for(var a=0;a<this.colCount;a++)y.setStyleHeightPx(this.contentNodes[a],
Math.max(1,this.height));a=!this._invalidating;if(!a){var n=this.grid.get("autoHeight");"number"==typeof n&&n<=Math.min(this.rowsPerPage,this.rowCount)&&(a=!0)}a&&this.needPage(this.page,this.pageTop);a=this.page<this.pageCount-1?this.rowsPerPage:this.rowCount%this.rowsPerPage||this.rowsPerPage;n=this.getPageHeight(this.page);this.averageRowHeight=0<n&&0<a?n/a:0},calcLastPageHeight:function(){if(!this.pageCount)return 0;var a=(this.rowCount%this.rowsPerPage||this.rowsPerPage)*this.defaultRowHeight;
return this.pageHeights[this.pageCount-1]=a},updateContentHeight:function(a){this.height+=a;this.resize()},updatePageHeight:function(a,n,l){if(this.pageExists(a)){var b=this.getPageHeight(a),u=this.measurePage(a);void 0===u&&(u=b);this.pageHeights[a]=u;if(b!=u){this.updateContentHeight(u-b);var w=this.grid.get("autoHeight");"number"==typeof w&&w>this.rowCount||!0===w&&!n?l?(n=this.grid.viewsNode.style,n.height=parseInt(n.height)+u-b+"px",this.repositionPages(a)):this.grid.sizeChange():this.repositionPages(a)}return u}return 0},
rowHeightChanged:function(a,n){this.updatePageHeight(Math.floor(a/this.rowsPerPage),!1,n)},invalidateNodes:function(){for(;this.stack.length;)this.destroyPage(this.popPage())},createPageNode:function(){var a=document.createElement("div");m.attr(a,"role","presentation");a.style.position="absolute";a.style[this.grid.isLeftToRight()?"left":"right"]="0";return a},getPageHeight:function(a){a=this.pageHeights[a];return void 0!==a?a:this.defaultPageHeight},pushPage:function(a){return this.stack.push(a)},
popPage:function(){return this.stack.shift()},findPage:function(a){for(var n=0,l=0,b=0;n<this.pageCount&&!(b=this.getPageHeight(n),l+b>=a);n++,l+=b);this.page=n;this.pageTop=l},buildPage:function(a,n,l){this.preparePage(a,n);this.positionPage(a,l);this.installPage(a);this.renderPage(a);this.pushPage(a)},needPage:function(a,n){var l=this.getPageHeight(a);this.pageExists(a)?this.positionPage(a,n):(this.buildPage(a,!this.grid._autoHeight&&this.keepPages&&this.stack.length>=this.keepPages,n),l=this.updatePageHeight(a,
!0));return l},onscroll:function(){this.scroll(this.scrollboxNode.scrollTop)},scroll:function(a){this.grid.scrollTop=a;if(this.colCount){this.startPacify();this.findPage(a);for(var n=this.height,l=this.getScrollBottom(a),b=this.page,u=this.pageTop;b<this.pageCount&&(0>l||u<l);b++)u+=this.needPage(b,u);this.firstVisibleRow=this.getFirstVisibleRow(this.page,this.pageTop,a);this.lastVisibleRow=this.getLastVisibleRow(b-1,u,l);n!=this.height&&this.repositionPages(b-1);this.endPacify()}},getScrollBottom:function(a){return 0<=
this.windowHeight?a+this.windowHeight:-1},processNodeEvent:function(a,n){for(var l=a.target;l&&l!=n&&l.parentNode&&l.parentNode.parentNode!=n;)l=l.parentNode;if(!l||!l.parentNode||l.parentNode.parentNode!=n)return!1;a.topRowIndex=l.parentNode.pageIndex*this.rowsPerPage;n=a.topRowIndex;a:{var b=0;for(var u,w=l.parentNode;u=w.childNodes[b++];)if(u==l){--b;break a}b=-1}a.rowIndex=n+b;a.rowTarget=l;return!0},processEvent:function(a){return this.processNodeEvent(a,this.contentNode)},renderRow:function(a,
n){},removeRow:function(a){},getDefaultPageNode:function(a){return this.getDefaultNodes()[a]},positionPageNode:function(a,n){},getPageNodePosition:function(a){return a.offsetTop},invalidatePageNode:function(a,n){var l=n[a];l&&(delete n[a],this.removePage(a,l),c(l),l.innerHTML="");return l},getPageRow:function(a){return a*this.rowsPerPage},getLastPageRow:function(a){return Math.min(this.rowCount,this.getPageRow(a+1))-1},getFirstVisibleRow:function(a,n,l){if(!this.pageExists(a))return 0;var b=this.getPageRow(a),
u=this.getDefaultNodes();a=f(u[a],"div");u=0;for(var w=a.length;u<w&&n<l;u++,b++)n+=a[u].offsetHeight;return b?b-1:b},getLastVisibleRow:function(a,n,l){if(!this.pageExists(a))return 0;var b=this.getDefaultNodes(),u=this.getLastPageRow(a);a=f(b[a],"div");for(b=a.length-1;0<=b&&n>l;b--,u--)n-=a[b].offsetHeight;return u+1},findTopRow:function(a){var n=this.getDefaultNodes();n=f(n[this.page],"div");for(var l=0,b=n.length,u=this.pageTop,w;l<b;l++)if(w=n[l].offsetHeight,u+=w,u>=a)return this.offset=w-(u-
a),l+this.page*this.rowsPerPage;return-1},findScrollTop:function(a){var n=Math.floor(a/this.rowsPerPage),l=0,b;for(b=0;b<n;b++)l+=this.getPageHeight(b);this.pageTop=l;this.page=n;this.needPage(n,this.pageTop);b=this.getDefaultNodes();var u=f(b[n],"div");n=a-this.rowsPerPage*n;b=0;for(a=u.length;b<a&&b<n;b++)l+=u[b].offsetHeight;return l},dummy:0})})},"dojox/grid/util":function(){define(["../main","dojo/_base/lang","dojo/dom","dojo/_base/sniff"],function(N,v,z,y){var m=v.getObject("grid.util",!0,N);
m.na="...";m.rowIndexTag="gridRowIndex";m.gridViewTag="gridView";m.fire=function(c,f,a){function n(q,h){if(null==q)return null;var r=h?"Width":"Height";return q["scroll"+r]>q["client"+r]?q:n(q.parentNode,h)}var l;if(y("webkit")&&"focus"==f){var b=c.domNode?c.domNode:c;if(l=n(b,!1))var u=l.scrollTop;if(b=n(b,!0))var w=b.scrollLeft}var e=c&&f&&c[f];c=e&&(a?e.apply(c,a):c[f]());y("webkit")&&"focus"==f&&(l&&(l.scrollTop=u),b&&(b.scrollLeft=w));return c};m.setStyleHeightPx=function(c,f){if(0<=f){var a=
c.style;f+="px";c&&a.height!=f&&(a.height=f)}};m.mouseEvents="mouseover mouseout mousedown mouseup click dblclick contextmenu".split(" ");m.keyEvents=["keyup","keydown","keypress"];m.funnelEvents=function(c,f,a,n){n=n?n:m.mouseEvents.concat(m.keyEvents);for(var l=0,b=n.length;l<b;l++)f.connect(c,"on"+n[l],a)};m.removeNode=function(c){(c=z.byId(c))&&c.parentNode&&c.parentNode.removeChild(c);return c};m.arrayCompare=function(c,f){for(var a=0,n=c.length;a<n;a++)if(c[a]!=f[a])return!1;return c.length==
f.length};m.arrayInsert=function(c,f,a){c.length<=f?c[f]=a:c.splice(f,0,a)};m.arrayRemove=function(c,f){c.splice(f,1)};m.arraySwap=function(c,f,a){var n=c[f];c[f]=c[a];c[a]=n};return m})},"dojox/grid/_Layout":function(){define("dojo/_base/kernel ../main dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/dom-geometry ./cells ./_RowSelector".split(" "),function(N,v,z,y,m,c){return z("dojox.grid._Layout",null,{constructor:function(f){this.grid=f},cells:[],structure:null,defaultWidth:"6em",moveColumn:function(f,
a,n,l,b){var u=this.structure[f].cells[0],w=this.structure[a].cells[0],e=null,q=e=0;f=0;for(var h;h=u[f];f++)if(h.index==n){e=f;break}e=u.splice(e,1)[0];e.view=this.grid.views.views[a];f=0;for(h=null;h=w[f];f++)if(h.index==l){q=f;break}b||(q+=1);w.splice(q,0,e);if(n=this.grid.getCell(this.grid.getSortIndex()))n._currentlySorted=this.grid.getSortAsc();this.cells=[];for(f=n=0;a=this.structure[f];f++)for(l=0;b=a.cells[l];l++)for(u=0;h=b[u];u++)h.index=n,this.cells.push(h),"_currentlySorted"in h&&(w=
n+1,w*=h._currentlySorted?1:-1,this.grid.sortInfo=w,delete h._currentlySorted),n++;y.forEach(this.cells,function(r){var d=r.markup[2].split(" ");parseInt(d[1].substring(5))!=r.index&&(d[1]='idx\x3d"'+r.index+'"',r.markup[2]=d.join(" "))});this.grid.setupHeaderMenu()},setColumnVisibility:function(f,a){f=this.cells[f];if(f.hidden==a){f.hidden=!a;a=f.view;var n=a.viewWidth;n&&"auto"!=n&&(a._togglingColumn=c.getMarginBox(f.getHeaderNode()).w||0);a.update();return!0}return!1},addCellDef:function(f,a,n){var l=
this,b=function(u){var w=0;1<u.colSpan?w=0:(w=u.width||l._defaultCellProps.width||l.defaultWidth,isNaN(w)||(w+="em"));return w};f={grid:this.grid,subrow:f,layoutIndex:a,index:this.cells.length};if(n&&n instanceof v.grid.cells._Base)return a=m.clone(n),f.unitWidth=b(a._props),a=m.mixin(a,this._defaultCellProps,n._props,f);a=n.type||n.cellType||this._defaultCellProps.type||this._defaultCellProps.cellType||v.grid.cells.Cell;m.isString(a)&&(a=m.getObject(a));f.unitWidth=b(n);return new a(m.mixin({},this._defaultCellProps,
n,f))},addRowDef:function(f,a){for(var n=[],l=0,b=0,u=!0,w=0,e;e=a[w];w++)e=this.addCellDef(f,w,e),n.push(e),this.cells.push(e),u&&e.relWidth?l+=e.relWidth:e.width&&(e=e.width,"string"==typeof e&&"%"==e.slice(-1)?b+=window.parseInt(e,10):"auto"==e&&(u=!1));l&&u&&y.forEach(n,function(q){q.relWidth&&(q.width=q.unitWidth=q.relWidth/l*(100-b)+"%")});return n},addRowsDef:function(f){var a=[];if(m.isArray(f))if(m.isArrayLike(f[0]))for(var n=0,l;f&&(l=f[n]);n++)a.push(this.addRowDef(n,l));else a.push(this.addRowDef(0,
f));return a},addViewDef:function(f){this._defaultCellProps=f.defaultCell||{};f.width&&"auto"==f.width&&delete f.width;return m.mixin({},f,{cells:this.addRowsDef(f.rows||f.cells)})},setStructure:function(f){this.fieldIndex=0;this.cells=[];var a=this.structure=[];if(this.grid.rowSelector){var n={type:v._scopeName+".grid._RowSelector"};if(m.isString(this.grid.rowSelector)){var l=this.grid.rowSelector;"false"==l?n=null:"true"!=l&&(n.width=l)}else this.grid.rowSelector||(n=null);n&&a.push(this.addViewDef(n))}var b=
function(q){return"name"in q||"field"in q||"get"in q};n=function(q){return m.isArray(q)&&(m.isArray(q[0])||b(q[0]))?!0:!1};l=function(q){return null!==q&&m.isObject(q)&&("cells"in q||"rows"in q||"type"in q&&!b(q))};if(m.isArrayLike(f)){for(var u=!1,w=0,e;e=f[w];w++)if(l(e)){u=!0;break}if(u)for(w=0;e=f[w];w++)n(e)?a.push(this.addViewDef({cells:e})):l(e)&&a.push(this.addViewDef(e));else a.push(this.addViewDef({cells:f}))}else l(f)&&a.push(this.addViewDef(f));this.cellCount=this.cells.length;this.grid.setupHeaderMenu()}})})},
"dojox/grid/cells":function(){define(["../main","./cells/_base"],function(N){return N.grid.cells})},"dojox/grid/cells/_base":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/event dojo/_base/connect dojo/_base/array dojo/_base/sniff dojo/dom dojo/dom-attr dojo/dom-construct dijit/_Widget ../util".split(" "),function(N,v,z,y,m,c,f,a,n,l,b,u){var w=v("dojox.grid._DeferredTextWidget",b,{deferred:null,_destroyOnRemove:!0,postCreate:function(){this.deferred&&this.deferred.addBoth(z.hitch(this,
function(d){this.domNode&&(this.domNode.innerHTML=d)}))}}),e=function(){setTimeout(z.hitch.apply(N,arguments),0)},q=v("dojox.grid.cells._Base",null,{styles:"",classes:"",editable:!1,alwaysEditing:!1,formatter:null,defaultValue:"...",value:null,hidden:!1,noresize:!1,draggable:!0,_valueProp:"value",_formatPending:!1,constructor:function(d){this._props=d||{};z.mixin(this,d);void 0===this.draggable&&(this.draggable=!0)},_defaultFormat:function(d,x){var C=this.grid.formatterScope||this,L=this.formatter;
L&&C&&"string"==typeof L&&(L=this.formatter=C[L]);d=d!=this.defaultValue&&L?L.apply(C,x):d;if("undefined"==typeof d)return this.defaultValue;d&&d.addBoth&&(d=new w({deferred:d},l.create("span",{innerHTML:this.defaultValue})));return d&&d.declaredClass&&d.startup?"\x3cdiv class\x3d'dojoxGridStubNode' linkWidget\x3d'"+d.id+"' cellIdx\x3d'"+this.index+"'\x3e"+this.defaultValue+"\x3c/div\x3e":d},format:function(d,x){var C=this.grid.edit.info;(x=this.get?this.get(d,x):this.value||this.defaultValue)&&x.replace&&
this.grid.escapeHTMLInData&&(x=x.replace(/&(?![a-z0-9]{1,8};)/ig,"\x26amp;").replace(/</g,"\x26lt;"));return this.editable&&(this.alwaysEditing||C.rowIndex==d&&C.cell==this)?this.formatEditing(C.value?C.value:x,d):this._defaultFormat(x,[x,d,this])},formatEditing:function(d,x){},getNode:function(d){return this.view.getCellNode(d,this.index)},getHeaderNode:function(){return this.view.getHeaderCellNode(this.index)},getEditNode:function(d){return(this.getNode(d)||0).firstChild||0},canResize:function(){var d=
this.unitWidth;return d&&"auto"!==d},isFlex:function(){var d=this.unitWidth;return d&&z.isString(d)&&("auto"==d||"%"==d.slice(-1))},applyEdit:function(d,x){this.getNode(x)&&this.grid.edit.applyCellEdit(d,this,x)},cancelEdit:function(d){this.grid.doCancelEdit(d)},_onEditBlur:function(d){this.grid.edit.isEditCell(d,this.index)&&this.grid.edit.apply()},registerOnBlur:function(d,x){this.commitOnBlur&&m.connect(d,"onblur",function(C){setTimeout(z.hitch(this,"_onEditBlur",x),250)})},needFormatNode:function(d,
x){this._formatPending=!0;e(this,"_formatNode",d,x)},cancelFormatNode:function(){this._formatPending=!1},_formatNode:function(d,x){this._formatPending&&(this._formatPending=!1,f("ie")||a.setSelectable(this.grid.domNode,!0),this.formatNode(this.getEditNode(x),d,x))},formatNode:function(d,x,C){f("ie")?e(this,"focus",C,d):this.focus(C,d)},dispatchEvent:function(d,x){if(d in this)return this[d](x)},getValue:function(d){return this.getEditNode(d)[this._valueProp]},setValue:function(d,x){(d=this.getEditNode(d))&&
(d[this._valueProp]=x)},focus:function(d,x){d=x||this.getEditNode(d);try{u.fire(d,"focus"),u.fire(d,"select")}catch(C){}},save:function(d){this.value=this.value||this.getValue(d)},restore:function(d){this.setValue(d,this.value)},_finish:function(d){a.setSelectable(this.grid.domNode,!1);this.cancelFormatNode()},apply:function(d){this.applyEdit(this.getValue(d),d);this._finish(d)},cancel:function(d){this.cancelEdit(d);this._finish(d)}});q.markupFactory=function(d,x){var C=z.trim(n.get(d,"formatter")||
"");C&&(x.formatter=z.getObject(C)||C);if(C=z.trim(n.get(d,"get")||""))x.get=z.getObject(C);C=function(L,t,p){var G=z.trim(n.get(d,L)||"");G&&(t[p||L]="false"!=G.toLowerCase())};C("sortDesc",x);C("editable",x);C("alwaysEditing",x);C("noresize",x);C("draggable",x);if(C=z.trim(n.get(d,"loadingText")||n.get(d,"defaultValue")||""))x.defaultValue=C;C=function(L,t,p){var G=z.trim(n.get(d,L)||"")||void 0;G&&(t[p||L]=G)};C("styles",x);C("headerStyles",x);C("cellStyles",x);C("classes",x);C("headerClasses",
x);C("cellClasses",x)};var h=q.Cell=v("dojox.grid.cells.Cell",q,{constructor:function(){this.keyFilter=this.keyFilter},keyFilter:null,formatEditing:function(d,x){this.needFormatNode(d,x);d&&d.replace&&(d=d.replace(/"/g,"\x26quot;"));return'\x3cinput class\x3d"dojoxGridInput" type\x3d"text" value\x3d"'+d+'"\x3e'},formatNode:function(d,x,C){this.inherited(arguments);this.registerOnBlur(d,C)},doKey:function(d){this.keyFilter&&-1==String.fromCharCode(d.charCode).search(this.keyFilter)&&y.stop(d)},_finish:function(d){this.inherited(arguments);
var x=this.getEditNode(d);try{u.fire(x,"blur")}catch(C){}}});h.markupFactory=function(d,x){q.markupFactory(d,x);if(d=z.trim(n.get(d,"keyFilter")||""))x.keyFilter=new RegExp(d)};(q.RowIndex=v("dojox.grid.cells.RowIndex",h,{name:"Row",postscript:function(){this.editable=!1},get:function(d){return d+1}})).markupFactory=function(d,x){h.markupFactory(d,x)};(q.Select=v("dojox.grid.cells.Select",h,{options:null,values:null,returnIndex:-1,constructor:function(d){this.values=this.values||this.options},formatEditing:function(d,
x){this.needFormatNode(d,x);x=['\x3cselect class\x3d"dojoxGridSelect"\x3e'];for(var C=0,L,t;void 0!==(L=this.options[C])&&void 0!==(t=this.values[C]);C++)t=t.replace?t.replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):t,L=L.replace?L.replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):L,x.push("\x3coption",d==t?" selected":"",' value\x3d"'+t+'"',"\x3e",L,"\x3c/option\x3e");x.push("\x3c/select\x3e");return x.join("")},_defaultFormat:function(d,x){var C=this.inherited(arguments);if(!this.formatter&&this.values&&
this.options){var L=c.indexOf(this.values,C);0<=L&&(C=this.options[L])}return C},getValue:function(d){var x=this.getEditNode(d);if(x)return d=x.selectedIndex,x=x.options[d],-1<this.returnIndex?d:x.value||x.innerHTML}})).markupFactory=function(d,x){h.markupFactory(d,x);var C=z.trim(n.get(d,"options")||"");if(C){var L=C.split(",");L[0]!=C&&(x.options=L)}if(d=z.trim(n.get(d,"values")||""))C=d.split(","),C[0]!=d&&(x.values=C)};var r=q.AlwaysEdit=v("dojox.grid.cells.AlwaysEdit",h,{alwaysEditing:!0,_formatNode:function(d,
x){this.formatNode(this.getEditNode(x),d,x)},applyStaticValue:function(d){var x=this.grid.edit;x.applyCellEdit(this.getValue(d),this,d);x.start(this,d,!0)}});r.markupFactory=function(d,x){h.markupFactory(d,x)};(q.Bool=v("dojox.grid.cells.Bool",r,{_valueProp:"checked",formatEditing:function(d,x){return'\x3cinput class\x3d"dojoxGridInput" type\x3d"checkbox"'+(d?' checked\x3d"checked"':"")+' style\x3d"width: auto" /\x3e'},doclick:function(d){"INPUT"==d.target.tagName&&this.applyStaticValue(d.rowIndex)}})).markupFactory=
function(d,x){r.markupFactory(d,x)};return q})},"dojox/grid/_RowSelector":function(){define(["dojo/_base/declare","./_View"],function(N,v){return N("dojox.grid._RowSelector",v,{defaultWidth:"2em",noscroll:!0,padBorderWidth:2,buildRendering:function(){this.inherited("buildRendering",arguments);this.scrollboxNode.style.overflow="hidden";this.headerNode.style.visibility="hidden"},getWidth:function(){return this.viewWidth||this.defaultWidth},buildRowContent:function(z,y){y.innerHTML='\x3ctable class\x3d"dojoxGridRowbarTable" style\x3d"width:'+
(this.contentWidth||0)+'px;height:1px;" border\x3d"0" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"\x3e\x3ctr\x3e\x3ctd class\x3d"dojoxGridRowbarInner"\x3e\x26nbsp;\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e'},renderHeader:function(){},updateRow:function(){},resize:function(){this.adaptHeight()},adaptWidth:function(){!("contentWidth"in this)&&this.contentNode&&0<this.contentNode.offsetWidth&&(this.contentWidth=this.contentNode.offsetWidth-this.padBorderWidth)},doStyleRowNode:function(z,y){var m=
["dojoxGridRowbar dojoxGridNonNormalizedCell"];this.grid.rows.isOver(z)&&m.push("dojoxGridRowbarOver");this.grid.selection.isSelected(z)&&m.push("dojoxGridRowbarSelected");y.className=m.join(" ")},domouseover:function(z){this.grid.onMouseOverRow(z)},domouseout:function(z){if(!this.isIntraRowEvent(z))this.grid.onMouseOutRow(z)}})})},"dojox/grid/_View":function(){define("dojo dijit/registry ../main dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/connect dojo/_base/sniff dojo/query dojo/_base/window dojo/text!./resources/View.html dojo/dnd/Source dijit/_Widget dijit/_TemplatedMixin dojox/html/metrics ./util dojo/_base/html ./_Builder dojo/dnd/Avatar dojo/dnd/Manager".split(" "),
function(N,v,z,y,m,c,f,a,n,l,b,u,w,e,q,h,r,d,x,C){b=y("dojox.grid._View",[w,e],{defaultWidth:"18em",viewWidth:"",templateString:b,classTag:"dojoxGrid",marginBottom:0,rowPad:2,_togglingColumn:-1,_headerBuilderClass:d._HeaderBuilder,_contentBuilderClass:d._ContentBuilder,postMixInProperties:function(){this.rowNodes={}},postCreate:function(){this.connect(this.scrollboxNode,"onscroll","doscroll");h.funnelEvents(this.contentNode,this,"doContentEvent","mouseover mouseout click dblclick contextmenu mousedown".split(" "));
h.funnelEvents(this.headerNode,this,"doHeaderEvent","dblclick mouseover mouseout mousemove mousedown click contextmenu".split(" "));this.content=new this._contentBuilderClass(this);this.header=new this._headerBuilderClass(this);this.grid.isLeftToRight()||(this.headerNodeContainer.style.width="")},destroy:function(){r.destroy(this.headerNode);delete this.headerNode;for(var p in this.rowNodes)this._cleanupRowWidgets(this.rowNodes[p]),r.destroy(this.rowNodes[p]);this.rowNodes={};this.source&&this.source.destroy();
this.inherited(arguments)},focus:function(){a("ie")||a("webkit")||a("opera")?this.hiddenFocusNode.focus():this.scrollboxNode.focus()},setStructure:function(p){p=this.structure=p;p.width&&!isNaN(p.width)?this.viewWidth=p.width+"em":this.viewWidth=p.width||(p.noscroll?"auto":this.viewWidth);this._onBeforeRow=p.onBeforeRow||function(){};this._onAfterRow=p.onAfterRow||function(){};if(this.noscroll=p.noscroll)this.scrollboxNode.style.overflow="hidden";this.simpleStructure=1==p.cells.length;this.testFlexCells();
this.updateStructure()},_cleanupRowWidgets:function(p){p&&m.forEach(n("[widgetId]",p).map(v.byNode),function(G){G._destroyOnRemove?(G.destroy(),delete G):G.domNode&&G.domNode.parentNode&&G.domNode.parentNode.removeChild(G.domNode)})},onBeforeRow:function(p,G){this._onBeforeRow(p,G);0<=p&&this._cleanupRowWidgets(this.getRowNode(p))},onAfterRow:function(p,G,T){this._onAfterRow(p,G,T);var D=this.grid;m.forEach(n(".dojoxGridStubNode",T),function(P){if(P&&P.parentNode){var O=P.getAttribute("linkWidget"),
X=window.parseInt(r.attr(P,"cellIdx"),10);D.getCell(X);(O=v.byId(O))?(P.parentNode.replaceChild(O.domNode,P),O._started||O.startup(),N.destroy(P)):P.innerHTML=""}},this)},testFlexCells:function(){this.flexCells=!1;for(var p=0,G;G=this.structure.cells[p];p++)for(var T=0,D;D=G[T];T++)D.view=this,this.flexCells=this.flexCells||D.isFlex();return this.flexCells},updateStructure:function(){this.header.update();this.content.update()},getScrollbarWidth:function(){var p=this.hasVScrollbar(),G=r.style(this.scrollboxNode,
"overflow");this.noscroll||!G||"hidden"==G?p=!1:"scroll"==G&&(p=!0);return p?q.getScrollbar().w:0},getColumnsWidth:function(){var p=this.headerContentNode;return p&&p.firstChild?p.firstChild.offsetWidth||r.style(p.firstChild,"width"):0},setColumnsWidth:function(p){this.headerContentNode.firstChild.style.width=p+"px";this.viewWidth&&(this.viewWidth=p+"px")},getWidth:function(){return this.viewWidth||this.getColumnsWidth()+this.getScrollbarWidth()+"px"},getContentWidth:function(){return Math.max(0,
r._getContentBox(this.domNode).w-this.getScrollbarWidth())+"px"},render:function(){this.scrollboxNode.style.height="";this.renderHeader();0<=this._togglingColumn&&(this.setColumnsWidth(this.getColumnsWidth()-this._togglingColumn),this._togglingColumn=-1);var p=this.grid.layout.cells,G=c.hitch(this,function(D,P){!this.grid.isLeftToRight()&&(P=!P);P=P?-1:1;D=this.header.getCellNodeIndex(D)+P;for(var O=p[D];O&&O.getHeaderNode()&&"none"==O.getHeaderNode().style.display;)D+=P,O=p[D];return O?O.getHeaderNode():
null});if(this.grid.columnReordering&&this.simpleStructure){this.source&&this.source.destroy();this.bottomMarker&&r.destroy(this.bottomMarker);this.bottomMarker=r.byId("dojoxGrid_bottomMarker");this.topMarker&&r.destroy(this.topMarker);this.topMarker=r.byId("dojoxGrid_topMarker");this.bottomMarker||(this.bottomMarker=r.create("div",{id:"dojoxGrid_bottomMarker","class":"dojoxGridColPlaceBottom"},l.body()),this._hide(this.bottomMarker),this.topMarker=r.create("div",{id:"dojoxGrid_topMarker","class":"dojoxGridColPlaceTop"},
l.body()),this._hide(this.topMarker));this.arrowDim=r.contentBox(this.bottomMarker);var T=r.contentBox(this.headerContentNode.firstChild.rows[0]).h;this.source=new u(this.headerContentNode.firstChild.rows[0],{horizontal:!0,accept:["gridColumn_"+this.grid.id],viewIndex:this.index,generateText:!1,onMouseDown:c.hitch(this,function(D){this.header.decorateEvent(D);if((this.header.overRightResizeArea(D)||this.header.overLeftResizeArea(D))&&this.header.canResize(D)&&!this.header.moveable)this.header.beginColumnResize(D);
else{if(this.grid.headerMenu)this.grid.headerMenu.onCancel(!0);D.button===(9>a("ie")?1:0)&&u.prototype.onMouseDown.call(this.source,D)}}),onMouseOver:c.hitch(this,function(D){var P=this.source;P._getChildByEvent(D)&&u.prototype.onMouseOver.apply(P,arguments)}),_markTargetAnchor:c.hitch(this,function(D){var P=this.source;if(P.current!=P.targetAnchor||P.before!=D){P.targetAnchor&&G(P.targetAnchor,P.before)&&P._removeItemClass(G(P.targetAnchor,P.before),P.before?"After":"Before");u.prototype._markTargetAnchor.call(P,
D);var O=D?P.targetAnchor:G(P.targetAnchor,P.before);D=0;O||(O=P.targetAnchor,D=r.contentBox(O).w+this.arrowDim.w/2+2);O=r.position(O,!0);D=Math.floor(O.x-this.arrowDim.w/2+D);r.style(this.bottomMarker,"visibility","visible");r.style(this.topMarker,"visibility","visible");r.style(this.bottomMarker,{left:D+"px",top:T+O.y+"px"});r.style(this.topMarker,{left:D+"px",top:O.y-this.arrowDim.h+"px"});P.targetAnchor&&G(P.targetAnchor,P.before)&&P._addItemClass(G(P.targetAnchor,P.before),P.before?"After":"Before")}}),
_unmarkTargetAnchor:c.hitch(this,function(){var D=this.source;D.targetAnchor&&(D.targetAnchor&&G(D.targetAnchor,D.before)&&D._removeItemClass(G(D.targetAnchor,D.before),D.before?"After":"Before"),this._hide(this.bottomMarker),this._hide(this.topMarker),u.prototype._unmarkTargetAnchor.call(D))}),destroy:c.hitch(this,function(){f.disconnect(this._source_conn);f.unsubscribe(this._source_sub);u.prototype.destroy.call(this.source);this.bottomMarker&&(r.destroy(this.bottomMarker),delete this.bottomMarker);
this.topMarker&&(r.destroy(this.topMarker),delete this.topMarker)}),onDndCancel:c.hitch(this,function(){u.prototype.onDndCancel.call(this.source);this._hide(this.bottomMarker);this._hide(this.topMarker)})});this._source_conn=f.connect(this.source,"onDndDrop",this,"_onDndDrop");this._source_sub=f.subscribe("/dnd/drop/before",this,"_onDndDropBefore");this.source.startup()}},_hide:function(p){r.style(p,{top:"-10000px",visibility:"hidden"})},_onDndDropBefore:function(p,G,T){C.manager().target===this.source&&
(this.source._targetNode=this.source.targetAnchor,this.source._beforeTarget=this.source.before,G=this.grid.views.views,p=G[p.viewIndex],G=G[this.index],G!=p&&(p.convertColPctToFixed(),G.convertColPctToFixed()))},_onDndDrop:function(p,G,T){if(C.manager().target!==this.source)C.manager().source===this.source&&(this._removingColumn=!0);else{this._hide(this.bottomMarker);this._hide(this.topMarker);T=function(H){return H?r.attr(H,"idx"):null};var D=r.marginBox(G[0]).w;if(p.viewIndex!==this.index){var P=
this.grid.views.views,O=P[p.viewIndex];P=P[this.index];O.viewWidth&&"auto"!=O.viewWidth&&O.setColumnsWidth(O.getColumnsWidth()-D);P.viewWidth&&"auto"!=P.viewWidth&&P.setColumnsWidth(P.getColumnsWidth())}D=this.source._targetNode;O=this.source._beforeTarget;!this.grid.isLeftToRight()&&(O=!O);P=this.grid.layout;var X=this.index;delete this.source._targetNode;delete this.source._beforeTarget;P.moveColumn(p.viewIndex,X,T(G[0]),T(D),O)}},renderHeader:function(){this.headerContentNode.innerHTML=this.header.generateHtml(this._getHeaderContent);
this.flexCells&&(this.contentWidth=this.getContentWidth(),this.headerContentNode.firstChild.style.width=this.contentWidth);h.fire(this,"onAfterRow",[-1,this.structure.cells,this.headerContentNode])},_getHeaderContent:function(p){var G=p.name||p.grid.getCellName(p);/^\s+$/.test(G)&&(G="\x26nbsp;");var T=['\x3cdiv class\x3d"dojoxGridSortNode'];p.index!=p.grid.getSortIndex()?T.push('"\x3e'):T=T.concat([" ",0<p.grid.sortInfo?"dojoxGridSortUp":"dojoxGridSortDown",'"\x3e\x3cdiv class\x3d"dojoxGridArrowButtonChar"\x3e',
0<p.grid.sortInfo?"\x26#9650;":"\x26#9660;",'\x3c/div\x3e\x3cdiv class\x3d"dojoxGridArrowButtonNode" role\x3d"presentation"\x3e\x3c/div\x3e','\x3cdiv class\x3d"dojoxGridColCaption"\x3e']);T=T.concat([G,"\x3c/div\x3e\x3c/div\x3e"]);return T.join("")},resize:function(){this.adaptHeight();this.adaptWidth()},hasHScrollbar:function(p){var G=this._hasHScroll||!1;if(void 0==this._hasHScroll||p)this.noscroll?this._hasHScroll=!1:(p=r.style(this.scrollboxNode,"overflow"),this._hasHScroll="hidden"==p?!1:"scroll"==
p?!0:this.scrollboxNode.offsetWidth-this.getScrollbarWidth()<this.contentNode.offsetWidth);G!==this._hasHScroll&&this.grid.update();return this._hasHScroll},hasVScrollbar:function(p){var G=this._hasVScroll||!1;if(void 0==this._hasVScroll||p)this.noscroll?this._hasVScroll=!1:(p=r.style(this.scrollboxNode,"overflow"),this._hasVScroll="hidden"==p?!1:"scroll"==p?!0:this.scrollboxNode.scrollHeight>this.scrollboxNode.clientHeight);G!==this._hasVScroll&&this.grid.update();return this._hasVScroll},convertColPctToFixed:function(){var p=
!1;this.grid.initialWidth="";var G=n("th",this.headerContentNode),T=m.map(G,function(D,P){var O=D.style.width;r.attr(D,"vIdx",P);if(O&&"%"==O.slice(-1))p=!0;else if(O&&"px"==O.slice(-2))return window.parseInt(O,10);return r.contentBox(D).w});return p?(m.forEach(this.grid.layout.cells,function(D,P){if(D.view==this&&(D=D.view.getHeaderCellNode(D.index))&&r.hasAttr(D,"vIdx")){var O=window.parseInt(r.attr(D,"vIdx"));this.setColWidth(P,T[O]);r.removeAttr(D,"vIdx")}},this),!0):!1},adaptHeight:function(p){if(!this.grid._autoHeight){var G=
this.domNode.style.height&&parseInt(this.domNode.style.height.replace(/px/,""),10)||this.domNode.clientHeight;if(!p&&(p=this.noscroll))a:{for(var T=0;T<this.grid.views.views.length;++T)if(p=this.grid.views.views[T],p!==this&&p.hasHScrollbar()){p=!0;break a}p=!1}p&&(G-=q.getScrollbar().h);h.setStyleHeightPx(this.scrollboxNode,G)}this.hasVScrollbar(!0)},adaptWidth:function(){this.flexCells&&(this.contentWidth=this.getContentWidth(),this.headerContentNode.firstChild.style.width=this.contentWidth);var p=
this.scrollboxNode.offsetWidth-this.getScrollbarWidth();this._removingColumn?(p=Math.min(p,this.getColumnsWidth())+"px",this._removingColumn=!1):p=Math.max(p,this.getColumnsWidth())+"px";this.contentNode.style.width=p;this.hasHScrollbar(!0)},setSize:function(p,G){var T=this.domNode.style,D=this.headerNode.style;p&&(T.width=p,D.width=p);T.height=0<=G?G+"px":""},renderRow:function(p){var G=this.createRowNode(p);this.buildRow(p,G);return G},createRowNode:function(p){var G=document.createElement("div");
G.className=this.classTag+"Row";this instanceof z.grid._RowSelector?r.attr(G,"role","presentation"):(r.attr(G,"role","row"),"none"!=this.grid.selectionMode&&G.setAttribute("aria-selected","false"));G[h.gridViewTag]=this.id;G[h.rowIndexTag]=p;return this.rowNodes[p]=G},buildRow:function(p,G){this.buildRowContent(p,G);this.styleRow(p,G)},buildRowContent:function(p,G){G.innerHTML=this.content.generateHtml(p,p);this.flexCells&&this.contentWidth&&(G.firstChild.style.width=this.contentWidth);h.fire(this,
"onAfterRow",[p,this.structure.cells,G])},rowRemoved:function(p){0<=p&&this._cleanupRowWidgets(this.getRowNode(p));this.grid.edit.save(this,p);delete this.rowNodes[p]},getRowNode:function(p){return this.rowNodes[p]},getCellNode:function(p,G){if(p=this.getRowNode(p))return this.content.getCellNode(p,G)},getHeaderCellNode:function(p){if(this.headerContentNode)return this.header.getCellNode(this.headerContentNode,p)},styleRow:function(p,G){var T=void 0==G.style.cssText?G.getAttribute("style"):G.style.cssText;
G._style=T;this.styleRowNode(p,G)},styleRowNode:function(p,G){G&&this.doStyleRowNode(p,G)},doStyleRowNode:function(p,G){this.grid.styleRowNode(p,G)},updateRow:function(p){var G=this.getRowNode(p);G&&(G.style.height="",this.buildRow(p,G));return G},updateRowStyles:function(p){this.styleRowNode(p,this.getRowNode(p))},lastTop:0,firstScroll:0,_nativeScroll:!1,doscroll:function(p){if(13<=a("ff")||a("chrome"))this._nativeScroll=!0;p=this.grid.isLeftToRight();if(2>this.firstScroll){if(!p&&1==this.firstScroll||
p&&0===this.firstScroll){var G=r.marginBox(this.headerNodeContainer);a("ie")?this.headerNodeContainer.style.width=G.w+this.getScrollbarWidth()+"px":a("mozilla")&&(this.headerNodeContainer.style.width=G.w-this.getScrollbarWidth()+"px",this.scrollboxNode.scrollLeft=p?this.scrollboxNode.clientWidth-this.scrollboxNode.scrollWidth:this.scrollboxNode.scrollWidth-this.scrollboxNode.clientWidth)}this.firstScroll++}this.headerNode.scrollLeft=this.scrollboxNode.scrollLeft;p=this.scrollboxNode.scrollTop;p!==
this.lastTop&&this.grid.scrollTo(p);this._nativeScroll=!1},setScrollTop:function(p){this.lastTop=p;this._nativeScroll||(this.scrollboxNode.scrollTop=p);return this.scrollboxNode.scrollTop},doContentEvent:function(p){if(this.content.decorateEvent(p))this.grid.onContentEvent(p)},doHeaderEvent:function(p){if(this.header.decorateEvent(p))this.grid.onHeaderEvent(p)},dispatchContentEvent:function(p){return this.content.dispatchEvent(p)},dispatchHeaderEvent:function(p){return this.header.dispatchEvent(p)},
setColWidth:function(p,G){this.grid.setCellWidth(p,G+"px")},update:function(){if(this.domNode){this.content.update();this.grid.update();var p=this.scrollboxNode.scrollLeft;this.scrollboxNode.scrollLeft=p;this.headerNode.scrollLeft=p}}});var L=y("dojox.grid._GridAvatar",x,{construct:function(){var p=l.doc,G=p.createElement("table");G.cellPadding=G.cellSpacing="0";G.className="dojoxGridDndAvatar";G.style.position="absolute";G.style.zIndex=1999;G.style.margin="0px";var T=p.createElement("tbody"),D=p.createElement("tr"),
P=p.createElement("td"),O=p.createElement("td");D.className="dojoxGridDndAvatarItem";O.className="dojoxGridDndAvatarItemImage";O.style.width="16px";var X=this.manager.source;if(X.creator)X=X._normalizedCreator(X.getItem(this.manager.nodes[0].id).data,"avatar").node;else if(X=this.manager.nodes[0].cloneNode(!0),"tr"==X.tagName.toLowerCase()){var H=p.createElement("table");var g=p.createElement("tbody");g.appendChild(X);H.appendChild(g);X=H}else"th"==X.tagName.toLowerCase()&&(H=p.createElement("table"),
g=p.createElement("tbody"),p=p.createElement("tr"),H.cellPadding=H.cellSpacing="0",p.appendChild(X),g.appendChild(p),H.appendChild(g),X=H);X.id="";P.appendChild(X);D.appendChild(O);D.appendChild(P);r.style(D,"opacity",.9);T.appendChild(D);G.appendChild(T);this.node=G;G=C.manager();this.oldOffsetY=G.OFFSET_Y;G.OFFSET_Y=1},destroy:function(){C.manager().OFFSET_Y=this.oldOffsetY;this.inherited(arguments)}}),t=C.manager().makeAvatar;C.manager().makeAvatar=function(){return void 0===this.source.viewIndex||
r.hasClass(l.body(),"dijit_a11y")?t.call(C.manager()):new L(this)};return b})},"dojox/html/metrics":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/sniff dojo/ready dojo/_base/unload dojo/_base/window dojo/dom-geometry".split(" "),function(N,v,z,y,m,c,f){var a=v.getObject("dojox.html.metrics",!0),n=v.getObject("dojox");a.getFontMeasurements=function(){var q={"1em":0,"1ex":0,"100%":0,"12pt":0,"16px":0,"xx-small":0,"x-small":0,small:0,medium:0,large:0,"x-large":0,"xx-large":0};if(z("ie")){var h=
c.doc.documentElement.style.fontSize||"";h||(c.doc.documentElement.style.fontSize="100%")}var r=c.doc.createElement("div"),d=r.style;d.position="absolute";d.left="-100px";d.top="0";d.width="30px";d.height="1000em";d.borderWidth="0";d.margin="0";d.padding="0";d.outline="0";d.lineHeight="1";d.overflow="hidden";c.body().appendChild(r);for(var x in q)d.fontSize=x,q[x]=16*Math.round(12*r.offsetHeight/16)/12/1E3;z("ie")&&(c.doc.documentElement.style.fontSize=h);c.body().removeChild(r);r=null;return q};
var l=null;a.getCachedFontMeasurements=function(q){if(q||!l)l=a.getFontMeasurements();return l};var b=null,u={};a.getTextBox=function(q,h,r){if(b)var d=b;else{d=b=c.doc.createElement("div");d.style.whiteSpace="nowrap";var x=c.doc.createElement("div");x.appendChild(d);var C=x.style;C.overflow="scroll";C.position="absolute";C.left="0px";C.top="-10000px";C.width="1px";C.height="1px";C.visibility="hidden";C.borderWidth="0";C.margin="0";C.padding="0";C.outline="0";c.body().appendChild(x)}d.className="";
C=d.style;C.borderWidth="0";C.margin="0";C.padding="0";C.outline="0";if(1<arguments.length&&h)for(var L in h)L in u||(C[L]=h[L]);2<arguments.length&&r&&(d.className=r);d.innerHTML=q;C=f.position(d);C.w=d.parentNode.scrollWidth;return C};var w=16,e=16;a.getScrollbar=function(){return{w:w,h:e}};a._fontResizeNode=null;a.initOnFontResize=function(q){var h=a._fontResizeNode=c.doc.createElement("iframe");q=h.style;q.position="absolute";q.width="5em";q.height="10em";q.top="-10000px";q.display="none";z("ie")?
h.onreadystatechange=function(){"complete"==h.contentWindow.document.readyState&&(h.onresize=h.contentWindow.parent[n._scopeName].html.metrics._fontresize)}:h.onload=function(){h.contentWindow.onresize=h.contentWindow.parent[n._scopeName].html.metrics._fontresize};h.setAttribute("src","javascript:'\x3chtml\x3e\x3chead\x3e\x3cscript\x3eif(\"loadFirebugConsole\" in window){window.loadFirebugConsole();}\x3c/script\x3e\x3c/head\x3e\x3cbody\x3e\x3c/body\x3e\x3c/html\x3e'");c.body().appendChild(h);a.initOnFontResize=
function(){}};a.onFontResize=function(){};a._fontresize=function(){a.onFontResize()};m.addOnUnload(function(){var q=a._fontResizeNode;q&&(z("ie")&&q.onresize?q.onresize=null:q.contentWindow&&q.contentWindow.onresize&&(q.contentWindow.onresize=null),a._fontResizeNode=null)});y(function(){try{var q=c.doc.createElement("div");q.style.cssText="top:0;left:0;width:100px;height:100px;overflow:scroll;position:absolute;visibility:hidden;";c.body().appendChild(q);w=q.offsetWidth-q.clientWidth;e=q.offsetHeight-
q.clientHeight;c.body().removeChild(q);delete q}catch(h){}"fontSizeWatch"in N.config&&N.config.fontSizeWatch&&a.initOnFontResize()});return a})},"dojox/grid/_Builder":function(){define("../main dojo/_base/array dojo/_base/lang dojo/_base/window dojo/_base/event dojo/_base/sniff dojo/_base/connect dojo/dnd/Moveable dojox/html/metrics ./util dojo/_base/html dojo/dom-geometry".split(" "),function(N,v,z,y,m,c,f,a,n,l,b,u){var w=N.grid,e=function(t){return 0<=t.rowIndex?t.rowIndex:v.indexOf(t.parentNode.childNodes,
t)},q=function(t,p){return t&&((t.rows||0)[p]||t.childNodes[p])},h=function(t){for(;t&&"TABLE"!=t.tagName;t=t.parentNode);return t},r=function(t){var p=t.toUpperCase();return function(G){return G.tagName!=p}},d=l.rowIndexTag,x=l.gridViewTag,C=w._Builder=z.extend(function(t){t&&(this.view=t,this.grid=t.grid)},{view:null,_table:'\x3ctable class\x3d"dojoxGridRowTable" border\x3d"0" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"',getTableArray:function(){var t=[this._table];this.view.viewWidth&&
t.push([' style\x3d"width:',this.view.viewWidth,';"'].join(""));t.push("\x3e");return t},generateCellMarkup:function(t,p,G,T){var D=[];if(T){var P=t.index!=t.grid.getSortIndex()?"":0<t.grid.sortInfo?'aria-sort\x3d"ascending"':'aria-sort\x3d"descending"';t.id||(t.id=this.grid.id+"Hdr"+t.index);P=['\x3cth tabIndex\x3d"-1" aria-readonly\x3d"true" role\x3d"columnheader"',P,' id\x3d"',t.id,'"']}else P=['\x3ctd tabIndex\x3d"-1" role\x3d"gridcell"',this.grid.editable&&!t.editable?'aria-readonly\x3d"true"':
""];t.colSpan&&P.push(' colspan\x3d"',t.colSpan,'"');t.rowSpan&&P.push(' rowspan\x3d"',t.rowSpan,'"');P.push(' class\x3d"dojoxGridCell ');t.classes&&P.push(t.classes," ");G&&P.push(G," ");D.push(P.join(""));D.push("");P=['" idx\x3d"',t.index,'" style\x3d"'];p&&";"!=p[p.length-1]&&(p+=";");P.push(t.styles,p||"",t.hidden?"display:none;":"");t.unitWidth&&P.push("width:",t.unitWidth,";");D.push(P.join(""));D.push("");P=['"'];t.attrs&&P.push(" ",t.attrs);P.push("\x3e");D.push(P.join(""));D.push("");D.push(T?
"\x3c/th\x3e":"\x3c/td\x3e");return D},isCellNode:function(t){return!(!t||t==y.doc||!b.attr(t,"idx"))},getCellNodeIndex:function(t){return t?Number(b.attr(t,"idx")):-1},getCellNode:function(t,p){for(var G=0,T;(T=q(t.firstChild,G))&&T.cells;G++)for(var D=0,P;P=T.cells[D];D++)if(this.getCellNodeIndex(P)==p)return P;return null},findCellTarget:function(t,p){for(;t&&(!this.isCellNode(t)||t.offsetParent&&x in t.offsetParent.parentNode&&t.offsetParent.parentNode[x]!=this.view.id)&&t!=p;)t=t.parentNode;
return t!=p?t:null},baseDecorateEvent:function(t){t.dispatch="do"+t.type;t.grid=this.grid;t.sourceView=this.view;t.cellNode=this.findCellTarget(t.target,t.rowNode);t.cellIndex=this.getCellNodeIndex(t.cellNode);t.cell=0<=t.cellIndex?this.grid.getCell(t.cellIndex):null},findTarget:function(t,p){for(;t&&t!=this.domNode&&(!(p in t)||x in t&&t[x]!=this.view.id);)t=t.parentNode;return t!=this.domNode?t:null},findRowTarget:function(t){return this.findTarget(t,d)},isIntraNodeEvent:function(t){try{return t.cellNode&&
t.relatedTarget&&b.isDescendant(t.relatedTarget,t.cellNode)}catch(p){return!1}},isIntraRowEvent:function(t){try{var p=t.relatedTarget&&this.findRowTarget(t.relatedTarget);return!p&&-1==t.rowIndex||p&&t.rowIndex==p.gridRowIndex}catch(G){return!1}},dispatchEvent:function(t){return t.dispatch in this?this[t.dispatch](t):!1},domouseover:function(t){t.cellNode&&t.cellNode!=this.lastOverCellNode&&(this.lastOverCellNode=t.cellNode,this.grid.onMouseOver(t));this.grid.onMouseOverRow(t)},domouseout:function(t){if(t.cellNode&&
t.cellNode==this.lastOverCellNode&&!this.isIntraNodeEvent(t,this.lastOverCellNode)&&(this.lastOverCellNode=null,this.grid.onMouseOut(t),!this.isIntraRowEvent(t)))this.grid.onMouseOutRow(t)},domousedown:function(t){if(t.cellNode)this.grid.onMouseDown(t);this.grid.onMouseDownRow(t)},_getTextDirStyle:function(t,p,G){return""}});N=w._ContentBuilder=z.extend(function(t){C.call(this,t)},C.prototype,{update:function(){this.prepareHtml()},prepareHtml:function(){for(var t=this.grid.get,p=this.view.structure.cells,
G=0,T;T=p[G];G++)for(var D=0,P;P=T[D];D++)P.get=P.get||void 0==P.value&&t,P.markup=this.generateCellMarkup(P,P.cellStyles,P.cellClasses,!1),!this.grid.editable&&P.editable&&(this.grid.editable=!0)},generateHtml:function(t,p){t=this.getTableArray();var G=this.view.structure.cells,T=this.grid.getItem(p);l.fire(this.view,"onBeforeRow",[p,G]);for(var D=0,P;P=G[D];D++)if(!P.hidden&&!P.header){t.push(P.invisible?'\x3ctr class\x3d"dojoxGridInvisible"\x3e':"\x3ctr\x3e");for(var O=0,X,H,g;X=P[O];O++){H=X.markup;
var B=X.customClasses=[];g=X.customStyles=[];H[5]=X.format(p,T);H[1]=B.join(" ");H[3]=g.join(";");(B=X.textDir||this.grid.textDir)&&(H[3]+=this._getTextDirStyle(B,X,p));t.push.apply(t,H)}t.push("\x3c/tr\x3e")}t.push("\x3c/table\x3e");return t.join("")},decorateEvent:function(t){t.rowNode=this.findRowTarget(t.target);if(!t.rowNode)return!1;t.rowIndex=t.rowNode[d];this.baseDecorateEvent(t);t.cell=this.grid.getCell(t.cellIndex);return!0}});var L=w._HeaderBuilder=z.extend(function(t){this.moveable=null;
C.call(this,t)},C.prototype,{_skipBogusClicks:!1,overResizeWidth:4,minColWidth:1,update:function(){this.tableMap?this.tableMap.mapRows(this.view.structure.cells):this.tableMap=new w._TableMap(this.view.structure.cells)},generateHtml:function(t,p){var G,T=this.getTableArray(),D=this.view.structure.cells;l.fire(this.view,"onBeforeRow",[-1,D]);for(var P=0,O;O=D[P];P++)if(!O.hidden){T.push(O.invisible?'\x3ctr class\x3d"dojoxGridInvisible"\x3e':"\x3ctr\x3e");for(var X=0,H,g;H=O[X];X++)H.customClasses=
[],H.customStyles=[],this.view.simpleStructure&&(H.draggable&&(H.headerClasses?-1==H.headerClasses.indexOf("dojoDndItem")&&(H.headerClasses+=" dojoDndItem"):H.headerClasses="dojoDndItem"),H.attrs?-1==H.attrs.indexOf("dndType\x3d'gridColumn_")&&(H.attrs+=" dndType\x3d'gridColumn_"+this.grid.id+"'"):H.attrs="dndType\x3d'gridColumn_"+this.grid.id+"'"),g=this.generateCellMarkup(H,H.headerStyles,H.headerClasses,!0),g[5]=void 0!=p?p:t(H),g[3]=H.customStyles.join(";"),(G=H.textDir||this.grid.textDir)&&(g[3]+=
this._getTextDirStyle(G,H,p)),g[1]=H.customClasses.join(" "),T.push(g.join(""));T.push("\x3c/tr\x3e")}T.push("\x3c/table\x3e");return T.join("")},getCellX:function(t){var p=r("th");for(var G=t.target;G&&p(G);G=G.parentNode);(p=G)?(p=u.position(p),t=t.clientX-p.x):t=t.layerX;return t},decorateEvent:function(t){this.baseDecorateEvent(t);t.rowIndex=-1;t.cellX=this.getCellX(t);return!0},prepareResize:function(t,p){do{var G=t.cellIndex;t.cellNode=G?t.cellNode.parentNode.cells[G+p]:null;t.cellIndex=t.cellNode?
this.getCellNodeIndex(t.cellNode):-1}while(t.cellNode&&"none"==t.cellNode.style.display);return!!t.cellNode},canResize:function(t){if(!t.cellNode||1<t.cellNode.colSpan)return!1;t=this.grid.getCell(t.cellIndex);return!t.noresize&&t.canResize()},overLeftResizeArea:function(t){if(b.hasClass(y.body(),"dojoDndMove"))return!1;if(c("ie")){var p=t.target;if(b.hasClass(p,"dojoxGridArrowButtonNode")||b.hasClass(p,"dojoxGridArrowButtonChar")||b.hasClass(p,"dojoxGridColCaption"))return!1}return this.grid.isLeftToRight()?
0<t.cellIndex&&0<t.cellX&&t.cellX<this.overResizeWidth&&this.prepareResize(t,-1):t.cellNode&&0<t.cellX&&t.cellX<this.overResizeWidth},overRightResizeArea:function(t){if(b.hasClass(y.body(),"dojoDndMove"))return!1;if(c("ie")){var p=t.target;if(b.hasClass(p,"dojoxGridArrowButtonNode")||b.hasClass(p,"dojoxGridArrowButtonChar")||b.hasClass(p,"dojoxGridColCaption"))return!1}return this.grid.isLeftToRight()?t.cellNode&&t.cellX>=t.cellNode.offsetWidth-this.overResizeWidth:0<t.cellIndex&&t.cellX>=t.cellNode.offsetWidth-
this.overResizeWidth&&this.prepareResize(t,-1)},domousemove:function(t){if(!this.moveable){var p=this.overRightResizeArea(t)?"dojoxGridColResize":this.overLeftResizeArea(t)?"dojoxGridColResize":"";p&&!this.canResize(t)&&(p="dojoxGridColNoResize");b.toggleClass(t.sourceView.headerNode,"dojoxGridColNoResize","dojoxGridColNoResize"==p);b.toggleClass(t.sourceView.headerNode,"dojoxGridColResize","dojoxGridColResize"==p);p&&m.stop(t)}},domousedown:function(t){this.moveable||((this.overRightResizeArea(t)||
this.overLeftResizeArea(t))&&this.canResize(t)?this.beginColumnResize(t):(this.grid.onMouseDown(t),this.grid.onMouseOverRow(t)))},doclick:function(t){return this._skipBogusClicks?(m.stop(t),!0):!1},colResizeSetup:function(t,p){var G=b.contentBox(t.sourceView.headerNode);if(p){this.lineDiv=document.createElement("div");p=b.position(t.sourceView.headerNode,!0);var T=b.contentBox(t.sourceView.domNode),D=t.pageX;!this.grid.isLeftToRight()&&8>c("ie")&&(D-=n.getScrollbar().w);b.style(this.lineDiv,{top:p.y+
"px",left:D+"px",height:T.h+G.h+"px"});b.addClass(this.lineDiv,"dojoxGridResizeColLine");this.lineDiv._origLeft=D;y.body().appendChild(this.lineDiv)}p=[];T=this.tableMap.findOverlappingNodes(t.cellNode);D=0;for(var P;P=T[D];D++)p.push({node:P,index:this.getCellNodeIndex(P),width:P.offsetWidth});T=t.sourceView;P=this.grid.isLeftToRight()?1:-1;var O=t.grid.views.views;D=[];for(var X=T.idx+P,H;H=O[X];X+=P)D.push({node:H.headerNode,left:window.parseInt(H.headerNode.style.left)});P=T.headerContentNode.firstChild;
return{scrollLeft:t.sourceView.headerNode.scrollLeft,view:T,node:t.cellNode,index:t.cellIndex,w:b.contentBox(t.cellNode).w,vw:G.w,table:P,tw:b.contentBox(P).w,spanners:p,followers:D}},beginColumnResize:function(t){this.moverDiv=document.createElement("div");b.style(this.moverDiv,{position:"absolute",left:0});y.body().appendChild(this.moverDiv);b.addClass(this.grid.domNode,"dojoxGridColumnResizing");var p=this.moveable=new a(this.moverDiv),G=this.colResizeSetup(t,!0);p.onMove=z.hitch(this,"doResizeColumn",
G);f.connect(p,"onMoveStop",z.hitch(this,function(){this.endResizeColumn(G);G.node.releaseCapture&&G.node.releaseCapture();this.moveable.destroy();delete this.moveable;this.moveable=null;b.removeClass(this.grid.domNode,"dojoxGridColumnResizing")}));t.cellNode.setCapture&&t.cellNode.setCapture();p.onMouseDown(t)},doResizeColumn:function(t,p,G){var T=G.l;T={deltaX:T,w:t.w+(this.grid.isLeftToRight()?T:-T),vw:t.vw+T,tw:t.tw+T};this.dragRecord={inDrag:t,mover:p,leftTop:G};T.w>=this.minColWidth&&(p?b.style(this.lineDiv,
"left",this.lineDiv._origLeft+T.deltaX+"px"):this.doResizeNow(t,T))},endResizeColumn:function(t){if(this.dragRecord){var p=this.dragRecord.leftTop;p=this.grid.isLeftToRight()?p.l:-p.l;p+=Math.max(t.w+p,this.minColWidth)-(t.w+p);c("webkit")&&t.spanners.length&&(p+=b._getPadBorderExtents(t.spanners[0].node).w);this.doResizeNow(t,{deltaX:p,w:t.w+p,vw:t.vw+p,tw:t.tw+p});delete this.dragRecord}b.destroy(this.lineDiv);b.destroy(this.moverDiv);b.destroy(this.moverDiv);delete this.moverDiv;this._skipBogusClicks=
!0;t.view.update();this._skipBogusClicks=!1;this.grid.onResizeColumn(t.index)},doResizeNow:function(t,p){t.view.convertColPctToFixed();if(t.view.flexCells&&!t.view.testFlexCells()){var G=h(t.node);G&&(G.style.width="")}var T;for(G=0;T=t.spanners[G];G++){var D=T.width+p.deltaX;0<D&&(T.node.style.width=D+"px",t.view.setColWidth(T.index,D))}if(this.grid.isLeftToRight()||!c("ie"))for(G=0;T=t.followers[G];G++)D=T.left+p.deltaX,T.node.style.left=D+"px";t.node.style.width=p.w+"px";t.view.setColWidth(t.index,
p.w);t.view.headerNode.style.width=p.vw+"px";t.view.setColumnsWidth(p.tw);this.grid.isLeftToRight()||(t.view.headerNode.scrollLeft=t.scrollLeft+p.deltaX)}});w._TableMap=z.extend(function(t){this.mapRows(t)},{map:null,mapRows:function(t){if(t.length){this.map=[];for(var p,G=0;p=t[G];G++)this.map[G]=[];for(G=0;p=t[G];G++)for(var T=0,D=0,P,O;P=p[T];T++){for(;this.map[G][D];)D++;this.map[G][D]={c:T,r:G};O=P.rowSpan||1;P=P.colSpan||1;for(var X=0;X<O;X++)for(var H=0;H<P;H++)this.map[G+X][D+H]=this.map[G][D];
D+=P}}},dumpMap:function(){for(var t=0,p;p=this.map[t];t++)for(var G=0;p[G];G++);},getMapCoords:function(t,p){for(var G=0,T;T=this.map[G];G++)for(var D=0,P;P=T[D];D++)if(P.c==p&&P.r==t)return{j:G,i:D};return{j:-1,i:-1}},getNode:function(t,p,G){return(t=t&&t.rows[p])&&t.cells[G]},_findOverlappingNodes:function(t,p,G){var T=[];p=this.getMapCoords(p,G);G=0;for(var D;D=this.map[G];G++)G!=p.j&&(D=(D=D[p.i])?this.getNode(t,D.r,D.c):null)&&T.push(D);return T},findOverlappingNodes:function(t){return this._findOverlappingNodes(h(t),
e(t.parentNode),0<=t.cellIndex?t.cellIndex:v.indexOf(t.parentNode.cells,t))}});return{_Builder:C,_HeaderBuilder:L,_ContentBuilder:N}})},"dojox/grid/_ViewManager":function(){define(["dojo/_base/declare","dojo/_base/sniff","dojo/dom-class"],function(N,v,z){return N("dojox.grid._ViewManager",null,{constructor:function(y){this.grid=y},defaultWidth:200,views:[],resize:function(){this.onEach("resize")},render:function(){this.onEach("render")},addView:function(y){y.idx=this.views.length;this.views.push(y)},
destroyViews:function(){for(var y=0,m;m=this.views[y];y++)m.destroy();this.views=[]},getContentNodes:function(){for(var y=[],m=0,c;c=this.views[m];m++)y.push(c.contentNode);return y},forEach:function(y){for(var m=0,c;c=this.views[m];m++)y(c,m)},onEach:function(y,m){m=m||[];for(var c=0,f;f=this.views[c];c++)y in f&&f[y].apply(f,m)},normalizeHeaderNodeHeight:function(){for(var y=[],m=0,c;c=this.views[m];m++)c.headerContentNode.firstChild&&y.push(c.headerContentNode);this.normalizeRowNodeHeights(y)},
normalizeRowNodeHeights:function(y){var m=0,c=[];if(this.grid.rowHeight)m=this.grid.rowHeight;else{if(1>=y.length)return;for(var f=0,a;a=y[f];f++)z.contains(a,"dojoxGridNonNormalizedCell")||(c[f]=a.firstChild.offsetHeight,m=Math.max(m,c[f]));m=0<=m?m:0;(v("mozilla")||8<v("ie"))&&m&&m++}for(f=0;a=y[f];f++)c[f]!=m&&(a.firstChild.style.height=m+"px")},resetHeaderNodeHeight:function(){for(var y=0,m;m=this.views[y];y++)if(m=m.headerContentNode.firstChild)m.style.height=""},renormalizeRow:function(y){for(var m=
[],c=0,f,a;(f=this.views[c])&&(a=f.getRowNode(y));c++)a.firstChild.style.height="",m.push(a);this.normalizeRowNodeHeights(m)},getViewWidth:function(y){return this.views[y].getWidth()||this.defaultWidth},measureHeader:function(){this.resetHeaderNodeHeight();this.forEach(function(m){m.headerContentNode.style.height=""});var y=0;this.forEach(function(m){y=Math.max(m.headerNode.offsetHeight,y)});return y},measureContent:function(){var y=0;this.forEach(function(m){y=Math.max(m.domNode.offsetHeight,y)});
return y},findClient:function(y){y=this.grid.elasticView||-1;if(0>y)for(var m=1,c;c=this.views[m];m++)if(c.viewWidth){for(m=1;c=this.views[m];m++)if(!c.viewWidth){y=m;break}break}0>y&&(y=Math.floor(this.views.length/2));return y},arrange:function(y,m){var c,f,a=this.views.length,n=this,l=0>=m?a:this.findClient(),b=function(e,q){var h=e.domNode.style,r=e.headerNode.style;n.grid.isLeftToRight()?(h.left=q+"px",r.left=q+"px"):(h.right=q+"px",4>v("ff")?r.right=q+e.getScrollbarWidth()+"px":r.right=q+"px",
v("webkit")||"auto"==r.width||(r.width=parseInt(r.width,10)-e.getScrollbarWidth()+"px"));h.top="0px";r.top=0};for(c=0;(f=this.views[c])&&c<l;c++){var u=this.getViewWidth(c);f.setSize(u,0);b(f,y);u=f.headerContentNode&&f.headerContentNode.firstChild?f.getColumnsWidth()+f.getScrollbarWidth():f.domNode.offsetWidth;y+=u}c++;for(var w=a-1;(f=this.views[w])&&c<=w;w--)u=this.getViewWidth(w),f.setSize(u,0),u=f.domNode.offsetWidth,m-=u,b(f,m);l<a&&(f=this.views[l],u=Math.max(1,m-y),f.setSize(u+"px",0),b(f,
y));return y},renderRow:function(y,m,c){for(var f=[],a=0,n,l;(n=this.views[a])&&(l=m[a]);a++)n=n.renderRow(y),l.appendChild(n),f.push(n);c||this.normalizeRowNodeHeights(f)},rowRemoved:function(y){this.onEach("rowRemoved",[y])},updateRow:function(y,m){for(var c=0,f;f=this.views[c];c++)f.updateRow(y);m||this.renormalizeRow(y)},updateRowStyles:function(y){this.onEach("updateRowStyles",[y])},setScrollTop:function(y){for(var m=y,c=0,f;f=this.views[c];c++)m=f.setScrollTop(y),v("ie")&&f.headerNode&&f.scrollboxNode&&
(f.headerNode.scrollLeft=f.scrollboxNode.scrollLeft);return m},getFirstScrollingView:function(){for(var y=0,m;m=this.views[y];y++)if(m.hasHScrollbar()||m.hasVScrollbar())return m;return null}})})},"dojox/grid/_RowManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class"],function(N,v,z){return N("dojox.grid._RowManager",null,{constructor:function(y){this.grid=y},linesToEms:2,overRow:-2,prepareStylingRow:function(y,m){return{index:y,node:m,odd:!!(y&1),selected:!!this.grid.selection.isSelected(y),
over:this.isOver(y),customStyles:"",customClasses:"dojoxGridRow"}},styleRowNode:function(y,m){y=this.prepareStylingRow(y,m);this.grid.onStyleRow(y);this.applyStyles(y)},applyStyles:function(y){y.node.className=y.customClasses;var m=y.node.style.height,c=y.node,f=y.customStyles+";"+(y.node._style||"");void 0==c.style.cssText?c.setAttribute("style",f):c.style.cssText=f;y.node.style.height=m},updateStyles:function(y){this.grid.updateRowStyles(y)},setOverRow:function(y){var m=this.overRow;this.overRow=
y;m!=this.overRow&&(v.isString(m)||0<=m)&&this.updateStyles(m);this.updateStyles(this.overRow)},isOver:function(y){return this.overRow==y&&!z.contains(this.grid.domNode,"dojoxGridColumnResizing")}})})},"dojox/grid/_FocusManager":function(){define("dojo/_base/array dojo/_base/lang dojo/_base/declare dojo/_base/connect dojo/_base/event dojo/_base/sniff dojo/query ./util dojo/_base/html".split(" "),function(N,v,z,y,m,c,f,a,n){return z("dojox.grid._FocusManager",null,{constructor:function(l){this.grid=
l;this.cell=null;this.rowIndex=-1;this._connects=[];this._headerConnects=[];this.headerMenu=this.grid.headerMenu;this._connects.push(y.connect(this.grid.domNode,"onfocus",this,"doFocus"));this._connects.push(y.connect(this.grid.domNode,"onblur",this,"doBlur"));this._connects.push(y.connect(this.grid.domNode,"mousedown",this,"_mouseDown"));this._connects.push(y.connect(this.grid.domNode,"mouseup",this,"_mouseUp"));this._connects.push(y.connect(this.grid.domNode,"oncontextmenu",this,"doContextMenu"));
this._connects.push(y.connect(this.grid.lastFocusNode,"onfocus",this,"doLastNodeFocus"));this._connects.push(y.connect(this.grid.lastFocusNode,"onblur",this,"doLastNodeBlur"));this._connects.push(y.connect(this.grid,"_onFetchComplete",this,"_delayedCellFocus"));this._connects.push(y.connect(this.grid,"postrender",this,"_delayedHeaderFocus"))},destroy:function(){N.forEach(this._connects,y.disconnect);N.forEach(this._headerConnects,y.disconnect);delete this.grid;delete this.cell},_colHeadNode:null,
_colHeadFocusIdx:null,_contextMenuBindNode:null,tabbingOut:!1,focusClass:"dojoxGridCellFocus",focusView:null,initFocusView:function(){this.focusView=this.grid.views.getFirstScrollingView()||this.focusView||this.grid.views.views[0];this._initColumnHeaders()},isFocusCell:function(l,b){return this.cell==l&&this.rowIndex==b},isLastFocusCell:function(){return this.cell?this.rowIndex==this.grid.rowCount-1&&this.cell.index==this.grid.layout.cellCount-1:!1},isFirstFocusCell:function(){return this.cell?0===
this.rowIndex&&0===this.cell.index:!1},isNoFocusCell:function(){return 0>this.rowIndex||!this.cell},isNavHeader:function(){return!!this._colHeadNode},getHeaderIndex:function(){return this._colHeadNode?N.indexOf(this._findHeaderCells(),this._colHeadNode):-1},_focusifyCellNode:function(l){var b=this.cell&&this.cell.getNode(this.rowIndex);if(b&&(n.toggleClass(b,this.focusClass,l),l)){l=this.scrollIntoView();try{if(c("webkit")||!this.grid.edit.isEditing())a.fire(b,"focus"),l&&(this.cell.view.scrollboxNode.scrollLeft=
l)}catch(u){}}},_delayedCellFocus:function(){if(!this.isNavHeader()&&this.grid.focused){var l=this.cell&&this.cell.getNode(this.rowIndex);if(l)try{this.grid.edit.isEditing()||(n.toggleClass(l,this.focusClass,!0),this._colHeadNode&&this.blurHeader(),a.fire(l,"focus"))}catch(b){}}},_delayedHeaderFocus:function(){this.isNavHeader()&&this.focusHeader()},_initColumnHeaders:function(){N.forEach(this._headerConnects,y.disconnect);this._headerConnects=[];for(var l=this._findHeaderCells(),b=0;b<l.length;b++)this._headerConnects.push(y.connect(l[b],
"onfocus",this,"doColHeaderFocus")),this._headerConnects.push(y.connect(l[b],"onblur",this,"doColHeaderBlur"))},_findHeaderCells:function(){for(var l=f("th",this.grid.viewsHeaderNode),b=[],u=0;u<l.length;u++){var w=l[u],e=n.hasAttr(w,"tabIndex"),q=n.attr(w,"tabIndex");e&&0>q&&b.push(w)}return b},_setActiveColHeader:function(l,b,u){this.grid.domNode.setAttribute("aria-activedescendant",l.id);null!=u&&0<=u&&u!=b&&n.toggleClass(this._findHeaderCells()[u],this.focusClass,!1);n.toggleClass(l,this.focusClass,
!0);this._colHeadNode=l;this._colHeadFocusIdx=b;this._scrollHeader(this._colHeadFocusIdx)},scrollIntoView:function(){var l=this.cell?this._scrollInfo(this.cell):null;if(!l||!l.s)return null;var b=this.grid.scroller.findScrollTop(this.rowIndex);l.n&&l.sr&&(l.n.offsetLeft+l.n.offsetWidth>l.sr.l+l.sr.w?l.s.scrollLeft=l.n.offsetLeft+l.n.offsetWidth-l.sr.w:l.n.offsetLeft<l.sr.l&&(l.s.scrollLeft=l.n.offsetLeft));l.r&&l.sr&&(b+l.r.offsetHeight>l.sr.t+l.sr.h?this.grid.setScrollTop(b+l.r.offsetHeight-l.sr.h):
b<l.sr.t&&this.grid.setScrollTop(b));return l.s.scrollLeft},_scrollInfo:function(l,b){if(l){var u=l.view.scrollboxNode,w={w:u.clientWidth,l:u.scrollLeft,t:u.scrollTop,h:u.clientHeight},e=l.view.getRowNode(this.rowIndex);return{c:l,s:u,sr:w,n:b?b:l.getNode(this.rowIndex),r:e}}return null},_scrollHeader:function(l){var b=null;if(this._colHeadNode){var u=this.grid.getCell(l);if(!u)return;b=this._scrollInfo(u,u.getNode(0))}b&&b.s&&b.sr&&b.n&&(b.n.offsetLeft+b.n.offsetWidth>b.sr.l+b.sr.w?b.s.scrollLeft=
b.n.offsetLeft+b.n.offsetWidth-b.sr.w:b.n.offsetLeft<b.sr.l?b.s.scrollLeft=b.n.offsetLeft:7>=c("ie")&&u&&u.view.headerNode&&(u.view.headerNode.scrollLeft=b.s.scrollLeft))},_isHeaderHidden:function(){var l=this.focusView;if(!l)for(var b=0,u;u=this.grid.views.views[b];b++)if(u.headerNode){l=u;break}return l&&"none"==n.getComputedStyle(l.headerNode).display},colSizeAdjust:function(l,b,u){var w=this._findHeaderCells(),e=this.focusView;if(!e||!e.header.tableMap.map)for(var q=0,h;h=this.grid.views.views[q];q++)if(h.header.tableMap.map){e=
h;break}q=w[b];!e||b==w.length-1&&0===b||(e.content.baseDecorateEvent(l),l.cellNode=q,l.cellIndex=e.content.getCellNodeIndex(l.cellNode),l.cell=0<=l.cellIndex?this.grid.getCell(l.cellIndex):null,e.header.canResize(l)&&(b={l:u},l=e.header.colResizeSetup(l,!1),e.header.doResizeColumn(l,null,b),e.update()))},styleRow:function(l){},setFocusIndex:function(l,b){this.setFocusCell(this.grid.getCell(b),l)},setFocusCell:function(l,b){l&&!this.isFocusCell(l,b)&&(this.tabbingOut=!1,this._colHeadNode&&this.blurHeader(),
this._colHeadNode=this._colHeadFocusIdx=null,this.focusGridView(),this._focusifyCellNode(!1),this.cell=l,this.rowIndex=b,this._focusifyCellNode(!0));if(c("opera"))setTimeout(v.hitch(this.grid,"onCellFocus",this.cell,this.rowIndex),1);else this.grid.onCellFocus(this.cell,this.rowIndex)},next:function(){if(this.cell){var l=this.rowIndex,b=this.cell.index+1,u=this.grid.layout.cellCount-1,w=this.grid.rowCount-1;b>u&&(b=0,l++);l>w&&(b=u,l=w);if(this.grid.edit.isEditing()&&(u=this.grid.getCell(b),!this.isLastFocusCell()&&
(!u.editable||this.grid.canEdit&&!this.grid.canEdit(u,l)))){this.cell=u;this.rowIndex=l;this.next();return}this.setFocusIndex(l,b)}},previous:function(){if(this.cell){var l=this.rowIndex||0,b=(this.cell.index||0)-1;0>b&&(b=this.grid.layout.cellCount-1,l--);0>l&&(b=l=0);if(this.grid.edit.isEditing()){var u=this.grid.getCell(b);if(!this.isFirstFocusCell()&&!u.editable){this.cell=u;this.rowIndex=l;this.previous();return}}this.setFocusIndex(l,b)}},move:function(l,b){var u=0>b?-1:1;if(this.isNavHeader()){l=
this._findHeaderCells();var w=currentIdx=N.indexOf(l,this._colHeadNode);for(currentIdx+=b;0<=currentIdx&&currentIdx<l.length&&"none"==l[currentIdx].style.display;)currentIdx+=u;0<=currentIdx&&currentIdx<l.length&&this._setActiveColHeader(l[currentIdx],currentIdx,w)}else if(this.cell){var e=this.grid.scroller;w=this.rowIndex;var q=this.grid.rowCount-1,h=Math.min(q,Math.max(0,w+l));l&&(0<l?h>e.getLastPageRow(e.page)&&this.grid.setScrollTop(this.grid.scrollTop+e.findScrollTop(h)-e.findScrollTop(w)):
0>l&&h<=e.getPageRow(e.page)&&this.grid.setScrollTop(this.grid.scrollTop-e.findScrollTop(w)-e.findScrollTop(h)));e=this.grid.layout.cellCount-1;for(var r=this.cell.index,d=Math.min(e,Math.max(0,r+b)),x=this.grid.getCell(d);0<=d&&d<e&&x&&!0===x.hidden;)d+=u,x=this.grid.getCell(d);x&&!0!==x.hidden||(d=r);u=x.getNode(h);!u&&l?0<=h+l&&h+l<=q&&this.move(0<l?++l:--l,b):u&&"none"!==n.style(u,"display")||!b?(this.setFocusIndex(h,d),l&&this.grid.updateRow(w)):0<=d+b&&d+b<=e&&this.move(l,0<b?++b:--b)}},previousKey:function(l){this.grid.edit.isEditing()?
(m.stop(l),this.previous()):this.isNavHeader()||this._isHeaderHidden()?(this.tabOut(this.grid.domNode),null!=this._colHeadFocusIdx&&(n.toggleClass(this._findHeaderCells()[this._colHeadFocusIdx],this.focusClass,!1),this._colHeadFocusIdx=null),this._focusifyCellNode(!1)):(this.grid.domNode.focus(),m.stop(l))},nextKey:function(l){l.target===this.grid.domNode&&null==this._colHeadFocusIdx?(this.focusHeader(),m.stop(l)):this.isNavHeader()?(this.blurHeader(),this.findAndFocusGridCell()||this.tabOut(this.grid.lastFocusNode),
this._colHeadNode=this._colHeadFocusIdx=null):this.grid.edit.isEditing()?(m.stop(l),this.next()):this.tabOut(this.grid.lastFocusNode)},tabOut:function(l){this.tabbingOut=!0;l.focus()},focusGridView:function(){a.fire(this.focusView,"focus")},focusGrid:function(l){this.focusGridView();this._focusifyCellNode(!0)},findAndFocusGridCell:function(){var l=!0,b=0===this.grid.rowCount;this.isNoFocusCell()&&!b?(b=0,this.grid.getCell(b).hidden&&(b=this.isNavHeader()?this._colHeadFocusIdx:0),this.setFocusIndex(0,
b)):this.cell&&!b?(this.focusView&&!this.focusView.rowNodes[this.rowIndex]&&this.grid.scrollToRow(this.rowIndex),this.focusGrid()):l=!1;this._colHeadNode=this._colHeadFocusIdx=null;return l},focusHeader:function(){var l=this._findHeaderCells(),b=this._colHeadFocusIdx;this._isHeaderHidden()?this.findAndFocusGridCell():this._colHeadFocusIdx||(this.isNoFocusCell()?this._colHeadFocusIdx=0:this._colHeadFocusIdx=this.cell.index);for(this._colHeadNode=l[this._colHeadFocusIdx];this._colHeadNode&&0<=this._colHeadFocusIdx&&
this._colHeadFocusIdx<l.length&&"none"==this._colHeadNode.style.display;)this._colHeadFocusIdx++,this._colHeadNode=l[this._colHeadFocusIdx];this._colHeadNode&&"none"!=this._colHeadNode.style.display?(this.headerMenu&&this._contextMenuBindNode!=this.grid.domNode&&(this.headerMenu.unBindDomNode(this.grid.viewsHeaderNode),this.headerMenu.bindDomNode(this.grid.domNode),this._contextMenuBindNode=this.grid.domNode),this._setActiveColHeader(this._colHeadNode,this._colHeadFocusIdx,b),this._scrollHeader(this._colHeadFocusIdx),
this._focusifyCellNode(!1)):this.findAndFocusGridCell()},blurHeader:function(){n.removeClass(this._colHeadNode,this.focusClass);n.removeAttr(this.grid.domNode,"aria-activedescendant");if(this.headerMenu&&this._contextMenuBindNode==this.grid.domNode){var l=this.grid.viewsHeaderNode;this.headerMenu.unBindDomNode(this.grid.domNode);this.headerMenu.bindDomNode(l);this._contextMenuBindNode=l}},doFocus:function(l){l&&l.target!=l.currentTarget?m.stop(l):this._clickFocus||(this.tabbingOut||this.focusHeader(),
this.tabbingOut=!1,m.stop(l))},doBlur:function(l){m.stop(l)},doContextMenu:function(l){this.headerMenu||m.stop(l)},doLastNodeFocus:function(l){this.tabbingOut?this._focusifyCellNode(!1):0<this.grid.rowCount?(this.isNoFocusCell()&&this.setFocusIndex(0,0),this._focusifyCellNode(!0)):this.focusHeader();this.tabbingOut=!1;m.stop(l)},doLastNodeBlur:function(l){m.stop(l)},doColHeaderFocus:function(l){this._setActiveColHeader(l.target,n.attr(l.target,"idx"),this._colHeadFocusIdx);this._scrollHeader(this.getHeaderIndex());
m.stop(l)},doColHeaderBlur:function(l){n.toggleClass(l.target,this.focusClass,!1)},_mouseDown:function(l){this._clickFocus=dojo.some(this.grid.views.views,function(b){return b.scrollboxNode===l.target})},_mouseUp:function(l){this._clickFocus=!1}})})},"dojox/grid/_EditManager":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/_base/connect dojo/_base/sniff ./util".split(" "),function(N,v,z,y,m,c){return z("dojox.grid._EditManager",null,{constructor:function(f){this.grid=f;
this.connections=m("ie")?[y.connect(document.body,"onfocus",N.hitch(this,"_boomerangFocus"))]:[];this.connections.push(y.connect(this.grid,"onBlur",this,"apply"));this.connections.push(y.connect(this.grid,"prerender",this,"_onPreRender"))},info:{},destroy:function(){v.forEach(this.connections,y.disconnect)},cellFocus:function(f,a){this.grid.singleClickEdit||this.isEditRow(a)?this.setEditCell(f,a):this.apply();(this.isEditing()||f&&f.editable&&f.alwaysEditing)&&this._focusEditor(f,a)},rowClick:function(f){this.isEditing()&&
!this.isEditRow(f.rowIndex)&&this.apply()},styleRow:function(f){f.index==this.info.rowIndex&&(f.customClasses+=" dojoxGridRowEditing")},dispatchEvent:function(f){var a=f.cell;return(a=a&&a.editable?a:0)&&a.dispatchEvent(f.dispatch,f)},isEditing:function(){return void 0!==this.info.rowIndex},isEditCell:function(f,a){return this.info.rowIndex===f&&this.info.cell.index==a},isEditRow:function(f){return this.info.rowIndex===f},setEditCell:function(f,a){!this.isEditCell(a,f.index)&&this.grid.canEdit&&this.grid.canEdit(f,
a)&&this.start(f,a,this.isEditRow(a)||f.editable)},_focusEditor:function(f,a){c.fire(f,"focus",[a])},focusEditor:function(){this.isEditing()&&this._focusEditor(this.info.cell,this.info.rowIndex)},_boomerangWindow:500,_shouldCatchBoomerang:function(){return this._catchBoomerang>(new Date).getTime()},_boomerangFocus:function(){this._shouldCatchBoomerang()&&(this.grid.focus.focusGrid(),this.focusEditor(),this._catchBoomerang=0)},_doCatchBoomerang:function(){m("ie")&&(this._catchBoomerang=(new Date).getTime()+
this._boomerangWindow)},start:function(f,a,n){this._isValidInput()&&(this.grid.beginUpdate(),this.editorApply(),this.isEditing()&&!this.isEditRow(a)&&(this.applyRowEdit(),this.grid.updateRow(a)),n?(this.info={cell:f,rowIndex:a},this.grid.doStartEdit(f,a),this.grid.updateRow(a)):this.info={},this.grid.endUpdate(),this.grid.focus.focusGrid(),this._focusEditor(f,a),this._doCatchBoomerang())},_editorDo:function(f){var a=this.info.cell;if(a&&a.editable)a[f](this.info.rowIndex)},editorApply:function(){this._editorDo("apply")},
editorCancel:function(){this._editorDo("cancel")},applyCellEdit:function(f,a,n){this.grid.canEdit(a,n)&&this.grid.doApplyCellEdit(f,n,a.field)},applyRowEdit:function(){this.grid.doApplyEdit(this.info.rowIndex,this.info.cell.field)},apply:function(){this.isEditing()&&this._isValidInput()&&(this.grid.beginUpdate(),this.editorApply(),this.applyRowEdit(),this.info={},this.grid.endUpdate(),this.grid.focus.focusGrid(),this._doCatchBoomerang())},cancel:function(){this.isEditing()&&(this.grid.beginUpdate(),
this.editorCancel(),this.info={},this.grid.endUpdate(),this.grid.focus.focusGrid(),this._doCatchBoomerang())},save:function(f,a){var n=this.info.cell;!this.isEditRow(f)||a&&n.view!=a||!n.editable||n.save(n,this.info.rowIndex)},restore:function(f,a){var n=this.info.cell;this.isEditRow(a)&&n.view==f&&n.editable&&n.restore(this.info.rowIndex)},_isValidInput:function(){var f=(this.info.cell||{}).widget;if(!f||!f.isValid)return!0;f.focused=!0;return f.isValid(!0)},_onPreRender:function(){this.isEditing()&&
(this.info.value=this.info.cell.getValue())}})})},"dojox/grid/Selection":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/dom-attr"],function(N,v,z,y){return N("dojox.grid.Selection",null,{constructor:function(m){this.grid=m;this.selected=[];this.setMode(m.selectionMode)},mode:"extended",selected:null,updating:0,selectedIndex:-1,rangeStartIndex:-1,setMode:function(m){this.selected.length&&this.deselectAll();this.mode="extended"!=m&&"multiple"!=m&&"single"!=m&&"none"!=
m?"extended":m},onCanSelect:function(m){return this.grid.onCanSelect(m)},onCanDeselect:function(m){return this.grid.onCanDeselect(m)},onSelected:function(m){},onDeselected:function(m){},onChanging:function(){},onChanged:function(){},isSelected:function(m){return"none"==this.mode?!1:this.selected[m]},getFirstSelected:function(){if(!this.selected.length||"none"==this.mode)return-1;for(var m=0,c=this.selected.length;m<c;m++)if(this.selected[m])return m;return-1},getNextSelected:function(m){if("none"==
this.mode)return-1;m+=1;for(var c=this.selected.length;m<c;m++)if(this.selected[m])return m;return-1},getSelected:function(){for(var m=[],c=0,f=this.selected.length;c<f;c++)this.selected[c]&&m.push(c);return m},getSelectedCount:function(){for(var m=0,c=0;c<this.selected.length;c++)this.selected[c]&&m++;return m},_beginUpdate:function(){if(0===this.updating)this.onChanging();this.updating++},_endUpdate:function(){this.updating--;if(0===this.updating)this.onChanged()},select:function(m){"none"!=this.mode&&
("multiple"!=this.mode?(this.deselectAll(m),this.addToSelection(m)):this.toggleSelect(m))},addToSelection:function(m){if("none"!=this.mode)if(z.isArray(m))v.forEach(m,this.addToSelection,this);else if(m=Number(m),this.selected[m])this.selectedIndex=m;else if(!1!==this.onCanSelect(m)){this.selectedIndex=m;var c=this.grid.getRowNode(m);c&&y.set(c,"aria-selected","true");this._beginUpdate();this.selected[m]=!0;this.onSelected(m);this._endUpdate()}},deselect:function(m){if("none"!=this.mode)if(z.isArray(m))v.forEach(m,
this.deselect,this);else if(m=Number(m),this.selectedIndex==m&&(this.selectedIndex=-1),this.selected[m]&&!1!==this.onCanDeselect(m)){var c=this.grid.getRowNode(m);c&&y.set(c,"aria-selected","false");this._beginUpdate();delete this.selected[m];this.onDeselected(m);this._endUpdate()}},setSelected:function(m,c){this[c?"addToSelection":"deselect"](m)},toggleSelect:function(m){z.isArray(m)?v.forEach(m,this.toggleSelect,this):this.setSelected(m,!this.selected[m])},_range:function(m,c,f){var a=0<=m?m:c;
m=c;a>m&&(m=a,a=c);for(c=a;c<=m;c++)f(c)},selectRange:function(m,c){this._range(m,c,z.hitch(this,"addToSelection"))},deselectRange:function(m,c){this._range(m,c,z.hitch(this,"deselect"))},insert:function(m){this.selected.splice(m,0,!1);this.selectedIndex>=m&&this.selectedIndex++},remove:function(m){this.selected.splice(m,1);this.selectedIndex>=m&&this.selectedIndex--},deselectAll:function(m){for(var c in this.selected)c!=m&&!0===this.selected[c]&&this.deselect(c)},clickSelect:function(m,c,f){if("none"!=
this.mode){this._beginUpdate();if("extended"!=this.mode)this.select(m);else{if(!f||0>this.rangeStartIndex)this.rangeStartIndex=m;c||this.deselectAll(m);f?this.selectRange(this.rangeStartIndex,m):c?this.toggleSelect(m):this.addToSelection(m)}this._endUpdate()}},clickSelectEvent:function(m){this.clickSelect(m.rowIndex,dojo.isCopyKey(m),m.shiftKey)},clear:function(){this._beginUpdate();this.deselectAll();this._endUpdate()}})})},"dojox/grid/DataSelection":function(){define(["dojo/_base/declare","./_SelectionPreserver",
"./Selection"],function(N,v,z){return N("dojox.grid.DataSelection",z,{constructor:function(y){y.keepSelection&&(this.preserver=new v(this))},destroy:function(){this.preserver&&this.preserver.destroy()},getFirstSelected:function(){var y=z.prototype.getFirstSelected.call(this);return-1==y?null:this.grid.getItem(y)},getNextSelected:function(y){y=this.grid.getItemIndex(y);y=z.prototype.getNextSelected.call(this,y);return-1==y?null:this.grid.getItem(y)},getSelected:function(){for(var y=[],m=0,c=this.selected.length;m<
c;m++)this.selected[m]&&y.push(this.grid.getItem(m));return y},addToSelection:function(y){if("none"!=this.mode){var m=null;m="number"==typeof y||"string"==typeof y?y:this.grid.getItemIndex(y);z.prototype.addToSelection.call(this,m)}},deselect:function(y){if("none"!=this.mode){var m=null;m="number"==typeof y||"string"==typeof y?y:this.grid.getItemIndex(y);z.prototype.deselect.call(this,m)}},deselectAll:function(y){var m=null;y||"number"==typeof y?(m="number"==typeof y||"string"==typeof y?y:this.grid.getItemIndex(y),
z.prototype.deselectAll.call(this,m)):this.inherited(arguments)}})})},"dojox/grid/_SelectionPreserver":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array"],function(N,v,z,y){return N("dojox.grid._SelectionPreserver",null,{constructor:function(m){this.selection=m;var c=this.grid=m.grid;this.reset();this._connects=[v.connect(c,"_setStore",this,"reset"),v.connect(c,"_addItem",this,"_reSelectById"),v.connect(m,"onSelected",z.hitch(this,"_selectById",!0)),
v.connect(m,"onDeselected",z.hitch(this,"_selectById",!1)),v.connect(m,"deselectAll",this,"reset")]},destroy:function(){this.reset();y.forEach(this._connects,v.disconnect);delete this._connects},reset:function(){this._selectedById={}},_reSelectById:function(m,c){m&&this.grid._hasIdentity&&(this.selection.selected[c]=this._selectedById[this.grid.store.getIdentity(m)])},_selectById:function(m,c){if("none"!=this.selection.mode&&this.grid._hasIdentity){var f=c,a=this.grid;if("number"==typeof c||"string"==
typeof c)f=(c=a._by_idx[c])&&c.item;f&&(this._selectedById[a.store.getIdentity(f)]=!!m);return f}}})})},"esri/dijit/editing/TemplatePickerItem":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/sniff dojo/dom-style dijit/_Widget dijit/_Templated dojox/gfx ../../symbols/jsonUtils ../../kernel".split(" "),function(N,v,z,y,m,c,f,a,n,l,b){N=N([f,a],{declaredClass:"esri.dijit.editing.TemplatePickerItem",templateString:"\x3cdiv class\x3d'item' style\x3d'text-align: center;'\x3e\x3cdiv class\x3d'itemSymbol' dojoAttachPoint\x3d'_surfaceNode'\x3e\x3c/div\x3e\x3cdiv class\x3d'itemLabel'\x3e${label}\x3c/div\x3e\x3c/div\x3e",
startup:function(){this._started||(this.inherited(arguments),this._surface=this._draw(this._surfaceNode,this.symbol,this.surfaceWidth,this.surfaceHeight,this.template))},_draw:function(u,w,e,q,h){if(w&&"textsymbol"!==w.type){u=n.createSurface(u,e,q);if(9>y("ie")){var r=u.getEventSource();c.set(r,"position","relative");c.set(r.parentNode,"position","relative")}w=!this.legendOverride&&this._getDrawingToolShape(w,h)||l.getShapeDescriptors(w);try{var d=u.createShape(w.defaultShape).setFill(w.fill).setStroke(w.stroke)}catch(L){u.clear();
u.destroy();return}var x=d.getBoundingBox();w=x.width;h=x.height;r=-(x.x+w/2);x=-(x.y+h/2);var C=u.getDimensions();r={dx:r+C.width/2,dy:x+C.height/2};if(w>e||h>q)x=w/e>h/q,e=((x?e:q)-5)/(x?w:h),v.mixin(r,{xx:e,yy:e});d.applyTransform(r);return u}},_getDrawingToolShape:function(u,w){switch(w?w.drawingTool||null:null){case "esriFeatureEditToolArrow":w={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};break;case "esriFeatureEditToolLeftArrow":w={type:"path",path:"M -15,1 L -8,8 L -8,5 L 10,5 L 10,-2 L -8,-2 L -8,-5 L -15,1 E"};
break;case "esriFeatureEditToolRightArrow":w={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};break;case "esriFeatureEditToolUpArrow":w={type:"path",path:"M 1,-10 L 8,-3 L 5,-3 L 5,15 L -2,15 L -2,-3 L -5,-3 L 1,-10 E"};break;case "esriFeatureEditToolDownArrow":w={type:"path",path:"M 1,15 L 8,8 L 5,8 L 5,-10 L -2,-10 L -2,8 L -5,8 L 1,15 E"};break;case "esriFeatureEditToolTriangle":w={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 E"};break;case "esriFeatureEditToolRectangle":w=
{type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 E"};break;case "esriFeatureEditToolCircle":w={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":w={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;case "esriFeatureEditToolFreehand":w="simplelinesymbol"===u.type||"cartographiclinesymbol"===u.type?{type:"path",path:"m -11, -7c-1.5,-3.75 7.25,-9.25 12.5,-7c5.25,2.25 6.75,9.75 3.75,12.75c-3,3 -3.25,2.5 -9.75,5.25c-6.5,2.75 -7.25,14.25 2,15.25c9.25,1 11.75,-4 13.25,-6.75c1.5,-2.75 3.5,-11.75 12,-6.5"}:
{type:"path",path:"M 10,-13 c3.1,0.16667 4.42564,2.09743 2.76923,3.69231c-2.61025,2.87179 -5.61025,5.6718 -6.14358,6.20513c-0.66667,0.93333 -0.46667,1.2 -0.53333,1.93333c-0.00001,0.86666 0.6,1.66667 1.13334,2c1.03077,0.38462 2.8,0.93333 3.38974,1.70769c0.47693,0.42564 0.87693,0.75897 1.41026,1.75897c0.13333,1.06667 -0.46667,2.86667 -1.8,3.8c-0.73333,0.73333 -3.86667,2.66666 -4.86667,3.13333c-0.93333,0.8 -7.4,3.2 -7.6,3.06667c-1.06667,0.46667 -4.73333,1.13334 -5.2,1.26667c-1.6,0.33334 -4.6,0.4 -6.25128,0.05128c-1.41539,-0.18462 -2.34872,-2.31796 -1.41539,-4.45129c0.93333,-1.73333 1.86667,-3.13333 2.64615,-3.85641c1.28718,-1.47692 2.57437,-2.68204 3.88718,-3.54359c0.88718,-1.13845 1.8,-1.33333 2.26666,-2.45641c0.33334,-0.74359 0.37949,-1.7641 0.06667,-2.87692c-0.66666,-1.46666 -1.66666,-1.86666 -2.98975,-2.2c-1.27692,-0.26666 -2.12307,-0.64102 -3.27692,-1.46666c-0.66667,-1.00001 -1.01538,-3.01539 0.73333,-4.06667c1.73333,-1.2 3.6,-1.93333 4.93333,-2.2c1.33333,-0.46667 4.84104,-1.09743 5.84103,-1.23076c1.60001,-0.46667 6.02564,-0.50257 7.29231,-0.56924z"};
break;default:return null}return{defaultShape:w,fill:u.getFill(),stroke:u.getStroke()}},_repaint:function(u){u?(u.getStroke&&u.setStroke&&u.setStroke(u.getStroke()),u.getFill&&u.setFill&&u.setFill(u.getFill()),u.children&&v.isArray(u.children)&&z.forEach(u.children,this._repaint,this)):this._surface=this._draw(this._surfaceNode,this.symbol,this.surfaceWidth,this.surfaceHeight,this.template)},destroy:function(){this._surface&&(this._surface.destroy(),delete this._surface);this.inherited(arguments)}});
y("extend-esri")&&v.setObject("dijit.editing.TemplatePickerItem",N,b);return N})},"widgets/Edit/utils":function(){define(["dojo/_base/lang","dojo/_base/array","jimu/utils"],function(N,v,z){function y(c,f){var a=null;c&&c.fields&&v.some(c.fields,function(n){if(n.name.toLowerCase()===f.toLowerCase())return a=n,!0});return a}function m(c,f,a){var n=null;if(c&&c.attributes)for(var l in c.attributes)if(c.attributes.hasOwnProperty(l)&&"function"!==typeof c.attributes[l]&&l.toLowerCase()===f.toLowerCase()){n=
a?c.attributes[l]=a:c.attributes[l];break}return n}return{getFieldInfosFromWebmap:function(c,f){var a=null;(c=f.getLayerInfoByTopLayerId(c))&&(c=c.getPopupInfo())&&c.fieldInfos&&(a=N.clone(c.fieldInfos));a&&v.forEach(a,function(n){n.format&&n.format.dateFormat&&(n.format.dateFormat.toLowerCase&&0>n.format.dateFormat.toLowerCase().indexOf("time")?n.format.time=!1:n.format.time=!0)});return a},getEditCapabilities:function(c,f,a){var n={};a=c.getEditCapabilities(a);n.canCreate=a.canCreate;n.canDelete=
a.canDelete;n.canUpdateGeometry=c.allowGeometryUpdates;f&&(n.canCreate=f.allowCreate&&n.canCreate,n.canDelete=f.allowDelete&&n.canDelete,n.canUpdateGeometry=!f.disableGeometryUpdate&&n.canUpdateGeometry);return n},getLocaleDateTime:function(c){return z.localizeDate(new Date(c),{fullYear:!0,formatLength:"medium"})},getAttrByFieldKey:function(c,f){return m(c,f)},setAttrByFieldKey:function(c,f,a){return m(c,f,a)},ignoreCaseToGetFieldKey:function(c,f){var a=null;if(c=y(c,f))a=c.name;return a},ignoreCaseToGetFieldObject:function(c,
f){return y(c,f)}}})},"widgets/Edit/FilterEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html jimu/utils dojo/dom-construct dijit/_TemplatedMixin dijit/_WidgetBase".split(" "),function(N,v,z,y,m,c,f,a){return N([a,f],{name:"FilterEditor",baseClass:"jimu-widget-FilterEditor",declaredClass:"jimu.dijit.FilterEditor",templateString:"\x3cdiv style\x3d'width:100%'\x3e\x3cdiv data-dojo-attach-point\x3d'filterEditorDiv'\x3e\x3c/div\x3e\x3c/div\x3e",_settings:null,
_editWidget:null,_origGetItemsFromLayerFunc:null,postCreate:function(){this.nls=this._editWidget.nls;this._createFilterTool()},_createFilterTool:function(){var n=c.create("label",{innerHTML:this.nls.featureLayers});c.place(n,this.filterEditorDiv);this._createLayerFilter();this._createTemplateFilter()},_createLayerFilter:function(){this.selectDropDown=c.create("select",{"class":"jimu-input flDropDown"});c.place(this.selectDropDown,this.filterEditorDiv);this.selectDropDown.onchange=v.hitch(this,function(){this._onLayerFilterChanged()});
var n=c.create("option",{value:"all",innerHTML:window.jimuNls.common.all});c.place(n,this.selectDropDown);for(n=0;n<this._editWidget._layerObjectsParaForTempaltePicker.length;n++){var l=this._editWidget._layerObjectsParaForTempaltePicker[n];l=c.create("option",{value:l.id,innerHTML:m.sanitizeHTML(l.name)});c.place(l,this.selectDropDown)}},_createTemplateFilter:function(){this.filterTextBox=c.create("input",{"class":"jimu-input searchtextbox",type:"text",placeholder:this.nls.searchTemplates},this.filterEditorDiv);
this.filterTextBox.onkeyup=v.hitch(this,function(){this._onTempalteFilterChanged()});var n=this._editWidget.editor.templatePicker;this._origGetItemsFromLayerFunc=n._getItemsFromLayer;n._getItemsFromLayer=v.hitch(this,function(){var l=this._origGetItemsFromLayerFunc.apply(n,arguments);var b=this.filterTextBox.value;b&&(l=z.filter(l,function(u){var w=!1,e=new RegExp(b,"ig");u.hasOwnProperty("label")&&u.label.match(e)&&0<u.label.match(e).length&&(w=!0);u.hasOwnProperty("template")&&u.template.hasOwnProperty("name")&&
u.template.name.match(e)&&0<u.template.name.match(e).length&&(w=!0);return w}));0===l.length&&(this._editWidget.editor.templatePicker.grid.noDataMessage=this.nls.noAvailableTempaltes);return l})},show:function(){y.setStyle(this.domNode,"display","block")},hide:function(){y.setStyle(this.domNode,"display","none")},selectLayerFilterByValue:function(n){z.forEach(this.selectDropDown.options,function(l,b){l.value===n&&(this.selectDropDown.selectedIndex=b)},this)},setTemplateFilter:function(n){this.filterTextBox.value=
n},disableLayerFilter:function(){y.setAttr(this.selectDropDown,"disabled",!0)},enableLayerFilter:function(){y.setAttr(this.selectDropDown,"disabled",!1)},update:function(){var n;for(n=this.selectDropDown.options.length-1;0<=n;n--)"all"!==this.selectDropDown.options[n].value&&this.selectDropDown.remove(n);for(n=0;n<this._editWidget._layerObjectsParaForTempaltePicker.length;n++){var l=this._editWidget._layerObjectsParaForTempaltePicker[n];l=c.create("option",{value:l.id,innerHTML:m.sanitizeHTML(l.name)});
c.place(l,this.selectDropDown)}this._editWidget.editor.templatePicker.attr("grouping",!0);this.setTemplateFilter("")},_onLayerFilterChanged:function(n){var l=this._editWidget.editor.templatePicker;l.clearSelection();var b=this.selectDropDown.options[this.selectDropDown.selectedIndex].text;""!==b&&("All"===b?(l.attr("featureLayers",this._editWidget._layerObjectsParaForTempaltePicker),""===this.filterTextBox.value?l.attr("grouping",!0):l.attr("grouping",!1)):(b=this._editWidget.map.getLayer(this.selectDropDown.value),
l.attr("featureLayers",[b]),l.attr("grouping",!1)),n&&l.attr("grouping",!0),l.update(!0))},_onTempalteFilterChanged:function(n){var l=this.selectDropDown.options[this.selectDropDown.selectedIndex].text,b=this.filterTextBox.value;this._editWidget.editor.templatePicker.clearSelection();"All"===l&&""===b?this._editWidget.editor.templatePicker.attr("grouping",!0):this._editWidget.editor.templatePicker.attr("grouping",!1);n&&this._editWidget.editor.templatePicker.attr("grouping",!0);this._editWidget.editor.templatePicker.update(!0)}})})},
"widgets/Edit/RelatedRecordsEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/Deferred dojo/query ./utils dijit/form/Button dijit/_TemplatedMixin dijit/_WidgetBase esri/undoManager esri/OperationBase esri/graphic esri/tasks/query esri/tasks/QueryTask esri/tasks/RelationshipQuery esri/layers/FeatureLayer esri/dijit/AttributeInspector esri/dijit/Popup esri/dijit/PopupTemplate jimu/utils jimu/portalUrlUtils jimu/SelectionManager jimu/ConfigManager jimu/dijit/DropdownMenu jimu/dijit/LoadingIndicator jimu/LayerInfos/LayerInfos".split(" "),
function(N,v,z,y,m,c,f,a,n,l,b,u,w,e,q,h,r,d,x,C,L,t,p,G,T,D,P,O){var X=N([b,l],{baseClass:"related-records-editor",templateString:"\x3cdiv\x3e\x3cdiv class\x3d'operation-box' data-dojo-attach-point\x3d'operationBox'\x3e\x3cdiv class\x3d'previos-btn feature-action' data-dojo-attach-point\x3d'previouBtn'data-dojo-attach-event\x3d'click:_onPreviouBtnClick'\x3e\x3c/div\x3e\x3cdiv class\x3d'operation-title' data-dojo-attach-point\x3d'operationTitle'\x3e\x3c/div\x3e\x3cdiv class\x3d'add-new-btn' data-dojo-attach-point\x3d'addNewBtn'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'content-box' data-dojo-attach-point\x3d'contentBox'\x3e\x3c/div\x3e\x3c/div\x3e",
editorATI:null,originalFeature:null,originalLayer:null,originalJimuLayerInfo:null,layerInfosObj:null,undoManager:null,refDomNode:null,_temporaryData:null,tableInfosParam:null,postCreate:function(){this._init();y.place(this.domNode,this.refDomNode,"after");window.isRTL?y.addClass(this.previouBtn,"icon-arrow-forward"):y.addClass(this.previouBtn,"icon-arrow-back");this.loading=(new P({hidden:!0})).placeAt(this.domNode);this._clearPage();this.showFirstPage({feature:this.originalFeature,oriJimuLayerInfo:this.originalJimuLayerInfo})},
_init:function(){this.refDomNode=this.editorATI.domNode;this.originalLayer=this.originalFeature.getLayer();this.layerInfosObj=O.getInstanceSync();this.originalJimuLayerInfo=this.layerInfosObj.getLayerOrTableInfoById(this.originalLayer.id);this.undoManager=new u;this._temporaryData={eventHandles:[],dijits:[]};this._tempPopup=new C({},y.create("div"));this._tempPopup.show()},destroy:function(){this._clearPage();this._tempPopup.destroy();this.inherited(arguments)},_getRelatedTableInfoArray:function(H){var g=
new c,B=[];H.getRelatedTableInfoArray("esriRelRoleOrigin").then(v.hitch(this,function(A){z.forEach(A,function(I){this._findTableInfoFromTableInfosParam(I)&&B.push(I)},this);g.resolve(B)}));return g},_getRelatedRecordsByQuery:function(H){var g=new c,B=new q,A=new h(H.destJimuLayerInfo.getUrl()),I=H.destJimuLayerInfo.layerObject.relationships.keyField,M=H.oriJimuLayerInfo.layerObject.objectIdField;B.where=I?I+" \x3d "+H.feature.attributes[I]:M+" \x3d "+H.feature.attributes[M];B.outFields=["*"];A.execute(B,
v.hitch(this,function(R){g.resolve(R)}));return g},_getRelatedRecordsByRelatedQuery:function(H){return H.oriJimuLayerInfo.getRelatedRecords(H.feature,H.destJimuLayerInfo,H.relationshipIndex)},_getOriRelationshipByDestLayer:function(H){var g=null;g=z.filter(H.oriJimuLayerInfo.layerObject.relationships,function(B){if(B.relatedTableId===H.destJimuLayerInfo.layerObject.layerId)return!0},this);return g=g[H.relationshipIndex]?g[H.relationshipIndex]:g[0]},_getDestRelationshipByDestLayer:function(H){var g=
null;g=z.filter(H.destJimuLayerInfo.layerObject.relationships,function(B){if(B.relatedTableId===H.oriJimuLayerInfo.layerObject.layerId)return!0},this);return g=g[H.relationshipIndex]?g[H.relationshipIndex]:g[0]},_createATI:function(H){var g=H.destJimuLayerInfo;var B=null,A=this._findTableInfoFromTableInfosParam(g);if(A){B=new X.ATI({layerInfos:[A],hideNavButtons:!0},y.create("div"));B.startup();this._temporaryData.dijits.push(B);var I=this._findTableInfoFromTableInfosParam(g);(I=a.getEditCapabilities(g.layerObject,
I).canDelete)||f(".atiButton.atiDeleteButton",B.domNode).addClass("hidden")}this._editWidget._configEditor.usingSaveButton&&(g=B.addButton(this.nls.save,"save-button related-record disable","after"),g=m(g,"click",v.hitch(this,this._onSaveBtnClick,H,B)),this._temporaryData.eventHandles.push(g));g=B.addButton(this.nls.close,"close-button related-record","before");g=m(g,"click",v.hitch(this,this._onCloseBtnClick));this._temporaryData.eventHandles.push(g);I&&(g=m(B,"delete",v.hitch(this,this._onDeleteBtnClick,
H)),this._temporaryData.eventHandles.push(g));g=m(B,"attribute-change",v.hitch(this,this._onAttributeChange,H));this._temporaryData.eventHandles.push(g);return B},_findTableInfoFromTableInfosParam:function(H){var g=null;z.some(this.tableInfosParam,function(B){if(B.featureLayer.id===H.id)return g=B,!0},this);return g},_keepReferentialIntegrity:function(H){var g=this._getOriRelationshipByDestLayer(H),B=this._getDestRelationshipByDestLayer(H),A={key:"",value:"",hasRelationshipTable:!1,originKeyFieldInRelationshipTable:"",
originValueInRelationshipTable:"",destKeyFieldInRelationshipTable:"",destValueInRelationshipTable:""};if(g.keyField&&B&&B.keyField){var I=a.ignoreCaseToGetFieldKey(H.oriJimuLayerInfo.layerObject,g.keyField);var M=a.ignoreCaseToGetFieldKey(H.destJimuLayerInfo.layerObject,B.keyField);I&&M&&(A.key=M,A.value=H.feature.attributes[I])}else g.keyField&&(I=a.ignoreCaseToGetFieldKey(H.oriJimuLayerInfo.layerObject,g.keyField))&&(A.key=I,A.value=H.feature.attributes[I]);g&&null!=g.relationshipTableId&&B&&null!=
B.relationshipTableId&&(A.hasRelationshipTable=!0,A.originKeyFieldInRelationshipTable=g.keyFieldInRelationshipTable,A.destKeyFieldInRelationshipTable=B.keyFieldInRelationshipTable,A.originValueInRelationshipTable=H.feature.attributes[I],H.relatedFeature&&(A.destValueInRelationshipTable=H.relatedFeature.attributes[M||I]));return A},_prepareNewRelatedRecord:function(H){var g=this._getTemplateFromLayerObject(H.destJimuLayerInfo.layerObject);g=v.mixin({},g?g.prototype.attributes:{});H=this._keepReferentialIntegrity(H);
H.hasRelationshipTable||(g[H.key]=H.value);return new e(null,null,g,null)},_prepareNewRelationshipRecord:function(H,g){var B=null,A={};H=this._keepReferentialIntegrity(this._createOperationData(H.feature,H.oriJimuLayerInfo,H.destJimuLayerInfo,g,H.relationshipIndex));H.hasRelationshipTable&&(A[H.originKeyFieldInRelationshipTable]=H.originValueInRelationshipTable,A[H.destKeyFieldInRelationshipTable]=H.destValueInRelationshipTable,B=new e(null,null,A,null));return B},_prepareRelationshipTableInfo:function(H){var g=
this._getOriRelationshipByDestLayer(H).relationshipTableId,B=null;if(null==g)return null;H=H.oriJimuLayerInfo.layerObject;var A=H.url.lastIndexOf("/"),I=H.url.slice(0,A)+"/"+g.toString();z.some(this.tableInfosParam,function(M){if(v.getObject("featureLayer.url",!1,M)&&p.removeProtocol(I.toString().toLowerCase()).replace(/\/+/g,"/")===p.removeProtocol(M.featureLayer.url.toString().toLowerCase()).replace(/\/+/g,"/"))return B=this.layerInfosObj.getLayerOrTableInfoById(M.featureLayer.id),!0},this);return B},
_addNewRelationshipReocrd:function(H,g){var B=new c,A=null;(H=this._prepareNewRelationshipRecord(g,H))&&(A=this._prepareRelationshipTableInfo(g));A&&A.layerObject?A.layerObject.applyEdits([H],null,null,v.hitch(this,function(){B.resolve()}),v.hitch(this,function(){console.warn("Failed to add relationship record.");B.resolve()})):B.resolve();return B},_addNewRelatedRecord:function(H,g){var B=new c,A=g.destJimuLayerInfo.layerObject;A.applyEdits([H],null,null,v.hitch(this,function(I){var M=I[0];if(M.success&&
M.objectId){I=new q;var R=new h(A.url);I.where=A.objectIdField+" \x3d "+M.objectId;I.outFields=["*"];R.execute(I,v.hitch(this,function(S){var W=S.features[0];W||(H.attributes[A.objectIdField]=M.objectId,W=H);this._addNewRelationshipReocrd(W,g).then(v.hitch(this,function(){B.resolve(W)}))}),v.hitch(this,function(){B.reject()}))}else B.reject()}),v.hitch(this,function(){B.reject()}));return B},_deleteRelatedRecord:function(H){var g=new c;H.destJimuLayerInfo.layerObject.applyEdits(null,null,[H.relatedFeature],
v.hitch(this,function(){g.resolve()}),v.hitch(this,function(){g.reject()}));return g},_updateRelatedRecordOnSave:function(H){this.loading.show();this._updateRelatedRecord(H).then(v.hitch(this,function(){this.loading.hide()}),v.hitch(this,function(){this.loading.hide()}))},_updateRelatedRecordOnClient:function(H,g){this._editWidget._startEditingSession();H.relatedFeature.attributes[g.fieldName]=g.fieldValue;var B=g.target;B&&B.updateCurrentSelectdFeature&&B.updateCurrentSelectdFeature([H.relatedFeature],
H.destJimuLayerInfo.layerObject,g.fieldName,g.fieldValue)},_updateRelatedRecordDirectly:function(H,g){this.loading.show();H.relatedFeature.attributes[g.fieldName]=g.fieldValue;this._updateRelatedRecord(H).then(v.hitch(this,function(){this.loading.hide();var B=g.target;B&&B.updateCurrentSelectdFeature&&B.updateCurrentSelectdFeature([H.relatedFeature],H.destJimuLayerInfo.layerObject,g.fieldName,g.fieldValue)}),v.hitch(this,function(){this.loading.hide()}))},_updateRelatedRecord:function(H){var g=new c;
H.destJimuLayerInfo.layerObject.applyEdits(null,[H.relatedFeature],null,v.hitch(this,function(){g.resolve()}),v.hitch(this,function(){g.reject()}));return g},_getDisplayTitleOfRelatedRecord:function(H,g,B){var A=H.getInfoTemplate();return(H="popupTitle"===B&&A?"function"===typeof A.title?A.title(g):A.title:this._getDisplayTitleFromPopup(H,g,B))?H:""},_getDisplayTitleFromPopup:function(H,g,B){(H=this._getPopupTemplateWithOnlyDisplayField(H,B))?(g.setInfoTemplate(H),this._tempPopup.setFeatures([g]),
B=(B=f("td.attrValue",this._tempPopup.domNode)[0])&&B.innerHTML,g.setInfoTemplate(null)):B=a.getAttrByFieldKey(g,B);return B},_getPopupTemplateWithOnlyDisplayField:function(H,g){H=H._getCustomPopupInfo(H.layerObject,[g]);return new L(H)},_getTemplateFromLayerObject:function(H){var g=null;H.templates&&H.templates[0]?g=H.templates[0]:H.types&&H.types[0]&&H.types[0].templates[0]&&(g=H.types[0].templates[0]);return g},showRelatedRecords:function(H){this._changeRefDomNode();var g=v.getObject("_wabProperties.originalLayerName",
!1,H.destJimuLayerInfo.layerObject)||H.destJimuLayerInfo.title;this._setOperationTitle(g);this._clearPage();this.loading.show();this._getRelatedRecordsByRelatedQuery(H).then(v.hitch(this,function(B){var A=H.oriJimuLayerInfo.getOriRelationshipByDestLayer(H.oriJimuLayerInfo.layerObject,H.destJimuLayerInfo.layerObject);A&&A.cardinality&&A.cardinality.toLowerCase&&0<=A.cardinality.toLowerCase().indexOf("onetoone")&&1<=B.length?this._hideAddNewBtn():this._showAddNewBtn(H);0<B.length?this._setTitle(window.jimuNls.popup.relatedRecords):
this._setTitle(window.jimuNls.popup.noRelatedRecotds,"font-normal");var I=this._showFieldSelector(H.destJimuLayerInfo);z.forEach(B,function(M,R){M._layer=H.destJimuLayerInfo.layerObject;var S=this._getDisplayTitleOfRelatedRecord(H.destJimuLayerInfo,M,I);R=y.create("div",{"class":"item record-item enable "+(0===R%2?"oddLine":"evenLine"),innerHTML:t.sanitizeHTML(S)},this.contentBox);R.relatedRecord=M;R=m(R,"click",v.hitch(this,function(){this._addOperation(X.OPERATION_SHOW_RELATED_RECORDS,H);this.showInspector(this._createOperationData(H.feature,
H.oriJimuLayerInfo,H.destJimuLayerInfo,M,H.relationshipIndex))}));this._temporaryData.eventHandles.push(R)},this);this.loading.hide()}))},showInspector:function(H){var g=!1;this._changeRefDomNode();var B=H.destJimuLayerInfo.layerObject,A=v.getObject("_wabProperties.originalLayerName",!1,B)||H.destJimuLayerInfo.title;B=v.getObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",!1,B);var I=this._getDisplayTitleOfRelatedRecord(H.destJimuLayerInfo,H.relatedFeature,B);"popupTitle"!==B&&(I=
A+": "+I);this._setOperationTitle(I);this._clearPage();(I=this._createATI(H))&&y.place(I.domNode,this.contentBox);A=H.destJimuLayerInfo.layerObject.objectIdField;B=H.relatedFeature.attributes[A];null===B||void 0===B?(H.destJimuLayerInfo.layerObject.clearSelection(),I.showFeature(H.relatedFeature,H.destJimuLayerInfo.layerObject),g=!0,f(".atiButton.atiDeleteButton",I.domNode).addClass("disable"),this._editWidget._startEditingSession()):(this.loading.show(),I=new q,I.where=A+" \x3d "+B,H.destJimuLayerInfo.layerObject.selectFeatures(I,
d.SELECTION_NEW,v.hitch(this,function(){this.loading.hide();var M=H.destJimuLayerInfo.layerObject.getSelectedFeatures();M&&M[0]&&M[0].geometry&&this._activeGraphicEdit(M[0],H.oriJimuLayerInfo)})));this.showRelatedTables(this._createOperationData(H.relatedFeature,H.destJimuLayerInfo,null,null,null),H,g)},showRelatedTables:function(H,g,B){this._getRelatedTableInfoArray(H.oriJimuLayerInfo).then(v.hitch(this,function(A){0<A.length&&this._setTitle(window.jimuNls.popup.relatedTables);var I={};z.forEach(A,
function(R){void 0===I[R.id]?I[R.id]=0:I[R.id]++},this);var M={};z.forEach(A,function(R,S){void 0===M[R.id]?M[R.id]=0:M[R.id]++;var W=0===S%2?"oddLine ":"evenLine ",V=B?"disable ":"enable ";S='\x3cdiv title\x3d"'+R.title+'"\x3e'+t.sanitizeHTML(R.title)+"\x3c/div\x3e";W=y.create("div",{"class":"item table-item "+W+V,innerHTML:S},this.contentBox);var k=M[R.id];0<I[R.id]&&(V=H.oriJimuLayerInfo.getOriRelationshipByDestLayer(H.oriJimuLayerInfo.layerObject,R.layerObject,k),V=V.name||V.id,V='\x3cdiv class\x3d"relationshipName" title\x3d"'+
V+'"\x3e('+t.sanitizeHTML(V)+")\x3c/div\x3e",W.innerHTML=S+V);B||(S=m(W,"click",v.hitch(this,function(){if(this._editWidget._configEditor.usingSaveButton)var F=this._editWidget._popupConfirmDialog();else F=new c,F.resolve(!0);F.then(v.hitch(this,function(K){K&&R.getLayerObject().then(v.hitch(this,function(){g?this._addOperation(X.OPERATION_SHOW_INSPECTOR,g):this._addOperation(X.OPERATION_FIRST,H);this.showRelatedRecords(this._createOperationData(H.feature,H.oriJimuLayerInfo,R,null,k))}))}))})),this._temporaryData.eventHandles.push(S))},
this)}))},showFirstPage:function(H,g){this._clearPage();this._revertRefDomNode();this.showRelatedTables(H);g&&(z.forEach(this._editWidget._jimuLayerInfos.getLayerInfoArray(),function(B){B.layerObject&&B.layerObject.clearSelection&&B.id!==this.originalJimuLayerInfo.id&&G.getInstance().clearSelection(B.layerObject)},this),this.originalFeature.setSymbol(this.originalLayer.getSelectionSymbol()),this._activeGraphicEdit(this.originalFeature))},_activeGraphicEdit:function(H,g){g&&(g.id===this.originalJimuLayerInfo.id?
this.originalFeature.setSymbol(null,!0):G.getInstance().clearSelection(g.layerObject));var B;this._editWidget.editor._editVertices=!0;this._editWidget.editor._activateEditToolbar(H);H.geometry&&(B="point"===H.geometry.type?H.geometry:H.geometry.getExtent().getCenter());this._editWidget.map.infoWindow.show(B)},_createOperationData:function(H,g,B,A,I){return{feature:H,oriJimuLayerInfo:g,destJimuLayerInfo:B,relatedFeature:A,relationshipIndex:I||0}},_addOperation:function(H,g){this.undoManager.add(new X.Operation(H,
g,this))},_onPreviouBtnClick:function(){if(this._editWidget._configEditor.usingSaveButton)var H=this._editWidget._popupConfirmDialog();else H=new c,H.resolve(!0);H.then(v.hitch(this,function(g){g&&this.undoManager.undo()}))},_onAddNewBtnClick:function(H){var g=H.destJimuLayerInfo.layerObject,B=this._prepareNewRelatedRecord(H),A=this._keepReferentialIntegrity(H);"Table"!==g.type?this._editWidget._startEditingRelatedGraphic(H,A):this._editWidget._configEditor.usingSaveButton?(this._addOperation(X.OPERATION_SHOW_RELATED_RECORDS,
H),this.showInspector(this._createOperationData(H.feature,H.oriJimuLayerInfo,H.destJimuLayerInfo,B,H.relationshipIndex))):(this.loading.show(),this._addNewRelatedRecord(B,H).then(v.hitch(this,function(I){this.loading.hide();this._addOperation(X.OPERATION_SHOW_RELATED_RECORDS,H);this.showInspector(this._createOperationData(H.feature,H.oriJimuLayerInfo,H.destJimuLayerInfo,I,H.relationshipIndex))}),v.hitch(this,function(){this.loading.hide()})))},_onCloseBtnClick:function(){this._editWidget.editPopup.hide()},
_onDeleteBtnClick:function(H){var g=H.relatedFeature.attributes[H.destJimuLayerInfo.layerObject.objectIdField];null!==g&&void 0!==g&&(this._editWidget._configEditor.usingSaveButton&&this._editWidget._stopEditingSession(),this.loading.show(),this._deleteRelatedRecord(H).then(v.hitch(this,function(){this.loading.hide();this._onPreviouBtnClick()}),v.hitch(this,function(){this.loading.hide()})))},_onSaveBtnClick:function(H){if(this._editWidget._isEditingSession){var g=H.relatedFeature.attributes[H.destJimuLayerInfo.layerObject.objectIdField];
null===g||void 0===g?(g=H.relatedFeature,this.loading.show(),this._addNewRelatedRecord(g,H).then(v.hitch(this,function(B){this.loading.hide();this.showInspector(this._createOperationData(H.feature,H.oriJimuLayerInfo,H.destJimuLayerInfo,B,H.relationshipIndex))}),v.hitch(this,function(){this.loading.hide()}))):this._updateRelatedRecordOnSave(H);this._editWidget._stopEditingSession()}},_onAttributeChange:function(H,g){this._editWidget._configEditor.usingSaveButton?this._updateRelatedRecordOnClient(H,
g):this._updateRelatedRecordDirectly(H,g)},_clearPage:function(){y.empty(this.contentBox);y.setStyle(this.addNewBtn,"display","none");z.forEach(this._temporaryData.eventHandles,function(H){H&&H.remove&&H.remove()},this);this._temporaryData.eventHandles=[];z.forEach(this._temporaryData.dijits,function(H){H&&H.destroy&&H.destroy()},this);this._temporaryData.dijits=[]},_changeRefDomNode:function(){y.setStyle(this.refDomNode,"display","none");y.setStyle(this.operationBox,"display","block");y.addClass(this.domNode,
"fix-height-mode");this.previouBtn.title=window.jimuNls.common.back;this.addNewBtn.title=window.jimuNls.common.newText;this.undoManager.peekUndo()?y.setStyle(this.previouBtn,"display","block"):y.setStyle(this.previouBtn,"display","none")},_revertRefDomNode:function(){y.setStyle(this.refDomNode,"display","block");y.setStyle(this.operationBox,"display","none");y.removeClass(this.domNode,"fix-height-mode")},_showAddNewBtn:function(H){var g=H.destJimuLayerInfo.layerObject,B=this._findTableInfoFromTableInfosParam(H.destJimuLayerInfo);
a.getEditCapabilities&&a.getEditCapabilities(g,B).canCreate&&(y.setStyle(this.addNewBtn,"display","block"),H=m(this.addNewBtn,"click",v.hitch(this,this._onAddNewBtnClick,H)),this._temporaryData.eventHandles.push(H))},_hideAddNewBtn:function(){y.setStyle(this.addNewBtn,"display","none")},_setTitle:function(H,g){H&&y.create("div",{"class":"title-box "+(g?g:""),innerHTML:t.sanitizeHTML(H)},this.contentBox)},_setOperationTitle:function(H){y.setAttr(this.operationTitle,"innerHTML",t.sanitizeHTML(H));y.setAttr(this.operationTitle,
"title",H)},_showFieldSelector:function(H){var g="objecid",B=f(".title-box",this.contentBox)[0],A=H.layerObject,I=[];if(!B||!H)return g;var M=H.getPopupInfo();M&&M.title&&I.push({label:window.jimuNls.popup.saveAsPopupTitle,value:"popupTitle"});var R=this._findTableInfoFromTableInfosParam(H);R&&R.fieldInfos&&z.forEach(R.fieldInfos,function(V){"globalid"!==V.fieldName.toLowerCase()&&"shape"!==V.fieldName.toLowerCase()&&I.push({label:V.label||V.fieldName,value:V.fieldName})});B=(new D({items:I})).placeAt(B);
B.domNode.title=window.jimuNls.popup.chooseFieldTip;R=v.getObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",!1,A);var S=a.ignoreCaseToGetFieldObject(H.layerObject,H.layerObject.displayField||H.layerObject.objectIdField),W=T.getInstance().getAppConfig();R?g=R:"2.3"===W.configWabVersion&&S&&S.name?g=S.name:M&&M.title?g="popupTitle":S&&S.name?g=S.name:0<I.length&&(g=I[0].value);g&&(B.setHighlightValue(g),v.setObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",g,A));this._temporaryData.dijits.push(B);
H=m(B,"click-item",v.hitch(this,function(V,k){f(".item.record-item",this.contentBox).forEach(v.hitch(this,function(F){v.setObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",k,A);var K=this._getDisplayTitleOfRelatedRecord(V,F.relatedRecord,k);F.innerHTML=t.sanitizeHTML(K)}))},H));this._temporaryData.eventHandles.push(H);return g}});X.Operation=N([w],{constructor:function(H,g,B){this.operationName=H;this.operationData=g;this.relatedRecordsEditor=B},performUndo:function(){switch(this.operationName){case X.OPERATION_SHOW_RELATED_TABLES:return this.relatedRecordsEditor.showRelatedTables(this.operationData);
case X.OPERATION_SHOW_RELATED_RECORDS:return this.relatedRecordsEditor.showRelatedRecords(this.operationData);case X.OPERATION_SHOW_INSPECTOR:return this.relatedRecordsEditor.showInspector(this.operationData);default:return this.relatedRecordsEditor.showFirstPage(this.operationData,!0)}}});X.ATI=N([x],{constructor:function(){this._aiConnects=[];this._selection=[];this._toolTips=[]},addButton:function(H,g,B){B=B?B:"before";H=new n({label:H,"class":" atiButton "+g},y.create("div"));y.place(H.domNode,
this.deleteBtn.domNode,B);return H},updateCurrentSelectdFeature:function(H,g,B,A){this._selection&&this._selection[0]&&B&&(this._selection[0].attributes[B]=A,g.ownershipBasedAccessControlForFeatures=!0,this.refresh(),g.ownershipBasedAccessControlForFeatures=!1)},_getFields:function(H){return H.fields}});v.mixin(X,{OPERATION_SHOW_RELATED_TABLES:"showRelatedTables",OPERATION_SHOW_RELATED_RECORDS:"showRelatedRecords",OPERATION_SHOW_INSPECTOR:"showInspector",OPERATION_FIRST:"first"});return X})},"widgets/Edit/_build-generate_module":function(){define(["dojo/text!./Widget.html",
"dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:dijit/templates/ProgressBar.html":'\x3cdiv class\x3d"dijitProgressBar dijitProgressBarEmpty" role\x3d"progressbar"\r\n\t\x3e\x3cdiv  data-dojo-attach-point\x3d"internalProgress" class\x3d"dijitProgressBarFull"\r\n\t\t\x3e\x3cdiv class\x3d"dijitProgressBarTile" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\x3e\x3cspan style\x3d"visibility:hidden"\x3e\x26#160;\x3c/span\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"labelNode" class\x3d"dijitProgressBarLabel" id\x3d"${id}_label"\x3e\x3c/div\r\n\t\x3e\x3cspan data-dojo-attach-point\x3d"indeterminateHighContrastImage"\r\n\t\t   class\x3d"dijitInline dijitProgressBarIndeterminateHighContrastImage"\x3e\x3c/span\r\n\x3e\x3c/div\x3e\r\n',
"url:esri/dijit/editing/templates/AttachmentEditor.html":"\x3cdiv class\x3d\"attachmentEditor\"\x3e\r\n    \x3cbr /\x3e\r\n    \x3cdiv\x3e\r\n        \x3cb\x3e${NLS_attachments}\x3c/b\x3e\r\n        \x3chr /\x3e\r\n        \x3cdiv dojoAttachPoint\x3d\"_attachmentError\" style\x3d'color:red;display:none'\x3e\x3c/div\x3e\r\n        \x3cbr /\x3e\r\n        \x3cspan dojoAttachPoint\x3d'_attachmentList' style\x3d'word-wrap: break-word;'\x3e\x3c/span\x3e\r\n        \x3cbr\x3e\x3cbr\x3e\r\n        \x3cdiv data-dojo-type\x3d\"dijit/ProgressBar\" dojoAttachPoint\x3d\"_attachmentProgress\" indeterminate\x3d\"true\" style\x3d'display:none'\x3e\x3c/div\x3e\r\n        \x3cbr /\x3e        \r\n        \x3cform dojoAttachPoint\x3d'_uploadForm'\x3e ${NLS_add}:\x26nbsp;\x26nbsp;\x3cinput type\x3d'file' name\x3d'attachment' dojoAttachPoint\x3d'_uploadField' /\x3e \x3c/form\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e",
"url:esri/dijit/templates/AttributeInspector.html":'\x3cdiv class\x3d"esriAttributeInspector"\x3e\r\n    \x3cdiv class\x3d"atiLayerName" dojoAttachPoint\x3d"layerName"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiAttributes" dojoAttachPoint\x3d"attributeTable"\x3e\x3c/div\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"attachmentEditor"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiEditorTrackingInfo" dojoAttachPoint\x3d"editorTrackingInfoDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiButtons" dojoAttachPoint\x3d"editButtons"\x3e\r\n        \x3cbutton  dojoType\x3d"dijit.form.Button" class\x3d"atiButton atiDeleteButton"  dojoAttachPoint\x3d"deleteBtn" dojoAttachEvent\x3d"onClick: onDeleteBtn" showLabel\x3d"true" type\x3d"button"\x3e${NLS_deleteFeature}\x3c/button\x3e\r\n        \x3cdiv class\x3d"atiNavButtons" dojoAttachPoint\x3d"navButtons"\x3e\r\n            \x3cdiv class\x3d"atiNavMessage" dojoAttachPoint\x3d"navMessage"\x3e\x3c/div\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiFirstIcon" dojoAttachPoint\x3d"firstFeatureButton" dojoAttachEvent\x3d"onClick: onFirstFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_first}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiPrevIcon" dojoAttachPoint\x3d"prevFeatureButton" dojoAttachEvent\x3d"onClick: onPreviousFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_previous}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiNextIcon" dojoAttachPoint\x3d"nextFeatureButton" dojoAttachEvent\x3d"onClick: onNextFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_next}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiLastIcon" dojoAttachPoint\x3d"lastFeatureButton" dojoAttachEvent\x3d"onClick: onLastFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_last}\x3c/button\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dojox/grid/resources/View.html":'\x3cdiv class\x3d"dojoxGridView" role\x3d"presentation"\x3e\r\n\t\x3cdiv class\x3d"dojoxGridHeader" dojoAttachPoint\x3d"headerNode" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv dojoAttachPoint\x3d"headerNodeContainer" style\x3d"width:9000em" role\x3d"presentation"\x3e\r\n\t\t\t\x3cdiv dojoAttachPoint\x3d"headerContentNode" role\x3d"row"\x3e\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cinput type\x3d"checkbox" class\x3d"dojoxGridHiddenFocus" dojoAttachPoint\x3d"hiddenFocusNode" aria-hidden\x3d"true" /\x3e\r\n\t\x3cinput type\x3d"checkbox" class\x3d"dojoxGridHiddenFocus" aria-hidden\x3d"true" /\x3e\r\n\t\x3cdiv class\x3d"dojoxGridScrollbox" dojoAttachPoint\x3d"scrollboxNode" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d"dojoxGridContent" dojoAttachPoint\x3d"contentNode" hidefocus\x3d"hidefocus" role\x3d"presentation"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dojox/grid/resources/_Grid.html":'\x3cdiv hidefocus\x3d"hidefocus" role\x3d"grid" dojoAttachEvent\x3d"onmouseout:_mouseOut"\x3e\r\n\t\x3cdiv class\x3d"dojoxGridMasterHeader" dojoAttachPoint\x3d"viewsHeaderNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"dojoxGridMasterView" dojoAttachPoint\x3d"viewsNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"dojoxGridMasterMessages" style\x3d"display: none;" dojoAttachPoint\x3d"messagesNode"\x3e\x3c/div\x3e\r\n\t\x3cspan dojoAttachPoint\x3d"lastFocusNode" tabindex\x3d"0"\x3e\x3c/span\x3e\r\n\x3c/div\x3e\r\n',
"url:esri/dijit/editing/templates/TemplatePicker.html":'\x3cdiv class\x3d"templatePicker"\x3e\r\n\r\n  \x3ctable dojoType\x3d"dojox.grid.DataGrid" noDataMessage\x3d"${emptyMessage}" selectionMode\x3d"none" autoHeight\x3d"${_rows}" autoWidth\x3d"${_autoWidth}"\r\n         query\x3d"{ query: \'*\' }" dojoAttachPoint\x3d"grid" class\x3d"grid"\x3e\r\n  \x3c/table\x3e\r\n  \r\n\x3c/div\x3e',"url:esri/dijit/editing/templates/Editor.html":'\x3cdiv class\x3d"esriEditor"\x3e\r\n    \x3cdiv class\x3d"esriTemplatePicker" dojoAttachPoint\x3d"templatePickerDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"esriDrawingToolbar" dojoAttachPoint\x3d"drawingToolbarDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"progressBar" dojoAttachPoint\x3d"progressBar" indeterminate\x3d"true" dojoType\x3d"dijit.ProgressBar" /\x3e\r\n\x3c/div\x3e',
"url:widgets/Edit/Widget.html":'\x3cdiv style\x3d"width:100%; height:100%; min-width:280px;min-width:240px;"\x3e\r\n  \x3cdiv class\x3d"edit-related-graphic-part disable" data-dojo-attach-point\x3d"editRelatedGraphicPart"\x3e\r\n    \x3cdiv class\x3d"title"\x3e${nls.editRelatedFeature}\x3c/div\x3e\r\n    \x3cdiv class\x3d"btn" data-dojo-attach-event\x3d"click:_stopEditingRelatedGraphic"\x3e${nls.done}\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"editWidgetTitle"\x3e\r\n    ${nls.title}\x3cbr\x3e\x3cbr\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/Edit/css/style.css":'.jimu-widget-edit-infoWindow .related-records-editor {}.jimu-widget-edit-infoWindow .related-records-editor.fix-height-mode{height: 235px;}.jimu-widget-edit-infoWindow.esriPopupMaximized .related-records-editor.fix-height-mode{height: 100%;}.jimu-widget-edit-infoWindow .related-records-editor .operation-box {border-bottom: 1px solid #DDDDDD; height: 28px; line-height: 18px; text-align: center; position: absolute; left: 0; right: 0; font-family: "Avenir Heavy"; font-size: 16px;}.jimu-widget-edit-infoWindow .related-records-editor .previos-btn{float: left; cursor: pointer; height: 100%; line-height: 17px; margin-left: 20px;}.jimu-rtl .jimu-widget-edit-infoWindow .related-records-editor .previos-btn{float: right; margin-right: 20px; margin-left: auto;}.jimu-widget-edit-infoWindow .related-records-editor .operation-title{display: inline-block; max-width: 80%; white-space: nowrap; text-overflow: ellipsis; overflow: hidden;}.jimu-widget-edit-infoWindow .related-records-editor .add-new-btn{display: none; float: right; cursor: pointer; margin-right: 20px; background-image: url("images/add_normal.svg"); background-repeat: no-repeat; width: 16px; height: 16px;}.jimu-rtl .jimu-widget-edit-infoWindow .related-records-editor .add-new-btn{float: left; margin-right: auto; margin-left: 20px;}.jimu-widget-edit-infoWindow .related-records-editor .add-new-btn:hover{background-image: url("images/add_hover.svg");}.jimu-widget-edit-infoWindow .related-records-editor.fix-height-mode .content-box{position: absolute; top: 45px; bottom: 0; left: 10px; right: 0px; overflow-y: auto; overflow-x: hidden;}.jimu-widget-edit-infoWindow .related-records-editor .content-box .title-box{font-family: "Avenir Heavy"; height: 34px; line-height: 34px; padding-left: 10px; padding-right: 10px;}.jimu-widget-edit-infoWindow .related-records-editor .content-box .title-box.font-normal{font-weight: normal; color: #666666;}.jimu-widget-edit-infoWindow .related-records-editor .content-box .item{position: relative; min-height: 30px; line-height: 30px; width: 100%; background-color: #ffffff; color: #000000; padding-left: 10px; padding-right: 30px; background-image: url("images/edit_default.svg"); background-repeat: no-repeat; background-position: right 10px center; white-space: nowrap; text-overflow: ellipsis; overflow: hidden;}.jimu-widget-edit-infoWindow .related-records-editor .content-box .item div{white-space: nowrap; text-overflow: ellipsis; overflow: hidden;}.jimu-widget-edit-infoWindow .related-records-editor .content-box .item .relationshipName{opacity: 0.5;}.jimu-rtl .jimu-widget-edit-infoWindow .related-records-editor .content-box .item{background-position: left 10px center; padding-left: 30px; padding-right: 10px;}.jimu-widget-edit-infoWindow .related-records-editor .content-box .item.disable{opacity: 0.4;}.jimu-widget-edit-infoWindow .related-records-editor .content-box .item.oddLine{background-color: #f3f3f3;}.jimu-widget-edit-infoWindow .related-records-editor .content-box .item.enable:hover{cursor: pointer; border-color: rgba(0, 0, 0, 1.0); font-family: "Avenir Heavy"; background-image: url("images/edit_hover.svg");}.jimu-widget-edit-infoWindow .related-records-editor .content-box .item .edit-icon{position: absolute; right: 5px; top: 7px;}.jimu-rtl .jimu-widget-edit-infoWindow .related-records-editor .content-box .item .edit-icon{right: auto; left: 10px;}.jimu-widget-edit-infoWindow .related-records-editor .esriAttributeInspector{padding-right: 2px;}.jimu-widget-edit-infoWindow .related-records-editor .esriAttributeInspector .atiLayerName{display: none;}.jimu-widget-edit-infoWindow .related-records-editor .content-box .title-box .jimu-dijit-dropdownmenu{float: right; right: 2px; top: 6px;}.jimu-rtl .jimu-widget-edit-infoWindow .related-records-editor .content-box .title-box .jimu-dijit-dropdownmenu{float: left; left: 2px; right: auto;}.jimu-widget-edit-infoWindow .related-records-editor .esriAttributeInspector .atiButton.atiDeleteButton.hidden{display: none !important;}.jimu-widget-FilterEditor {}.jimu-widget-FilterEditor .flDropDown {width: 100%; -webkit-appearance: menulist-button; height: 30px; border-radius: 4px; border: 1px solid #b9b9b9; color: #838383; margin-top: 2px; margin-bottom: 10px;}.jimu-widget-FilterEditor .searchtextbox {border: 1px solid #b9b9b9; color: #838383; width: 100%; padding: 5px; margin-bottom: 1px; border-radius: 4px 4px 0px 0px;}.jimu-widget-FilterEditor .searchtextbox:focus {border: 1px solid #838383;}.jimu-widget-FilterEditor .searchtextbox:hover {border: 1px solid #838383;}.jimu-widget-FilterEditor .jimu-input {font-size: 12px; height: auto;}.jimu-widget-edit {position: relative;}.jimu-widget-edit .edit-related-graphic-part{overflow: hidden; font-size: 14px;}.jimu-widget-edit .edit-related-graphic-part.disable{display: none;}.jimu-widget-edit .edit-related-graphic-part .title{float: left; max-width: 220px; height: 40px; line-height: 14px; padding-top: 5px;}.jimu-rtl .jimu-widget-edit .edit-related-graphic-part .title{float: right;}.jimu-widget-edit .edit-related-graphic-part .btn{float: right; min-width: 90px; max-width: 110px; cursor: pointer; background-color: #009966; color: #ffffff; height: 30px; line-height: 30px; text-align: center;}.jimu-rtl .jimu-widget-edit .edit-related-graphic-part .btn{float: left;}.jimu-widget-edit .templatePicker {position: absolute; width: 100%; bottom: 53px;}.jimu-widget-edit .dojoxGridRow {border: 0;}.jimu-widget-edit .dojoxGridScrollbox {overflow-x: hidden;}.jimu-widget-edit .templatePicker .grid .dojoxGridCell {border: 0px solid #FFFFFF;}.jimu-widget-edit .esriEditor {position: absolute; bottom: 0; height: 30px; width: 100%;}.jimu-widget-edit .esriDrawingToolbar {position: absolute; right: 0; left: 0; bottom: 0; min-height: 50px;}.jimu-widget-edit-infoWindow .esriAttributeInspector {width: 100%;}.jimu-widget-edit-infoWindow .esriAttributeInspector .atiAttributes table {width: 100%;}.jimu-widget-edit-infoWindow .esriAttributeInspector .atiLabel {}.jimu-widget-edit-infoWindow .esriAttributeInspector .dijitTextBox {width: 100%; border-color: #dddddd; margin: 3px auto;}.jimu-widget-edit-infoWindow .esriAttributeInspector .dijitInputField {}.jimu-widget-edit-infoWindow .esriAttributeInspector .dijitTextBox .dijitInputInner {}.jimu-widget-edit-infoWindow .esriAttributeInspector .dijitTextBoxFocused {border-color: #afafaf !important; box-shadow: 0 0 0 #ffffff !important;}.jimu-widget-edit-infoWindow .esriAttributeInspector .dijitTextBoxHover{background-color: #ffffff; background-image: none; border-color: #afafaf !important;}.jimu-widget-edit-infoWindow .esriAttributeInspector .atiRichTextField{}.jimu-widget-edit-infoWindow .esriAttributeInspector div.dijitEditorIFrameContainer {height: 78px;}.jimu-widget-edit-infoWindow .esriAttributeInspector .dijitTextBox.dijitTextArea {height: 32px;}.jimu-widget-edit-infoWindow .esriAttributeInspector .atiButtons {padding-top: 10px; height: 35px;}.jimu-widget-edit-infoWindow .esriAttributeInspector .atiButton {margin: 0 0 0 10px; float: none; width: auto; float: right;}.jimu-rtl .jimu-widget-edit-infoWindow .esriAttributeInspector .atiButton {margin: 0 10px 0 0px; float: left;}.jimu-widget-edit-infoWindow .esriAttributeInspector .dijitButtonNode{border: 1px solid #979797; color: #000000; border-radius: 0px; background-color: #ffffff; background-image: none;}.jimu-widget-edit-infoWindow .esriAttributeInspector .dijitButtonText{height: 22px; min-width: 60px; line-height: 22px;}.jimu-widget-edit-infoWindow .esriAttributeInspector .dijitButtonNode:hover{border: 1px solid #555555; font-family: "Avenir Heavy";}.jimu-widget-edit-infoWindow .esriAttributeInspector .atiButton.disable .dijitButtonNode{border: 1px solid #ccc; color: #ccc; font-family: "inherit";}.jimu-widget-edit-infoWindow .jimu-popup{}.jimu-widget-edit-infoWindow .jimu-popup .title{display: none;}.jimu-widget-edit-infoWindow .jimu-popup .content{line-height: 16px;}.jimu-widget-edit-infoWindow .jimu-popup .jimu-btn{border: 1px solid #979797; color: #000000; border-radius: 0px; background-color: #ffffff; background-image: none; line-height: 27px;}.jimu-widget-edit-infoWindow .jimu-popup .jimu-btn:hover{border: 1px solid #555555; font-family: "Avenir Heavy";}',
"*now":function(N){N(['dojo/i18n!*preload*widgets/Edit/nls/Widget*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/i18n!esri/nls/jsapi dojo/on dojo/query dojo/json dojo/Deferred dojo/aspect dojo/promise/all dijit/_WidgetsInTemplateMixin jimu/BaseWidget jimu/MapManager jimu/PanelManager jimu/LayerInfos/LayerInfos jimu/dijit/LoadingIndicator jimu/dijit/Popup jimu/portalUrlUtils jimu/SelectionManager jimu/Role esri/dijit/editing/Editor esri/dijit/editing/Util esri/dijit/Popup esri/dijit/editing/TemplatePicker esri/geometry/Extent esri/geometry/Point esri/symbols/SimpleMarkerSymbol esri/renderers/jsonUtils esri/renderers/SimpleRenderer esri/graphic esri/domUtils esri/tasks/query esri/tasks/QueryTask dijit/form/Button ./utils ./FilterEditor ./RelatedRecordsEditor".split(" "),function(N,
v,z,y,m,c,f,a,n,l,b,u,w,e,q,h,r,d,x,C,L,t,p,G,T,D,P,O,X,H,g,B,A,I,M,R,S,W){var V=N([w,u],{name:"Edit",baseClass:"jimu-widget-edit",editor:null,_defaultStartStr:"",_defaultAddPointStr:"",_mapInfoStorage:null,_jimuLayerInfos:null,editPopup:null,_configEditor:null,_layerObjectsParaForTempaltePicker:null,_createOverDef:null,_releaseEventArrayAfterActive:null,_releaseEventArrayAfterClose:null,_releaseEventArrayAfterDestory:null,_canCreateLayersAreAllInvisibleFlag:null,_layerInfoParamArrayUseForRervertRenderre:null,
layerInfosParam:null,tableInfosParam:null,layerInfosParamClone:null,tableInfosParamClone:null,_tableInfoParamDef:null,_hasEditPrivilege:null,_panelManager:null,_originalCloasePanel:null,_changedTemplatesOfTemplatePicker:null,_releaseEventArrayAfterEditingRelatedGraphic:null,_isInEditingRelatedGraphicSession:null,_needToRequeryFeatureArray:null,_isEditableLayerStore:null,_layerInfosInConfig:null,_settingsParam:null,_temporaryDataForEditingRelatedGraphicSession:null,_layerInfosChangedWhenEditingSessionFlag:null,
_newAddedLayersWhileEditWidgetIsClosed:null,postMixInProperties:function(){this.nls.done=window.jimuNls.common.done},startup:function(){this.inherited(arguments);this.editPopup=new V.EditPopup(null,y.create("div",{"class":"jimu-widget-edit-infoWindow"},null,this.map.root));this.loading=new r({hidden:!0});this.loading.placeAt(this.domNode);this._prepareCreating()},destroy:function(){this._worksAfterDestory();this.inherited(arguments)},_refresh:function(){this.onClose();this._worksAfterDestory();this._prepareCreating();
this.onOpen()},onOpen:function(){this._newAddedLayersWhileEditWidgetIsClosed&&0<this._newAddedLayersWhileEditWidgetIsClosed.length?this._refresh():("active"!==this.state&&this.widgetManager.activateWidget(this),this.editor&&this._settingsParam&&(this._changeToServiceRenderer(this._settingsParam),this._onLayerInfosChanged()),this._bindEventAfterOpen())},onClose:function(){this._revertToLayerRenderer();this._releaseEventAfterClose()},_prepareCreating:function(){this._init();this.loading.show();this._asyncPrepareDataAtStart().then(v.hitch(this,
function(){if("BoxTheme"===this.appConfig.theme.name){var k=1050;this.loading.show()}else k=1;setTimeout(v.hitch(this,function(){this.loading.hidden||this.loading.hide();this.widgetManager.activateWidget(this);this._createEditor()}),k);this._getTableInfosParam().then(v.hitch(this,function(F){this.tableInfosParam=F;this.tableInfosParamClone=this._cloneLayerOrTableInfosParam(this.tableInfosParam);this._tableInfoParamDef.resolve()}));this.loading.hide()}),v.hitch(this,function(){this.loading.hide()}))},
_init:function(){this._mapInfoStorage={resetInfoWindow:null,snappingTolerance:null,editorATIonLayerSelectionChange:null};this._editorMapClickHandlers=[];this._layerObjectsParaForTempaltePicker=[];this._configEditor=v.clone(this.config.editor);this._releaseEventArrayAfterActive=[];this._releaseEventArrayAfterClose=[];this._releaseEventArrayAfterDestory=[];this._canCreateLayersAreAllInvisibleFlag=!1;this._layerInfoParamArrayUseForRervertRenderre=[];this._createOverDef=new n;this._tableInfoParamDef=
new n;this._hasEditPrivilege=!0;this._panelManager=q.getInstance();this._changedTemplatesOfTemplatePicker=[];this._releaseEventArrayAfterEditingRelatedGraphic=[];this._isInEditingRelatedGraphicSession=!1;this._needToRequeryFeatureArray=[];this._jimuLayerInfos=h.getInstanceSync(this.map,this.map.itemInfo);this._isEditableLayerStore={};this._layerInfosInConfig=this._getLayerInfosInConfig();this._temporaryDataForEditingRelatedGraphicSession={};this._layerInfosChangedWhenEditingSessionFlag=!1;this._newAddedLayersWhileEditWidgetIsClosed=
[]},_initEditPrivilege:function(k){this._hasEditPrivilege=!0;if(k){var F=new L({id:k.roleId?k.roleId:k.role,role:k.role});k.privileges&&F.setPrivileges(k.privileges);this._hasEditPrivilege=F.canEditFeatures()}return this._hasEditPrivilege},beginEditingByFeatures:function(k,F){if(F){var K=null,E=k[0],J=E&&E.geometry||F._wabProperties&&F._wabProperties.popupInfo.originalFeature.geometry;J&&(K="point"===J.type?J:J.getExtent().getCenter());this._createOverDef.then(v.hitch(this,function(){"active"!==this.state&&
this.widgetManager.activateWidget(this);z.forEach(this._jimuLayerInfos.getLayerInfoArray(),function(Y){Y.layerObject&&Y.layerObject.clearSelection&&C.getInstance().clearSelection(Y.layerObject)},this);if(E&&E.geometry)C.getInstance().setSelection(F,k).then(v.hitch(this,function(){var Y=F.getSelectedFeatures();this.editor._updatePopupButtons(Y);this.editor._onEditFeature(Y,K)}));else{this.editPopup.show(K);var Q=v.getObject("_wabProperties.popupInfo.originalFeature",!1,F),U=v.getObject("_wabProperties.popupInfo.operationDataForListRelatedRecords",
!1,F);this._createRelatedRecordsEditor(Q).then(v.hitch(this,function(){!U&&E?this._relatedRecordsEditor.showInspector(this._relatedRecordsEditor._createOperationData(null,null,this._jimuLayerInfos.getTableInfoById(F.id),E)):this._relatedRecordsEditor.showRelatedRecords(this._relatedRecordsEditor._createOperationData(U.feature,U.oriJimuLayerInfo,U.destJimuLayerInfo))}))}}))}},onActive:function(){this._hasEditPrivilege&&(this.disableWebMapPopup(),this._bindEventAfterActive(),this._configEditor.usingSaveButton&&
(this._originalCloasePanel=this._panelManager.closePanel,this._panelManager.closePanel=this._wrapExistFunctionWithConfirmDialog(this._panelManager,this._originalCloasePanel)))},onDeActive:function(){this._hasEditPrivilege&&(this.enableWebMapPopup(),this._releaseEventAfterActive(),this.editor&&this.editor.templatePicker&&this.editor.templatePicker.clearSelection(),this._configEditor.usingSaveButton&&(this._panelManager.closePanel=this._originalCloasePanel),z.forEach(this._needToRequeryFeatureArray,
function(k){this._requeryFeature(k)},this),this._needToRequeryFeatureArray=[])},disableWebMapPopup:function(){var k=e.getInstance();k.disableWebMapPopup();this.map.infoWindow.hide();this.map.setInfoWindow(this.editPopup);this._enableMapClickHandler();null===this._mapInfoStorage.resetInfoWindow&&(this._mapInfoStorage.resetInfoWindow=k.resetInfoWindow,this.own(c(this.map.infoWindow,"show",v.hitch(this,function(){window.appInfo.isRunInMobile&&(this.map.infoWindow.maximize(),setTimeout(v.hitch(this,function(){y.addClass(this.editPopup.domNode,
"esriPopupMaximized")}),1))}))));k.resetInfoWindow=v.hitch(this,function(){});this.map.snappingManager&&void 0!==this._configEditor.snappingTolerance&&(this._mapInfoStorage.snappingTolerance=this.map.snappingManager.tolerance,this.map.snappingManager.tolerance=this._configEditor.snappingTolerance)},enableWebMapPopup:function(){var k=e.getInstance(),F=k.getMapInfoWindow();this._mapInfoStorage.resetInfoWindow&&(this.map.setInfoWindow(F.bigScreen),k.isMobileInfoWindow=!1,k.resetInfoWindow=v.hitch(k,
this._mapInfoStorage.resetInfoWindow),this._mapInfoStorage.resetInfoWindow=null,k.resetInfoWindow(),this._disableMapClickHandler(),this.editPopup.hide(),this._isEditingSession||this.editor._clearSelection(),k.enableWebMapPopup());this.map.snappingManager&&null!==this._mapInfoStorage.snappingTolerance&&(this.map.snappingManager.tolerance=this._mapInfoStorage.snappingTolerance)},_enableMapClickHandler:function(){this.editor&&(this._editorMapClickHandlers.push(this.editor._mapClickHandler),this.editor._enableMapClickHandler(),
this._editorMapClickHandlers.push(this.editor._mapClickHandler))},_disableMapClickHandler:function(){this.editor&&(this.editor._disableMapClickHandler(),z.forEach(this._editorMapClickHandlers,function(k){k&&k.remove&&k.remove()},this),this._editorMapClickHandlers=[])},_cloneLayerOrTableInfosParam:function(k){var F=[];z.forEach(k,function(K){var E=K.featureLayer;K.featureLayer=null;var J=v.clone(K);J.featureLayer=E;K.featureLayer=E;F.push(J)},this);return F},_isTemporaryFeatureForAddOnlyMode:function(k){k=
k.getLayer();this._jimuLayerInfos.getLayerOrTableInfoById(k&&k.id)},_getDefaultFieldInfos:function(k){(k=R.getFieldInfosFromWebmap(k,this._jimuLayerInfos))&&(k=z.filter(k,function(F){return F.visible||F.isEditable}));return k},_getDefaultLayerInfoById:function(k){var F={featureLayer:{}};F.featureLayer.id=k;F.allowCreate=!0;F.allowDelete=!0;F.disableGeometryUpdate=!1;(k=this._getDefaultFieldInfos(k))&&0<k.length&&(F.fieldInfos=k);return F},_getDefaultTableInfos:function(){var k=[],F=this._jimuLayerInfos.getTableInfoArray();
z.forEach(F,function(K){K=this._getDefaultLayerInfoById(K.id);k.push(K)},this);return k},_getDefaultLayerInfos:function(){for(var k=[],F=this.map.graphicsLayerIds.length-1;0<=F;F--){var K=this.map.getLayer(this.map.graphicsLayerIds[F]);"Feature Layer"===K.type&&K.url&&(K=this._getDefaultLayerInfoById(K.id),k.push(K))}return k},_asyncPrepareDataAtStart:function(){var k=[];z.forEach(this._layerInfosInConfig,function(F){var K=this._jimuLayerInfos.getLayerInfoByTopLayerId(F.featureLayer.id);K&&(K=K.isEditable(),
K._layerInfoInConfig=F,k.push(K))},this);return b(k).then(v.hitch(this,function(F){z.forEach(F,function(K,E){E=k[E]._layerInfoInConfig;this._isEditableLayerStore[E&&E.featureLayer&&E.featureLayer.id]=K},this)}))},_getLayerInfosInConfig:function(){return this._configEditor.honorSettingOfWebmap?this._getDefaultLayerInfos():this._configEditor.layerInfos?0<this._configEditor.layerInfos.length?this._converConfiguredLayerInfos(this._configEditor.layerInfos):this._getDefaultLayerInfos():[]},_converConfiguredLayerInfos:function(k){function F(K,
E){for(var J=null,Q=0;Q<K.graphicsLayerIds.length;Q++){var U=K.getLayer(K.graphicsLayerIds[Q]);if(U&&U.url&&x.removeProtocol(U.url.toLowerCase())===x.removeProtocol(E.toLowerCase())){J=U;break}}return J}z.forEach(k,function(K){if(!K.featureLayer.id&&K.featureLayer.url){var E=F(this.map,K.featureLayer.url);E&&(K.featureLayer.id=E.id)}var J=[],Q=R.getFieldInfosFromWebmap(K.featureLayer.id,this._jimuLayerInfos);z.forEach(K.fieldInfos,function(U){var Y=null;if(Q)for(var Z=0;Z<Q.length;Z++)if(U.fieldName===
Q[Z].fieldName){Q[Z].label=U.label;Q[Z].isEditableSettingInWebmap=Q[Z].isEditable;Q[Z].isEditable=U.isEditable;Y=Q[Z];break}if(void 0===U.visible)Y?(Y.isEditable||Y.isEditableSettingInWebmap||Y.visible)&&J.push(Y):J.push(U);else if(U.visible||U.isEditable)Y?J.push(Y):J.push(U)},this);0!==J.length&&(K.fieldInfos=J)},this);return k},_getLayerInfoOrTableInfoParamById:function(k){var F=null;z.some(this.layerInfosParam.concat(this.tableInfosParam),function(K){if(K.featureLayer.id===k)return F=K,!0});return F},
_getLayerInfosParam:function(){var k=[];z.forEach(this._layerInfosInConfig,function(F){var K=F.featureLayer.id,E=this.map.getLayer(K);E&&this._isEditableLayerStore[K]&&(F.featureLayer=E,k.push(F))},this);this.layerInfosParam=k;this.layerInfosParamClone=this._cloneLayerOrTableInfosParam(this.layerInfosParam);return k},_setTemplatePickerLayerObjectsParam:function(k){k&&(this._layerObjectsParaForTempaltePicker=k)},_obtainTemplatePickerLayerObjectsParam:function(k){this._layerObjectsParaForTempaltePicker=
[];var F=[];z.forEach(this._jimuLayerInfos.getLayerInfoArray(),function(K){z.some(k,function(E){return E.featureLayer&&K.id===E.featureLayer.id?(F.push(E),!0):!1},this)},this);z.forEach(F,function(K){if(K.featureLayer){var E=this._jimuLayerInfos.getLayerInfoByTopLayerId(K.featureLayer.id);E&&E.isShowInMap()&&E.isInScale()&&R.getEditCapabilities(E.layerObject,K).canCreate&&this._layerObjectsParaForTempaltePicker.push(K.featureLayer);!this._canCreateLayersAreAllInvisibleFlag&&this._isEditableLayerStore[K.featureLayer.id]&&
R.getEditCapabilities(E.layerObject,K).canCreate&&!K.featureLayer.visible&&(this._canCreateLayersAreAllInvisibleFlag=!0)}},this);return this._layerObjectsParaForTempaltePicker},_getTemplatePicker:function(k){k=this._obtainTemplatePickerLayerObjectsParam(k);k=new T({featureLayers:k,grouping:!0,rows:"auto",columns:"auto",style:(this._configEditor.toolbarVisible?"":"bottom: 0px")+";"+(this._configEditor.useFilterEdit?"top: "+V.TOP_WITH_TEMPLATE_FILTER:"top: "+V.TOP)},y.create("div",{},this.domNode));
k.startup();return k},_getSettingsParam:function(){var k={map:this.map,createOptions:{polygonDrawTools:[t.CREATE_TOOL_ARROW,t.CREATE_TOOL_AUTOCOMPLETE,t.CREATE_TOOL_CIRCLE,t.CREATE_TOOL_ELLIPSE,t.CREATE_TOOL_RECTANGLE,t.CREATE_TOOL_TRIANGLE,t.CREATE_TOOL_POLYGON,t.CREATE_TOOL_FREEHAND_POLYGON],polylineDrawTools:[t.CREATE_TOOL_POLYLINE,t.CREATE_TOOL_FREEHAND_POLYLINE]}},F;for(F in this._configEditor)k[F]=this._configEditor[F];k.layerInfos=this._getLayerInfosParam();k.templatePicker=this._getTemplatePicker(k.layerInfos);
void 0!==this._configEditor.popupTolerance&&(k.singleSelectionTolerance=this._configEditor.popupTolerance);return k},_createEditor:function(){var k={settings:this._getSettingsParam()};this._settingsParam=k.settings;this._worksBeforeCreate(k.settings);this.editor=new t(k,y.create("div",{},this.domNode));this.editor.startup();this._worksAfterCreate(k.settings)},_addButtonToInspector:function(){var k=new M({label:this.nls.close,"class":" atiButton close-button"},y.create("div"));y.place(k.domNode,this.editor.attributeInspector.deleteBtn.domNode,
"before");this.own(c(k,"click",v.hitch(this,function(){this.editPopup.hide()})));if(this._configEditor.usingSaveButton){k=new M({label:window.jimuNls.common.save,"class":" atiButton save-button disable"},y.create("div"));y.place(k.domNode,this.editor.attributeInspector.deleteBtn.domNode,"after");var F=this.editor.attributeInspector;this.own(c(k,"click",v.hitch(this,function(){if(this._isEditingSession){var E=F._currentFeature&&F._currentFeature._wabSetTemporaryAttributes,J=F._currentFeature,Q=J&&
J.getLayer(),U=new g(v.clone(J.toJson()));if(Q){for(var Y in E)E.hasOwnProperty(Y)&&"function"!==typeof E[Y]&&(J.attributes[Y]=E[Y]);E=new g;E.setAttributes(J.attributes);this.editor._applyEdits([{layer:Q,updates:[E],preUpdates:[U]}],v.hitch(this,function(){this._stopEditingSession()}),!0)}}})));var K=this;F.onAttributeChange=v.hitch(F,function(E,J,Q){K._startEditingSession();F._currentFeature._wabSetTemporaryAttributes[J]=Q});this.editPopup.hideWidthConfirmDialog=this._wrapExistFunctionWithConfirmDialog(this.editPopup,
this.editPopup.hideWidthConfirmDialog);this.editor.attributeInspector.next=this._wrapExistFunctionWithConfirmDialog(this.editor.attributeInspector,this.editor.attributeInspector.next);this.editor.attributeInspector.previous=this._wrapExistFunctionWithConfirmDialog(this.editor.attributeInspector,this.editor.attributeInspector.previous);this.own(l.before(this.editor,"_deleteFeature",v.hitch(this,function(){this._configEditor.usingSaveButton&&this._stopEditingSession()})))}},_startEditingSession:function(){var k=
this.editor.attributeInspector;k._currentFeature&&!k._currentFeature._wabSetTemporaryAttributes&&(k._currentFeature._wabSetTemporaryAttributes={});this._isEditingSession||(this._isEditingSession=!0,this._disableMapClickHandler(),this._temporatyMapClickHandle=c(this.map,"click",v.hitch(this,function(){this.editPopup.hide("clear-selection")})),window.onbeforeunload=v.hitch(this,function(){return""}));f(".atiButton.save-button",this.editPopup.domNode).removeClass("disable")},_stopEditingSession:function(){if(this.editor){var k=
this.editor.attributeInspector;k._currentFeature&&k._currentFeature._wabSetTemporaryAttributes&&(k._currentFeature._wabSetTemporaryAttributes=null);this._isEditingSession&&(this._isEditingSession=!1,"active"===this.state?this._enableMapClickHandler():(this.editor._clearSelection(),this.editPopup.hide()),this._temporatyMapClickHandle&&this._temporatyMapClickHandle.remove(),window.onbeforeunload=null);f(".atiButton.save-button",this.editPopup.domNode).addClass("disable")}},_wrapExistFunctionWithConfirmDialog:function(k,
F){return v.hitch(this,function(K){if(this._isEditingSession){if(!this.editPopup.jimuPopup){var E=arguments;this._popupConfirmDialog(v.hitch(this,function(){F.apply(k,E);"clear-selection"===K&&this.editor._clearSelection()}),null)}}else F.apply(k,arguments)})},_popupConfirmDialog:function(k,F){var K=new n,E=f(".esriPopupWrapper",this.editPopup.domNode)[0];this._isEditingSession&&!this.editPopup.jimuPopup&&E?this.editPopup.jimuPopup=new d({content:window.jimuNls.popup.leaveConfirm,container:E,width:400,
height:175,buttons:[{label:window.jimuNls.common.leave,onClick:v.hitch(this,function(){this.editPopup.jimuPopup.close();this.editPopup.jimuPopup=null;this._stopEditingSession();this._refreshAttributeInspector();k&&k();K.resolve(!0)})},{label:window.jimuNls.common.stay,classNames:["jimu-btn-cancle"],onClick:v.hitch(this,function(){this.editPopup.jimuPopup.close();this.editPopup.jimuPopup=null;F&&F();K.resolve(!1)})}]}):K.resolve(!0);return K},_addFilterEditor:function(k){this._configEditor.useFilterEdit&&
(this._filterEditor=new S({_settings:k,_editWidget:this},y.create("div",{},this.domNode)))},_worksBeforeCreate:function(k){var F="\x3cbr/\x3e("+this.nls.pressStr+"\x3cb\x3e"+this.nls.ctrlStr+"\x3c/b\x3e "+this.nls.snapStr+")";this._defaultStartStr=m.toolbars.draw.start;this._defaultAddPointStr=m.toolbars.draw.addPoint;m.toolbars.draw.start+=F;m.toolbars.draw.addPoint+=F;this._changeToServiceRenderer(k)},_worksAfterCreate:function(k){this._addButtonToInspector();this._configEditor.toolbarVisible&&
this._disableDeleteBtnInToolbar();this.editPopup.resize(500,251);this.editor.templatePicker.update(!0);this._addFilterEditor(k);this._bindEventsAfterCreate(k);this._changeMessageForTemplatePicker();this.ATILoading=(new r({hidden:!0})).placeAt(this.editor.attributeInspector.domNode);this.editor.own(l.before(this.editor._selectionHelper,"selectFeatures",v.hitch(this.editor._selectionHelper,function(E,J,Q,U){return[z.filter(E,function(Y){if(!0===Y.visible&&!0===Y._isMapAtVisibleScale())return!0}),J,
Q,U]})));var F=k=null,K=p.getSelection(this._settingsParam.layers);K&&K.length&&(k=K[0],F=k.getLayer());F&&C.getInstance().addFeaturesToSelection(F,[k]);this._createOverDef.resolve()},_worksAfterDestory:function(){this._stopEditingRelatedGraphic();m.toolbars.draw.start=this._defaultStartStr;m.toolbars.draw.addPoint=this._defaultAddPointStr;this._filterEditor&&this._filterEditor.destroy();this._releaseEventAfterDestory();this.editor&&this.editor.destroy();this.editor=null},_bindEventsAfterCreate:function(k){this.own(c(this.editor.editToolbar,
"graphic-move-stop",v.hitch(this,this._onGraphicMoveStop)));this.own(c(this.editor.attributeInspector,"next",v.hitch(this,this._onNextOfEditorATI)));var F=c(this.editPopup,"show",v.hitch(this,this._onEditorPopupShow));this._releaseEventArrayAfterDestory.push(F);F=c(this.editPopup,"hide",v.hitch(this,this._onEditorPopupHide));this._releaseEventArrayAfterDestory.push(F);z.forEach(k.layerInfos,function(K){F=c(K.featureLayer,"selection-complete",v.hitch(this,this._onLayerSelectionChange));this._releaseEventArrayAfterDestory.push(F)},
this);F=l.before(this.editor.templatePicker.grid,"onRowClick",v.hitch(this,function(){"active"!==this.state&&this.widgetManager.activateWidget(this)}));this._releaseEventArrayAfterDestory.push(F);k=c(this.editor.templatePicker,"selection-change",v.hitch(this,function(){this.editor.templatePicker&&!this.editor.templatePicker.getSelected()&&this._layerInfosChangedWhenEditingSessionFlag&&(this._layerInfosChangedWhenEditingSessionFlag=!1,this._isInEditingRelatedGraphicSession||this._onLayerInfosChanged())}));
this._releaseEventArrayAfterDestory.push(k);F=l.before(this.editor,"_activateDrawToolbar",v.hitch(this,function(){this.editor&&this.editor.drawingToolbar&&this.editor.drawingToolbar._tools&&this.editor.drawingToolbar._tools.EDITING&&(this.editor.drawingToolbar._tools.EDITING._geometryType=null);return arguments}));this._releaseEventArrayAfterDestory.push(F);F=c(this._jimuLayerInfos,"layerInfosChanged",v.hitch(this,this._onLayerAddedOrRemoved));this._releaseEventArrayAfterDestory.push(F)},_releaseEventAfterDestory:function(){z.forEach(this._releaseEventArrayAfterDestory,
function(k){k.remove()},this);this._releaseEventArrayAfterDestory=[]},_bindEventAfterActive:function(){var k=l.before(this.map,"onClick",v.hitch(this,this._beforeMapClick));this._releaseEventArrayAfterActive.push(k)},_releaseEventAfterActive:function(){z.forEach(this._releaseEventArrayAfterActive,function(k){k.remove()},this);this._releaseEventArrayAfterActive=[]},_bindEventAfterOpen:function(){var k=c(this._jimuLayerInfos,"layerInfosIsShowInMapChanged",v.hitch(this,this._onLayerInfosChanged));this._releaseEventArrayAfterClose.push(k);
k=c(this._jimuLayerInfos,"layerInfosReorder",v.hitch(this,this._onLayerInfosChanged));this._releaseEventArrayAfterClose.push(k);k=c(this.map,"zoom-end",v.hitch(this,this._onLayerInfosChanged));this._releaseEventArrayAfterClose.push(k)},_releaseEventAfterClose:function(){z.forEach(this._releaseEventArrayAfterClose,function(k){k.remove()},this);this._releaseEventArrayAfterClose=[]},_onLayerAddedOrRemoved:function(k,F){var K=this._configEditor.layerInfos&&0===this._configEditor.layerInfos.length;K=this._configEditor.honorSettingOfWebmap||
K;F===h.ADDED&&K?z.some(this._jimuLayerInfos.getLayerInfoArrayOfWebmap(),function(E){return E.id===k.id?!0:!1})||k.isEditable().then(v.hitch(this,function(E){E&&("opened"===this.state||"active"===this.state?this._refresh():this._newAddedLayersWhileEditWidgetIsClosed.push(k.id))})):F===h.REMOVED&&this._onLayerInfosChanged()},_onLayerInfosChanged:function(){if(this.editor.templatePicker&&this.editor.templatePicker.getSelected())this._layerInfosChangedWhenEditingSessionFlag=!0;else{var k=[];this._isInEditingRelatedGraphicSession?
this._startEditingRelatedGraphic(this._temporaryDataForEditingRelatedGraphicSession.currentOperationData,this._temporaryDataForEditingRelatedGraphicSession.currentIntegrityField,!0,!0):(k=this._obtainTemplatePickerLayerObjectsParam(this._settingsParam.layerInfos),this._update(k))}},_changeToServiceRenderer:function(k){z.forEach(k.layerInfos,function(F){var K=F.featureLayer.renderer,E=a.parse(F.featureLayer._json).drawingInfo.renderer,J=null;J=null;"esri.renderer.HeatmapRenderer"===K.declaredClass&&
(J=X.fromJson(E),J="esri.renderer.HeatmapRenderer"===J.declaredClass?new H(new O({size:5})):J,F._layerRenderer=K,this._layerInfoParamArrayUseForRervertRenderre.push(F),F.featureLayer.setRenderer(J),F.featureLayer.redraw())},this)},_revertToLayerRenderer:function(){z.forEach(this._layerInfoParamArrayUseForRervertRenderre,function(k){k._layerRenderer&&(k.featureLayer.setRenderer(k._layerRenderer),k.featureLayer.redraw())},this);this._layerInfoParamArrayUseForRervertRenderre=[]},_requeryFeature:function(k,
F){var K=k&&k.getLayer&&k.getLayer();if(K&&!this._isTemporaryFeatureForAddOnlyMode(k)){var E=new I(K.url),J=new A;K=k.attributes[K.objectIdField];J.objectIds=[K];J.outSpatialReference=this.map.spatialReference;J.returnGeometry=!1;J.outFields=["*"];F&&this.ATILoading.show();K&&E.execute(J).then(v.hitch(this,function(Q){if(Q&&Q.features&&Q.features[0]){Q=Q.features[0];for(var U in k.attributes)k.attributes.hasOwnProperty(U)&&"function"!==typeof k.attributes[U]&&k.attributes[U]!==Q.attributes[U]&&(k.attributes[U]=
Q.attributes[U]);this._refreshAttributeInspector()}F&&this.ATILoading.hide()}),v.hitch(this,function(){F&&this.ATILoading.hide()}))}},_pushToNeedRequeryFeatureArray:function(k){var F=k&&k.getLayer&&k.getLayer();if(F){var K=k.attributes[F.objectIdField];z.some(this._needToRequeryFeatureArray,function(E){var J=E.getLayer();E=E.attributes[J.objectIdField];if(F.id===J.id&&K===E)return!0},this)||this._needToRequeryFeatureArray.push(k)}},_updateSelectedFeature:function(k){k&&(k.getLayer().applyEdits(null,
[k]),this.editor._clearSelection())},_autoApplyEditWhenGeometryIsModified:function(){var k=this.editor.editToolbar.getCurrentState(),F=k&&k.graphic;this._configEditor.autoApplyEditWhenGeometryIsMoved&&(this._checkStickyMoveTolerance()?this._updateSelectedFeature(F):k.isModified&&"point"!==F.geometry.type&&this._updateSelectedFeature(F))},_checkStickyMoveTolerance:function(){var k=!0,F=this.editor.editToolbar.getCurrentState();if(F=F&&F.graphic)this._isOutStickyMoveToleranceCheckedByMoveTrack(F)||
(this._revertGraphicPosition(F),k=!1),delete F._moveTrack,delete F._originalGeometryAtMoveStart;return k},_isOutStickyMoveToleranceCheckedByOriginalGeometry:function(k){var F=!0;if("point"===k.geometry.type){var K=k._originalGeometryAtMoveStart;var E=k.geometry}else k.geometry.getExtent&&k._originalGeometryAtMoveStart.getExtent&&(K=k._originalGeometryAtMoveStart.getExtent().getCenter(),E=k.geometry.getExtent().getCenter());if(this._configEditor.stickyMoveTolerance&&K&&E){var J=this.map.extent.getWidth();
J/=this.map.width;J*=this._configEditor.stickyMoveTolerance;k=new D(0,0,J,J,k.spatialReference);k=k.centerAt(K);k.contains(E)&&(F=!1)}return F},_isOutStickyMoveToleranceCheckedByMoveTrack:function(k){var F=!0;var K=k._moveTrack;var E;K&&(E=new P(K.x,K.y,k.spatialReference));this._configEditor.stickyMoveTolerance&&E&&(K=this.map.extent.getWidth(),K/=this.map.width,K*=this._configEditor.stickyMoveTolerance,k=new D(-K/2,-K/2,K,K,k.spatialReference),k.contains(E)&&(F=!1));return F},_revertGraphicPosition:function(k){var F=
k._moveTrack;if(F){switch(k.geometry.type){case "point":k.geometry.x-=F.x;k.geometry.y+=F.y;break;case "polygon":z.forEach(k.geometry.rings,function(K){z.forEach(K,function(E){E[0]-=F.x;E[1]+=F.y})});break;case "polyline":z.forEach(k.geometry.paths,function(K){z.forEach(K,function(E){E[0]-=F.x;E[1]+=F.y})});break;case "multiPoint":z.forEach(k.geometry.points,function(K){K[0]-=F.x;K[1]+=F.y});break;default:return}this._configEditor.autoApplyEditWhenGeometryIsMoved||z.forEach(this.editor.editToolbar._getAffectedTools("MOVE"),
function(K){K.suspend()},this);this.editor._clearSelection();k.draw()}},_recordsSelectedFeatureInfoWhenMoveStart:function(k){(k=k&&k.graphic)&&k.geometry&&(k._originalGeometryAtMoveStart=v.clone(k.geometry))},_recordsSelectedFeatureInfoWhenMoveStop:function(k){var F=k&&k.graphic;k=k&&k.transform;var K=this.map.extent.getWidth()/this.map.width;F&&k&&(F._moveTrack||(F._moveTrack={x:0,y:0}),F._moveTrack.x+=k.dx*K,F._moveTrack.y+=k.dy*K)},_getSelectionFeatuers:function(){var k=[];z.forEach(this.layerInfosParam,
function(F){F=F.featureLayer.getSelectedFeatures();k=k.concat(F)});return k},_getEditCapabilitiesByFeature:function(k){var F={},K=k&&k.getLayer&&k.getLayer();if(K&&K.isEditable&&K.isEditable()){var E=this._getLayerInfoOrTableInfoParamById(K.id);K&&(F=R.getEditCapabilities(K,E,{feature:k}))}return F},_createRelatedRecordsEditor:function(k){if(k&&!this._isTemporaryFeatureForAddOnlyMode(k)){var F=y.create("div",{style:"position: relative"});y.place(F,this.editor.attributeInspector.domNode,"after");var K=
(new r({})).placeAt(F);return this._tableInfoParamDef.then(v.hitch(this,function(){try{this._relatedRecordsEditor&&(this._relatedRecordsEditor.destroy(),this._relatedRecordsEditor=null),this._relatedRecordsEditor=new W({originalFeature:k,editorATI:this.editor.attributeInspector,tableInfosParam:this.layerInfosParamClone.concat(this.tableInfosParamClone),nls:v.mixin(v.clone(this.nls),window.jimuNls.common),_editWidget:this}),K.destroy()}catch(E){console.warn(E.message),K.destroy(),this._enableToAnswerEventForEditorATI()}}))}},
_disableToAnswerEventForEditorATI:function(){this._mapInfoStorage.editorATIonLayerSelectionChange||(this._mapInfoStorage.editorATIonLayerSelectionChange=this.editor.attributeInspector.onLayerSelectionChange,this.editor.attributeInspector.onLayerSelectionChange=v.hitch(this,function(){}));this._mapInfoStorage.editorATIonLayerSelectionClear||(this._mapInfoStorage.editorATIonLayerSelectionClear=this.editor.attributeInspector.onLayerSelectionClear,this.editor.attributeInspector.onLayerSelectionClear=
v.hitch(this,function(){}))},_enableToAnswerEventForEditorATI:function(){this._mapInfoStorage.editorATIonLayerSelectionChange&&(this.editor.attributeInspector.onLayerSelectionChange=v.hitch(this.editor.attributeInspector,this._mapInfoStorage.editorATIonLayerSelectionChange),this._mapInfoStorage.editorATIonLayerSelectionChange=null);this._mapInfoStorage.editorATIonLayerSelectionClear&&(this.editor.attributeInspector.onLayerSelectionClear=v.hitch(this.editor.attributeInspector,this._mapInfoStorage.editorATIonLayerSelectionClear),
this._mapInfoStorage.editorATIonLayerSelectionClear=null)},_getTableInfosParam:function(){var k=[],F=[];var K=this._configEditor.honorSettingOfWebmap?this._getDefaultTableInfos():this._configEditor.tableInfos?0<this._configEditor.tableInfos.length?this._converConfiguredLayerInfos(this._configEditor.tableInfos):this._getDefaultTableInfos():[];z.forEach(K,function(E){var J=this._jimuLayerInfos.getTableInfoById(E.featureLayer.id);J&&(E.jimuTableInfo=J,k.push(J.getLayerObject()))},this);return b(k).then(v.hitch(this,
function(){z.forEach(K,function(E){if(E.jimuTableInfo){var J=E.jimuTableInfo.layerObject,Q=E.jimuTableInfo.getCapabilitiesOfWebMap();Q=Q&&-1===Q.toLowerCase().indexOf("editing")?!1:!0;J&&J.visible&&J.isEditable&&J.isEditable()&&Q&&(E.featureLayer=E.jimuTableInfo.layerObject,delete E.jimuTableInfo,F.push(E))}},this);return F}))},_startEditingRelatedGraphic:function(k,F,K,E){this._stopEditingRelatedGraphic();this._temporaryDataForEditingRelatedGraphicSession.currentOperationData=k;this._temporaryDataForEditingRelatedGraphicSession.currentIntegrityField=
F;this._isInEditingRelatedGraphicSession=!0;var J=k.destJimuLayerInfo,Q=k.destJimuLayerInfo.layerObject;K||(this.editPopup.hide(),this.editor._clearSelection());y.removeClass(this.editRelatedGraphicPart,"disable");y.setStyle(this.editor.templatePicker.domNode,"top",this._configEditor.useFilterEdit?V.TOP_WITH_TEMPLATE_FILTER_AND_EDIT_RG:V.TOP_WITH_EDIT_RG);K=[];J.isShowInMap()&&J.isInScale()&&(K=[Q]);this._setTemplatePickerLayerObjectsParam(K);this._update(K);this._filterEditor&&(this._filterEditor.selectLayerFilterByValue(Q.id),
this._filterEditor.disableLayerFilter());F.hasRelationshipTable?(J=c(Q,"edits-complete",v.hitch(this,function(Y){if(Y&&Y.adds&&1===Y.adds.length){var Z=Y.adds[0],aa=null;z.some(Q.graphics,function(ca){if(ca.attributes[Q.objectIdField]===Z.objectId)return aa=ca,!0});aa&&this._relatedRecordsEditor._addNewRelationshipReocrd(aa,k)}})),this._releaseEventArrayAfterEditingRelatedGraphic.push(J)):(J=c(this.editor.templatePicker,"selection-change",v.hitch(this,function(){var Y=this.editor.templatePicker.getSelected();
(Y=Y&&Y.template)&&!v.getObject("_wabProperties.originalInterityField",!1,Y)&&Y.prototype&&Y.prototype.attributes&&(v.setObject("_wabProperties.originalInterityField.key",F.key,Y),v.setObject("_wabProperties.originalInterityField.value",Y.prototype.attributes[F.key],Y),Y.prototype.attributes[F.key]=F.value,this._changedTemplatesOfTemplatePicker.push(Y))})),this._releaseEventArrayAfterEditingRelatedGraphic.push(J));if(!E){E=f(".itemSymbol",this.editor.templatePicker.domNode);if(E&&0<E.length)var U=
(U=E[0])&&U.parentNode&&U.parentNode.parentNode;U&&this.editor.templatePicker._rowClicked({cellNode:U,rowIndex:1,cellIndex:0})}},_stopEditingRelatedGraphic:function(){this._isInEditingRelatedGraphicSession&&(this._temporaryDataForEditingRelatedGraphicSession={},y.addClass(this.editRelatedGraphicPart,"disable"),y.setStyle(this.editor.templatePicker.domNode,"top",this._configEditor.useFilterEdit?V.TOP_WITH_TEMPLATE_FILTER:V.TOP),z.forEach(this._releaseEventArrayAfterEditingRelatedGraphic,function(k){k&&
k.remove&&k.remove()},this),this._releaseEventArrayAfterEditingRelatedGraphic=[],z.forEach(this._changedTemplatesOfTemplatePicker,function(k){if(v.getObject("_wabProperties.originalInterityField",!1,k)&&k.prototype&&k.prototype.attributes){var F=v.getObject("_wabProperties.originalInterityField.key",!1,k),K=v.getObject("_wabProperties.originalInterityField.value",!1,k);k.prototype.attributes[F]=K}},this),this._changedTemplatesOfTemplatePicker=[],this._filterEditor&&this._filterEditor.enableLayerFilter(),
this.editor.templatePicker.clearSelection(),this._isInEditingRelatedGraphicSession=!1,this._onLayerInfosChanged())},_changeMessageForTemplatePicker:function(){if(this.editor&&0===this.editor.templatePicker.featureLayers.length){var k=f("[class~\x3ddojoxGridMasterMessages]",this.editor.templatePicker.domNode);k&&k[0]&&(k[0].innerHTML=this._canCreateLayersAreAllInvisibleFlag?this.nls.noCanCreateLayerAreCurrentlyVisible:window.jimuNls.noEditableLayers)}},_refreshAttributeInspector:function(){this.editor&&
this.editor.attributeInspector&&this.editor.attributeInspector.refresh();this.editPopup.isShowing&&this._updateDeleteButtonInPopup(this.editor&&this.editor.attributeInspector&&this.editor.attributeInspector._currentFeature)},_updateOperationalButtons:function(k){this._updateDeleteButtonInPopup(k);this._updateGeometryOperationButtons(k)},_updateDeleteButtonInPopup:function(k){this._getEditCapabilitiesByFeature(k).canDelete?this._enableDeleBtnInPopup():this._disableDeleteBtnInPopup()},_disableDeleteBtnInToolbar:function(){this._configEditor.toolbarVisible&&
f("[class~\x3ddeleteFeatureIcon]",this.editor.domNode).style("display","none")},_enableDeleBtnInToolbar:function(){this._configEditor.toolbarVisible&&f("[class~\x3ddeleteFeatureIcon]",this.editor.domNode).style("display","inline-block")},_disableDeleteBtnInPopup:function(){f(".atiButton.atiDeleteButton",this.editPopup.domNode).style("display","none")},_enableDeleBtnInPopup:function(){f(".atiButton.atiDeleteButton",this.editPopup.domNode).style("display","block")},_updateGeometryOperationButtons:function(k){var F=
k&&k.getLayer&&k.getLayer();k=this._getEditCapabilitiesByFeature(k);!F||k.canUpdateGeometry?this._enableGeometryOperationButtons():this._disableGeometryOperationButtons()},_disableGeometryOperationButtons:function(){this._configEditor.toolbarVisible&&(f("[widgetid\x3dbtnFeatureCut]",this.editor.domNode).style("display","none"),f("[widgetid\x3dbtnFeatureUnion]",this.editor.domNode).style("display","none"),f("[widgetid\x3dbtnFeatureReshape]",this.editor.domNode).style("display","none"),(this._configEditor.toolbarOptions.mergeVisible||
this._configEditor.toolbarOptions.cutVisible||this._configEditor.toolbarOptions.reshapeVisible)&&f("[widgetid^\x3ddijit_ToolbarSeparator]",this.editor.domNode).last().style("display","none"))},_enableGeometryOperationButtons:function(){this._configEditor.toolbarVisible&&(f("[widgetid\x3dbtnFeatureCut]",this.editor.domNode).style("display","inline-block"),f("[widgetid\x3dbtnFeatureUnion]",this.editor.domNode).style("display","inline-block"),f("[widgetid\x3dbtnFeatureReshape]",this.editor.domNode).style("display",
"inline-block"),(this._configEditor.toolbarOptions.mergeVisible||this._configEditor.toolbarOptions.cutVisible||this._configEditor.toolbarOptions.reshapeVisible)&&f("[widgetid^\x3ddijit_ToolbarSeparator]",this.editor.domNode).last().style("display","inline-block"))},_updateDeleteButtonInToolbarBySelectionFeatures:function(){var k=!0,F=this._getSelectionFeatuers();0===F.length?k=!1:z.some(F,function(K){if(!this._getEditCapabilitiesByFeature(K).canDelete)return k=!1,!0},this);k?this._enableDeleBtnInToolbar():
this._disableDeleteBtnInToolbar()},_update:function(k){this.editor&&(k&&(this._filterEditor&&this._filterEditor.update(),this.editor.templatePicker.featureLayers=k),this.editor.templatePicker.clearSelection(),this.editor.templatePicker.update(!0),this._changeMessageForTemplatePicker())},resize:function(){this._update()},onNormalize:function(){setTimeout(v.hitch(this,this._update),100)},onMinimize:function(){},onMaximize:function(){setTimeout(v.hitch(this,this._update),100)},reClickMap:function(k){this._createOverDef.then(v.hitch(this,
function(){this.map.onClick(k)}))},_onGraphicMoveStart:function(k){this._recordsSelectedFeatureInfoWhenMoveStart(k)},_onGraphicMoveStop:function(k){this._recordsSelectedFeatureInfoWhenMoveStop(k);this._autoApplyEditWhenGeometryIsModified(k)},_onGraphicChangeStop:function(k){this._autoApplyEditWhenGeometryIsModified(k)},_beforeMapClick:function(){this._configEditor.autoApplyEditWhenGeometryIsMoved||this._checkStickyMoveTolerance()},_onEditorPopupShow:function(){var k=this.editor.attributeInspector._currentFeature;
this._disableToAnswerEventForEditorATI();this._createRelatedRecordsEditor(k);this._pushToNeedRequeryFeatureArray(k);this._requeryFeature(k,!0);this._updateOperationalButtons(k)},_onEditorPopupHide:function(){this._enableToAnswerEventForEditorATI()},_onNextOfEditorATI:function(k){this._createRelatedRecordsEditor(k.feature);this._pushToNeedRequeryFeatureArray(k.feature);this._requeryFeature(k.feature,!0);this._updateOperationalButtons(k.feature)},_onLayerSelectionChange:function(){this._updateDeleteButtonInToolbarBySelectionFeatures()}});
V.EditPopup=N([G],{preamble:function(){this.originalHide=v.hitch(this,this.hide);this.hide=v.hitch(this,function(k){this.hideWidthConfirmDialog(k)});B.setScrollable&&(this.originalSetScrollableDomUtils=B.setScrollable,B.setScrollable=function(){return[{remove:function(){}},{remove:function(){}}]})},constructor:function(){B.setScrollable=this.originalSetScrollableDomUtils},hideWidthConfirmDialog:function(k){this.originalHide()}});v.mixin(V,{TOP:"18px",TOP_WITH_TEMPLATE_FILTER:"115px",TOP_WITH_EDIT_RG:"53px",
TOP_WITH_TEMPLATE_FILTER_AND_EDIT_RG:"155px"});return V});