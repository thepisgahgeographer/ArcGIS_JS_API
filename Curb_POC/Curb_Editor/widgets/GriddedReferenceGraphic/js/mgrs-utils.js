// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/json ./constants ./geometry-utils ./geometryUtils ./mgrs ./NonPolarGridZone ./VisibleGridZone ./GridPolygon esri/geometry/geometryEngine esri/geometry/Point esri/geometry/Polygon".split(" "),function(D,p,l,I,y,K,L,J,A,E,F){Math.log10||(Math.log10=function(a){return Math.log(a)/Math.LN10});return{_ZonesDictionary:function(){var a,m,c,u="CDEFGHJKLMNPQRSTUVWX".split(""),v={},f=function(d,q){var g=d+u[q];if("32X"===g||"34X"===g||"36X"===g)return null;if("31V"===g)var e={xmin:0,ymin:56,xmax:3,
ymax:64,id:g};else if("32V"===g)e={xmin:3,ymin:56,xmax:12,ymax:64,id:g};else if("31X"===g)e={xmin:0,ymin:72,xmax:9,ymax:84,id:g};else if("33X"===g)e={xmin:9,ymin:72,xmax:21,ymax:84,id:g};else if("35X"===g)e={xmin:21,ymin:72,xmax:33,ymax:84,id:g};else if("37X"===g)e={xmin:33,ymin:72,xmax:42,ymax:84,id:g};else{e=(d-1)*p.ZONE_WIDTH_DEGREES-180;d=d*p.ZONE_WIDTH_DEGREES-180;var z=q*p.ZONE_HEIGHT_DEGREES+p.MIN_MGRS_LATITUDE;q=(q+1)*p.ZONE_HEIGHT_DEGREES+p.MIN_MGRS_LATITUDE;e=180===e?p.POSITIVE_180:e;e=
-180===e?p.NEGATIVE_180:e;d=180===d?p.POSITIVE_180:d;d=-180===d?p.NEGATIVE_180:d;80===q&&(q=p.MAX_MGRS_LATITUDE);e={xmin:e,ymin:z,xmax:d,ymax:q,id:g}}return new K(e)};for(a=1;60>=a;a++)for(m=0;m<u.length;m++)(c=f(a,m))&&(v[c.id]=c);for(a=1;60>=a;a++){var w=[];for(m=0;m<u.length;m++)if(c=f(a,m))c=new F({rings:D.parse(D.stringify(c._rings))}),w.push(c);w=A.union(w);for(m=0;m<u.length;m++)(c=f(a,m))&&(v[c.id.fullZoneGeometry]=w)}return v}(),zonesFromExtent:function(a,m){var c=a.spatialReference.isWebMercator()?
p.WEBMERCATOR_360:p.GEOGRAPHIC_360,u="CDEFGHJKLMNPQRSTUVWX".split(""),v=[];if(a.xmax-a.xmin>c)return v;c=l.extentToPolygon(a);c=l.toWebMercator(c);var f=l.pointToGeographic(new E([a.xmin,a.ymin],a.spatialReference)),w=l.pointToGeographic(new E([a.xmax,a.ymax],a.spatialReference));a=f.y;var d=w.y;var q=f.offsetX;var g=w.offsetX;for(var e=q;e<=g;e++){var z=e>q?p.NEGATIVE_180:f.x;var r=e<g?p.POSITIVE_180:w.x;var b=Math.min(Math.max(Math.floor((a+80)/p.ZONE_HEIGHT_DEGREES),0),19);var t=Math.min(Math.floor((d+
80)/p.ZONE_HEIGHT_DEGREES),19);z=Math.floor((z+180)/p.ZONE_WIDTH_DEGREES);for(r=Math.min(Math.floor((r+180)/p.ZONE_WIDTH_DEGREES)+2,60);z<=r;z++)for(var n=b;n<=t;n++){var h=u[n];h=z+h;if(this._ZonesDictionary[h]){var k=D.parse(D.stringify(this._ZonesDictionary[h]._rings));for(var x=0;x<k[0].length;x++)k[0][x][0]+=e*p.GEOGRAPHIC_360;k=new F({rings:k});(k=A.intersect(l.toWebMercator(k),c))&&v.push(new L({map:m,polygon:k,fullZoneGeometry:this._ZonesDictionary[h].fullZoneGeometry,offset:e,nonPolarGridZone:this._ZonesDictionary[h],
utmZone:this._ZonesDictionary[h].utmZone,latitudeBand:this._ZonesDictionary[h].latitudeZone}))}}}return v},processZonePolygons:function(a,m,c){var u=[];c=l.toWebMercator(c);for(var v=0;v<a.length;v++){var f=a[v];if(f){var w=f.nonPolarGridZone.latitudeZone,d=l.toGeographic(f.polygon.getExtent()),q=y.LLtoUTM(d.ymin,d.xmin,f.nonPolarGridZone.utmZone),g=y.LLtoUTM(d.ymin,d.xmax,f.nonPolarGridZone.utmZone),e=y.LLtoUTM(d.ymax,d.xmax,f.nonPolarGridZone.utmZone);d=y.LLtoUTM(d.ymax,d.xmin,f.nonPolarGridZone.utmZone);
f={minE:Math.min(q[0],g[0],e[0],d[0]),maxE:Math.max(q[0],g[0],e[0],d[0]),minN:Math.min(q[1],g[1],e[1],d[1]),maxN:Math.max(q[1],g[1],e[1],d[1]),utmZone:f.nonPolarGridZone.utmZone,latitudeZone:w,polygon:f.polygon,offset:f.offset,fullZoneGeometry:l.extentToPolygon(f.nonPolarGridZone.extent)};u=u.concat(this.handle100kGrids(f,m,c))}}return u},handle100kGrids:function(a,m,c){var u=a.polygon,v=a.offset,f=a.utmZone,w=a.latitudeZone,d=a.fullZoneGeometry,q=a.minE,g=a.maxE,e=a.maxN,z=[],r,b;for(a=1E5*Math.floor(a.minN/
1E5);a<e;a+=1E5)for(r=1E5*Math.floor(q/1E5);r<g;r+=1E5){var t=y.findGridLetters(f,0>a+5E4?1E7+(a+5E4):a+5E4,r+5E4);var n=[];for(b=r;b<=r+1E5;b+=1E4){var h=y.UTMtoLL(a,b,f);n.push([h.lon,h.lat])}for(b=a;b<a+1E5;b+=1E4)h=y.UTMtoLL(b,r+1E5,f),n.push([h.lon,h.lat]);for(b=r+1E5;b>=r;b-=1E4)h=y.UTMtoLL(a+1E5,b,f),n.push([h.lon,h.lat]);for(b=a+1E5;b>=a;b-=1E4)h=y.UTMtoLL(b,r,f),n.push([h.lon,h.lat]);for(b=0;b<n.length;b++)n[b][0]+=v*p.GEOGRAPHIC_360;b=new F([n]);n=I.getAngleBetweenPoints(b.getPoint(0,b.rings[0].length-
1),b.getPoint(0,b.rings[0].length-2));h=A.rotate(l.extentToPolygon(c),-1*n);n=A.intersect(l.toWebMercator(b),l.toWebMercator(u));h=A.intersects(h,l.toWebMercator(b));if(n||h){var k;h&&(k=A.intersect(l.toWebMercator(b),l.toWebMercator(d)));t={clippedPolygon:n,unclippedPolygon:b,clippedPolyToUTMZone:k,map:m,xmin:r,ymin:a,xmax:r+1E5,ymax:a+1E5,x:"",y:"",minMaxType:"utm",utmZone:f,latitudeZone:w,utmZonePoly:u,fullZoneGeometry:d,GZD:t,text:t};k&&(t=new J(t),z.push(t))}}return z},handleGridSquares:function(a,
m,c,u){var v=[],f=a.utmZonePoly,w=a.latitudeZone,d=a.utmZone,q=a.fullZoneGeometry,g=a.GZD,e=a.xmin,z=a.xmax,r=a.ymin;a=a.ymax;var b,t,n=!0,h=!0;u=l.toWebMercator(u);for(b=Math.floor(r/c)*c;b<a;b+=c)for(t=Math.floor(e/c)*c;t<z;t+=c){var k=[];var x=y.UTMtoLL(b,t,d);k.push([x.lon,x.lat]);var B=y.UTMtoLL(b+c,t,d);k.push([B.lon,B.lat]);var C=y.UTMtoLL(b+c,t+c,d);k.push([C.lon,C.lat]);C=y.UTMtoLL(b,t+c,d);k.push([C.lon,C.lat]);k.push([x.lon,x.lat]);k=new F([k]);C=A.intersect(l.toWebMercator(l.extentToPolygon(u)),
l.toWebMercator(q));if(n&&h){var G=I.getAngleBetweenPoints(new E(x.lon,x.lat),new E(B.lon,B.lat));G=A.rotate(C,-1*G)}x=A.intersect(l.toWebMercator(k),f);B=A.intersects(G,l.toWebMercator(k));var H;if(x||B){B&&(H=A.intersect(l.toWebMercator(k),l.toWebMercator(q)));B=g+this._padZero(t%1E5/c,5-Math.log10(c)).toString()+this._padZero((0>r?1E7+b:b)%1E5/c,5-Math.log10(c)).toString();k={clippedPolygon:x,unclippedPolygon:k,fullZoneGeometry:q,clippedPolyToUTMZone:H,map:m,xmin:t,ymin:b,xmax:t+c,ymax:b+c,x:this._padZero(t%
1E5/c,5-Math.log10(c)).toString(),y:this._padZero((0>r?1E7+b:b)%1E5/c,5-Math.log10(c)).toString(),minMaxType:"utm",utmZone:d,latitudeZone:w,GZD:g,utmZonePoly:f,text:B};if(!H)continue;n=new J(k);v.push(n)}h=n=!1}return v},_padZero:function(a,m){for(a=a.toString();a.length<m;)a="0"+a;return a}}});