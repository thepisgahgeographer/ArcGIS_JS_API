// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"dojox/gfx/fx":function(){define("dojo/_base/lang ./_base ./matrix dojo/_base/Color dojo/_base/array dojo/_base/fx dojo/_base/connect dojo/sniff".split(" "),function(ua,fa,K,A,k,I,L,va){function wa(r,u){this.start=r;this.end=u}function y(r,u,q){this.start=r;this.end=u;this.units=q}function z(r,u){this.start=r;this.end=u;this.temp=new A}function ba(r){this.values=r;this.length=r.length}function oa(r,u){this.values=r;this.def=u?u:{}}function V(r,u){this.stack=r;this.original=u}function P(r,
u,q,E){if(r.values)return new ba(r.values);var p;var C=r.start?fa.normalizeColor(r.start):p=u?q?u[q]:u:E;r.end?r=fa.normalizeColor(r.end):(p||(p=u?q?u[q]:u:E),r=p);return new z(C,r)}var aa=fa.fx={};wa.prototype.getValue=function(r){return(this.end-this.start)*r+this.start};y.prototype.getValue=function(r){return(this.end-this.start)*r+this.start+this.units};z.prototype.getValue=function(r){return A.blendColors(this.start,this.end,r,this.temp)};ba.prototype.getValue=function(r){return this.values[Math.min(Math.floor(r*
this.length),this.length-1)]};oa.prototype.getValue=function(r){var u=ua.clone(this.def),q;for(q in this.values)u[q]=this.values[q].getValue(r);return u};V.prototype.getValue=function(r){var u=[];k.forEach(this.stack,function(q){if(q instanceof K.Matrix2D)u.push(q);else if("original"==q.name&&this.original)u.push(this.original);else if("matrix"==q.name){if(q.start instanceof K.Matrix2D&&q.end instanceof K.Matrix2D){var E=new K.Matrix2D;for(p in q.start)E[p]=(q.end[p]-q.start[p])*r+q.start[p];u.push(E)}}else if(q.name in
K)if(E=K[q.name],"function"!=typeof E)u.push(E);else{var p=k.map(q.start,function(C,Q){return(q.end[Q]-C)*r+C});E=E.apply(K,p);E instanceof K.Matrix2D&&u.push(E)}},this);return u};var T=new A(0,0,0,0);aa.animateStroke=function(r){r.easing||(r.easing=I._defaultEasing);var u=new I.Animation(r),q=r.shape,E;L.connect(u,"beforeBegin",u,function(){E=q.getStroke();var p=r.color,C={};p&&(C.color=P(p,E,"color",T));(p=r.style)&&p.values&&(C.style=new ba(p.values));if(p=r.width){var Q=p,W=E;if(Q.values)var U=
new ba(Q.values);else p=Q.start?Q.start:U=W?W.width:1,Q.end?U=Q.end:"number"!=typeof U&&(U=W?W.width:1),U=new wa(p,U);C.width=U}(p=r.cap)&&p.values&&(C.cap=new ba(p.values));if(p=r.join)p.values?C.join=new ba(p.values):(U=p.start?p.start:E&&E.join||0,p=p.end?p.end:E&&E.join||0,"number"==typeof U&&"number"==typeof p&&(C.join=new wa(U,p)));this.curve=new oa(C,E)});L.connect(u,"onAnimate",q,"setStroke");return u};aa.animateFill=function(r){r.easing||(r.easing=I._defaultEasing);var u=new I.Animation(r),
q=r.shape,E;L.connect(u,"beforeBegin",u,function(){E=q.getFill();var p=r.color;p&&(this.curve=P(p,E,"",T))});L.connect(u,"onAnimate",q,"setFill");return u};aa.animateFont=function(r){r.easing||(r.easing=I._defaultEasing);var u=new I.Animation(r),q=r.shape,E;L.connect(u,"beforeBegin",u,function(){E=q.getFont();var p=r.style,C={};p&&p.values&&(C.style=new ba(p.values));(p=r.variant)&&p.values&&(C.variant=new ba(p.values));(p=r.weight)&&p.values&&(C.weight=new ba(p.values));(p=r.family)&&p.values&&(C.family=
new ba(p.values));if((p=r.size)&&p.units){var Q=parseFloat(p.start?p.start:q.font&&q.font.size||"0");var W=parseFloat(p.end?p.end:q.font&&q.font.size||"0");C.size=new y(Q,W,p.units)}this.curve=new oa(C,E)});L.connect(u,"onAnimate",q,"setFont");return u};aa.animateTransform=function(r){r.easing||(r.easing=I._defaultEasing);var u=new I.Animation(r),q=r.shape,E;L.connect(u,"beforeBegin",u,function(){E=q.getTransform();this.curve=new V(r.transform,E)});L.connect(u,"onAnimate",q,"setTransform");if("svg"===
fa.renderer&&(9<=va("ie")||va("ff")))var p=[L.connect(u,"onBegin",u,function(){for(var C=q.getParent();C&&C.getParent;)C=C.getParent();C&&(q.__svgContainer=C.rawNode.parentNode,q.__svgRoot=C.rawNode,q.__svgRoot&&q.__svgRoot.getAttribute&&(q.__svgWidth=parseInt(q.__svgRoot.getAttribute("width"),10),isNaN(q.__svgWidth)&&delete q.__svgWidth))}),L.connect(u,"onAnimate",u,function(){try{if(q.__svgContainer){var C=q.__svgContainer.style.visibility;q.__svgContainer.style.visibility="visible";q.__svgContainer.style.visibility=
C;var Q=q.__svgWidth;if(!isNaN(Q))try{q.__svgRoot.setAttribute("width",Q-5E-6),q.__svgRoot.setAttribute("width",Q)}catch(W){}}}catch(W){}}),L.connect(u,"onEnd",u,function(){k.forEach(p,L.disconnect);if(q.__svgContainer){var C=q.__svgContainer;if(null==C.getAttribute("__gotVis")){C.setAttribute("__gotVis",!0);var Q=q.__svgContainer.style.visibility,W=q.__svgRoot,U=q.__svgWidth;C.style.visibility="visible";setTimeout(function(){try{C.style.visibility=Q;C.removeAttribute("__gotVis");C=null;try{isNaN(U)||
(W.setAttribute("width",U-5E-6),W.setAttribute("width",U))}catch(pa){}}catch(pa){}},100)}}delete q.__svgContainer;delete q.__svgRoot;delete q.__svgWidth})];return u};return aa})},"widgets/InfoSummary/js/ClusterLayer":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/event dojo/_base/lang dojo/_base/Color dojo/_base/html dojo/DeferredList dojo/dom-class dojo/dom dojox/gfx/fx dojo/on dojo/Evented jimu/utils esri/layers/GraphicsLayer esri/graphic esri/geometry/Extent esri/geometry/Point esri/symbols/PictureMarkerSymbol esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/TextSymbol esri/symbols/Font esri/renderers/SimpleRenderer esri/tasks/query esri/tasks/QueryTask esri/tasks/FeatureSet esri/symbols/jsonUtils esri/renderers/jsonUtils esri/layers/FeatureLayer".split(" "),
function(ua,fa,K,A,k,I,L,va,wa,y,z,ba,oa,V,P,aa,T,r,u,q,E,p,C,Q,W,U,pa,Aa,ra){return ua("ClusterLayer",[V,ba],{constructor:function(g){this.clusterGraphics=[];this.cancelRequest=!1;this.clusterSize=120;this._singles=[];this._showSingles=!0;this.updateFeatures=void 0;this.hidePanel=g.hidePanel;this._parent=g._parent;this._parentLayer=g.parentLayer;this.layerDefinition=g.layerDefinition;this._parentLayer&&(this.objectIdField=this._parentLayer.objectIdField,this.fields=this._parentLayer.fields);this.name=
g.name;this._map=g.map;this.color=k.fromString(g.color||"#ff0000");this._styleColor=g._styleColor;this.symbolData=g.lyrInfo.symbolData;this.countColor=this.symbolData._highLightColor;this.itemId=g.lyrInfo.itemId;this.refresh=g.lyrInfo.refresh;this.displayFeatureCount=this.symbolData.displayFeatureCount;this.node=g.node;this.countEnabled=g.countEnabled;this.legendNode=g.legendNode;this.id=g.id;this.infoTemplate=g.infoTemplate;this.url=g.lyrInfo.url;this._testRenderer=g.lyrInfo.renderer;(this.originOperLayer=
g.originOperLayer)&&this._getInfoTemplate(this.originOperLayer);this.lyrInfo=g.lyrInfo;this.lyrType=g.lyrType;this.filter=g.filter;this.showAllFeatures=g.showAllFeatures;this.listDisabled=g.listDisabled;this.selfType=g.selfType;this._setupSymbols();this._setFieldNames();this.countFeatures(this._parentLayer);0<this._parentLayer.refreshInterval&&setInterval(A.hitch(this,this._updateEnd),6E4*this._parentLayer.refreshInterval)},countFeatures:function(g){var n=new Q;n.geometry=this.showAllFeatures?g.fullExtent:
this._map.extent;g.queryCount?g.queryCount(n,A.hitch(this,function(t){if(0<t)this.hidePanel||(this.nodeCount=t),this._initFeatures(this._parentLayer);else if(!this.hidePanel)if(this.nodeCount=0,g.url){var D=new ra(g.url);z(D,"load",A.hitch(this,function(){this.countFeatures(D)}))}else this._initFeatures(this._parentLayer)})):this._initFeatures(this._parentLayer)},_initFeatures:function(g){this._features=[];var n=!0,t=new Q;(-1<["CSV","Feature Collection","GeoRSS","KML"].indexOf(this.lyrType)||!this.url)&&
g.graphics?(this._getSourceFeatures(g.graphics),this.clusterFeatures()):"undefined"!==typeof this.url?this.loadData(this.url):(t.where=!this.showAllFeatures&&this.filter?this.filter:"1\x3d1",t.outFields=["*"],t.returnGeometry=!0,g.queryFeatures?g.queryFeatures(t).then(A.hitch(this,function(D){D.features&&(this._getSourceFeatures(D.features),this.clusterFeatures())})):n="error");"error"!==n&&(this.extentChangeSignal||(this.extentChangeSignal=this._map.on("extent-change",A.hitch(this,this.handleMapExtentChange))),
this.clickSignal||(this.clickSignal=this.on("click",A.hitch(this,this.handleClick))))},_getSourceFeatures:function(g){this._features=[];for(var n=0;n<g.length;n++){var t=g[n];t.geometry&&(this.preFormatDomain(t),this._features.push(t))}},_getInfoTemplate:function(g){g=g.parentLayerInfo?g.parentLayerInfo:g;if(g.controlPopupInfo&&(g=g.controlPopupInfo.infoTemplates)){if(this.url){var n=this.url.split("/").pop();n&&(g.indexOf?-1<g.indexOf(n)&&(this.infoTemplate=g[n].infoTemplate):g.hasOwnProperty(n)&&
(this.infoTemplate=g[n].infoTemplate))}this.setInfoTemplate(this.infoTemplate)}},_setFieldNames:function(){this._fieldNames=[];if(this.infoTemplate&&"undefined"!==typeof this.infoTemplate.info){var g=this.infoTemplate.info.fieldInfos;if(g)for(var n=0;n<g.length;n++)g[n].visible&&this._fieldNames.push(g[n].fieldName)}if(this.symbolData.featureDisplayOptions&&0<this.symbolData.featureDisplayOptions.fields.length)for(g=0;g<this.symbolData.featureDisplayOptions.fields.length;g++)n=this.symbolData.featureDisplayOptions.fields[g],
-1===this._fieldNames.indexOf(n.name)&&this._fieldNames.push(n.name);1>this._fieldNames.length&&(this._fieldNames=["*"])},setLayerInfo:function(g){this.lyrInfo=g},clearSingles:function(g){fa.forEach(g||this._singles,function(n){this.remove(n)},this);this._singles.length=0},_getSingleGraphic:function(g){g=new P(new T(g.geometry.x,g.geometry.y,this._map.spatialReference),null,g.attributes);g.setSymbol(this._singleSym);return g},_addSingles:function(g){fa.forEach(g,function(n){n=this._getSingleGraphic(n);
this._singles.push(n);this._showSingles&&this.add(n)},this);this._map.infoWindow.setFeatures(this._singles)},initalCount:function(g){if(!this.hidePanel){var n=new Q;n.returnGeometry=!1;n.geometry=this.showAllFeatures?null:this._map.extent;n.where=!this.showAllFeatures&&this.filter?this.filter:"1\x3d1";(new W(g)).executeForIds(n).then(A.hitch(this,function(t){if(this.node){va.contains(this.node,"searching")&&va.remove(this.node,"searching");this.node.innerHTML=t?oa.localizeNumber(t.length):0;var D=
this.node.parentNode}else this.legendNode&&(D=this.legendNode.previousSibling);this.updateExpand(D,t?!1:!0)}))}},updateExpand:function(g,n){if(!this.hidePanel&&"undefined"!==typeof g){if(-1<g.id.indexOf("rec_")){var t=g.id.replace("rec_","");t=wa.byId("exp_"+t)}n?(g&&(I.addClass(g,"recDefault"),I.addClass(g,"inActive")),t&&I.addClass(t,"expandInActive")):this.visible&&(g&&(I.removeClass(g,"recDefault"),I.removeClass(g,"inActive")),t&&I.removeClass(t,"expandInActive"))}},loadData:function(g){if(0<
g.length){this.initalCount(g);var n=new Q;n.where="1\x3d1";this.filter&&(n.where=this.filter);n.returnGeometry=!1;this.queryPending=!0;(new W(g)).executeForIds(n).then(A.hitch(this,function(t){var D=this._parentLayer&&this._parentLayer.maxRecordCount?this._parentLayer.maxRecordCount:1E3;if(t){this.queryIDs=t;t=[];var F;var X=0;for(F=this.queryIDs.length;X<F;X+=D){var Y=this.queryIDs.slice(X,X+D),H=new Q;H.outFields=["*"];H.objectIds=Y;H.returnGeometry=!0;H.outSpatialReference=this._map.spatialReference;
Y=new W(g);t.push(Y.execute(H))}this._features=[];this.cancelRequest?console.log("Cancelled ClusterLayer 1"):(new L(t)).then(A.hitch(this,function(J){this.queryPending=!1;if(this.cancelRequest)console.log("Cancelled ClusterLayer 2");else if(J){for(var R=this._map.spatialReference,ma=[],Z=0;Z<J.length;Z++)if(J[Z][1].features)for(var a=0;a<J[Z][1].features.length;a++){var b=J[Z][1].features[a];if("undefined"!==typeof b.geometry&&null!==b.geometry&&b.geometry){var c=new T(b.geometry.x,b.geometry.y,R);
c=new P(c);c.setAttributes(b.attributes);this.infoTemplate&&c.setInfoTemplate(this.infoTemplate);this.preFormatDomain(c);ma.push(c)}}J=!0;1E4>ma&&(J=JSON.stringify(this._features)!==JSON.stringify(ma));J&&(this.requiresReload=!0,this._features=ma,this.clusterFeatures(),this.emit("update-end",{bubbles:!0,cancelable:!0}))}}))}}))}},preFormatDomain:function(g){fa.forEach(this.fields,A.hitch(this,function(n){if(n&&n.hasOwnProperty("name")&&this._parent&&g&&g.hasOwnProperty("attributes")&&g.attributes.hasOwnProperty(n.name)){var t=
this._parent._checkDomainField(n),D=this._parent._checkDomainAndSubtype(this.layerDefinition,n.name,g.attributes,{layerObject:this._parentLayer});if(t||D)g.attributes[n.name]=this._parent.formatDomainValue(g.attributes[n.name],t,D)}}))},handleClick:function(g){var n=[];if(g.graphic&&(n=g.graphic,n.attributes)){var t=n.attributes;t.Data&&1<t.Data.length?(this.clearSingles(this._singles),n=t.Data,g.stopPropagation(),this._addSingles(n)):t.Data&&1===t.Data.length?(t.Data[0].symbol=n.symbol,this._map.infoWindow.setFeatures([t.Data[0]])):
this._map.infoWindow.setFeatures([n])}this.infoTemplate&&this._map.infoWindow.show(g.mapPoint);K.stop(g)},handleMapExtentChange:function(g){if(g.levelChange)this.clusterFeatures();else if(g.delta){g=g.delta;var n=Math.abs(g.y);(50<Math.abs(g.x)||50<n)&&this.clusterFeatures()}},refreshFeatures:function(g){if(this.itemId){var n=g.featureSet.features;g.featureSet.transform&&(n=(new U(g.featureSet)).features);"undefined"===typeof this.updateFeatures&&(this.updateFeatures=n);g=!0;1E4>n.length&&(g=JSON.stringify(this.updateFeatures)!==
JSON.stringify(n));if(g){this.requiresReload=!0;this._features=[];this._parentLayer.clear();g=this._parentLayer.spatialReference;for(var t=0;t<n.length;t++){var D=n[t];if(D.geometry){var F=new P(this.getGraphicOptions(D,g));F.setAttributes(D.attributes);this.infoTemplate&&F.setInfoTemplate(this.infoTemplate);this.preFormatDomain(F);this._parentLayer.add(F);this._features.push(F)}else console.log("Null geometry skipped")}this.clusterFeatures()}this.updateFeatures=n}else this.url&&this.loadData(this.url)},
getGraphicOptions:function(g,n){return"undefined"!==typeof g.geometry.rings?{geometry:{rings:g.geometry.rings,spatialReference:{wkid:n.wkid}}}:"undefined"!==typeof g.geometry.paths?{geometry:{paths:g.geometry.paths,spatialReference:{wkid:n.wkid}}}:"undefined"!==typeof g.geometry.points?{geometry:{points:g.geometry.points,spatialReference:{wkid:n.wkid}}}:{geometry:new T(g.geometry.x,g.geometry.y,g.geometry.spatialReference)}},flashFeatures:function(){this._map.graphics.clear();this.flashGraphics(this.graphics)},
flashSingle:function(g){if("undefined"===typeof g.symbol){var n=new q(q.STYLE_NULL,new k(0,0,0,0),0),t=this.color.toRgb();g.setSymbol(new u(u.STYLE_CIRCLE,9,n,new k([t[0],t[1],t[2],.5])))}this.flashGraphics([g])},flashGraphics:function(g){for(var n=0;n<g.length;n++)this._flashFeature(g[n]);setTimeout(A.hitch(this,this._clearFeatures),1100)},_flashFeature:function(g){var n;if(g.geometry){var t=k.fromHex(this._styleColor),D=A.clone(t);D.a=.4;"undefined"!==typeof g.symbol&&(n=new u(u.STYLE_CIRCLE,g.symbol.size,
new q(q.STYLE_SOLID,t,1),D))}"undefined"!==typeof n&&(g=new P(g.geometry,n),this._map.graphics.add(g),n=g.getDojoShape())&&(y.animateStroke({shape:n,duration:700,color:{start:n.strokeStyle.color,end:n.strokeStyle.color},width:{start:18,end:0}}).play(),setTimeout(this._clearFeature,850,g))},_clearFeatures:function(){this._map.graphics.clear()},_clearFeature:function(g){g.getLayer().remove(g)},setColor:function(g){this.color=g},setStyleColor:function(g){this._styleColor=g},cancelPendingRequests:function(){console.log("Cancel Query...");
this.queryPending&&(this.cancelRequest=!0);this.removeEventListeners()},removeEventListeners:function(){this.extentChangeSignal&&(this.extentChangeSignal.remove(),this.extentChangeSignal=null);this.clickSignal&&(this.clickSignal.remove(),this.clickSignal=null)},isLayerClusterEnabled:function(g){var n=!1;fa.some(this._parent.config.layerInfos,A.hitch(this,function(t){if(g===t.layer+this._parent.UNIQUE_APPEND_VAL_CL&&t.symbolData.clusteringEnabled)return n=!0}));return n},clusterFeatures:function(){var g=
!0;this.clear();null===this._map&&(this._map=this._parent.map);this._map.infoWindow.isShowing&&(fa.some(this._map.infoWindow.features,A.hitch(this,function(f){if(f._layer&&this.isLayerClusterEnabled(f._layer.id))return g=!1,!0})),!g&&this._parent.isOpen?this._map.infoWindow.hide():this._parent.config.hasOwnProperty("displayClusterLayer")&&!0===this._parent.config.displayClusterLayer&&!g&&this._map.infoWindow.hide());var n=this._features,t=0;if("undefined"!==typeof n){if(0<n.length&&(this.visible||
this.requiresReload)){var D=this.clusterSize;this.clusterGraphics=[];var F=this._map.spatialReference,X=this._map.extent,Y=new T(X.xmin,X.ymax,F),H=Math.ceil(this._map.height/D),J=Math.ceil(this._map.width/D),R=X.getWidth()/this._map.width*D;D*=X.getHeight()/this._map.height;for(X=0;X<H;X++)for(var ma=0;ma<J;ma++){var Z=Y.x+R*ma,a=Y.y-D*X;a=new aa(Z,a-D,Z+R,a,F);Z=[];for(var b in n){var c=n[b];a.contains(c.geometry)&&(t+=1,Z.push(c))}0<Z.length&&(a=this.getClusterCenter(Z),this.clusterGraphics.push({center:a,
graphics:Z}))}for(var d in this.clusterGraphics){F=this.clusterGraphics[d];Y=F.graphics.length;H=F.graphics;b=oa.localizeNumber(Y);R=J=19*b.length;J+=5;D=new p;D.family="Arial";D.size="16px";b=new E(b,D,this.countColor);b.setOffset(0,-4);if(this.symbolData&&this.symbolData.symbol)if(this.symbolData.symbol.size)var e=this.symbolData.symbol.size;else this.symbolData.symbol.width&&(e=this.symbolData.symbol.width,D=this.symbolData.symbol.height,e=e>=D?e:D);else this.icon.width?(J=this.icon.width>=J?this.icon.width+
5:J,J=this.icon.height>=J?this.icon.height+5:J,R=this.icon.width>=R?this.icon.width+1:R,R=this.icon.height>=R?this.icon.height+1:R):this.icon.size&&(e=this.icon.size);e&&(J=e>=J?e+5:J,R=e>=R?e+1:R);R>=J&&(J+=0===R-J?4:R-J+5);this._setSymbols(J+15,J);H={Count:Y,Data:H};1<Y?"undefined"!==typeof this.symbolData?"CustomSymbol"!==this.symbolData.symbolType?(this.add(new P(F.center,this.csym,H)),this.displayFeatureCount?this.add(new P(F.center,b,H)):this.add(new P(F.center,this.csym3,H))):(this.add(new P(F.center,
this.csym,H)),this.displayFeatureCount?this.add(new P(F.center,b,H)):this.add(new P(F.center,this.psym,H))):(this.add(new P(F.center,this.csym,H)),this.displayFeatureCount?this.add(new P(F.center,b,H)):this.add(new P(F.center,this.psym,H))):(F=F.graphics[0].geometry,this.renderer&&(F=(this.renderer.hasOwnProperty("getSymbol")||this.renderer.hasOwnProperty("symbol"))&&"LayerSymbol"===this.symbolData.symbolType?new P(F,null,H.Data[0].attributes,this.infoTemplate):"EsriSymbol"===this.symbolData.symbolType?
new P(F,pa.fromJson(this.symbolData.symbol),H,this.infoTemplate):"LayerSymbol"!==this.symbolData.symbolType?new P(F,this.psym,H,this.infoTemplate):this.renderer.symbol?new P(F,null,H,this.infoTemplate):new P(F,this.psym,H,this.infoTemplate),"undefined"!==typeof F&&this.add(F)))}}this._updateNode(this.showAllFeatures?n.length:t)}},_updateNode:function(g){if(!this.hidePanel){if(this.node){this.node.innerHTML=oa.localizeNumber(g?g:0);var n=this.node.parentNode}else this.legendNode&&(n=this.legendNode.previousSibling);
this.updateExpand(n,g&&0<g&&this.visible?!1:!0)}},_setSymbols:function(g,n){var t=this.color.toRgb();if("undefined"!==typeof this.symbolData){if("custom"===this.backgroundClusterSymbol)var D=t;else{var F=pa.fromJson(this.backgroundClusterSymbol);if(0===F.outline.color.a||0===F.outline.width){var X=q.STYLE_NULL;var Y=0}else X=q.STYLE_SOLID,Y=F.outline.width}F?(t=q(X,F.outline.color,Y),D=F.color.toRgb(),this.csym=new u(u.STYLE_CIRCLE,g,t,new k([D[0],D[1],D[2],.75]))):this.csym=new u(u.STYLE_CIRCLE,
g,null,new k([D[0],D[1],D[2],.75]));(g=this.symbolData.s)&&-1<g.indexOf("${appPath}")?(g=window.location.pathname.replace("index.html",""),g=this.symbolData.s.replace("${appPath}",window.location.origin+g)):g=this.symbolData.s?this.symbolData.s:this.icon.imageData;if(g&&"CustomIcon"===this.symbolData.iconType){if(this.symbolData.symbol&&this.symbolData.symbol.height)var H=this.symbolData.symbol.height;if(this.symbolData.symbol&&this.symbolData.symbol.width)var J=this.symbolData.symbol.width;H&&J?
J=H=J>H?J:H:(H=this.symbolData.icon.height?this.symbolData.icon.height:n,J=this.symbolData.icon.width?this.symbolData.icon.width:n);this.psym=new r(g,H,J)}else g&&"LayerIcon"===this.symbolData.iconType?this.psym=pa.fromJson(this.symbolData.symbol):"esriPMS"===this.icon.type?this.psym=this.icon:(n=q(this.icon.outline.style,this.icon.outline.color,this.icon.outline.width),this.psym=new u(this.icon.style,this.icon.size,n,this.icon.color));this.csym2=A.clone(this.psym);this.csym3=A.clone(this.csym2);
"undefined"!==typeof this.csym2.xoffset&&(this.csym3.xoffset=0);"undefined"!==typeof this.csym2.yoffset&&(this.csym3.yoffset=0)}else H=new q(q.STYLE_NULL,new k(0,0,0,0),0),this.csym=new u(u.STYLE_CIRCLE,g,H,new k([t[0],t[1],t[2],.5])),this.psym=new r(this.icon.url,g-10,g-10),this.psym2=new r(this.icon.url,n-7,n-7),H=new q(q.STYLE_NULL,new k(0,0,0,0),0),this.csym2=new u(u.STYLE_CIRCLE,n,H,new k([t[0],t[1],t[2],.5]))},_setupSymbols:function(){if("undefined"!==typeof this.symbolData){this.countColor=
this.symbolData._highLightColor;this.backgroundClusterSymbol=this.symbolData.clusterSymbol;this.icon=this.symbolData.icon;"LayerSymbol"===this.symbolData.symbolType?this._parentLayer.renderer?this.renderer=this._parentLayer.renderer.toJson?this._parentLayer.renderer:Aa.fromJson(this._parentLayer.renderer):this._testRenderer?this.renderer=Aa.fromJson(this._testRenderer):this.symbolData.renderer&&(this.renderer=this.symbolData.renderer.toJson?this.symbolData.renderer:Aa.fromJson(this.symbolData.renderer)):
this.renderer=new C(pa.fromJson(this.symbolData.symbol));var g=this.color.toRgb(),n=new q(q.STYLE_NULL,new k(0,0,0,0),0);this._singleSym=new u(u.STYLE_CIRCLE,9,n,new k([g[0],g[1],g[2],.5]))}},getLayer:function(){return this},getClusterCenter:function(g){var n=0,t=0,D=g.length;fa.forEach(g,function(F){n+=F.geometry.x;t+=F.geometry.y},this);return new T(n/D,t/D,g[0].geometry.spatialReference)},destroy:function(){this._clear();this.removeEventListeners()},_clear:function(){this.clear();this._features=
[]},_updateEnd:function(){this.url&&this.loadData(this.url)}})})},"widgets/InfoSummary/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/InfoSummary/Widget.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"panelContent" data-dojo-attach-point\x3d"panelMain"\x3e\r\n    \x3cdiv class\x3d"page" data-dojo-attach-point\x3d"panelPage"\x3e\r\n      \x3cdiv class\x3d"pageContent rounded" data-dojo-attach-point\x3d"pageContent"\x3e\r\n        \x3cdiv class\x3d"pageHeader pageHeader-border roundedTop jimu-main-background dart-bgcolor box-bgcolor" data-dojo-attach-point\x3d"pageHeader"\x3e\r\n          \x3cdiv class\x3d"pageCounter"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"panelMainIcon" /\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"pageTitle" data-dojo-attach-point\x3d"pageTitle"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"lastUpdated" data-dojo-attach-point\x3d"lastUpdated"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"pageClose" data-dojo-attach-point\x3d"pageCloseMain" data-dojo-attach-event\x3d"onclick:_close"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"pageBody roundedBottom" data-dojo-attach-point\x3d"pageBody"\x3e\r\n        \x3cdiv class\x3d"resultsContent noselect" data-dojo-attach-point\x3d"pageMain"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/InfoSummary/css/style.css":".jimu-widget-InfoSummary {width: 100%; height: 100%;}.jimu-widget-InfoSummary .legendLayer{font-size: 12px;}.jimu-widget-InfoSummary .legendOff{overflow: hidden; display: none;}.jimu-widget-InfoSummary .legendOn{display: block; width: 100%; visibility: visible; height: auto; overflow: hidden;}.jimu-widget-InfoSummary .featureItem{display: block; width: 100%; visibility: visible; cursor: pointer; border-bottom: 1px solid #dcdcdc; float: left; min-height: 30px;}.jimu-rtl .jimu-widget-InfoSummary .featureItem{display: block; width: 100%; visibility: visible; cursor: pointer; border-bottom: 1px solid #dcdcdc; float: right; min-height: 30px;}.jimu-widget-InfoSummary .featureItem:hover {background-color: lightgray;}.jimu-widget-InfoSummary .layer-row-mouseover-dashboard {background-color: #3d3d3d !important;}.jimu-widget-InfoSummary .rec:hover .expandUp-dashboard {background-color: #3d3d3d; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .rec:hover .expandDown-dashboard {background-color: #3d3d3d; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .expandDown-dashboard {background-image: url(../images/_nav_down.png); background-color: #222; bottom: -5px; background-position-y: -1px; border-bottom: 1px solid #dcdcdc; -webkit-border-bottom-radius: 8px; -moz-border-bottom-radius: 8px; -o-border-bottom-radius: 8px; -ms-border-bottom-radius: 8px; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px; z-index: 1;}.jimu-widget-InfoSummary .expandUp-dashboard {background-image: url(../images/_nav_up.png); bottom: -1px; background-color: #222; background-position-y: 2px; border-top: 1px solid #dcdcdc; border-left: 1px solid #dcdcdc; border-right: 1px solid #dcdcdc; -webkit-border-top-radius: 8px; -moz-border-top-radius: 8px; -o-border-top-radius: 8px; -ms-border-top-radius: 8px; border-top-left-radius: 8px; border-top-right-radius: 8px; z-index: 1;}.jimu-widget-InfoSummary .expand-dashboard {width: 50px; height: 9px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; left: 45%; background-color: #222; z-index: 1; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-rtl .jimu-widget-InfoSummary .expand-dashboard {width: 50px; height: 9px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; right: 45%; background-color: #222; z-index: 1; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .groupItemTitle:hover .groupItemImageUp-dashboard {background-image: url(../images/_nav_up.png); background-color: #666666;}.jimu-widget-InfoSummary .groupItemTitle:hover .groupItemImageDown-dashboard {background-image: url(../images/_nav_down.png); background-color: #666666;}.jimu-widget-InfoSummary .groupItemImage-dashboard {width: 25px; height: 12px; cursor: pointer; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; cursor: pointer; vertical-align: middle; -webkit-border-radius: 10px; -moz-border-radius: 10px; -o-border-radius: 10px; -ms-border-radius: 10px; border-radius: 10px; border: 2px solid #6d6d6d;}.jimu-widget-InfoSummary .groupItemImageUp-dashboard {background-image: url(../images/_nav_up.png);}.jimu-widget-InfoSummary .groupItemImageDown-dashboard {background-image: url(../images/_nav_down.png);}.jimu-widget-InfoSummary .featureItem-dart {display: block; width: 100%; visibility: visible; cursor: pointer; border-bottom: 1px solid rgba(0,0,0,.5); float: left; min-height: 30px;}.jimu-rtl .jimu-widget-InfoSummary .featureItem-dart {display: block; width: 100%; visibility: visible; cursor: pointer; border-bottom: 1px solid rgba(0,0,0,.5); float: right; min-height: 30px;}.jimu-widget-InfoSummary .featureItem-dart:hover {background-color: rgba(0,0,0,.5);}.jimu-widget-InfoSummary .groupItem-dart:focus, .jimu-widget-InfoSummary .rec-dart:focus,.jimu-widget-InfoSummary .featureItem-dart:focus {outline: 2px solid #24B5CC !important; outline-offset: -2px;}.jimu-widget-InfoSummary .groupItem-dart {display: block; width: 100%; cursor: pointer; border-bottom: 1px solid rgba(0,0,0,.5); float: left; overflow: hidden; text-align: -webkit-left; text-align: -moz-left; text-align: left;}.jimu-rtl .jimu-widget-InfoSummary .groupItem-dart {display: block; width: 100%; cursor: pointer; border-bottom: 1px solid rgba(0,0,0,.5); float: right; overflow: hidden; text-align: -webkit-right; text-align: -moz-right; text-align: right;}.jimu-widget-InfoSummary .groupItemTitle-dart:hover .groupItemImageUp-dart{background-image: url(../images/_nav_up.png); background-color: rgba(0,0,0,.5);}.jimu-widget-InfoSummary .groupItemTitle-dart:hover .groupItemImageDown-dart{background-image: url(../images/_nav_down.png); background-color: rgba(0,0,0,.5);}.jimu-widget-InfoSummary .groupItemTitle-dart{width: 100%; height: 30px; display: table;}.jimu-widget-InfoSummary .groupItemImage-dart{width: 25px; height: 12px; cursor: pointer; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; cursor: pointer; vertical-align: middle; -webkit-border-radius: 10px; -moz-border-radius: 10px; -o-border-radius: 10px; -ms-border-radius: 10px; border-radius: 10px; border: 2px solid rgba(0,0,0,.5);}.jimu-widget-InfoSummary .groupItemImageUp-dart{background-image: url(../images/_nav_up.png);}.jimu-widget-InfoSummary .groupItemImageDown-dart {background-image: url(../images/_nav_down.png);}.jimu-widget-InfoSummary .expand-dart {width: 50px; height: 9px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; left: 45%; background-color: #4c4c4c; z-index: 1; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-rtl .jimu-widget-InfoSummary .expand-dart {width: 50px; height: 9px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; right: 45%; background-color: #4c4c4c; z-index: 1; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .expandUp-dart {background-image: url(../images/_nav_up.png); bottom: -1px; background-position-y: 2px; border-top: 1px solid rgba(0,0,0,.5); border-left: 1px solid rgba(0,0,0,.5); border-right: 1px solid rgba(0,0,0,.5); -webkit-border-top-radius: 8px; -moz-border-top-radius: 8px; -o-border-top-radius: 8px; -ms-border-top-radius: 8px; border-top-left-radius: 8px; border-top-right-radius: 8px; z-index: 1;}.jimu-widget-InfoSummary .expandDown-dart {background-image: url(../images/_nav_down.png); bottom: -5px; background-position-y: -1px; border-bottom: 1px solid rgba(0,0,0,.5); -webkit-border-bottom-radius: 8px; -moz-border-bottom-radius: 8px; -o-border-bottom-radius: 8px; -ms-border-bottom-radius: 8px; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px; z-index: 1;}.jimu-widget-InfoSummary .groupField{text-align: left; display: table-cell; font-size: 14px; width: 100%; padding-left: 5px;}.jimu-rtl .jimu-widget-InfoSummary .groupField{text-align: right; display: table-cell; font-size: 14px; width: 100%; padding-right: 5px;}.jimu-widget-InfoSummary .groupFieldImage{text-align: left; display: table-cell; font-size: 14px; width: 100%; vertical-align: middle; padding-left: 10px;}.jimu-rtl .jimu-widget-InfoSummary .groupFieldImage{text-align: right; display: table-cell; font-size: 14px; width: 100%; vertical-align: middle; padding-right: 10px;}.jimu-widget-InfoSummary .groupItem{display: block; width: 100%; cursor: pointer; border-bottom: 1px solid #dcdcdc; float: left; overflow: hidden; text-align: -webkit-left; text-align: -moz-left; text-align: left;}.jimu-rtl .jimu-widget-InfoSummary .groupItem{display: block; width: 100%; cursor: pointer; border-bottom: 1px solid #dcdcdc; float: right; overflow: hidden; text-align: -webkit-right; text-align: -moz-right; text-align: right;}.jimu-widget-InfoSummary .groupItemTitle:hover .groupItemImageUp{background-image: url(../images/_nav_up.png); background-color: gray;}.jimu-widget-InfoSummary .groupItemTitle:hover .groupItemImageDown{background-image: url(../images/_nav_down.png); background-color: gray;}.jimu-widget-InfoSummary .groupItemTitle{width: 100%; height: 30px; display: table; line-height: 30px;}.jimu-widget-InfoSummary .groupItemTitle:focus, .jimu-widget-InfoSummary .featureItem:focus, .jimu-widget-InfoSummary .rec:focus {outline: 2px solid #24B5CC !important; outline-offset: -2px; border: 1px solid #24B5CC;}.jimu-widget-InfoSummary .groupItemImage{width: 25px; height: 12px; cursor: pointer; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; cursor: pointer; vertical-align: middle; -webkit-border-radius: 10px; -moz-border-radius: 10px; -o-border-radius: 10px; -ms-border-radius: 10px; border-radius: 10px; border: 2px solid #dcdcdc;}.jimu-widget-InfoSummary .groupItemImageUp{background-image: url(../images/default_nav_up.png); background-color: white;}.jimu-widget-InfoSummary .groupItemImageDown{background-image: url(../images/default_nav_down.png); background-color: white;}.jimu-widget-InfoSummary .groupOff{display: none !important;}.jimu-widget-InfoSummary .groupOn{height: auto; display: block;}.jimu-widget-InfoSummary .clusterSymbol{margin: 4px 4px 4px 4px; display: block; width: 35px; visibility: visible; height: 35px; float: left; -moz-border-radius: 30px; -webkit-border-radius: 30px; border-radius: 30px; opacity:0.60; filter: alpha(opacity\x3d30); z-index: 3;}.jimu-widget-InfoSummary .panelMain {display: block;}.jimu-widget-InfoSummary .panelContent {position: absolute; right: 0px; top: 0px; width: 100%; height: 100%;}.jimu-widget-InfoSummary .page {position: relative; width: 100%; margin-left: 0px; height: 100%; display: block;}.jimu-widget-InfoSummary .pageContent {position:absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; overflow: hidden; display: block;}.jimu-widget-InfoSummary .pageHeader-border {border-bottom: 1px solid lightgray;}.jimu-widget-InfoSummary .pageHeader-border-dart {border-bottom: 1px solid black;}.jimu-widget-InfoSummary .pageHeader {position: relative; width: 100%; height: 160px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageHeaderRefresh {position: relative; width: 100%; height: 180px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageHeaderRefreshNoText {position: relative; width: 100%; height: 160px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageTitle {position: absolute; left: 0px; bottom: 8px; height: auto; font-size: 16px; color: #ffffff; text-align: center; width: 100%;}.jimu-widget-InfoSummary .pageTitleRefresh {position: absolute; left: 0px; bottom: 25px; height: auto; font-size: 16px; color: #ffffff; text-align: center; width: 100%;}.jimu-widget-InfoSummary .pageTitleRefresh-tab {position: absolute; left: 0px; bottom: 25px; height: auto; font-size: 16px; text-align: center; width: 100%;}.jimu-widget-InfoSummary .lastUpdated {position: absolute; left: 0px; bottom: 5px; height: auto; font-size: 12px; color: #ffffff; text-align: center; width: 100%;}.jimu-widget-InfoSummary .lastUpdated-tab {position: absolute; left: 0px; bottom: 5px; height: auto; font-size: 12px; text-align: center; width: 100%;}.jimu-widget-InfoSummary .pageTitleWidth {width: 100%;}.jimu-widget-InfoSummary .pageCounter {position: absolute; top: 10px; width: auto; height: auto; left: 15px; right:15px;}.jimu-widget-InfoSummary .pageBody {position: absolute; top: 160px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;}.jimu-widget-InfoSummary .pageBodyRefresh {position: absolute; top: 180px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;}.jimu-widget-InfoSummary .pageBodyRefreshNoText {position: absolute; top: 160px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;}.jimu-widget-InfoSummary .resultsContent {width: 100%; min-height: 100%; overflow-x: hidden; overflow-y: hidden;}.jimu-widget-InfoSummary .recDefault {cursor: default;}.jimu-widget-InfoSummary .recIcon {position: absolute; left: 10px; top: 10px; width: 50px; height: 50px; border: 3px solid rgba(0,0,0,1); -moz-border-radius: 41px; -webkit-border-radius: 41px; border-radius: 41px; opacity: 0.5; filter: alpha(opacity\x3d50); cursor: pointer;}.jimu-rtl .jimu-widget-InfoSummary .recIcon {position: absolute; right: 10px; top: 10px; width: 50px; height: 50px; border: 3px solid rgba(0,0,0,1); -moz-border-radius: 41px; -webkit-border-radius: 41px; border-radius: 41px; opacity: 0.5; filter: alpha(opacity\x3d50); cursor: pointer;}.jimu-widget-InfoSummary .thumb2{width: 43px; height: 43px; align-content: center; vertical-align: super; z-index: 1;}.jimu-widget-InfoSummary .sub-active {opacity: 0.8; filter: alpha(opacity\x3d80);}.jimu-widget-InfoSummary .active {background-color: rgba(0,0,0,0.25);}.jimu-rtl .jimu-widget-InfoSummary .active {background-color: rgba(0,0,0,0.25);}.jimu-widget-InfoSummary .groupCountLabel {line-height: 30px; font-size: 16px; font-weight: 300; display: table-cell; width: auto; height: 100%; padding-right: 10px; vertical-align: middle;}.jimu-rtl .jimu-widget-InfoSummary .groupCountLabel {line-height: 30px; font-size: 16px; font-weight: 300; display: table-cell; width: auto; height: 100%; padding-left: 10px; vertical-align: middle;}.jimu-widget-InfoSummary .inActive {opacity: 0.6; filter: alpha(opacity\x3d60);}.jimu-widget-InfoSummary .recLabel {display: table-cell; line-height: 70px; font-size: 16px; font-weight: 500; text-align: center; vertical-align: middle; padding-left: 65px; text-overflow: ellipsis; width: 100%; padding-right: 10px; max-width: 100px; overflow: hidden; word-wrap: break-word;}.jimu-rtl .jimu-widget-InfoSummary .recLabel {display: table-cell; line-height: 70px; font-size: 16px; font-weight: 500; text-align: center; vertical-align: middle; padding-right: 65px; text-overflow: ellipsis; width: 100%; padding-left: 10px; max-width: 200px; overflow: hidden; word-wrap: break-word;}.jimu-widget-InfoSummary .recLabelNoCount {display: table-cell; line-height: 70px; font-size: 16px; font-weight: 500; text-align: center; vertical-align: middle; padding-left: 65px; margin-right: 10px; text-overflow: ellipsis; overflow: hidden; width: auto;}.jimu-rtl .jimu-widget-InfoSummary .recLabelNoCount {display: table-cell; line-height: 70px; font-size: 16px; font-weight: 500; text-align: center; vertical-align: middle; padding-right: 65px; margin-left: 10px; text-overflow: ellipsis; overflow: hidden; width: auto;}.jimu-widget-InfoSummary .recNumInActive {height: 100%; text-align: center; font-size: 28px; margin-right: 10px; float: right; display: none; width: 0px; padding-left: 10px;}.jimu-rtl .jimu-widget-InfoSummary .recNumInActive {height: 100%; text-align: center; font-size: 28px; margin-right: 10px; float: left; display: none; width: 0px; padding-left: 10px;}.jimu-widget-InfoSummary .recNum {height: 100%; text-align: center; font-size: 28px; margin-right: 10px; float: right; display: table-cell; width: auto; padding-left: 10px;}.jimu-rtl .jimu-widget-InfoSummary .recNum {height: 100%; text-align: center; font-size: 28px; margin-left: 10px; float: left; display: table-cell; width: auto; padding-right: 10px;}.jimu-widget-InfoSummary .innerMainPanelIcon {background-size: contain; width: 100%; max-width: 310px; height: 120px; background-repeat: no-repeat; background-position: 50% 50%; display: inline-block;}.jimu-widget-InfoSummary .innerSVGPosition {width: 100%; height: 100%; vertical-align: middle;}.jimu-widget-InfoSummary .innerCirclePosition {position: relative; top: 8px; left: 8px;}.jimu-widget-InfoSummary .pageBodyNoIcon {position: absolute; top: 0px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;}.jimu-widget-InfoSummary .pageHeaderNoIcon {position: relative; width: 100%; height: 0px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageBodyNoIconRefresh {position: absolute; top: 25px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;}.jimu-widget-InfoSummary .pageHeaderNoIconRefresh {position: relative; width: 100%; height: 25px; text-align: center; display: block;}.jimu-widget-InfoSummary .solidBorder {border: 1px solid #dcdcdc;}.jimu-widget-InfoSummary .solidBorder-dart {border-bottom: 1px solid rgba(0,0,0,.5);}.jimu-widget-InfoSummary .imageDataGFX {display: block; float: left; width: 30px; height: 30px; margin-left: 10px;}.jimu-rtl .jimu-widget-InfoSummary .imageDataGFX {display: block; float: right; width: 30px; height: 30px; margin-right: 10px;}.jimu-widget-InfoSummary .rec {position: relative; width: 100%; height: 70px; display: table; line-height: 70px; cursor: pointer;}.jimu-widget-InfoSummary .rec:hover .expandUp {background-image: url(../images/nav_up.png); background-color: #f2f2f2; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .rec:hover .expandDown {background-image: url(../images/nav_down.png); background-color: #f2f2f2; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .searching{height: 10px; width: 40px; background-image: url(../images/loading.gif); background-repeat: no-repeat; background-size: contain; position: absolute; top: 32px; bottom: 0px; right: 0px;}.jimu-rtl .jimu-widget-InfoSummary .searching{height: 10px; width: 40px; background-image: url(../images/loading.gif); background-repeat: no-repeat; background-size: contain; position: absolute; top: 32px; bottom: 0px; left: 0px;}.jimu-widget-InfoSummary .expandSearching{background-image: url(../images/loading.gif); position: absolute; background-repeat: no-repeat; background-size: contain; bottom: 0px; right: 0px; display: block;}.jimu-rtl .jimu-widget-InfoSummary .expandSearching{background-image: url(../images/loading.gif); position: absolute; background-repeat: no-repeat; background-size: contain; bottom: 0px; left: 0px; display: block;}.jimu-widget-InfoSummary .expand{width: 50px; height: 9px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; left: 45%; background-color: white; z-index: 1; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-rtl .jimu-widget-InfoSummary .expand{width: 50px; height: 9px; background-repeat: no-repeat; background-size: contain; background-position: 50% 50%; position: absolute; right: 45%; background-color: white; z-index: 1; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .expandInActive{opacity: 0; display:none; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .expandImageContainer{width: 25px; height: 12px; margin-right: 5px; display: table-cell; vertical-align: middle; text-align: center; padding-right: 5px;}.jimu-rtl .jimu-widget-InfoSummary .expandImageContainer{width: 25px; height: 12px; margin-left: 5px; display: table-cell; vertical-align: middle; text-align: center; padding-left: 5px;}.jimu-widget-InfoSummary .expandUp{background-image: url(../images/default_nav_up.png); bottom: -1px; background-position-y: 2px; border-top: 1px solid #dcdcdc; border-left: 1px solid #dcdcdc; border-right: 1px solid #dcdcdc; -webkit-border-top-radius:8px; -moz-border-top-radius:8px; -o-border-top-radius:8px; -ms-border-top-radius:8px; border-top-left-radius: 8px; border-top-right-radius: 8px; z-index: 1;}.jimu-widget-InfoSummary .expandDown{background-image: url(../images/default_nav_down.png); bottom: -5px; background-position-y: -1px; border-bottom: 1px solid #dcdcdc; -webkit-border-bottom-radius:8px; -moz-border-bottom-radius:8px; -o-border-bottom-radius:8px; -ms-border-bottom-radius:8px; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px; z-index: 1;}.noselect {-webkit-touch-callout: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;}.jimu-widget-InfoSummary .rec-dart {position: relative; width: 100%; height: 70px; display: table; line-height: 70px; color: #6e6e6e; cursor: pointer;}.jimu-widget-InfoSummary .rec-dart:hover .expandUp-dart {background-color: black; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .rec-dart:hover .expandDown-dart {background-color: black; -webkit-transform: translateZ(0); -moz-transform: rotate(0);}.jimu-widget-InfoSummary .layer-row-mouseover {background-color: #f2f2f2;}.jimu-widget-InfoSummary .layer-row-mouseover-dart {background-color: rgba(0,0,0,.5);}@media only screen and (max-width: 750px) {.jimu-widget-InfoSummary .pageContent{} .jimu-widget-InfoSummary .pageHeader{position: relative; width: 100%; height: 0px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageHeaderRefresh {position: relative; width: 100%; height: 45px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageHeaderRefreshNoText {position: relative; width: 100%; height: 25px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageTitle {position: absolute; left: 0px; bottom: 20px; height: auto; font-size: 16px; color: #ffffff; text-align: center; width: 100%;} .jimu-widget-InfoSummary .pageTitleWidth {width: 100%;} .jimu-widget-InfoSummary .pageCounter {display: none; position: absolute; left: 5px; margin-left: 0px; top: 0px; width: 70px; font-size: 40px; height: 70px; line-height: 70px; border: 5px solid rgba(0,0,0,1); -moz-border-radius: 40px; -webkit-border-radius: 40px; border-radius: 40px;} .jimu-widget-InfoSummary .pageBody {position: absolute; top: 0px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;} .jimu-widget-InfoSummary .pageBodyRefresh {position: absolute; top: 45px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;} .jimu-widget-InfoSummary .pageBodyRefreshNoText {position: absolute; top: 25px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;}}",
"*now":function(ua){ua(['dojo/i18n!*preload*widgets/InfoSummary/nls/Widget*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("jimu/BaseWidget jimu/LayerInfos/LayerInfos jimu/utils dojo/dom dojo/dom-class dojo/dom-construct dojo/on dojo/dom-style dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/_base/Color dojo/promise/all dojo/_base/array dojo/DeferredList dojo/Deferred dojo/query dojox/gfx/fx dojox/gfx dojo/_base/xhr dojo/keys dojo/dom-attr dijit/focus dijit/_WidgetsInTemplateMixin esri/graphic esri/geometry/Point esri/symbols/SimpleMarkerSymbol esri/symbols/PictureMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/Color esri/tasks/query esri/tasks/QueryTask esri/tasks/FeatureSet esri/arcgis/utils esri/symbols/jsonUtils esri/request esri/renderers/SimpleRenderer esri/renderers/jsonUtils ./js/ClusterLayer esri/layers/LayerDrawingOptions".split(" "),function(ua,
fa,K,A,k,I,L,va,wa,y,z,ba,oa,V,P,aa,T,r,u,q,E,p,C,Q,W,U,pa,Aa,ra,g,n,t,D,F,X,Y,H,J,R,ma,Z){return wa([ua,Q],{baseClass:"jimu-widget-InfoSummary",name:"InfoSummary",opLayerInfos:null,layerList:{},UNIQUE_APPEND_VAL_CL:"_CL",widgetChange:!1,refreshInterval:0,refreshIntervalValue:0,configLayerInfos:[],legendNodes:[],currentQueryList:[],symbols:[],row:null,clusterLayerArray:[],initialOpen:!0,isOpen:!1,postCreate:function(){this.inherited(arguments);this.inPanelOverrides(this.appConfig.theme.name);this.configLayerInfos=
this.config.layerInfos;this.layerList={};this._initWidget()},_forceClose:function(){var a=this.appConfig.theme.name,b=this.getPanel();if(-1<"LaunchpadTheme DartTheme FoldableTheme JewelryBoxTheme BillboardTheme TabTheme DashboardTheme PocketTheme".split(" ").indexOf(a))b.containerNode.parentNode.style.display="none",b.containerNode.style.display="none",this.widgetManager.closeWidget(this.id);else if("BoxTheme"===a){if(b.containerNode.parentNode.style.display="none",b.containerNode.style.display="none",
b.getParent&&b.getParent()._toggleBox){a=T(".icon-node-active");for(var c=0;c<a.length;c++)-1<a[c].outerHTML.indexOf(this.id)&&b.getParent()._toggleBox()}}else if("PlateauTheme"===a)if(b.containerNode.parentNode.style.display="none",b.containerNode.style.display="none",this.widgetManager.closeWidget(this.id),this.aw)this.aw._switchNodeToClose(this.id),this.aw._closeDropMenu();else for(b=this.widgetManager.appConfig.widgetOnScreen.widgets,a=0;a<this.widgetManager.appConfig.widgetOnScreen.widgets.length;a++)if(b[a].isThemeWidget){this.aw=
this.widgetManager.getWidgetById(b[a].id);this.aw._switchNodeToClose(this.id);this.aw._closeDropMenu();break}},inPanelOverrides:function(a){"undefined"!==typeof this.iconClickHandler&&(this.iconClickHandler.remove(),this.iconClickHandler=void 0);var b=this.getPanel();if(this.config.hidePanel)if(b=["DartTheme","BoxTheme","FoldableTheme","JewelryBoxTheme","PlateauTheme"],"LaunchpadTheme"===a||"PocketTheme"===a)this._forceClose(),a=T(".selected"),0<a.length&&-1<a[0].parentNode.outerHTML.indexOf(this.id)&&
(this.iconClickHandler=L(a[0],"click",y.hitch(this,this._forceClose)));else{if(-1<b.indexOf(a))for("BoxTheme"===a&&this._forceClose(),a=T(".icon-node"),b=0;b<a.length;b++)-1<a[b].outerHTML.indexOf(this.id)&&(this.iconClickHandler=L(a[b],"click",y.hitch(this,this._forceClose)))}else switch(b.containerNode&&b.containerNode.firstChild&&b.containerNode.firstChild.className&&(b.containerNode.firstChild.style.padding="0px 0px 10px 0px"),-1===["TabTheme","BillboardTheme","PlateauTheme","DashboardTheme"].indexOf(a)&&
this._updateBackgroundColors(!0),this.isDartTheme="DartTheme"===a,this.isDashboardTheme="DashboardTheme"===a,k.contains(this.pageHeader,this.isDartTheme?"pageHeader-border":"pageHeader-border-dart")&&k.remove(this.pageHeader,this.isDartTheme?"pageHeader-border":"pageHeader-border-dart"),k.add(this.pageHeader,this.isDartTheme?"pageHeader-border-dart":"pageHeader-border"),a){case "DartTheme":this.updateForDartTheme(b);break;case "BoxTheme":this.updateForBoxTheme(b);break;case "TabTheme":this.updateForTabTheme(b);
break;case "LaunchpadTheme":this.updateForLaunchpadTheme(b);break;case "BillboardTheme":this.updateForBillboardTheme(b);break;case "PlateauTheme":this.updateForPlateauTheme(b);break;case "DashboardTheme":this.updateForDashboardTheme(b)}},updateForLaunchpadTheme:function(a){a.containerNode.style.top="30px"},updateForTabTheme:function(a){if(0<a.containerNode.children.length){var b=a.containerNode.children[0];1<b.children.length&&(b.children[1].style.padding="14px 0px 14px 0px")}a.config.isOnScreen||
this._updateBackgroundColors(!1)},updateForBoxTheme:function(a){a.containerNode.parentNode.style.top="140px"},updateForDartTheme:function(a){a.containerNode.style.right="0px";a.containerNode.style.left="0px"},updateForBillboardTheme:function(){this._updateBackgroundColors(!1)},updateForPlateauTheme:function(){this._updateBackgroundColors(!1)},updateForDashboardTheme:function(){this._updateBackgroundColors(!1)},_updateBackgroundColors:function(a){k.contains(this.lastUpdated,a?"lastUpdated-tab":"lastUpdated")&&
k.remove(this.lastUpdated,a?"lastUpdated-tab":"lastUpdated");k.add(this.lastUpdated,a?"lastUpdated":"lastUpdated-tab");a=a&&"DashboardTheme"!==this.appConfig.theme.name;this.useDarkText=!a;k.contains(this.pageHeader,"jimu-main-background")&&!a?k.remove(this.pageHeader,"jimu-main-background"):!k.contains(this.pageHeader,"jimu-main-background")&&a&&k.add(this.pageHeader,"jimu-main-background");k.contains(this.pageHeader,"dart-bgcolor")&&!a?k.remove(this.pageHeader,"dart-bgcolor"):!k.contains(this.pageHeader,
"dart-bgcolor")&&a&&k.add(this.pageHeader,"dart-bgcolor");k.contains(this.pageHeader,"box-bgcolor")&&!a?k.remove(this.pageHeader,"box-bgcolor"):!k.contains(this.pageHeader,"box-bgcolor")&&a&&k.add(this.pageHeader,"box-bgcolor")},startup:function(){this.inherited(arguments)},onOpen:function(){this.widgetChange=!1;this.isOpen=!0;this.hidePanel?"BoxTheme"!==this.appConfig.theme.name&&this._forceClose():this._updatePanelHeader();this.appConfig.theme.styles&&this.appConfig.theme.styles[0]&&this._updateStyleColor(this.appConfig.theme.styles[0]);
this.hidePanel||this._setVisibleSubLayers();this.hidePanel||this.showAllFeatures||"undefined"!==typeof this.mapExtentChangedHandler||(this.mapExtentChangedHandler=this.map.on("extent-change",y.hitch(this,this._mapExtentChange)));this.config.refreshEnabled&&this.enableRefresh();this.map.infoWindow&&(this.map.infoWindow.highlight=!0);this.config.hasOwnProperty("displayClusterLayer")&&!1===this.config.displayClusterLayer&&this.clusterLayerArray.length&&this.clusterLayerArray.forEach(y.hitch(this,function(a){a.clusterLayer.show()}));
this.config.expandList||(this.initialOpen=!1)},_updateRenderer:function(a,b){if(a&&a.orgRenderer){if(b.setLayerDrawingOptions&&!isNaN(a.subLayerId)){var c=[],d=new Z;d.renderer=a.newRenderer;c[a.subLayerId]=d;b.setLayerDrawingOptions(c)}else b.setRenderer?b.setRenderer(a.newRenderer):console.log("Error setting the new renderer...will use the default rendering of the layer");"function"===typeof b.refresh&&b.refresh()}},_getParentLayer:function(a,b){var c;b&&b.layerInfos?c=b:a&&"undefined"!==typeof a.parentLayerID&&
(c=this.map.getLayer(a.parentLayerID));return c},_setVisibleSubLayers:function(){var a=[],b;for(b in this.layerList){var c=this.layerList[b],d=c.li,e=c.layerObject;this._updateRenderer(d,e);var f=this._getParentLayer(d,e);if(f&&f.visibleLayers){e=!1;var h=0;a:for(;h<a.length;h++)if(a[h].id===f.id){e=!0;break a}0!==a.length&&e||a.push({id:f.id,layers:f.visibleLayers});e=0;e;a:for(;e<a.length;e++)if(a[e].id===f.id)break a;h=a[e].layers;if(f.layerInfos){if(0<f.layerInfos.length&&d&&"undefined"!==typeof d.subLayerId){f=
-1<h.indexOf(d.subLayerId);var m=c.parentLayerVisible,l=c.layerObject.parentLayerVisible;"ClusterLayer"===c.type&&(f||m||l)?(c.parentLayerVisible=!0,c.layerObject.parentLayerVisible=!0,c.visible=!0,f&&h.splice(h.indexOf(d.subLayerId),1)):f||m?(c.parentLayerVisible=!0,c.visible=!0,-1===h.indexOf(d.subLayerId)&&h.push(d.subLayerId)):(c.parentLayerVisible=!1,c.visible=!1,f&&h.splice(h.indexOf(d.subLayerId),1),"ClusterLayer"===c.type&&(c.layerObject.parentLayerVisible=!1,-1<this.map.graphicsLayerIds.indexOf(c.id)&&
(d=this.map.getLayer(c.id),d.setVisibility(!1))))}a[e].layers=h}this.updatePanelVisibility(c,b,c)}else e&&("ClusterLayer"===c.type&&e._parentLayer&&(-1<this.map.graphicsLayerIds.indexOf(c.id)&&(d=this.map.getLayer(c.id),"undefined"===typeof c.layerObject.parentLayerVisible&&(c.parentLayerVisible=e._parentLayer.visible,c.layerObject.parentLayerVisible=e._parentLayer.visible),d.setVisibility(c.layerObject.parentLayerVisible)),e._parentLayer.setVisibility&&e._parentLayer.setVisibility(!1)),this.updatePanelVisibility(e,
b,c));this.showAllFeatures&&this.config.expandList&&c.legendOpen&&!c.isLoaded&&(d=c.visScaleRange,"undefined"!==typeof d&&(d=this._inVisibleRange(b)),c.visible&&d&&(c.updateList=!0))}for(b=0;b<a.length;b++)(c=this.map.getLayer(a[b].id))&&c.setVisibleLayers(a[b].layers);this.initialOpen&&(this.openAtStartAysn=!0);this._support508Accessibility(!K.isAutoFocusFirstNodeWidget(this))},updatePanelVisibility:function(a,b,c){if(!this.hidePanel&&"undefined"!==typeof a.visible){var d=c.visScaleRange,e=A.byId("recLabel_"+
b),f,h=A.byId("rec_"+b),m=A.byId("recIcon_"+b),l=A.byId("exp_"+b),v=A.byId("recNum_"+b);h&&(f=k.contains("rec_"+b,"inActive"));a.visible?(m&&!k.contains("recIcon_"+b,"active")&&(k.add("recIcon_"+b,"active"),f||k.add("recIcon_"+b,"sub-active")),this.config.countEnabled&&v&&k.contains("recNum_"+b,"recNumInActive")&&(k.remove("recNum_"+b,"recNumInActive"),k.add("recNum_"+b,"recNum")),e&&e.firstChild&&!f&&k.remove(e.firstChild,"inActive"),c.listDisabled||("undefined"===typeof d||d)&&l&&k.contains("exp_"+
b,"expandInActive")&&k.remove("exp_"+b,"expandInActive"),h&&k.contains("rec_"+b,"recDefault")&&k.remove("rec_"+b,"recDefault")):(m&&k.contains("recIcon_"+b,"active")&&(k.remove("recIcon_"+b,"active"),f||k.remove("recIcon_"+b,"sub-active")),this.config.countEnabled&&v&&k.contains("recNum_"+b,"recNum")&&(k.remove("recNum_"+b,"recNum"),k.add("recNum_"+b,"recNumInActive")),e&&e.firstChild&&!f&&k.add(e.firstChild,"inActive"),c.listDisabled||(l&&!k.contains("exp_"+b,"expandInActive")&&k.add("exp_"+b,"expandInActive"),
c.toggleLegend.remove()),h&&k.contains("rec_"+b,"rec")&&k.add("rec_"+b,"recDefault"))}this.initialOpen&&(this.openAtStartAysn=!0);this._support508Accessibility(!K.isAutoFocusFirstNodeWidget(this))},enableRefresh:function(){var a=null,b=[],c;for(c in this.layerList){a=this.layerList[c];if(a.li)var d=a.li.itemId;if("ClusterLayer"!==a.type)a=a.layerObject;else for(var e=0;e<this.layerInfos.length;e++){var f=this.layerInfos[e];if(f.layerObject){a=f.layerObject;break}}d&&-1===b.indexOf(d)&&b.push(d);a&&
(a.refreshInterval=this.config.refreshInterval)}0<b.length&&this.refreshLayers();a=6E4*this.config.refreshInterval;0===this.refreshInterval&&0===this.refreshIntervalValue?(this.refreshIntervalValue=a,this.refreshInterval=setInterval(y.hitch(this,this.refreshLayers),this.refreshIntervalValue)):0!==this.refreshIntervalValue&&this.refreshIntervalValue!==a&&(this.refreshIntervalValue=a,clearInterval(this.refreshInterval),this.refreshInterval=0,this.refreshInterval=setInterval(y.hitch(this,this.refreshLayers),
this.refreshIntervalValue))},getItem:function(a){var b=new aa,c=("/"!==window.portalUrl.substr(-1)?window.portalUrl+="/":window.portalUrl)+"sharing/rest/content/items/"+a;H({url:c,content:{f:"json",requestTime:Date.now()}}).then(y.hitch(this,function(d){b.resolve({response:d,url:c})}));return b},_updatePanelTime:function(a){this.hidePanel||(this.lastUpdated.innerHTML="\x3cdiv\x3e\x3c/div\x3e",this.lastUpdated.innerHTML=K.fieldFormatter.getFormattedDate(new Date(a),{dateFormat:"shortDateShortTime"}))},
refreshLayers:function(){var a=[],b;for(b in this.layerList){var c=this.layerList[b];if(c.li&&c.li.itemId)var d=c.li.itemId;else c.layerObject.itemId&&(d=c.layerObject.itemId);d&&-1===this.currentQueryList.indexOf(d)&&(this.currentQueryList.push(d),a.push(this.getItem(d)))}if(0<a.length){var e=[];(new P(a)).then(y.hitch(this,function(f){this.currentQueryList=[];if(f){for(var h=0;h<f.length;h++){var m=f[h][1],l=m.response;l&&this._shouldUpdate(l)&&e.push({response:l,id:l.id,url:m.url})}0<e.length&&
this._updateItems(e)}}))}},_updateItems:function(a){var b=[],c=[];a.forEach(y.hitch(this,function(d){c.push(d.id);b.push(this._getItemData(d.response,d.url))}));(new P(b)).then(y.hitch(this,function(d){for(var e=0;e<d.length;e++)this._updateItem(d[e][1])}))},_shouldUpdate:function(a){a=a.modified;var b=!0;this.lastModifiedTime&&(b=this.lastModifiedTime<a);return b},_getItemData:function(a,b){if(a){a=a.modified;var c=[null,void 0];this.lastModifiedTime=this.lastModifiedTime<a||-1!==c.indexOf(this.lastModifiedTime)?
a:this.lastModifiedTime;this._updatePanelTime(a);return H({url:b+"/data",content:{f:"json",requestTime:Date.now()}})}},_updateItem:function(a){for(var b=0;b<a.layers.length;b++)this._updateLayerItem(a.layers[b],this.lastModifiedTime)},_updateLayerItem:function(a){for(h in this.layerList){var b=this.layerList[h];if(b.pl&&b.pl.layerDefinition){if(b.pl.layerDefinition.name===a.layerDefinition.name){var c=b;var d=b.pl;break}}else if(b.layerObject._parentLayer){if(b.layerObject._parentLayer.name===a.layerDefinition.name||
b.layerDefinition&&b.layerDefinition.name===a.layerDefinition.name){var e="undefined"!==typeof b.listDisabled?b.listDisabled:!1;var f=b.li.symbolData.featureDisplayOptions.fields&&0<b.li.symbolData.featureDisplayOptions.fields.length;!e&&f&&(b.isLoaded=!1);b.layerObject.refreshFeatures(a);b.layerObject&&this._loadList(b,!0)}}else if(b.layerDefinition&&b.pl){if(b.layerDefinition.name===a.layerDefinition.name){c=b;d=b.pl;break}}else if(b.pl&&b.pl.name&&b.pl.name===a.layerDefinition.name){c=b;d=b.pl;
break}}if(a&&c&&d&&(d.featureSet||d.graphics)){var h=a.featureSet.features;if(d.featureSet)var m=d.featureSet.features;else{m=[];var l=this._getSpatialReference(h),v=this._getSpatialReference(d.graphics);V.forEach(d.graphics,function(x){var G=x.geometry;G=G.rings?{rings:G.rings}:G.paths?{paths:G.paths}:G.points?{points:G.points}:G.x&&G.y?{x:G.x,y:G.y}:{};G!=={}&&m.push({attributes:x.attributes,geometry:y.mixin({spatialReference:l&&v&&l.wkid===v.wkid?l:v},G)})})}a.featureSet.transform&&(h=(new F(a.featureSet)).features);
a=!0;1E4>h.length&&(a=JSON.stringify(m)!==JSON.stringify(h));if(a){e="undefined"!==typeof c.listDisabled?c.listDisabled:!1;f=c.li.symbolData.featureDisplayOptions.fields&&0<c.li.symbolData.featureDisplayOptions.fields.length;!e&&f&&(c.isLoaded=!1,c.requiresReload=!0);e&&(c.li.layerListExtentChanged=!0);c.layerObject.clear();a=c.layerObject.spatialReference;for(e=0;e<h.length;e++)f=h[e],f.geometry?(b=this.getGraphicOptions(f,a),b=new W(b),b.setAttributes(f.attributes),this._infoTemplate&&b.setInfoTemplate(this._infoTemplate),
c.layerObject.add(b)):console.log("Null geometry skipped");c.layerObject.refresh();d.featureSet&&(d.featureSet.features=h);this.countFeatures(c).then(y.hitch(this,function(x){x.layerObject&&x.layerObject.visible&&this._loadList(x,!0)}))}}},_getSpatialReference:function(a){if(a&&a.hasOwnProperty("length")&&0<a.length&&(a=a[0],a.geometry&&a.geometry.spatialReference))var b=a.geometry.spatialReference;return b},getGraphicOptions:function(a,b){return"undefined"!==typeof a.geometry.rings?{geometry:{rings:a.geometry.rings,
spatialReference:{wkid:b.wkid}}}:"undefined"!==typeof a.geometry.paths?{geometry:{paths:a.geometry.paths,spatialReference:{wkid:b.wkid}}}:"undefined"!==typeof a.geometry.points?{geometry:{points:a.geometry.points,spatialReference:{wkid:b.wkid}}}:{geometry:new U(a.geometry.x,a.geometry.y,a.geometry.spatialReference)}},_initWidget:function(){this.hidePanel="undefined"!==typeof this.config.hidePanel?this.config.hidePanel:!1;this.showAllFeatures="undefined"!==typeof this.config.showAllFeatures?this.config.showAllFeatures:
!1;this.map.itemId&&fa.getInstance(this.map,this.map.itemInfo).then(y.hitch(this,function(a){this.wmLayerInfos=a.getLayerInfoArrayOfWebmap();this.layerInfos=a.getLayerInfoArray();this.operLayerInfos=a;this._updateLayerIDs();this.config.upgradeFields&&this._upgradeFields();this._createPanelUI(this.configLayerInfos,a).then(y.hitch(this,function(){this._addFilterChanged(a);this._addVisibleChanged(a);this._addZoomChanged(a);this._setVisibleSubLayers()}))}))},_updateLayerIDs:function(){var a=[],b=0;for(;b<
this.configLayerInfos.length;b++){var c=this.configLayerInfos[b],d=this.operLayerInfos.getLayerInfoById(c.id);if(d)c.url=d.layerObject&&d.layerObject.url?d.layerObject.url:c.url;else{var e=!1,f=0;b:for(;f<this.wmLayerInfos.length;f++){var h=this.wmLayerInfos[f],m=h?h.originOperLayer:void 0,l=this._compareURL(m,c);m=this._compareItemID(m,c);h=this._compareSubId(h,c);if(d=(l=l?l:m?m:h?h:void 0)?this.operLayerInfos.getLayerInfoById(l):d){this.configLayerInfos[b].id=d.id;this.configLayerInfos[b].layer=
d.id;this.configLayerInfos[b].url=d.layerObject&&d.layerObject.url?d.layerObject.url:this.configLayerInfos[b].url;e=!0;break b}}e||d||a.push(b)}}0<a.length&&(a.sort(function(v,x){return x-v}),V.forEach(a,y.hitch(this,function(v){this.configLayerInfos.splice(v,1)})))},_compareSubId:function(a,b){if(a&&a.subId&&-1<a.subId.indexOf(b.id)&&a.layerObject){var c=this._compareGeom(a.layerObject,b);b=this._compareFields(a.layerObject,b);if(c&&b)return a.subId}},_compareItemID:function(a,b){if(a&&a.itemId&&
a.itemId===b.itemId)if(a.featureCollection&&a.featureCollection.layers&&a.featureCollection.layers.hasOwnProperty("length")){a=a.featureCollection.layers;for(var c=0;c<a.length;c++){var d=a[c];if(this._compareGeom(d,b)&&this._compareFields(d,b))return d.id}}else console.log("error in checking item by itemID")},_compareURL:function(a,b){return a&&a.url&&b.url&&a.url===b.url?a.id:void 0},_compareGeom:function(a,b){return a&&a.geometryType&&b.geometryType?a.geometryType===b.geometryType:void 0},_compareFields:function(a,
b){var c;a&&a.fields&&b.fields&&a.fields.length===b.fields.length&&(c=a.fields.filter(function(d){for(var e=0;e<b.fields.length;e++)if(d.name===b.fields[e].name)return d}).length===a.fields.length);return c},_upgradeFields:function(){if(this.configLayerInfos)for(var a=0;a<this.configLayerInfos.length;a++){var b=this.configLayerInfos[a];if(b&&b.symbolData&&b.symbolData.featureDisplayOptions){var c=this.operLayerInfos.getLayerInfoById(b.id);if(c){var d=b.symbolData.featureDisplayOptions.fields;if("undefined"===
typeof d||d.hasOwnProperty("length")&&0===d.length){var e=c&&c.layerObject?c.layerObject:void 0;d=e&&e.objectIdField?e.objectIdField:void 0;var f="",h="";if((e=b.fields?b.fields:e?e.fields:void 0)&&0<e.length){var m=0;a:for(;m<e.length;m++){var l=e[m];""===f&&"esriFieldTypeOID"!==l.type&&"esriFieldTypeGeometry"!==l.type&&l.name!==d&&(f=l.name,h=l.alias||l.name);d||(d="esriFieldTypeOID"===l.type?l.name:d);if(d&&""!==f)break a}}m=e="";b=b.infoTemplate&&b.infoTemplate.info&&b.infoTemplate.info.fieldInfos?
b.infoTemplate:c?c.getInfoTemplate():void 0;if(!b)a:for(c=c.getSubLayers(),l=0;l<c.length;l++){var v=c[l];if(v.title&&v.layerObject&&v.layerObject.name&&v.title===v.layerObject.name){b=v.getInfoTemplate?v.getInfoTemplate():b;break a}}c=b?b.info.fieldInfos:[];b=0;a:for(;b<c.length;b++)if((l=c[b])&&l.visible&&(!d||d!==l.fieldName)){e=l.fieldName;m=l.label||l.fieldName;break a}this.configLayerInfos[a].symbolData.featureDisplayOptions.fields=[{name:e?e:f,label:e?m:h}]}}}}},_addFilterChanged:function(a){2.1<=
parseFloat(this.appConfig.wabVersion)&&this.own(a.on("layerInfosFilterChanged",y.hitch(this,function(b){V.forEach(b,y.hitch(this,function(c){var d=c.id,e=c.id+this.UNIQUE_APPEND_VAL_CL;c=c.getFilter();this.layerList.hasOwnProperty(d)?(this.layerList[d].isLoaded=this.layerList[d].filter===c,this.layerList[d].filter=c,this._loadList(this.layerList[d],!0)):this.layerList.hasOwnProperty(e)&&(this.layerList[e].layerObject.filter=c,this.layerList[e].layerObject._initFeatures())}))})))},_updateVisibility:function(a){if(a){var b=
a.id,c=a.isShowInMap();if(this.layerList.hasOwnProperty(b)){var d=this.layerList[b];if(a=b===d.li.id?d.li:b===d.id?a:void 0)b=this._inVisibleRange(b),d.visible===c&&d.visScaleRange===b||this._toggleLayerUI(a,c,b)}}},_addVisibleChanged:function(a){this.own(a.on("layerInfosIsVisibleChanged",y.hitch(this,function(b){V.forEach(b,function(c){this._updateVisibility(c)},this)})))},_addZoomChanged:function(a){this.own(L(this.map,"zoom-end",y.hitch(this,function(){a.traversal(y.hitch(this,function(b){this._updateVisibility(b)}))})))},
_updatePanelHeader:function(){var a=this.map.width;this.config.displayPanelIcon&&750<a?(this.pageHeader&&(z.removeClass(this.pageHeader,"pageHeaderNoIcon"),z.removeClass(this.pageHeader,"pageHeaderNoIconRefresh"),this.config.refreshEnabled?""!==this.config.mainPanelText?z.addClass(this.pageHeader,"pageHeaderRefresh"):z.addClass(this.pageHeader,"pageHeaderRefreshNoText"):z.addClass(this.pageHeader,"pageHeader")),this.pageBody&&(z.removeClass(this.pageBody,"pageBodyNoIcon"),z.removeClass(this.pageBody,
"pageBodyNoIconRefresh"),this.config.refreshEnabled?""!==this.config.mainPanelText?z.addClass(this.pageBody,"pageBodyRefresh"):z.addClass(this.pageBody,"pageBodyRefreshNoText"):z.addClass(this.pageBody,"pageBody")),this.pageTitle&&(z.addClass(this.pageTitle,"pageTitleWidth"),this.config.refreshEnabled?(z.removeClass(this.pageTitle,"pageTitle"),z.removeClass(this.pageTitle,"pageTitleRefresh-tab"),z.removeClass(this.pageTitle,"pageTitleRefresh"),z.addClass(this.pageTitle,this.useDarkText?"pageTitleRefresh-tab":
"pageTitleRefresh")):(z.removeClass(this.pageTitle,"pageTitleRefresh"),z.removeClass(this.pageTitle,"pageTitleRefresh-tab"),z.addClass(this.pageTitle,"pageTitle"))),a=this.config.mainPanelText,"undefined"===typeof a&&(a=""),this.pageTitle.innerHTML=a,this.panelMainIcon.innerHTML=this.config.mainPanelIcon):this.config.displayPanelIcon||this.config.refreshEnabled?!this.config.displayPanelIcon&&this.config.refreshEnabled?(this.pageHeader&&(z.removeClass(this.pageHeader,"pageHeader"),z.removeClass(this.pageHeader,
"pageHeaderNoIcon"),z.addClass(this.pageHeader,"pageHeaderNoIconRefresh")),this.pageBody&&(z.removeClass(this.pageBody,"pageBody"),z.removeClass(this.pageBody,"pageBodyNoIcon"),z.addClass(this.pageBody,"pageBodyNoIconRefresh")),this.pageTitle&&z.removeClass(this.pageTitle,"pageTitleWidth"),this.pageTitle.innerHTML="\x3cdiv\x3e\x3c/div\x3e",this.panelMainIcon.innerHTML="\x3cdiv\x3e\x3c/div\x3e"):this.config.displayPanelIcon&&750>=a&&this.config.refreshEnabled&&(this.pageHeader&&(z.removeClass(this.pageHeader,
"pageHeaderNoIcon"),z.removeClass(this.pageHeader,"pageHeaderNoIconRefresh"),z.removeClass(this.pageHeader,"pageHeader"),""!==this.config.mainPanelText?z.addClass(this.pageHeader,"pageHeaderRefresh"):z.addClass(this.pageHeader,"pageHeaderRefreshNoText")),this.pageBody&&(z.removeClass(this.pageBody,"pageBodyNoIcon"),z.removeClass(this.pageBody,"pageBodyNoIconRefresh"),z.removeClass(this.pageBody,"pageBody"),""!==this.config.mainPanelText?z.addClass(this.pageBody,"pageBodyRefresh"):z.addClass(this.pageBody,
"pageBodyRefreshNoText")),this.pageTitle&&z.addClass(this.pageTitle,"pageTitleWidth"),a=this.config.mainPanelText,"undefined"===typeof a&&(a=""),this.pageTitle.innerHTML=a):(this.pageHeader&&(z.removeClass(this.pageHeader,"pageHeader"),z.removeClass(this.pageHeader,"pageHeaderNoIconRefresh"),z.addClass(this.pageHeader,"pageHeaderNoIcon")),this.pageBody&&(z.removeClass(this.pageBody,"pageBody"),z.removeClass(this.pageBody,"pageBodyNoIconRefresh"),z.addClass(this.pageBody,"pageBodyNoIcon")),this.pageTitle.innerHTML=
"\x3cdiv\x3e\x3c/div\x3e",this.panelMainIcon.innerHTML="\x3cdiv\x3e\x3c/div\x3e")},_createPanelUI:function(a,b){var c=new aa;this.numClusterLayers=0;this.hidePanel||(this._updatePanelHeader(),this._updateUI(null),this._clearChildNodes(this.pageMain),this.updateEnd=[]);for(var d=[],e=[],f=0;f<a.length;f++){var h=a[f];"ThemeCluster"===h.symbolData.clusterType&&this.updateThemeClusterSymbol(h,f);var m=b.getLayerInfoById(h.id);m&&e.push(m.getLayerType());d.push({jimuLayerInfo:m,lyrInfo:h})}this._getLayerDetails(e,
d).then(y.hitch(this,function(l){V.forEach(l,y.hitch(this,function(v){this.updateLayerList(v.layerObject,v.lyrInfo,v.layerType,v.jimuLayerInfo)}));this._initUpdateEnd();this.addMapLayers();this.hidePanel||setTimeout(y.hitch(this,function(){this.openAtStartAysn=!0;this._mapExtentChange(!K.isAutoFocusFirstNodeWidget(this))}),1E3);c.resolve()}));return c},_getLayerDetails:function(a,b){var c=new aa,d=[];0<a.length?(new P(a)).then(y.hitch(this,function(e){if(e)for(var f=0;f<e.length;f++)b[f].layerType=
e[f][1],d.push(b[f].jimuLayerInfo.getLayerObject());0<d.length&&(new P(d)).then(y.hitch(this,function(h){if(h)for(var m=0;m<h.length;m++)b[m].layerObject=h[m][1];c.resolve(b)}))})):c.resolve(b);return c},_initUpdateEnd:function(){if(!this.hidePanel)for(var a in this.layerList){var b=this.layerList[a];"ClusterLayer"!==b.type&&b&&b.layerObject&&b.layerObject.hasOwnProperty("refreshInterval")&&0<b.layerObject.refreshInterval&&this.updateEnd.push(this.own(L(b.layerObject,"update-end",y.hitch(this,this._updateEnd))))}},
_updateEnd:function(a){var b=this.layerList.hasOwnProperty(a.target.id)?a.target.id:this.layerList.hasOwnProperty(a.target.id+"_CL")?a.target.id+"_CL":"";if(""===b)for(var c in this.layerList){var d=this.layerList[c];if(d&&d.layerObject&&d.layerObject.id===a.target.id){b=d.li.id;break}}this.layerList.hasOwnProperty(b)&&(a=this.layerList[b],a.isLoaded=!1,a.updating=!1,a.requiresReload=!0,a&&(a.legendOpen?this._loadList(a,this.config.countEnabled):this.config.countEnabled&&this.countFeatures(a)))},
updateThemeClusterSymbol:function(a,b){a=a.symbolData;this.appConfig.theme.styles&&this.appConfig.theme.styles[0]&&"undefined"===typeof this._styleColor&&this._updateStyleColor(this.appConfig.theme.styles[0]);if(this._styleColor){var c=ba.fromHex(this._styleColor);b+=1;var d=0<b?30*b:30,e=0===b%2,f=c.g,h=c.b;c=c.r-d;e&&(255<c?c-=255:0>c&&(c+=255));h-=d;0===b%3&&e&&(255<h?h-=255:0>h&&(h+=255));d=f-d;0===b%5&&e&&(255<d?d-=255:0>d&&(d+=255));a.clusterType="CustomCluster";a.clusterSymbol={color:[c,d,
h,1],outline:{color:[0,0,0,0],width:0,type:"esriSLS",style:"esriSLSNull"},type:"esriSFS",style:"esriSFSSolid"}}},removeOldClusterLayers:function(a){var b=[],c;for(c in this.layerList)if("ClusterLayer"===this.layerList[c].type){var d=0;a:for(;d<a.length;d++){var e=a[d];if(e.id+this.UNIQUE_APPEND_VAL_CL===c){e.symbolData&&!e.symbolData.clusteringEnabled&&b.push(c);break a}}}if(0<b.length)for(var f in b)if(this.layerList.hasOwnProperty(b[f])){if(-1<this.map.graphicsLayerIds.indexOf(b[f])){if((a=this.layerList[b[f]])&&
a.li){var h;a.li.parentLayerID&&(h=this.operLayerInfos.getLayerInfoById(a.li.parentLayerID));!h&&a.li.layer&&(h=this.operLayerInfos.getLayerInfoById(a.li.layer));h&&a.hasOwnProperty("parentLayerVisible")&&h.setTopLayerVisible(a.parentLayerVisible)}this.map.removeLayer(this.layerList[b[f]].layerObject)}this.layerList[b[f]].layerObject.destroy();delete this.layerList[b[f]]}},addMapLayers:function(){for(var a=Object.keys(this.layerList).reverse(),b=0;b<a.length;b++){var c=a[b],d=this.layerList[c];d.type&&
"ClusterLayer"===d.type&&-1===this.map.graphicsLayerIds.indexOf(c)&&this.map.addLayer(d.layerObject)}},updateLayerList:function(a,b,c,d){var e=null;d=d||this.operLayerInfos.getLayerInfoById(a.id);var f=this._checkSelfType(d,b,c,a),h=this._checkListDisabled(b),m=K.getFeatureLayerDefinition(a);if(b.symbolData.clusteringEnabled){var l=this._getClusterLayer(b,a,d,c,m);var v="ClusterLayer";c=l;var x=l.id;this.clusterLayerArray.push({clusterLayer:l,parentID:b.id});this.hidePanel||this.own(L(l,"update-end",
y.hitch(this,function(){this._loadList(this.layerList[l.id],!0)})));this.numClusterLayers+=1}else if("ArcGISStreamLayer"===a.layerType){v="StreamLayer";x=a.layerObject.id;c=a.layerObject;var G=a}else{x="FeatureLayer"===c?b.id:a.id;var w=this.operLayerInfos.getLayerInfoById(b.parentLayerID)||a.parentLayerInfo;if(w&&w.layerObject&&(e=w.layerObject,v=e.type,w.originOperLayer&&w.originOperLayer.featureCollection&&(v=w.originOperLayer.featureCollection.layers)))for(w=0;w<v.length;w++){var O=v[w];O.id===
x&&(G=O)}l=a.layerObject?a.layerObject:a;v=c;c=e&&!e.empty?e:l?l:a;if("geo_rss"===f&&c&&c.getFeatureLayers)for(w=c.getFeatureLayers(),O=0;O<w.length;O++){var N=w[O];N.id===b.id&&(c=N)}G=G?G:a}this.layerList[x]={type:v,layerObject:c,pl:G,id:x,visible:d&&d.isShowInMap?d.isShowInMap():!0,li:b,filter:d?d.getFilter():"1\x3d1",infoTemplate:d.getInfoTemplate()||b.infoTemplate,selfType:f,listDisabled:h,showAllFeatures:this.showAllFeatures,layerDefinition:m};"ArcGISStreamLayer"!==a.layerType&&this.updateRenderer(x);
this.hidePanel||this._addPanelItem(e?e:l?l:a,b,h,d)},_checkListDisabled:function(a){return a.symbolData.featureDisplayOptions.listDisabled?a.symbolData.featureDisplayOptions.listDisabled:a.symbolData.featureDisplayOptions.fields?0===a.symbolData.featureDisplayOptions.fields.length:!0},_checkSelfType:function(a,b,c,d){d=(b=b.layerObject&&!b.layerObject.empty?b.layerObject:d)&&b.originOperLayer?b.originOperLayer:d;a=(a=a.originOperLayer&&a.originOperLayer.selfType?a.originOperLayer.selfType:d&&d.selfType?
d.selfType:"")&&""!==a?a:d&&d.layerType&&"CSV"===d.layerType?"collection":"Feature Collection"===c?"collection":"CSVLayer"===c?"collection":"";!a&&c&&"KML"===c&&(a="kml");return a},updateRenderer:function(a){a=this.layerList[a];if("LayerSymbol"!==a.li.symbolData.symbolType){"undefined"===typeof a.li.orgRenderer&&(a.li.orgRenderer=a.layerObject.renderer?a.layerObject.renderer:a.li.renderer);var b=new J(Y.fromJson(a.li.symbolData.symbol));a.li.newRenderer=b;if(a.layerObject.setLayerDrawingOptions&&
!isNaN(a.li.subLayerId)){var c=[],d=new Z;d.renderer=b;c[a.li.subLayerId]=d;a.layerObject.setLayerDrawingOptions(c)}else a.layerObject.setRenderer?a.layerObject.setRenderer(b):console.log("Error setting the new renderer...will use the default rendering of the layer");"function"===typeof a.layerObject.refresh&&a.layerObject.refresh()}},_onRecNodeMouseover:function(a){k.add(a,this.isDartTheme?"layer-row-mouseover-dart":this.isDashboardTheme&&!this.isLightTheme?"layer-row-mouseover-dashboard":"layer-row-mouseover")},
_onRecNodeMouseout:function(a){k.remove(a,this.isDartTheme?"layer-row-mouseover-dart":this.isDashboardTheme&&!this.isLightTheme?"layer-row-mouseover-dashboard":"layer-row-mouseover")},_addPanelItem:function(a,b,c,d){var e=b.id+this.UNIQUE_APPEND_VAL_CL;e=b.id in this.layerList?b.id:e in this.layerList?e:"";var f=this.layerList[e];if(f){var h=f.type;var m=this.isDashboardTheme?["rec","expand","expandDown-dashboard","solidBorder"]:this.isDartTheme?["rec-dart","expand-dart","expandDown-dart","solidBorder-dart"]:
["rec","expand","expandDown","solidBorder"];var l=I.create("div",{"class":m[0]+" "+m[3]+" esriCTInfoLayer",id:"rec_"+e,"attr-layerid":e,tabindex:0,"aria-label":b.label},this.pageMain);c?(z.setStyle(l,"cursor","default"),m="expand-empty"):(this.own(L(l,"mouseover",y.hitch(this,this._onRecNodeMouseover,l))),this.own(L(l,"mouseout",y.hitch(this,this._onRecNodeMouseout,l))),m=m[1]+" "+m[2],d&&d.isInScale&&(m+=d.isInScale()?"":" expandInActive"));var v=I.create("div",{"class":"recIcon active sub-active",
id:"recIcon_"+e,"attr-layerid":e,tabindex:-1,role:"button","aria-label":this.nls.logoPrefix+b.label},l),x=I.create("div",{"class":m,id:"exp_"+e,tabindex:-1,"attr-layerid":e,role:"button","aria-label":this.nls.expand,"aria-expanded":"false"},l);b.panelImageData&&-1<b.panelImageData.toString().indexOf("\x3cimg")&&(d=document.createElement("div"),d.innerHTML=b.panelImageData,d=new Aa(d.children[0].src,26,26),b.panelImageData=this._createImageDataDiv(d,44,44,void 0,!0).innerHTML);v.innerHTML=b.panelImageData;
va.set(v.firstChild,"border-radius","41px");if(this.config.countEnabled){b=I.create("div",{"class":"recLabel",id:"recLabel_"+e,innerHTML:"\x3cp\x3e"+b.label+"\x3c/p\x3e"},l);z.setStyle(b,"top","20px");var G=I.create("div",{"class":"recNum",id:"recNum_"+e,innerHTML:""},l)}else b=I.create("div",{"class":"recLabelNoCount",id:"recLabel_"+e,innerHTML:"\x3cp\x3e"+b.label+"\x3c/p\x3e"},l);"ClusterLayer"===h?(a.node=G,c||this._addLegend(e,f),a._updateNode(a.nodeCount)):"StreamLayer"===h?(f.node=G,this.countFeatures(f),
c||this._addLegend(e,f)):(f.node=G,this._addLegend(e,f));L(v,"click",y.hitch(this,this._toggleLayerVisibility,f));L(v,"keydown",y.hitch(this,function(w){if(w.keyCode===E.TAB)w.stopPropagation(),w.preventDefault(),C.focus(x);else if(w.keyCode===E.ESCAPE)w.stopPropagation(),w.preventDefault(),p.set(v,"tabindex",-1),p.set(x,"tabindex",-1),this._support508Accessibility(),C.focus(l);else if(w.keyCode===E.ENTER||w.keyCode===E.SPACE)w.stopPropagation(),w.preventDefault(),this._toggleLayerVisibility(f,w),
C.focus(w.currentTarget)}));c||(f.toggleLegend=L(l,"click",y.hitch(this,this._toggleLegend,f)),L(l,"keydown",y.hitch(this,function(w){if(w.keyCode===E.ENTER||w.keyCode===E.SPACE)w.stopPropagation(),w.preventDefault(),p.set(v,"tabindex",0),p.set(x,"tabindex",0),C.focus(v),K.initFirstFocusNode(this.domNode,v),K.initLastFocusNode(this.domNode,x)})),L(x,"keydown",y.hitch(this,function(w){var O=this.layerList[w.currentTarget.id.split("exp_")[1]];this.handleArrowLayer(w,O)})));f.legendOpen?p.set(x,"aria-expanded",
"true"):p.set(x,"aria-expanded","false")}},handleArrowLayer:function(a,b){var c=a.currentTarget.id,d=p.get(a.currentTarget,"attr-layerid"),e="rec_".concat(d);d="recIcon_".concat(d);if(a.keyCode===E.TAB)a.stopPropagation(),a.preventDefault(),C.focus(A.byId(d));else if(a.keyCode===E.ESCAPE)a.stopPropagation(),a.preventDefault(),p.set(A.byId(d),"tabindex",-1),p.set(A.byId(c),"tabindex",-1),this._support508Accessibility(),C.focus(A.byId(e));else if(a.keyCode===E.ENTER||a.keyCode===E.SPACE)a.stopPropagation(),
a.preventDefault(),this._toggleLegend(b,a,!0)},_addLegend:function(a,b){b.legendOpen=null===this.row&&this.config.expandList;b.legendNode=I.create("div",{"class":"legendLayer "+(b.legendOpen?"legendOn":"legendOff"),id:"legend_"+a},this.pageMain);"ClusterLayer"===b.type&&(b.layerObject.legendNode=b.legendNode);this.row="firstRowExpanded"},_getListFields:function(a){var b=[],c=this._getInfoTemplate(a);V.forEach(c&&c.info&&c.info.fieldInfos?c.info.fieldInfos:[],function(e){e.visible&&-1===e.fieldName.indexOf("/")&&
b.push(e.fieldName)});var d=a.li.symbolData&&a.li.symbolData.featureDisplayOptions?a.li.symbolData.featureDisplayOptions:{};V.forEach(d.fields||[],function(e){-1===b.indexOf(e.name)&&b.push(e.name)});d.groupField&&-1===b.indexOf(d.groupField.name)&&b.push(d.groupField.name);if(0===b.length||"undefined"===typeof c)b=["*"];"*"!==b[0]&&a.layerObject&&a.layerObject.objectIdField&&-1===b.indexOf(a.layerObject.objectIdField)&&b.push(a.layerObject.objectIdField);return b},_loadList:function(a,b){if(!this.hidePanel){var c=
a.layerObject.id in this.layerList?a.layerObject.id:a.li.id;b&&this._addSearching(c);var d=this._getListFields(a);if("ClusterLayer"===a.type){a.li.layerListExtentChanged&&(a.layerObject.clusterFeatures(),a.li.layerListExtentChanged=!1);var e=[];if(a.layerObject.clusterGraphics||a.layerObject._features){if(this.showAllFeatures)e=a.layerObject._features;else{c=a.layerObject.clusterGraphics;for(var f=0;f<c.length;f++){var h=c[f];if(h.graphics&&0<h.graphics.length)for(var m=0;m<h.graphics.length;m++)e.push(h.graphics[m])}}setTimeout(y.hitch(this,
function(){this._updateList(e,a.legendNode,a.layerObject.node,d,b,a)}),100)}else this._removeSearching(c,a.legendNode?!k.contains(a.legendNode,"legendOff"):!0)}else this.getFeatures(a,d,b)}},_addSearching:function(a){var b=this.layerList[a].listDisabled,c=b?"expand-empty":this.isDartTheme?"expandDown-dart":this.isDashboardTheme&&!this.isLightTheme?"expandDown-dashboard":"expandDown",d=b?"expand-empty":this.isDartTheme?"expandUp-dart":this.isDashboardTheme&&!this.isLightTheme?"expandUp-dashboard":
"expandUp";b=b?"expandSearching-empty":"expandSearching";a="exp_"+a;A.byId(a)&&(k.contains(a,c)&&(k.remove(a,c),k.add(a,b)),k.contains(a,d)&&(k.remove(a,d),k.add(a,b)))},_removeSearching:function(a,b){var c=this.layerList[a].listDisabled,d=c?"expand-empty":this.isDartTheme?"expandDown-dart":this.isDashboardTheme&&!this.isLightTheme?"expandDown-dashboard":"expandDown",e=c?"expand-empty":this.isDartTheme?"expandUp-dart":this.isDashboardTheme&&!this.isLightTheme?"expandUp-dashboard":"expandUp";c=c?"expandSearching-empty":
"expandSearching";var f="exp_"+a;A.byId(f)&&(k.contains(f,c)&&(k.remove(f,c),k.add(f,b?e:d)),b&&this._setFeatureItemFocused(a))},_setFeatureItemFocused:function(a){if(a){var b=this._getClusteringEnabledValue(a);var c="legend_".concat(a);var d="recIcon_".concat(a);var e="exp_".concat(a);b&&-1===a.lastIndexOf("_CL",a.length-3)&&(c+="_CL",d+="_CL",e+="_CL");a=A.byId(c);if(T(".groupItem",a).length)p.set(A.byId(d),"tabIndex",-1),p.set(A.byId(e),"tabIndex",-1),this._support508Accessibility(!0),d=T(".groupItemTitle",
a),d.length&&(this.initialOpen||C.focus(d[0]));else if(a=T(".featureItem",a),c=a.length)p.set(A.byId(d),"tabIndex",-1),p.set(A.byId(e),"tabIndex",-1),this._support508Accessibility(!0),this.initialOpen||C.focus(a[0])}},_getClusteringEnabledValue:function(a){var b;-1<a.lastIndexOf("_CL",a.length-3)&&(a=a.split("_CL")[0]);for(b in this.configLayerInfos){var c=this.configLayerInfos[b];if(c.id===a)return c.symbolData.clusteringEnabled}},_getClusterLayer:function(a,b,c,d,e){var f=b.layerObject?b.layerObject:
b,h=a.infoTemplate,m=f&&f.originOperLayer?f.originOperLayer:b.parentLayerInfo?b.parentLayerInfo:c?c.originOperLayer:void 0,l=null;l=a.id+this.UNIQUE_APPEND_VAL_CL;b=!0;-1<this.map.graphicsLayerIds.indexOf(l)||-1<this.map._layers.indexOf(l)?(l=this.map.getLayer(l),f=e=!1,JSON.stringify(l.symbolData)!==JSON.stringify(a.symbolData)&&(l.symbolData=a.symbolData,l.countColor=a.symbolData._highLightColor,f=!0),d=I.toDom(a.panelImageData),JSON.stringify(l.icon)!==JSON.stringify(d.src)&&(l.icon=d.src,f=!0),
I.destroy(d.id),l.displayFeatureCount=a.symbolData.displayFeatureCount,l.refresh!==a.refresh&&(l.refresh=a.refresh,e=!0),f&&l._setupSymbols(),l.countEnabled=this.config.countEnabled,l.hidePanel=this.hidePanel,l.showAllFeatures!==this.showAllFeatures&&(e=!0,l.showAllFeatures=this.showAllFeatures),l.listDisabled!==this.listDisabled&&(e=!0,l.listDisabled=this.listDisabled),e?l.url&&l.refreshFeatures(l.url):f&&l.clusterFeatures()):(b=!1,l=new ma({name:a.label+this.UNIQUE_APPEND_VAL_CL,id:l,map:this.map,
node:A.byId("recNum_"+l),legendNode:A.byId("legend_"+l),infoTemplate:"undefined"!==typeof f.infoTemplate?f.infoTemplate:h,refreshInterval:this.config.refreshInterval,refreshEnabled:this.config.refreshEnabled,parentLayer:f,lyrInfo:a,lyrType:d,_styleColor:this._styleColor,originOperLayer:m,countEnabled:this.config.countEnabled,hidePanel:this.hidePanel,filter:c?c.getFilter():"1\x3d1",showAllFeatures:this.showAllFeatures,listDisabled:this.listDisabled,_parent:this,layerDefinition:e}));l.setVisibility(b?
l.visible:c.isShowInMap?c.isShowInMap():!0);return l},_createImageDataDiv:function(a,b,c,d,e){if(a){var f=b;var h=c;if(a.height&&a.width)if(a.height>a.width){var m=a.width/a.height;h=b*m}else if(a.width===a.height||a.width>a.height)h=b,m=a.width/a.height,f=0<m?c*m:c;"undefined"!==typeof a.setWidth?"undefined"!==typeof a.setHeight?(a.setWidth(e?h-.25*h:h),a.setHeight(e?f-.25*f:f)):a.setWidth(2):"undefined"!==typeof a.size&&20<a.size&&a.setSize(20);f=I.create("div",{"class":"imageDataGFX"},d);d=u.createSurface(f,
b,c);a=Y.getShapeDescriptors(a);d.createShape(a.defaultShape).setFill(a.fill).setStroke(a.stroke).applyTransform({dx:b/2,dy:c/2})}return f},_updateUI:function(a){this.styleName=a;this.isDashboardTheme&&(this.isLightTheme=a?"light"===a:this.isLightTheme,this._updateNodes(this.isLightTheme?"expandDown-dashboard":"expandDown",this.isLightTheme?"expandDown":"expandDown-dashboard"),this._updateNodes(this.isLightTheme?"expandUp-dashboard":"expandUp",this.isLightTheme?"expandUp":"expandUp-dashboard"),this._updateNodes(this.isLightTheme?
"expand-dashboard":"expand",this.isLightTheme?"expand":"expand-dashboard"),this._updateNodes(this.isLightTheme?"groupItemImageUp-dashboard":"groupItemImageUp",this.isLightTheme?"groupItemImageUp":"groupItemImageUp-dashboard"),this._updateNodes(this.isLightTheme?"groupItemImageDown-dashboard":"groupItemImageDown",this.isLightTheme?"groupItemImageDown":"groupItemImageDown-dashboard"),this._updateNodes(this.isLightTheme?"groupItemImage-dashboard":"groupItemImage",this.isLightTheme?"groupItemImage":"groupItemImage-dashboard"))},
_updateNodes:function(a,b){var c=T("."+a);V.forEach(c,function(d){k.remove(d,a);k.add(d,b)})},_toggleLayerVisibility:function(a,b){b.stopPropagation();this.map.infoWindow.hide();b=a.id?a.id:a.layerObject.id;var c=this.layerList[b];c||(a.pl&&(b=a.pl.id),c=this.layerList[b]);if(c){a=[null,void 0,"null","undefined"];var d=c.li&&c.li.hasOwnProperty("subLayerId")?-1===a.indexOf(c.li.subLayerId)&&"-1"!==c.li.subLayerId.toString():!1;a=this.operLayerInfos.getLayerInfoById(b);var e=!k.contains("recIcon_"+
b,"active");if(d&&"ClusterLayer"!==c.type){if(e)for(b=a.parentLayerInfo;b;)b.setTopLayerVisible(!0),b=b.parentLayerInfo;a.setTopLayerVisible(e)}else c&&(c.layerObject.setVisibility(e),"ClusterLayer"===c.type&&e&&(c.layerObject.handleMapExtentChange({levelChange:!0}),c.layerObject.flashFeatures()),"undefined"!==typeof c.pl&&(c.pl.visibility=e,-1<this.map.graphicsLayerIds.indexOf(b)&&this.map.getLayer(b).setVisibility(e)))}},_toggleLayerUI:function(a,b,c){var d=a.id?a.id:a.layerObject.id,e=this.layerList[d];
e||(a.pl&&(d=a.pl.id),e=this.layerList[d]);if(e){a=A.byId("recLabel_"+d);this.layerList[d].visible=b;this.layerList[d].parentLayerVisible=b;this.layerList[d].visScaleRange=c;"ClusterLayer"===this.layerList[d].type&&(this.layerList[d].layerObject.parentLayerVisible=b);if(this.config.countEnabled&&k.contains("recNum_"+d,b?"recNumInActive":"recNum")){this._updatePanel(e,d);var f=this.isDartTheme?" darkThemeColor":" lightThemeColor";k.remove("recNum_"+d,b?"recNumInActive":"recNum");k.add("recNum_"+d,
(b?"recNum":"recNumInActive")+f)}f=this.isDartTheme?"expandDown-dart":this.isDashboardTheme&&!this.isLightTheme?"expandDown-dashboard":"expandDown";var h=this.isDartTheme?"expandUp-dart":this.isDashboardTheme&&!this.isLightTheme?"expandUp-dashboard":"expandUp",m=k.contains("rec_"+d,"inActive");if(b&&c){k.add("recIcon_"+d,"active");m||k.add("recIcon_"+d,"sub-active");a&&a.firstChild&&!m&&k.remove(a.firstChild,"inActive");k.contains("exp_"+d,"expandInActive")&&c&&k.remove("exp_"+d,"expandInActive");
e.toggleLegend&&e.toggleLegend.remove();if(b=A.byId("rec_"+d))e.toggleLegend=L(b,"click",y.hitch(this,this._toggleLegend,e)),k.contains(b.id,"inActive")&&c&&(k.remove(b.id,"inActive"),p.set(b.id,"tabindex",0));k.contains("rec_"+d,"recDefault")&&k.remove("rec_"+d,"recDefault");e.listDisabled||(this.showAllFeatures&&(!this.showAllFeatures||e.hasOwnProperty("isLoaded")&&e.isLoaded)||this._loadList(e,!0),e.legendOpen&&(k.add("legend_"+d,"legendOn"),k.remove("legend_"+d,"legendOff"),k.contains("exp_"+
d,f)&&(k.remove("exp_"+d,f),k.add("exp_"+d,h)),p.set(A.byId("exp_"+d),"aria-expanded","true"),C.focus(A.byId("recIcon_"+d))))}else{var l=b?k.add:k.remove;l("recIcon_"+d,"active");m||l("recIcon_"+d,"sub-active");a&&a.firstChild&&!m&&(b?k.remove:k.add)(a.firstChild,"inActive");k.contains("exp_"+d,"expandInActive")||k.add("exp_"+d,"expandInActive");e.legendOpen&&k.contains("legend_"+d,"legendOn")&&(k.remove("legend_"+d,"legendOn"),k.add("legend_"+d,"legendOff"),k.contains("exp_"+d,h)&&(k.remove("exp_"+
d,h),k.add("exp_"+d,f)),p.set(A.byId("exp_"+d),"aria-expanded","false"));e.toggleLegend&&e.toggleLegend.remove();k.contains("rec_"+d,"rec")&&k.add("rec_"+d,"recDefault");!c&&((c=A.byId("recIcon_"+d))&&k.contains(c,"sub-active")||!c)&&(k.add("rec_"+d,"inActive"),p.set("rec_"+d,"tabindex",-1))}}return!1},_toggleLegend:function(a,b,c){if("thumb2"!==b.currentTarget.className&&"recIcon"!==b.currentTarget.className){var d=a.layerObject.id in this.layerList?a.layerObject.id:a.li.id;if(k.contains("legend_"+
d,"legendOff")){this._addSearching(d);this.layerList[d].legendOpen=!0;if("undefined"===typeof this.layerList[d].li.layerListExtentChanged||this.layerList[d].requiresReload)this.layerList[d].li.layerListExtentChanged=!0,this.layerList[d].requiresReload=!1;this.layerList[d].li.layerListExtentChanged?setTimeout(y.hitch(this,function(){this._loadList(a,!1)}),500):this._removeSearching(d,!0);k.remove("legend_"+d,"legendOff");k.add("legend_"+d,"legendOn");p.set(A.byId("exp_"+d),"aria-expanded","true");
c&&this._setFeatureItemFocused(d)}else if(k.contains("legend_"+d,"legendOn")){this.layerList[d].legendOpen=!1;c=this.isDartTheme?"expandDown-dart":this.isDashboardTheme&&!this.isLightTheme?"expandDown-dashboard":"expandDown";var e=this.isDartTheme?"expandUp-dart":this.isDashboardTheme&&!this.isLightTheme?"expandUp-dashboard":"expandUp";k.contains("exp_"+d,e)&&(k.remove("exp_"+d,e),k.add("exp_"+d,c));k.remove("legend_"+d,"legendOn");k.add("legend_"+d,"legendOff");p.set(A.byId("exp_"+d),"aria-expanded",
"false")}}b.stopPropagation()},_toggleGroup:function(a,b){var c=b.currentTarget.id.slice(0,-2),d=this.isDartTheme?"featureItem-dart":"featureItem",e=!0;b.target.parentNode&&(""!==b.target.parentNode.id&&k.contains(b.target.parentNode.id,d)&&(e=!1),""!==b.target.id&&k.contains(b.target.id,d)&&(e=!1));d=this.isDartTheme?"groupItemImage-dart":this.isDashboardTheme&&!this.isLightTheme?"groupItemImage-dashboard":"groupItemImage";var f=this.isDartTheme?"groupItemImageUp-dart":this.isDashboardTheme&&!this.isLightTheme?
"groupItemImageUp-dashboard":"groupItemImageUp",h=this.isDartTheme?"groupItemImageDown-dart":this.isDashboardTheme&&!this.isLightTheme?"groupItemImageDown-dashboard":"groupItemImageDown";if(e){a=a.layerObject.id in this.layerList?a.layerObject.id:a.li.id;e=document.getElementById(b.currentTarget.id);var m=e.childNodes[0].childNodes.length-1;k.contains(c,"groupOff")?(this.layerList[a].openGroups&&0<this.layerList[a].openGroups.length?-1===this.layerList[a].openGroups.indexOf(c)&&this.layerList[a].openGroups.push(c):
this.layerList[a].openGroups=[c],k.remove(c,"groupOff"),k.add(c,"groupOn"),this._updateLastNode(),this.layerList[a].groupOpen=!0,-1<e.childNodes[0].childNodes[m].childNodes[0].className.indexOf(d)&&(z.removeClass(e.childNodes[0].childNodes[m].childNodes[0],h),z.addClass(e.childNodes[0].childNodes[m].childNodes[0],f))):k.contains(c,"groupOn")&&(k.remove(c,"groupOn"),k.add(c,"groupOff"),this._updateLastNode(),this.layerList[a].openGroups&&0<this.layerList[a].openGroups.length?(c=this.layerList[a].openGroups.indexOf(c),
-1<c&&this.layerList[a].openGroups.splice(c,1),0===this.layerList[a].openGroups.length&&(this.layerList[a].groupOpen=!1)):this.layerList[a].groupOpen=!1,-1<e.childNodes[0].childNodes[m].childNodes[0].className.indexOf(d)&&(z.removeClass(e.childNodes[0].childNodes[m].childNodes[0],f),z.addClass(b.currentTarget.childNodes[0].childNodes[m].childNodes[0],h)))}},onAppConfigChanged:function(a,b,c){switch(b){case "themeChange":this.inPanelOverrides(c);this.destroy();break;case "layoutChange":this.inPanelOverrides(c);
break;case "styleChange":this.hidePanel||(this._updateUI(c),this._updateStyleColor(c));break;case "widgetChange":this.widgetChange=!0;c&&c.config&&c.config.layerInfos&&this.removeOldClusterLayers(c.config.layerInfos);this.row=null;break;case "mapChange":this._clearMap()}},_updateStyleColor:function(a){setTimeout(y.hitch(this,function(){var b=this.getPanel();switch(this.appConfig.theme.name){case "BoxTheme":b=b.containerNode.parentNode.parentNode.children[0];break;case "DartTheme":b=b.containerNode.parentNode;
break;case "TabTheme":b=b.containerNode;break;case "BillboardTheme":b=b.containerNode.parentNode;break;case "FoldableTheme":b=b.containerNode.parentNode.firstChild;break;default:b=this.pageHeader}b=window.getComputedStyle(b,null).getPropertyValue("background-color");if("transparent"===b||-1!==[null,void 0].indexOf(n.fromRgb(b).toHex()))b="rgba(0, 0, 0, 0)";this._styleColor=n.fromRgb(b).toHex();for(var c in this.layerList)b=this.layerList[c],"ClusterLayer"===b.type&&b.layerObject.setStyleColor(this._styleColor);
this._updateUI(a)}),50)},_clearMap:function(){if(this.layerList){for(var a in this.layerList){var b=this.layerList[a];if("ClusterLayer"===b.type){var c=!0;"undefined"!==typeof this.continuousRefreshEnabled&&(c=!this.continuousRefreshEnabled);c&&(b.layerObject._clear(),this.map.removeLayer(b.layerObject))}}this.layerList={}}},_close:function(){this.widgetManager.closeWidget(this.id)},onClose:function(){this.inherited(arguments);this.isOpen=!1;for(var a in this.layerList){var b=this.layerList[a];if(b.li&&
b.li.orgRenderer){if(b.layerObject.setLayerDrawingOptions&&!isNaN(b.li.subLayerId))try{var c=b.layerObject.layerDrawingOptions,d=JSON.parse(b.li.rendererJson);c[b.li.subLayerId].renderer=R.fromJson(d);b.layerObject.setLayerDrawingOptions(c)}catch(e){console.log(e),b.layerObject.setLayerDrawingOptions([])}else b.layerObject.setRenderer?b.layerObject.setRenderer(b.li.orgRenderer):console.log("Error re-setting the renderer");"function"===typeof b.layerObject.refresh&&b.layerObject.refresh()}}a=!0;"undefined"!==
typeof this.config.continuousRefreshEnabled&&(a=!this.config.continuousRefreshEnabled);a&&0!==this.refreshInterval&&(this.refreshIntervalValue=0,clearInterval(this.refreshInterval),this.refreshInterval=0);this.hidePanel||("undefined"!==typeof this.mapExtentChangedHandler?(this.mapExtentChangedHandler.remove(),this.mapExtentChangedHandler=void 0):"undefined"!==typeof this.iconClickHandler&&(this.iconClickHandler.remove(),this.iconClickHandler=void 0));this.config.hasOwnProperty("displayClusterLayer")&&
!1===this.config.displayClusterLayer&&this.clusterLayerArray.length&&V.forEach(this.clusterLayerArray,y.hitch(this,function(e){e.clusterLayer.hide();(e=this.operLayerInfos.getLayerInfoById(e.parentID))&&e.show()}))},_clearChildNodes:function(a){for(;a.hasChildNodes();)a.removeChild(a.lastChild)},_inVisibleRange:function(a){var b=!0;(a=this.operLayerInfos.getLayerInfoById(a))&&a.isCurrentScaleInTheScaleRange&&(b=a.isInScale());return b},_mapExtentChange:function(a){for(var b in this.layerList)this._updatePanel(this.layerList[b],
b);this._support508Accessibility("boolean"===typeof a?a:void 0)},_updatePanel:function(a,b){a.visScaleRange=this._inVisibleRange(b);this.showAllFeatures||this._clearList(a);!a.legendOpen||a.groupEnabled&&!a.groupOpen?(a.li&&(a.li.layerListExtentChanged=!0),a.visible&&a.visScaleRange?("ClusterLayer"===a.type&&a.layerObject.initalLoad&&this.config.countEnabled&&a.layerObject._updateNode(a.layerObject.node.innerHTML),"ClusterLayer"!==a.type&&("undefined"===typeof a.layerObject?console.log("layer object not known"):
this.countFeatures(a))):a.visScaleRange||this._updateList([],a.legendNode,a.node,[],!0,a)):a.visible&&a.visScaleRange?(a.updateList=!0,this._loadList(a,a.updateList)):this._updateList([],a.legendNode,a.node,[],!0,a)},getFeatures:function(a,b,c){var d=a.layerObject,e=a.legendNode,f=a.node,h=!a.listDisabled&&a.legendOpen?!0:!1,m=a.visScaleRange,l=d&&d.maxRecordCount?d.maxRecordCount:void 0,v=[],x=this._getQuery(a,b,h);if(a.visible&&m)if(d.queryFeatures)a.listDisabled||v.push(d.queryFeatures(x)),v.push(d.queryIds(x));
else{var G=a.li.url;if((-1<G.indexOf("MapServer")||-1<G.indexOf("FeatureServer"))&&-1===G.indexOf("WFSServer"))m=new D(G),a.listDisabled||v.push(m.execute(x)),v.push(m.executeForIds(x));else if(-1<G.indexOf("WFSServer")||a.type&&"WFSLayer"===a.type)x=new aa,x.resolve(this._queryWFS(d&&d.graphics?d.graphics:[])),v.push(x)}else this._updateList([],a.legendNode,a.node,[],!0,a);0<v.length&&oa(v).then(y.hitch(this,function(w){var O=a.layerObject.id in this.layerList?a.layerObject.id:a.li.id,N;f&&(N=this.config.countEnabled?
f.parentNode:f.previousSibling);(a.type&&"WFSLayer"===a.type||a.li&&a.li.url&&-1<a.li.url.indexOf("WFSServer"))&&w[0]&&w[0].hasOwnProperty("length")?(N=w[0].length,this.config.countEnabled&&(f.innerHTML=K.localizeNumber(N)),this._removeSearching(O,!1),this._updateList(w[0],e,f,b,N,a)):w&&1<w.length?(O=w[1])&&l&&O.length>l?this._chunkRequest(d,G,O,l,b,h).then(y.hitch(this,function(za){this._updateList(za,e,f,b,c,a)})):this._updateList(w[0].features,e,f,b,c,a):w&&1===w.length?(this.config.countEnabled&&
(f.innerHTML=K.localizeNumber(w[0].length)),this._removeSearching(O,!1)):(this.config.countEnabled&&(f.innerHTML=K.localizeNumber(0)),this.updateExpand(N,!0),this._removeSearching(O,a.legendOpen))}),function(w){console.log(w)})},_chunkRequest:function(a,b,c,d,e,f){var h=new aa,m=[],l;var v=0;for(l=c.length;v<l;v+=d){var x=c.slice(v,v+d),G=new t;G.outFields=e;G.objectIds=x;G.returnGeometry=f;a.queryFeatures?m.push(a.queryFeatures(G)):b&&(x=new D(b),m.push(x.execute(G)))}(new P(m)).then(y.hitch(this,
function(w){if(w){for(var O=[],N=0;N<w.length;N++)w[N][1].features&&O.push.apply(O,w[N][1].features);h.resolve(O)}}));return h},_clearList:function(a){!a.isLoaded&&a.legendNode&&(a.isLoaded=!1,a.legendNode.innerHTML="")},_updateList:function(a,b,c,d,e,f,h){var m=f.li?f.li:f;if(a){"ClusterLayer"===f.type&&f.layerObject.node&&k.contains(f.layerObject.node.id,"searching")&&k.remove(f.layerObject.node.id,"searching");var l=f.visScaleRange,v=f.infoTemplate,x=f.symbolData?f.symbolData.featureDisplayOptions:
m&&m.symbolData?m.symbolData.featureDisplayOptions:{};if(c||b)b&&(f.hasOwnProperty("isLoaded")?!f.isLoaded:1)&&(b.innerHTML=""),e&&c&&this.config.countEnabled&&(l?c.innerHTML=K.localizeNumber(a.length):function(B,M,Ba,xa){this.countFeatures(f,f.id||m.id).then(y.hitch(this,function(qa){var Ha=this.config.countEnabled?B.parentNode:M.previousSibling;("ClusterLayer"===qa.type&&qa.visible||"ClusterLayer"!==qa.type)&&this.updateExpand(Ha,Ba?0===xa.length:!0)}))}.call(this,c,b,l,a)),c=this.config.countEnabled?
c.parentNode:b.previousSibling,("ClusterLayer"===f.type&&f.visible||"ClusterLayer"!==f.type)&&this.updateExpand(c,l?0===a.length:!0);if(!h){if(!f.listDisabled&&!f.isLoaded&&0<a.length){h=this.operLayerInfos.getLayerInfoById(f.id);e="ClusterLayer"===f.type?f.layerObject.renderer:m.bypassDrawingInfo&&m.rendererJson&&R.fromJson(JSON.parse(m.rendererJson))?R.fromJson(JSON.parse(m.rendererJson)):h&&h.layerObject&&h.layerObject.renderer?h.layerObject.renderer:a[0]._graphicsLayer?a[0]._graphicsLayer.renderer:
f.layerObject&&f.layerObject.renderer?f.layerObject.renderer:m&&m.renderer?R.fromJson(m.renderer)||m.renderer:f.renderer?R.fromJson(f.renderer)||f.renderer:void 0;var G=f.li&&f.li.fields?f.li.fields:f.fields,w=[];c=[];h=[];for(var O=0;O<a.length;O++){var N=a[O];"undefined"===typeof N.infoTemplate&&v&&(N.infoTemplate=v);var za=e&&e.getSymbol?e.getSymbol(N):N.symbol?Y.fromJson(N.symbol):void 0,na=N._layer&&N._layer.objectIdField?N._layer.objectIdField:m&&m.oidFieldName&&m.oidFieldName.name?m.oidFieldName.name:
f.layerObject&&f.layerObject.objectIdField?f.layerObject.objectIdField:f&&f.oidFieldName?f.oidFieldName:void 0,sa=na?N.attributes[na]:b.id+O,Ca=this.getDisplayString(N,f,"*"===d[0]?N.attributes:d,x,na,"*"===d[0]?!1:!0);na=Ca.displayString;var ta=Ca.aliasNames;Ca=Ca.firstValue;if(x.groupEnabled){var ca=void 0,ka=void 0,Ea=void 0;if("undefined"===typeof x.groupByField||x.groupByField){var ha=x.groupField;ca=N.attributes[ha.name];var ia="byField";Ea=ca}else{ha=x.groupByRendererOptions.fields[0];ca=N.attributes[ha.name];
var ja=x.groupByRendererOptions.values;ia="byRenderer";if(null!==ca&&""!==ca){var da=0;a:for(;da<ja.length;da++){var ea=ja[da],S=ea.value;S=(S=S.split("\x26\x26"))&&1<S.length?ca+S[0]+"\x26\x26 "+ca+S[1]:isNaN(ca)?"'"+ca+"'"+ea.value:ca+ea.value;if(eval(S)){ka=ea;break a}}"undefined"!==typeof ka&&null!==ka&&(Ea=ka.label.replace(/ /g,""))}}ja="group_"+m.id+"_"+ha.name+"_"+Ea;ea=!0;if(0<w.length)a:for(da=0;da<w.length;da++)if(S=w[da],ja===S.id&&("byField"===ia&&ca===S.value||"byRenderer"===ia)){ea=
!1;var Ga=S.node;da=S.parent;break a}if(ea){da=I.create("div",{"class":this.isDartTheme?"groupItem-dart":"groupItem",id:ja+"_c"});ea=I.create("div",{"class":this.isDartTheme?"groupItemTitle-dart":"groupItemTitle",id:ja+"_t","attr-layerid":m.id,role:"button",tabindex:"0"},da);S="";var la="byRenderer"===ia?"":ha.name+": ";"undefined"!==typeof ta&&ta.hasOwnProperty(ha.name)&&""!==ta[ha.name]&&(la="byField"===ia?ta[ha.name]+": ":"");"byField"===ia?"undefined"!==typeof ha.label&&""!==ha.label&&(la=S=ha.label+
": "):"undefined"!==typeof ka?"undefined"!==typeof ka.label&&""!==ka.label&&(la=S=la+ka.label):la=S=la+ca;": "===S&&(la=S="");ta=this._getFormattedValue(N,ha.name,f,G);"byRenderer"===ia&&za&&this._createImageDataDiv(y.clone(za),30,30,ea,ya);I.create("div",{"class":"byField"===ia?"groupField":"groupFieldImage",innerHTML:"byField"===ia?S+ta:S,title:"byField"===ia?la+ta:la},ea);ya=!1;f.openGroups&&0<f.openGroups.length&&(ya=-1<f.openGroups.indexOf(ja));ka=this.isDartTheme?" darkThemeColor":" lightThemeColor";
ka=I.create("div",{"class":this.isDartTheme?"groupCountLabel":"groupCountLabel"+ka},ea);la=I.create("div",{"class":this.isDartTheme||this.isDashboardTheme&&!this.isLightTheme?"expandImageContainer-dart":"expandImageContainer"},ea);var Ia=this.isDartTheme?"groupItemImageUp-dart":this.isDashboardTheme&&!this.isLightTheme?"groupItemImageUp-dashboard":"groupItemImageUp",Ja=this.isDartTheme?"groupItemImageDown-dart":this.isDashboardTheme&&!this.isLightTheme?"groupItemImageDown-dashboard":"groupItemImageDown",
Da=this.isDartTheme?"groupItemImage-dart":this.isDashboardTheme&&!this.isLightTheme?"groupItemImage-dashboard":"groupItemImage";Da+=ya?" "+Ia:" "+Ja;I.create("div",{"class":Da},la);Da=this.isDartTheme?"groupItem-dart":"groupItem";Da+=f.groupOpen&&ya?" groupOn":" groupOff";ja=I.create("div",{"class":Da,id:ja},da);w.push({id:"group_"+m.id+"_"+ha.name+"_"+Ea,node:ja,parent:da,value:ca});c.push({value:ca,node:da,countNode:ka,count:1});L(da,"click",y.hitch(this,this._toggleGroup,f));L(ea,"keydown",y.hitch(this,
function(B){var M=p.get(B.currentTarget,"attr-layerid"),Ba=this._getClusteringEnabledValue(M);if(B.keyCode===E.SPACE||B.keyCode===E.ENTER)A.byId(B.currentTarget.parentNode.id).click(),B.preventDefault();if(B.keyCode===E.ESCAPE){B.stopPropagation();B.preventDefault();B="rec_"+M;var xa="recIcon_"+M,qa="exp_"+M;Ba&&-1===M.lastIndexOf("_CL",M.length-3)&&(B+="_CL",xa+="_CL",qa+="_CL");p.set(A.byId(xa),"tabindex",-1);p.set(A.byId(qa),"tabindex",-1);this._support508Accessibility();C.focus(A.byId(B))}}));
p.set(ea,"aria-label","byField"===ia?S+ta:S)}else c.filter(function(B){if(B.node.id===Ga.id+"_c")return B})[0].count+=1,ja=Ga}sa=I.create("div",{"class":this.isDartTheme?"featureItem-dart":"featureItem",id:"feature_"+m.id+"_"+sa,"attr-layerid":m.id,role:"button",tabindex:0});var ya=!1;m&&m.symbolData&&(ya="CustomSymbol"===m.symbolData.symbolType);!za||x.groupEnabled&&"byRenderer"===ia||this._createImageDataDiv(y.clone(za),30,30,sa,ya);L(sa,"click",y.hitch(this,this._panToFeature,N));L(sa,"keydown",
y.hitch(this,function(B){var M=p.get(B.currentTarget,"attr-layerid"),Ba=this._getClusteringEnabledValue(M);if(B.keyCode===E.ENTER||B.keyCode===E.SPACE)B.currentTarget.click(),B.preventDefault();if(B.keyCode===E.ESCAPE){B.stopPropagation();B.preventDefault();B="rec_"+M;var xa="recIcon_"+M,qa="exp_"+M;Ba&&-1===M.lastIndexOf("_CL",M.length-3)&&(B+="_CL",xa+="_CL",qa+="_CL");p.set(A.byId(xa),"tabindex",-1);p.set(A.byId(qa),"tabindex",-1);this._support508Accessibility();C.focus(A.byId(B))}}));-1<na.indexOf(" - ")&&
(na=na.slice(0,-3));p.set(sa,"aria-label",na);I.create("div",{style:"padding: 7px 5px 5px "+(x.groupEnabled&&"byRenderer"===ia?"15px":"50px")+"; text-align: "+(window.isRTL?"right":"left")+";",innerHTML:na,title:na},sa);h.push({node:sa,updateNode:ja?ja:b,firstValue:Ca})}if(0<c.length){a=x.groupByRendererOptions;if(x.groupByRenderer&&a&&a.values){var Fa=[];V.forEach(a.values,function(B){Fa.push(B.label)});a=function(B,M){return Fa.indexOf(B.node.innerText)-Fa.indexOf(M.node.innerText)}}else a=function(B,
M){return"undefined"===typeof B.value?M.value:"undefined"===typeof M.value?B.value:isNaN(B.value)?B.value.localeCompare(M.value):parseFloat(B.value)-parseFloat(M.value)};a=c.sort(a);var Ka=this.config.countEnabled;x&&"DESC"===x.groupFeaturesSortOrder&&(a=a.reverse());V.forEach(a,function(B){Ka&&(B.countNode.innerHTML=K.localizeNumber(B.count));b.appendChild(B.node)})}0<h.length&&(a=h.sort(function(B,M){B=B.firstValue;M=M.firstValue;return"undefined"===typeof B||null===B||""===B?1:"undefined"===typeof M||
null===M||""===M?-1:B===M?0:isNaN(B)?B.toString().localeCompare(M.toString()):parseFloat(B)-parseFloat(M)}),x&&"DESC"===x.layerOptionsSortOrder&&(a=a.reverse()),V.forEach(a,function(B){I.place(B.node,B.updateNode)}))}if(!this.showAllFeatures||this.showAllFeatures&&l)m.layerListExtentChanged=!1;x=f.layerObject&&f.layerObject.id&&f.layerObject.id in this.layerList?f.layerObject.id:m.id;this.showAllFeatures&&f.visible&&l&&(l=!0,f.layerObject&&"ClusterLayer"===f.type&&(l=!f.layerObject.queryPending,f.layerObject.hasOwnProperty("requiresReload")&&
(l=l&&!f.layerObject.requiresReload,f.layerObject.requiresReload=!1)),f.isLoaded=l);this._removeSearching(x,f.legendOpen);this.initialOpen=!1}}},_support508Accessibility:function(a){var b,c,d;var e=1;var f=T(".esriCTInfoLayer",this.domNode);f.length&&(f.forEach(y.hitch(this,function(h){d=p.get(h,"attr-layerid");c=this.operLayerInfos.getLayerInfoById(d);(visible=c.isShowInMap()&&c.isInScale())&&e&&(b=h,e=0);visible||p.set(h,"tabindex",-1)})),K.initFirstFocusNode(this.domNode,b),a||C.focus(b),this._updateLastNode())},
_updateLastNode:function(){var a,b,c,d,e;var f=T(".esriCTInfoLayer",this.domNode);if(f.length&&(f.forEach(y.hitch(this,function(l){d=p.get(l,"attr-layerid");c=this.operLayerInfos.getLayerInfoById(d);if(e=c.isShowInMap()&&c.isInScale())m=l,a=p.get(l,"attr-layerid")})),m&&(K.initLastFocusNode(this.domNode,m),f="legend_".concat(a),(f=A.byId(f))&&k.contains(f,"legendOn")))){var h=T(".groupItemTitle",f);if(b=h.length){var m=h[b-1];K.initLastFocusNode(this.domNode,m);h=m.nextSibling;k.contains(h,"groupOn")&&
(f=T(".featureItem",f),h=f.length)&&(m=f[h-1],K.initLastFocusNode(this.domNode,m))}else if(f=T(".featureItem",f),h=f.length)m=f[h-1],K.initLastFocusNode(this.domNode,m)}},updateExpand:function(a,b){if("undefined"!==typeof a){if(-1<a.id.indexOf("rec_")){var c=a.id.replace("rec_","");var d=A.byId("exp_"+c)}b?(a&&(z.addClass(a,"recDefault"),((b=A.byId("recIcon_"+c))&&k.contains(b,"sub-active")||!b)&&z.addClass(a,"inActive")),d&&(k.contains(d,"expand-empty")||z.addClass(d,"expandInActive"))):(a&&(z.removeClass(a,
"recDefault"),z.removeClass(a,"inActive")),d&&(k.contains(d,"expand-empty")||z.removeClass(d,"expandInActive")))}},getDisplayString:function(a,b,c,d,e,f){var h="",m={},l="";if(0<d.fields.length){var v=b.li&&b.li.fields?b.li.fields:b.fields;V.forEach(d.fields,y.hitch(this,function(x){for(var G in c){var w=f?c[G]:G;if(w===x.name){G=this._getFormattedValue(a,w,b,v);var O=this._getRawFeatureValue(a,w);m[w]=this._checkAliasName(v,w);l=""===l?O:l;O=(w="undefined"!==typeof x.label)?""===x.label.trim()?"":
": ":"";h+=(w?x.label:"")+O+G+" - ";break}}}))}return{displayString:h,aliasNames:m,firstValue:l}},_getRawFeatureValue:function(a,b){a=a.attributes[b];return"undefined"===typeof a||null===a?"":a},_getFormattedValue:function(a,b,c,d){var e=a.attributes[b];e="undefined"===typeof e||null===e?"":e;var f=this._getInfoTemplate(c);if(f)if(f.info&&f.info.fieldInfos)var h=f.info.fieldInfos;else f._fieldsMap&&(h=f._fieldsMap);var m;h&&Array.isArray(h)&&h.hasOwnProperty("length")&&(m=this._getFieldByName(h,b));
if(d=this._getFieldByName(d,b))h=this._checkIntField(d),f="ClusterLayer"===c.type?!1:this._checkDomainField(d),a="ClusterLayer"===c.type?!1:this._checkDomainAndSubtype(c.layerDefinition,b,a.attributes,c),e=this._checkDateField(d)?this.formatDateValue(e,m):f||a?this.formatDomainValue(e,f,a):h?this.formatNumberValue(e,m):e;return e},_getFieldByName:function(a,b){if(a){var c=a.filter(function(d){return d.name===b||d.fieldName===b||a.hasOwnProperty(d)&&a[d].fieldName===b});if(c&&0<c.length)return c[0]}},
_getInfoTemplate:function(a){var b=a.infoTemplate;b||(a.layerObject&&a.layerObject.infoTemplate?b=a.layerObject.infoTemplate:a.li&&a.li.infoTemplate&&(b=a.li.infoTemplate));if(!b&&"undefined"!==typeof a.li.subLayerId){var c=a.layerObject.infoTemplates;c&&c.hasOwnProperty(a.li.subLayerId)&&(b=c[a.li.subLayerId].infoTemplate)}return b},formatNumberValue:function(a,b){var c=a;isNaN(a)||""===a||(c=K.localizeNumberByFieldInfo(a,b&&b.format?b:void 0));return c||""},formatDomainValue:function(a,b,c){if(c)return c;
if(b&&b.codedValues)for(b=b.codedValues,c=0;c<b.length;c++){var d=b[c];if(d.code===a||d.name==a)return d.name}},formatDateValue:function(a,b){return a?(b=b&&b.format?b:void 0,a=new Date(parseInt(a,10)),b?K.localizeDateByFieldInfo(a,b):K.localizeDate(a)):""},_checkAliasName:function(a){return"undefined"!==typeof a.alias?a.alias:!1},_checkDomainField:function(a){return"undefined"!==typeof a.domain?a.domain:!1},_checkDomainAndSubtype:function(a,b,c,d){return a&&b&&c&&(a=K.getDisplayValueForCodedValueOrSubtype(d.layerObject&&
d.layerObject.renderer?d.layerObject:a,b,c))&&a.isCodedValueOrSubtype&&"undefined"!==typeof a.displayValue?a.displayValue:!1},_checkDateField:function(a){return"esriFieldTypeDate"===a.type},_checkIntField:function(a){return-1<["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(a.type)},_checkDisplayField:function(a,b){var c=!0;if(a)for(var d=0;d<a.length;d++){if(a[d].name===b)return a[d];c=!1}return c},flashGraphics:function(a){for(var b=0;b<a.length;b++)this._flashFeature(a[b])},
_flashFeature:function(a){if(a.geometry){var b=n.fromHex(this._styleColor),c=y.clone(b);c.a=.4;switch(a.geometry.type){case "point":var d=new pa(pa.STYLE_CIRCLE,15,new ra(ra.STYLE_SOLID,b,1),c);break;case "polyline":d=new ra(ra.STYLE_SOLID,b,3);break;case "polygon":d=new g(g.STYLE_DIAGONAL_CROSS,new ra(ra.STYLE_SOLID,b,2),c)}}a=new W(a.geometry,d);this.map.graphics.add(a);if(d=a.getDojoShape())r.animateStroke({shape:d,duration:900,color:{start:d.strokeStyle.color,end:d.strokeStyle.color},width:{start:25,
end:0}}).play(),setTimeout(this._clearFeature,1075,a)},_clearFeature:function(a){a.getLayer().remove(a)},_panToFeature:function(a){if(a.geometry){var b=a.geometry;if("polyline"===b.type){var c=b.paths[Math.ceil(b.paths.length/2)-1];c=c[Math.ceil((c.length-1)/2)];b=new U(c[0],c[1],b.spatialReference)}"point"!==b.type&&(b=b.getExtent().getCenter());this._pan(a,b).then(y.hitch(this,function(){this._flashFeature(a);if(a._layer&&a._layer.infoTemplate||a.infoTemplate)this.map.infoWindow.setFeatures([a]),
this.map.infoWindow.select(0),this.map.infoWindow.show(b)}))}},_pan:function(a,b){var c=new aa;this.showAllFeatures&&!this.map.extent.contains(a.geometry)?this.map.centerAt(b).then(function(d){c.resolve(d)}):c.resolve(void 0);return c},_getQuery:function(a,b,c){var d=a.layerObject,e=new t;e.geometry=this.showAllFeatures?null:this.map.extent;e.outFields=b;e.returnGeometry=c;b=["collection","kml","geo_rss"];a.selfType&&-1<b.indexOf(a.selfType)||!d.url?this.showAllFeatures&&d&&d.fullExtent&&(e.geometry=
d.fullExtent):e.where=a.filter?a.filter:"1\x3d1";return e},_queryWFS:function(a){return a.filter(y.hitch(this,function(b){return this.map.extent.intersects(b.geometry)}))},countFeatures:function(a){var b=new aa;if(this.hidePanel)b.resolve(a);else{var c=a.layerObject,d="undefined"!==typeof a.visible?a.visible:c.visible,e=a.visScaleRange,f=this.config.countEnabled?a.node:a.legendNode,h=this._getQuery(a);if(c.queryCount&&c.visible)(function(l){c.queryCount(h,y.hitch(this,function(v){if(f){if(this.config.countEnabled){f.innerHTML=
K.localizeNumber(v);var x=f.parentNode}else x=f.previousSibling;this.updateExpand(x,e?0===v:!0)}b.resolve(l)}))}).call(this,a);else if(a&&a.li&&a.li.url&&d&&(-1<a.li.url.indexOf("MapServer")||-1<a.li.url.indexOf("FeatureServer"))&&-1===a.li.url.indexOf("WFSServer"))(function(l){(new D(l.li.url)).executeForIds(h).then(y.hitch(this,function(v){if(f){var x=v?v.length:0;this.config.countEnabled?(f.innerHTML=K.localizeNumber(x),v=f.parentNode):v=f.previousSibling;this.updateExpand(v,e?0===x:!0)}b.resolve(l)}))}).call(this,
a);else if(d&&("WFSLayer"===a.type||a.li&&a.li.url&&-1<a.li.url.indexOf("WFSServer"))){if(f){var m=this._queryWFS(c&&c.graphics?c.graphics:[]).length;this.config.countEnabled?(f.innerHTML=K.localizeNumber(m),d=f.parentNode):d=f.previousSibling;this.updateExpand(d,e?0===m:!0);b.resolve(a)}}else b.resolve(a)}return b}})});