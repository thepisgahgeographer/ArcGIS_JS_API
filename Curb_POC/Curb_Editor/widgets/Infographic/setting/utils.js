// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define(["dojo/_base/lang","../utils","jimu/utils"],function(g,l,k){var f={stringFieldType:"esriFieldTypeString",oidFieldType:"esriFieldTypeOID",dateFieldType:"esriFieldTypeDate",numberFieldTypes:["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],geometryFieldType:"esriFieldTypeGeometry",getFieldInfo:function(a,b){var c=null;b=b.fields;for(var d=0;d<b.length;d++)b[d].name===a&&(c=b[d]);return c},isGeometryType:function(a,b){return(a=f.getFieldInfo(a,b))?
a.type===f.geometryFieldType:!1},isStringType:function(a,b){return(a=f.getFieldInfo(a,b))?a.type===f.stringFieldType:!1},isNumberType:function(a,b,c){if(!a||!b)return!1;var d=g.clone(f.numberFieldTypes);c&&d.push(f.oidFieldType);a=f.getFieldInfo(a,b);return!a||a.domain?!1:-1<d.indexOf(a.type)},isDateField:function(a,b){return(a=f.getFieldInfo(a,b))?a.type===f.dateFieldType:!1},getNotGeometryFields:function(a){if(a&&a.length)return a.filter(function(b){return b.type!==f.geometryFieldType})},getFieldAlias:function(a,
b,c){a=f.getFieldInfo(a,b);return this.getFieldAliasByFieldInfo(a,c)},getFieldInfosByFieldName:function(a,b){return a.map(function(c){c=f.getFieldInfo(c,b);return g.clone(c)}.bind(this))},updateOptions:function(a,b,c,d){b?(b=g.clone(b),a.removeOption(a.getOptions()),a.addOption(b)):b=[];!c&&0<b.length&&(c=b[0].value);c&&(a.set("value",c),d&&(b=a.getOptions(c))&&"undefined"!==typeof b.label&&a.set("title",b.label))},getNumberFields:function(a){if(a)return a.filter(function(b){return-1<this.numberFieldTypes.indexOf(b.type)}.bind(this))},
getFieldSelectOptions:function(a){if(a)return a.map(g.hitch(this,function(b){return{label:b.alias||b.name,value:b.name}}))},preProcessDefinition:function(a){if(!a||"Table"!==a.type)return a;var b=a.fields;if(b&&b.length)return b=b.filter(function(c){return!("STAT_COUNT"===c.name&&"STAT_COUNT"===c.alias&&"esriFieldTypeInteger"===c.type)}),a.fields=null,a.fields=b,a},getTemplateNameByMainDijitJson:function(a){if(a){var b;"gauge"===a.type?b=this._getTempNameForGaugeType(a):"chart"===a.type?b=this._getTempNameForChartType(a):
"number"===a.type&&(b="number");return b}},_getTempNameForGaugeType:function(a){var b;if(a=a.config.shape)return"curved"===a?b="gauge":"vertical"===a?b="vertical_gauge":"horizontal"===a&&(b="horizontal_gauge"),b},_getTempNameForChartType:function(a){var b=a.config;if(a=b.type){var c=b.stack,d=b.area;b=b.innerRadius;if("pie"===a)var e=b?"donut":"pie";else"bar"===a||"column"===a?(e=a,"normal"===c?e="stacked_"+e:"percent"===c&&(e="percentage_stacked_"+e)):"line"===a&&(d?(e="area","normal"===c?e="stacked_"+
e:"percent"===c&&(e="percentage_stacked_"+e)):e="line");return e}},hasNumberFields:function(a){var b=!1;(a=a.fields)&&0<a.length&&(b=a.some(g.hitch(this,function(c){return 0<=this.numberFieldTypes.indexOf(c.type)})));return b},getClusterFields:function(a,b){if(b&&b.length)return a.filter(function(d){return-1<b.indexOf(d.name)});var c=[this.stringFieldType,this.dateFieldType,this.oidFieldType];c=c.concat(g.clone(this.numberFieldTypes));return a.filter(function(d){return 0<=c.indexOf(d.type)})},getValueFields:function(a,
b,c){a=a.filter(g.hitch(this,function(d){return 0<=this.numberFieldTypes.indexOf(d.type)}));b&&b.length&&c&&c.length&&(a=a.filter(function(d){return 0>c.indexOf(d.name)}));return a},getDefaultColorOfTheme:function(a){if(a){var b={bgColor:"#fff",textColor:"#000"};if(!this.appConfig)return b;"DashboardTheme"!==a.name||"default"!==a.styles[0]&&"style3"!==a.styles[0]?"DartTheme"===a.name&&(b.bgColor="#4c4c4c",b.textColor="#fff"):(b.bgColor="#222222",b.textColor="#fff");return b}},getLayerFromMap:function(a,
b){var c=null;b&&"undefined"!==typeof a&&(c=b.getLayer(a));return c},getCustomColorSelects:function(a,b,c){if((c=this.getCategoriesByFeatures(a,c))&&c.length){c=c.filter(function(h){return!!h||0===h});var d=this.isNumberType(a,b,!0),e=[];e=(a=k.getCodedValueListForCodedValueOrSubTypes(b,a))?g.clone(a):c.map(function(h){return{label:h,value:h}});return{selects:e,isCodedValue:!!a,numberType:d}}},getCategoriesByFeatures:function(a,b){var c=[];if(!b||!b.length)return c;b.forEach(g.hitch(this,function(d){d=
d.attributes[a];0>c.indexOf(d)&&c.push(d)}));return this.sortOrderCategories(c)},sortOrderCategories:function(a){Array.isArray(a)&&a.sort(function(b,c){"string"===typeof s&&(b=b.toLowerCase());"string"===typeof t&&(c=c.toLowerCase());k.isNumberOrNumberString(b)&&(b=Number(b));k.isNumberOrNumberString(c)&&(c=Number(c));return b<c?-1:b>c?1:0}.bind(this));return a},getNextColor:function(a,b){if(a&&a.length){var c=0;b&&(b=a.indexOf(b),-1<b&&(c=b+1,c>a.length-1&&(c=0)));return a[c]}}};g.mixin(l,f);return l});