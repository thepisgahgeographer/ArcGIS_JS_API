// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/Print/templates/Print.html":'\x3cdiv class\x3d"gis_PrintDijit"\x3e\r\n    \x3cdiv class\x3d"formContainer"\x3e\r\n        \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"printSettingsFormDijit"\x3e\r\n            \x3ctable cellspacing\x3d"5" style\x3d"width:100%;"\x3e\r\n                \x3ctr data-dojo-attach-point\x3d"titleTr"\x3e\r\n                    \x3ctd style\x3d"width:65px;"\x3e\r\n                        ${nls.title}:\r\n                    \x3c/td\x3e\r\n                    \x3ctd\x3e\r\n                        \x3cinput type\x3d"text" data-dojo-attach-point\x3d"titleNode" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"name:\'title\',trim:true,required:true,style:\'width:100%;\'" /\x3e\r\n                    \x3c/td\x3e\r\n                \x3c/tr\x3e\r\n                \x3ctr style\x3d"display: none"\x3e\r\n                    \x3ctd\x3e\r\n                        ${nls.layout}:\r\n                    \x3c/td\x3e\r\n                    \x3ctd\x3e\r\n                        \x3cinput type\x3d"select" data-dojo-type\x3d"dijit/form/Select" data-dojo-props\x3d"name:\'layout\',style:\'width:100%;\'"\r\n                        data-dojo-attach-point\x3d"layoutDijit" data-dojo-attach-event\x3d"Change:onLayoutChange"/\x3e\r\n                    \x3c/td\x3e\r\n                \x3c/tr\x3e\r\n                \x3ctr style\x3d"display: none"\x3e\r\n                    \x3ctd\x3e\r\n                        ${nls.format}:\r\n                    \x3c/td\x3e\r\n                    \x3ctd\x3e\r\n                        \x3cinput type\x3d"select" data-dojo-type\x3d"dijit/form/Select" data-dojo-props\x3d"name:\'format\',style:\'width:100%;\'"\r\n                        data-dojo-attach-point\x3d"formatDijit" /\x3e\r\n                    \x3c/td\x3e\r\n                \x3c/tr\x3e\r\n            \x3c/table\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"buttonActionBar jimu-align-trailing"\x3e\r\n        \x3cdiv class\x3d"jimu-btn" data-dojo-attach-point\x3d"advancedButtonDijit" style\x3d"display: none"\r\n            data-dojo-attach-event\x3d"onclick:showSettings"\x3e\x3cdiv class\x3d"btn-icon settingsIcon"\x3e\x3c/div\x3e${nls.settings}\x3c/div\x3e\r\n        \x3cdiv data-dojo-type\x3d"dijit/TooltipDialog" data-dojo-attach-point\x3d"settingsDialog"\r\n            style\x3d"display: none" class\x3d"gis_PrintDijit"\x3e\r\n            \x3cdiv style\x3d"width:250px;"\x3e\r\n                \x3cdiv style\x3d"font-weight:bold;"\x3e\r\n                    ${nls.mapScaleExtent}:\r\n                \x3c/div\x3e\r\n                \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"preserveFormDijit"\x3e\r\n                    \x3ctable cellspacing\x3d"5"\x3e\r\n                        \x3ctr\x3e\r\n                            \x3ctd style\x3d"vertical-align:middle;"\x3e\r\n                                ${nls.preserve}:\r\n                            \x3c/td\x3e\r\n                            \x3ctd\x3e\r\n                                \x3cinput type\x3d"radio" data-dojo-attach-point\x3d"printWidgetMapScale" data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-props\x3d"name:\'preserveScale\',checked:true,value:\'true\'"\r\n                                /\x3e\x3clabel data-dojo-attach-point\x3d"printWidgetMapScaleLabel"\x3e${nls.mapScale}\x3c/label\x3e\r\n                                \x3cbr /\x3e\r\n                                \x3cinput type\x3d"radio" data-dojo-attach-point\x3d"printWidgetMapExtent" data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-props\x3d"name:\'preserveScale\',value:\'false\'"\r\n                                /\x3e\x3clabel data-dojo-attach-point\x3d"printWidgetMapExtentLabel"\x3e${nls.mapExtent}\x3c/label\x3e\r\n                            \x3c/td\x3e\r\n                            \x3ctr\x3e\r\n                                \x3ctd style\x3d"vertical-align: top; padding-top: 7px;"\x3e\r\n                                    ${nls.forceScale}:\r\n                                \x3c/td\x3e\r\n                                \x3ctd\x3e\r\n                                    \x3cdiv style\x3d"display: flex;"\x3e\r\n                                        \x3cinput type\x3d"radio" style\x3d"margin-top: 7px;" data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-props\x3d"name:\'preserveScale\',value:\'force\',checked:false"/\x3e\r\n                                        \x3cdiv style\x3d"display: flex; flex-direction: column;"\x3e\r\n                                            \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-props\x3d"name:\'forcedScale\',required:false,style:\'width:100px;\'" data-dojo-attach-point\x3d"forceScaleNTB"/\x3e\r\n                                            \x3ca href\x3d"#" data-dojo-attach-event\x3d"click:getCurrentMapScale"\x3e${nls.getCurrentScale}\x3c/a\x3e\r\n                                        \x3c/div\x3e\r\n                                    \x3c/div\x3e\r\n                                \x3c/td\x3e\r\n                            \x3c/tr\x3e\r\n                        \x3c/tr\x3e\r\n                    \x3c/table\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv style\x3d"font-weight:bold; margin-bottom: 5px"\x3e\r\n                    \x3cspan\x3e${nls.outputSR}\x3c/span\x3e\r\n                    \x3ca href\x3d"https://developers.arcgis.com/javascript/jshelp/ref_coordsystems.html" target\x3d"blank"\x3eWKID\x3c/a\x3e\r\n                    \x3cspan\x3e:\x3c/span\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv style\x3d"margin-bottom: 5px"\x3e\r\n                    \x3cdiv\x3e\r\n                        \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-attach-event\x3d"onChange:_onOutputSRChange"\r\n                            data-dojo-attach-point\x3d"wkidInput" data-dojo-props\x3d\'style:{width:"100%"}\'\r\n                            data-dojo-props\x3d"required: false"/\x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv class\x3d"wkid-label jimu-ellipsis" data-dojo-attach-point\x3d"wkidLabel"\x3e\r\n                    \x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv style\x3d"font-weight:bold;" data-dojo-attach-point\x3d"labelsTitleNode"\x3e\r\n                    ${nls.labels}:\r\n                \x3c/div\x3e\r\n                \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"labelsFormDijit"\x3e\r\n                    \x3ctable cellspacing\x3d"5"\x3e\r\n                        \x3ctr\x3e\r\n                            \x3ctd style\x3d"vertical-align:middle;"\x3e\r\n                                ${nls.showLabels}:\r\n                            \x3c/td\x3e\r\n                            \x3ctd\x3e\r\n                                \x3cinput type\x3d"checkbox" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d"name:\'showLabels\',value:true,checked:true" /\x3e\r\n                            \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                    \x3c/table\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv style\x3d"font-weight:bold;"\x3e\r\n                    ${nls.mapMetadata}:\r\n                \x3c/div\x3e\r\n                \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"layoutMetadataDijit"\x3e\r\n                    \x3ctable cellspacing\x3d"5" style\x3d"width:100%;"\x3e\r\n                        \x3ctr data-dojo-attach-point\x3d"authorTr"\x3e\r\n                            \x3ctd\x3e\r\n                                ${nls.author}:\r\n                            \x3c/td\x3e\r\n                            \x3ctd\x3e\r\n                                \x3cinput type\x3d"text" data-dojo-attach-point\x3d"authorNode" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"name:\'author\',trim:true,required:false,style:\'width:100%;\'" data-dojo-attach-point\x3d"authorTB"\r\n                                /\x3e\r\n                            \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                        \x3ctr data-dojo-attach-point\x3d"copyrightTr"\x3e\r\n                            \x3ctd\x3e\r\n                                ${nls.copyright}:\r\n                            \x3c/td\x3e\r\n                            \x3ctd\x3e\r\n                                \x3ctextarea data-dojo-attach-point\x3d"copyrightNode" name\x3d"copyright"\r\n                                    data-dojo-type\x3d"dijit/form/SimpleTextarea"\r\n                                    style\x3d"width:100%;height:60px;resize:none;"\x3e\x3c/textarea\x3e\r\n                            \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                    \x3c/table\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"customTextElementsDijit"\x3e\r\n                    \x3ctable cellspacing\x3d"5" style\x3d"width:100%;" data-dojo-attach-point\x3d"customTextElementsTable"\x3e\r\n\r\n                    \x3c/table\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"layoutFormDijit"\x3e\r\n                    \x3ctable cellspacing\x3d"5"\x3e\r\n                        \x3ctr data-dojo-attach-point\x3d"legendTr"\x3e\r\n                            \x3ctd\x3e\r\n                                ${nls.lncludeLegend}:\r\n                            \x3c/td\x3e\r\n                            \x3ctd\x3e\r\n                                \x3cinput type\x3d"checkbox" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d"name:\'legend\',value:true,checked:true"\r\n                                /\x3e\r\n                            \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                        \x3ctr data-dojo-attach-point\x3d"scalebarTr"\x3e\r\n                            \x3ctd\x3e\r\n                                ${nls.scaleBarUnit}:\r\n                            \x3c/td\x3e\r\n                            \x3ctd\x3e\r\n                                \x3cselect data-dojo-type\x3d"dijit/form/Select" data-dojo-props\x3d"name:\'scalebarUnit\',style:\'width:100%;\'"\r\n                        data-dojo-attach-point\x3d"scalebarUnitDijit"\x3e\r\n                                    \x3coption value\x3d"Miles" selected\x3d"selected"\x3e${nls.unitsMiles}\x3c/option\x3e\r\n                                    \x3coption value\x3d"Kilometers"\x3e${nls.unitsKilometers}\x3c/option\x3e\r\n                                    \x3coption value\x3d"Meters"\x3e${nls.unitsMeters}\x3c/option\x3e\r\n                                    \x3coption value\x3d"Feet"\x3e${nls.unitsFeet}\x3c/option\x3e\r\n                                \x3c/select\x3e\r\n                            \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                    \x3c/table\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv style\x3d"font-weight:bold;"\x3e\r\n                    ${nls.mapOnlyOptions}:\r\n                \x3c/div\x3e\r\n                \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"mapOnlyFormDijit"\x3e\r\n                    \x3ctable cellspacing\x3d"5"\x3e\r\n                        \x3ctr\x3e\r\n                            \x3ctd\x3e\r\n                                ${nls.width}:\r\n                            \x3c/td\x3e\r\n                            \x3ctd\x3e\r\n                                \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-props\x3d"name:\'width\',required:true,value:670,style:\'width:100px;\'"\r\n                                /\x3e\r\n                            \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                        \x3ctr\x3e\r\n                            \x3ctd\x3e\r\n                                ${nls.height}:\r\n                            \x3c/td\x3e\r\n                            \x3ctd\x3e\r\n                                \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-props\x3d"name:\'height\',required:true,value:500,style:\'width:100px;\'"\r\n                                /\x3e\r\n                            \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                    \x3c/table\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv style\x3d"font-weight:bold;"\x3e\r\n                    ${nls.printQualityOptions}:\r\n                \x3c/div\x3e\r\n                \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"mapQualityFormDijit"\x3e\r\n                    \x3ctable cellspacing\x3d"5"\x3e\r\n                        \x3ctr\x3e\r\n                            \x3ctd\x3e\r\n                                ${nls.dpi}:\r\n                            \x3c/td\x3e\r\n                            \x3ctd\x3e\r\n                                \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-props\x3d"name:\'dpi\',required:true,value:96,style:\'width:100px;\'"\r\n                                /\x3e\r\n                            \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                    \x3c/table\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv style\x3d"font-weight:bold;"\x3e\r\n                    ${nls.forceFeatureAttributes}:\r\n                \x3c/div\x3e\r\n                \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"forceAttributesFormDijit"\x3e\r\n                    \x3ctable cellspacing\x3d"5"\x3e\r\n                        \x3ctr\x3e\r\n                            \x3ctd style\x3d"vertical-align:middle;"\x3e\r\n                                ${nls.includeFeatureAttributes}:\r\n                            \x3c/td\x3e\r\n                            \x3ctd\x3e\r\n                                \x3cinput type\x3d"checkbox" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d"name:\'forceFeatureAttributes\',value:true,checked:false" /\x3e\r\n                            \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                    \x3c/table\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"jimu-btn" data-dojo-attach-point\x3d"printButtonDijit"\r\n            data-dojo-attach-event\x3d"onclick:print"\x3e\x3cdiv class\x3d"btn-icon printIcon"\x3e\x3c/div\x3e${nls.print}\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- \x3chr calss\x3d"spacer"\x3e --\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"printResultsNode" class\x3d"resultsContainer"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"clearActionBarNode" class\x3d"buttonActionBar"\r\n    style\x3d"display:none;padding:0;"\x3e\r\n        \x3cdiv class\x3d"jimu-btn" data-dojo-attach-event\x3d"onclick:clearResults"\x3e\r\n            \x3cdiv class\x3d"btn-icon clearIcon"\x3e\x3c/div\x3e${nls.clearList}\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/Print/templates/PrintResult.html":'\x3cdiv class\x3d"printResult" data-dojo-attach-point\x3d"resultNode" data-dojo-attach-event\x3d"onclick:_openPrint"\x3e\r\n  \x3ctable class\x3d"printResultTable"\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd width\x3d"25px"\x3e\r\n        \x3cspan class\x3d"bold"\x3e${count}.\x3c/span\x3e\r\n      \x3c/td\x3e\r\n      \x3ctd width\x3d"30px"\x3e\r\n        \x3cimg src\x3d"${icon}"\x3e\r\n      \x3c/td\x3e\r\n      \x3ctd data-dojo-attach-point\x3d"nameNode"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"progressBar" data-dojo-type\x3d"dijit/ProgressBar" data-dojo-props\x3d\'value:Infinity\'\x3e\x3c/div\x3e\r\n        \x3cspan data-dojo-attach-point\x3d"successNode" class\x3d"bold" style\x3d"display:none;"\x3e${docName}\x3c/span\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"errNode" style\x3d"display:none;"\x3e\r\n          \x3cspan class\x3d"bold"\x3e${nls.printError}\x3c/span\x3e\r\n          \x3cdiv class\x3d"jimu-icon jimu-icon-error jimu-float-trailing"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e\r\n'}});
define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin esri/tasks/PrintTask esri/tasks/PrintParameters esri/tasks/PrintTemplate esri/request esri/lang esri/arcgis/utils esri/SpatialReference dojo/_base/config dojo/_base/lang dojo/_base/array dojo/_base/html dojo/dom-style dojo/dom-construct dojo/dom-class dojo/promise/all dojo/Deferred jimu/portalUrlUtils dojo/text!./templates/Print.html dojo/text!./templates/PrintResult.html dojo/aspect dojo/query jimu/LayerInfos/LayerInfos jimu/dijit/LoadingIndicator jimu/dijit/Message jimu/utils jimu/SpatialReference/srUtils dojo/on dijit/popup dijit/form/ValidationTextBox dijit/form/Form dijit/form/Select dijit/form/NumberTextBox dijit/form/Button dijit/form/CheckBox dijit/ProgressBar dijit/form/DropDownButton dijit/TooltipDialog dijit/form/RadioButton dijit/form/SimpleTextarea esri/IdentityManager dojo/store/Memory".split(" "),
function(z,A,B,C,J,K,L,D,M,E,N,O,f,k,g,n,P,F,Q,G,H,x,R,y,I,S,T,U,u,q,V,v,W){x=z([A,B,C],{widgetsInTemplate:!0,templateString:x,map:null,count:1,results:[],authorText:null,copyrightText:null,copyrightEditable:!0,defaultTitle:null,defaultFormat:null,defaultLayout:null,baseClass:"gis_PrintDijit",pdfIcon:require.toUrl("./widgets/Print/images/pdf.png"),imageIcon:require.toUrl("./widgets/Print/images/image.png"),printTaskURL:null,printTask:null,async:!1,_showSettings:!1,_currentTemplateInfo:null,postCreate:function(){this.inherited(arguments);
this.printTask=new J(this.printTaskURL,{async:this.async});this.printparams=new K;this.printparams.map=this.map;this.shelter=new T({hidden:!0});this.shelter.placeAt(this.domNode);this.shelter.startup();this.shelter.show();this.titleNode.set("value",this.defaultTitle);this.authorNode.set("value",this.defaultAuthor);this.copyrightNode.set("value",this.defaultCopyright);this.copyrightNode.set("readOnly",!this.copyrightEditable);q.loadResource().then(f.hitch(this,function(){if(q.isValidWkid(this.map.spatialReference.wkid)){this.wkidInput.set("value",
this.map.spatialReference.wkid);var e=q.getSRLabel(this.map.spatialReference.wkid);this.wkidLabel.innerHTML=u.sanitizeHTML(e);this.wkidLabel.title=e}else this.wkidInput.set("value",""),this.wkidLabel.innerHTML="",this.wkidLabel.title="";this.wkidInput.set("invalidMessage",this.nls.invalidWkid);this.wkidInput.validator=function(b){return!b||""===b.trim()||q.isValidWkid(+b)}}));var a=H.setHttpProtocol(this.printTaskURL),c=H.getNewPrintUrl(this.appConfig.portalUrl);this._isNewPrintUrl=a===c||/sharing\/tools\/newPrint$/.test(a);
a=I("input",this.printWidgetMapScale.domNode)[0];c=I("input",this.printWidgetMapExtent.domNode)[0];u.combineRadioCheckBoxWithLabel(a,this.printWidgetMapScaleLabel);u.combineRadioCheckBoxWithLabel(c,this.printWidgetMapExtentLabel);"MAP_ONLY"===this.defaultLayout?g.setStyle(this.titleTr,"display","none"):g.setStyle(this.titleTr,"display","");this._hasLabelLayer()?(g.setStyle(this.labelsFormDijit.domNode,"display",""),g.setStyle(this.labelsTitleNode,"display","")):(g.setStyle(this.labelsFormDijit.domNode,
"display","none"),g.setStyle(this.labelsTitleNode,"display","none"));S.getInstance(this.map,this.map.itemInfo).then(f.hitch(this,function(e){this.layerInfosObj=e;return Q([this._getPrintTaskInfo(),this._getLayerTemplatesInfo()]).then(f.hitch(this,function(b){var d=b[0];(b=b[1])&&!b.error?(b=b&&b.results)&&0<b.length&&(k.some(b,f.hitch(this,function(h){return h&&"Output_JSON"===h.paramName?this.templateInfos=h.value:!1})),this.templateInfos&&0<this.templateInfos.length&&(this.templateNames=k.map(this.templateInfos,
function(h){return h.layoutTemplate}))):console.warn("Get Layout Templates Info Error",b&&b.error);!M.isDefined(d)||d&&d.error?this._handleError(d.error):this._handlePrintInfo(d)}))})).always(f.hitch(this,function(){this.shelter.hide()}));this.printTask._getPrintDefinition&&y.after(this.printTask,"_getPrintDefinition",f.hitch(this,"printDefInspector"),!1);this.printTask._createOperationalLayers&&(y.after(this.printTask,"_createOperationalLayers",f.hitch(this,"_fixInvalidSymbol")),y.after(this.printTask,
"_createOperationalLayers",f.hitch(this,"_excludeInvalidLegend")))},_onOutputSRChange:function(a){q.isValidWkid(+a)?(a=q.getSRLabel(+a),this.wkidLabel.innerHTML=u.sanitizeHTML(a),this.wkidLabel.title=a):(this.wkidLabel.innerHTML="",this.wkidLabel.title="")},_hasLabelLayer:function(){return k.some(this.map.graphicsLayerIds,function(a){return(a=this.map.getLayer(a))&&"esri.layers.LabelLayer"===a.declaredClass},this)},_getPrintTaskInfo:function(){var a=new G;this._isNewPrintUrl?a.resolve({isGPPrint:!1}):
D({url:this.printTaskURL,content:{f:"json"},callbackParamName:"callback",handleAs:"json",timeout:6E4}).then(f.hitch(this,function(c){a.resolve({isGPPrint:!0,data:c})}),f.hitch(this,function(c){a.resolve({error:c})}));return a},_getLayerTemplatesInfo:function(){var a=new G,c=this.printTaskURL.split("/"),e=c.indexOf("GPServer");if(-1<e){var b=null;b=/Utilities\/PrintingTools\/GPServer/.test(this.printTaskURL)?c.slice(0,e+1).join("/")+"/"+encodeURIComponent("Get Layout Templates Info Task")+"/execute":
c.slice(0,e+1).join("/")+"/"+encodeURIComponent("Get Layout Templates Info")+"/execute";D({url:b,content:{f:"json"},callbackParamName:"callback",handleAs:"json",timeout:6E4}).then(f.hitch(this,function(d){a.resolve(d)}),f.hitch(this,function(d){a.resolve({error:d})}))}else a.resolve(null);return a},_fixInvalidSymbol:function(a){k.forEach(a,function(c){"map_graphics"===c.id&&(c=f.getObject("featureCollection.layers",!1,c))&&0<c.length&&k.forEach(c,function(e){e&&e.featureSet&&"esriGeometryPoint"===
e.featureSet.geometryType&&k.forEach(e.featureSet.features,function(b){b&&b.symbol&&!b.symbol.style&&(b.symbol.style="esriSMSSquare")})})},this);return a},_excludeInvalidLegend:function(a){function c(p){return k.filter(p.subLayerIds,f.hitch(this,function(r){return(r=this.layerInfosObj.getLayerInfoById(p.id+"_"+r))&&r.getShowLegendOfWebmap()}))}if(this.printTask.allLayerslegend){var e=E.getLegendLayers({map:this.map,itemInfo:this.map.itemInfo});e=k.map(e,function(p){return{id:p.layer.id}});for(var b=
this.printTask.allLayerslegend,d=[],h=0;h<b.length;h++){var m=b[h],l=this.map.getLayer(m.id),w=this.layerInfosObj.getLayerInfoById(m.id),X=l&&l.declaredClass&&"esri.layers.GraphicsLayer"!==l.declaredClass;l=!l.renderer||l.renderer&&!l.renderer.hasVisualVariables();w=w&&w.getShowLegendOfWebmap();X&&l&&w&&(m.subLayerIds&&(m.subLayerIds=f.hitch(this,c,m)()),d.push(m))}k.forEach(e,f.hitch(this,function(p){var r=k.some(d,f.hitch(this,function(Y){return Y.id===p.id})),t=this.layerInfosObj.getLayerInfoById(p.id);
t=t&&t.getShowLegendOfWebmap()&&t.isShowInMap();!r&&t&&d.push(p)}));this.printTask.allLayerslegend=d}return a},printDefInspector:function(a){"force"===this.preserve.preserveScale&&(a.mapOptions.scale=this.preserve.forcedScale);return a},_handleError:function(a){console.log("print widget load error: ",a);new U({message:a.message||a})},onLayoutChange:function(a){var c=this.templateNames&&this.templateNames.indexOf(a);if(-1<c){g.empty(this.customTextElementsTable);a=this._currentTemplateInfo=this.templateInfos[c];
if((c=f.getObject("layoutOptions.customTextElements",!1,a))&&0<c.length){var e=[];k.forEach(c,f.hitch(this,function(b){for(var d in b)if(0>e.indexOf(d)){var h=this.customTextElementsTable.insertRow(-1);h.insertCell(-1).appendChild(g.toDom(d+": "));h.insertCell(-1).appendChild((new W({name:d,trim:!0,required:!1,value:b[d],style:"width:100%"})).domNode);e.push(d)}}))}f.getObject("layoutOptions.hasAuthorText",!1,a)?g.setStyle(this.authorTr,"display",""):g.setStyle(this.authorTr,"display","none");f.getObject("layoutOptions.hasCopyrightText",
!1,a)?g.setStyle(this.copyrightTr,"display",""):g.setStyle(this.copyrightTr,"display","none");f.getObject("layoutOptions.hasTitleText",!1,a)?g.setStyle(this.titleTr,"display",""):g.setStyle(this.titleTr,"display","none");f.getObject("layoutOptions.hasLegend",!1,a)?g.setStyle(this.legendTr,"display",""):g.setStyle(this.legendTr,"display","none")}else"MAP_ONLY"===a?(g.setStyle(this.authorTr,"display","none"),g.setStyle(this.copyrightTr,"display","none"),g.setStyle(this.titleTr,"display","none"),g.setStyle(this.legendTr,
"display","none"),this._currentTemplateInfo={layoutOptions:{hasTitleText:!1,hasCopyrightText:!1,hasAuthorText:!1,hasLegend:!1}}):(g.setStyle(this.authorTr,"display",""),g.setStyle(this.copyrightTr,"display",""),g.setStyle(this.titleTr,"display",""),g.setStyle(this.legendTr,"display",""),this._currentTemplateInfo={layoutOptions:{hasTitleText:!0,hasCopyrightText:!0,hasAuthorText:!0,hasLegend:!0}})},_getMapAttribution:function(){var a=this.map.attribution;return a&&a.domNode?g.getProp(a.domNode,"textContent"):
""},closeSettings:function(){v.close(this.settingsDialog);this._showSettings=!1},showSettings:function(a){a.preventDefault();a.stopPropagation();this._showSettings?(v.close(this.settingsDialog),this._showSettings=!1):(v.open({popup:this.settingsDialog,around:this.advancedButtonDijit}),this._showSettings=!0)},_handlePrintInfo:function(a){if(a.isGPPrint){a=a.data;n.set(this.layoutDijit.domNode.parentNode.parentNode,"display","");n.set(this.formatDijit.domNode.parentNode.parentNode,"display","");n.set(this.advancedButtonDijit,
"display","");this.own(V(document.body,"click",f.hitch(this,function(b){if(this._showSettings){b=b.target||b.srcElement;var d=this.settingsDialog.domNode;b===d||g.isDescendant(b,d)||(v.close(this.settingsDialog),this._showSettings=!1)}})));var c=k.filter(a.parameters,function(b){return"Layout_Template"===b.name});if(0===c.length)console.log('print service parameters name for templates must be "Layout_Template"');else{var e=k.map(c[0].choiceList,function(b){return{label:b,value:b}});e.sort(function(b,
d){return b.label>d.label?1:d.label>b.label?-1:0});0<e.length?(this.layoutDijit.addOption(e),this.defaultLayout?this.layoutDijit.set("value",this.defaultLayout):this.layoutDijit.set("value",c[0].defaultValue)):this.defaultLayout&&(this.layoutDijit.addOption([{label:this.defaultLayout,value:this.defaultLayout}]),this.layoutDijit.set("value",this.defaultLayout));a=k.filter(a.parameters,function(b){return"Format"===b.name});0===a.length?console.log('print service parameters name for format must be "Format"'):
(c=k.map(a[0].choiceList,function(b){return{label:b,value:b}}),c.sort(function(b,d){return b.label>d.label?1:d.label>b.label?-1:0}),0<c.length?(this.formatDijit.addOption(c),this.defaultFormat?this.formatDijit.set("value",this.defaultFormat):this.formatDijit.set("value",a[0].defaultValue)):this.defaultFormat&&(this.formatDijit.addOption([{label:this.defaultFormat,value:this.defaultFormat}]),this.formatDijit.set("value",this.defaultFormat)))}}else n.set(this.layoutDijit.domNode.parentNode.parentNode,
"display","none"),n.set(this.formatDijit.domNode.parentNode.parentNode,"display","none"),n.set(this.advancedButtonDijit,"display","none")},print:function(){if(this.printSettingsFormDijit.isValid()){var a=this.printSettingsFormDijit.get("value");f.mixin(a,this.layoutMetadataDijit.get("value"));f.mixin(a,this.forceAttributesFormDijit.get("value"));f.mixin(a,this.labelsFormDijit.get("value"));this.preserve=this.preserveFormDijit.get("value");f.mixin(a,this.preserve);this.layoutForm=this.layoutFormDijit.get("value");
var c=this.mapQualityFormDijit.get("value"),e=this.mapOnlyFormDijit.get("value");f.mixin(e,c);var b=this.customTextElementsDijit.get("value");c=[];var d=!1,h=O.locale||"en";for(l in b){var m={};"Date"===l&&(d=!0);m[l]=b[l];c.push(m)}d||c.push({Date:(new Date).toLocaleString(h)});d=this._currentTemplateInfo;var l=f.getObject("layoutOptions.hasAuthorText",!1,d);b=f.getObject("layoutOptions.hasCopyrightText",!1,d);d=f.getObject("layoutOptions.hasTitleText",!1,d);h=new L;h.format=a.format;h.layout=a.layout;
h.preserveScale="true"===a.preserveScale||"force"===a.preserveScale;"force"===a.preserveScale&&(h.outScale=0<this.preserve.forcedScale?this.preserve.forcedScale:this.map.getScale());h.forceFeatureAttributes=a.forceFeatureAttributes&&a.forceFeatureAttributes[0];h.label=a.title;h.exportOptions=e;h.showLabels=a.showLabels&&a.showLabels[0];h.layoutOptions={authorText:l?a.author:"",copyrightText:b?a.copyright||this._getMapAttribution():"",legendLayers:this._getLegendLayers(),titleText:d?a.title:"",customTextElements:c,
scalebarUnit:this.layoutForm.scalebarUnit};this.printparams.template=h;this.printparams.extraParameters={printFlag:!0};this.printparams.outSpatialReference=void 0;e=+this.wkidInput.get("value");q.isValidWkid(e)&&e!==this.map.spatialReference.wkid&&(this.printparams.outSpatialReference=new N(e));e=this.printTask.execute(this.printparams);(new Z({count:this.count.toString(),icon:"PDF"===a.format?this.pdfIcon:this.imageIcon,docName:a.title,title:a.title+", "+a.format+", "+a.layout,fileHandle:e,nls:this.nls})).placeAt(this.printResultsNode,
"last").startup();n.set(this.clearActionBarNode,"display","block");this.count++}else this.printSettingsFormDijit.validate()},_getLegendLayers:function(){var a=f.getObject("layoutOptions.hasLegend",!1,this._currentTemplateInfo),c=0<this.layoutForm.legend.length&&this.layoutForm.legend[0];if(this.printTask&&!this.printTask._createOperationalLayers){var e=[];a&&c&&(a=E.getLegendLayers({map:this.map,itemInfo:this.map.itemInfo}),e=k.map(a,function(b){return{layerId:b.layer.id}}));return e}return a&&c?
null:[]},clearResults:function(){P.empty(this.printResultsNode);n.set(this.clearActionBarNode,"display","none");this.count=1},updateAuthor:function(a){(a=a||"")&&this.authorTB&&this.authorTB.set("value",a)},getCurrentMapScale:function(){this.forceScaleNTB.set("value",this.map.getScale())}});var Z=z([A,B,C],{widgetsInTemplate:!0,templateString:R,url:null,postCreate:function(){this.inherited(arguments);this.progressBar.set("label",this.nls.creatingPrint);this.fileHandle.then(f.hitch(this,"_onPrintComplete"),
f.hitch(this,"_onPrintError"))},_onPrintComplete:function(a){a.url?(this.url=a.url,g.setStyle(this.progressBar.domNode,"display","none"),g.setStyle(this.successNode,"display","inline-block"),F.add(this.resultNode,"printResultHover")):this._onPrintError(this.nls.printError)},_onPrintError:function(a){console.log(a);g.setStyle(this.progressBar.domNode,"display","none");g.setStyle(this.errNode,"display","block");F.add(this.resultNode,"printResultError");g.setAttr(this.domNode,"title",a.details||a.message||
"")},_openPrint:function(){null!==this.url&&window.open(this.url)}});return x});