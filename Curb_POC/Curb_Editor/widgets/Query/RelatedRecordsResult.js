// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/Query/RelatedRecordsResult.html":'\x3cdiv\x3e\r\n  \x3cdiv role\x3d"button" tabindex\x3d"0" class\x3d"popup-menu-button related-records-action-button not-visible" data-dojo-attach-point\x3d"btnAction" data-dojo-attach-event\x3d"click:_onBtnMenuClicked,keydown:_onBtnMenuKeydown"\x3e\x3c/div\x3e\r\n  \x3cdiv tabindex\x3d"0" class\x3d"noresult-tip not-visible" data-dojo-attach-point\x3d"noResultTip" data-dojo-attach-event\x3d"keydown:_onNoResultTipKeydown"\x3e${nls.noResult}\x3c/div\x3e\r\n  \x3cdiv class\x3d"content not-visible" data-dojo-attach-point\x3d"content" data-dojo-attach-event\x3d"click:_onContentClicked,keydown:_onContentKeydown"\x3e\x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/query dojo/keys dojo/Evented dojo/_base/html dojo/_base/lang dojo/_base/array dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./RelatedRecordsResult.html esri/dijit/PopupRenderer esri/layers/FeatureLayer esri/renderers/SimpleRenderer jimu/utils jimu/symbolUtils jimu/BaseFeatureAction jimu/dijit/Popup jimu/dijit/FeatureActionPopupMenu jimu/dijit/SymbolChooser jimu/FeatureActionManager".split(" "),function(n,h,t,d,g,l,u,v,w,x,y,z,q,r,m,
p,A,B,C,D,E){return u([v,w,x,t],{baseClass:"related-records-result",templateString:y,popupMenu:null,featureActionManager:null,featureSet:null,layer:null,map:null,layerDefinition:null,nls:null,config:null,postCreate:function(){this.inherited(arguments);this.popupMenu=C.getInstance();this.featureActionManager=E.getInstance();this.btnAction.title=window.jimuNls.featureActions.featureActions;if("Table"!==this.layerDefinition.type){this.layer=new q({layerDefinition:{type:this.layerDefinition.type,geometryType:this.layerDefinition.geometryType,
fields:this.layerDefinition.fields,typeIdField:this.layerDefinition.typeIdField,types:this.layerDefinition.types}});var a=m.getTypeByGeometryType(this.layerDefinition.geometryType),b=null;"point"===a?b=p.getDefaultMarkerSymbol():"polyline"===a?b=p.getDefaultLineSymbol():"polygon"===a&&(b=p.getDefaultFillSymbol());b&&(a=new r(b),this.layer.setRenderer(a));this.map.addLayer(this.layer)}else this.layer=new q({layerDefinition:{type:this.layerDefinition.type,fields:this.layerDefinition.fields,typeIdField:this.layerDefinition.typeIdField,
types:this.layerDefinition.types}})},destroy:function(){this.layer&&this.map.removeLayer(this.layer);this.layer=null;this.inherited(arguments)},setResult:function(a,b){this.layer&&this.layer.clear();this.featureSet=b;if(0<b.features.length){l.forEach(b.features,g.hitch(this,function(e,f){this.layer&&this.layer.add(e);this._createItem(a,e,f)}));var c=n(".item-title",this.content);this.lastFocusItem=c[c.length-1];d.removeClass(this.btnAction,"not-visible");d.addClass(this.noResultTip,"not-visible");
d.removeClass(this.content,"not-visible");b.geometryType&&m.zoomToFeatureSet(this.map,b)}else d.addClass(this.btnAction,"not-visible"),d.removeClass(this.noResultTip,"not-visible"),d.addClass(this.content,"not-visible"),this.lastFocusItem=this.noResultTip},_onNoResultTipKeydown:function(a){a.keyCode!==h.TAB||a.shiftKey||(a.preventDefault(),this.emit("focus-result-header"))},getLayer:function(){return this.layer},showLayer:function(){this.layer&&this.layer.show()},hideLayer:function(){this.layer&&
this.layer.hide()},_createItem:function(a,b,c){var e=a.getTitle(b)||"",f="";c===this.featureSet.features.length-1&&(f='data-isLastItem\x3d"true"');c=d.toDom('\x3cdiv class\x3d"item"\x3e\x3cdiv class\x3d"item-title" '+f+' role\x3d"button" tabindex\x3d"0"\x3e'+e+'\x3c/div\x3e\x3cdiv class\x3d"item-content" '+f+' tabindex\x3d"0"\x3e\x3c/div\x3e\x3c/div\x3e');e=n(".item-content",c)[0];a=new z({template:a,graphic:b,chartTheme:a.chartTheme});d.place(a.domNode,e);a.startup();d.place(c,this.content)},_onContentClicked:function(a){a=
a.target||a.srcElement;var b=null;if(b=d.hasClass(a,"item-title")?a:m.getAncestorDom(a,function(f){return d.hasClass(f,"item-title")},this.content)){var c=b.parentNode;d.toggleClass(c,"selected");var e=d.hasClass(c,"selected");n(".item",this.content).removeClass("selected");e&&d.addClass(c,"selected");"true"===d.getAttr(a,"data-isLastItem")&&(this.lastFocusItem=e?b.nextElementSibling:b)}},_onContentKeydown:function(a){if(a.keyCode===h.ENTER||a.keyCode===h.SPACE)this._onContentClicked(a);else if(a.keyCode===
h.TAB&&!a.shiftKey&&"true"===d.getAttr(a.target,"data-isLastItem")){var b=d.hasClass(a.target.parentNode,"selected");if(!b||b&&d.hasClass(a.target,"item-content"))a.preventDefault(),this.emit("focus-result-header")}},_onBtnBackClicked:function(){this.emit("back")},_onBtnMenuClicked:function(a){if(this.featureSet){var b=d.position(a.target||a.srcElement);this.featureActionManager.getSupportedActions(this.featureSet).then(g.hitch(this,function(c){l.forEach(c,g.hitch(this,function(k){k.data=this.featureSet}));
if(!this.config.enableExport){var e=["ExportToCSV","ExportToFeatureCollection","ExportToGeoJSON","SaveToMyContent"];c=l.filter(c,g.hitch(this,function(k){return 0>e.indexOf(k.name)}))}c=l.filter(c,g.hitch(this,function(k){return"CreateLayer"!==k.name}));var f=this._getSymbolAction();f&&c.push(f);this.popupMenu.setActions(c);this.popupMenu._setFocusedNodeBeforeOpen();this.popupMenu.show(b)}))}},_onBtnMenuKeydown:function(a){a.keyCode!==h.ENTER&&a.keyCode!==h.SPACE||this._onBtnMenuClicked(a)},_getSymbolAction:function(){var a=
null;"Table"!==this.layerDefinition.type&&this.layer&&this.layer.renderer&&this.config.canModifySymbol&&((a=this.featureSet&&this.featureSet.features)||(a=[]),a=new A({name:"ChangeSymbol",label:this.nls.changeSymbol,data:a,iconClass:"icon-edit-symbol",iconFormat:"svg",map:this.map,onExecute:g.hitch(this,this._showSymbolChooser)}));return a},_showSymbolChooser:function(){if(this.layer){var a=this.layer.renderer,b={};(a=a.defaultSymbol||a.symbol)?b.symbol=a:(a=m.getSymbolTypeByGeometryType(this.layer.geometryType),
b.type=a);var c=new D(b),e=new B({width:380,autoHeight:!0,titleLabel:this.nls.changeSymbol,content:c,onClose:g.hitch(this,function(){c.destroy();e=c=null}),buttons:[{label:window.jimuNls.common.ok,onClick:g.hitch(this,function(){var f=c.getSymbol();f=new r(f);this.layer.setRenderer(f);this.layer.redraw();e.close()})},{label:window.jimuNls.common.cancel,onClick:g.hitch(this,function(){e.close()})}]})}}})});