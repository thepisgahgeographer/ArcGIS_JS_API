// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/RelatedTableCharts/ChartLayout.html":'\x3cdiv\x3e\r\n    \x3cdiv class\x3d"esriCTLayoutContent" tabindex\x3d"0" aria-labelledby\x3d"${id}title ${id}description"\x3e\r\n        \x3cdiv class\x3d"esriCTLabels"\x3e\r\n            \x3c!-- chart title --\x3e\r\n            \x3cdiv class\x3d"esriCTLayoutHeaderTitle" data-dojo-attach-point\x3d"layoutHeaderTitle" id\x3d"${id}title"\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTChartContainer" data-dojo-attach-point\x3d"chartContainer"\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTLegendContainer" data-dojo-attach-point\x3d"legendContainer"\x3e\r\n            \x3cdiv class\x3d"esriCTLegendNode" data-dojo-attach-point\x3d"legendNode"\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c!-- chart description --\x3e\r\n        \x3cdiv class\x3d"esriCTChartDescription" data-dojo-attach-point\x3d"chartDescription" id\x3d"${id}description"\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("jimu/BaseWidgetSetting jimu/utils dojo/dom-attr dojo/dom-construct dojo/dom-style dojo/_base/declare dojo/_base/lang dijit/_WidgetsInTemplateMixin dojo/text!./ChartLayout.html dojox/charting/Chart dojox/charting/plot2d/Pie dojox/charting/action2d/Tooltip dojox/charting/action2d/Highlight dojox/charting/action2d/MoveSlice dojox/charting/plot2d/Spider dojox/charting/widget/SelectableLegend dojox/charting/action2d/Magnify dojo/_base/array dojox/charting/Theme dojo/Evented dojox/charting/plot2d/Bars dojox/charting/axis2d/Default dojox/charting/plot2d/Lines".split(" "),
function(y,z,w,k,h,A,l,B,C,q,D,r,t,E,F,G,x,u,v,H){return A([y,B,H],{baseClass:"jimu-widget-RelatedTableCharts-layout",templateString:C,postCreate:function(){this.inherited(arguments)},startup:function(){this._createChartLayout()},_createChartLayout:function(){this._setNodeValue(this.layoutHeaderTitle,this.config.chartConfig.chartTitle,!0);this._setNodeValue(this.chartDescription,this.config.chartConfig.description,!1);this._initChart()},resizeChart:function(a){this.chart&&setTimeout(l.hitch(this,
function(){"PieChart"!==this.config.chartConfig.chartType?this.chart.resize():this._initChart();this.onChartResize()}),a)},_setNodeValue:function(a,b,d){var c=b;this.config.isPreview||(c=this._getFieldValues(b,this.config.selectedFeature.attributes));c?(c=z.sanitizeHTML(c),w.set(a,"innerHTML",c),d&&w.set(a,"title",c)):h.set(a,"display","none")},_initChart:function(){switch(this.config.chartConfig.chartType){case "BarChart":this._createBarChart();break;case "PieChart":this._createPieChart();break;
case "PolarChart":this._createPolarChart();break;case "LineChart":this._createLineChart();break;default:w.set(this.chartContainer,"innerHTML",this.nls.errMsgNoFeaturesFound)}},_getBarChartContainerHeight:function(){var a=30;0<this.config.chartData.chartSeries.length&&(a=30*this.config.chartData.chartSeries.length);this.config.isPreview?150>=a&&(a+=150):150>=a&&(a+=100);return a+"px"},_createBarChart:function(){var a={},b={};a=40;var d={};k.empty(this.chartContainer);a=this._getBarChartContainerHeight();
var c=new q(k.create("div",{style:"overflow:hidden; width:100%; height:"+a},this.chartContainer));c.addPlot("default",{type:"Bars",gap:4,minBarSize:10,maxBarSize:15});b=h.get(this.chartDescription,"fontFamily");var e=h.get(this.chartDescription,"fontSize");var f=h.get(this.chartDescription,"color");a={labels:this.config.chartData.chartLabels,maxLabelCharCount:35,trailingSymbol:"...",natural:!0,majorTickStep:1,minorTicks:!1,fixUpper:!0,includeZero:!1,vertical:!0,titleFontColor:f,titleFont:"normal normal normal "+
e+" "+b,font:"normal normal normal 9px "+b};window.isRTL&&(a.leftBottom=!1,c.setDir("rtl"));b={fixLower:"major",fixUpper:"major",minorTicks:!1,includeZero:!0,titleFontColor:f,titleFont:"normal normal normal "+e+" "+b,font:"normal normal normal 9px "+b};this.config.isPreview?(b.titleGap=5,a.majorTick={length:0},b.majorTick={length:0},a.majorLabels=!1,b.majorLabels=!1,a.minorLabels=!1,b.minorLabels=!1,a.title=this.config.chartConfig.labelYAxis,b.title=this.config.chartConfig.labelXAxis,d.stroke={width:0}):
(new r(c,"default"),a.title=this._getFieldValues(this.config.chartConfig.labelYAxis,this.config.selectedFeature.attributes),b.title=this._getFieldValues(this.config.chartConfig.labelXAxis,this.config.selectedFeature.attributes),d.stroke={width:1});b.titleOrientation="away";c.addAxis("y",a);c.addAxis("x",b);this.config.chartData.selectedTheme&&c.setTheme(this.config.chartData.selectedTheme);this.config.chartData.fill&&(d.fill=this.config.chartData.fill);u.forEach(this.config.chartData.chartSeries,
function(g,n){g.x=n+1;g.y=g.y;c.addSeries(n+1,[g],d,{plot:"default"})},this);new t(c,"default");c.render();this.chart=c;this.onChartCreated()},_createLineChart:function(){var a={};a.marker=v.defaultMarkers.CIRCLE;a.markerStroke={width:1};k.empty(this.chartContainer);var b=new q(k.create("div",{style:"overflow:hidden; width:100%; height:"+(this.config.isPreview?"300px":"270px")},this.chartContainer));var d=h.get(this.chartDescription,"fontFamily");var c=h.get(this.chartDescription,"fontSize");var e=
h.get(this.chartDescription,"color");var f={maxLabelCharCount:30,trailingSymbol:"...",natural:!0,vertical:!0,titleGap:0,titleFontColor:e,titleFont:"normal normal normal "+c+" "+d,max:this._calculateMajorTickStep(!0,!0),majorLabels:!0,minorTicks:!0,minorLabels:!0,microTicks:!1,fixLower:"major",fixUpper:"major",majorTickStep:this._calculateMajorTickStep(!0,!1)};this._setLineChartYaxisMin(f);this.config.isPreview||(f.font="normal normal bold 9px "+d);window.isRTL&&(f.leftBottom=!1,b.setDir("rtl"));d=
{labels:this.config.chartData.chartLabels[0],maxLabelCharCount:35,trailingSymbol:"...",titleGap:0,titleFontColor:e,titleFont:"normal normal normal "+c+" "+d,font:"normal normal bold "+this._calculateXAxisLabelFontSize(this.config.chartData.chartLabels[0].length)+"px "+d,titleOrientation:"away",rotation:-90,minorLabels:!0,majorLabels:!0,minorTicks:!0,microTicks:!1,max:this.config.chartData.chartLabels[0].length+.5,min:.5};this.config.isPreview?(f.minorLabels=!1,f.majorLabels=!0,f.title=this.config.chartConfig.labelYAxis,
d.minorLabels=!0,d.majorLabels=!0,d.title=this.config.chartConfig.labelXAxis,d.max=11):(f.title=this._getFieldValues(this.config.chartConfig.labelYAxis,this.config.selectedFeature.attributes),d.title=this._getFieldValues(this.config.chartConfig.labelXAxis,this.config.selectedFeature.attributes));a.stroke={width:1};b.addPlot("default",{type:"Lines",markers:!0,styleFunc:l.hitch(this,function(m){return this.config.chartConfig.chartColor&&"ColorByFieldValue"===this.config.chartConfig.chartColor.colorType?
(m=this.config.chartConfig.chartColor.colorInfo.layerFieldValues[m])?{fill:m}:{fill:"#000000"}:this.config.isPreview?{fill:"#0000ff"}:{fill:"#000000"}})});b.addAxis("y",f);b.addAxis("x",d);this.config.chartData.selectedTheme&&b.setTheme(this.config.chartData.selectedTheme);this.config.chartData.fill&&(a.stroke.color=this.config.chartData.fill);var g=Object.keys(v.defaultMarkers);g[3]&&g[5]&&this.swap(g,3,5);g[4]&&g[6]&&this.swap(g,4,6);var n=g.length;u.forEach(this.config.chartData.chartSeries,l.hitch(this,
function(m,p){var I=m[0]&&m[0].seriesName?m[0].seriesName:this.nls.ChartSetting.layoutSeriesLabel+" "+p;if(this.config.chartConfig.chartColor&&"ColorByFieldValue"===this.config.chartConfig.chartColor.colorType||this.config.isPreview)a.stroke.color="#"+Math.floor(16777215*Math.random()).toString(16);this.config.chartData.fill&&(p<n?a.marker=v.defaultMarkers[g[p]]:(p%=n,a.marker=v.defaultMarkers[g[p]]));b.addSeries(I,m,l.clone(a))}));new r(b,"default");new t(b,"default");new x(b,"default");b.render();
this.chart=b;h.set(this.legendContainer,"display","block");1<this.config.chartData.chartSeries.length&&this._createChartLegend(b,!0);this.onChartCreated()},swap:function(a,b,d){var c=a[b];a[b]=a[d];a[d]=c},_calculateXAxisLabelFontSize:function(a){switch(!0){case 20>a:return 9;case 20<=a:return 9;default:return 9}},_calculateMajorTickStep:function(a,b){var d=[];a&&this.config.chartData.chartSeries.forEach(l.hitch(this,function(c){c.forEach(l.hitch(this,function(e){b?d.push(e.y):d.push(Math.abs(e.y))}))}));
if(0<d.length){a=Math.max.apply(null,d);if(b)return a+1;a/=20;a=Math.round(a)?Math.round(a):a}else a=null;return Math.abs(a)},_createPieChart:function(){var a={};k.empty(this.chartContainer);var b=k.create("div",{style:"width:100%; height:100%; overflow:auto"},this.chartContainer);b=new q(b);a={type:D,labels:!0,ticks:!0,fixed:!0,precision:0,labelWiring:"#ccc",labelStyle:"columns",htmlLabels:!0,startAngle:-10,maxLabelCharCount:20,trailingSymbol:"..."};"esriCTEmptyOption"===this.config.chartConfig.labelField&&
(a.labels=!1);b.addPlot("default",a);this.config.isPreview||new r(b,"default");this.config.chartData.fill?b.addSeries(this.config.chartConfig.dataSeriesField,this.config.chartData.chartSeries,{fill:this.config.chartData.fill},{plot:"default"}):b.addSeries(this.config.dataSeriesField,this.config.chartData.chartSeries,{plot:"default"});this.config.chartData.selectedTheme&&b.setTheme(this.config.chartData.selectedTheme);new E(b,"default");new t(b,"default");b.render();this.chart=b;this.onChartCreated()},
_createPolarChart:function(){var a,b=.2,d=!1;this.chart&&this.chart.destroy();k.empty(this.chartContainer);h.set(this.chartContainer,"direction","inherit");var c=k.create("div",{style:"width:100%; height:100%; overflow:hidden"},this.chartContainer);var e=h.get(this.chartDescription,"fontFamily");c=new q(c);this.config.chartConfig.showPolygonFill||(b=0);c.addPlot("default",{type:F,labelOffset:-10,divisions:5,seriesFillAlpha:b,markerSize:3,precision:0,spiderType:"polygon",axisFont:"normal normal normal 9px/25px "+
e});this.config.chartData.selectedTheme?c.setTheme(this.config.chartData.selectedTheme):this.config.chartConfig.chartColor.colorInfo&&this.config.chartConfig.chartColor.colorInfo.layerField&&(d=!0);for(b=0;b<this.config.chartData.chartSeries.length;b++)for(a in e=this.config.chartData.chartSeries[b],e)e.hasOwnProperty(a)&&(this.config.chartData.fill?c.addSeries(a,e[a],{fill:this.config.chartData.fill}):e[a].fill?c.addSeries(a,e[a],{fill:e[a].fill,legend:e[a].legendLabel}):c.addSeries(a,e[a]));this.config.isPreview||
new r(c,"default");new t(c,"default");new x(c,"default",{duration:800,scale:1.5});c.render();this.chart=c;!this.config.isPreview&&d&&(h.set(this.legendContainer,"display","block"),this._createChartLegend(c,!0));this.onChartCreated()},_createChartLegend:function(a,b){setTimeout(l.hitch(this,function(){this.legend&&(this.legend.destroy(),this.legend=null);k.empty(this.legendNode);this.legend=new G({chart:a,horizontal:b},k.create("div",{},this.legendNode));this.emit("setFocusNodes")}),1500)},onChartCreated:function(){},
onChartResize:function(){},_getFieldValues:function(a,b){var d="",c,e;a=a.replace(/(\n|\r|\r\n)/g,"\x3cbr\x3e");var f=a.split("{");for(c=0;c<f.length;c++)if(0===c)d+=f[c];else if(-1!==f[c].indexOf("}"))for(a=f[c].split("}"),e=0;e<a.length;e++)if(0===e){if(b[a[e]]||0===b[a[e]])d+=b[a[e]]}else d=1===e?d+a[e]:d+("}"+a[e]);else d+="{";return d},_setLineChartYaxisMin:function(a){var b=[];var d=[];u.forEach(this.config.chartData.chartSeries,l.hitch(this,function(e){u.forEach(e,l.hitch(this,function(f){0<=
f.y&&b.push(f.y);d.push(f.y)}))}));if(b.length===d.length)a.min=0;else{var c=Math.min.apply(null,d);a.min=c-1}}})});