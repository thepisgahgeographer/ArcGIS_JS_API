// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/Screening/coordinates/coordinates.html":'\x3cdiv\x3e\r\n  \x3c!--Coordinates parent container--\x3e\r\n  \x3cdiv class\x3d"esriCTCoordinatesParentDiv"\x3e\r\n    \x3c!--Select start point from Search dijit div--\x3e\r\n    \x3cdiv class\x3d"esriCTSelectStartPointFromSearchDiv" data-dojo-attach-point\x3d"selectStartPointFromSearchDiv"\x3e\r\n      \x3cdiv class\x3d"esriCTSearchOuterContainer"\x3e\r\n        \x3cdiv tabindex\x3d"0" role\x3d"presentation" aria-label\x3d" ${nls.coordinatesWidget.selectStartPointFromSearchText}"\r\n          class\x3d"esriCTSearchHeader" data-dojo-attach-point\x3d"coordinatesHeader"\x3e\r\n          ${nls.coordinatesWidget.selectStartPointFromSearchText}\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTSearchContainer"\x3e\r\n          \x3cdiv class\x3d"esriCTSearchDiv"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"searchWidgetContainerCoordinatesTab"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n          \x3c!--Locate icon for start point node--\x3e\r\n          \x3cdiv class\x3d"esriCTLocateImageNode" title\x3d"${nls.coordinatesWidget.locateByMapClickText}"\r\n            data-dojo-attach-point\x3d"locateStartPointIcon" role\x3d"button" tabindex\x3d"0"\r\n            aria-label\x3d"${nls.coordinatesWidget.locateByMapClickText}"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3c!--Select start point from latitude and longitude div--\x3e\r\n      \x3cdiv class\x3d"esriCTLatLongInputLabelParentContainer"\x3e\r\n        \x3cdiv class\x3d"esriCTLatLongInputLabelChildContainer"\x3e\r\n          \x3cdiv class\x3d"esriCTLatitudeLabel" data-a11y-label-id\x3d"${id}latitude"\x3e\r\n            ${nls.common.latitude}\r\n          \x3c/div\x3e\r\n          \x3cdiv class\x3d"esriCTLongitudeLabel" data-a11y-label-id\x3d"${id}longitude"\x3e\r\n            ${nls.common.longitude}\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv\x3e\r\n          \x3c!--Latitude textbox--\x3e\r\n          \x3cinput class\x3d"esriCTLatTextBox" data-dojo-type\x3d"dijit/form/NumberTextBox"\r\n            data-dojo-attach-point\x3d\'latitudeTextBox\' placeholder\x3d"${nls.common.latitude}" required role\x3d"textbox"\r\n            aria-required\x3d"true" data-a11y-label-by\x3d"${id}latitude" /\x3e\r\n          \x3c!--Longitude textbox--\x3e\r\n          \x3cinput class\x3d"esriCTLongTextBox" data-dojo-type\x3d"dijit/form/NumberTextBox"\r\n            data-dojo-attach-point\x3d\'longitudeTextBox\' placeholder\x3d"${nls.common.longitude}" required role\x3d"textbox"\r\n            aria-required\x3d"true" data-a11y-label-by\x3d"${id}longitude" /\x3e\r\n          \x3c!--Locate for lat long text--\x3e\r\n          \x3cdiv class\x3d"esriCTLocateForLatLongText" title\x3d"${nls.coordinatesWidget.locateText}"\r\n            data-dojo-attach-point\x3d"locateLatAndLong" role\x3d"button" tabindex\x3d"0"\r\n            aria-label\x3d"${nls.coordinatesWidget.locateText}"\x3e\r\n            ${nls.coordinatesWidget.locateText}\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3c!-- Traverse grid container--\x3e\r\n      \x3cdiv class\x3d"esriCTNewTraverseContainer" data-dojo-attach-point\x3d"traverseGridMainContainer"\x3e\r\n        \x3cdiv class\x3d"esriCTBearingDistanceParentDiv"\x3e\r\n          \x3c!--Enter bearing and distance label parent div--\x3e\r\n          \x3cdiv tabindex\x3d"0" role\x3d"presentation" data-dojo-attach-point\x3d"startPointSection"\r\n          class\x3d"esriCTEnterBearingAndDistanceLabelDiv"\x3e\r\n            ${nls.coordinatesWidget.enterBearingAndDistanceLabel}\r\n          \x3c/div\x3e\r\n          \x3cdiv class\x3d"esriCTPlanSettingsIcon" data-dojo-attach-point\x3d"planSettingIcon"\r\n            title\x3d"${nls.coordinatesWidget.planSettingTooltip}" role\x3d"button" tabindex\x3d"0"\r\n            aria-label\x3d"${nls.coordinatesWidget.planSettingTooltip}"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c!-- Traverse grid title--\x3e\r\n        \x3cdiv class\x3d"esriCTNewTraverseLabelDiv"\x3e\r\n          \x3cdiv class\x3d"esriCTGridLabels esriCTEllipsis" title\x3d"${nls.traverseSettings.bearingLabel}"\x3e\r\n            ${nls.traverseSettings.bearingLabel}\r\n          \x3c/div\x3e\r\n          \x3cdiv class\x3d"esriCTGridLabels esriCTEllipsis" title\x3d"${nls.traverseSettings.lengthLabel}"\x3e\r\n            ${nls.traverseSettings.lengthLabel}\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c!-- Traverse grid items--\x3e\r\n        \x3cdiv class\x3d"esriCTTraverseGrid" data-dojo-attach-point\x3d"traverseGrid"\x3e\r\n        \x3c/div\x3e\r\n        \x3c!-- Traverse grid initial entry row--\x3e\r\n        \x3cdiv class\x3d"esriCTEntryNodeContent esriCTRow" data-dojo-attach-point\x3d"traverseEntryNode"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"bearingNode" data-dojo-type\x3d"dijit/form/ValidationTextBox" required\r\n            role\x3d"textbox" aria-label\x3d"${nls.traverseSettings.bearingLabel}"\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"lengthNode" data-dojo-type\x3d"dijit/form/ValidationTextBox" required role\x3d"textbox"\r\n            aria-label\x3d"${nls.traverseSettings.lengthLabel}"\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv class\x3d"esriCTAddRow"\x3e\r\n            \x3cdiv class\x3d"esriCTAddDisabledIcon" data-dojo-attach-point\x3d"addButton" tabindex\x3d"-1" role\x3d"button"\r\n              title\x3d"${nls.traverseSettings.addButtonTitle}" aria-label\x3d"${nls.traverseSettings.addButtonLabel}"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c!-- Traverse grid tools container--\x3e\r\n        \x3cdiv class\x3d"esriCTTraverseTool"\x3e\r\n          \x3cdiv class\x3d"esriCTTraverseToolContainer"\x3e\r\n            \x3c!-- Expand/Collapse grid tool--\x3e\r\n            \x3cdiv class\x3d"esriCTHidden  esriCTTraverseToolIcons esriCTCollapse esriCTCursorPointer"\r\n              title\x3d"${nls.planSettings.collapseGridTooltipText}" data-dojo-attach-point\x3d"expandCollapseNode"\r\n              role\x3d"button" tabindex\x3d"-1" aria-label\x3d"${nls.planSettings.collapseGridTooltipText}" aria-expanded\x3d"true"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e'}});
define("dojo/_base/declare dojo/text!./coordinates.html dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/on dojo/dom-class dojo/Evented jimu/BaseWidget esri/graphic esri/symbols/jsonUtils esri/SpatialReference esri/geometry/Point esri/graphicsUtils ../search ../geometryUtils ../MapTooltipHandler dijit/focus ../conversionUtils dojo/dom-construct dijit/form/ValidationTextBox dojo/dom-attr dojo/keys dojo/dnd/Source dojo/_base/array dojo/query jimu/dijit/Message ../planSettings/planSettings dojo/dom-geometry dojo/_base/event jimu/utils dijit/form/NumberTextBox".split(" "),
function(B,C,D,d,g,m,E,F,w,y,x,G,H,I,u,J,n,q,r,K,l,e,L,z,v,M,N,A,h,O){return B([F,D,E],{baseClass:"jimu-widget-screening-coordinates",templateString:C,_itemList:[],_nodes:[],_mapTooltipHandler:null,_dndContainer:null,_latLongValue:{latitude:"",longitude:""},_windowResizeTimer:null,startPoint:null,startPointForNextLine:null,planSettingsWidget:null,_configuredDirectionUnit:null,_configuredDistanceUnit:null,_hasMultipleSourcesInSearch:!0,_buttonNodeEventHandler:null,_inputNodeEventHandler:null,_submitNodeEventHandler:null,
_clearNodeEventHandler:null,constructor:function(a){this._itemList=[];this._nodes=[];this._dndContainer=this._mapTooltipHandler=null;this._latLongValue={latitude:"",longitude:""};this._configuredDistanceUnit=this._configuredDirectionUnit=this.planSettingsWidget=this.startPointForNextLine=this.startPoint=this._windowResizeTimer=null;this._hasMultipleSourcesInSearch=!0;this._clearNodeEventHandler=this._submitNodeEventHandler=this._inputNodeEventHandler=this._buttonNodeEventHandler=null;d.mixin(this,
a)},postMixInProperties:function(){this.inherited(arguments);this.isRenderIdForAttrs=!0},postCreate:function(){this._initializeCoordinatesWidget();this._createSearchInstance();this._attachKeydownEventToTheNodes()},_createSearchInstance:function(){this._searchInstance=new I({searchOptions:{addLayersFromMap:!1,autoNavigate:!1,autoComplete:!0,minCharacters:0,maxLocations:5,searchDelay:100,enableHighlight:!1},config:this.config,appConfig:this.appConfig,nls:this.nls,map:this.map},r.create("div",{},this.searchWidgetContainerCoordinatesTab));
this.own(this._searchInstance.on("select-result",d.hitch(this,function(a){this.emit("onSearchComplete",a)})));this.own(this._searchInstance.on("clear-search",d.hitch(this,this._clearResults)));this.own(this._searchInstance.on("search-loaded",d.hitch(this,function(){setTimeout(d.hitch(this,function(){this._searchContainerNodeElement=v(".arcgisSearch .searchGroup .searchInput",this.domNode)[0];2>this._searchInstance.search.sources.length&&(this._hasMultipleSourcesInSearch=!1);this.onWindowResize()}),
1E3)})));this._searchInstance.startup()},_clearResults:function(a){a||this.map.infoWindow.hide()},clearSearchText:function(){this._searchInstance&&this._searchInstance.search&&this._searchInstance.search.clear()},onWindowResize:function(){this._windowResizeTimer&&clearTimeout(this._windowResizeTimer);this._windowResizeTimer=setTimeout(d.hitch(this,this._resetComponents),500)},_resetComponents:function(){var a;var b=v(".arcgisSearch .searchGroup",this.domNode)[0];this._searchContainerNodeElement||
(this._searchContainerNodeElement=v(".arcgisSearch .searchGroup .searchInput",this.domNode)[0]);this.widgetMainContainer&&this._searchContainerNodeElement&&(a=A.position(this.widgetMainContainer))&&a.w&&(a=a.w-175,this._hasMultipleSourcesInSearch||(a+=32),0<a&&(this._searchContainerNodeElement.style.setProperty("width",a-45+"px","important"),b&&b.style.setProperty("max-width","100%","important")));this._attachSearchNodeEvents()},_initializeCoordinatesWidget:function(){this._configuredDirectionUnit=
d.clone(this.config.traverseDirectionUnit);this._configuredDistanceUnit=d.clone(this.config.traverseUnit);this._nodes=[];this._itemList=[];this._initializeMapTooltipHandler();this._setLatLongInputTextBoxesConstraints();this._createPlanSettings();this.updateAccordingToPlanSettings(this._planSettings);this._attachLatLongTextBoxEvents();this._attachLocateStartPointEvents();this._attachPlanSettingsIconClickEvent();this._setValidatorForInitialRow();this._handleEventsOnInitialRow();this._attachTraverseGridEvents();
this._createTraverseGrid();this._enableOrDisableTraverseGrid(!1)},_createPlanSettings:function(){this._planSettings={};this._planSettings.directionOrAngleType="northAzimuth";this._planSettings.directionOrAngleUnits=this.config.traverseDirectionUnit;this._planSettings.distanceAndLengthUnits=this.config.traverseUnit},updateAccordingToPlanSettings:function(a){this.bearingNode.set("placeHolder",this.nls.units[a.directionOrAngleUnits+"Abbr"]);this.lengthNode.set("placeHolder",this.nls.units[a.distanceAndLengthUnits+
"Abbr"])},_initializeMapTooltipHandler:function(){this._mapTooltipHandler=new J({map:this.map});this._mapTooltipHandler.startup();this.own(g(this._mapTooltipHandler,"clicked",d.hitch(this,function(a){m.contains(this.locateStartPointIcon,"esriCTLocateIconSelected")&&(this.onStartPointSelected(a.mapPoint),this.deactivateLocateIcon())})))},_setLatLongInputTextBoxesConstraints:function(){this.latitudeTextBox.set("constraints",{min:-90,max:90,places:8});this.latitudeTextBox.set("trim",!0);this.longitudeTextBox.set("constraints",
{min:-180,max:180,places:8});this.longitudeTextBox.set("trim",!0)},onStartPointSelected:function(a){this.drawnOrSelectedGraphicsLayer.clear();this.uploadedShapefileGraphicsLayer.clear();var b=new x(4326);u.getProjectedGeometry(a,b,this.geometryService).then(d.hitch(this,function(c){this.setStartPoint(a);this._enableOrDisableTraverseGrid(!0);this.setLatLongTextBoxValue(c.x,c.y)}))},_activateLocateIcon:function(){this.startPointForNextLine?this._mapTooltipHandler.connectEventHandler(this.nls.coordinatesWidget.mapTooltipForUpdateStartPoint):
this._mapTooltipHandler.connectEventHandler(this.nls.coordinatesWidget.mapTooltipForStartPoint);m.add(this.locateStartPointIcon,"esriCTLocateIconSelected")},deactivateLocateIcon:function(){m.contains(this.locateStartPointIcon,"esriCTLocateIconSelected")&&(m.remove(this.locateStartPointIcon,"esriCTLocateIconSelected"),this._mapTooltipHandler.disconnectEventHandler())},setLatLongTextBoxValue:function(a,b){this._latLongValue.latitude=b;this._latLongValue.longitude=a;this.latitudeTextBox.set("value",
b);this.longitudeTextBox.set("value",a)},_attachLocateStartPointEvents:function(){this.own(g(this.locateStartPointIcon,"click",d.hitch(this,function(a){h.stop(a);m.contains(this.locateStartPointIcon,"esriCTLocateIconSelected")?this.deactivateLocateIcon():this._activateLocateIcon()})));this.own(g(this.locateLatAndLong,"click",d.hitch(this,function(a){h.stop(a);this.latitudeTextBox.isValid()&&this.longitudeTextBox.isValid()?this._onLocateLatLongClicked():this._showMessage(this.nls.coordinatesWidget.invalidLatLongMessage)})))},
_onLocateLatLongClicked:function(){if(this.latitudeTextBox.isValid()&&this.longitudeTextBox.isValid()){this._latLongValue.latitude=this.latitudeTextBox.getValue();this._latLongValue.longitude=this.longitudeTextBox.getValue();var a=new x(4326);a=new G(this._latLongValue.longitude,this._latLongValue.latitude,a);u.getProjectedGeometry(a,this.map.spatialReference,this.geometryService).then(d.hitch(this,function(b){this.setStartPoint(b);this._enableOrDisableTraverseGrid(!0);this._locateStartPoint(b)}))}},
_locateStartPoint:function(a){this.map.centerAt(a)},_enableOrDisableTraverseGrid:function(a){a?(this.bearingNode.set("disabled",!1),this.lengthNode.set("disabled",!1),m.replace(this.addButton,"esriCTAddIcon","esriCTAddDisabledIcon"),l.set(this.bearingNode,"tabindex","0"),l.set(this.lengthNode,"tabindex","0"),l.set(this.addButton,"tabindex","0")):(this.bearingNode.set("disabled",!0),this.lengthNode.set("disabled",!0),m.replace(this.addButton,"esriCTAddDisabledIcon","esriCTAddIcon"),l.set(this.bearingNode,
"tabindex","-1"),l.set(this.lengthNode,"tabindex","-1"),l.set(this.addButton,"tabindex","-1"))},_attachTraverseGridEvents:function(){this.own(g(this.addButton,"click",d.hitch(this,function(a){h.stop(a);m.contains(this.addButton,"esriCTAddIcon")&&this._addNewItem()})));this.own(g(this.addButton,"keydown",d.hitch(this,function(a){if(a.keyCode===e.ENTER||a.keyCode===e.SPACE)h.stop(a),m.contains(this.addButton,"esriCTAddIcon")&&this._addNewItem();a.keyCode!==e.ESCAPE||this.isSingleTabSelected||(h.stop(a),
this.emit("focusLastSelectedTab"))})));this.own(g(this.expandCollapseNode,"click",d.hitch(this,function(a){h.stop(a);this._onExpandCollapseClicked()})));this.own(g(this.expandCollapseNode,"keydown",d.hitch(this,function(a){if(a.keyCode===e.ENTER||a.keyCode===e.SPACE)h.stop(a),this._onExpandCollapseClicked();a.keyCode!==e.ESCAPE||this.isSingleTabSelected||(h.stop(a),this.emit("focusLastSelectedTab"))})))},_addNewItem:function(){var a;(a=this._getValidatedValues())?(this._itemList.push(a),this._createRow(a,
this._itemList.length-1),this._resetEntryRow(),this._drawStraightLine(a,!0),this._showHideTraverseTools()):this.bearingNode.isValid()?""!==this.lengthNode.get("value")&&this.lengthNode.isValid()||(n.focus(this.lengthNode),this.lengthNode.validate(!1)):(n.focus(this.bearingNode),this.bearingNode.validate(!1))},_validateBearing:function(a){return(a=q.categorizeBearingFormat(a,this._planSettings))?a:null},_getValidatedValues:function(a,b){var c={};a?(c=a,b&&("Bearing"!==b&&c.BearingConversions&&(c.Bearing=
this._getBearingAccordingToPlanSettings(c.BearingConversions)),"Length"!==b&&c.LengthConversions&&(c.Length=c.LengthConversions[this._planSettings.distanceAndLengthUnits]))):(c.Bearing=this.bearingNode.get("value"),c.Length=this.lengthNode.get("value"));if(""!==d.trim(c.Bearing.toString())&&""!==d.trim(c.Length.toString())&&(a=this._validateBearing(c.Bearing))){c.BearingConversions=a;if(""===d.trim(c.Length.toString()))return null;if(""!==d.trim(c.Length.toString()))if((a=this._validateLength(c.Length))&&
0!==a.meters){if(0>parseInt(a.meters,10))return null;c.LengthConversions=a}else return null}else return null;return c},_validateLength:function(a,b){switch(b){case "feets":a=q.categorizeLengthFormatForFeet(a);break;case "meters":a=q.categorizeLengthFormat(a,"meters");break;case "uSSurveyFeet":a=q.categorizeLengthFormat(a,"uSSurveyFeet");break;default:a=q.categorizeLengthFormat(a,this._planSettings.distanceAndLengthUnits)}return a?a:null},_createRow:function(a,b){var c=r.create("div",{"class":"dojoDndItem esriCTRow",
rowIndex:b});r.create("div",{rowIndex:b},c);var f=this._getBearingAccordingToPlanSettings(a.BearingConversions);this._createFieldInputs(c,f,"esriCTBearingRow");a=this._getRoundedValue(a.LengthConversions,"Length");this._createFieldInputs(c,a,"esriCTLengthRow");this._createDeleteButton(c,b);this._nodes.push(c);this._dndContainer.clearItems();this._dndContainer.insertNodes(!1,this._nodes)},_getBearingAccordingToPlanSettings:function(a,b){if("northAzimuth"===this._planSettings.directionOrAngleType&&
"decimalDegree"===this._planSettings.directionOrAngleUnits)return b?a.naDD:a.naDDRound;if("northAzimuth"===this._planSettings.directionOrAngleType&&"degreeMinuteSeconds"===this._planSettings.directionOrAngleUnits)return a.naDMS;if("southAzimuth"===this._planSettings.directionOrAngleType&&"decimalDegree"===this._planSettings.directionOrAngleUnits)return b?a.saDD:a.saDDRound;if("southAzimuth"===this._planSettings.directionOrAngleType&&"degreeMinuteSeconds"===this._planSettings.directionOrAngleUnits)return a.saDMS;
if("quadrantBearing"===this._planSettings.directionOrAngleType&&"decimalDegree"===this._planSettings.directionOrAngleUnits)return b?a.qb3DD:a.qb3DDRound;if("quadrantBearing"===this._planSettings.directionOrAngleType&&"degreeMinuteSeconds"===this._planSettings.directionOrAngleUnits)return a.qb3DMS},_createFieldInputs:function(a,b,c,f){if("esriCTBearingRow"===c)var p=this.nls.traverseSettings.bearingLabel;else"esriCTLengthRow"===c&&(p=this.nls.traverseSettings.lengthLabel);var k=new K({value:b,"class":c?
c:"",tabindex:0,role:"textbox","aria-label":p});k.placeAt(a);"esriCTBearingRow"===c?(k.validator=d.hitch(this,function(t){return this._bearingValidator(t,[])}),k.invalidMessage=this.nls.newTraverse.invalidBearingMessage):"esriCTLengthRow"===c&&(k.validator=d.hitch(this,this._lengthValidator),k.invalidMessage=this.nls.newTraverse.invalidLengthMessage);this.own(g(k,"blur",d.hitch(this,function(){var t=parseInt(l.get(a,"rowIndex"),10);this._updateParcelValues(k,t,f)})));this.own(g(k,"keypress",d.hitch(this,
function(t){if((t.charCode||t.keyCode)===e.ENTER){var P=parseInt(l.get(a,"rowIndex"),10);this._updateParcelValues(k,P,f)}setTimeout(d.hitch(this,function(){k.validate(!1)}),100);t.keyCode!==e.ESCAPE||this.isSingleTabSelected||(h.stop(t),this.emit("focusLastSelectedTab"))})))},_getRoundedValue:function(a,b){a=a[this._planSettings.distanceAndLengthUnits];switch(b){case "Length":var c=this.lengthFieldPlaces}return q.honourPopupRounding(c,a)},_createDeleteButton:function(a,b){var c=r.create("div",{"class":"esriCTDeleteRow"},
a);b=r.create("div",{"class":"esriCTDeleteIcon",rowIndex:b,title:this.nls.traverseSettings.deleteButtonTitle,tabindex:0,"aria-label":this.nls.traverseSettings.deleteBearingAndLengthLabel,role:"button"},c);this.own(g(b,"click",d.hitch(this,function(f){h.stop(f);f=parseInt(l.get(f.currentTarget,"rowIndex"),10);this._deleteRow(a,f)})));this.own(g(b,"keydown",d.hitch(this,function(f){if(f.keyCode===e.ENTER||f.keyCode===e.SPACE){h.stop(f);this.emit("restrictFocusOnFirstNode");var p=parseInt(l.get(f.currentTarget,
"rowIndex"),10);this._deleteRow(a,p);this._focusOutCurrentNode();n.focus(this.bearingNode)}f.keyCode!==e.ESCAPE||this.isSingleTabSelected||(h.stop(f),this.emit("focusLastSelectedTab"))})))},_createTraverseGrid:function(){var a;this._nodes=[];r.empty(this.traverseGrid);this._dndContainer=new L(this.traverseGrid,{skipForm:!0,singular:!0});this._dndContainer.copyState=function(){return!1};for(a=0;a<this._itemList.length;a++)this._createRow(this._itemList[a],a);this.own(this._dndContainer.on("DndDrop",
d.hitch(this,this._onDndDrop)));this._dndContainer.insertNodes(!1,this._nodes)},_resetEntryRow:function(a){this.bearingNode.set("value","");this.lengthNode.set("value","");this.bearingNode.reset();this.lengthNode.reset();0<this._itemList.length&&(a=a?this._getBearingAccordingToPlanSettings(this._itemList[this._itemList.length-1].BearingConversions):this._itemList[this._itemList.length-1].Bearing,this.bearingNode.set("value",a),this.bearingNode.textbox.setSelectionRange(0,a.length))},_drawStraightLine:function(a,
b){a=u.getDestinationPoint(this.startPointForNextLine,a.BearingConversions.naDD,a.LengthConversions.meters);this._drawLineAndEndPoint(a,[this.startPointForNextLine,a],b)},_drawLineAndEndPoint:function(a,b,c){a?(b=u.getLineBetweenPoints(b))?(b=new w(b,y.fromJson(this.config.coordinatesSymbology.polyline)),this._addProjectedGraphic(this.drawnOrSelectedGraphicsLayer,b,c),this.startPointForNextLine=d.clone(a),this._drawPoint(a)):this._showMessage(this.nls.newTraverse.unableToDrawLineMessage):this._showMessage(this.nls.newTraverse.invalidEndPointMessage)},
_addProjectedGraphic:function(a,b,c){var f,p={};p.rowIndex=a.graphics.length;b.attributes=p;4326!==this.map.spatialReference.wkid?u.getProjectedGeometry(b.geometry,this.map.spatialReference,this.geometryService).then(d.hitch(this,function(k){k&&(f=new w(k),f.setAttributes(p),f.setSymbol(b.symbol),a.add(f),this.emit("enableClearAOIButton"),this.emit("enableZoomIcon"),c&&(this._setExtentToLayer(a),this.emit("redrawAOI")))})):(a.add(b),c&&this._setExtentToLayer(a))},_drawPoint:function(a){a=new w(a,
y.fromJson(this.config.coordinatesSymbology.point));this._addProjectedGraphic(this.drawnOrSelectedGraphicsLayer,a,!1,!1)},_showHideTraverseTools:function(){this._itemList&&0<this._itemList.length?(m.remove(this.expandCollapseNode,"esriCTHidden"),l.set(this.expandCollapseNode,"tabindex","0")):(m.add(this.expandCollapseNode,"esriCTHidden"),l.set(this.expandCollapseNode,"tabindex","-1"))},_onExpandCollapseClicked:function(){m.toggle(this.traverseGrid,"esriCTHidden");m.contains(this.expandCollapseNode,
"esriCTExpand")?(l.set(this.expandCollapseNode,"title",this.nls.planSettings.collapseGridTooltipText),l.set(this.expandCollapseNode,"aria-label",this.nls.planSettings.collapseGridTooltipText),m.replace(this.expandCollapseNode,"esriCTCollapse","esriCTExpand"),l.set(this.expandCollapseNode,"aria-expanded","true")):(l.set(this.expandCollapseNode,"title",this.nls.planSettings.expandGridTooltipText),l.set(this.expandCollapseNode,"aria-label",this.nls.planSettings.expandGridTooltipText),m.replace(this.expandCollapseNode,
"esriCTExpand","esriCTCollapse"),l.set(this.expandCollapseNode,"aria-expanded","false"));this._setFocusOnExpandCollapseGridButton()},_setExtentToLayer:function(a){0<a.graphics.length&&(a=H.graphicsExtent(a.graphics),this.map.extent.contains(a)||0===this.bufferDistanceTextBox.get("value")&&this.map.setExtent(a.expand(1.5)))},_deleteRow:function(a,b){this._itemList.length&&(this._dndContainer.delItem(a.id),r.destroy(a),this._nodes.splice(b,1),this._itemList.splice(b,1),this._dndContainer.sync(),this._updateRowIndexes(),
this.setStartPoint(this.startPoint),this._showHideTraverseTools())},_updateRowIndexes:function(){var a=v(".esriCTRow",this.traverseGrid);z.forEach(a,d.hitch(this,function(b,c){var f;l.set(b,"rowIndex",c);(f=v(".esriCTDeleteIcon",b)[0])&&l.set(f,"rowIndex",c);(b=v(".esriCTSymbolContainer",b)[0])&&l.set(b,"rowIndex",c)}))},setStartPoint:function(a){var b=new x(4326);u.getProjectedGeometry(a,b,this.geometryService).then(d.hitch(this,function(c){this.startPoint=c;this.startPointForNextLine=d.clone(c);
this._orgStartPointForNextLine=d.clone(c);0<this._itemList.length?this._reDrawParcel():(this.drawnOrSelectedGraphicsLayer.clear(),this.uploadedShapefileGraphicsLayer.clear(),this._arrayOfAllBoundaryLines=[],this._drawPoint(a),this._setExtentToLayer(this.drawnOrSelectedGraphicsLayer),this.emit("redrawAOI"))}))},_reDrawParcel:function(){this.drawnOrSelectedGraphicsLayer.clear();this.uploadedShapefileGraphicsLayer.clear();this._arrayOfAllBoundaryLines=[];this._drawPoint(this.startPoint);z.forEach(this._itemList,
d.hitch(this,function(a){this._drawStraightLine(a,!1)}));this.emit("redrawAOI");this._setExtentToLayer(this.drawnOrSelectedGraphicsLayer)},_handleEventsOnInitialRow:function(){this.own(g(this.bearingNode,"keydown",d.hitch(this,function(a){this._bearingValueEntered(a);a.keyCode!==e.ESCAPE||this.isSingleTabSelected||(h.stop(a),this.emit("focusLastSelectedTab"))})));this.own(g(this.lengthNode,"keydown",d.hitch(this,function(a){this._lengthValueEntered(a);a.keyCode!==e.ESCAPE||this.isSingleTabSelected||
(h.stop(a),this.emit("focusLastSelectedTab"))})))},_bearingValueEntered:function(a){a=a.charCode||a.keyCode;a===e.ENTER||a===e.TAB?(this.bearingNode.get("value"),a===e.ENTER&&this.bearingNode.isValid()?n.focus(this.lengthNode):this.bearingNode.validate(!1)):setTimeout(d.hitch(this,function(){this.bearingNode.validate(!1)}),100)},_setValidatorForInitialRow:function(){this.bearingNode.validator=d.hitch(this,function(a){return this._bearingValidator(a,[])});this.bearingNode.invalidMessage=this.nls.newTraverse.invalidBearingMessage;
this.lengthNode.validator=d.hitch(this,function(a){if(0>parseFloat(a))return this.lengthNode.invalidMessage=this.nls.newTraverse.negativeLengthMessage,!1;this.lengthNode.invalidMessage=this.nls.newTraverse.invalidLengthMessage;return this._lengthValidator(a)});this.lengthNode.invalidMessage=this.nls.newTraverse.invalidLengthMessage},_bearingValidator:function(a,b){return-1!==b.indexOf(a)&&this._itemList&&0<this._itemList.length?!0:this._validateBearing(a,b)},_lengthValidator:function(a,b){return""===
a||"0"===a||0===a?!1:this._validateLength(a,b)},_lengthValueEntered:function(a){a=a.charCode||a.keyCode;a===e.ENTER||a===e.TAB?(this.lengthNode.get("value"),this.lengthNode.isValid()?this.bearingNode.isValid()?this.lengthNode.isValid()?(this._addNewItem(),n.focus(this.bearingNode)):(this.lengthNode.validate(!1),n.focus(this.lengthNode)):(this.bearingNode.validate(!1),n.focus(this.bearingNode)):this.lengthNode.validate(!1)):setTimeout(d.hitch(this,function(){this.lengthNode.validate(!1)}),100)},_attachPlanSettingsIconClickEvent:function(){this.own(g(this.planSettingIcon,
"click",d.hitch(this,function(a){h.stop(a);this._openPlanSettingsDialogBox(a)})))},_openPlanSettingsDialogBox:function(a){this.planSettingsWidget?(this.planSettingsWidget.position=a,this.planSettingsWidget.isTooltipDialogOpened?this.planSettingsWidget.closePopup():this.planSettingsWidget.openPopup()):(this.planSettingsWidget=new N({config:this.config,appConfig:this.appConfig,position:a,nls:this.nls}),this.planSettingsWidget.startup());this.own(g(this.planSettingsWidget,"planSettingsChanged",d.hitch(this,
function(b,c){this._planSettings.directionOrAngleUnits=this.config.traverseDirectionUnit=b;this._planSettings.distanceAndLengthUnits=this.config.traverseUnit=c;this.updateAccordingToPlanSettings(this._planSettings);this._reGenerateTraverseGrid()})));this.own(g(this.planSettingsWidget,"setFocusOnPlanSettingsIcon",d.hitch(this,function(){this._focusOutCurrentNode();n.focus(this.planSettingIcon)})))},_showMessage:function(a){(new M({message:a})).message=a},_attachLatLongTextBoxEvents:function(){this.own(g(this.latitudeTextBox,
"keydown",d.hitch(this,function(a){if(a.keyCode===e.ENTER||a.keyCode===e.SPACE)h.stop(a),this.latitudeTextBox.setValue(q.honourPopupRounding(8,this.latitudeTextBox.getValue())),this.latitudeTextBox.isValid()&&this.longitudeTextBox.isValid()?(this._onLocateLatLongClicked(),setTimeout(d.hitch(this,function(){n.focus(this.longitudeTextBox)}),100)):(this.latitudeTextBox.isValid()&&this.longitudeTextBox.isValid(),n.focus(this.longitudeTextBox));a.keyCode===e.TAB&&this.latitudeTextBox.setValue(q.honourPopupRounding(8,
this.latitudeTextBox.getValue()))})));this.own(g(this.latitudeTextBox,"blur",d.hitch(this,function(){!this.latitudeTextBox.isValid()&&this._latLongValue.latitude&&this.latitudeTextBox.setValue(this._latLongValue.latitude)})));this.own(g(this.longitudeTextBox,"keydown",d.hitch(this,function(a){if(a.keyCode===e.ENTER||a.keyCode===e.SPACE)h.stop(a),this.longitudeTextBox.setValue(q.honourPopupRounding(8,this.longitudeTextBox.getValue())),this.latitudeTextBox.isValid()&&this.longitudeTextBox.isValid()?
(this._onLocateLatLongClicked(),setTimeout(d.hitch(this,function(){n.focus(this.longitudeTextBox)}),100)):this.longitudeTextBox.isValid()&&!this.latitudeTextBox.isValid()?n.focus(this.latitudeTextBox):this._focusOutCurrentNode();a.keyCode===e.TAB&&this.longitudeTextBox.setValue(q.honourPopupRounding(8,this.longitudeTextBox.getValue()))})));this.own(g(this.longitudeTextBox,"blur",d.hitch(this,function(){!this.longitudeTextBox.isValid()&&this._latLongValue.longitude&&this.longitudeTextBox.setValue(this._latLongValue.longitude)})))},
_updateParcelValues:function(a,b){var c,f=!1;if(c=this._itemList[b]){var p=(p=a.get("value"))?d.trim(p.toString()):"";if(m.contains(a.domNode,"esriCTBearingRow")&&String(this._getBearingAccordingToPlanSettings(c.BearingConversions))!==p){var k="Bearing";c.Bearing=p;f=!0}else m.contains(a.domNode,"esriCTLengthRow")&&String(this._getRoundedValue(c.LengthConversions,"Length"))!==p&&(k="Length",c.Length=p,f=!0);f&&((b=this._getValidatedValues(c,k,b))?("Bearing"===k?(k=this._getBearingAccordingToPlanSettings(b.BearingConversions),
c.Bearing=this._getBearingAccordingToPlanSettings(b.BearingConversions,!0),a.set("value",k)):"Length"===k&&(k=this._getRoundedValue(c.LengthConversions,"Length"),c.Length=c.LengthConversions[this._planSettings.distanceAndLengthUnits],a.set("value",k)),this.setStartPoint(this.startPoint)):this._updateValues(c,k,a))}},_updateValues:function(a,b,c){if("Bearing"===b){a.Bearing=this._getBearingAccordingToPlanSettings(a.BearingConversions,!0);var f=this._getBearingAccordingToPlanSettings(a.BearingConversions)}else"Length"===
b&&(a.Length=a.LengthConversions[this._planSettings.distanceAndLengthUnits],f=this._getRoundedValue(a.LengthConversions,"Length"));c.set("value",f)},resetCoordinatesWidgetValue:function(){this.startPointForNextLine=this.startPoint=null;this.deactivateLocateIcon();this.setLatLongTextBoxValue("","");this.latitudeTextBox.reset();this.longitudeTextBox.reset();this._enableOrDisableTraverseGrid(!1);this._nodes=[];this._itemList=[];r.empty(this.traverseGrid);this.bearingNode.set("value","");this.lengthNode.set("value",
"");this.bearingNode.reset();this.lengthNode.reset();this._showHideTraverseTools();this.clearSearchText();this.planSettingsWidget&&this.planSettingsWidget.config&&(this.planSettingsWidget.config.traverseDirectionUnit=this._configuredDirectionUnit,this.planSettingsWidget.config.traverseUnit=this._configuredDistanceUnit,this.planSettingsWidget.emit("planSettingsChanged",this._configuredDirectionUnit,this._configuredDistanceUnit))},_onDndDrop:function(){var a=[];this._dndContainer.sync();var b=this._dndContainer.getAllNodes();
b.forEach(d.hitch(this,function(c){c=parseInt(l.get(c,"rowIndex"),10);a.push(this._itemList[c])}));this._nodes=b;this._itemList=[];this._itemList=a;this._updateRowIndexes();this.setStartPoint(this.startPoint)},_reGenerateTraverseGrid:function(){this._dndContainer&&(this._dndContainer.destroy(),this._dndContainer=null);r.empty(this.traverseGrid);this._createTraverseGrid()},focusFirstNodeOfSelectedTab:function(){n.focus(this.coordinatesHeader)},setFirstFocusNode:function(a){O.initFirstFocusNode(a,this.coordinatesHeader)},
_attachKeydownEventToTheNodes:function(){this.own(g(this.locateStartPointIcon,"keydown",d.hitch(this,function(a){if(a.keyCode===e.ENTER||a.keyCode===e.SPACE)h.stop(a),m.contains(this.locateStartPointIcon,"esriCTLocateIconSelected")?this.deactivateLocateIcon():this._activateLocateIcon();a.keyCode!==e.ESCAPE||this.isSingleTabSelected||(h.stop(a),this.emit("focusLastSelectedTab"))})));this.own(g(this.latitudeTextBox,"keydown",d.hitch(this,function(a){a.keyCode!==e.ESCAPE||this.isSingleTabSelected||(h.stop(a),
this.emit("focusLastSelectedTab"))})));this.own(g(this.longitudeTextBox,"keydown",d.hitch(this,function(a){a.keyCode!==e.ESCAPE||this.isSingleTabSelected||(h.stop(a),this.emit("focusLastSelectedTab"))})));this.own(g(this.locateLatAndLong,"keydown",d.hitch(this,function(a){if(a.keyCode===e.ENTER||a.keyCode===e.SPACE)h.stop(a),this.latitudeTextBox.isValid()&&this.longitudeTextBox.isValid()?(this._onLocateLatLongClicked(),setTimeout(d.hitch(this,function(){this._focusOutCurrentNode();n.focus(this.startPointSection)}),
100)):this._showMessage(this.nls.coordinatesWidget.invalidLatLongMessage);a.keyCode!==e.ESCAPE||this.isSingleTabSelected||(h.stop(a),this.emit("focusLastSelectedTab"))})));this.own(g(this.planSettingIcon,"keydown",d.hitch(this,function(a){if(a.keyCode===e.ENTER||a.keyCode===e.SPACE){h.stop(a);var b=A.position(this.planSettingIcon),c={};c.pageX=b.x+10;c.pageY=b.y+12;this._openPlanSettingsDialogBox(c);this.planSettingsWidget.setFocusToPlanSettingsDialog()}a.keyCode!==e.ESCAPE||this.isSingleTabSelected||
(h.stop(a),this.emit("focusLastSelectedTab"))})))},_setFocusOnExpandCollapseGridButton:function(){this._focusOutCurrentNode();n.focus(this.expandCollapseNode)},_attachSearchNodeEvents:function(){this._searchInstance&&this._searchInstance.search&&this._searchInstance.search.inputNode&&(""!==this._inputNodeEventHandler&&null!==this._inputNodeEventHandler&&void 0!==this._inputNodeEventHandler&&this._inputNodeEventHandler[0].remove(),this._inputNodeEventHandler=this.own(g(this._searchInstance.search.inputNode,
"keydown",d.hitch(this,function(a){a.keyCode!==e.ESCAPE||this.isSingleTabSelected||(h.stop(a),this.emit("focusLastSelectedTab"))}))));this._searchInstance&&this._searchInstance.search&&this._searchInstance.search.submitNode&&(""!==this._submitNodeEventHandler&&null!==this._submitNodeEventHandler&&void 0!==this._submitNodeEventHandler&&this._submitNodeEventHandler[0].remove(),this._submitNodeEventHandler=this.own(g(this._searchInstance.search.submitNode,"keydown",d.hitch(this,function(a){a.keyCode!==
e.ESCAPE||this.isSingleTabSelected||(h.stop(a),this.emit("focusLastSelectedTab"))}))));this._searchInstance&&this._searchInstance.search&&this._searchInstance.search.sourcesBtnNode&&(""!==this._buttonNodeEventHandler&&null!==this._buttonNodeEventHandler&&void 0!==this._buttonNodeEventHandler&&this._buttonNodeEventHandler[0].remove(),this._buttonNodeEventHandler=this.own(g(this._searchInstance.search.sourcesBtnNode,"keydown",d.hitch(this,function(a){a.keyCode!==e.ESCAPE||this.isSingleTabSelected||
(h.stop(a),this.emit("focusLastSelectedTab"))}))));this._searchInstance&&this._searchInstance.search&&this._searchInstance.search.clearNode&&(""!==this._clearNodeEventHandler&&null!==this._clearNodeEventHandler&&void 0!==this._clearNodeEventHandler&&this._clearNodeEventHandler[0].remove(),this._clearNodeEventHandler=this.own(g(this._searchInstance.search.clearNode,"keydown",d.hitch(this,function(a){a.keyCode!==e.ESCAPE||this.isSingleTabSelected||(h.stop(a),this.emit("focusLastSelectedTab"))}))))},
_focusOutCurrentNode:function(){n.curNode&&n.curNode.blur()}})});