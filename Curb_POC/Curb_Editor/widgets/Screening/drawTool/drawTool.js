// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/Screening/drawTool/drawTool.html":'\x3cdiv\x3e\r\n  \x3cdiv tabindex\x3d"0" role\x3d"presentation" aria-label\x3d"${nls.drawToolWidget.useDrawToolForAOILabel}"\r\n    class\x3d"esriCTDrawBoxLabel" data-dojo-attach-point\x3d"drawToolHeader"\x3e${nls.drawToolWidget.useDrawToolForAOILabel}\x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTDrawToolIconsParentDiv" data-dojo-attach-point\x3d"drawToolIconsParentDiv"\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTSelectToolParentDiv" data-dojo-attach-point\x3d"selectToolParent"\x3e\r\n    \x3cdiv class\x3d"esriCTSelectToolDiv" data-dojo-attach-point\x3d"selectToolDiv"\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTWidgetAndBufferSeparator esriCTHidden" data-dojo-attach-point\x3d"seperatorAfterSelect"\x3e\r\n  \x3c/div\x3e\r\n  \x3c!-- Layer chooser starts --\x3e\r\n  \x3cdiv class\x3d"esriCTParentDivOfChooseSymbol esriCTHidden" data-dojo-attach-point\x3d"parentDivOfChooseSymbol"\x3e\r\n    \x3cdiv class\x3d"esriCTExpandCollapseParentContainer"\x3e\r\n      \x3cdiv class\x3d"esriCTLayerPanelOfSelectIcon esriCTLayerPanelExpandIcon" data-dojo-attach-point\x3d"layerSectionIcon"\r\n        role\x3d"button" tabindex\x3d"0" aria-label\x3d"${nls.drawToolWidget.chooseLayerTitle}" aria-expanded\x3d"false"\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"esriCTSelectableLayerTitle esriCTEllipsis" data-dojo-attach-point\x3d"impactSummaryLayerTitle"\r\n        title\x3d"${nls.drawToolWidget.chooseLayerTitle}"\x3e\r\n        ${nls.drawToolWidget.chooseLayerTitle}\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"esriCTImpactSummaryLayerMaxRecordHint esriCTHidden esriCTCursorPointer"\r\n        data-dojo-attach-point\x3d"singleLayerSelectionWarning" title\x3d"${nls.drawToolWidget.layerSelectionWarningTooltip}"\r\n        role\x3d"button" tabindex\x3d"0" aria-label\x3d"${nls.drawToolWidget.layerSelectionWarningTooltip}"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"entireLayerParentContainer" class\x3d"esriCTHidden"\x3e\r\n      \x3cdiv class\x3d"jimu-widget-screening-selectable-layer-item no-action"\x3e\r\n        \x3cdiv class\x3d"layer-row"\x3e\r\n          \x3cdiv class\x3d"selectable-check checked" title\x3d"${nls.drawToolWidget.selectAllLayersText}"\r\n            data-dojo-attach-point\x3d"selectAllLayers" role\x3d"checkbox" tabindex\x3d"0"\r\n            aria-label\x3d"${nls.drawToolWidget.selectAllLayersText}" aria-checked\x3d"true"\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv class\x3d"layer-name jimu-ellipsis" title\x3d"${nls.drawToolWidget.selectAllLayersText}"\x3e\r\n            ${nls.drawToolWidget.selectAllLayersText}\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"layer-nodes" data-dojo-attach-point\x3d"layerItemsNode"\x3e\r\n        \x3cdiv class\x3d"esriCTLayerItems"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3c!-- Layer chooser ends --\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/declare dojo/text!./drawTool.html dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/Evented dojo/on dojo/dom-construct dojo/query dojo/dom-class dojo/_base/array jimu/BaseWidget jimu/dijit/DrawBox jimu/dijit/FeatureSetChooserForMultipleLayers jimu/SelectionManager esri/geometry/geometryEngine dojo/_base/html dojo/_base/array ./SelectableLayerItem jimu/dijit/Message dijit/focus dojo/dom-style dojo/keys dojo/_base/event jimu/utils dojo/dom-attr".split(" "),function(u,v,w,c,x,f,y,
p,e,r,z,A,B,C,D,q,n,E,F,m,t,g,h,G,k){return u([z,w,x],{baseClass:"jimu-widget-screening-drawTool",templateString:v,_drawTool:null,_filteredLayerArray:[],selectTool:null,layerItems:null,currentSelectedDrawTool:null,_selectToolFocusElement:null,constructor:function(a){this._drawTool=null;this._filteredLayerArray=[];this._selectToolFocusElement=this.currentSelectedDrawTool=this.layerItems=this.selectTool=null;c.mixin(this,a)},postCreate:function(){this.layerItems=[];this._createFeatureLayerArr();this._initializeDrawBoxTools();
this.config.drawToolSelectableLayers&&0<this.config.drawToolSelectableLayers.length||!this.config.drawToolSelectableLayers?(this._initializeSelectTool(),this._setFeatureLayersForSelectTool(),this._initLayers()):this._hideLayerChooserListOfSelectTool();this.own(f(this.layerSectionIcon,"click",c.hitch(this,function(a){h.stop(a);this._showOrHideLayerDetailsContainer()})));this.own(f(this.impactSummaryLayerTitle,"click",c.hitch(this,this._showOrHideLayerDetailsContainer)));this.own(f(this.layerSectionIcon,
"keydown",c.hitch(this,function(a){if(a.keyCode===g.ENTER||a.keyCode===g.SPACE)h.stop(a),this._showOrHideLayerDetailsContainer();a.keyCode!==g.ESCAPE||this.isSingleTabSelected||(h.stop(a),this.emit("focusLastSelectedTab"))})));this.own(f(this.impactSummaryLayerTitle,"keydown",c.hitch(this,function(a){if(a.keyCode===g.ENTER||a.keyCode===g.SPACE)h.stop(a),this._showOrHideLayerDetailsContainer()})));this.own(f(this.selectAllLayers,"click",c.hitch(this,function(a){h.stop(a);this._selectAllLayers()})));
this.own(f(this.selectAllLayers,"keydown",c.hitch(this,function(a){if(a.keyCode===g.ENTER||a.keyCode===g.SPACE)h.stop(a),this._selectAllLayers();a.keyCode!==g.ESCAPE||this.isSingleTabSelected||(h.stop(a),this.emit("focusLastSelectedTab"))})));this.own(f(this.singleLayerSelectionWarning,"click",c.hitch(this,function(a){h.stop(a);this._showMessage(this.nls.drawToolWidget.layerSelectionWarningTooltip)})));this.own(f(this.singleLayerSelectionWarning,"keydown",c.hitch(this,function(a){if(a.keyCode===g.ENTER||
a.keyCode===g.SPACE)h.stop(a),this._showMessage(this.nls.drawToolWidget.layerSelectionWarningTooltip);a.keyCode!==g.ESCAPE||this.isSingleTabSelected||(h.stop(a),this.emit("focusLastSelectedTab"))})))},_initLayers:function(){q.empty(this.layerItemsNode);n.forEach(this._filteredLayerArray,c.hitch(this,function(a){if(a&&a.objectIdField&&a.geometryType){var b;n.forEach(this.layerInfoArray,c.hitch(this,function(l){l.id===a.id&&(b=l)}));var d=new E({layerInfo:b,checked:!0,layerVisible:!0,map:this.map,nls:this.nls,
isSingleTabSelected:this.isSingleTabSelected});this.own(f(d,"stateChange",c.hitch(this,function(){this.emit("clearExistingSelection");this.selectTool.setFeatureLayers(this._getSelectableLayers());this._updateSelectAllState()})));this.own(f(d,"focusLastSelectedTab",c.hitch(this,function(){this.emit("focusLastSelectedTab")})));d.init(a);q.place(d.domNode,this.layerItemsNode);d.startup();this.layerItems.push(d)}}))},_getSelectableLayers:function(){var a=[];n.forEach(this.layerItems,function(b){b.isLayerVisible()&&
b.isChecked()&&a.push(b.featureLayer)},this);return a},_showOrHideLayerDetailsContainer:function(){e.contains(this.layerSectionIcon,"esriCTLayerPanelCollapseIcon")?(e.add(this.entireLayerParentContainer,"esriCTHidden"),e.replace(this.layerSectionIcon,"esriCTLayerPanelExpandIcon","esriCTLayerPanelCollapseIcon"),k.set(this.layerSectionIcon,"aria-expanded","false")):(e.remove(this.entireLayerParentContainer,"esriCTHidden"),e.replace(this.layerSectionIcon,"esriCTLayerPanelCollapseIcon","esriCTLayerPanelExpandIcon"),
k.set(this.layerSectionIcon,"aria-expanded","true"))},_selectAllLayers:function(){var a;q.toggleClass(this.selectAllLayers,"checked");(a=e.contains(this.selectAllLayers,"checked"))?k.set(this.selectAllLayers,"aria-checked","true"):k.set(this.selectAllLayers,"aria-checked","false");n.forEach(this.layerItems,function(b){a?e.contains(b.selectableCheckBox,"checked")||(b.selectableCheckBox.click(),k.set(b.selectableCheckBox,"aria-checked","true")):e.contains(b.selectableCheckBox,"checked")&&(b.selectableCheckBox.click(),
k.set(b.selectableCheckBox,"aria-checked","false"))})},_updateSelectAllState:function(){var a;var b=!0;var d=e.contains(this.selectAllLayers,"checked");n.forEach(this.layerItems,function(l){e.contains(l.selectableCheckBox,"checked")?b=!1:a=!0});a?(e.remove(this.selectAllLayers,"checked"),k.set(this.selectAllLayers,"aria-checked","false")):d||(e.add(this.selectAllLayers,"checked"),k.set(this.selectAllLayers,"aria-checked","true"));b?(e.remove(this.singleLayerSelectionWarning,"esriCTHidden"),this.singleLayerSelectionWarning.focus()):
e.add(this.singleLayerSelectionWarning,"esriCTHidden")},_createFeatureLayerArr:function(){if(this.config.drawToolSelectableLayers)n.forEach(this.config.drawToolSelectableLayers,c.hitch(this,function(b){b=this.layerInfosObj.getLayerInfoById(b).layerObject;""!==b&&null!==b&&void 0!==b&&this._filteredLayerArray.push(b)}));else for(var a in this.filteredLayerObj)this.filteredLayerObj.hasOwnProperty(a)&&this._filteredLayerArray.push(this.filteredLayerObj[a])},_hideAllTheDrawTools:function(){this._drawTool&&
p(".draw-item",this._drawTool.domNode).addClass("esriCTHidden")},_initializeDrawBoxTools:function(){var a;var b=[];var d=!1;this.config.hasOwnProperty("showPointTool")&&this.config.showPointTool&&b.push("POINT");this.config.hasOwnProperty("showPolylineTool")&&this.config.showPolylineTool&&b.push("POLYLINE");this.config.hasOwnProperty("showExtentTool")&&this.config.showExtentTool&&b.push("EXTENT");this.config.hasOwnProperty("showPolygonTool")&&this.config.showPolygonTool&&b.push("POLYGON");this.config.hasOwnProperty("showCircleTool")&&
this.config.showCircleTool&&b.push("CIRCLE");if(this.config.hasOwnProperty("showPointTool")||this.config.hasOwnProperty("showPolylineTool")||this.config.hasOwnProperty("showExtentTool")||this.config.hasOwnProperty("showPolygonTool")||this.config.hasOwnProperty("showCircleTool"))d=!0;this.config.hasOwnProperty("showPointTool")||this.config.hasOwnProperty("showPolylineTool")||this.config.hasOwnProperty("showExtentTool")||this.config.hasOwnProperty("showPolygonTool")||this.config.hasOwnProperty("showCircleTool")||
b.push("POINT","POLYLINE","EXTENT","POLYGON");this._drawTool=new A({geoTypes:b,map:this.map,pointSymbol:this.pointSymbol,polylineSymbol:this.polylineSymbol,polygonSymbol:this.polygonSymbol},this.drawToolIconsParentDiv);this._drawTool.startup();this._attachKeydownEventToTheNodes();this._addAriaLabelToDrawTools();d&&0===b.length&&this._hideAllTheDrawTools();this.own(f(this._drawTool,"draw-activate",c.hitch(this,function(l){this.currentSelectedDrawTool=l;this._hideLayerChooserListOfSelectTool();this.selectTool&&
this.selectTool.isActive()&&this._drawTool.drawToolBar.activate(l);"extent"===l&&this.map.disablePan();this.map.setInfoWindowOnClick(!1)})));this.own(f(this._drawTool,"draw-end",c.hitch(this,function(l){this.clearAllSelections(!0);this._drawTool.drawLayer.clear();this.map.enablePan();(a="polygon"===l.geometry.type?D.simplify(l.geometry):l.geometry)?this.emit("onDrawComplete",[l]):this._drawTool.drawLayer.clear();this.map.setInfoWindowOnClick(!0);this._activateLastSelectedTool()})))},_initializeSelectTool:function(){this.selectTool=
new B({map:this.map,updateSelection:!0,fullyWithin:!1},this.selectToolDiv);var a=p(".btn-clear",this.selectTool.domNode)[0];e.add(a,"esriCTHidden");k.set(a,"tab-index","-1");this._selectToolFocusElement=this.selectTool.domNode.children[0];k.set(this._selectToolFocusElement,"role","button");k.set(this._selectToolFocusElement,"aria-label",this.nls.drawToolWidget.selectToolLabel);var b=p(".btn-select",this.selectTool.domNode)[0];this.own(f(b,"click",c.hitch(this,function(d){h.stop(d);this._activateOrDeactivateSelectTool()})));
this.own(f(this.selectToolParent,"keydown",c.hitch(this,function(d){d.keyCode!==g.ESCAPE||this.isSingleTabSelected||(h.stop(d),this.emit("focusLastSelectedTab"));if(d.keyCode===g.ENTER||d.keyCode===g.SPACE)h.stop(d),b.click()})));this.own(f(this.selectTool,"unloading",c.hitch(this,function(){this.currentSelectedDrawTool="selectTool";this._deactivateSelectTool();var d=this._getSelectedFeature();this.emit("onSelectionComplete",d);this._activateLastSelectedTool()})));y.place(this.selectToolParent,p(".draw-items",
this.domNode)[0],"last")},deactivateTools:function(){this._drawTool&&this._drawTool.isActive()&&this._drawTool.deactivate();this.selectTool&&this.selectTool.isActive()&&this._deactivateSelectTool();this.map.enablePan()},_setFeatureLayersForSelectTool:function(){this.selectTool.setFeatureLayers(this._filteredLayerArray)},_getSelectedFeature:function(){var a=[];r.forEach(this._filteredLayerArray,c.hitch(this,function(b){a=a.concat(b.getSelectedFeatures())}));return a},clearAllSelections:function(a){var b=
C.getInstance();r.forEach(this._filteredLayerArray,c.hitch(this,function(d){a&&b.clearSelection(d)}))},_showMessage:function(a){(new F({message:a})).message=a},_displayLayerChooserListOfSelectTool:function(){e.remove(this.seperatorAfterSelect,"esriCTHidden");e.remove(this.parentDivOfChooseSymbol,"esriCTHidden")},_hideLayerChooserListOfSelectTool:function(){e.add(this.seperatorAfterSelect,"esriCTHidden");e.add(this.parentDivOfChooseSymbol,"esriCTHidden")},_deactivateSelectTool:function(){this.selectTool&&
this.selectTool.deactivate();this._hideLayerChooserListOfSelectTool()},focusFirstNodeOfSelectedTab:function(){m.focus(this.drawToolHeader)},setFirstFocusNode:function(a){G.initFirstFocusNode(a,this.drawToolHeader)},_attachKeydownEventToTheNodes:function(){n.forEach(this._drawTool.domNode.children[0].children,c.hitch(this,function(a){"block"===t.get(a,"display")&&this.own(f(a,"keydown",c.hitch(this,function(b){b.keyCode!==g.ESCAPE||this.isSingleTabSelected||(h.stop(b),this.emit("focusLastSelectedTab"))})))}))},
_addAriaLabelToDrawTools:function(){n.forEach(this._drawTool.domNode.children[0].children,c.hitch(this,function(a){if("block"===t.get(a,"display")){var b=k.get(a,"title");k.set(a,"aria-label",b);e.add(a,"esriCTDrawItem")}}))},_focusOutCurrentNode:function(){m.curNode&&m.curNode.blur()},_activateOrDeactivateSelectTool:function(){this._drawTool.isActive()&&this._drawTool.deactivate();this.selectTool&&this.selectTool.isActive()?(this._displayLayerChooserListOfSelectTool(),this.map.disablePan()):this._deactivateSelectTool()},
setFocusOnSelectTool:function(){""!==this.selectTool&&null!==this.selectTool&&void 0!==this.selectTool&&(this._focusOutCurrentNode(),m.focus(this._selectToolFocusElement),this.currentSelectedDrawTool=null)},_activateLastSelectedTool:function(){switch(this.currentSelectedDrawTool){case "point":this._focusOutCurrentNode();m.focus(this._drawTool.pointIcon);this.currentSelectedDrawTool=null;break;case "polyline":this._focusOutCurrentNode();m.focus(this._drawTool.polylineIcon);this.currentSelectedDrawTool=
null;break;case "extent":this._focusOutCurrentNode();m.focus(this._drawTool.extentIcon);this.currentSelectedDrawTool=null;break;case "circle":this._focusOutCurrentNode();m.focus(this._drawTool.circleIcon);this.currentSelectedDrawTool=null;break;case "polygon":this._focusOutCurrentNode();m.focus(this._drawTool.polygonIcon);this.currentSelectedDrawTool=null;break;case "selectTool":this._focusOutCurrentNode(),m.focus(this._selectToolFocusElement)}}})});