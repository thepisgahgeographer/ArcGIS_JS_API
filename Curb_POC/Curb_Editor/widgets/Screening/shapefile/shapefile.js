// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/Screening/shapefile/shapefile.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"esriCTUploadShapefileText"\x3e\r\n    ${label}\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTUploadShapefileButtonDiv"\x3e\r\n    \x3cform enctype\x3d"multipart/form-data" method\x3d"post" data-dojo-attach-point\x3d"uploadForm"\x3e\r\n      \x3cdiv class\x3d\'jimu-btn jimu-float-trailing jimu-trailing-margin1 esriCTUploadShapefileButton\'\r\n        title\x3d"${label}" data-dojo-attach-point\x3d"uploadShapefileButton"\r\n        role\x3d"button" aria-label\x3d"${label}" tabindex\x3d"0"\x3e\r\n        ${nls.shapefileWidget.uploadShapefileButtonText}\r\n      \x3c/div\x3e\r\n      \x3cinput title\x3d"${label}" data-dojo-attach-point\x3d"shapefileInput"\r\n        type\x3d"file" name\x3d"file" accept\x3d".zip" tabindex\x3d"-1" class\x3d"esriCTHidden" /\x3e\r\n    \x3c/form\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/declare dojo/text!./shapefile.html dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/on dojo/json dojo/Evented esri/layers/FeatureLayer esri/request jimu/BaseWidget jimu/dijit/Message dijit/focus dojo/keys dojo/_base/event jimu/utils".split(" "),function(m,n,p,c,e,q,r,t,u,v,w,f,g,h,k){return m([v,p,r],{baseClass:"jimu-widget-screening-shapefile",templateString:n,_uploadFormChange:null,nls:null,config:null,map:null,constructor:function(a){this.map=this.config=this.nls=this._uploadFormChange=
null;c.mixin(this,a)},postCreate:function(){this._attachEventsToUploadShapefileButton();this._attachFileInputOnChangeEvent()},_attachEventsToUploadShapefileButton:function(){this.own(e(this.uploadShapefileButton,"click",c.hitch(this,function(a){h.stop(a);this.shapefileInput.click()})));this.own(e(this.uploadShapefileButton,"keydown",c.hitch(this,function(a){if(a.keyCode===g.ENTER||a.keyCode===g.SPACE)h.stop(a),this.shapefileInput.click();a.keyCode!==g.ESCAPE||this.isSingleTabSelected||(h.stop(a),
this.emit("focusLastSelectedTab"))})))},_attachFileInputOnChangeEvent:function(){var a;this._uploadFormChange&&this._uploadFormChange.remove();this._uploadFormChange=this.own(e.pausable(this.uploadForm,"change",c.hitch(this,function(d){this.loadingIndicator.show();a={filename:d.target.value.toLowerCase()};this._generateFeatureCollection(a)})))},_generateFeatureCollection:function(a){a=a.filename.split(".");a=a[0].replace("c:\\fakepath\\","");this._requestFeatureCollection({params:{name:a,targetSR:this.map.spatialReference,
maxRecordCount:this.config.maxFeaturesForAnalysis}})},_requestFeatureCollection:function(a){var d,l;a={filetype:"shapefile",publishParameters:q.stringify(a.params),f:"json"};u({url:this.config.generateFeatureCollectionURL,content:a,form:this.uploadForm,handleAs:"json",load:c.hitch(this,function(b){b.error?(this.loadingIndicator.hide(),this._showMessage(this.nls.shapefileWidget.unableToUploadShapefileMessage)):(d=b.featureCollection.layers[0],this._uploadFormChange[0].pause(),l=new t(d),this.shapefileInput.value=
"",this._uploadFormChange[0].resume(),this.emit("onShapefileUpload",l),this.loadingIndicator.hide())}),error:c.hitch(this,function(b){this._uploadFormChange[0].pause();this.shapefileInput.value="";this._uploadFormChange[0].resume();this.loadingIndicator.hide();400===b.code?b.details&&0<b.details.length?this._showMessage(this.nls.shapefileWidget.unableToUploadShapefileMessage+" "+b.details[0]):this._showMessage(this.nls.shapefileWidget.unableToUploadShapefileMessage+" "+b.message):this._showMessage(this.nls.shapefileWidget.unableToUploadShapefileMessage+
" "+b.message)})})},_showMessage:function(a){(new w({message:a})).message=a},focusFirstNodeOfSelectedTab:function(){this._focusOutCurrentNode();f.focus(this.uploadShapefileButton)},setFirstFocusNode:function(a){k.initFirstFocusNode(a,this.uploadShapefileButton)},_focusOutCurrentNode:function(){f.curNode&&f.curNode.blur()},setLastFocusNode:function(a){k.initLastFocusNode(a,this.uploadShapefileButton)}})});