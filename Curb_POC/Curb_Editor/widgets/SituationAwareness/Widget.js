// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"jimu/dijit/Report":function(){define("dojo/_base/declare jimu/BaseWidget jimu/utils dojo/Evented ./PageUtils dojo/text!./templates/ReportTemplate.html dojo/_base/lang dojo/_base/array dojo/_base/window dojo/dom-construct dojo/dom-class dojo/dom-style dojo/dom dojo/string dojo/on esri/tasks/PrintParameters esri/tasks/PrintTemplate esri/tasks/PrintTask dijit/focus dojo/query dojo/dom-attr".split(" "),function(Q,I,P,V,J,x,n,q,t,v,H,d,b,m,k,e,c,f,A,C,F){return Q([I,V],{baseClass:"jimu-report",
_printService:null,_printWindow:null,_sizeInPixels:{},_windowOpenedTimer:null,_shownUnableToPrintMapMsg:!1,printTaskUrl:null,reportLogo:"",reportLayout:{},maxNoOfCols:3,styleSheets:[],styleText:"",constructor:function(){this.inherited(arguments);this._sizeInPixels={};this.printTaskUrl=null;this.reportLayout={};this.styleSheets=[]},postMixInProperties:function(){this.nls=n.mixin(window.jimuNls.common,window.jimuNls.report)},postCreate:function(){var z={pageSize:J.PageSizes.A4,orientation:J.Orientation.Portrait};
this.inherited(arguments);this.setReportLayout(this.reportLayout,z);this.reportLayout.dpi=96;this.printTaskUrl&&this._createPrintTask()},setReportLayout:function(z,K){K||(K=this.reportLayout);this._validateParameters(z)?this.reportLayout=n.mixin(K,z):this.reportLayout=K},setMapLayout:function(z){var K=this.reportLayout.pageSize.MapLayout?this.reportLayout.pageSize.MapLayout:"MAP_ONLY";if("MAP_ONLY"===K)z.exportOptions={dpi:this.reportLayout.dpi},this.reportLayout.orientation.Type===J.Orientation.Landscape.Type&&
this.reportLayout.pageSize!==J.PageSizes.Custom?(z.exportOptions.width=this._sizeInPixels.Height,z.exportOptions.height=this._sizeInPixels.Width):(z.exportOptions.width=this._sizeInPixels.Width,z.exportOptions.height=this._sizeInPixels.Height);else if(K&&J.PageSizes[K])K+=" "+this.reportLayout.orientation.Type;else{var D=[];Object.keys(J.PageSizes).forEach(function(h){D.push(J.PageSizes[h].MapLayout)});-1<D.indexOf(K)&&(K+=" "+this.reportLayout.orientation.Type)}z.layout=K;return z},_validateParameters:function(){return this.reportLayout.pageSize!==
J.PageSizes.Custom||this.reportLayout.size?!0:!1},_createPrintTask:function(){this._printService=new f(this.printTaskUrl,{async:!1})},_createPrintMapParameters:function(z){var K=new c;if(z.printTemplate)if(K=z.printTemplate,K.format){var D=K.format.toLowerCase();"png32"!==D&&"png8"!==D&&"jpg"!==D&&"gif"!==D&&(K.format="jpg")}else K.format="jpg";else K=this.setMapLayout(K),K.layoutOptions={customTextElements:[{Date:""}]},K.preserveScale=!0,K.showAttribution=!0,K.format="jpg";D=new e;D.map=z.map;D.template=
K;return D},print:function(z,K){if(this._printService){this._shownUnableToPrintMapMsg=!1;var D=screen.width/2;var h=screen.height/1.5;D=11===P.has("ie")?"toolbar\x3dno, location\x3dno, directories\x3dno, status\x3dyes, menubar\x3dno,scrollbars\x3dyes, resizable\x3dyes, width\x3d"+D+", height\x3d"+h+", top\x3d"+(screen.height/2-h/2)+", left\x3d"+(screen.width/2-D/2):null;h=P.detectUserAgent();(h.browser.hasOwnProperty("firefox")&&h.browser.firefox||h.os.hasOwnProperty("ipad")&&h.os.ipad||h.os.hasOwnProperty("iphone")&&
h.os.iphone)&&this._printWindow&&this._printWindow.close();this._printWindow=window.open("","_blank",D,!1);this._windowOpenedTimer&&clearInterval(this._windowOpenedTimer);this._windowOpenedTimer=setInterval(n.hitch(this,function(){this._printWindow.closed&&(clearInterval(this._windowOpenedTimer),this.emit("report-window-closed"))}),500);this._printWindow.focus();setTimeout(n.hitch(this,function(){t.withDoc(this._printWindow.document,n.hitch(this,function(){this._printWindow.document.open("text/html",
"replace");this._printWindow.document.write(x);window.isRTL&&H.add(b.byId("reportBody"),"jimu-rtl");(this.styleSheets&&0<this.styleSheets.length||this.styleText&&""!==this.styleText)&&this._addExternalStyleSheets();this._setPageSize();this._setButtonLabels();this._setReportSizeMessage();this._setReportLogo();this._setReportTitle(z);this._setReportData(K);this._setFootNotes();this._setAccessibility();this._printWindow.document.close()}))}),500)}else this.emit("reportError")},_addExternalStyleSheets:function(){var z=
b.byId("reportHead");z&&(q.forEach(this.styleSheets,n.hitch(this,function(K){v.create("link",{rel:"stylesheet",type:"text/css",href:K},z)})),this.styleText&&v.create("style",{type:"text/css",innerHTML:this.styleText},z))},_setPageSize:function(){var z=b.byId("reportMain");if(this.reportLayout){var K=this.reportLayout.pageSize;this.reportLayout.pageSize===J.PageSizes.Custom&&this.reportLayout.size&&(K=this.reportLayout.size);K=J.getPageSizeInPixels(K,this.reportLayout.dpi)}var D=this.reportLayout.orientation.Type===
J.Orientation.Landscape.Type&&this.reportLayout.pageSize!==J.PageSizes.Custom?K.Height:K.Width;this._sizeInPixels=K;d.set(z,{width:D+"px"})},_setReportData:function(z){var K=b.byId("reportData"),D=b.byId("showErrorButton");D.innerHTML=this.nls.unableToPrintMapMsg;K&&q.forEach(z,n.hitch(this,function(h){var B=v.create("div",{},K);h.addPageBreak&&H.add(B,"esriCTPageBreak");"table"===h.type?this._formatAndRenderTables(B,h):"html"===h.type?this._renderHTMLData(B,h):"map"===h.type?(h.title&&this._addSectionTitle(h.title,
B),H.add(B,"esriCTReportMap esriCTReportMapWait"),h.extent&&h.data.map.setExtent(h.extent),this._executePrintTask(h,B,D)):"note"===h.type&&this._createReportNote(B,h)}))},_setFootNotes:function(){var z;if((z=b.byId("footNotes"))&&this.footNotes){var K=P.sanitizeHTML(this.footNotes?this.footNotes:"");z.innerHTML=P.fieldFormatter.getFormattedUrl(K)}},_setReportLogo:function(){var z;if((z=b.byId("reportLogo"))&&this.reportLogo){H.remove(z,"esriCTHidden");z.src=this.reportLogo;F.set(z,"alt",this.nls.image);
var K=b.byId("reportHeader");var D=b.byId("reportMain");var h=b.byId("printTitleDiv");window.isRTL&&v.place(h,K,"first");D&&h&&(z.complete&&d.set(h,{width:D.clientWidth-z.clientWidth-51+"px"}),this.own(k(z,"load",n.hitch(this,function(){setTimeout(n.hitch(this,function(){d.set(h,{width:D.clientWidth-z.clientWidth-51+"px"})}),300)}))))}},_setReportTitle:function(z){var K=b.byId("reportTitle");K&&z&&(K.value=z);F.set(K,"aria-label",this.nls.title)},_createReportNote:function(z,K){var D="";K.title&&
(D=K.title);D=this._addSectionTitle(D,z);H.add(D,"esriCTNotesTitle");var h=v.create("textarea",{"class":"esriCTReportNotes",placeholder:this.nls.notesHint,rows:5,tabindex:"0",role:"textbox","aria-label":this.nls.notesHint},z);var B=v.create("p",{"class":"esriCTReportNotesParagraph"},z);H.add(z,"esriCTNotesContainer");K.defaultText&&(h.value=K.defaultText);this.own(k(h,"keydown, change",function(){h.style.height="auto";B.innerHTML=P.sanitizeHTML(h.value?h.value:"");h.style.height=h.scrollHeight+"px"}))},
_setReportSizeMessage:function(){if(this.reportLayout.pageSize===J.PageSizes.Custom&&this.reportLayout.size){var z=this.reportLayout.size;var K=this.reportLayout.pageSize}else z=this.reportLayout.pageSize,K=this.reportLayout.pageSize.SizeName?this.reportLayout.pageSize.SizeName:this.reportLayout.SizeName;z=this.reportLayout.orientation.Type===J.Orientation.Landscape.Type&&this.reportLayout.pageSize!==J.PageSizes.Custom?" ("+z.Height+"'' X "+z.Width+"'') ":" ("+z.Width+"'' X "+z.Height+"'') ";b.byId("reportBarMsg").innerHTML=
m.substitute(this.nls.reportDimensionsMsg,{paperSize:K+z+this.reportLayout.orientation.Text})},_setButtonLabels:function(){var z=b.byId("printButton");z.innerHTML=this.nls.printButtonLabel;z.title=this.nls.printButtonLabel;z=b.byId("closeButton");z.innerHTML=this.nls.close;z.title=this.nls.close},_executePrintTask:function(z,K,D){z=this._createPrintMapParameters(z);this._printService.execute(z,n.hitch(this,function(h){K&&(H.remove(K,"esriCTReportMapWait"),h=v.create("img",{src:h.url,"class":"esriCTReportMapImg",
"aria-label":this.nls.mapArea},K),this.reportLayout.orientation.Type===J.Orientation.Landscape.Type&&H.add(h,"esriCTReportLandscapeMapImg"));this.emit("report-export-task-completed")}),n.hitch(this,function(){H.replace(K,"esriCTReportMapFail","esriCTPageBreak esriCTReportMapWait");this._shownUnableToPrintMapMsg||(this._shownUnableToPrintMapMsg=!0,D.click());this.emit("report-export-task-failed")}))},_renderHTMLData:function(z,K){z=v.create("div",{"class":"esriCTHTMLData"},z);K.title&&this._addSectionTitle(K.title,
z);v.create("div",{innerHTML:K.data},z)},_addSectionTitle:function(z,K){z=P.sanitizeHTML(z?z:"");return v.create("div",{innerHTML:z,"class":z?"esriCTSectionTitle":""},K)},_formatAndRenderTables:function(z,K){var D=K.data,h,B=this.maxNoOfCols;D.maxNoOfCols&&(B=D.maxNoOfCols);D.cols.length>B&&2>=D.cols.length-B&&(B=D.cols.length);var N=0;for(h=D.cols.length;N<h;N+=B){var E={cols:[],rows:[]},O=N+B,R=!1;E.title=0===N?K.title:"";var a=D.cols.length-O;2>=a&&0<a&&(O+=a,R=!0);a=D.cols.slice(N,O);var u=[];
for(var G=0;G<D.rows.length;G++)u.push(D.rows[G].slice(N,O));E.cols=a;E.rows=u;this._renderTable(v.create("div",{},z),E,K.data.showRowIndex);if(R)break}},_renderTable:function(z,K,D){this._addSectionTitle(K.title,z);z=v.create("table",{cellpadding:5,style:{width:"100%"},"class":"esriCTTable"},z);var h=v.create("tbody",{},z);var B=v.create("tr",{},h);D&&v.create("th",{innerHTML:"#",style:{width:"20px"}},B);q.forEach(K.cols,n.hitch(this,function(N){v.create("th",{innerHTML:N},B)}));q.forEach(K.rows,
n.hitch(this,function(N,E){var O=v.create("tr",{},h);D&&v.create("td",{innerHTML:E+1,style:{"word-wrap":"normal"}},O);q.forEach(N,n.hitch(this,function(R){R=P.fieldFormatter.getFormattedUrl(R);v.create("td",{innerHTML:R},O)}))}))},_setAccessibility:function(){this._setFirstFocusNode();this._setLastFocusNode();this._focusFirstNodeOfReport()},_setFirstFocusNode:function(){var z=b.byId("reportTitle");""!==z&&null!==z&&void 0!==z&&P.initFirstFocusNode(this._printWindow.document,z)},_setLastFocusNode:function(){var z=
C(".esriCTReportNotes",this._printWindow.document);""!==z&&null!==z&&void 0!==z&&0<z.length?P.initLastFocusNode(this._printWindow.document,z[0]):(z=C(".esriCTLocaleDateInputTitle",this._printWindow.document),""!==z&&null!==z&&void 0!==z&&0<z.length?P.initLastFocusNode(this._printWindow.document,z[0]):(z=C(".esriCTAOIInputArea",this._printWindow.document),""!==z&&null!==z&&void 0!==z&&0<z.length&&P.initLastFocusNode(this._printWindow.document,z[0])))},_focusFirstNodeOfReport:function(){var z=b.byId("reportTitle");
""!==z&&null!==z&&void 0!==z&&(A.curNode&&A.curNode.blur(),A.focus(z))}})})},"jimu/dijit/PageUtils":function(){define([],function(){var Q={};Q.Orientation={Landscape:{Type:"Landscape",Text:window.jimuNls.report.landscape},Portrait:{Type:"Portrait",Text:window.jimuNls.report.portrait}};Q.PageSizes={A0:{Height:46.8,Width:33.1,SizeName:window.jimuNls.report.a0,MapLayout:"MAP_ONLY"},A1:{Height:33.1,Width:23.4,SizeName:window.jimuNls.report.a1,MapLayout:"MAP_ONLY"},A2:{Height:23.4,Width:16.5,SizeName:window.jimuNls.report.a2,
MapLayout:"MAP_ONLY"},A3:{Height:16.5,Width:11.7,SizeName:window.jimuNls.report.a3,MapLayout:"A3"},A4:{Height:11.7,Width:8.3,SizeName:window.jimuNls.report.a4,MapLayout:"A4"},A5:{Height:8.3,Width:5.8,SizeName:window.jimuNls.report.a5,MapLayout:"MAP_ONLY"},Letter_ANSI_A:{Height:11,Width:8.5,SizeName:window.jimuNls.report.letter+" "+window.jimuNls.report.ansi_a,MapLayout:"Letter ANSI A"},Tabloid_ANSI_B:{Height:17,Width:11,SizeName:window.jimuNls.report.tabloid+" "+window.jimuNls.report.ansi_b,MapLayout:"Tabloid ANSI B"},
ANSI_C:{Height:22,Width:17,SizeName:window.jimuNls.report.ansi_c,MapLayout:"MAP_ONLY"},ANSI_D:{Height:34,Width:22,SizeName:window.jimuNls.report.ansi_d,MapLayout:"MAP_ONLY"},ANSI_E:{Height:44,Width:34,SizeName:window.jimuNls.report.ansi_e,MapLayout:"MAP_ONLY"},Legal:{Height:14,Width:8.5,SizeName:window.jimuNls.report.legal,MapLayout:"MAP_ONLY"},Custom:window.jimuNls.common.custom};Q.getPageSizeInPixels=function(I,P){return{Height:I.Height*P,Width:I.Width*P}};return Q})},"esri/tasks/PrintParameters":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel"],function(Q,I,P,V){Q=Q(null,{declaredClass:"esri.tasks.PrintParameters",map:null,template:null,outSpatialReference:null,extraParameters:null});P("extend-esri")&&I.setObject("tasks.PrintParameters",Q,V);return Q})},"esri/tasks/PrintTemplate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(Q,I,P,V){Q=Q(null,{declaredClass:"esri.tasks.PrintTemplate",label:null,exportOptions:{width:800,height:1100,dpi:96},layoutOptions:null,
format:"PNG32",layout:"MAP_ONLY",outScale:0,preserveScale:!0,forceFeatureAttributes:!1,showAttribution:null,showLabels:!0});P("extend-esri")&&I.setObject("tasks.PrintTemplate",Q,V);return Q})},"esri/tasks/PrintTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/has ../kernel ../lang ../layerUtils ../deferredUtils ../Color ../request ../urlUtils ../geometry/Polygon ../renderers/SimpleRenderer ../symbols/FillSymbol ./Geoprocessor ./PrintTemplate ./Task dojo/dom-attr dojo/dom-construct dojox/gfx/_base dojox/gfx/canvas dojox/json/query dojo/has!extend-esri?./PrintParameters dojo/has!extend-esri?./LegendLayer".split(" "),
function(Q,I,P,V,J,x,n,q,t,v,H,d,b,m,k,e,c,f,A,C,F,z,K,D){Q=Q(A,{declaredClass:"esri.tasks.PrintTask",constructor:function(h,B){this.url=h;this.printGp=new c(this.url);this._handler=I.hitch(this,this._handler);B&&B.async&&(this.async=!0);this._colorEvaluator=D("$..color")},async:!1,_vtlExtent:null,_cimVersion:null,_is11xService:!1,_loadGpServerMetadata:!0,execute:function(h,B,N){if(!this._loadGpServerMetadata)return this._execute(h,B,N);var E=new J(v._dfdCanceller),O=this._url.path,R=O.lastIndexOf("/GPServer/");
0<R&&(O=O.slice(0,R+9));E._pendingDfd=d({url:O,callbackParamName:"callback",content:I.mixin({},this._url.query,{f:"json"})}).then(I.hitch(this,function(a){this._loadGpServerMetadata=!1;this.async="esriExecutionTypeAsynchronous"===a.executionType;this._cimVersion=a.cimVersion;this._is11xService=!!this._cimVersion;E._pendingDfd=this._execute(h);return E._pendingDfd})).then(I.hitch(this,function(a){this._successHandler([a],null,B,E)})).otherwise(function(a){N&&N(a);E.errback(a)});return E},_handler:function(h,
B,N,E,O){try{if(this.async)"esriJobSucceeded"===h.jobStatus?this.printGp.getResultData(h.jobId,"Output_File",I.hitch(this,function(a){R=a.value;this._successHandler([R],"onComplete",N,O)})):this._errorHandler(Error(h.jobStatus),E,O);else{var R=h[0].value;this._successHandler([R],"onComplete",N,O)}}catch(a){this._errorHandler(a,E,O)}},_execute:function(h,B,N){var E=this._handler,O=this._errorHandler,R=h.template||new f;R.hasOwnProperty("showLabels")||(R.showLabels=!0);var a=R.exportOptions,u;a&&(u=
{outputSize:[a.width,a.height],dpi:a.dpi});a=R.layoutOptions;var G=[];if(a){this.legendAll=!1;a.legendLayers?P.forEach(a.legendLayers,function(T){var X={};X.id=T.layerId;T.subLayerIds&&(X.subLayerIds=T.subLayerIds);G.push(X)}):this.legendAll=!0;if("Miles"===a.scalebarUnit||"Kilometers"===a.scalebarUnit){var l="esriKilometers";var g="esriMiles"}else if("Meters"===a.scalebarUnit||"Feet"===a.scalebarUnit)l="esriMeters",g="esriFeet";var w={esriMiles:"mi",esriKilometers:"km",esriFeet:"ft",esriMeters:"m"};
w={titleText:a.titleText,authorText:a.authorText,copyrightText:a.copyrightText,customTextElements:a.customTextElements,scaleBarOptions:{metricUnit:l,metricLabel:w[l],nonMetricUnit:g,nonMetricLabel:w[g]},legendOptions:{operationalLayers:G}}}l=this._getPrintDefinition(h.map,R);h.outSpatialReference&&(l.mapOptions.spatialReference=h.outSpatialReference.toJson());h.template&&q.isDefined(h.template.showAttribution)&&(l.mapOptions.showAttribution=h.template.showAttribution);I.mixin(l,{exportOptions:u,layoutOptions:w});
this.allLayerslegend&&I.mixin(l.layoutOptions,{legendOptions:{operationalLayers:this.allLayerslegend}});if(l.operationalLayers){u=l.operationalLayers;var M=function(T){return q.fixJson(I.mixin(T,{type:"esriSLS",cap:void 0,join:void 0,meterLimit:void 0}))},Y=/[\u4E00-\u9FFF\u0E00-\u0E7F\u0900-\u097F\u3040-\u309F\u30A0-\u30FF\u31F0-\u31FF]/,W=/[\u0600-\u06FF]/,aa=function(T){var X=T.text,Z=(T=T.font)&&T.family&&T.family.toLowerCase();X&&T&&("arial"===Z||"arial unicode ms"===Z)&&(T.family=Y.test(X)?
"Arial Unicode MS":"Arial","normal"!==T.style&&W.test(X)&&(T.family="Arial Unicode MS"))};for(w=0;w<u.length;w++)if(u[w].featureCollection&&u[w].featureCollection.layers)for(g=0;g<u[w].featureCollection.layers.length;g++){var ea=u[w].featureCollection.layers[g];if(ea.layerDefinition&&ea.layerDefinition.drawingInfo&&ea.layerDefinition.drawingInfo.renderer&&ea.layerDefinition.drawingInfo.renderer.symbol){var fa=ea.layerDefinition.drawingInfo.renderer;"esriCLS"===fa.symbol.type?fa.symbol=M(fa.symbol):
"esriTS"===fa.symbol.type?aa(fa.symbol):fa.symbol.outline&&"esriCLS"===fa.symbol.outline.type&&(fa.symbol.outline=M(fa.symbol.outline))}if(ea.featureSet&&ea.featureSet.features)for(a=0;a<ea.featureSet.features.length;a++)fa=ea.featureSet.features[a],fa.symbol&&("esriCLS"===fa.symbol.type?fa.symbol=M(fa.symbol):"esriTS"===fa.symbol.type?aa(fa.symbol):fa.symbol.outline&&"esriCLS"===fa.symbol.outline.type&&(fa.symbol.outline=M(fa.symbol.outline)))}}R={Web_Map_as_JSON:V.toJson(q.fixJson(l)),Format:R.format,
Layout_Template:R.layout};h.extraParameters&&(R=I.mixin(R,h.extraParameters));var S=new J(v._dfdCanceller);h=function(T,X){E(T,X,B,N,S)};l=function(T){O(T,N,S)};S._pendingDfd=this.async?this.printGp.submitJob(R,h,null,l):this.printGp.execute(R,h,l);return S},onComplete:function(){},_createMultipointLayer:function(){return{layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",features:[]}}},_createPolygonLayer:function(){return{layerDefinition:{name:"polygonLayer",
geometryType:"esriGeometryPolygon",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolygon",features:[]}}},_createPointLayer:function(){return{layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}}},_createPolylineLayer:function(){return{layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",
features:[]}}},_convertSvgSymbol:function(h){if(!(8>=x("ie")||!h.path&&"image/svg+xml"!==h.contentType)){var B=K.createSurface(F.create("div"),1024,1024);var N="image/svg+xml"===h.contentType?B.createObject(K.Image,{src:"data:image/svg+xml;base64,"+h.imageData,width:z.pt2px(h.width),height:z.pt2px(h.height),x:0,y:0}):B.createObject(K.Path,h.path).setFill(h.color).setStroke(h.outline);"pendingRender"in B&&B._render(!0);var E=B.rawNode.getContext("2d"),O=Math.ceil(N.getBoundingBox().width),R=Math.ceil(N.getBoundingBox().height);
N=E.getImageData(N.getBoundingBox().x,N.getBoundingBox().y,O,R);E.canvas.width=O;E.canvas.height=R;E.putImageData(N,0,0);E=E.canvas.toDataURL("image/png");h={type:"esriPMS",imageData:E.substr(22,E.length),angle:h.angle,contentType:"image/png",height:h.size?h.size:z.px2pt(R),width:h.size?O/R*h.size:z.px2pt(O),xoffset:h.xoffset,yoffset:h.yoffset};B.destroy();return h}},_convertSvgRenderer:function(h){"simple"===h.type&&h.symbol&&(h.symbol.path||"image/svg+xml"===h.symbol.contentType)?h.symbol=this._convertSvgSymbol(h.symbol):
"uniqueValue"===h.type?(h.defaultSymbol&&(h.defaultSymbol.path||"image/svg+xml"===h.defaultSymbol.contentType)&&(h.defaultSymbol=this._convertSvgSymbol(h.defaultSymbol)),h.uniqueValueInfos&&P.forEach(h.uniqueValueInfos,function(B){if(B.symbol.path||"image/svg+xml"===B.symbol.contentType)B.symbol=this._convertSvgSymbol(B.symbol)},this)):"classBreaks"===h.type&&(h.defaultSymbol&&(h.defaultSymbol.path||"image/svg+xml"===h.defaultSymbol.contentType)&&(h.defaultSymbol=this._convertSvgSymbol(h.defaultSymbol)),
h.classBreakInfos&&P.forEach(h.classBreakInfos,function(B){if(B.symbol.path||"image/svg+xml"===B.symbol.contentType)B.symbol=this._convertSvgSymbol(B.symbol)},this))},_createFeatureCollection:function(h,B,N,E){var O=this._createPolygonLayer(),R=this._createPolylineLayer(),a=this._createPointLayer(),u=this._createMultipointLayer(),G=this._createPointLayer();G.layerDefinition.name="textLayer";delete G.layerDefinition.drawingInfo;if("esri.layers.FeatureLayer"===h.declaredClass||"esri.layers.StreamLayer"===
h.declaredClass)O.layerDefinition.name=R.layerDefinition.name=a.layerDefinition.name=u.layerDefinition.name=I.getObject("arcgisProps.title",!1,h)||h.name||h.id;var l=h.renderer&&"esri.renderer.SimpleRenderer"===h.renderer.declaredClass;if(!h.renderer||h.renderer.valueExpression||I.isFunction(h.renderer.attributeField))delete O.layerDefinition.drawingInfo,delete R.layerDefinition.drawingInfo,delete a.layerDefinition.drawingInfo,delete u.layerDefinition.drawingInfo;else{var g=h.renderer.toJson({useLegacyRotationProperties:!0});
if("temporal"===g.type){g={latestObservationRenderer:g.latestObservationRenderer,trackLinesRenderer:g.trackRenderer,observationAger:g.observationAger,renderer:g.observationRenderer};var w={};h._trackIdField&&(w.trackIdField=h._trackIdField);h._startTimeField&&(w.startTimeField=h._startTimeField);h._endTimeField&&(w.endTimeField=h._endTimeField);O.layerDefinition.drawingInfo=g;O.layerDefinition.timeInfo=w;R.layerDefinition.drawingInfo=g;R.layerDefinition.timeInfo=w;a.layerDefinition.drawingInfo=g;
a.layerDefinition.timeInfo=w;u.layerDefinition.drawingInfo=g;u.layerDefinition.timeInfo=w}else O.layerDefinition.drawingInfo.renderer=g,R.layerDefinition.drawingInfo.renderer=g,a.layerDefinition.drawingInfo.renderer=g,u.layerDefinition.drawingInfo.renderer=g}g=h.fields;g||!h.renderer||h.renderer.valueExpression||I.isFunction(h.renderer.attributeField)||("esri.renderer.ClassBreaksRenderer"===h.renderer.declaredClass?(g=[{name:h.renderer.attributeField,type:"esriFieldTypeDouble"}],h.renderer.normalizationField&&
g.push({name:h.renderer.normalizationField,type:"esriFieldTypeDouble"})):"esri.renderer.UniqueValueRenderer"===h.renderer.declaredClass&&(g=[{name:h.renderer.attributeField,type:"esriFieldTypeString"}],h.renderer.attributeField2&&g.push({name:h.renderer.attributeField2,type:"esriFieldTypeString"}),h.renderer.attributeField3&&g.push({name:h.renderer.attributeField3,type:"esriFieldTypeString"})));g&&(O.layerDefinition.fields=g,R.layerDefinition.fields=g,a.layerDefinition.fields=g,u.layerDefinition.fields=
g);g=h.graphics;h.isFeatureReductionActive&&h.isFeatureReductionActive()&&(g=h.getSingleGraphics());w=g.length;var M;for(M=0;M<w;M++){var Y=g[M];if(!1!==Y.visible&&Y.geometry){var W=Y.toJson();W.symbol&&W.symbol.outline&&W.symbol.outline.color&&W.symbol.outline.color[3]&&!this._is11xService&&(W.symbol.outline.color[3]=255);if(h.renderer&&!W.symbol&&(I.isFunction(h.renderer.attributeField)||h.renderer.valueExpression||this._isFeatureCollectionRequired(h.renderer,h)||"esri.renderer.DotDensityRenderer"===
h.renderer.declaredClass||N)){N=N||h.renderer;var aa=null;try{aa=N.getSymbol(Y)}catch(ea){}if(!aa)continue;W.symbol=aa.toJson();this._isFeatureCollectionRequired(N,h)&&this._applyVisualVariables(W.symbol,{renderer:N,graphic:Y,symbol:aa,mapResolution:B&&B.getResolutionInMeters(),mapScale:B&&B.getScale()})}W.symbol&&(W.symbol.path||"image/svg+xml"===W.symbol.contentType?W.symbol=this._convertSvgSymbol(W.symbol):W.symbol.text&&delete W.attributes);switch(Y.geometry.type){case "polygon":O.featureSet.features.push(W);
break;case "polyline":R.featureSet.features.push(W);break;case "point":W.symbol&&W.symbol.text?G.featureSet.features.push(W):a.featureSet.features.push(W);break;case "multipoint":u.featureSet.features.push(W);break;case "extent":W.geometry=m.fromExtent(Y.geometry).toJson(),O.featureSet.features.push(W)}}}B=[];0<O.featureSet.features.length&&B.push(O);0<R.featureSet.features.length&&B.push(R);0<u.featureSet.features.length&&B.push(u);0<a.featureSet.features.length&&B.push(a);0<G.featureSet.features.length&&
B.push(G);if(!B.length)return null;P.forEach(B,function(ea){var fa=P.every(ea.featureSet.features,function(S){return S.symbol});if(l||fa)E&&E.forceFeatureAttributes||P.forEach(ea.featureSet.features,function(S){delete S.attributes}),E.forceFeatureAttributes||delete ea.layerDefinition.fields;fa&&delete ea.layerDefinition.drawingInfo});P.forEach(B,function(ea){ea.layerDefinition.drawingInfo&&ea.layerDefinition.drawingInfo.renderer&&this._convertSvgRenderer(ea.layerDefinition.drawingInfo.renderer)},
this);return{id:h.id,opacity:h.opacity,minScale:h.minScale||0,maxScale:h.maxScale||0,featureCollection:{layers:B}}},_getPrintDefinition:function(h,B){var N={operationalLayers:this._createOperationalLayers(h,B)},E=this._vtlExtent||h.extent,O=h.spatialReference;this._vtlExtent=null;h.spatialReference._isWrappable()&&(E=E._normalize(!0),O=E.spatialReference);E={mapOptions:{showAttribution:h.showAttribution,extent:E.toJson(),spatialReference:O.toJson()}};B.preserveScale&&I.mixin(E.mapOptions,{scale:B.outScale||
h.getScale()});h.timeExtent&&I.mixin(E.mapOptions,{time:[h.timeExtent.startTime.getTime(),h.timeExtent.endTime.getTime()]});h={};I.mixin(h,E,N);return h},_createOperationalLayers:function(h,B){var N,E=[],O=0;B.preserveScale&&(O=B.outScale||h.getScale());this.allLayerslegend=this.legendAll?[]:null;this._vtlExtent=null;var R=P.map(h.layerIds,h.getLayer,h);h._mapImageLyr&&R.push(h._mapImageLyr);for(N=0;N<R.length;N++){var a=R[N];if(a.loaded&&a.visible&&(!O||a.isVisibleAtScale(O))){var u=a.declaredClass;
var G={id:a.id,title:I.getObject("arcgisProps.title",!1,a)||a.id,opacity:a.opacity,minScale:a.minScale||0,maxScale:a.maxScale||0};G=I.mixin(G,this._getUrlAndToken(a));a.getNode()&&C.get(a.getNode(),"data-reference")&&(G._isRefLayer=!0);switch(u){case "esri.layers.ArcGISDynamicMapServiceLayer":var l=[];u=!!a._params.layers;if(a._params.dynamicLayers)u=B.outScale?a._getDynLayerObjs(B.outScale):V.fromJson(a._params.dynamicLayers),P.forEach(u,function(W){l.push({id:W.id,name:W.name,layerDefinition:W});
delete W.id;delete W.name;delete W.maxScale;delete W.minScale}),0===l.length&&(G.visibleLayers=[-1]);else if(a.supportsDynamicLayers){if(u||a.layerDefinitions||a.layerTimeOptions){var g=a.createDynamicLayerInfosFromLayerInfos(),w=null;u&&(w=a.visibleLayers);w=t._getVisibleLayers(g,w);var M=t._getLayersForScale(B.outScale||h.getScale(),g);P.forEach(g,function(W){if(!W.subLayerIds){var aa=W.id;-1<P.indexOf(w,aa)&&-1<P.indexOf(M,aa)&&(W={source:W.source.toJson()},a.layerDefinitions&&a.layerDefinitions[aa]&&
(W.definitionExpression=a.layerDefinitions[aa]),a.layerTimeOptions&&a.layerTimeOptions[aa]&&(W.layerTimeOptions=a.layerTimeOptions[aa].toJson()),l.push({id:aa,layerDefinition:W}))}});0===l.length&&(G.visibleLayers=[-1])}}else P.forEach(a.layerInfos,function(W){var aa={id:W.id,layerDefinition:{}};a.layerDefinitions&&a.layerDefinitions[W.id]&&(aa.layerDefinition.definitionExpression=a.layerDefinitions[W.id]);a.layerTimeOptions&&a.layerTimeOptions[W.id]&&(aa.layerDefinition.layerTimeOptions=a.layerTimeOptions[W.id].toJson());
(aa.layerDefinition.definitionExpression||aa.layerDefinition.layerTimeOptions)&&l.push(aa)}),u&&(G.visibleLayers=a.visibleLayers.length?a.visibleLayers:[-1]);l.length&&(G.layers=l);E.push(G);this.allLayerslegend&&this.allLayerslegend.push({id:a.id,subLayerIds:a.visibleLayers});break;case "esri.layers.ArcGISImageServiceLayer":G=I.mixin(G,{url:a.url,bandIds:a.bandIds,compressionQuality:a.compressionQuality,format:a.format,interpolation:a.interpolation});a.mosaicRule&&I.mixin(G,{mosaicRule:a.mosaicRule.toJson()});
if(a.renderingRule||a.renderer)this._is11xService?(a.renderingRule&&(G.renderingRule=a.renderingRule.toJson()),a.renderer&&(G.layerDefinition=G.layerDefinition||{},G.layerDefinition.drawingInfo=G.layerDefinition.drawingInfo||{},G.layerDefinition.drawingInfo.renderer=a.renderer.toJson())):(u=a.getExportImageRenderingRule())&&I.mixin(G,{renderingRule:u.toJson()});E.push(G);this.allLayerslegend&&this.allLayerslegend.push({id:a.id});break;case "esri.layers.RasterXLayer":this._is11xService&&(G=I.mixin(G,
{url:a.url,bandIds:a.bandIds,interpolation:a.interpolation}),a.renderer&&(G.layerDefinition=G.layerDefinition||{},G.layerDefinition.drawingInfo=G.layerDefinition.drawingInfo||{},G.layerDefinition.drawingInfo.renderer=a.renderer.toJson()),E.push(G),this.allLayerslegend&&this.allLayerslegend.push({id:a.id}));break;case "esri.layers.WMSLayer":G=I.mixin(G,{url:a.url,title:a.title,type:"wms",version:a.version,transparentBackground:a.imageTransparency,visibleLayers:a.visibleLayers});E.push(G);this.allLayerslegend&&
this.allLayerslegend.push({id:a.id,subLayerIds:a.visibleLayers});break;case "esri.virtualearth.VETiledLayer":u=a.mapStyle;"roadOnDemand"===u?u="Road":"aerialWithLabelsOnDemand"===u&&(u="Hybrid");G=I.mixin(G,{visibility:a.visible,type:"BingMaps"+u,culture:a.culture,key:a.bingMapsKey});E.push(G);break;case "esri.layers.OpenStreetMapLayer":G=I.mixin(G,{credits:a.copyright,type:"OpenStreetMap",url:b.getAbsoluteUrl(a.tileServers[0])});E.push(G);break;case "esri.layers.WMTSLayer":G=I.mixin(G,{url:a.url,
type:"wmts",layer:a._identifier,style:a._style,format:a.format,tileMatrixSet:a._tileMatrixSetId});E.push(G);break;case "esri.layers.MapImageLayer":u=a.getImages();P.forEach(u,function(W,aa){W.visible&&W.href&&(G={id:a.id+"_image"+aa,type:"image",title:a.id,minScale:a.minScale||0,maxScale:a.maxScale||0,opacity:a.opacity*W.opacity,extent:W.extent.toJson()},"data:image/png;base64,"===W.href.substr(0,22)?G.imageData=W.href.substr(22):G.url=W.href,E.push(G))});break;case "esri.layers.VectorTileLayer":delete G.url;
delete G.token;if(this._is11xService&&a.currentStyleInfo.serviceUrl&&a.currentStyleInfo.styleUrl&&(u=n.id&&n.id.findCredential(a.currentStyleInfo.styleUrl),g=n.id&&n.id.findCredential(a.currentStyleInfo.serviceUrl),!u&&!g||"2.1.0"!==this._cimVersion)){G.type="VectorTileLayer";G.styleUrl=a.currentStyleInfo.styleUrl;u&&(G.token=u.token);g&&g.token!==G.token&&(G.additionalTokens=[{url:a.currentStyleInfo.serviceUrl,token:g.token}]);E.push(G);break}G.type="image";u=this._vtlExtent||h.extent.offset(0,0);
var Y=B.exportOptions&&B.exportOptions.dpi||96;g={format:"png",pixelRatio:Y/96};"MAP_ONLY"!==B.layout||!B.preserveScale||B.outScale&&B.outScale!==h.getScale()||96!==Y||!B.exportOptions||B.exportOptions.width%2===h.width%2&&B.exportOptions.height%2===h.height%2||(g.area={x:0,y:0,width:h.width,height:h.height},B.exportOptions.width%2!==h.width%2&&--g.area.width,B.exportOptions.height%2!==h.height%2&&--g.area.height,this._vtlExtent||(Y=h.toMap({x:g.area.width,y:g.area.height}),u.update(u.xmin,Y.y,Y.x,
u.ymax,u.spatialReference),this._vtlExtent=u));G.extent=u._normalize(!0).toJson();u=a.takeScreenshot(g);u.isResolved()?u.then(function(W){"data:image/png;base64,"===W.dataURL.substr(0,22)&&(G.imageData=W.dataURL.substr(22))}):console.error("PrintTask: VectorTileLayer.takeScreenshot() returned an unresolved Promise");G.imageData&&E.push(G);break;case "esri.layers.WebTiledLayer":u=a.url.replace(/\$\{/g,"{");G=I.mixin(G,{type:"WebTiledLayer",urlTemplate:u,credits:a.copyright});a.subDomains&&0<a.subDomains.length&&
(G.subDomains=a.subDomains);a._wmtsInfo&&(G.wmtsInfo=a._wmtsInfo);delete G.url;E.push(G);break;default:if(a.getTileUrl||a.getImageUrl)G=I.mixin(G,{url:a.url}),E.push(G)}}}R=P.map(h.graphicsLayerIds,h.getLayer,h);for(N=0;N<R.length;N++)a=R[N],a.isFeatureReductionActive&&a.isFeatureReductionActive()&&(a.getSingleGraphics().length?R.splice(++N,0,a.getFeatureReductionLayer()):R[N]=a.getFeatureReductionLayer());for(N=0;N<R.length;N++)if(a=R[N],a.loaded&&a.visible&&(!O||a.isVisibleAtScale(O)))switch(u=
a.declaredClass,u){case "esri.layers.CSVLayer":if(this._is11xService){G={id:a.id,url:a.url,title:a.title,opacity:a.opacity,minScale:a.minScale||0,maxScale:a.maxScale||0,type:"CSV",locationInfo:{latitudeFieldName:a.latitudeFieldName,longitudeFieldName:a.longitudeFieldName},layerDefinition:{drawingInfo:{renderer:a.renderer&&a.renderer.toJson({useLegacyRotationProperties:!0})}}};E.push(G);break}case "esri.layers.FeatureLayer":case "esri.layers.LabelLayer":case "esri.layers.StreamLayer":if("esri.layers.LabelLayer"===
u&&!B.showLabels||a.renderer&&"esri.renderer.HeatmapRenderer"===a.renderer.declaredClass)continue;u=null;a.url&&a.renderer&&("esri.renderer.ScaleDependentRenderer"===a.renderer.declaredClass?"scale"===a.renderer.rangeType?u=a.renderer.getRendererInfoByScale(h.getScale())&&a.renderer.getRendererInfoByScale(h.getScale()).renderer:"zoom"===a.renderer.rangeType&&(u=a.renderer.getRendererInfoByZoom(h.getZoom())&&a.renderer.getRendererInfoByZoom(h.getZoom()).renderer):u=a.renderer);g=u&&"esri.layers.CSVLayer"!==
a.declaredClass&&!this._isFeatureCollectionRequired(u,a)&&!u.valueExpression;Y=a.isFeatureReductionActive&&a.isFeatureReductionActive();if(u&&!Y&&"esri.renderer.DotDensityRenderer"!==u.declaredClass&&"esri.layers.StreamLayer"!==a.declaredClass&&(this._is11xService||g)&&("esri.renderer.SimpleRenderer"===u.declaredClass||"esri.renderer.TemporalRenderer"===u.declaredClass||null==u.attributeField||I.isString(u.attributeField)&&a._getField(u.attributeField,!0)))if(G={id:a.id,title:I.getObject("arcgisProps.title",
!1,a)||a.id,opacity:a.opacity,minScale:a.minScale||0,maxScale:a.maxScale||0,layerDefinition:{drawingInfo:{renderer:u.toJson({useLegacyRotationProperties:!0})}}},G=I.mixin(G,this._getUrlAndToken(a)),"esri.renderer.TemporalRenderer"===u.declaredClass&&(g=G.layerDefinition.drawingInfo,g.latestObservationRenderer=g.renderer.latestObservationRenderer,g.trackLinesRenderer=g.renderer.trackRenderer,g.observationAger=g.renderer.observationAger,g.renderer=g.renderer.observationRenderer,a._trackIdField&&(G.layerDefinition.timeInfo=
{trackIdField:a._trackIdField})),this._convertSvgRenderer(G.layerDefinition.drawingInfo.renderer),this._is11xService||1>a.opacity||"esri.renderer.TemporalRenderer"===u.declaredClass||this._updateLayerOpacity(G))if(a._params.source&&(u=a._params.source.toJson(),I.mixin(G.layerDefinition,{source:u})),a.getDefinitionExpression()&&I.mixin(G.layerDefinition,{definitionExpression:a.getDefinitionExpression()}),2!==a.mode)0<a.getSelectedFeatures().length&&(u=P.map(a.getSelectedFeatures(),function(W){return W.attributes[a.objectIdField]}),
0<u.length&&a.getSelectionSymbol()&&I.mixin(G,{selectionObjectIds:u,selectionSymbol:a.getSelectionSymbol().toJson()}));else{u=P.map(a.getSelectedFeatures(),function(W){return W.attributes[a.objectIdField]});if(0===u.length||!a._params.drawMode)break;I.mixin(G.layerDefinition,{objectIds:u});u=null;a.getSelectionSymbol()&&(u=new k(a.getSelectionSymbol()));I.mixin(G.layerDefinition.drawingInfo,{renderer:u&&u.toJson()})}else G=this._createFeatureCollection(a,h,null,B);else G=u&&(u.valueExpression||this._isFeatureCollectionRequired(u,
a)||"esri.renderer.DotDensityRenderer"===u.declaredClass)?this._createFeatureCollection(a,h,u,B):this._createFeatureCollection(a,h,null,B);if(!G)continue;E.push(G);this.allLayerslegend&&this.allLayerslegend.push({id:a.id});break;case "esri.layers._GraphicsLayer":case "esri.layers.GraphicsLayer":case "esri.layers.WFSLayer":G=this._createFeatureCollection(a,h,null,B);if(!G)continue;E.push(G);this.allLayerslegend&&this.allLayerslegend.push({id:a.id});break;case "esri.layers.ArcGISImageServiceVectorLayer":G=
{id:a.id,title:I.getObject("arcgisProps.title",!1,a)||a.id,opacity:a.opacity,minScale:a.minScale||0,maxScale:a.maxScale||0,visibility:a.visible,symbolTileSize:a.symbolTileSize,layerDefinition:{drawingInfo:{renderer:a.renderer.toJson({useLegacyRotationProperties:!0})}}},G=I.mixin(G,this._getUrlAndToken(a)),a.mosaicRule&&I.mixin(G,{mosaicRule:a.mosaicRule.toJson()}),E.push(G),this.allLayerslegend&&this.allLayerslegend.push({id:a.id})}O&&P.forEach(E,function(W){W.minScale=0;W.maxScale=0});h.graphics&&
0<h.graphics.graphics.length&&(G=this._createFeatureCollection(h.graphics,h,null,B))&&E.push(G);h._labels&&B.showLabels&&(G=this._createFeatureCollection(h._labels,h,null,B))&&E.push(G);P.forEach(E,function(W,aa,ea){W._isRefLayer&&(delete W._isRefLayer,ea.splice(aa,1),ea.push(W))});return E},_getUrlAndToken:function(h){return{token:h._getToken(),url:h._url?h._url.path:null}},_updateLayerOpacity:function(h){var B=this._colorEvaluator(h);B=P.filter(B,function(R){return I.isArray(R)&&4===R.length});
var N=!0;if(B.length){var E=B[0][3],O;for(O=1;O<B.length;O++)if(E!==B[O][3]){N=!1;break}if(N)for(h.opacity=E/255,O=0;O<B.length;O++)B[O][3]=255}return N},_isFeatureCollectionRequired:function(h,B){if(B&&B.isFeatureReductionActive&&B.isFeatureReductionActive())return!0;var N=!1;if(B=this._getVariable(h,"rotationInfo",!1))N=(N=B.field)&&I.isFunction(N)||B.valueExpression;return h.hasVisualVariables("sizeInfo")||h.hasVisualVariables("colorInfo")||h.hasVisualVariables("opacityInfo")||N},_getVariable:function(h,
B,N){if(h)var E=(h=h.getVisualVariablesForType(B,N))&&h[0];return E},_applyVisualVariables:function(h,B){var N=B.renderer,E=B.graphic,O=B.symbol,R=B.mapResolution,a=B.mapScale,u=O.type;if("textsymbol"!==u&&"shieldlabelsymbol"!==u){var G=this._getVariable(N,"sizeInfo",!1),l=this._getVariable(N,"colorInfo",!1),g=this._getVariable(N,"opacityInfo",!1);B=this._getVariable(N,"rotationInfo",!1);O instanceof e&&(G=this._getVariable(N,"sizeInfo","outline")||G);R=G?N.getSize(E,{sizeInfo:G,shape:"simplemarkersymbol"===
u?O.style:null,resolution:R,scale:a}):E.size;null!=R&&("simplemarkersymbol"===u?h.size=z.px2pt(R):"picturemarkersymbol"===u?(a=O.width/O.height*R,h.width=z.px2pt(a),h.height=z.px2pt(R),0!==O.xoffset&&(h.xoffset=z.px2pt(O.xoffset/O.width*a)),0!==O.yoffset&&(h.yoffset=z.px2pt(O.yoffset/O.height*R))):"simplelinesymbol"===u?h.width=z.px2pt(R):h.outline&&(h.outline.width=z.px2pt(R)));l&&(!(O=N.getColor(E,{colorInfo:l}))||"simplemarkersymbol"!==u&&"simplelinesymbol"!==u&&"simplefillsymbol"!==u||(h.color=
H.toJsonColor(O)));g&&(O=N.getOpacity(E,{opacityInfo:g}),null!=O&&h.color&&(h.color[3]=Math.round(255*O)));B&&(N=N.getRotationAngle(E,{rotationInfo:B}))&&(h.angle=-N)}}});x("extend-esri")&&I.setObject("tasks.PrintTask",Q,n);return Q})},"esri/tasks/Geoprocessor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has dojo/io-query ../kernel ../request ../deferredUtils ../geometry/normalizeUtils ./Task ./FeatureSet ./JobInfo ./GPMessage ./LinearUnit ./DataFile ./RasterData ./Date ./ParameterValue ./GPResultImageLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/MapImage".split(" "),
function(Q,I,P,V,J,x,n,q,t,v,H,d,b,m,k,e,c,f,A,C,F,z,K){Q=Q(d,{declaredClass:"esri.tasks.Geoprocessor",_eventMap:{"execute-complete":["results","messages"],"get-result-data-complete":["result"],"get-result-image-complete":["mapImage"],"get-result-image-layer-complete":["layer"],"job-cancel":["jobInfo"],"job-complete":["jobInfo"],"status-update":["jobInfo"]},constructor:function(D){this._jobUpdateHandler=I.hitch(this,this._jobUpdateHandler);this._getJobStatus=I.hitch(this,this._getJobStatus);this._getResultDataHandler=
I.hitch(this,this._getResultDataHandler);this._getResultImageHandler=I.hitch(this,this._getResultImageHandler);this._executeHandler=I.hitch(this,this._executeHandler);this._updateTimers=[];this.registerConnectEvents()},updateDelay:1E3,processSpatialReference:null,outputSpatialReference:null,outSpatialReference:null,setUpdateDelay:function(D){this.updateDelay=D},setProcessSpatialReference:function(D){this.processSpatialReference=D},setOutputSpatialReference:function(D){this._setOutSR(D)},setOutSpatialReference:function(D){this._setOutSR(D)},
__msigns:[{n:"execute",c:3,a:[{i:0,p:["*"]}],e:2,f:1},{n:"submitJob",c:4,a:[{i:0,p:["*"]}],e:3}],_setOutSR:function(D){this.outSpatialReference=this.outputSpatialReference=D},_getOutSR:function(){return this.outSpatialReference||this.outputSpatialReference},_gpEncode:function(D,h,B){for(var N in D){var E=D[N];I.isArray(E)?D[N]=J.toJson(P.map(E,function(O){return this._gpEncode({item:O},!0).item},this)):E instanceof Date&&(D[N]=E.getTime())}return this._encode(D,h,B)},_decode:function(D){var h=D.dataType,
B=new C(D);if(-1!==P.indexOf(["GPBoolean","GPDouble","GPLong","GPString"],h))return B;if("GPLinearUnit"===h)B.value=new e(B.value);else if("GPFeatureRecordSetLayer"===h||"GPRecordSet"===h)B.value=new b(B.value);else if("GPDataFile"===h)B.value=new c(B.value);else if("GPDate"===h)D=B.value,I.isString(D)?B.value=new A({date:D}):B.value=new Date(D);else if("GPRasterData"===h||"GPRasterDataLayer"===h)D=D.value.mapImage,B.value=D?new K(D):new f(B.value);else if(-1!==h.indexOf("GPMultiValue:")){var N=h.split(":")[1];
D=B.value;B.value=P.map(D,function(E){return this._decode({paramName:"_name",dataType:N,value:E}).value},this)}else console.log(this.declaredClass+" : GP Data type not handled. : "+B.dataType),B=null;return B},submitJob:function(D,h,B,N,E){var O=this._getOutSR(),R=E.assembly;D=this._gpEncode(I.mixin({},this._url.query,{f:"json","env:outSR":O?O.wkid||J.toJson(O.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||J.toJson(this.processSpatialReference.toJson()):
null},D),null,R&&R[0]);var a=this._jobUpdateHandler,u=this._errorHandler;return t({url:this._url.path+"/submitJob",content:D,callbackParamName:"callback",load:function(G,l){a(G,l,!1,h,B,E.dfd)},error:function(G){u(G,N,E.dfd)}})},_jobUpdateHandler:function(D,h,B,N,E,O){var R=D.jobId;h=new m(D);this._successHandler([h],"onStatusUpdate",E,B&&O);if(!B)switch(clearTimeout(this._updateTimers[R]),this._updateTimers[R]=null,O&&O.progress(h),D.jobStatus){case m.STATUS_SUBMITTED:case m.STATUS_EXECUTING:case m.STATUS_WAITING:case m.STATUS_NEW:var a=
this._getJobStatus;this._updateTimers[R]=setTimeout(function(){a(R,B,N,E,O)},this.updateDelay);break;default:this._successHandler([h],"onJobComplete",N,O)}},_getJobStatus:function(D,h,B,N,E){var O=this._jobUpdateHandler;t({url:this._url.path+"/jobs/"+D,content:I.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(R,a){O(R,a,h,B,N,E)},error:this._errorHandler})},_getResultDataHandler:function(D,h,B,N,E){try{var O=this._decode(D);this._successHandler([O],"onGetResultDataComplete",
B,E)}catch(R){this._errorHandler(R,N,E)}},getResultData:function(D,h,B,N){var E=this._getResultDataHandler,O=this._errorHandler,R=new V(v._dfdCanceller);R._pendingDfd=t({url:this._url.path+"/jobs/"+D+"/results/"+h,content:I.mixin({},this._url.query,{f:"json",returnType:"data"}),callbackParamName:"callback",load:function(a,u){E(a,u,B,N,R)},error:function(a){O(a,N,R)}});return R},checkJobStatus:function(D,h,B){var N=this._jobUpdateHandler,E=this._errorHandler,O=new V(v._dfdCanceller);O._pendingDfd=
t({url:this._url.path+"/jobs/"+D,content:I.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(R,a){N(R,a,!0,null,h,O)},error:function(R){E(R,B,O)}});return O},cancelJob:function(D,h,B){var N=this._errorHandler,E=new V(v._dfdCanceller);E._pendingDfd=t({url:this._url.path+"/jobs/"+D+"/cancel",content:I.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:I.hitch(this,function(O,R){this._successHandler([O],"onJobCancel",h,E)}),error:function(O){N(O,B,E)}});
return E},execute:function(D,h,B,N){var E=this._getOutSR(),O=N.assembly;D=this._gpEncode(I.mixin({},this._url.query,{f:"json","env:outSR":E?E.wkid||J.toJson(E.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||J.toJson(this.processSpatialReference.toJson()):null},D),null,O&&O[0]);var R=this._executeHandler,a=this._errorHandler;return t({url:this._url.path+"/execute",content:D,callbackParamName:"callback",load:function(u,G){R(u,G,h,B,N.dfd)},error:function(u){a(u,
B,N.dfd)}})},_executeHandler:function(D,h,B,N,E){try{var O=D.results,R,a=D.messages;var u=0;for(R=O.length;u<R;u++)O[u]=this._decode(O[u]);u=0;for(R=a.length;u<R;u++)a[u]=new k(a[u]);this._successHandler([O,a],"onExecuteComplete",B,E)}catch(G){this._errorHandler(G,N,E)}},_getResultImageHandler:function(D,h,B,N,E){try{var O=this._decode(D);this._successHandler([O],"onGetResultImageComplete",B,E)}catch(R){this._errorHandler(R,N,E)}},getResultImage:function(D,h,B,N,E){var O=this._getResultImageHandler,
R=this._errorHandler;B=this._gpEncode(I.mixin({},this._url.query,{f:"json"},B.toJson()));var a=new V(v._dfdCanceller);a._pendingDfd=t({url:this._url.path+"/jobs/"+D+"/results/"+h,content:B,callbackParamName:"callback",load:function(u,G){O(u,G,N,E,a)},error:function(u){R(u,E,a)}});return a},cancelJobStatusUpdates:function(D){clearTimeout(this._updateTimers[D]);this._updateTimers[D]=null},getResultImageLayer:function(D,h,B,N){if(null==h){var E=this._url.path.indexOf("/GPServer/");D=this._url.path.substring(0,
E)+"/MapServer/jobs/"+D}else D=this._url.path+"/jobs/"+D+"/results/"+h;this._url.query&&(D+="?"+n.objectToQuery(this._url.query));h=null==h?new z(D,{imageParameters:B}):new F(D,{imageParameters:B},!0);this.onGetResultImageLayerComplete(h);N&&N(h);return h},onStatusUpdate:function(){},onJobComplete:function(){},onExecuteComplete:function(){},onGetResultDataComplete:function(){},onGetResultImageComplete:function(){},onGetResultImageLayerComplete:function(){},onJobCancel:function(){}});H._createWrappers(Q);
x("extend-esri")&&I.setObject("tasks.Geoprocessor",Q,q);return Q})},"esri/tasks/JobInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./GPMessage"],function(Q,I,P,V,J){Q=Q(null,{declaredClass:"esri.tasks.JobInfo",constructor:function(x){this.messages=[];I.mixin(this,x);x=this.messages;var n,q=x.length;for(n=0;n<q;n++)x[n]=new J(x[n])},jobId:"",jobStatus:""});I.mixin(Q,{STATUS_CANCELLED:"esriJobCancelled",STATUS_CANCELLING:"esriJobCancelling",STATUS_DELETED:"esriJobDeleted",
STATUS_DELETING:"esriJobDeleting",STATUS_EXECUTING:"esriJobExecuting",STATUS_FAILED:"esriJobFailed",STATUS_NEW:"esriJobNew",STATUS_SUBMITTED:"esriJobSubmitted",STATUS_SUCCEEDED:"esriJobSucceeded",STATUS_TIMED_OUT:"esriJobTimedOut",STATUS_WAITING:"esriJobWaiting"});P("extend-esri")&&I.setObject("tasks.JobInfo",Q,V);return Q})},"esri/tasks/GPMessage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(Q,I,P,V){Q=Q(null,{declaredClass:"esri.tasks.GPMessage",constructor:function(J){I.mixin(this,
J)}});I.mixin(Q,{TYPE_INFORMATIVE:"esriJobMessageTypeInformative",TYPE_PROCESS_DEFINITION:"esriJobMessageTypeProcessDefinition",TYPE_PROCESS_START:"esriJobMessageTypeProcessStart",TYPE_PROCESS_STOP:"esriJobMessageTypeProcessStop",TYPE_WARNING:"esriJobMessageTypeWarning",TYPE_ERROR:"esriJobMessageTypeError",TYPE_EMPTY:"esriJobMessageTypeEmpty",TYPE_ABORT:"esriJobMessageTypeAbort"});P("extend-esri")&&I.setObject("tasks.GPMessage",Q,V);return Q})},"esri/tasks/LinearUnit":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel"],function(Q,I,P,V){Q=Q(null,{declaredClass:"esri.tasks.LinearUnit",constructor:function(J){J&&I.mixin(this,J)},distance:0,units:null,toJson:function(){var J={};this.distance&&(J.distance=this.distance);this.units&&(J.units=this.units);return J}});P("extend-esri")&&I.setObject("tasks.LinearUnit",Q,V);return Q})},"esri/tasks/DataFile":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(Q,I,P,V){Q=Q(null,{declaredClass:"esri.tasks.DataFile",
constructor:function(J){J&&I.mixin(this,J)},url:null,itemID:null,toJson:function(){var J={};this.url&&(J.url=this.url);this.itemID&&(J.itemID=this.itemID);return J}});P("extend-esri")&&I.setObject("tasks.DataFile",Q,V);return Q})},"esri/tasks/RasterData":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(Q,I,P,V){Q=Q(null,{declaredClass:"esri.tasks.RasterData",constructor:function(J){J&&I.mixin(this,J)},url:null,format:null,itemID:null,toJson:function(){var J=
{};this.url&&(J.url=this.url);this.format&&(J.format=this.format);this.itemID&&(J.itemID=this.itemID);return J}});P("extend-esri")&&I.setObject("tasks.RasterData",Q,V);return Q})},"esri/tasks/Date":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/date/locale","dojo/has","../kernel"],function(Q,I,P,V,J){Q=Q(null,{declaredClass:"esri.tasks.Date",constructor:function(x){x&&(x.format&&(this.format=x.format),this.date=P.parse(x.date,{selector:"date",datePattern:this.format}))},date:new Date,
format:"EEE MMM dd HH:mm:ss zzz yyyy",toJson:function(){return{date:P.format(this.date,{selector:"date",datePattern:this.format}),format:this.format}}});V("extend-esri")&&I.setObject("tasks.Date",Q,J);return Q})},"esri/tasks/ParameterValue":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(Q,I,P,V){Q=Q(null,{declaredClass:"esri.tasks.ParameterValue",constructor:function(J){I.mixin(this,J)}});P("extend-esri")&&I.setObject("tasks.ParameterValue",Q,V);return Q})},
"esri/tasks/GPResultImageLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has dojo/io-query ../kernel ../layers/ArcGISDynamicMapServiceLayer".split(" "),function(Q,I,P,V,J,x,n){Q=Q(n,{declaredClass:"esri.tasks._GPResultImageLayer",constructor:function(q,t){t&&t.imageParameters&&t.imageParameters.extent&&(this.initialExtent=this.fullExtent=t.imageParameters.extent,this.spatialReference=this.initialExtent.spatialReference);this.getImageUrl=I.hitch(this,this.getImageUrl);
this.loaded=!0;this.onLoad(this)},getImageUrl:function(q,t,v,H){var d=q.spatialReference.wkid;H(this._url.path+"?"+J.objectToQuery(I.mixin(this._params,{f:"image",bbox:P.toJson(q.toJson()),bboxSR:d,imageSR:d,size:t+","+v})))}});V("extend-esri")&&I.setObject("tasks._GPResultImageLayer",Q,x);return Q})},"dojox/gfx/canvas":function(){define("./_base dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/_base/window dojo/dom-geometry dojo/dom ./shape ./path ./arc ./matrix ./decompose ./bezierutils".split(" "),
function(Q,I,P,V,J,x,n,q,t,v,H,d,b){function m(l,g,w,M,Y,W,aa,ea,fa,S){var T=g.length,X=0;if(S){var Z=S.l/Y;X=S.i}else Z=g[0]/Y;for(;W<aa;){if(W+Z>aa){var ha={l:(W+Z-aa)*Y,i:X};Z=aa-W}X%2||(l.beginPath(),l.arc(w,M,Y,W,W+Z,ea),fa&&l.stroke());W+=Z;++X;Z=g[X%T]/Y}return ha}function k(l,g,w,M){var Y=0,W=0,aa=0;if(M){var ea=M.l;aa=M.i}else ea=g[0];for(;1>W;)W=b.tAtLength(l,ea),1==W&&(Y=b.computeLength(l),Y={l:ea-Y,i:aa}),l=b.splitBezierAtT(l,W),aa%2||w.push(l[0]),l=l[1],++aa,ea=g[aa%g.length];return Y}
function e(l,g,w,M){var Y=[g.last.x,g.last.y].concat(w),W=!(l instanceof Array);w=4===w.length?"quadraticCurveTo":"bezierCurveTo";var aa=[];g=k(Y,g.canvasDash,aa,M);for(M=0;M<aa.length;++M)Y=aa[M],W?(l.moveTo(Y[0],Y[1]),l[w].apply(l,Y.slice(2))):(l.push("moveTo",[Y[0],Y[1]]),l.push(w,Y.slice(2)));return g}function c(l,g,w,M,Y,W,aa){var ea=0,fa=0,S=0,T=b.distance(w,M,Y,W),X=0;g=g.canvasDash;var Z=w,ha=M,na=!(l instanceof Array);aa?(S=aa.l,X=aa.i):S+=g[0];for(;.01<Math.abs(1-fa);){S>T&&(ea={l:S-T,i:X},
S=T);fa=S/T;aa=w+(Y-w)*fa;var ja=M+(W-M)*fa;X++%2||(na?(l.moveTo(Z,ha),l.lineTo(aa,ja)):(l.push("moveTo",[Z,ha]),l.push("lineTo",[aa,ja])));Z=aa;ha=ja;S+=g[X%g.length]}return ea}var f=Q.canvas={},A=null,C=H.multiplyPoint,F=Math.PI,z=2*F,K=F/2;d=I.extend;if(J.global.CanvasRenderingContext2D){J=J.doc.createElement("canvas").getContext("2d");var D="function"==typeof J.setLineDash,h="function"==typeof J.fillText}var B={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,
1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]};f.Shape=V("dojox.gfx.canvas.Shape",q.Shape,{_render:function(l){l.save();this._renderTransform(l);this._renderClip(l);this._renderShape(l);this._renderFill(l,!0);this._renderStroke(l,!0);l.restore()},_renderClip:function(l){this.canvasClip&&(this.canvasClip.render(l),l.clip())},_renderTransform:function(l){if("canvasTransform"in this){var g=this.canvasTransform;l.translate(g.dx,g.dy);
l.rotate(g.angle2);l.scale(g.sx,g.sy);l.rotate(g.angle1)}},_renderShape:function(l){},_renderFill:function(l,g){if("canvasFill"in this){var w=this.fillStyle;if("canvasFillImage"in this){var M=w.width,Y=w.height,W=this.canvasFillImage.width,aa=this.canvasFillImage.height,ea=Math.min(M==W?1:M/W,Y==aa?1:Y/aa),fa=(M-ea*W)/2,S=(Y-ea*aa)/2;A.width=M;A.height=Y;var T=A.getContext("2d");T.clearRect(0,0,M,Y);T.drawImage(this.canvasFillImage,0,0,W,aa,fa,S,ea*W,ea*aa);this.canvasFill=l.createPattern(A,"repeat");
delete this.canvasFillImage}l.fillStyle=this.canvasFill;g&&("pattern"!==w.type||0===w.x&&0===w.y||l.translate(w.x,w.y),l.fill())}else l.fillStyle="rgba(0,0,0,0.0)"},_renderStroke:function(l,g){var w=this.strokeStyle;w?(l.strokeStyle=w.color.toString(),l.lineWidth=w.width,l.lineCap=w.cap,"number"==typeof w.join?(l.lineJoin="miter",l.miterLimit=w.join):l.lineJoin=w.join,this.canvasDash?D?(l.setLineDash(this.canvasDash),g&&l.stroke()):this._renderDashedStroke(l,g):g&&l.stroke()):g||(l.strokeStyle="rgba(0,0,0,0.0)")},
_renderDashedStroke:function(l,g){},getEventSource:function(){return null},on:function(){},connect:function(){},disconnect:function(){},canvasClip:null,setClip:function(l){this.inherited(arguments);var g=l?"width"in l?"rect":"cx"in l?"ellipse":"points"in l?"polyline":"d"in l?"path":null:null;if(l&&!g)return this;this.canvasClip=l?N(g,l):null;this.parent&&this.parent._makeDirty();return this}});var N=function(l,g){switch(l){case "ellipse":return{canvasEllipse:a({shape:g}),render:function(w){return f.Ellipse.prototype._renderShape.call(this,
w)}};case "rect":return{shape:I.delegate(g,{r:0}),render:function(w){return f.Rect.prototype._renderShape.call(this,w)}};case "path":return{canvasPath:E(g),render:function(w){this.canvasPath._renderShape(w)}};case "polyline":return{canvasPolyline:g.points,render:function(w){return f.Polyline.prototype._renderShape.call(this,w)}}}return null},E=function(l){var g=new dojox.gfx.canvas.Path;g.canvasPath=[];g._setPath(l.d);return g},O=function(l,g,w){var M=l.prototype[g];l.prototype[g]=w?function(){this.parent&&
this.parent._makeDirty();M.apply(this,arguments);w.call(this);return this}:function(){this.parent&&this.parent._makeDirty();return M.apply(this,arguments)}};O(f.Shape,"setTransform",function(){this.matrix?this.canvasTransform=Q.decompose(this.matrix):delete this.canvasTransform});O(f.Shape,"setFill",function(){var l=this.fillStyle;if(l){if("object"==typeof l&&"type"in l){var g=this.surface.rawNode.getContext("2d");switch(l.type){case "linear":case "radial":var w="linear"==l.type?g.createLinearGradient(l.x1,
l.y1,l.x2,l.y2):g.createRadialGradient(l.cx,l.cy,0,l.cx,l.cy,l.r);P.forEach(l.colors,function(M){w.addColorStop(M.offset,Q.normalizeColor(M.color).toString())});break;case "pattern":A||(A=document.createElement("canvas")),g=new Image,this.surface.downloadImage(g,l.src),this.canvasFillImage=g}}else w=l.toString();this.canvasFill=w}else delete this.canvasFill});O(f.Shape,"setStroke",function(){var l=this.strokeStyle;if(l){var g=this.strokeStyle.style.toLowerCase();g in B&&(g=B[g]);if(g instanceof Array){this.canvasDash=
g=g.slice();var w;for(w=0;w<g.length;++w)g[w]*=l.width;if("butt"!=l.cap){for(w=0;w<g.length;w+=2)g[w]-=l.width,1>g[w]&&(g[w]=1);for(w=1;w<g.length;w+=2)g[w]+=l.width}}else delete this.canvasDash}else delete this.canvasDash;this._needsDash=!D&&!!this.canvasDash});O(f.Shape,"setShape");f.Group=V("dojox.gfx.canvas.Group",f.Shape,{constructor:function(){q.Container._init.call(this)},_render:function(l){l.save();this._renderTransform(l);this._renderClip(l);for(var g=0;g<this.children.length;++g)this.children[g]._render(l);
l.restore()},destroy:function(){q.Container.clear.call(this,!0);f.Shape.prototype.destroy.apply(this,arguments)}});f.Rect=V("dojox.gfx.canvas.Rect",[f.Shape,q.Rect],{_renderShape:function(l){var g=this.shape,w=Math.min(g.r,g.height/2,g.width/2),M=g.x,Y=M+g.width,W=g.y;g=W+g.height;var aa=M+w,ea=Y-w,fa=W+w,S=g-w;l.beginPath();l.moveTo(aa,W);w?(l.arc(ea,fa,w,-K,0,!1),l.arc(ea,S,w,0,K,!1),l.arc(aa,S,w,K,F,!1),l.arc(aa,fa,w,F,F+K,!1)):(l.lineTo(ea,W),l.lineTo(Y,S),l.lineTo(aa,g),l.lineTo(M,fa));l.closePath()},
_renderDashedStroke:function(l,g){var w=this.shape,M=Math.min(w.r,w.height/2,w.width/2),Y=w.x,W=Y+w.width,aa=w.y,ea=aa+w.height,fa=Y+M,S=W-M,T=aa+M,X=ea-M;M?(l.beginPath(),w=c(l,this,fa,aa,S,aa),g&&l.stroke(),w=m(l,this.canvasDash,S,T,M,-K,0,!1,g,w),l.beginPath(),w=c(l,this,W,T,W,X,w),g&&l.stroke(),w=m(l,this.canvasDash,S,X,M,0,K,!1,g,w),l.beginPath(),w=c(l,this,S,ea,fa,ea,w),g&&l.stroke(),w=m(l,this.canvasDash,fa,X,M,K,F,!1,g,w),l.beginPath(),w=c(l,this,Y,X,Y,T,w),g&&l.stroke(),m(l,this.canvasDash,
fa,T,M,F,F+K,!1,g,w)):(l.beginPath(),w=c(l,this,fa,aa,S,aa),w=c(l,this,S,aa,W,X,w),w=c(l,this,W,X,fa,ea,w),c(l,this,fa,ea,Y,T,w),g&&l.stroke())}});var R=[];(function(){var l=v.curvePI4;R.push(l.s,l.c1,l.c2,l.e);for(var g=45;360>g;g+=45){var w=H.rotateg(g);R.push(C(w,l.c1),C(w,l.c2),C(w,l.e))}})();var a=function(l){var g=[],w=l.shape,M=H.normalize([H.translate(w.cx,w.cy),H.scale(w.rx,w.ry)]);var Y=C(M,R[0]);g.push([Y.x,Y.y]);for(w=1;w<R.length;w+=3){var W=C(M,R[w]);var aa=C(M,R[w+1]);Y=C(M,R[w+2]);
g.push([W.x,W.y,aa.x,aa.y,Y.x,Y.y])}if(l._needsDash){Y=[];W=g[0];for(w=1;w<g.length;++w)aa=[],k(W.concat(g[w]),l.canvasDash,aa),W=[g[w][4],g[w][5]],Y.push(aa);l._dashedPoints=Y}return g};f.Ellipse=V("dojox.gfx.canvas.Ellipse",[f.Shape,q.Ellipse],{setShape:function(){this.inherited(arguments);this.canvasEllipse=a(this);return this},setStroke:function(){this.inherited(arguments);D||(this.canvasEllipse=a(this));return this},_renderShape:function(l){var g=this.canvasEllipse,w;l.beginPath();l.moveTo.apply(l,
g[0]);for(w=1;w<g.length;++w)l.bezierCurveTo.apply(l,g[w]);l.closePath()},_renderDashedStroke:function(l,g){var w=this._dashedPoints;l.beginPath();for(var M=0;M<w.length;++M)for(var Y=w[M],W=0;W<Y.length;++W){var aa=Y[W];l.moveTo(aa[0],aa[1]);l.bezierCurveTo(aa[2],aa[3],aa[4],aa[5],aa[6],aa[7])}g&&l.stroke()}});f.Circle=V("dojox.gfx.canvas.Circle",[f.Shape,q.Circle],{_renderShape:function(l){var g=this.shape;l.beginPath();l.arc(g.cx,g.cy,g.r,0,z,1)},_renderDashedStroke:function(l,g){var w=this.shape,
M=0,Y=this.canvasDash.length;for(i=0;M<z;){var W=this.canvasDash[i%Y]/w.r;i%2||(l.beginPath(),l.arc(w.cx,w.cy,w.r,M,M+W,0),g&&l.stroke());M+=W;++i}}});f.Line=V("dojox.gfx.canvas.Line",[f.Shape,q.Line],{_renderShape:function(l){var g=this.shape;l.beginPath();l.moveTo(g.x1,g.y1);l.lineTo(g.x2,g.y2)},_renderDashedStroke:function(l,g){var w=this.shape;l.beginPath();c(l,this,w.x1,w.y1,w.x2,w.y2);g&&l.stroke()}});f.Polyline=V("dojox.gfx.canvas.Polyline",[f.Shape,q.Polyline],{setShape:function(){this.inherited(arguments);
var l=this.shape.points,g=l[0],w;this.bbox=null;this._normalizePoints();if(l.length)if("number"==typeof g)g=l;else for(g=[],w=0;w<l.length;++w){var M=l[w];g.push(M.x,M.y)}else g=[];this.canvasPolyline=g;return this},_renderShape:function(l){var g=this.canvasPolyline;if(g.length){l.beginPath();l.moveTo(g[0],g[1]);for(var w=2;w<g.length;w+=2)l.lineTo(g[w],g[w+1])}},_renderDashedStroke:function(l,g){var w=this.canvasPolyline,M=0;l.beginPath();for(var Y=0;Y<w.length;Y+=2)M=c(l,this,w[Y],w[Y+1],w[Y+2],
w[Y+3],M);g&&l.stroke()}});f.Image=V("dojox.gfx.canvas.Image",[f.Shape,q.Image],{setShape:function(){this.inherited(arguments);var l=new Image;this.surface.downloadImage(l,this.shape.src);this.canvasImage=l;return this},_renderShape:function(l){var g=this.shape;l.drawImage(this.canvasImage,g.x,g.y,g.width,g.height)}});f.Text=V("dojox.gfx.canvas.Text",[f.Shape,q.Text],{_setFont:function(){this.fontStyle?this.canvasFont=Q.makeFontString(this.fontStyle):delete this.canvasFont},getTextWidth:function(){var l=
this.shape,g=0;if(l.text){var w=this.surface.rawNode.getContext("2d");w.save();this._renderTransform(w);this._renderFill(w,!1);this._renderStroke(w,!1);this.canvasFont&&(w.font=this.canvasFont);g=w.measureText(l.text).width;w.restore()}return g},_render:function(l){l.save();this._renderTransform(l);this._renderFill(l,!1);this._renderStroke(l,!1);this._renderShape(l);l.restore()},_renderShape:function(l){var g=this.shape;g.text&&(l.textAlign="middle"===g.align?"center":g.align,this.canvasFont&&(l.font=
this.canvasFont),this.canvasFill&&l.fillText(g.text,g.x,g.y),this.strokeStyle&&(l.beginPath(),l.strokeText(g.text,g.x,g.y),l.closePath()))}});O(f.Text,"setFont");h||f.Text.extend({getTextWidth:function(){return 0},getBoundingBox:function(){return null},_renderShape:function(){}});var u={M:"_moveToA",m:"_moveToR",L:"_lineToA",l:"_lineToR",H:"_hLineToA",h:"_hLineToR",V:"_vLineToA",v:"_vLineToR",C:"_curveToA",c:"_curveToR",S:"_smoothCurveToA",s:"_smoothCurveToR",Q:"_qCurveToA",q:"_qCurveToR",T:"_qSmoothCurveToA",
t:"_qSmoothCurveToR",A:"_arcTo",a:"_arcTo",Z:"_closePath",z:"_closePath"};f.Path=V("dojox.gfx.canvas.Path",[f.Shape,t.Path],{constructor:function(){this.lastControl={}},setShape:function(){this.canvasPath=[];this._dashedPath=[];return this.inherited(arguments)},setStroke:function(){this.inherited(arguments);D||(this.segmented=!1,this._confirmSegmented());return this},_setPath:function(){this._dashResidue=null;this.inherited(arguments)},_updateWithSegment:function(l){var g=I.clone(this.last);this[u[l.action]](this.canvasPath,
l.action,l.args,this._needsDash?this._dashedPath:null);this.last=g;this.inherited(arguments)},_renderShape:function(l){var g=this.canvasPath;l.beginPath();for(var w=0;w<g.length;w+=2)l[g[w]].apply(l,g[w+1])},_renderDashedStroke:D?function(){}:function(l,g){var w=this._dashedPath;l.beginPath();for(var M=0;M<w.length;M+=2)l[w[M]].apply(l,w[M+1]);g&&l.stroke()},_moveToA:function(l,g,w,M){l.push("moveTo",[w[0],w[1]]);M&&M.push("moveTo",[w[0],w[1]]);for(g=2;g<w.length;g+=2)l.push("lineTo",[w[g],w[g+1]]),
M&&(this._dashResidue=c(M,this,w[g-2],w[g-1],w[g],w[g+1],this._dashResidue));this.last.x=w[w.length-2];this.last.y=w[w.length-1];this.lastControl={}},_moveToR:function(l,g,w,M){g="x"in this.last?[this.last.x+=w[0],this.last.y+=w[1]]:[this.last.x=w[0],this.last.y=w[1]];l.push("moveTo",g);M&&M.push("moveTo",g);for(g=2;g<w.length;g+=2)l.push("lineTo",[this.last.x+=w[g],this.last.y+=w[g+1]]),M&&(this._dashResidue=c(M,this,M[M.length-1][0],M[M.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl=
{}},_lineToA:function(l,g,w,M){for(g=0;g<w.length;g+=2)M&&(this._dashResidue=c(M,this,this.last.x,this.last.y,w[g],w[g+1],this._dashResidue)),l.push("lineTo",[w[g],w[g+1]]);this.last.x=w[w.length-2];this.last.y=w[w.length-1];this.lastControl={}},_lineToR:function(l,g,w,M){for(g=0;g<w.length;g+=2)l.push("lineTo",[this.last.x+=w[g],this.last.y+=w[g+1]]),M&&(this._dashResidue=c(M,this,M[M.length-1][0],M[M.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_hLineToA:function(l,
g,w,M){for(g=0;g<w.length;++g)l.push("lineTo",[w[g],this.last.y]),M&&(this._dashResidue=c(M,this,M[M.length-1][0],M[M.length-1][1],w[g],this.last.y,this._dashResidue));this.last.x=w[w.length-1];this.lastControl={}},_hLineToR:function(l,g,w,M){for(g=0;g<w.length;++g)l.push("lineTo",[this.last.x+=w[g],this.last.y]),M&&(this._dashResidue=c(M,this,M[M.length-1][0],M[M.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_vLineToA:function(l,g,w,M){for(g=0;g<w.length;++g)l.push("lineTo",
[this.last.x,w[g]]),M&&(this._dashResidue=c(M,this,M[M.length-1][0],M[M.length-1][1],this.last.x,w[g],this._dashResidue));this.last.y=w[w.length-1];this.lastControl={}},_vLineToR:function(l,g,w,M){for(g=0;g<w.length;++g)l.push("lineTo",[this.last.x,this.last.y+=w[g]]),M&&(this._dashResidue=c(M,this,M[M.length-1][0],M[M.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_curveToA:function(l,g,w,M){for(g=0;g<w.length;g+=6)l.push("bezierCurveTo",w.slice(g,g+6)),M&&(this._dashResidue=
e(M,this,l[l.length-1],this._dashResidue));this.last.x=w[w.length-2];this.last.y=w[w.length-1];this.lastControl.x=w[w.length-4];this.lastControl.y=w[w.length-3];this.lastControl.type="C"},_curveToR:function(l,g,w,M){for(g=0;g<w.length;g+=6)l.push("bezierCurveTo",[this.last.x+w[g],this.last.y+w[g+1],this.lastControl.x=this.last.x+w[g+2],this.lastControl.y=this.last.y+w[g+3],this.last.x+w[g+4],this.last.y+w[g+5]]),M&&(this._dashResidue=e(M,this,l[l.length-1],this._dashResidue)),this.last.x+=w[g+4],
this.last.y+=w[g+5];this.lastControl.type="C"},_smoothCurveToA:function(l,g,w,M){for(g=0;g<w.length;g+=4){var Y="C"==this.lastControl.type;l.push("bezierCurveTo",[Y?2*this.last.x-this.lastControl.x:this.last.x,Y?2*this.last.y-this.lastControl.y:this.last.y,w[g],w[g+1],w[g+2],w[g+3]]);M&&(this._dashResidue=e(M,this,l[l.length-1],this._dashResidue));this.lastControl.x=w[g];this.lastControl.y=w[g+1];this.lastControl.type="C"}this.last.x=w[w.length-2];this.last.y=w[w.length-1]},_smoothCurveToR:function(l,
g,w,M){for(g=0;g<w.length;g+=4){var Y="C"==this.lastControl.type;l.push("bezierCurveTo",[Y?2*this.last.x-this.lastControl.x:this.last.x,Y?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+w[g],this.last.y+w[g+1],this.last.x+w[g+2],this.last.y+w[g+3]]);M&&(this._dashResidue=e(M,this,l[l.length-1],this._dashResidue));this.lastControl.x=this.last.x+w[g];this.lastControl.y=this.last.y+w[g+1];this.lastControl.type="C";this.last.x+=w[g+2];this.last.y+=w[g+3]}},_qCurveToA:function(l,g,w,M){for(g=
0;g<w.length;g+=4)l.push("quadraticCurveTo",w.slice(g,g+4));M&&(this._dashResidue=e(M,this,l[l.length-1],this._dashResidue));this.last.x=w[w.length-2];this.last.y=w[w.length-1];this.lastControl.x=w[w.length-4];this.lastControl.y=w[w.length-3];this.lastControl.type="Q"},_qCurveToR:function(l,g,w,M){for(g=0;g<w.length;g+=4)l.push("quadraticCurveTo",[this.lastControl.x=this.last.x+w[g],this.lastControl.y=this.last.y+w[g+1],this.last.x+w[g+2],this.last.y+w[g+3]]),M&&(this._dashResidue=e(M,this,l[l.length-
1],this._dashResidue)),this.last.x+=w[g+2],this.last.y+=w[g+3];this.lastControl.type="Q"},_qSmoothCurveToA:function(l,g,w,M){for(g=0;g<w.length;g+=2){var Y="Q"==this.lastControl.type;l.push("quadraticCurveTo",[this.lastControl.x=Y?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=Y?2*this.last.y-this.lastControl.y:this.last.y,w[g],w[g+1]]);M&&(this._dashResidue=e(M,this,l[l.length-1],this._dashResidue));this.lastControl.type="Q"}this.last.x=w[w.length-2];this.last.y=w[w.length-1]},_qSmoothCurveToR:function(l,
g,w,M){for(g=0;g<w.length;g+=2){var Y="Q"==this.lastControl.type;l.push("quadraticCurveTo",[this.lastControl.x=Y?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=Y?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+w[g],this.last.y+w[g+1]]);M&&(this._dashResidue=e(M,this,l[l.length-1],this._dashResidue));this.lastControl.type="Q";this.last.x+=w[g];this.last.y+=w[g+1]}},_arcTo:function(l,g,w,M){g="a"==g;for(var Y=0;Y<w.length;Y+=7){var W=w[Y+5],aa=w[Y+6];g&&(W+=this.last.x,aa+=
this.last.y);var ea=v.arcAsBezier(this.last,w[Y],w[Y+1],w[Y+2],w[Y+3]?1:0,w[Y+4]?1:0,W,aa);P.forEach(ea,function(fa){l.push("bezierCurveTo",fa)});M&&(this._dashResidue=e(M,this,p,this._dashResidue));this.last.x=W;this.last.y=aa}this.lastControl={}},_closePath:function(l,g,w,M){l.push("closePath",[]);M&&(this._dashResidue=c(M,this,this.last.x,this.last.y,M[1][0],M[1][1],this._dashResidue));this.lastControl={}}});P.forEach("moveTo lineTo hLineTo vLineTo curveTo smoothCurveTo qCurveTo qSmoothCurveTo arcTo closePath".split(" "),
function(l){O(f.Path,l)});f.TextPath=V("dojox.gfx.canvas.TextPath",[f.Shape,t.TextPath],{_renderShape:function(l){},_setText:function(){},_setFont:function(){}});f.Surface=V("dojox.gfx.canvas.Surface",q.Surface,{constructor:function(){q.Container._init.call(this);this.pendingImageCount=0;this.makeDirty()},destroy:function(){q.Container.clear.call(this,!0);this.inherited(arguments)},setDimensions:function(l,g){this.width=Q.normalizedLength(l);this.height=Q.normalizedLength(g);if(!this.rawNode)return this;
l=!1;this.rawNode.width!=this.width&&(this.rawNode.width=this.width,l=!0);this.rawNode.height!=this.height&&(this.rawNode.height=this.height,l=!0);l&&this.makeDirty();return this},getDimensions:function(){return this.rawNode?{width:this.rawNode.width,height:this.rawNode.height}:null},_render:function(l){!this.rawNode||!l&&this.pendingImageCount||(l=this.rawNode.getContext("2d"),l.clearRect(0,0,this.rawNode.width,this.rawNode.height),this.render(l),"pendingRender"in this&&(clearTimeout(this.pendingRender),
delete this.pendingRender))},render:function(l){l.save();for(var g=0;g<this.children.length;++g)this.children[g]._render(l);l.restore()},makeDirty:function(){this.pendingImagesCount||"pendingRender"in this||this._batch||(this.pendingRender=setTimeout(I.hitch(this,this._render),0))},downloadImage:function(l,g){var w=I.hitch(this,this.onImageLoad);!this.pendingImageCount++&&"pendingRender"in this&&(clearTimeout(this.pendingRender),delete this.pendingRender);l.onload=w;l.onerror=w;l.onabort=w;l.src=
g},onImageLoad:function(){--this.pendingImageCount||(this.onImagesLoaded(),this._render())},onImagesLoaded:function(){},getEventSource:function(){return null},connect:function(){},disconnect:function(){},on:function(){}});f.createSurface=function(l,g,w){if(!g&&!w){var M=x.position(l);g=g||M.w;w=w||M.h}"number"==typeof g&&(g+="px");"number"==typeof w&&(w+="px");M=new f.Surface;l=n.byId(l);var Y=l.ownerDocument.createElement("canvas");Y.width=Q.normalizedLength(g);Y.height=Q.normalizedLength(w);l.appendChild(Y);
M.rawNode=Y;M._parent=l;return M.surface=M};var G=q.Container;V={openBatch:function(){++this._batch;return this},closeBatch:function(){this._batch=0<this._batch?--this._batch:0;this._makeDirty();return this},_makeDirty:function(){this._batch||this.surface.makeDirty()},add:function(l){this._makeDirty();return G.add.apply(this,arguments)},remove:function(l,g){this._makeDirty();return G.remove.apply(this,arguments)},clear:function(){this._makeDirty();return G.clear.apply(this,arguments)},getBoundingBox:G.getBoundingBox,
_moveChildToFront:function(l){this._makeDirty();return G._moveChildToFront.apply(this,arguments)},_moveChildToBack:function(l){this._makeDirty();return G._moveChildToBack.apply(this,arguments)}};t={createObject:function(l,g){l=new l;l.surface=this.surface;l.setShape(g);this.add(l);return l}};d(f.Group,V);d(f.Group,q.Creator);d(f.Group,t);d(f.Surface,V);d(f.Surface,q.Creator);d(f.Surface,t);f.fixTarget=function(l,g){return!0};return f})},"dojox/gfx/shape":function(){define("./_base dojo/_base/lang dojo/_base/declare dojo/_base/kernel dojo/_base/sniff dojo/on dojo/_base/array dojo/dom-construct dojo/_base/Color ./matrix".split(" "),
function(Q,I,P,V,J,x,n,q,t,v){function H(b,m){for(var k=b.length-1;m<k;)b[m]=b[++m];b.length=k}var d=Q.shape={};d.Shape=P("dojox.gfx.shape.Shape",null,{constructor:function(){this.parentMatrix=this.parent=this.bbox=this.strokeStyle=this.fillStyle=this.matrix=this.shape=this.rawNode=null;if(J("gfxRegistry")){var b=d.register(this);this.getUID=function(){return b}}},destroy:function(){J("gfxRegistry")&&d.dispose(this);this.rawNode&&"__gfxObject__"in this.rawNode&&(this.rawNode.__gfxObject__=null);this.rawNode=
null},getNode:function(){return this.rawNode},getShape:function(){return this.shape},getTransform:function(){return this.matrix},getFill:function(){return this.fillStyle},getStroke:function(){return this.strokeStyle},getParent:function(){return this.parent},getBoundingBox:function(){return this.bbox},getTransformedBoundingBox:function(){var b=this.getBoundingBox();if(!b)return null;var m=this._getRealMatrix();return[v.multiplyPoint(m,b.x,b.y),v.multiplyPoint(m,b.x+b.width,b.y),v.multiplyPoint(m,b.x+
b.width,b.y+b.height),v.multiplyPoint(m,b.x,b.y+b.height)]},getEventSource:function(){return this.rawNode},setClip:function(b){this.clip=b},getClip:function(){return this.clip},setShape:function(b){this.shape=Q.makeParameters(this.shape,b);this.bbox=null;return this},setFill:function(b){if(!b)return this.fillStyle=null,this;var m=null;if("object"==typeof b&&"type"in b)switch(b.type){case "linear":m=Q.makeParameters(Q.defaultLinearGradient,b);break;case "radial":m=Q.makeParameters(Q.defaultRadialGradient,
b);break;case "pattern":m=Q.makeParameters(Q.defaultPattern,b)}else m=Q.normalizeColor(b);this.fillStyle=m;return this},setStroke:function(b){if(!b)return this.strokeStyle=null,this;if("string"==typeof b||I.isArray(b)||b instanceof t)b={color:b};b=this.strokeStyle=Q.makeParameters(Q.defaultStroke,b);b.color=Q.normalizeColor(b.color);return this},setTransform:function(b){this.matrix=v.clone(b?v.normalize(b):v.identity);return this._applyTransform()},_applyTransform:function(){return this},moveToFront:function(){var b=
this.getParent();b&&(b._moveChildToFront(this),this._moveToFront());return this},moveToBack:function(){var b=this.getParent();b&&(b._moveChildToBack(this),this._moveToBack());return this},_moveToFront:function(){},_moveToBack:function(){},applyRightTransform:function(b){return b?this.setTransform([this.matrix,b]):this},applyLeftTransform:function(b){return b?this.setTransform([b,this.matrix]):this},applyTransform:function(b){return b?this.setTransform([this.matrix,b]):this},removeShape:function(b){this.parent&&
this.parent.remove(this,b);return this},_setParent:function(b,m){this.parent=b;return this._updateParentMatrix(m)},_updateParentMatrix:function(b){this.parentMatrix=b?v.clone(b):null;return this._applyTransform()},_getRealMatrix:function(){for(var b=this.matrix,m=this.parent;m;)m.matrix&&(b=v.multiply(m.matrix,b)),m=m.parent;return b}});d._eventsProcessing={on:function(b,m){return x(this.getEventSource(),b,d.fixCallback(this,Q.fixTarget,m))},connect:function(b,m,k){"on"==b.substring(0,2)&&(b=b.substring(2));
return this.on(b,k?I.hitch(m,k):m)},disconnect:function(b){return b.remove()}};d.fixCallback=function(b,m,k,e){e||(e=k,k=null);if(I.isString(e)){k=k||V.global;if(!k[e])throw['dojox.gfx.shape.fixCallback: scope["',e,'"] is null (scope\x3d"',k,'")'].join("");return function(c){return m(c,b)?k[e].apply(k,arguments||[]):void 0}}return k?function(c){return m(c,b)?e.apply(k,arguments||[]):void 0}:function(c){return m(c,b)?e.apply(k,arguments):void 0}};I.extend(d.Shape,d._eventsProcessing);d.Container={_init:function(){this.children=
[];this._batch=0},openBatch:function(){return this},closeBatch:function(){return this},add:function(b){var m=b.getParent();m&&m.remove(b,!0);this.children.push(b);return b._setParent(this,this._getRealMatrix())},remove:function(b,m){for(var k=0;k<this.children.length;++k)if(this.children[k]==b){m||(b.parent=null,b.parentMatrix=null);H(this.children,k);break}return this},clear:function(b){for(var m,k=0;k<this.children.length;++k)m=this.children[k],m.parent=null,m.parentMatrix=null,b&&m.destroy();this.children=
[];return this},getBoundingBox:function(){if(this.children){var b=null;n.forEach(this.children,function(m){var k=m.getBoundingBox();k&&((m=m.getTransform())&&(k=v.multiplyRectangle(m,k)),b?(b.x=Math.min(b.x,k.x),b.y=Math.min(b.y,k.y),b.endX=Math.max(b.endX,k.x+k.width),b.endY=Math.max(b.endY,k.y+k.height)):b={x:k.x,y:k.y,endX:k.x+k.width,endY:k.y+k.height})});b&&(b.width=b.endX-b.x,b.height=b.endY-b.y);return b}return null},_moveChildToFront:function(b){for(var m=0;m<this.children.length;++m)if(this.children[m]==
b){H(this.children,m);this.children.push(b);break}return this},_moveChildToBack:function(b){for(var m=0;m<this.children.length;++m)if(this.children[m]==b){H(this.children,m);this.children.unshift(b);break}return this}};d.Surface=P("dojox.gfx.shape.Surface",null,{constructor:function(){this._parent=this.rawNode=null;this._nodes=[];this._events=[]},destroy:function(){n.forEach(this._nodes,q.destroy);this._nodes=[];n.forEach(this._events,function(b){b&&b.remove()});this._events=[];this.rawNode=null;
if(J("ie"))for(;this._parent.lastChild;)q.destroy(this._parent.lastChild);else this._parent.innerHTML="";this._parent=null},getEventSource:function(){return this.rawNode},_getRealMatrix:function(){return null},isLoaded:!0,onLoad:function(b){},whenLoaded:function(b,m){var k=I.hitch(b,m);if(this.isLoaded)k(this);else x.once(this,"load",function(e){k(e)})}});I.extend(d.Surface,d._eventsProcessing);d.Rect=P("dojox.gfx.shape.Rect",d.Shape,{constructor:function(b){this.shape=Q.getDefault("Rect");this.rawNode=
b},getBoundingBox:function(){return this.shape}});d.Ellipse=P("dojox.gfx.shape.Ellipse",d.Shape,{constructor:function(b){this.shape=Q.getDefault("Ellipse");this.rawNode=b},getBoundingBox:function(){if(!this.bbox){var b=this.shape;this.bbox={x:b.cx-b.rx,y:b.cy-b.ry,width:2*b.rx,height:2*b.ry}}return this.bbox}});d.Circle=P("dojox.gfx.shape.Circle",d.Shape,{constructor:function(b){this.shape=Q.getDefault("Circle");this.rawNode=b},getBoundingBox:function(){if(!this.bbox){var b=this.shape;this.bbox={x:b.cx-
b.r,y:b.cy-b.r,width:2*b.r,height:2*b.r}}return this.bbox}});d.Line=P("dojox.gfx.shape.Line",d.Shape,{constructor:function(b){this.shape=Q.getDefault("Line");this.rawNode=b},getBoundingBox:function(){if(!this.bbox){var b=this.shape;this.bbox={x:Math.min(b.x1,b.x2),y:Math.min(b.y1,b.y2),width:Math.abs(b.x2-b.x1),height:Math.abs(b.y2-b.y1)}}return this.bbox}});d.Polyline=P("dojox.gfx.shape.Polyline",d.Shape,{constructor:function(b){this.shape=Q.getDefault("Polyline");this.rawNode=b},setShape:function(b,
m){b&&b instanceof Array?(this.inherited(arguments,[{points:b}]),m&&this.shape.points.length&&this.shape.points.push(this.shape.points[0])):this.inherited(arguments,[b]);return this},_normalizePoints:function(){var b=this.shape.points,m=b&&b.length;if(m&&"number"==typeof b[0]){for(var k=[],e=0;e<m;e+=2)k.push({x:b[e],y:b[e+1]});this.shape.points=k}},getBoundingBox:function(){if(!this.bbox&&this.shape.points.length){for(var b=this.shape.points,m=b.length,k=b[0],e=k.x,c=k.y,f=k.x,A=k.y,C=1;C<m;++C)k=
b[C],e>k.x&&(e=k.x),f<k.x&&(f=k.x),c>k.y&&(c=k.y),A<k.y&&(A=k.y);this.bbox={x:e,y:c,width:f-e,height:A-c}}return this.bbox}});d.Image=P("dojox.gfx.shape.Image",d.Shape,{constructor:function(b){this.shape=Q.getDefault("Image");this.rawNode=b},getBoundingBox:function(){return this.shape},setStroke:function(){return this},setFill:function(){return this}});d.Text=P(d.Shape,{constructor:function(b){this.fontStyle=null;this.shape=Q.getDefault("Text");this.rawNode=b},getFont:function(){return this.fontStyle},
setFont:function(b){this.fontStyle="string"==typeof b?Q.splitFontString(b):Q.makeParameters(Q.defaultFont,b);this._setFont();return this},getBoundingBox:function(){var b=null;this.getShape().text&&(b=Q._base._computeTextBoundingBox(this));return b}});d.Creator={createShape:function(b){switch(b.type){case Q.defaultPath.type:return this.createPath(b);case Q.defaultRect.type:return this.createRect(b);case Q.defaultCircle.type:return this.createCircle(b);case Q.defaultEllipse.type:return this.createEllipse(b);
case Q.defaultLine.type:return this.createLine(b);case Q.defaultPolyline.type:return this.createPolyline(b);case Q.defaultImage.type:return this.createImage(b);case Q.defaultText.type:return this.createText(b);case Q.defaultTextPath.type:return this.createTextPath(b)}return null},createGroup:function(){return this.createObject(Q.Group)},createRect:function(b){return this.createObject(Q.Rect,b)},createEllipse:function(b){return this.createObject(Q.Ellipse,b)},createCircle:function(b){return this.createObject(Q.Circle,
b)},createLine:function(b){return this.createObject(Q.Line,b)},createPolyline:function(b){return this.createObject(Q.Polyline,b)},createImage:function(b){return this.createObject(Q.Image,b)},createText:function(b){return this.createObject(Q.Text,b)},createPath:function(b){return this.createObject(Q.Path,b)},createTextPath:function(b){return this.createObject(Q.TextPath,{}).setText(b)},createObject:function(b,m){return null}};return d})},"dojox/gfx/path":function(){define(["./_base","dojo/_base/lang",
"dojo/_base/declare","./matrix","./shape"],function(Q,I,P,V,J){J=P("dojox.gfx.path.Path",J.Shape,{constructor:function(x){this.shape=I.clone(Q.defaultPath);this.segments=[];this.tbbox=null;this.absolute=!0;this.last={};this.rawNode=x;this.segmented=!1},setAbsoluteMode:function(x){this._confirmSegmented();this.absolute="string"==typeof x?"absolute"==x:x;return this},getAbsoluteMode:function(){this._confirmSegmented();return this.absolute},getBoundingBox:function(){this._confirmSegmented();return this.bbox&&
"l"in this.bbox?{x:this.bbox.l,y:this.bbox.t,width:this.bbox.r-this.bbox.l,height:this.bbox.b-this.bbox.t}:null},_getRealBBox:function(){this._confirmSegmented();if(this.tbbox)return this.tbbox;var x=this.bbox,n=this._getRealMatrix();this.bbox=null;for(var q=0,t=this.segments.length;q<t;++q)this._updateWithSegment(this.segments[q],n);n=this.bbox;this.bbox=x;return this.tbbox=n?[{x:n.l,y:n.t},{x:n.r,y:n.t},{x:n.r,y:n.b},{x:n.l,y:n.b}]:null},getLastPosition:function(){this._confirmSegmented();return"x"in
this.last?this.last:null},_applyTransform:function(){this.tbbox=null;return this.inherited(arguments)},_updateBBox:function(x,n,q){q&&(n=V.multiplyPoint(q,x,n),x=n.x,n=n.y);this.bbox&&"l"in this.bbox?(this.bbox.l>x&&(this.bbox.l=x),this.bbox.r<x&&(this.bbox.r=x),this.bbox.t>n&&(this.bbox.t=n),this.bbox.b<n&&(this.bbox.b=n)):this.bbox={l:x,b:n,r:x,t:n}},_updateWithSegment:function(x,n){var q=x.args,t=q.length,v;switch(x.action){case "M":case "L":case "C":case "S":case "Q":case "T":for(v=0;v<t;v+=2)this._updateBBox(q[v],
q[v+1],n);this.last.x=q[t-2];this.last.y=q[t-1];this.absolute=!0;break;case "H":for(v=0;v<t;++v)this._updateBBox(q[v],this.last.y,n);this.last.x=q[t-1];this.absolute=!0;break;case "V":for(v=0;v<t;++v)this._updateBBox(this.last.x,q[v],n);this.last.y=q[t-1];this.absolute=!0;break;case "m":v=0;"x"in this.last||(this._updateBBox(this.last.x=q[0],this.last.y=q[1],n),v=2);for(;v<t;v+=2)this._updateBBox(this.last.x+=q[v],this.last.y+=q[v+1],n);this.absolute=!1;break;case "l":case "t":for(v=0;v<t;v+=2)this._updateBBox(this.last.x+=
q[v],this.last.y+=q[v+1],n);this.absolute=!1;break;case "h":for(v=0;v<t;++v)this._updateBBox(this.last.x+=q[v],this.last.y,n);this.absolute=!1;break;case "v":for(v=0;v<t;++v)this._updateBBox(this.last.x,this.last.y+=q[v],n);this.absolute=!1;break;case "c":for(v=0;v<t;v+=6)this._updateBBox(this.last.x+q[v],this.last.y+q[v+1],n),this._updateBBox(this.last.x+q[v+2],this.last.y+q[v+3],n),this._updateBBox(this.last.x+=q[v+4],this.last.y+=q[v+5],n);this.absolute=!1;break;case "s":case "q":for(v=0;v<t;v+=
4)this._updateBBox(this.last.x+q[v],this.last.y+q[v+1],n),this._updateBBox(this.last.x+=q[v+2],this.last.y+=q[v+3],n);this.absolute=!1;break;case "A":for(v=0;v<t;v+=7)this._updateBBox(q[v+5],q[v+6],n);this.last.x=q[t-2];this.last.y=q[t-1];this.absolute=!0;break;case "a":for(v=0;v<t;v+=7)this._updateBBox(this.last.x+=q[v+5],this.last.y+=q[v+6],n);this.absolute=!1}x=[x.action];for(v=0;v<t;++v)x.push(Q.formatNumber(q[v],!0));if("string"==typeof this.shape.path)this.shape.path+=x.join("");else for(v=
0,t=x.length;v<t;++v)this.shape.path.push(x[v])},_validSegments:{m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},_pushSegment:function(x,n){this.tbbox=null;var q=this._validSegments[x.toLowerCase()];"number"==typeof q&&(q?n.length>=q&&(x={action:x,args:n.slice(0,n.length-n.length%q)},this.segments.push(x),this._updateWithSegment(x)):(x={action:x,args:[]},this.segments.push(x),this._updateWithSegment(x)))},_collectArgs:function(x,n){for(var q=0;q<n.length;++q){var t=n[q];"boolean"==typeof t?x.push(t?1:0):
"number"==typeof t?x.push(t):t instanceof Array?this._collectArgs(x,t):"x"in t&&"y"in t&&x.push(t.x,t.y)}},moveTo:function(){this._confirmSegmented();var x=[];this._collectArgs(x,arguments);this._pushSegment(this.absolute?"M":"m",x);return this},lineTo:function(){this._confirmSegmented();var x=[];this._collectArgs(x,arguments);this._pushSegment(this.absolute?"L":"l",x);return this},hLineTo:function(){this._confirmSegmented();var x=[];this._collectArgs(x,arguments);this._pushSegment(this.absolute?
"H":"h",x);return this},vLineTo:function(){this._confirmSegmented();var x=[];this._collectArgs(x,arguments);this._pushSegment(this.absolute?"V":"v",x);return this},curveTo:function(){this._confirmSegmented();var x=[];this._collectArgs(x,arguments);this._pushSegment(this.absolute?"C":"c",x);return this},smoothCurveTo:function(){this._confirmSegmented();var x=[];this._collectArgs(x,arguments);this._pushSegment(this.absolute?"S":"s",x);return this},qCurveTo:function(){this._confirmSegmented();var x=
[];this._collectArgs(x,arguments);this._pushSegment(this.absolute?"Q":"q",x);return this},qSmoothCurveTo:function(){this._confirmSegmented();var x=[];this._collectArgs(x,arguments);this._pushSegment(this.absolute?"T":"t",x);return this},arcTo:function(){this._confirmSegmented();var x=[];this._collectArgs(x,arguments);this._pushSegment(this.absolute?"A":"a",x);return this},closePath:function(){this._confirmSegmented();this._pushSegment("Z",[]);return this},_confirmSegmented:function(){if(!this.segmented){var x=
this.shape.path;this.shape.path=[];this._setPath(x);this.shape.path=this.shape.path.join("");this.segmented=!0}},_setPath:function(x){x=I.isArray(x)?x:x.match(Q.pathSvgRegExp);this.segments=[];this.absolute=!0;this.bbox={};this.last={};if(x){for(var n="",q=[],t=x.length,v=0;v<t;++v){var H=x[v],d=parseFloat(H);isNaN(d)?(n&&this._pushSegment(n,q),q=[],n=H):q.push(d)}this._pushSegment(n,q)}},setShape:function(x){this.inherited(arguments,["string"==typeof x?{path:x}:x]);this.segmented=!1;this.segments=
[];Q.lazyPathSegmentation||this._confirmSegmented();return this},_2PI:2*Math.PI});P=P("dojox.gfx.path.TextPath",J,{constructor:function(x){"text"in this||(this.text=I.clone(Q.defaultTextPath));"fontStyle"in this||(this.fontStyle=I.clone(Q.defaultFont))},getText:function(){return this.text},setText:function(x){this.text=Q.makeParameters(this.text,"string"==typeof x?{text:x}:x);this._setText();return this},getFont:function(){return this.fontStyle},setFont:function(x){this.fontStyle="string"==typeof x?
Q.splitFontString(x):Q.makeParameters(Q.defaultFont,x);this._setFont();return this}});return Q.path={Path:J,TextPath:P}})},"dojox/gfx/arc":function(){define(["./_base","dojo/_base/lang","./matrix"],function(Q,I,P){function V(v){var H=Math.cos(v);v=Math.sin(v);var d={x:H+4/3*(1-H),y:v-4/3*H*(1-H)/v};return{s:{x:H,y:-v},c1:{x:d.x,y:-d.y},c2:d,e:{x:H,y:v}}}var J=2*Math.PI,x=Math.PI/4,n=Math.PI/8,q=x+n,t=V(n);return Q.arc={unitArcAsBezier:V,curvePI4:t,arcAsBezier:function(v,H,d,b,m,k,e,c){m=!!m;k=!!k;
var f=P._degToRad(b);b=H*H;var A=d*d,C=P.multiplyPoint(P.rotate(-f),{x:(v.x-e)/2,y:(v.y-c)/2}),F=C.x*C.x,z=C.y*C.y;b=Math.sqrt((b*A-b*z-A*F)/(b*z+A*F));isNaN(b)&&(b=0);b={x:b*H*C.y/d,y:-b*d*C.x/H};m==k&&(b={x:-b.x,y:-b.y});b=P.multiplyPoint([P.translate((v.x+e)/2,(v.y+c)/2),P.rotate(f)],b);H=P.normalize([P.translate(b.x,b.y),P.rotate(f),P.scale(H,d)]);b=P.invert(H);v=P.multiplyPoint(b,v);c=P.multiplyPoint(b,e,c);e=Math.atan2(v.y,v.x);b=e-Math.atan2(c.y,c.x);k&&(b=-b);0>b?b+=J:b>J&&(b-=J);d=n;c=t;
d=k?d:-d;v=[];for(m=b;0<m;m-=x)m<q&&(d=m/2,c=V(d),d=k?d:-d,m=0),C=P.normalize([H,P.rotate(e+d)]),k?(b=P.multiplyPoint(C,c.c1),f=P.multiplyPoint(C,c.c2),C=P.multiplyPoint(C,c.e)):(b=P.multiplyPoint(C,c.c2),f=P.multiplyPoint(C,c.c1),C=P.multiplyPoint(C,c.s)),v.push([b.x,b.y,f.x,f.y,C.x,C.y]),e+=2*d;return v}}})},"dojox/gfx/decompose":function(){define(["./_base","dojo/_base/lang","./matrix"],function(Q,I,P){function V(t,v){return Math.abs(t-v)<=1E-6*(Math.abs(t)+Math.abs(v))}function J(t,v,H,d){if(!isFinite(t))return H;
if(!isFinite(H))return t;v=Math.abs(v);d=Math.abs(d);return(v*t+d*H)/(v+d)}function x(t){t=P.normalize(t);var v=-t.xx-t.yy,H=t.xx*t.yy-t.xy*t.yx,d=Math.sqrt(v*v-4*H);v=-(v+(0>v?-d:d))/2;H/=v;d=t.xy/(v-t.xx);var b=1,m=t.xy/(H-t.xx),k=1;V(v,H)&&(d=1,m=b=0,k=1);isFinite(d)||(d=1,b=(v-t.xx)/t.xy,isFinite(b)||(d=(v-t.yy)/t.yx,b=1,isFinite(d)||(d=1,b=t.yx/(v-t.yy))));isFinite(m)||(m=1,k=(H-t.xx)/t.xy,isFinite(k)||(m=(H-t.yy)/t.yx,k=1,isFinite(m)||(m=1,k=t.yx/(H-t.yy))));t=Math.sqrt(d*d+b*b);var e=Math.sqrt(m*
m+k*k);isFinite(d/=t)||(d=0);isFinite(b/=t)||(b=0);isFinite(m/=e)||(m=0);isFinite(k/=e)||(k=0);return{value1:v,value2:H,vector1:{x:d,y:b},vector2:{x:m,y:k}}}function n(t,v){var H=0>t.xx*t.yy||0<t.xy*t.yx?-1:1,d=v.angle1=(Math.atan2(t.yx,t.yy)+Math.atan2(-H*t.xy,H*t.xx))/2;H=Math.cos(d);d=Math.sin(d);v.sx=J(t.xx/H,H,-t.xy/d,d);v.sy=J(t.yy/H,H,t.yx/d,d);return v}function q(t,v){var H=0>t.xx*t.yy||0<t.xy*t.yx?-1:1,d=v.angle2=(Math.atan2(H*t.yx,H*t.xx)+Math.atan2(-t.xy,t.yy))/2;H=Math.cos(d);d=Math.sin(d);
v.sx=J(t.xx/H,H,t.yx/d,d);v.sy=J(t.yy/H,H,-t.xy/d,d);return v}return Q.decompose=function(t){var v=P.normalize(t);t={dx:v.dx,dy:v.dy,sx:1,sy:1,angle1:0,angle2:0};if(V(v.xy,0)&&V(v.yx,0))return I.mixin(t,{sx:v.xx,sy:v.yy});if(V(v.xx*v.yx,-v.xy*v.yy))return n(v,t);if(V(v.xx*v.xy,-v.yx*v.yy))return q(v,t);var H=new P.Matrix2D(v);var d=I.mixin(H,{dx:0,dy:0,xy:H.yx,yx:H.xy});H=x([v,d]);d=x([d,v]);H=new P.Matrix2D({xx:H.vector1.x,xy:H.vector2.x,yx:H.vector1.y,yy:H.vector2.y});d=new P.Matrix2D({xx:d.vector1.x,
xy:d.vector1.y,yx:d.vector2.x,yy:d.vector2.y});v=new P.Matrix2D([P.invert(H),v,P.invert(d)]);n(d,t);v.xx*=t.sx;v.yy*=t.sy;q(H,t);v.xx*=t.sx;v.yy*=t.sy;return I.mixin(t,{sx:v.xx,sy:v.yy})}})},"dojox/gfx/bezierutils":function(){define(["./_base"],function(Q){Q=Q.bezierutils={};Q.tAtLength=function(n,q){var t=0,v=6==n.length,H=0,d=0,b=v?V:x,m=function(k,e){for(var c=0,f=0;f<k.length-2;f+=2)c+=P(k[f],k[f+1],k[f+2],k[f+3]);f=v?P(n[0],n[1],n[4],n[5]):P(n[0],n[1],n[6],n[7]);c-f>e||H+c>q+e?(++d,k=b(k,.5),
m(k[0],e),Math.abs(H-q)<=e||m(k[1],e)):(H+=c,t+=1/(1<<d))};q&&m(n,.5);return t};var I=Q.computeLength=function(n){for(var q=6==n.length,t=0,v=0;v<n.length-2;v+=2)t+=P(n[v],n[v+1],n[v+2],n[v+3]);v=q?P(n[0],n[1],n[4],n[5]):P(n[0],n[1],n[6],n[7]);return.1<t-v?(n=q?V(n,.5):J(n,.5),t=I(n[0],q),t+=I(n[1],q)):t},P=Q.distance=function(n,q,t,v){return Math.sqrt((t-n)*(t-n)+(v-q)*(v-q))},V=function(n,q){var t=1-q,v=t*t,H=q*q,d=n[0],b=n[1],m=n[2],k=n[3],e=n[4];n=n[5];var c=v*d+2*t*q*m+H*e;v=v*b+2*t*q*k+H*n;
return[[d,b,t*d+q*m,t*b+q*k,c,v],[c,v,t*m+q*e,t*k+q*n,e,n]]},J=function(n,q){var t=1-q,v=t*t,H=v*t,d=q*q,b=d*q,m=n[0],k=n[1],e=n[2],c=n[3],f=n[4],A=n[5],C=n[6];n=n[7];var F=H*m+3*v*q*e+3*t*d*f+b*C;H=H*k+3*v*q*c+3*t*d*A+b*n;return[[m,k,t*m+q*e,t*k+q*c,v*m+2*t*q*e+d*f,v*k+2*t*q*c+d*A,F,H],[F,H,v*e+2*t*q*f+d*C,v*c+2*t*q*A+d*n,t*f+q*C,t*A+q*n,C,n]]},x=Q.splitBezierAtT=function(n,q){return 6==n.length?V(n,q):J(n,q)};return Q})},"dojox/json/query":function(){define(["dojo/_base/kernel","dojo/_base/lang",
"dojox","dojo/_base/array"],function(Q,I,P){I.getObject("json",!0,P);P.json._slice=function(V,J,x,n){var q=V.length,t=[];x=x||q;J=0>J?Math.max(0,J+q):Math.min(q,J);for(x=0>x?Math.max(0,x+q):Math.min(q,x);J<x;J+=n)t.push(V[J]);return t};P.json._find=function(V,J){function x(t){J&&(!0!==J||t instanceof Array?t[J]&&n.push(t[J]):n.push(t));for(var v in t){var H=t[v];J?H&&"object"==typeof H&&x(H):n.push(H)}}var n=[];if(J instanceof Array){if(1==J.length)return V[J[0]];for(var q=0;q<J.length;q++)n.push(V[J[q]])}else x(V);
return n};P.json._distinctFilter=function(V,J){for(var x=[],n={},q=0,t=V.length;q<t;++q){var v=V[q];J(v,q,V)&&("object"==typeof v&&v?v.__included||(v.__included=!0,x.push(v)):n[v+typeof v]||(n[v+typeof v]=!0,x.push(v)))}q=0;for(t=x.length;q<t;++q)x[q]&&delete x[q].__included;return x};return P.json.query=function(V,J){function x(d,b,m,k,e,c,f,A){return q[A].match(/[\*\?]/)||"~"==f?"/^"+q[A].substring(1,q[A].length-1).replace(/\\([btnfr\\"'])|([^\w\*\?])/g,"\\$1$2").replace(/([\*\?])/g,"[\\w\\W]$1")+
("~"==f?"$/i":"$/")+".test("+b+")":d}var n=0,q=[];V=V.replace(/"(\\.|[^"\\])*"|'(\\.|[^'\\])*'|[\[\]]/g,function(d){n+="["==d?1:"]"==d?-1:0;return"]"==d&&0<n?"`]":'"'==d.charAt(0)||"'"==d.charAt(0)?"`"+(q.push(d)-1):d});var t="";V.replace(/(\]|\)|push|pop|shift|splice|sort|reverse)\s*\(/,function(){throw Error("Unsafe function call");});V=V.replace(/([^<>=]=)([^=])/g,"$1\x3d$2").replace(/@|(\.\s*)?[a-zA-Z\$_]+(\s*:)?/g,function(d){return"."==d.charAt(0)?d:"@"==d?"$obj":(d.match(/:|^(\$|Math|true|false|null)$/)?
"":"$obj.")+d}).replace(/\.?\.?\[(`\]|[^\]])*\]|\?.*|\.\.([\w\$_]+)|\.\*/g,function(d,b,m){return(b=d.match(/^\.?\.?(\[\s*\^?\?|\^?\?|\[\s*==)(.*?)\]?$/))?(m="",d.match(/^\./)&&(t="dojox.json._find("+t,m=",true)"),t=(b[1].match(/=/)?"dojo.map":b[1].match(/\^/)?"dojox.json._distinctFilter":"dojo.filter")+"("+t,m+",function($obj){return "+b[2]+"})"):(b=d.match(/^\[\s*([\/\\].*)\]/))?".concat().sort(function(a,b){"+b[1].replace(/\s*,?\s*([\/\\])\s*([^,\\\/]+)/g,function(k,e,c){return"var av\x3d "+c.replace(/\$obj/,
"a")+",bv\x3d "+c.replace(/\$obj/,"b")+";if(av\x3ebv||bv\x3d\x3dnull){return "+("/"==e?1:-1)+";}\nif(bv\x3eav||av\x3d\x3dnull){return "+("/"==e?-1:1)+";}\n"})+"return 0;})":(b=d.match(/^\[(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)\]/))?(t="dojox.json._slice("+t,","+(b[1]||0)+","+(b[2]||0)+","+(b[3]||1)+")"):d.match(/^\.\.|\.\*|\[\s*\*\s*\]|,/)?(t="dojox.json._find("+t,("."==d.charAt(1)?",'"+m+"'":d.match(/,/)?","+d:"")+")"):d}).replace(/(\$obj\s*((\.\s*[\w_$]+\s*)|(\[\s*`([0-9]+)\s*`\]))*)(==|~)\s*`([0-9]+)/g,
x).replace(/`([0-9]+)\s*(==|~)\s*(\$obj\s*((\.\s*[\w_$]+)|(\[\s*`([0-9]+)\s*`\]))*)/g,function(d,b,m,k,e,c,f,A){return x(d,k,e,c,f,A,m,b)});V=t+("$"==V.charAt(0)?"":"$")+V.replace(/`([0-9]+|\])/g,function(d,b){return"]"==b?"]":q[b]});for(var v=eval("1\x26\x26function($,$1,$2,$3,$4,$5,$6,$7,$8,$9){var $obj\x3d$;return "+V+"}"),H=0;H<arguments.length-1;H++)arguments[H]=arguments[H+1];return J?v.apply(this,arguments):v}})},"esri/tasks/locator":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ./Task ./AddressCandidate".split(" "),
function(Q,I,P,V,J,x,n,q,t,v,H){Q=Q(v,{declaredClass:"esri.tasks.Locator",_eventMap:{"address-to-locations-complete":["addresses"],"addresses-to-locations-complete":["addresses"],"location-to-address-complete":["address"],"suggest-locations-complete":["suggestions"]},constructor:function(d){this._geocodeHandler=I.hitch(this,this._geocodeHandler);this._geocodeAddressesHandler=I.hitch(this,this._geocodeAddressesHandler);this._reverseGeocodeHandler=I.hitch(this,this._reverseGeocodeHandler);this.registerConnectEvents()},
outSpatialReference:null,setOutSpatialReference:function(d){this.outSpatialReference=d},_geocodeHandler:function(d,b,m,k,e){try{var c=d.candidates;b=[];var f,A=c.length,C=d.spatialReference,F;for(f=0;f<A;f++){var z=c[f];if(F=z.location)F.spatialReference=C;b[f]=new H(z)}this._successHandler([b],"onAddressToLocationsComplete",m,e)}catch(K){this._errorHandler(K,k,e)}},_geocodeAddressesHandler:function(d,b,m,k,e){try{var c=d.locations;b=[];var f,A=c.length,C=d.spatialReference,F;for(f=0;f<A;f++){if(F=
c[f].location)F.spatialReference=C;b[f]=new H(c[f])}this._successHandler([b],"onAddressesToLocationsComplete",m,e)}catch(z){this._errorHandler(z,k,e)}},addressToLocations:function(d,b,m,k,e){var c;if(d.address){k=m;m=b;b=d.outFields;e=d.searchExtent;var f=d.countryCode;var A=d.magicKey;var C=d.distance;var F=d.categories;d.location&&this.normalization&&(c=d.location.normalize());var z=d.locationType;var K=d.maxLocations;var D=d.forStorage;d=d.address}e&&(e=e.shiftCentralMeridian());var h=this.outSpatialReference;
d=this._encode(I.mixin({},this._url.query,d,{f:"json",outSR:h&&J.toJson(h.toJson()),outFields:b&&b.join(",")||null,searchExtent:e&&J.toJson(e.toJson()),category:F&&F.join(",")||null,countryCode:f||null,magicKey:A||null,distance:C||null,location:c||null,locationType:z||null,maxLocations:K||null,forStorage:D||null}));var B=this._geocodeHandler,N=this._errorHandler,E=new V(t._dfdCanceller);E._pendingDfd=q({url:this._url.path+"/findAddressCandidates",content:d,callbackParamName:"callback",load:function(O,
R){B(O,R,m,k,E)},error:function(O){N(O,k,E)}});return E},suggestLocations:function(d){var b=new V(t._dfdCanceller);d.hasOwnProperty("location")&&this.normalization&&(d.location=d.location.normalize());d.searchExtent&&(d.searchExtent=d.searchExtent.shiftCentralMeridian());d=this._encode(I.mixin({},this._url.query,{f:"json",text:d.text,maxSuggestions:d.maxSuggestions,searchExtent:d.searchExtent&&J.toJson(d.searchExtent.toJson()),category:d.categories&&d.categories.join(",")||null,countryCode:d.countryCode||
null,location:d.location||null,distance:d.distance||null},{f:"json"}));d=q({url:this._url.path+"/suggest",content:d,callbackParamName:"callback"});b._pendingDfd=d;d.then(I.hitch(this,function(m){m=m.suggestions||[];this.onSuggestLocationsComplete(m);b.resolve(m)}),I.hitch(this,function(m){this._errorHandler(m);b.reject(m)}));return b},addressesToLocations:function(d,b,m){var k=this.outSpatialReference,e=[],c=d.categories,f=d.locationType,A=d.countryCode;P.forEach(d.addresses,function(K,D){e.push({attributes:K})});
d=this._encode(I.mixin({},this._url.query,{category:c&&c.join(",")||null,locationType:f||null,sourceCountry:A||null},{addresses:J.toJson({records:e})},{f:"json",outSR:k&&J.toJson(k.toJson())}));var C=this._geocodeAddressesHandler,F=this._errorHandler,z=new V(t._dfdCanceller);z._pendingDfd=q({url:this._url.path+"/geocodeAddresses",content:d,callbackParamName:"callback",load:function(K,D){C(K,D,b,m,z)},error:function(K){F(K,m,z)}});return z},_reverseGeocodeHandler:function(d,b,m,k,e){try{var c=new H({address:d.address,
location:d.location,score:100});this._successHandler([c],"onLocationToAddressComplete",m,e)}catch(f){this._errorHandler(f,k,e)}},locationToAddress:function(d,b,m,k){d&&this.normalization&&(d=d.normalize());var e=this.outSpatialReference;d=this._encode(I.mixin({},this._url.query,{outSR:e&&J.toJson(e.toJson()),location:d&&J.toJson(d.toJson()),distance:b,f:"json"}));var c=this._reverseGeocodeHandler,f=this._errorHandler,A=new V(t._dfdCanceller);A._pendingDfd=q({url:this._url.path+"/reverseGeocode",content:d,
callbackParamName:"callback",load:function(C,F){c(C,F,m,k,A)},error:function(C){f(C,k,A)}});return A},onSuggestLocationsComplete:function(){},onAddressToLocationsComplete:function(){},onAddressesToLocationsComplete:function(){},onLocationToAddressComplete:function(){}});x("extend-esri")&&I.setObject("tasks.Locator",Q,n);return Q})},"esri/tasks/AddressCandidate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../geometry/Point"],function(Q,I,P,V,J){Q=Q(null,{declaredClass:"esri.tasks.AddressCandidate",
constructor:function(x){I.mixin(this,x);this.location=new J(this.location)}});P("extend-esri")&&I.setObject("tasks.AddressCandidate",Q,V);return Q})},"esri/tasks/LegendLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(Q,I,P,V){Q=Q(null,{declaredClass:"esri.tasks.LegendLayer",layerId:null,subLayerIds:null});P("extend-esri")&&I.setObject("tasks.LegendLayer",Q,V);return Q})},"esri/dijit/AttributeInspector":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/sniff dojo/_base/kernel dojo/has dojo/dom-style dojo/dom-construct ../kernel ../lang ../domUtils ../layers/InheritedDomain ../layers/FeatureLayer dojo/i18n!../nls/jsapi dojo/fx dojox/gfx dijit/_Widget dijit/_Templated dijit/Editor dijit/_editor/plugins/LinkDialog dijit/_editor/plugins/TextColor ./_EventedWidget ./editing/AttachmentEditor ./editing/Util ../tasks/query dijit/form/DateTextBox dijit/form/TextBox dijit/form/NumberTextBox dijit/form/FilteringSelect dijit/form/NumberSpinner dijit/form/Button dijit/form/SimpleTextarea dijit/form/ValidationTextBox dijit/form/TimeTextBox dijit/Tooltip dojo/data/ItemFileReadStore dojox/date/islamic dojox/date/islamic/Date dojox/date/islamic/locale dojo/text!./templates/AttributeInspector.html".split(" "),
function(Q,I,P,V,J,x,n,q,t,v,H,d,b,m,k,e,c,f,A,C,F,z,K,D,h,B,N,E,O,R,a,u,G,l,g,w,M,Y,W,aa,ea){var fa=Q([K,f,A],{declaredClass:"esri.dijit.AttributeInspector",widgetsInTemplate:!0,templateString:ea,onUpdate:function(){},onDelete:function(){},onAttributeChange:function(){},onNext:function(){},onReset:function(){},onCancel:function(){},_navMessage:"( ${idx} ${of} ${numFeatures} )",_currentAttributeFieldName:null,_aiConnects:[],_selection:[],_toolTips:[],_numFeatures:0,_featureIdx:0,_currentLInfo:null,
_currentFeature:null,_rollbackInfo:null,_eventMap:{update:!0,"delete":["feature"],"attribute-change":["feature","fieldName","fieldValue"],next:["feature"],reset:!0,cancel:!0},_defaultRichTextPlugins:"bold italic underline foreColor hiliteColor | justifyLeft justifyCenter justifyRight justifyFull | insertOrderedList insertUnorderedList indent outdent | createLink".split(" "),css:{label:"atiLabel",field:"atiField",textArea:"atiTextAreaField",richText:"atiRichTextField",attachmentEditor:"atiAttachmentEditor",
red:"atiRequiredField"},constructor:function(S,T){I.mixin(this,k.widgets.attributeInspector);S=S||{};S.featureLayer||S.layerInfos||console.error("esri.AttributeInspector: please provide correct parameter in the constructor");this._datePackage=this._getDatePackage(S);this._layerInfos=S.layerInfos||[{featureLayer:S.featureLayer,options:S.options||[]}];this._layerInfos=P.filter(this._layerInfos,function(X){return!X.disableAttributeUpdate});this._hideNavButtons=S.hideNavButtons||!1},postCreate:function(){if(P.every(this._layerInfos,
function(T){return T.featureLayer.loaded}))this._initLayerInfos(),this._createAttachmentEditor(),this.onFirstFeature();else{var S=this._layerInfos.length;P.forEach(this._layerInfos,function(T){T=T.featureLayer;if(T.loaded)S--;else var X=V.connect(T,"onLoad",this,function(Z){V.disconnect(X);X=null;S--;S||(this._initLayerInfos(),this._createAttachmentEditor(),this.onFirstFeature())})},this)}},destroy:function(){this._destroyAttributeTable();P.forEach(this._aiConnects,V.disconnect);delete this._aiConnects;
this._attachmentEditor&&(this._attachmentEditor.destroy(),delete this._attachmentEditor);delete this._layerInfos;this._selection=this._currentFeature=this._currentLInfo=this._attributes=this._layerInfos=null;this.inherited(arguments)},refresh:function(){this._updateSelection()},first:function(){this.onFirstFeature()},last:function(){this.onLastFeature()},next:function(){this.onNextFeature()},previous:function(){this.onPreviousFeature()},showFeature:function(S,T){T&&(this._createOnlyFirstTime=!0);
this._updateSelection([S],T);this._updateUI()},onLayerSelectionChange:function(S,T,X){this._createOnlyFirstTime=!1;this._featureIdx=X===m.SELECTION_NEW?0:this._featureIdx;this._updateSelection();this._updateUI()},onLayerSelectionClear:function(){!this._selection||0>=this._selection.length||(this._featureIdx=this._numFeatures=0,this._selection=[],this._currentLInfo=this._currentFeature=null,this._updateUI())},onLayerUpdateEnd:function(S,T,X,Z){},onLayerError:function(S,T,X,Z){},onLayerEditsError:function(S,
T,X,Z){},onLayerEditsComplete:function(S,T,X,Z){Z=Z||[];if(Z.length){var ha=this._selection,na=S.featureLayer.objectIdField;P.forEach(Z,I.hitch(this,function(oa){P.some(ha,I.hitch(this,function(ka,pa){if(ka.attributes[na]!==oa.objectId)return!1;this._selection.splice(pa,1);return!0}))}))}T=T||[];T.length&&(this._selection=h.findFeatures(T,S.featureLayer),this._featureIdx=0);Z=this._numFeatures=(this._selection=h.sortFeaturesById(this._layerInfos,this._selection))?this._selection.length:0;if(T.length){if(T=
Z?this._selection[this._featureIdx]:null)Z=T.getLayer().getEditCapabilities(),Z.canCreate&&!Z.canUpdate||this._showFeature(T);this._updateUI()}X=X||[];if(X.length){var ja=this._rollbackInfo;P.forEach(X,function(oa){var ka=h.findFeatures(X,S.featureLayer)[0];if(!oa.success&&ka.attributes[S.featureLayer.objectIdField]===oa.objectId&&ja){var pa=ja.field;oa=ja.graphic.attributes[pa.name];var ta=P.filter(this._currentLInfo.fieldInfos,function(xa){return xa.fieldName===pa.name},this)[0].dijit;ka.attributes[pa.name]=
oa;"esriFieldTypeDate"===pa.type&&(oa=new Date(oa));this._setValue(ta,oa)}},this)}this._rollbackInfo=null},onFieldValueChange:function(S,T){var X=S.field,Z=S.dijit,ha=this._currentFeature,na=this._currentLInfo,ja=X.name;S=this._isFieldRequired(X,S);if(""===Z.displayedValue||"dijit.form.ValidationTextBox"!==Z.declaredClass||Z.isValid())if(""!==Z.displayedValue&&Z.displayedValue!==T&&Z.isValid&&!Z.isValid())this._setValue(Z,ha.attributes[X.name]);else{var oa=!("esriFieldTypeInteger"!==X.type&&"esriFieldTypeSmallInteger"!==
X.type&&"esriFieldTypeSingle"!==X.type&&"esriFieldTypeDouble"!==X.type);if(S&&(null===T||""===T||"undefined"===typeof T||oa&&isNaN(T))){ja=ha.attributes[X.name];if("esriFieldTypeDate"===X.type&&(ja=new Date(ja),Z instanceof Array)){this._setValue(Z[0],ja);this._setValue(Z[1],ja);return}this._setValue(Z,ja)}else{if(oa){if(isNaN(T)||""===T)T=null;oa&&null!==T&&(T=Number(T))}"esriFieldTypeDate"===X.type&&(Z instanceof Array?(T=Z[0].getValue(),Z=Z[1].getValue(),T=T&&Z?new Date(T.getFullYear(),T.getMonth(),
T.getDate(),Z.getHours(),Z.getMinutes(),Z.getSeconds(),Z.getMilliseconds()):T||Z||null):(T=Z.getValue(),X.domain&&(T=Number(T))),T=T&&T.getTime?T.getTime():T&&T.toGregorian?T.toGregorian().getTime():T);if(this._currentFeature.attributes[X.name]!==T){if(ja===na.typeIdField){var ka=this._findFirst(na.types,"id",T);P.forEach(na.fieldInfos,function(pa){(X=pa.field)&&X.name!==na.typeIdField&&(pa=pa.dijit,this._setFieldDomain(pa,ka,X)&&pa&&(this._setValue(pa,ha.attributes[X.name]+""),!1===pa.isValid()&&
this._setValue(pa,null)))},this)}this.onAttributeChange(ha,ja,T)}}}else this._setValue(Z,ha.attributes[X.name])},onDeleteBtn:function(S){this._deleteFeature()},onNextFeature:function(S){this._onNextFeature(1)},onPreviousFeature:function(S){this._onNextFeature(-1)},onFirstFeature:function(S){this._onNextFeature(-1*this._featureIdx)},onLastFeature:function(S){this._onNextFeature(this._numFeatures-1-this._featureIdx)},_initLayerInfos:function(){var S=this._layerInfos;this._editorTrackingInfos={};P.forEach(S,
this._initLayerInfo,this)},_initLayerInfo:function(S){var T=S.featureLayer,X;this._userIds={};var Z=T.id;T.credential&&(this._userIds[Z]=T.credential.userId);S.userId&&(this._userIds[Z]=S.userId);this._connect(T,"onSelectionComplete",I.hitch(this,"onLayerSelectionChange",S));this._connect(T,"onSelectionClear",I.hitch(this,"onLayerSelectionClear",S));this._connect(T,"onEditsComplete",I.hitch(this,"onLayerEditsComplete",S));this._connect(T,"error",I.hitch(this,"onLayerError",S));this._connect(T,"onUpdateEnd",
I.hitch(this,"onLayerUpdateEnd",S));S.showAttachments=T.hasAttachments?H.isDefined(S.showAttachments)?S.showAttachments:!0:!1;S.hideFields=S.hideFields||[];S.htmlFields=S.htmlFields||[];S.isEditable=T.isEditable()?H.isDefined(S.isEditable)?S.isEditable:!0:!1;S.typeIdField=T.typeIdField;S.layerId=T.id;S.types=T.types;T.globalIdField&&((X=this._findFirst(S.fieldInfos,"fieldName",T.globalIdField))||S.showGlobalID||S.hideFields.push(T.globalIdField));(Z=this._findFirst(S.fieldInfos,"fieldName",T.objectIdField))||
S.showObjectID||S.hideFields.push(T.objectIdField);var ha=this._getFields(S.featureLayer);if(ha){var na=S.fieldInfos||[];na=P.map(na,function(ja){return I.mixin({},ja)});na.length?S.fieldInfos=P.filter(P.map(na,I.hitch(this,function(ja){var oa=ja.stringFieldOption||(this._isInFields(ja.fieldName,S.htmlFields)?fa.STRING_FIELD_OPTION_RICHTEXT:fa.STRING_FIELD_OPTION_TEXTBOX);return I.mixin(ja,{field:this._findFirst(ha,"name",ja.fieldName),stringFieldOption:oa})})),"return item.field;"):(ha=P.filter(ha,
I.hitch(this,function(ja){return!this._isInFields(ja.name,S.hideFields)})),S.fieldInfos=P.map(ha,I.hitch(this,function(ja){var oa=this._isInFields(ja.name,S.htmlFields)?fa.STRING_FIELD_OPTION_RICHTEXT:fa.STRING_FIELD_OPTION_TEXTBOX;return{fieldName:ja.name,field:ja,stringFieldOption:oa}})));S.showGlobalID&&!X&&na.push(this._findFirst(ha,"name",T.globalIdField));S.showObjectID&&!Z&&na.push(this._findFirst(ha,"name",T.objectIdField));X=[];T.editFieldsInfo&&(T.editFieldsInfo.creatorField&&X.push(T.editFieldsInfo.creatorField),
T.editFieldsInfo.creationDateField&&X.push(T.editFieldsInfo.creationDateField),T.editFieldsInfo.editorField&&X.push(T.editFieldsInfo.editorField),T.editFieldsInfo.editDateField&&X.push(T.editFieldsInfo.editDateField));this._editorTrackingInfos[T.id]=X}},_createAttachmentEditor:function(){this._attachmentEditor=null;var S=P.filter(this._layerInfos,function(T){return T.showAttachments});S&&S.length&&(this._attachmentEditor=new D({"class":this.css.attachmentEditor},this.attachmentEditor),this._attachmentEditor.startup())},
_setCurrentLInfo:function(S){var T=this._currentLInfo?this._currentLInfo.featureLayer:null,X=S.featureLayer;if(T&&T.id===X.id&&!T.ownershipBasedAccessControlForFeatures&&(T=X.getEditCapabilities(),!T.canCreate||T.canUpdate))return;this._currentLInfo=S;this._createTable()},_updateSelection:function(S,T){this._selection=S||[];P.forEach(this._layerInfos,this._getSelection,this);this._selection=h.sortFeaturesById(this._layerInfos,this._selection);this._numFeatures=this._selection.length;this._showFeature(this._numFeatures?
this._selection[this._featureIdx]:null,T)},_getSelection:function(S){S=S.featureLayer.getSelectedFeatures();this._selection=this._selection.concat(S)},_updateUI:function(){var S=this._numFeatures,T=this._currentLInfo;this.layerName.innerHTML=T&&0!==S?T.featureLayer?T.featureLayer.name:"":this.NLS_noFeaturesSelected;q.set(this.attributeTable,"display",S?"":"none");q.set(this.editButtons,"display",S?"":"none");q.set(this.navButtons,"display",!this._hideNavButtons&&1<S?"":"none");this.navMessage.innerHTML=
H.substitute({idx:this._featureIdx+1,of:this.NLS_of,numFeatures:this._numFeatures},this._navMessage);this._attachmentEditor&&q.set(this._attachmentEditor.domNode,"display",T&&T.showAttachments&&S?"":"none");q.set(this.deleteBtn.domNode,"display",T&&!1===T.showDeleteButton||!this._canDelete?"none":"");this.domNode.parentNode&&0<this.domNode.parentNode.scrollTop&&(this.domNode.parentNode.scrollTop=0)},_onNextFeature:function(S){this._featureIdx+=S;0>this._featureIdx?this._featureIdx=this._numFeatures-
1:this._featureIdx>=this._numFeatures&&(this._featureIdx=0);S=this._selection.length?this._selection[this._featureIdx]:null;this._showFeature(S);this._updateUI();this.onNext(S)},_deleteFeature:function(){this.onDelete(this._currentFeature)},_showFeature:function(S,T){if(S){this._currentFeature=S;T=T?T:S.getLayer();var X=T.getEditCapabilities({feature:S,userId:this._userIds[T.id]});this._canUpdate=X.canUpdate;this._canDelete=X.canDelete;if(X=this._getLInfoFromFeatureLayer(T)){this._setCurrentLInfo(X);
var Z=S.attributes,ha=this._findFirst(X.types,"id",Z[X.typeIdField]),na=null;P.forEach(X.fieldInfos,function(ja){na=ja.field;var oa=[];ja.dijit&&1<ja.dijit.length?P.forEach(ja.dijit,function(ka){oa.push(ka)}):oa.push(ja.dijit);P.forEach(oa,I.hitch(this,function(ka){if(ka){var pa=this._setFieldDomain(ka,ha,na),ta=Z[na.name];ta=ta&&pa&&pa.codedValues&&pa.codedValues.length?pa.codedValues[ta]?pa.codedValues[ta].name:ta:ta;H.isDefined(ta)||(ta="");"dijit.form.DateTextBox"===ka.declaredClass||"dijit.form.TimeTextBox"===
ka.declaredClass?ta=""===ta?null:new Date(ta):"dijit.form.FilteringSelect"===ka.declaredClass&&(ka._lastValueReported=null,ta=Z[na.name]+"");try{this._setValue(ka,ta),"dijit.form.FilteringSelect"===ka.declaredClass&&!1===ka.isValid()&&this._setValue(ka,null)}catch(xa){ka.set("displayedValue",this.NLS_errorInvalid,!1)}}}))},this);this._attachmentEditor&&X.showAttachments&&this._attachmentEditor.showAttachments(this._currentFeature,T);(S=T.getEditSummary(S))?(this.editorTrackingInfoDiv.innerHTML=S,
d.show(this.editorTrackingInfoDiv)):d.hide(this.editorTrackingInfoDiv)}}},_setFieldDomain:function(S,T,X){if(!S)return null;var Z=X.domain;T&&T.domains&&T.domains[X.name]&&!1===T.domains[X.name]instanceof b&&(Z=T.domains[X.name]);if(!Z)return null;Z.codedValues&&0<Z.codedValues.length?(S.set("store",this._toStore(P.map(Z.codedValues,function(ha){return{id:ha.code+"",name:ha.name}}))),this._setValue(S,Z.codedValues[0].code+"")):(S.constraints={min:H.isDefined(Z.minValue)?Z.minValue:Number.MIN_VALUE,
max:H.isDefined(Z.maxValue)?Z.maxValue:Number.MAX_VALUE},this._setValue(S,S.constraints.min));return Z},_setValue:function(S,T){S.set&&(S._onChangeActive=!1,S.set("value",T,!0),S._onChangeActive=!0)},_getFields:function(S){var T=S._getOutFields();if(!T)return null;S=S.fields;return"*"==T?S:P.filter(P.map(T,I.hitch(this,"_findFirst",S,"name")),H.isDefined)},_isInFields:function(S,T){return S&&(T||T.length)?P.some(T,function(X){return X.toLowerCase()===S.toLowerCase()}):!1},_isFieldNullable:function(S,
T){return!(!1===S.nullable||T.field&&!1===T.field.nullable)},_isFieldRequired:function(S,T){return!1!==S.editable&&!1!==T.isEditable&&!this._isFieldNullable(S,T)},_findFirst:function(S,T,X){return(S=P.filter(S,function(Z){return Z.hasOwnProperty(T)&&Z[T]===X}))&&S.length?S[0]:null},_getLInfoFromFeatureLayer:function(S){return this._findFirst(this._layerInfos,"layerId",S?S.id:null)},_createTable:function(){this._destroyAttributeTable();this.attributeTable.innerHTML="";this._attributes=t.create("table",
{cellspacing:"0",cellpadding:"0"},this.attributeTable);var S=t.create("tbody",null,this._attributes),T=this._currentLInfo,X=this._findFirst(T.types,"id",this._currentFeature.attributes[T.typeIdField]);P.forEach(T.fieldInfos,I.hitch(this,"_createField",X,S),this);this._createOnlyFirstTime=!1},_createField:function(S,T,X){var Z=this._currentLInfo,ha=X.field;if(!this._isInFields(ha.name,Z.hideFields)&&!this._isInFields(ha.name,this._editorTrackingInfos[Z.featureLayer.id])){var na=!1,ja;T=t.create("tr",
null,T);var oa=t.create("td",{innerHTML:X.label||ha.alias||ha.name,"class":this.css.label,"data-fieldname":ha.name},T);this._isFieldRequired(ha,X)&&t.create("span",{"class":this.css.red,innerHTML:" *"},oa);T=t.create("td",null,T);if(X.customField){t.place(X.customField.domNode||X.customField,t.create("div",null,T),"first");var ka=X.customField}else if(!1===Z.isEditable||!1===ha.editable||!1===X.isEditable||"esriFieldTypeOID"===ha.type||"esriFieldTypeGlobalID"===ha.type||!this._canUpdate&&!this._createOnlyFirstTime)na=
!0;Z=Z.typeIdField&&ha.name.toLowerCase()==Z.typeIdField.toLowerCase();oa=!!this._getDomainForField(ha,S);!ka&&Z?ka=this._createTypeField(ha,X,T):!ka&&oa&&(ka=this._createDomainField(ha,X,S,T));if(!ka)switch(ha.type){case "esriFieldTypeString":ka=this._createStringField(ha,X,T);break;case "esriFieldTypeDate":ka=this._createDateField(ha,X,T);X.format&&X.format.time&&(ja=this._createTimeField(ha,X,T));break;case "esriFieldTypeInteger":case "esriFieldTypeSmallInteger":ka=this._createIntField(ha,X,T);
break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":ka=this._createFltField(ha,X,T);break;default:ka=this._createStringField(ha,X,T)}X.tooltip&&X.tooltip.length&&this._toolTips.push(new w({connectId:[ka.id],label:X.tooltip}));ka.onChange=I.hitch(this,"onFieldValueChange",X);ka.set("disabled",na);ja?(X.dijit=[ka,ja],ja.onChange=I.hitch(this,"onFieldValueChange",X),ja.set("disabled",na)):X.dijit=ka}},_createTypeField:function(S,T,X){X=t.create("div",null,X);var Z=S.domain;return Z&&"range"===
Z.type&&Z.minValue===Z.maxValue?new l({"class":this.css.field,trim:!0,maxLength:S.length,name:S.alias||S.name,required:this._isFieldRequired(S,T)},X):new R({"class":this.css.field,name:S.alias||S.name,required:this._isFieldRequired(S,T),store:this._toStore(P.map(this._currentLInfo.types,function(ha){return{id:ha.id,name:ha.name}})),searchAttr:"name"},X)},_getDomainForField:function(S,T){var X=S.domain;(S=S.name)&&T&&T.domains&&T.domains[S]&&!1===T.domains[S]instanceof b&&(X=T.domains[S]);return X||
null},_createDomainField:function(S,T,X,Z){X=this._getDomainForField(S,X);Z=t.create("div",null,Z);return X.codedValues?new R({"class":this.css.field,name:S.alias||S.name,searchAttr:"name",required:this._isFieldRequired(S,T)},Z):new a({"class":this.css.field},Z)},_createStringField:function(S,T,X){X=t.create("div",null,X);var Z={trim:!0,maxLength:S.length,required:this._isFieldRequired(S,T)};if(T.stringFieldOption===fa.STRING_FIELD_OPTION_TEXTAREA)return Z["class"]=this.css.field+" "+this.css.textArea,
new G(Z,X);if(T.stringFieldOption===fa.STRING_FIELD_OPTION_RICHTEXT)return Z["class"]=this.css.field+" "+this.css.richText,Z.height="100%",Z.width="100%",Z.plugins=T.richTextPlugins||this._defaultRichTextPlugins,X=new C(Z,X),X.startup(),X;var ha=this;Z.validator=function(na,ja){this._maskValidSubsetError=!1;this._hasBeenBlurred=!0;return ha._isFieldNullable(S,T)||!(""===na||null===na)};return new l(Z,X)},_createTimeField:function(S,T,X){X=t.create("div",null,X);S={"class":this.css.field,trim:!0,required:this._isFieldRequired(S,
T),constraints:{formatLength:"medium"}};this._datePackage&&(S.datePackage=this._datePackage);return new g(S,X)},_createDateField:function(S,T,X){X=t.create("div",null,X);S={"class":this.css.field,trim:!0,required:this._isFieldRequired(S,T)};this._datePackage&&(S.datePackage=this._datePackage);return new N(S,X)},_createIntField:function(S,T,X){X=t.create("div",null,X);return new O({"class":this.css.field,constraints:"esriFieldTypeSmallInteger"===S.type?{min:-32768,max:32767,places:0}:{places:0},trim:!0,
invalidMessage:this.NLS_validationInt,required:this._isFieldRequired(S,T)},X)},_createFltField:function(S,T,X){X=t.create("div",null,X);return new O({"class":this.css.field,constraints:{max:Infinity,min:-Infinity,places:"0,20"},trim:!0,invalidMessage:this.NLS_validationFlt,required:this._isFieldRequired(S,T)},X)},_toStore:function(S){return new M({data:{identifier:"id",label:"name",items:S}})},_connect:function(S,T,X){this._aiConnects.push(V.connect(S,T,X))},_getDatePackage:function(S){return null===
S.datePackage?null:S.datePackage?S.datePackage:"ar"===x.locale?"dojox.date.islamic":null},_destroyAttributeTable:function(){P.forEach(this._layerInfos,function(S){P.forEach(S.fieldInfos,function(T){var X=T.dijit;if(X){X._onChangeHandle=null;if(T.customField)return;X instanceof Array?P.forEach(X,I.hitch(this,function(Z){Z.destroyRecursive?Z.destroyRecursive():Z.destroy&&Z.destroy();Z._onChangeHandle=null})):X.destroyRecursive?X.destroyRecursive():X.destroy&&X.destroy()}T.dijit=null},this)},this);P.forEach(this._toolTips,
function(S){S.destroy()});this._toolTips=[];this._attributes&&t.destroy(this._attributes)}});I.mixin(fa,{STRING_FIELD_OPTION_RICHTEXT:"richtext",STRING_FIELD_OPTION_TEXTAREA:"textarea",STRING_FIELD_OPTION_TEXTBOX:"textbox"});n("extend-esri")&&I.setObject("dijit.AttributeInspector",fa,v);return fa})},"dijit/Editor":function(){define("require dojo/_base/array dojo/_base/declare dojo/Deferred dojo/i18n dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/string dojo/topic ./_Container ./Toolbar ./ToolbarSeparator ./layout/_LayoutWidget ./form/ToggleButton ./_editor/_Plugin ./_editor/plugins/EnterKeyHandling ./_editor/html ./_editor/range ./_editor/RichText ./main dojo/i18n!./_editor/nls/commands".split(" "),
function(Q,I,P,V,J,x,n,q,t,v,H,d,b,m,k,e,c,f,A,C,F,z,K,D,h){function B(E){return new C({command:E.name})}function N(E){return new C({buttonClass:A,command:E.name})}P=P("dijit.Editor",D,{plugins:null,extraPlugins:null,constructor:function(){H.isArray(this.plugins)||(this.plugins=["undo","redo","|","cut","copy","paste","|","bold","italic","underline","strikethrough","|","insertOrderedList","insertUnorderedList","indent","outdent","|","justifyLeft","justifyRight","justifyCenter","justifyFull",F]);this._plugins=
[];this._editInterval=1E3*this.editActionInterval;if(d("ie")||d("trident")||d("edge"))this.events.push("onBeforeDeactivate"),this.events.push("onBeforeActivate")},postMixInProperties:function(){this.setValueDeferred=new V;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._steps=this._steps.slice(0);this._undoedSteps=this._undoedSteps.slice(0);H.isArray(this.extraPlugins)&&(this.plugins=this.plugins.concat(this.extraPlugins));this.commands=J.getLocalization("dijit._editor",
"commands",this.lang);d("webkit")&&t.set(this.domNode,"KhtmlUserSelect","none")},startup:function(){this.inherited(arguments);this.toolbar||(this.toolbar=new e({ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,"aria-label":this.id}),this.header.appendChild(this.toolbar.domNode));I.forEach(this.plugins,this.addPlugin,this);this.setValueDeferred.resolve(!0);n.add(this.iframe.parentNode,"dijitEditorIFrameContainer");n.add(this.iframe,"dijitEditorIFrame");x.set(this.iframe,"allowTransparency",
!0);this.toolbar.startup();this.onNormalizedDisplayChanged()},destroy:function(){I.forEach(this._plugins,function(E){E&&E.destroy&&E.destroy()});this._plugins=[];this.toolbar.destroyRecursive();delete this.toolbar;this.inherited(arguments)},addPlugin:function(E,O){var R=H.isString(E)?{name:E}:H.isFunction(E)?{ctor:E}:E;if(!R.setEditor){var a={args:R,plugin:null,editor:this};R.name&&(C.registry[R.name]?a.plugin=C.registry[R.name](R):m.publish(h._scopeName+".Editor.getPlugin",a));if(!a.plugin)try{var u=
R.ctor||H.getObject(R.name)||Q(R.name);u&&(a.plugin=new u(R))}catch(G){throw Error(this.id+": cannot find plugin ["+R.name+"]");}if(!a.plugin)throw Error(this.id+": cannot find plugin ["+R.name+"]");E=a.plugin}1<arguments.length?this._plugins[O]=E:this._plugins.push(E);E.setEditor(this);H.isFunction(E.setToolbar)&&E.setToolbar(this.toolbar)},resize:function(E){E&&f.prototype.resize.apply(this,arguments)},layout:function(){var E=this._contentBox.h-(this.getHeaderHeight()+this.getFooterHeight()+q.getPadBorderExtents(this.iframe.parentNode).h+
q.getMarginExtents(this.iframe.parentNode).h);this.editingArea.style.height=E+"px";this.iframe&&(this.iframe.style.height="100%");this._layoutMode=!0},_onIEMouseDown:function(E){var O,R=this.document.body,a=R.clientWidth,u=R.clientHeight,G=R.clientLeft,l=R.offsetWidth,g=R.offsetHeight,w=R.offsetLeft;/^rtl$/i.test(R.dir||"")?a<l&&E.x>a&&E.x<l&&(O=!0):E.x<G&&E.x>w&&(O=!0);O||u<g&&E.y>u&&E.y<g&&(O=!0);O||(delete this._cursorToStart,delete this._savedSelection,"BODY"==E.target.tagName&&this.defer("placeCursorAtEnd"),
this.inherited(arguments))},onBeforeActivate:function(){this._restoreSelection()},onBeforeDeactivate:function(E){this.customUndo&&this.endEditing(!0);"BODY"!=E.target.tagName&&this._saveSelection()},customUndo:!0,editActionInterval:3,beginEditing:function(E){this._inEditing||(this._inEditing=!0,this._beginEditing(E));0<this.editActionInterval&&(this._editTimer&&this._editTimer.remove(),this._editTimer=this.defer("endEditing",this._editInterval))},_steps:[],_undoedSteps:[],execCommand:function(E){if(!this.customUndo||
"undo"!=E&&"redo"!=E){this.customUndo&&(this.endEditing(),this._beginEditing());var O=this.inherited(arguments);this.customUndo&&this._endEditing();return O}return this[E]()},_pasteImpl:function(){return this._clipboardCommand("paste")},_cutImpl:function(){return this._clipboardCommand("cut")},_copyImpl:function(){return this._clipboardCommand("copy")},_clipboardCommand:function(E){try{var O=this.document.execCommand(E,!1,null);if(d("webkit")&&!O)throw{};}catch(R){O=b.substitute,alert(O(this.commands.systemShortcut,
[this.commands[E],O(this.commands[d("mac")?"appleKey":"ctrlKey"],[{cut:"X",copy:"C",paste:"V"}[E]])])),O=!1}return O},queryCommandEnabled:function(E){return!this.customUndo||"undo"!=E&&"redo"!=E?this.inherited(arguments):"undo"==E?1<this._steps.length:0<this._undoedSteps.length},_moveToBookmark:function(E){var O=E.mark,R=E.mark;E=E.isCollapsed;var a;if(R)if(9>d("ie")||9===d("ie")&&d("quirks"))if(H.isArray(R))O=[],I.forEach(R,function(l){O.push(K.getNode(l,this.editNode))},this),this.selection.moveToBookmark({mark:O,
isCollapsed:E});else{if(R.startContainer&&R.endContainer&&(a=K.getSelection(this.window))&&a.removeAllRanges){a.removeAllRanges();E=K.create(this.window);var u=K.getNode(R.startContainer,this.editNode);var G=K.getNode(R.endContainer,this.editNode);u&&G&&(E.setStart(u,R.startOffset),E.setEnd(G,R.endOffset),a.addRange(E))}}else(a=K.getSelection(this.window))&&a.removeAllRanges&&(a.removeAllRanges(),E=K.create(this.window),u=K.getNode(R.startContainer,this.editNode),G=K.getNode(R.endContainer,this.editNode),
u&&G&&(E.setStart(u,R.startOffset),E.setEnd(G,R.endOffset),a.addRange(E)))},_changeToStep:function(E,O){this.setValue(O.text);(E=O.bookmark)&&this._moveToBookmark(E)},undo:function(){var E=!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var O=this._steps.pop();O&&0<this._steps.length&&(this.focus(),this._changeToStep(O,this._steps[this._steps.length-1]),this._undoedSteps.push(O),this.onDisplayChanged(),delete this._undoRedoActive,E=!0);delete this._undoRedoActive}return E},
redo:function(){var E=!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var O=this._undoedSteps.pop();O&&0<this._steps.length&&(this.focus(),this._changeToStep(this._steps[this._steps.length-1],O),this._steps.push(O),this.onDisplayChanged(),E=!0);delete this._undoRedoActive}return E},endEditing:function(E){this._editTimer&&(this._editTimer=this._editTimer.remove());this._inEditing&&(this._endEditing(E),this._inEditing=!1)},_getBookmark:function(){var E=this.selection.getBookmark(),
O=[];if(E&&E.mark){var R=E.mark;if(9>d("ie")||9===d("ie")&&d("quirks")){var a=K.getSelection(this.window);if(H.isArray(R))I.forEach(E.mark,function(G){O.push(K.getIndex(G,this.editNode).o)},this),E.mark=O;else if(a){var u;a.rangeCount&&(u=a.getRangeAt(0));E.mark=u?u.cloneRange():this.selection.getBookmark()}}try{E.mark&&E.mark.startContainer&&(O=K.getIndex(E.mark.startContainer,this.editNode).o,E.mark={startContainer:O,startOffset:E.mark.startOffset,endContainer:E.mark.endContainer===E.mark.startContainer?
O:K.getIndex(E.mark.endContainer,this.editNode).o,endOffset:E.mark.endOffset})}catch(G){E.mark=null}}return E},_beginEditing:function(){0===this._steps.length&&this._steps.push({text:z.getChildrenHtml(this.editNode),bookmark:this._getBookmark()})},_endEditing:function(){var E=z.getChildrenHtml(this.editNode);this._undoedSteps=[];this._steps.push({text:E,bookmark:this._getBookmark()})},onKeyDown:function(E){d("ie")||this.iframe||E.keyCode!=v.TAB||this.tabIndent||this._saveSelection();if(this.customUndo){var O=
E.keyCode;if(E.ctrlKey&&!E.shiftKey&&!E.altKey){if(90==O||122==O){E.stopPropagation();E.preventDefault();this.undo();return}if(89==O||121==O){E.stopPropagation();E.preventDefault();this.redo();return}}this.inherited(arguments);switch(O){case v.ENTER:case v.BACKSPACE:case v.DELETE:this.beginEditing();break;case 88:case 86:if(E.ctrlKey&&!E.altKey&&!E.metaKey){this.endEditing();88==E.keyCode?this.beginEditing("cut"):this.beginEditing("paste");this.defer("endEditing",1);break}default:if(!E.ctrlKey&&!E.altKey&&
!E.metaKey&&(E.keyCode<v.F1||E.keyCode>v.F15)){this.beginEditing();break}case v.ALT:this.endEditing();break;case v.UP_ARROW:case v.DOWN_ARROW:case v.LEFT_ARROW:case v.RIGHT_ARROW:case v.HOME:case v.END:case v.PAGE_UP:case v.PAGE_DOWN:this.endEditing(!0);case v.CTRL:case v.SHIFT:case v.TAB:}}else this.inherited(arguments)},_onBlur:function(){this.inherited(arguments);this.endEditing(!0)},_saveSelection:function(){try{this._savedSelection=this._getBookmark()}catch(E){}},_restoreSelection:function(){this._savedSelection&&
(delete this._cursorToStart,this.selection.isCollapsed()&&this._moveToBookmark(this._savedSelection),delete this._savedSelection)},onClick:function(){this.endEditing(!0);this.inherited(arguments)},replaceValue:function(E){this.customUndo?this.isClosed?this.setValue(E):(this.beginEditing(),E||(E="\x26#160;"),this.setValue(E),this.endEditing()):this.inherited(arguments)},_setDisabledAttr:function(E){this.setValueDeferred.then(H.hitch(this,function(){!this.disabled&&E||!this._buttonEnabledPlugins&&E?
I.forEach(this._plugins,function(O){O.set("disabled",!0)}):this.disabled&&!E&&I.forEach(this._plugins,function(O){O.set("disabled",!1)})}));this.inherited(arguments)},_setStateClass:function(){try{this.inherited(arguments),this.document&&this.document.body&&(t.set(this.document.body,"color",t.get(this.iframe,"color")),t.set(this.document.body,"background-color",t.get(this.iframe,"background-color")))}catch(E){}}});H.mixin(C.registry,{undo:B,redo:B,cut:B,copy:B,paste:B,insertOrderedList:B,insertUnorderedList:B,
indent:B,outdent:B,justifyCenter:B,justifyFull:B,justifyLeft:B,justifyRight:B,"delete":B,selectAll:B,removeFormat:B,unlink:B,insertHorizontalRule:B,bold:N,italic:N,underline:N,strikethrough:N,subscript:N,superscript:N,"|":function(){return new C({setEditor:function(E){this.editor=E;this.button=new c({ownerDocument:E.ownerDocument})}})}});return P})},"dijit/Toolbar":function(){define("require dojo/_base/declare dojo/has dojo/keys dojo/ready ./_Widget ./_KeyNavContainer ./_TemplatedMixin".split(" "),
function(Q,I,P,V,J,x,n,q){P("dijit-legacy-requires")&&J(0,function(){Q(["dijit/ToolbarSeparator"])});return I("dijit.Toolbar",[x,q,n],{templateString:'\x3cdiv class\x3d"dijit" role\x3d"toolbar" tabIndex\x3d"${tabIndex}" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e',baseClass:"dijitToolbar",_onLeftArrow:function(){this.focusPrev()},_onRightArrow:function(){this.focusNext()}})})},"dijit/ToolbarSeparator":function(){define(["dojo/_base/declare","dojo/dom","./_Widget","./_TemplatedMixin"],
function(Q,I,P,V){return Q("dijit.ToolbarSeparator",[P,V],{templateString:'\x3cdiv class\x3d"dijitToolbarSeparator dijitInline" role\x3d"presentation"\x3e\x3c/div\x3e',buildRendering:function(){this.inherited(arguments);I.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"dijit/_editor/_Plugin":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","../Destroyable","../form/Button"],function(Q,I,P,V,J){I=I("dijit._editor._Plugin",V,{constructor:function(x){this.params=
x||{};P.mixin(this,this.params);this._attrPairNames={}},editor:null,iconClassPrefix:"dijitEditorIcon",button:null,command:"",useDefaultCommand:!0,buttonClass:J,disabled:!1,getLabel:function(x){return this.editor.commands[x]},_initButton:function(){if(this.command.length){var x=this.getLabel(this.command),n=this.editor,q=this.iconClassPrefix+" "+this.iconClassPrefix+this.command.charAt(0).toUpperCase()+this.command.substr(1);this.button||(x=P.mixin({label:x,ownerDocument:n.ownerDocument,dir:n.dir,
lang:n.lang,showLabel:!1,iconClass:q,dropDown:this.dropDown,tabIndex:"-1"},this.params||{}),delete x.name,this.button=new this.buttonClass(x))}this.get("disabled")&&this.button&&this.button.set("disabled",this.get("disabled"))},destroy:function(){this.dropDown&&this.dropDown.destroyRecursive();this.inherited(arguments)},connect:function(x,n,q){this.own(Q.connect(x,n,this,q))},updateState:function(){var x=this.editor,n=this.command;if(x&&x.isLoaded&&n.length){var q=this.get("disabled");if(this.button)try{var t=
x._implCommand(n);var v=!q&&(this[t]?this[t](n):x.queryCommandEnabled(n));this.enabled!==v&&(this.enabled=v,this.button.set("disabled",!v));if(v&&"boolean"==typeof this.button.checked){var H=x.queryCommandState(n);this.checked!==H&&(this.checked=H,this.button.set("checked",x.queryCommandState(n)))}}catch(d){console.log(d)}}},setEditor:function(x){this.editor=x;this._initButton();this.button&&this.useDefaultCommand&&(this.editor.queryCommandAvailable(this.command)?this.own(this.button.on("click",P.hitch(this.editor,
"execCommand",this.command,this.commandArg))):this.button.domNode.style.display="none");this.own(this.editor.on("NormalizedDisplayChanged",P.hitch(this,"updateState")))},setToolbar:function(x){this.button&&x.addChild(this.button)},set:function(x,n){if("object"===typeof x){for(var q in x)this.set(q,x[q]);return this}q=this._getAttrNames(x);if(this[q.s])var t=this[q.s].apply(this,Array.prototype.slice.call(arguments,1));else this._set(x,n);return t||this},get:function(x){var n=this._getAttrNames(x);
return this[n.g]?this[n.g]():this[x]},_setDisabledAttr:function(x){this._set("disabled",x);this.updateState()},_getAttrNames:function(x){var n=this._attrPairNames;if(n[x])return n[x];var q=x.charAt(0).toUpperCase()+x.substr(1);return n[x]={s:"_set"+q+"Attr",g:"_get"+q+"Attr"}},_set:function(x,n){this[x]=n}});I.registry={};return I})},"dijit/_editor/plugins/EnterKeyHandling":function(){define("dojo/_base/declare dojo/dom-construct dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ../_Plugin ../RichText ../range".split(" "),
function(Q,I,P,V,J,x,n,q,t,v,H){return Q("dijit._editor.plugins.EnterKeyHandling",t,{blockNodeForEnter:"BR",constructor:function(d){d&&("blockNodeForEnter"in d&&(d.blockNodeForEnter=d.blockNodeForEnter.toUpperCase()),V.mixin(this,d))},setEditor:function(d){if(this.editor!==d)if(this.editor=d,"BR"==this.blockNodeForEnter)this.editor.customUndo=!0,d.onLoadDeferred.then(V.hitch(this,function(m){this.own(J(d.document,"keydown",V.hitch(this,function(k){if(k.keyCode==P.ENTER){var e=V.mixin({},k);e.shiftKey=
!0;this.handleEnterKey(e)||(k.stopPropagation(),k.preventDefault())}})));9<=x("ie")&&10>=x("ie")&&this.own(J(d.document,"paste",V.hitch(this,function(k){setTimeout(V.hitch(this,function(){var e=this.editor.document.selection.createRange();e.move("character",-1);e.select();e.move("character",1);e.select()}),0)})));return m}));else if(this.blockNodeForEnter){var b=V.hitch(this,"handleEnterKey");d.addKeyHandler(13,0,0,b);d.addKeyHandler(13,0,1,b);this.own(this.editor.on("KeyPressed",V.hitch(this,"onKeyPressed")))}},
onKeyPressed:function(){if(this._checkListLater){if(this.editor.selection.isCollapsed()){var d=this.editor.selection.getAncestorElement("LI");if(d){x("mozilla")&&"LI"==d.parentNode.parentNode.nodeName&&(d=d.parentNode.parentNode);var b=d.firstChild;!b||1!=b.nodeType||"UL"!=b.nodeName&&"OL"!=b.nodeName||(d.insertBefore(b.ownerDocument.createTextNode("\u00a0"),b),b=H.create(this.editor.window),b.setStart(d.firstChild,0),d=H.getSelection(this.editor.window,!0),d.removeAllRanges(),d.addRange(b))}else v.prototype.execCommand.call(this.editor,
"formatblock",this.blockNodeForEnter),(d=this.editor.selection.getAncestorElement(this.blockNodeForEnter))?(d.innerHTML=this.bogusHtmlContent,9>=x("ie")&&(d=this.editor.document.selection.createRange(),d.move("character",-1),d.select())):console.error("onKeyPressed: Cannot find the new block node")}this._checkListLater=!1}this._pressedEnterInBlock&&(this._pressedEnterInBlock.previousSibling&&this.removeTrailingBr(this._pressedEnterInBlock.previousSibling),delete this._pressedEnterInBlock)},bogusHtmlContent:"\x26#160;",
blockNodes:/^(?:P|H1|H2|H3|H4|H5|H6|LI)$/,handleEnterKey:function(d){var b,m=this.editor.document,k;if(d.shiftKey){d=this.editor.selection.getParentElement();if(b=H.getAncestor(d,this.blockNodes)){if("LI"==b.tagName)return!0;d=H.getSelection(this.editor.window);var e=d.getRangeAt(0);e.collapsed||(e.deleteContents(),d=H.getSelection(this.editor.window),e=d.getRangeAt(0));if(H.atBeginningOfContainer(b,e.startContainer,e.startOffset)){var c=m.createElement("br");e=H.create(this.editor.window);b.insertBefore(c,
b.firstChild);e.setStartAfter(c);d.removeAllRanges();d.addRange(e)}else if(H.atEndOfContainer(b,e.startContainer,e.startOffset))e=H.create(this.editor.window),c=m.createElement("br"),b.appendChild(c),b.appendChild(m.createTextNode("\u00a0")),e.setStart(b.lastChild,0),d.removeAllRanges(),d.addRange(e);else{if((k=e.startContainer)&&3==k.nodeType){var f=k.nodeValue;var A=m.createTextNode(f.substring(0,e.startOffset));var C=m.createTextNode(f.substring(e.startOffset));b=m.createElement("br");""==C.nodeValue&&
x("webkit")&&(C=m.createTextNode("\u00a0"));I.place(A,k,"after");I.place(b,A,"after");I.place(C,b,"after");I.destroy(k);e=H.create(this.editor.window);e.setStart(C,0);d.removeAllRanges();d.addRange(e);return!1}return!0}}else d=H.getSelection(this.editor.window),d.rangeCount?(e=d.getRangeAt(0))&&e.startContainer&&(e.collapsed||(e.deleteContents(),d=H.getSelection(this.editor.window),e=d.getRangeAt(0)),(k=e.startContainer)&&3==k.nodeType?(b=e.startOffset,k.length<b&&(C=this._adjustNodeAndOffset(k,b),
k=C.node,b=C.offset),f=k.nodeValue,A=m.createTextNode(f.substring(0,b)),C=m.createTextNode(f.substring(b)),b=m.createElement("br"),C.length||(C=m.createTextNode("\u00a0")),A.length?I.place(A,k,"after"):A=k,I.place(b,A,"after"),I.place(C,b,"after"),I.destroy(k)):(0<=e.startOffset&&(c=k.childNodes[e.startOffset]),b=m.createElement("br"),C=m.createTextNode("\u00a0"),c?(I.place(b,c,"before"),I.place(C,b,"after")):(k.appendChild(b),k.appendChild(C))),e=H.create(this.editor.window),e.setStart(C,0),e.setEnd(C,
C.length),d.removeAllRanges(),d.addRange(e),this.editor.selection.collapse(!0)):v.prototype.execCommand.call(this.editor,"inserthtml","\x3cbr\x3e");return!1}var F=!0;d=H.getSelection(this.editor.window);e=d.getRangeAt(0);e.collapsed||(e.deleteContents(),d=H.getSelection(this.editor.window),e=d.getRangeAt(0));c=H.getBlockAncestor(e.endContainer,null,this.editor.editNode);var z=c.blockNode;if(this._checkListLater=z&&("LI"==z.nodeName||"LI"==z.parentNode.nodeName))return x("mozilla")&&(this._pressedEnterInBlock=
z),/^(\s|&nbsp;|&#160;|\xA0|<span\b[^>]*\bclass=['"]Apple-style-span['"][^>]*>(\s|&nbsp;|&#160;|\xA0)<\/span>)?(<br>)?$/.test(z.innerHTML)&&(z.innerHTML="",x("webkit")&&(e=H.create(this.editor.window),e.setStart(z,0),d.removeAllRanges(),d.addRange(e)),this._checkListLater=!1),!0;if(!c.blockNode||c.blockNode===this.editor.editNode){try{v.prototype.execCommand.call(this.editor,"formatblock",this.blockNodeForEnter)}catch(K){}c={blockNode:this.editor.selection.getAncestorElement(this.blockNodeForEnter),
blockContainer:this.editor.editNode};if(c.blockNode){if(c.blockNode!=this.editor.editNode&&!(c.blockNode.textContent||c.blockNode.innerHTML).replace(/^\s+|\s+$/g,"").length)return this.removeTrailingBr(c.blockNode),!1}else c.blockNode=this.editor.editNode;d=H.getSelection(this.editor.window);e=d.getRangeAt(0)}z=m.createElement(this.blockNodeForEnter);z.innerHTML=this.bogusHtmlContent;this.removeTrailingBr(c.blockNode);C=e.endOffset;F=e.endContainer;F.length<C&&(C=this._adjustNodeAndOffset(F,C),F=
C.node,C=C.offset);if(H.atEndOfContainer(c.blockNode,F,C))c.blockNode===c.blockContainer?c.blockNode.appendChild(z):I.place(z,c.blockNode,"after"),F=!1,e=H.create(this.editor.window),e.setStart(z,0),d.removeAllRanges(),d.addRange(e),this.editor.height&&q.scrollIntoView(z);else if(H.atBeginningOfContainer(c.blockNode,e.startContainer,e.startOffset))I.place(z,c.blockNode,c.blockNode===c.blockContainer?"first":"before"),z.nextSibling&&this.editor.height&&(e=H.create(this.editor.window),e.setStart(z.nextSibling,
0),d.removeAllRanges(),d.addRange(e),q.scrollIntoView(z.nextSibling)),F=!1;else{c.blockNode===c.blockContainer?c.blockNode.appendChild(z):I.place(z,c.blockNode,"after");F=!1;c.blockNode.style&&z.style&&c.blockNode.style.cssText&&(z.style.cssText=c.blockNode.style.cssText);if((k=e.startContainer)&&3==k.nodeType){C=e.endOffset;k.length<C&&(C=this._adjustNodeAndOffset(k,C),k=C.node,C=C.offset);f=k.nodeValue;A=m.createTextNode(f.substring(0,C));C=m.createTextNode(f.substring(C,f.length));I.place(A,k,
"before");I.place(C,k,"after");I.destroy(k);for(e=A.parentNode;e!==c.blockNode;){f=m.createElement(e.tagName);e.style&&f.style&&e.style.cssText&&(f.style.cssText=e.style.cssText);"FONT"===e.tagName&&(e.color&&(f.color=e.color),e.face&&(f.face=e.face),e.size&&(f.size=e.size));for(;C;)k=C.nextSibling,f.appendChild(C),C=k;I.place(f,e,"after");A=e;C=f;e=e.parentNode}if(1==C.nodeType||3==C.nodeType&&C.nodeValue)z.innerHTML="";for(A=C;C;)k=C.nextSibling,z.appendChild(C),C=k}e=H.create(this.editor.window);
m=A;if("BR"!==this.blockNodeForEnter){for(;m;)b=m,m=k=m.firstChild;b&&b.parentNode?(z=b.parentNode,e.setStart(z,0),d.removeAllRanges(),d.addRange(e),this.editor.height&&q.scrollIntoView(z),x("mozilla")&&(this._pressedEnterInBlock=c.blockNode)):F=!0}else e.setStart(z,0),d.removeAllRanges(),d.addRange(e),this.editor.height&&q.scrollIntoView(z),x("mozilla")&&(this._pressedEnterInBlock=c.blockNode)}return F},_adjustNodeAndOffset:function(d,b){for(;d.length<b&&d.nextSibling&&3==d.nextSibling.nodeType;)b-=
d.length,d=d.nextSibling;return{node:d,offset:b}},removeTrailingBr:function(d){if(d=/P|DIV|LI/i.test(d.tagName)?d:this.editor.selection.getParentOfType(d,["P","DIV","LI"]))d.lastChild&&(1<d.childNodes.length&&3==d.lastChild.nodeType&&/^[\s\xAD]*$/.test(d.lastChild.nodeValue)||"BR"==d.lastChild.tagName)&&I.destroy(d.lastChild),d.childNodes.length||(d.innerHTML=this.bogusHtmlContent)}})})},"dijit/_editor/RichText":function(){define("dojo/_base/array dojo/_base/config dojo/_base/declare dojo/_base/Deferred dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/query dojo/domReady dojo/sniff dojo/string dojo/topic dojo/_base/unload dojo/_base/url dojo/window ../_Widget ../_CssStateMixin ../selection ./range ./html ../focus ../main".split(" "),
function(Q,I,P,V,J,x,n,q,t,v,H,d,b,m,k,e,c,f,A,C,F,z,K,D,h,B,N,E,O){var R=P("dijit._editor.RichText",[K,D],{constructor:function(a){this.contentPreFilters=[];this.contentPostFilters=[];this.contentDomPreFilters=[];this.contentDomPostFilters=[];this.editingAreaStyleSheets=[];this.events=[].concat(this.events);this._keyHandlers={};a&&b.isString(a.value)&&(this.value=a.value);this.onLoadDeferred=new V},baseClass:"dijitEditor",inheritWidth:!1,focusOnLoad:!1,name:"",styleSheets:"",height:"300px",minHeight:"1em",
isClosed:!0,isLoaded:!1,_SEPARATOR:"@@**%%__RICHTEXTBOUNDRY__%%**@@",_NAME_CONTENT_SEP:"@@**%%:%%**@@",onLoadDeferred:null,isTabIndent:!1,disableSpellCheck:!1,postCreate:function(){"textarea"===this.domNode.tagName.toLowerCase()&&console.warn("RichText should not be used with the TEXTAREA tag.  See dijit._editor.RichText docs.");this.contentPreFilters=[b.trim,b.hitch(this,"_preFixUrlAttributes")].concat(this.contentPreFilters);c("mozilla")&&(this.contentPreFilters=[this._normalizeFontStyle].concat(this.contentPreFilters),
this.contentPostFilters=[this._removeMozBogus].concat(this.contentPostFilters));c("webkit")&&(this.contentPreFilters=[this._removeWebkitBogus].concat(this.contentPreFilters),this.contentPostFilters=[this._removeWebkitBogus].concat(this.contentPostFilters));if(c("ie")||c("trident"))this.contentPostFilters=[this._normalizeFontStyle].concat(this.contentPostFilters),this.contentDomPostFilters=[b.hitch(this,"_stripBreakerNodes")].concat(this.contentDomPostFilters);this.contentDomPostFilters=[b.hitch(this,
"_stripTrailingEmptyNodes")].concat(this.contentDomPostFilters);this.inherited(arguments);A.publish(O._scopeName+"._editor.RichText::init",this)},startup:function(){this.inherited(arguments);this.open();this.setupDefaultShortcuts()},setupDefaultShortcuts:function(){var a=b.hitch(this,function(l,g){return function(){return!this.execCommand(l,g)}}),u={b:a("bold"),i:a("italic"),u:a("underline"),a:a("selectall"),s:function(){this.save(!0)},m:function(){this.isTabIndent=!this.isTabIndent},1:a("formatblock",
"h1"),2:a("formatblock","h2"),3:a("formatblock","h3"),4:a("formatblock","h4"),"\\":a("insertunorderedlist")};c("ie")||(u.Z=a("redo"));for(var G in u)this.addKeyHandler(G,!0,!1,u[G])},events:["onKeyDown","onKeyUp"],captureEvents:[],_editorCommandsLocalized:!1,_localizeEditorCommands:function(){if(R._editorCommandsLocalized)this._local2NativeFormatNames=R._local2NativeFormatNames,this._native2LocalFormatNames=R._native2LocalFormatNames;else{R._editorCommandsLocalized=!0;R._local2NativeFormatNames={};
R._native2LocalFormatNames={};this._local2NativeFormatNames=R._local2NativeFormatNames;this._native2LocalFormatNames=R._native2LocalFormatNames;for(var a="div p pre h1 h2 h3 h4 h5 h6 ol ul address".split(" "),u="",G,l=0;G=a[l++];)u="l"!==G.charAt(1)?u+("\x3c"+G+"\x3e\x3cspan\x3econtent\x3c/span\x3e\x3c/"+G+"\x3e\x3cbr/\x3e"):u+("\x3c"+G+"\x3e\x3cli\x3econtent\x3c/li\x3e\x3c/"+G+"\x3e\x3cbr/\x3e");var g=q.create("div",{style:{position:"absolute",top:"0px",zIndex:10,opacity:.01},innerHTML:u});this.ownerDocumentBody.appendChild(g);
a=b.hitch(this,function(){for(var w=g.firstChild;w;)try{this.selection.selectElement(w.firstChild);var M=w.tagName.toLowerCase();this._local2NativeFormatNames[M]=document.queryCommandValue("formatblock");this._native2LocalFormatNames[this._local2NativeFormatNames[M]]=M;w=w.nextSibling.nextSibling}catch(Y){}q.destroy(g)});this.defer(a)}},open:function(a){if(!this.onLoadDeferred||0<=this.onLoadDeferred.fired)this.onLoadDeferred=new V;this.isClosed||this.close();A.publish(O._scopeName+"._editor.RichText::open",
this);1===arguments.length&&a.nodeName&&(this.domNode=a);var u=this.domNode;if(b.isString(this.value)){var G=this.value;u.innerHTML=""}else if(u.nodeName&&"textarea"==u.nodeName.toLowerCase()){var l=this.textarea=u;this.name=l.name;G=l.value;u=this.domNode=this.ownerDocument.createElement("div");u.setAttribute("widgetId",this.id);l.removeAttribute("widgetId");u.cssText=l.cssText;u.className+=" "+l.className;q.place(u,l,"before");var g=b.hitch(this,function(){v.set(l,{display:"block",position:"absolute",
top:"-1000px"});if(c("ie")){var W=l.style;this.__overflow=W.overflow;W.overflow="hidden"}});c("ie")?this.defer(g,10):g();if(l.form){var w=l.value;this.reset=function(){this.getValue()!==w&&this.replaceValue(w)};m(l.form,"submit",b.hitch(this,function(){x.set(l,"disabled",this.disabled);l.value=this.getValue()}))}}else G=N.getChildrenHtml(u),u.innerHTML="";this.value=G;u.nodeName&&"LI"===u.nodeName&&(u.innerHTML=" \x3cbr\x3e");this.header=u.ownerDocument.createElement("div");u.appendChild(this.header);
this.editingArea=u.ownerDocument.createElement("div");u.appendChild(this.editingArea);this.footer=u.ownerDocument.createElement("div");u.appendChild(this.footer);this.name||(this.name=this.id+"_AUTOGEN");if(""!==this.name&&(!I.useXDomain||I.allowXdRichTextSave)){if((G=J.byId(O._scopeName+"._editor.RichText.value"))&&""!==G.value){g=G.value.split(this._SEPARATOR);for(var M=0,Y;Y=g[M++];)if(Y=Y.split(this._NAME_CONTENT_SEP),Y[0]===this.name){this.value=Y[1];g=g.splice(M,1);G.value=g.join(this._SEPARATOR);
break}}R._globalSaveHandler||(R._globalSaveHandler={},C.addOnUnload(function(){for(var W in R._globalSaveHandler){var aa=R._globalSaveHandler[W];b.isFunction(aa)&&aa()}}));R._globalSaveHandler[this.id]=b.hitch(this,"_saveContent")}this.isClosed=!1;G=this.editorObject=this.iframe=this.ownerDocument.createElement("iframe");G.id=this.id+"_iframe";G.style.border="none";G.style.width="100%";this._layoutMode?G.style.height="100%":7<=c("ie")?(this.height&&(G.style.height=this.height),this.minHeight&&(G.style.minHeight=
this.minHeight)):G.style.height=this.height?this.height:this.minHeight;G.frameBorder=0;G._loadFunc=b.hitch(this,function(W){this.window=W;this.document=W.document;this.selection=new h.SelectionManager(W);c("ie")&&this._localizeEditorCommands();this.onLoad(this.get("value"))});g=this._getIframeDocTxt().replace(/\\/g,"\\\\").replace(/'/g,"\\'");g=11>c("ie")?'javascript:document.open();try{parent.window;}catch(e){document.domain\x3d"'+document.domain+"\";}document.write('"+g+"');document.close()":"javascript: '"+
g+"'";this.editingArea.appendChild(G);G.src=g;"LI"===u.nodeName&&(u.lastChild.style.marginTop="-1.2em");n.add(this.domNode,this.baseClass)},_local2NativeFormatNames:{},_native2LocalFormatNames:{},_getIframeDocTxt:function(){var a=v.getComputedStyle(this.domNode);if(this["aria-label"])var u=this["aria-label"];else{var G=k('label[for\x3d"'+this.id+'"]',this.ownerDocument)[0]||J.byId(this["aria-labelledby"],this.ownerDocument);G&&(u=G.textContent||G.innerHTML||"")}G="\x3cdiv id\x3d'dijitEditorBody' role\x3d'textbox' aria-multiline\x3d'true' "+
(u?" aria-label\x3d'"+f.escape(u)+"'":"")+"\x3e\x3c/div\x3e";var l=[a.fontWeight,a.fontSize,a.fontFamily].join(" "),g=a.lineHeight;g=0<=g.indexOf("px")?parseFloat(g)/parseFloat(a.fontSize):0<=g.indexOf("em")?parseFloat(g):"normal";var w="",M=this;this.style.replace(/(^|;)\s*(line-|font-?)[^;]+/ig,function(Y){Y=Y.replace(/^;/ig,"")+";";var W=Y.split(":")[0];if(W){W=b.trim(W);W=W.toLowerCase();var aa,ea="";for(aa=0;aa<W.length;aa++){var fa=W.charAt(aa);switch(fa){case "-":aa++,fa=W.charAt(aa).toUpperCase();
default:ea+=fa}}v.set(M.domNode,ea,"")}w+=Y+";"});this.iframe.setAttribute("title",u);return["\x3c!DOCTYPE html\x3e","\x3chtml lang\x3d'"+(this.lang||H.locale.replace(/-.*/,""))+"'"+(this.isLeftToRight()?"":" dir\x3d'rtl'")+"\x3e\n","\x3chead\x3e\n\x3cmeta http-equiv\x3d'Content-Type' content\x3d'text/html'\x3e\n",u?"\x3ctitle\x3e"+f.escape(u)+"\x3c/title\x3e":"","\x3cstyle\x3e\n\tbody,html {\n\t\tbackground:transparent;\n\t\tpadding: 1px 0 0 0;\n\t\tmargin: -1px 0 0 0;\n\t}\n\tbody,html,#dijitEditorBody { outline: none; }html { height: 100%; width: 100%; overflow: hidden; }\n",
this.height?"\tbody,#dijitEditorBody { height: 100%; width: 100%; overflow: auto; }\n":"\tbody,#dijitEditorBody { min-height: "+this.minHeight+"; width: 100%; overflow-x: auto; overflow-y: hidden; }\n","\tbody{\n\t\ttop:0px;\n\t\tleft:0px;\n\t\tright:0px;\n\t\tfont:",l,";\n",this.height||c("opera")?"":"\t\tposition: fixed;\n","\t\tline-height:",g,";\n\t}\n\tp{ margin: 1em 0; }\n\tli \x3e ul:-moz-first-node, li \x3e ol:-moz-first-node{ padding-top: 1.2em; }\n",c("ie")||c("trident")||c("edge")?"":"\tli{ min-height:1.2em; }\n",
"\x3c/style\x3e\n",this._applyEditingAreaStyleSheets(),"\n\x3c/head\x3e\n\x3cbody role\x3d'application'",u?" aria-label\x3d'"+f.escape(u)+"'":"","onload\x3d'try{frameElement \x26\x26 frameElement._loadFunc(window,document)}catch(e){document.domain\x3d\""+document.domain+"\";frameElement._loadFunc(window,document)}' ","style\x3d'"+w+"'\x3e",G,"\x3c/body\x3e\n\x3c/html\x3e"].join("")},_applyEditingAreaStyleSheets:function(){var a=[];this.styleSheets&&(a=this.styleSheets.split(";"),this.styleSheets=
"");a=a.concat(this.editingAreaStyleSheets);this.editingAreaStyleSheets=[];for(var u="",G=0,l,g=z.get(this.ownerDocument);l=a[G++];)l=(new F(g.location,l)).toString(),this.editingAreaStyleSheets.push(l),u+='\x3clink rel\x3d"stylesheet" type\x3d"text/css" href\x3d"'+l+'"/\x3e';return u},addStyleSheet:function(a){var u=a.toString(),G=z.get(this.ownerDocument);if("."===u.charAt(0)||"/"!==u.charAt(0)&&!a.host)u=(new F(G.location,u)).toString();-1<Q.indexOf(this.editingAreaStyleSheets,u)||(this.editingAreaStyleSheets.push(u),
this.onLoadDeferred.then(b.hitch(this,function(){if(this.document.createStyleSheet)this.document.createStyleSheet(u);else{var l=this.document.getElementsByTagName("head")[0],g=this.document.createElement("link");g.rel="stylesheet";g.type="text/css";g.href=u;l.appendChild(g)}})))},removeStyleSheet:function(a){var u=a.toString(),G=z.get(this.ownerDocument);if("."===u.charAt(0)||"/"!==u.charAt(0)&&!a.host)u=(new F(G.location,u)).toString();a=Q.indexOf(this.editingAreaStyleSheets,u);-1!==a&&(delete this.editingAreaStyleSheets[a],
k('link[href\x3d"'+u+'"]',this.window.document).orphan())},disabled:!1,_mozSettingProps:{styleWithCSS:!1},_setDisabledAttr:function(a){a=!!a;this._set("disabled",a);if(this.isLoaded){var u=c("ie")&&(this.isLoaded||!this.focusOnLoad);u&&(this.editNode.unselectable="on");this.editNode.contentEditable=!a;this.editNode.tabIndex=a?"-1":this.tabIndex;u&&this.defer(function(){this.editNode&&(this.editNode.unselectable="off")});if(c("mozilla")&&!a&&this._mozSettingProps){a=this._mozSettingProps;for(var G in a)if(a.hasOwnProperty(G))try{this.document.execCommand(G,
!1,a[G])}catch(l){}}this._disabledOK=!0}},onLoad:function(a){this.window.__registeredWindow||(this.window.__registeredWindow=!0,this._iframeRegHandle=E.registerIframe(this.iframe));this.editNode=this.document.body.firstChild;var u=this;this.beforeIframeNode=q.place("\x3cdiv tabIndex\x3d-1\x3e\x3c/div\x3e",this.iframe,"before");this.afterIframeNode=q.place("\x3cdiv tabIndex\x3d-1\x3e\x3c/div\x3e",this.iframe,"after");this.iframe.onfocus=this.document.onfocus=function(){u.editNode.focus()};this.focusNode=
this.editNode;var G=this.events.concat(this.captureEvents),l=this.iframe?this.document:this.editNode;this.own.apply(this,Q.map(G,function(g){var w=g.toLowerCase().replace(/^on/,"");return m(l,w,b.hitch(this,g))},this));this.own(m(l,"mouseup",b.hitch(this,"onClick")));c("ie")&&(this.own(m(this.document,"mousedown",b.hitch(this,"_onIEMouseDown"))),this.editNode.style.zoom=1);c("webkit")&&(this._webkitListener=this.own(m(this.document,"mouseup",b.hitch(this,"onDisplayChanged")))[0],this.own(m(this.document,
"mousedown",b.hitch(this,function(g){g=g.target;!g||g!==this.document.body&&g!==this.document||this.defer("placeCursorAtEnd")}))));if(c("ie"))try{this.document.execCommand("RespectVisibilityInDesign",!0,null)}catch(g){}this.isLoaded=!0;this.set("disabled",this.disabled);G=b.hitch(this,function(){this.setValue(a);this.onLoadDeferred&&!this.onLoadDeferred.isFulfilled()&&this.onLoadDeferred.resolve(!0);this.onDisplayChanged();this.focusOnLoad&&e(b.hitch(this,"defer","focus",this.updateInterval));this.value=
this.getValue(!0)});this.setValueDeferred?this.setValueDeferred.then(G):G()},onKeyDown:function(a){if(a.keyCode===d.SHIFT||a.keyCode===d.ALT||a.keyCode===d.META||a.keyCode===d.CTRL)return!0;a.keyCode===d.TAB&&this.isTabIndent&&(a.stopPropagation(),a.preventDefault(),this.queryCommandEnabled(a.shiftKey?"outdent":"indent")&&this.execCommand(a.shiftKey?"outdent":"indent"));if(a.keyCode==d.TAB&&!this.isTabIndent&&!a.ctrlKey&&!a.altKey)return a.shiftKey?this.beforeIframeNode.focus():this.afterIframeNode.focus(),
!0;9>c("ie")&&a.keyCode===d.BACKSPACE&&"Control"===this.document.selection.type&&(a.stopPropagation(),a.preventDefault(),this.execCommand("delete"));c("ff")&&(a.keyCode===d.PAGE_UP||a.keyCode===d.PAGE_DOWN)&&this.editNode.clientHeight>=this.editNode.scrollHeight&&a.preventDefault();var u=this._keyHandlers[a.keyCode],G=arguments;u&&!a.altKey&&Q.some(u,function(l){if(!(l.shift^a.shiftKey||l.ctrl^(a.ctrlKey||a.metaKey)))return l.handler.apply(this,G)||a.preventDefault(),!0},this);this.defer("onKeyPressed",
1);return!0},onKeyUp:function(){},setDisabled:function(a){H.deprecated("dijit.Editor::setDisabled is deprecated",'use dijit.Editor::attr("disabled",boolean) instead',2);this.set("disabled",a)},_setValueAttr:function(a){this.setValue(a)},_setDisableSpellCheckAttr:function(a){this.document?x.set(this.document.body,"spellcheck",!a):this.onLoadDeferred.then(b.hitch(this,function(){x.set(this.document.body,"spellcheck",!a)}));this._set("disableSpellCheck",a)},addKeyHandler:function(a,u,G,l){"string"==
typeof a&&(a=a.toUpperCase().charCodeAt(0));b.isArray(this._keyHandlers[a])||(this._keyHandlers[a]=[]);this._keyHandlers[a].push({shift:G||!1,ctrl:u||!1,handler:l})},onKeyPressed:function(){this.onDisplayChanged()},onClick:function(a){this.onDisplayChanged(a)},_onIEMouseDown:function(){this.focused||this.disabled||this.focus()},_onBlur:function(a){(c("ie")||c("trident"))&&this.defer(function(){E.curNode||this.ownerDocumentBody.focus()});this.inherited(arguments);var u=this.getValue(!0);if(u!==this.value)this.onChange(u);
this._set("value",u)},_onFocus:function(a){this.disabled||(this._disabledOK||this.set("disabled",!1),this.inherited(arguments))},blur:function(){!c("ie")&&this.window.document.documentElement&&this.window.document.documentElement.focus?this.window.document.documentElement.focus():this.ownerDocumentBody.focus&&this.ownerDocumentBody.focus()},focus:function(){this.isLoaded?9>c("ie")?this.iframe.fireEvent("onfocus",document.createEventObject()):this.editNode.focus():this.focusOnLoad=!0},updateInterval:200,
_updateTimer:null,onDisplayChanged:function(){this._updateTimer&&this._updateTimer.remove();this._updateTimer=this.defer("onNormalizedDisplayChanged",this.updateInterval)},onNormalizedDisplayChanged:function(){delete this._updateTimer},onChange:function(){},_normalizeCommand:function(a,u){a=a.toLowerCase();"formatblock"===a?c("safari")&&void 0===u&&(a="heading"):"hilitecolor"!==a||c("mozilla")||(a="backcolor");return a},_implCommand:function(a){return"_"+this._normalizeCommand(a)+"EnabledImpl"},_qcaCache:{},
queryCommandAvailable:function(a){var u=this._qcaCache[a];return void 0!==u?u:this._qcaCache[a]=this._queryCommandAvailable(a)},_queryCommandAvailable:function(a){switch(a.toLowerCase()){case "bold":case "italic":case "underline":case "subscript":case "superscript":case "fontname":case "fontsize":case "forecolor":case "hilitecolor":case "justifycenter":case "justifyfull":case "justifyleft":case "justifyright":case "delete":case "selectall":case "toggledir":case "createlink":case "unlink":case "removeformat":case "inserthorizontalrule":case "insertimage":case "insertorderedlist":case "insertunorderedlist":case "indent":case "outdent":case "formatblock":case "inserthtml":case "undo":case "redo":case "strikethrough":case "tabindent":case "cut":case "copy":case "paste":return!0;
case "blockdirltr":case "blockdirrtl":case "dirltr":case "dirrtl":case "inlinedirltr":case "inlinedirrtl":return c("ie")||c("trident")||c("edge");case "inserttable":case "insertcell":case "insertcol":case "insertrow":case "deletecells":case "deletecols":case "deleterows":case "mergecells":case "splitcell":return!c("webkit");default:return!1}},execCommand:function(a,u){this.focused&&this.focus();a=this._normalizeCommand(a,u);if(void 0!==u){if("heading"===a)throw Error("unimplemented");"formatblock"===
a&&(c("ie")||c("trident"))&&(u="\x3c"+u+"\x3e")}var G="_"+a+"Impl";if(this[G])var l=this[G](u);else if((u=1<arguments.length?u:null)||"createlink"!==a)l=this.document.execCommand(a,!1,u);this.onDisplayChanged();return l},queryCommandEnabled:function(a){if(this.disabled||!this._disabledOK)return!1;a=this._normalizeCommand(a);var u=this._implCommand(a);return this[u]?this[u](a):this._browserQueryCommandEnabled(a)},queryCommandState:function(a){if(this.disabled||!this._disabledOK)return!1;a=this._normalizeCommand(a);
try{return this.document.queryCommandState(a)}catch(u){return!1}},queryCommandValue:function(a){if(this.disabled||!this._disabledOK)return!1;a=this._normalizeCommand(a);if(c("ie")&&"formatblock"===a)a=this._native2LocalFormatNames[this.document.queryCommandValue(a)];else if(c("mozilla")&&"hilitecolor"===a){try{var u=this.document.queryCommandValue("styleWithCSS")}catch(G){u=!1}this.document.execCommand("styleWithCSS",!1,!0);a=this.document.queryCommandValue(a);this.document.execCommand("styleWithCSS",
!1,u)}else a=this.document.queryCommandValue(a);return a},_sCall:function(a,u){return this.selection[a].apply(this.selection,u)},placeCursorAtStart:function(){this.focus();var a=!1;if(c("mozilla"))for(var u=this.editNode.firstChild;u;){if(3===u.nodeType){if(0<u.nodeValue.replace(/^\s+|\s+$/g,"").length){a=!0;this.selection.selectElement(u);break}}else if(1===u.nodeType){a=!0;var G=u.tagName?u.tagName.toLowerCase():"";/br|input|img|base|meta|area|basefont|hr|link/.test(G)?this.selection.selectElement(u):
this.selection.selectElementChildren(u);break}u=u.nextSibling}else a=!0,this.selection.selectElementChildren(this.editNode);a&&this.selection.collapse(!0)},placeCursorAtEnd:function(){this.focus();var a=!1;if(c("mozilla"))for(var u=this.editNode.lastChild;u;){if(3===u.nodeType){if(0<u.nodeValue.replace(/^\s+|\s+$/g,"").length){a=!0;this.selection.selectElement(u);break}}else if(1===u.nodeType){a=!0;this.selection.selectElement(u.lastChild||u);break}u=u.previousSibling}else a=!0,this.selection.selectElementChildren(this.editNode);
a&&this.selection.collapse(!1)},getValue:function(a){return!this.textarea||!this.isClosed&&this.isLoaded?this.isLoaded?this._postFilterContent(null,a):this.value:this.textarea.value},_getValueAttr:function(){return this.getValue(!0)},setValue:function(a){if(this.isLoaded){if(!this.textarea||!this.isClosed&&this.isLoaded){a=this._preFilterContent(a);var u=this.isClosed?this.domNode:this.editNode;u.innerHTML=a;this._preDomFilterContent(u)}else this.textarea.value=a;this.onDisplayChanged();this._set("value",
this.getValue(!0))}else this.onLoadDeferred.then(b.hitch(this,function(){this.setValue(a)}))},replaceValue:function(a){this.isClosed?this.setValue(a):this.window&&this.window.getSelection&&!c("mozilla")?this.setValue(a):this.window&&this.window.getSelection?(a=this._preFilterContent(a),this.execCommand("selectall"),this.execCommand("inserthtml",a),this._preDomFilterContent(this.editNode)):this.document&&this.document.selection&&this.setValue(a);this._set("value",this.getValue(!0))},_preFilterContent:function(a){var u=
a;Q.forEach(this.contentPreFilters,function(G){G&&(u=G(u))});return u},_preDomFilterContent:function(a){a=a||this.editNode;Q.forEach(this.contentDomPreFilters,function(u){u&&b.isFunction(u)&&u(a)},this)},_postFilterContent:function(a,u){if(b.isString(a))var G=a;else a=a||this.editNode,this.contentDomPostFilters.length&&(u&&(a=b.clone(a)),Q.forEach(this.contentDomPostFilters,function(l){a=l(a)})),G=N.getChildrenHtml(a);b.trim(G.replace(/^\xA0\xA0*/,"").replace(/\xA0\xA0*$/,"")).length||(G="");Q.forEach(this.contentPostFilters,
function(l){G=l(G)});return G},_saveContent:function(){var a=J.byId(O._scopeName+"._editor.RichText.value");a&&(a.value&&(a.value+=this._SEPARATOR),a.value+=this.name+this._NAME_CONTENT_SEP+this.getValue(!0))},escapeXml:function(a,u){a=a.replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;");u||(a=a.replace(/'/gm,"\x26#39;"));return a},getNodeHtml:function(a){H.deprecated("dijit.Editor::getNodeHtml is deprecated","use dijit/_editor/html::getNodeHtml instead",
2);return N.getNodeHtml(a)},getNodeChildrenHtml:function(a){H.deprecated("dijit.Editor::getNodeChildrenHtml is deprecated","use dijit/_editor/html::getChildrenHtml instead",2);return N.getChildrenHtml(a)},close:function(a){if(!this.isClosed){arguments.length||(a=!0);a&&this._set("value",this.getValue(!0));this.interval&&clearInterval(this.interval);this._webkitListener&&(this._webkitListener.remove(),delete this._webkitListener);c("ie")&&(this.iframe.onfocus=null);this.iframe._loadFunc=null;this._iframeRegHandle&&
(this._iframeRegHandle.remove(),delete this._iframeRegHandle);if(this.textarea){var u=this.textarea.style;u.position="";u.left=u.top="";c("ie")&&(u.overflow=this.__overflow,this.__overflow=null);this.textarea.value=this.value;q.destroy(this.domNode);this.domNode=this.textarea}else this.domNode.innerHTML=this.value;delete this.iframe;n.remove(this.domNode,this.baseClass);this.isClosed=!0;this.isLoaded=!1;delete this.editNode;delete this.focusNode;this.window&&this.window._frameElement&&(this.window._frameElement=
null);this.editorObject=this.editingArea=this.document=this.window=null}},destroy:function(){this.isClosed||this.close(!1);this._updateTimer&&this._updateTimer.remove();this.inherited(arguments);R._globalSaveHandler&&delete R._globalSaveHandler[this.id]},_removeMozBogus:function(a){return a.replace(/\stype="_moz"/gi,"").replace(/\s_moz_dirty=""/gi,"").replace(/_moz_resizing="(true|false)"/gi,"")},_removeWebkitBogus:function(a){a=a.replace(/\sclass="webkit-block-placeholder"/gi,"");a=a.replace(/\sclass="apple-style-span"/gi,
"");return a=a.replace(/<meta charset="utf-8" \/>/gi,"")},_normalizeFontStyle:function(a){return a.replace(/<(\/)?strong([ >])/gi,"\x3c$1b$2").replace(/<(\/)?em([ >])/gi,"\x3c$1i$2")},_preFixUrlAttributes:function(a){return a.replace(/(?:(<a(?=\s).*?\shref=)("|')(.*?)\2)|(?:(<a\s.*?href=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl\x3d$2$3$5$2").replace(/(?:(<img(?=\s).*?\ssrc=)("|')(.*?)\2)|(?:(<img\s.*?src=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl\x3d$2$3$5$2")},_browserQueryCommandEnabled:function(a){if(!a)return!1;
if(c("ie")||c("trident")||c("edge"))return this.focused&&!this.disabled;var u=9>c("ie")?this.document.selection.createRange():this.document;try{return u.queryCommandEnabled(a)}catch(G){return!1}},_createlinkEnabledImpl:function(){var a=!0;return a=c("opera")?this.window.getSelection().isCollapsed?!0:this.document.queryCommandEnabled("createlink"):this._browserQueryCommandEnabled("createlink")},_unlinkEnabledImpl:function(){var a=!0;return a=c("mozilla")||c("webkit")||c("ie")||c("trident")||c("edge")?
this.selection.hasAncestorElement("a"):this._browserQueryCommandEnabled("unlink")},_inserttableEnabledImpl:function(){var a=!0;return a=c("mozilla")||c("webkit")?!0:this._browserQueryCommandEnabled("inserttable")},_cutEnabledImpl:function(){var a=!0;c("webkit")?((a=this.window.getSelection())&&(a=a.toString()),a=!!a):a=this._browserQueryCommandEnabled("cut");return a},_copyEnabledImpl:function(){var a=!0;c("webkit")?((a=this.window.getSelection())&&(a=a.toString()),a=!!a):a=this._browserQueryCommandEnabled("copy");
return a},_pasteEnabledImpl:function(){var a=!0;return c("webkit")?!0:a=this._browserQueryCommandEnabled("paste")},_inserthorizontalruleImpl:function(a){return c("ie")?this._inserthtmlImpl("\x3chr\x3e"):this.document.execCommand("inserthorizontalrule",!1,a)},_unlinkImpl:function(a){return this.queryCommandEnabled("unlink")&&(c("mozilla")||c("webkit"))?(a=this.selection.getAncestorElement("a"),this.selection.selectElement(a),this.document.execCommand("unlink",!1,null)):this.document.execCommand("unlink",
!1,a)},_hilitecolorImpl:function(a){if(!this._handleTextColorOrProperties("hilitecolor",a))if(c("mozilla")){this.document.execCommand("styleWithCSS",!1,!0);console.log("Executing color command.");var u=this.document.execCommand("hilitecolor",!1,a);this.document.execCommand("styleWithCSS",!1,!1)}else u=this.document.execCommand("hilitecolor",!1,a);return u},_backcolorImpl:function(a){c("ie")&&(a=a?a:null);var u=this._handleTextColorOrProperties("backcolor",a);u||(u=this.document.execCommand("backcolor",
!1,a));return u},_forecolorImpl:function(a){c("ie")&&(a=a?a:null);var u=!1;(u=this._handleTextColorOrProperties("forecolor",a))||(u=this.document.execCommand("forecolor",!1,a));return u},_inserthtmlImpl:function(a){a=this._preFilterContent(a);var u=!0;if(9>c("ie")){var G=this.document.selection.createRange();if("CONTROL"===this.document.selection.type.toUpperCase()){for(var l=G.item(0);G.length;)G.remove(G.item(0));l.outerHTML=a}else G.pasteHTML(a);G.select()}else if(8>c("trident")){var g=B.getSelection(this.window);
if(g&&g.rangeCount&&g.getRangeAt){G=g.getRangeAt(0);G.deleteContents();var w=q.create("div");w.innerHTML=a;for(l=this.document.createDocumentFragment();a=w.firstChild;)var M=l.appendChild(a);G.insertNode(l);M&&(G=G.cloneRange(),G.setStartAfter(M),G.collapse(!1),g.removeAllRanges(),g.addRange(G))}}else c("mozilla")&&!a.length?this.selection.remove():u=this.document.execCommand("inserthtml",!1,a);return u},_boldImpl:function(a){var u=!1;if(c("ie")||c("trident"))this._adaptIESelection(),u=this._adaptIEFormatAreaAndExec("bold");
u||(u=this.document.execCommand("bold",!1,a));return u},_italicImpl:function(a){var u=!1;if(c("ie")||c("trident"))this._adaptIESelection(),u=this._adaptIEFormatAreaAndExec("italic");u||(u=this.document.execCommand("italic",!1,a));return u},_underlineImpl:function(a){var u=!1;if(c("ie")||c("trident"))this._adaptIESelection(),u=this._adaptIEFormatAreaAndExec("underline");u||(u=this.document.execCommand("underline",!1,a));return u},_strikethroughImpl:function(a){var u=!1;if(c("ie")||c("trident"))this._adaptIESelection(),
u=this._adaptIEFormatAreaAndExec("strikethrough");u||(u=this.document.execCommand("strikethrough",!1,a));return u},_superscriptImpl:function(a){var u=!1;if(c("ie")||c("trident"))this._adaptIESelection(),u=this._adaptIEFormatAreaAndExec("superscript");u||(u=this.document.execCommand("superscript",!1,a));return u},_subscriptImpl:function(a){var u=!1;if(c("ie")||c("trident"))this._adaptIESelection(),u=this._adaptIEFormatAreaAndExec("subscript");u||(u=this.document.execCommand("subscript",!1,a));return u},
_fontnameImpl:function(a){if(c("ie")||c("trident"))var u=this._handleTextColorOrProperties("fontname",a);u||(u=this.document.execCommand("fontname",!1,a));return u},_fontsizeImpl:function(a){if(c("ie")||c("trident"))var u=this._handleTextColorOrProperties("fontsize",a);u||(u=this.document.execCommand("fontsize",!1,a));return u},_insertorderedlistImpl:function(a){var u=!1;if(c("ie")||c("trident")||c("edge"))u=this._adaptIEList("insertorderedlist",a);u||(u=this.document.execCommand("insertorderedlist",
!1,a));return u},_insertunorderedlistImpl:function(a){var u=!1;if(c("ie")||c("trident")||c("edge"))u=this._adaptIEList("insertunorderedlist",a);u||(u=this.document.execCommand("insertunorderedlist",!1,a));return u},getHeaderHeight:function(){return this._getNodeChildrenHeight(this.header)},getFooterHeight:function(){return this._getNodeChildrenHeight(this.footer)},_getNodeChildrenHeight:function(a){var u=0;if(a&&a.childNodes){var G;for(G=0;G<a.childNodes.length;G++){var l=t.position(a.childNodes[G]);
u+=l.h}}return u},_isNodeEmpty:function(a,u){return 1===a.nodeType?0<a.childNodes.length?this._isNodeEmpty(a.childNodes[0],u):!0:3===a.nodeType?""===a.nodeValue.substring(u):!1},_removeStartingRangeFromRange:function(a,u){if(a.nextSibling)u.setStart(a.nextSibling,0);else{for(a=a.parentNode;a&&null==a.nextSibling;)a=a.parentNode;a&&u.setStart(a.nextSibling,0)}return u},_adaptIESelection:function(){var a=B.getSelection(this.window);if(a&&a.rangeCount&&!a.isCollapsed){for(var u=a.getRangeAt(0),G=u.startContainer,
l=u.startOffset;3===G.nodeType&&l>=G.length&&G.nextSibling;)l-=G.length,G=G.nextSibling;for(var g=null;this._isNodeEmpty(G,l)&&G!==g;)g=G,u=this._removeStartingRangeFromRange(G,u),G=u.startContainer,l=0;a.removeAllRanges();a.addRange(u)}},_adaptIEFormatAreaAndExec:function(a){var u=B.getSelection(this.window),G=this.document,l;if(a&&u&&u.isCollapsed){if(this.queryCommandValue(a)){a=this._tagNamesForCommand(a);var g=u.getRangeAt(0);var w=g.startContainer;if(3===w.nodeType){var M=g.endOffset;w.length<
M&&(M=this._adjustNodeAndOffset(Y,M),w=M.node,M=M.offset)}for(;w&&w!==this.editNode;){var Y=w.tagName?w.tagName.toLowerCase():"";if(-1<Q.indexOf(a,Y)){var W=w;break}w=w.parentNode}if(W&&(Y=g.startContainer,a=G.createElement(W.tagName),q.place(a,W,"after"),Y&&3===Y.nodeType)){M=g.endOffset;Y.length<M&&(M=this._adjustNodeAndOffset(Y,M),Y=M.node,M=M.offset);w=Y.nodeValue;g=G.createTextNode(w.substring(0,M));var aa=w.substring(M,w.length);aa&&(l=G.createTextNode(aa));q.place(g,Y,"before");if(l){var ea=
G.createElement("span");ea.className="ieFormatBreakerSpan";q.place(ea,Y,"after");q.place(l,ea,"after");l=ea}q.destroy(Y);M=g.parentNode;for(Y=[];M!==W;){w=M.tagName;g={tagName:w};Y.push(g);w=G.createElement(w);M.style&&w.style&&M.style.cssText&&(w.style.cssText=M.style.cssText,g.cssText=M.style.cssText);"FONT"===M.tagName&&(M.color&&(w.color=M.color,g.color=M.color),M.face&&(w.face=M.face,g.face=M.face),M.size&&(w.size=M.size,g.size=M.size));M.className&&(w.className=M.className,g.className=M.className);
if(l)for(;l;)g=l.nextSibling,w.appendChild(l),l=g;w.tagName==M.tagName?(ea=G.createElement("span"),ea.className="ieFormatBreakerSpan",q.place(ea,M,"after"),q.place(w,ea,"after")):q.place(w,M,"after");g=M;l=w;M=M.parentNode}if(l){if(1===l.nodeType||3===l.nodeType&&l.nodeValue)a.innerHTML="";for(;l;)g=l.nextSibling,a.appendChild(l),l=g}if(Y.length){g=Y.pop();l=G.createElement(g.tagName);g.cssText&&l.style&&(l.style.cssText=g.cssText);g.className&&(l.className=g.className);"FONT"===g.tagName&&(g.color&&
(l.color=g.color),g.face&&(l.face=g.face),g.size&&(l.size=g.size));for(q.place(l,a,"before");Y.length;)g=Y.pop(),W=G.createElement(g.tagName),g.cssText&&W.style&&(W.style.cssText=g.cssText),g.className&&(W.className=g.className),"FONT"===g.tagName&&(g.color&&(W.color=g.color),g.face&&(W.face=g.face),g.size&&(W.size=g.size)),l.appendChild(W),l=W;W=G.createTextNode(".");ea.appendChild(W);l.appendChild(W)}else ea=G.createElement("span"),ea.className="ieFormatBreakerSpan",W=G.createTextNode("."),ea.appendChild(W),
q.place(ea,a,"before");l=B.create(this.window);l.setStart(W,0);l.setEnd(W,W.length);u.removeAllRanges();u.addRange(l);this.selection.collapse(!1);W.parentNode.innerHTML="";a.firstChild||q.destroy(a);return!0}return!1}g=u.getRangeAt(0);if((Y=g.startContainer)&&3===Y.nodeType)return M=g.startOffset,Y.length<M&&(M=this._adjustNodeAndOffset(Y,M),Y=M.node,M=M.offset),w=Y.nodeValue,g=G.createTextNode(w.substring(0,M)),aa=w.substring(M),""!==aa&&(l=G.createTextNode(w.substring(M))),ea=G.createElement("span"),
W=G.createTextNode("."),ea.appendChild(W),g.length?q.place(g,Y,"after"):g=Y,q.place(ea,g,"after"),l&&q.place(l,ea,"after"),q.destroy(Y),l=B.create(this.window),l.setStart(W,0),l.setEnd(W,W.length),u.removeAllRanges(),u.addRange(l),G.execCommand(a),q.place(ea.firstChild,ea,"before"),q.destroy(ea),l.setStart(W,0),l.setEnd(W,W.length),u.removeAllRanges(),u.addRange(l),this.selection.collapse(!1),W.parentNode.innerHTML="",!0}else return!1},_adaptIEList:function(a){var u=B.getSelection(this.window);if(u.isCollapsed&&
u.rangeCount&&!this.queryCommandValue(a)){var G=u.getRangeAt(0),l=G.startContainer;if(l&&3==l.nodeType&&!G.startOffset)return G="ul","insertorderedlist"===a&&(G="ol"),a=this.document.createElement(G),G=q.create("li",null,a),q.place(a,l,"before"),G.appendChild(l),q.create("br",null,a,"after"),a=B.create(this.window),a.setStart(l,0),a.setEnd(l,l.length),u.removeAllRanges(),u.addRange(a),this.selection.collapse(!0),!0}return!1},_handleTextColorOrProperties:function(a,u){var G=B.getSelection(this.window),
l=this.document,g,w;u=u||null;if(a&&G&&G.isCollapsed&&G.rangeCount){var M=G.getRangeAt(0);if((g=M.startContainer)&&3===g.nodeType){var Y=M.startOffset;g.length<Y&&(M=this._adjustNodeAndOffset(g,Y),g=M.node,Y=M.offset);var W=g.nodeValue;M=l.createTextNode(W.substring(0,Y));""!==W.substring(Y)&&(w=l.createTextNode(W.substring(Y)));W=l.createElement("span");Y=l.createTextNode(".");W.appendChild(Y);l=l.createElement("span");W.appendChild(l);M.length?q.place(M,g,"after"):M=g;q.place(W,M,"after");w&&q.place(w,
W,"after");q.destroy(g);g=B.create(this.window);g.setStart(Y,0);g.setEnd(Y,Y.length);G.removeAllRanges();G.addRange(g);if(c("webkit")){G="color";if("hilitecolor"===a||"backcolor"===a)G="backgroundColor";v.set(W,G,u);this.selection.remove();q.destroy(l);W.innerHTML="\x26#160;";this.selection.selectElement(W);this.focus()}else this.execCommand(a,u),q.place(W.firstChild,W,"before"),q.destroy(W),g.setStart(Y,0),g.setEnd(Y,Y.length),G.removeAllRanges(),G.addRange(g),this.selection.collapse(!1),Y.parentNode.removeChild(Y);
return!0}}return!1},_adjustNodeAndOffset:function(a,u){for(;a.length<u&&a.nextSibling&&3===a.nextSibling.nodeType;)u-=a.length,a=a.nextSibling;return{node:a,offset:u}},_tagNamesForCommand:function(a){return"bold"===a?["b","strong"]:"italic"===a?["i","em"]:"strikethrough"===a?["s","strike"]:"superscript"===a?["sup"]:"subscript"===a?["sub"]:"underline"===a?["u"]:[]},_stripBreakerNodes:function(a){if(this.isLoaded)return k(".ieFormatBreakerSpan",a).forEach(function(u){for(;u.firstChild;)q.place(u.firstChild,
u,"before");q.destroy(u)}),a},_stripTrailingEmptyNodes:function(a){function u(G){return/^(p|div|br)$/i.test(G.nodeName)&&0==G.children.length&&/^[\s\xA0]*$/.test(G.textContent||G.innerText||"")||3===G.nodeType&&/^[\s\xA0]*$/.test(G.nodeValue)}for(;a.lastChild&&u(a.lastChild);)q.destroy(a.lastChild);return a},_setTextDirAttr:function(a){this._set("textDir",a);this.onLoadDeferred.then(b.hitch(this,function(){this.editNode.dir=a}))}});return R})},"dijit/_editor/range":function(){define(["dojo/_base/array",
"dojo/_base/declare","dojo/_base/lang"],function(Q,I,P){var V={getIndex:function(n,q){for(var t=[],v=[],H=n,d,b;n!=q;){var m=0;for(d=n.parentNode;b=d.childNodes[m++];)if(b===n){--m;break}t.unshift(m);v.unshift(m-d.childNodes.length);n=d}if(0<t.length&&3==H.nodeType){for(b=H.previousSibling;b&&3==b.nodeType;)t[t.length-1]--,b=b.previousSibling;for(b=H.nextSibling;b&&3==b.nodeType;)v[v.length-1]++,b=b.nextSibling}return{o:t,r:v}},getNode:function(n,q){if(!P.isArray(n)||0==n.length)return q;var t=q;
Q.every(n,function(v){if(0<=v&&v<t.childNodes.length)t=t.childNodes[v];else return t=null,!1;return!0});return t},getCommonAncestor:function(n,q,t){t=t||n.ownerDocument.body;var v=function(b){for(var m=[];b;)if(m.unshift(b),b!==t)b=b.parentNode;else break;return m};n=v(n);q=v(q);v=Math.min(n.length,q.length);for(var H=n[0],d=1;d<v;d++)if(n[d]===q[d])H=n[d];else break;return H},getAncestor:function(n,q,t){for(t=t||n.ownerDocument.body;n&&n!==t;){var v=n.nodeName.toUpperCase();if(q.test(v))return n;
n=n.parentNode}return null},BlockTagNames:/^(?:P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|DT|DE)$/,getBlockAncestor:function(n,q,t){t=t||n.ownerDocument.body;q=q||V.BlockTagNames;for(var v=null,H;n&&n!==t;){var d=n.nodeName.toUpperCase();!v&&q.test(d)&&(v=n);!H&&/^(?:BODY|TD|TH|CAPTION)$/.test(d)&&(H=n);n=n.parentNode}return{blockNode:v,blockContainer:H||n.ownerDocument.body}},atBeginningOfContainer:function(n,q,t){var v=!1,H=0==t;H||3!=q.nodeType||/^[\s\xA0]+$/.test(q.nodeValue.substr(0,t))&&(H=
!0);if(H)for(v=!0;q&&q!==n;){if(q.previousSibling){v=!1;break}q=q.parentNode}return v},atEndOfContainer:function(n,q,t){var v=!1,H=t==(q.length||q.childNodes.length);H||3!=q.nodeType||/^[\s\xA0]+$/.test(q.nodeValue.substr(t))&&(H=!0);if(H)for(v=!0;q&&q!==n;){if(q.nextSibling){v=!1;break}q=q.parentNode}return v},adjacentNoneTextNode:function(n,q){var t=n;n=0-n.length||0;for(q=q?"nextSibling":"previousSibling";t&&3==t.nodeType;)n+=t.length,t=t[q];return[t,n]},create:function(n){n=n||window;return n.getSelection?
n.document.createRange():new x},getSelection:function(n,q){if(n.getSelection)return n.getSelection();n=new J.selection(n);q||n._getCurrentSelection();return n}};if(!window.getSelection)var J=V.ie={cachedSelection:{},selection:function(n){this._ranges=[];this.addRange=function(q,t){this._ranges.push(q);t||q._select();this.rangeCount=this._ranges.length};this.removeAllRanges=function(){this._ranges=[];this.rangeCount=0};this.getRangeAt=function(q){return this._ranges[q]};this._getCurrentSelection=function(){this.removeAllRanges();
var q=n.document.selection.createRange();q="CONTROL"==n.document.selection.type.toUpperCase()?new x(J.decomposeControlRange(q)):new x(J.decomposeTextRange(q));this.addRange(q,!0),this.isCollapsed=q.collapsed}},decomposeControlRange:function(n){var q=n.item(0),t=n.item(n.length-1);n=q.parentNode;var v=t.parentNode;q=V.getIndex(q,n).o[0];t=V.getIndex(t,v).o[0]+1;return[n,q,v,t]},getEndPoint:function(n,q){var t=n.duplicate();t.collapse(!q);var v="EndTo"+(q?"End":"Start"),H=t.parentElement(),d;if(0<H.childNodes.length)Q.every(H.childNodes,
function(k,e){if(3!=k.nodeType)if(t.moveToElementText(k),0<t.compareEndPoints(v,n))if(d&&3==d.nodeType){b=d;var c=!0}else return b=H,m=e,!1;else{if(e==H.childNodes.length-1)return b=H,m=H.childNodes.length,!1}else e==H.childNodes.length-1&&(b=k,c=!0);if(c&&b)return b=(k=V.adjacentNoneTextNode(b)[0])?k.nextSibling:H.firstChild,e=V.adjacentNoneTextNode(b),k=e[0],e=e[1],k?(t.moveToElementText(k),t.collapse(!1)):t.moveToElementText(H),t.setEndPoint(v,n),m=t.text.length-e,!1;d=k;return!0});else{var b=
H;var m=0}q||1!=b.nodeType||m!=b.childNodes.length||(q=b.nextSibling)&&3==q.nodeType&&(b=q,m=0);return[b,m]},setEndPoint:function(n,q,t){n=n.duplicate();var v;if(3!=q.nodeType)if(0<t){if(v=q.childNodes[t-1])if(3==v.nodeType)q=v,t=v.length;else if(v.nextSibling&&3==v.nextSibling.nodeType)q=v.nextSibling,t=0;else{n.moveToElementText(v.nextSibling?v:q);var H=v.parentNode;v=H.insertBefore(v.ownerDocument.createTextNode(" "),v.nextSibling);n.collapse(!1);H.removeChild(v)}}else n.moveToElementText(q),n.collapse(!0);
3==q.nodeType&&(v=V.adjacentNoneTextNode(q),H=v[0],v=v[1],H?(n.moveToElementText(H),n.collapse(!1),"inherit"!=H.contentEditable&&v++):(n.moveToElementText(q.parentNode),n.collapse(!0),n.move("character",1),n.move("character",-1)),t+=v,0<t&&n.move("character",t)!=t&&console.error("Error when moving!"));return n},decomposeTextRange:function(n){var q=J.getEndPoint(n),t=q[0],v=q[1],H=q[0];q=q[1];n.htmlText.length&&(n.htmlText==n.text?q=v+n.text.length:(q=J.getEndPoint(n,!0),H=q[0],q=q[1]));return[t,v,
H,q]},setRange:function(n,q,t,v,H,d){q=J.setEndPoint(n,q,t);n.setEndPoint("StartToStart",q);if(!d)var b=J.setEndPoint(n,v,H);n.setEndPoint("EndToEnd",b||q);return n}},x=V.W3CRange=I(null,{constructor:function(){0<arguments.length?(this.setStart(arguments[0][0],arguments[0][1]),this.setEnd(arguments[0][2],arguments[0][3])):(this.startContainer=this.commonAncestorContainer=null,this.startOffset=0,this.endContainer=null,this.endOffset=0,this.collapsed=!0)},_updateInternal:function(){this.commonAncestorContainer=
this.startContainer!==this.endContainer?V.getCommonAncestor(this.startContainer,this.endContainer):this.startContainer;this.collapsed=this.startContainer===this.endContainer&&this.startOffset==this.endOffset},setStart:function(n,q){q=parseInt(q);if(this.startContainer!==n||this.startOffset!=q)delete this._cachedBookmark,this.startContainer=n,this.startOffset=q,this.endContainer?this._updateInternal():this.setEnd(n,q)},setEnd:function(n,q){q=parseInt(q);if(this.endContainer!==n||this.endOffset!=q)delete this._cachedBookmark,
this.endContainer=n,this.endOffset=q,this.startContainer?this._updateInternal():this.setStart(n,q)},setStartAfter:function(n,q){this._setPoint("setStart",n,q,1)},setStartBefore:function(n,q){this._setPoint("setStart",n,q,0)},setEndAfter:function(n,q){this._setPoint("setEnd",n,q,1)},setEndBefore:function(n,q){this._setPoint("setEnd",n,q,0)},_setPoint:function(n,q,t,v){t=V.getIndex(q,q.parentNode).o;this[n](q.parentNode,t.pop()+v)},_getIERange:function(){var n=(this._body||this.endContainer.ownerDocument.body).createTextRange();
J.setRange(n,this.startContainer,this.startOffset,this.endContainer,this.endOffset,this.collapsed);return n},getBookmark:function(){this._getIERange();return this._cachedBookmark},_select:function(){this._getIERange().select()},deleteContents:function(){var n=this.startContainer,q=this._getIERange();3!==n.nodeType||this.startOffset||this.setStartBefore(n);q.pasteHTML("");this.endContainer=this.startContainer;this.endOffset=this.startOffset;this.collapsed=!0},cloneRange:function(){var n=new x([this.startContainer,
this.startOffset,this.endContainer,this.endOffset]);n._body=this._body;return n},detach:function(){this.startContainer=this.commonAncestorContainer=this._body=null;this.startOffset=0;this.endContainer=null;this.endOffset=0;this.collapsed=!0}});P.setObject("dijit.range",V);return V})},"dijit/_editor/html":function(){define(["dojo/_base/array","dojo/_base/lang","dojo/sniff"],function(Q,I,P){var V={};I.setObject("dijit._editor.html",V);var J=V.escapeXml=function(x,n){x=x.replace(/&/gm,"\x26amp;").replace(/</gm,
"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;");n||(x=x.replace(/'/gm,"\x26#39;"));return x};V.getNodeHtml=function(x){var n=[];V.getNodeHtmlHelper(x,n);return n.join("")};V.getNodeHtmlHelper=function(x,n){switch(x.nodeType){case 1:var q=x.nodeName.toLowerCase();if(!q||"/"==q.charAt(0))return"";n.push("\x3c",q);var t=[],v={},H;if(P("dom-attributes-explicit")||P("dom-attributes-specified-flag"))for(var d=0;H=x.attributes[d++];){var b=H.name;"_dj"===b.substr(0,3)||P("dom-attributes-specified-flag")&&
!H.specified||b in v||(H=H.value,("src"==b||"href"==b)&&x.getAttribute("_djrealurl")&&(H=x.getAttribute("_djrealurl")),8===P("ie")&&"style"===b&&(H=H.replace("HEIGHT:","height:").replace("WIDTH:","width:")),t.push([b,H]),v[b]=H)}else{var m=(/^input$|^img$/i.test(x.nodeName)?x:x.cloneNode(!1)).outerHTML;v=m.match(/[\w-]+=("[^"]*"|'[^']*'|\S*)/gi);m=m.substr(0,m.indexOf("\x3e"));Q.forEach(v,function(k){if(k){var e=k.indexOf("\x3d");if(0<e&&(k=k.substring(0,e),"_dj"!=k.substr(0,3)))if("src"!=k&&"href"!=
k||!x.getAttribute("_djrealurl")){switch(k){case "style":var c=x.style.cssText.toLowerCase();break;case "class":c=x.className;break;case "width":if("img"===q){(e=/width=(\S+)/i.exec(m))&&(c=e[1]);break}case "height":if("img"===q){(e=/height=(\S+)/i.exec(m))&&(c=e[1]);break}default:c=x.getAttribute(k)}null!=c&&t.push([k,c.toString()])}else t.push([k,x.getAttribute("_djrealurl")])}},this)}t.sort(function(k,e){return k[0]<e[0]?-1:k[0]==e[0]?0:1});for(v=0;H=t[v++];)n.push(" ",H[0],'\x3d"',"string"===
typeof H[1]?J(H[1],!0):H[1],'"');switch(q){case "br":case "hr":case "img":case "input":case "base":case "meta":case "area":case "basefont":n.push(" /\x3e");break;case "script":n.push("\x3e",x.innerHTML,"\x3c/",q,"\x3e");break;default:n.push("\x3e"),x.hasChildNodes()&&V.getChildrenHtmlHelper(x,n),n.push("\x3c/",q,"\x3e")}break;case 4:case 3:n.push(J(x.nodeValue,!0));break;case 8:n.push("\x3c!--",J(x.nodeValue,!0),"--\x3e");break;default:n.push("\x3c!-- Element not recognized - Type: ",x.nodeType," Name: ",
x.nodeName,"--\x3e")}};V.getChildrenHtml=function(x){var n=[];V.getChildrenHtmlHelper(x,n);return n.join("")};V.getChildrenHtmlHelper=function(x,n){if(x)for(var q=x.childNodes||x,t=!P("ie")||q!==x,v,H=0;v=q[H++];)t&&v.parentNode!=x||V.getNodeHtmlHelper(v,n)};return V})},"dijit/_editor/plugins/LinkDialog":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/query dojo/string ../_Plugin ../../form/DropDownButton ../range".split(" "),
function(Q,I,P,V,J,x,n,q,t,v,H,d,b){var m=P("dijit._editor.plugins.LinkDialog",H,{allowUnsafeHtml:!1,linkFilter:[[/</g,"\x26lt;"]],buttonClass:d,useDefaultCommand:!1,urlRegExp:"((https?|ftps?|file)\\://|./|../|/|)(/[a-zA-Z]{1,1}:/|)(((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)*(?:[a-zA-Z](?:[-\\da-zA-Z]{0,80}[\\da-zA-Z])?)\\.?)|(((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])|(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]|(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]|(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])|0[xX]0*[\\da-fA-F]{1,8}|([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}|([\\da-fA-F]{1,4}\\:){6}((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])))(\\:\\d+)?(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]{0,}(?:\\?[^?#\\s/]*)?(?:#.*)?)?)?",
emailRegExp:"\x3c?(mailto\\:)([!#-'*+\\-\\/-9\x3d?A-Z^-~]+[.])*[!#-'*+\\-\\/-9\x3d?A-Z^-~]+@((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)+(?:[a-zA-Z](?:[-\\da-zA-Z]{0,6}[\\da-zA-Z])?)\\.?)|localhost|^[^-][a-zA-Z0-9_-]*\x3e?",htmlTemplate:'\x3ca href\x3d"${urlInput}" _djrealurl\x3d"${urlInput}" target\x3d"${targetSelect}"\x3e${textInput}\x3c/a\x3e',tag:"a",_hostRxp:/^((([^\[:]+):)?([^@]+)@)?(\[([^\]]+)\]|([^\[:]*))(:([0-9]+))?$/,_userAtRxp:/^([!#-'*+\-\/-9=?A-Z^-~]+[.])*[!#-'*+\-\/-9=?A-Z^-~]+@/i,
linkDialogTemplate:"\x3ctable role\x3d'presentation'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_urlInput'\x3e${url}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'true' id\x3d'${id}_urlInput' name\x3d'urlInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_textInput'\x3e${text}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'true' id\x3d'${id}_textInput' name\x3d'textInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_targetSelect'\x3e${target}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cselect id\x3d'${id}_targetSelect' name\x3d'targetSelect' data-dojo-type\x3d'dijit.form.Select'\x3e\x3coption selected\x3d'selected' value\x3d'_self'\x3e${currentWindow}\x3c/option\x3e\x3coption value\x3d'_blank'\x3e${newWindow}\x3c/option\x3e\x3coption value\x3d'_top'\x3e${topWindow}\x3c/option\x3e\x3coption value\x3d'_parent'\x3e${parentWindow}\x3c/option\x3e\x3c/select\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d'2'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'submit' id\x3d'${id}_setButton'\x3e${set}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'button' id\x3d'${id}_cancelButton'\x3e${buttonCancel}\x3c/button\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",
_initButton:function(){this.inherited(arguments);this.button.loadDropDown=x.hitch(this,"_loadDropDown");this._connectTagEvents()},_loadDropDown:function(e){Q("dojo/i18n ../../TooltipDialog ../../registry ../../form/Button ../../form/Select ../../form/ValidationTextBox dojo/i18n!../../nls/common dojo/i18n!../nls/LinkDialog".split(" "),x.hitch(this,function(c,f,A){var C=this;this.tag="insertImage"==this.command?"img":"a";c=x.delegate(c.getLocalization("dijit","common",this.lang),c.getLocalization("dijit._editor",
"LinkDialog",this.lang));var F=this.dropDown=this.button.dropDown=new f({title:c[this.command+"Title"],ownerDocument:this.editor.ownerDocument,dir:this.editor.dir,execute:x.hitch(this,"setValue"),onOpen:function(){C._onOpenDialog();f.prototype.onOpen.apply(this,arguments)},onCancel:function(){setTimeout(x.hitch(C,"_onCloseDialog"),0)}});c.urlRegExp=this.urlRegExp;c.id=A.getUniqueId(this.editor.id);this._uniqueId=c.id;this._setContent(F.title+"\x3cdiv style\x3d'border-bottom: 1px black solid;padding-bottom:2pt;margin-bottom:4pt'\x3e\x3c/div\x3e"+
v.substitute(this.linkDialogTemplate,c));F.startup();this._urlInput=A.byId(this._uniqueId+"_urlInput");this._textInput=A.byId(this._uniqueId+"_textInput");this._setButton=A.byId(this._uniqueId+"_setButton");this.own(A.byId(this._uniqueId+"_cancelButton").on("click",x.hitch(this.dropDown,"onCancel")));this._urlInput&&this.own(this._urlInput.on("change",x.hitch(this,"_checkAndFixInput")));this._textInput&&this.own(this._textInput.on("change",x.hitch(this,"_checkAndFixInput")));this._urlRegExp=new RegExp("^"+
this.urlRegExp+"$","i");this._emailRegExp=new RegExp("^"+this.emailRegExp+"$","i");this._urlInput.isValid=x.hitch(this,function(){var z=this._urlInput.get("value");return this._urlRegExp.test(z)||this._emailRegExp.test(z)});this.own(n(F.domNode,"keydown",x.hitch(this,x.hitch(this,function(z){!z||z.keyCode!=J.ENTER||z.shiftKey||z.metaKey||z.ctrlKey||z.altKey||this._setButton.get("disabled")||(F.onExecute(),F.execute(F.get("value")))}))));e()}))},_checkAndFixInput:function(){var e=this,c=this._urlInput.get("value");
this._delayedCheck&&(clearTimeout(this._delayedCheck),this._delayedCheck=null);this._delayedCheck=setTimeout(function(){var f=c,A=!1,C=!1;f&&1<f.length&&(f=x.trim(f),0!==f.indexOf("mailto:")&&(0<f.indexOf("/")?-1===f.indexOf("://")&&"/"!==f.charAt(0)&&f.indexOf("./")&&0!==f.indexOf("../")&&e._hostRxp.test(f)&&(A=!0):e._userAtRxp.test(f)&&(C=!0)));A&&e._urlInput.set("value","http://"+f);C&&e._urlInput.set("value","mailto:"+f);e._setButton.set("disabled",!e._isValid())},250)},_connectTagEvents:function(){this.editor.onLoadDeferred.then(x.hitch(this,
function(){this.own(n(this.editor.editNode,"mouseup",x.hitch(this,"_onMouseUp")));this.own(n(this.editor.editNode,"dblclick",x.hitch(this,"_onDblClick")))}))},_isValid:function(){return this._urlInput.isValid()&&this._textInput.isValid()},_setContent:function(e){this.dropDown.set({parserScope:"dojo",content:e})},_checkValues:function(e){e&&e.urlInput&&(e.urlInput=e.urlInput.replace(/"/g,"\x26quot;"));!this.allowUnsafeHtml&&e&&e.textInput&&("function"===typeof this.linkFilter?e.textInput=this.linkFilter(e.textInput):
I.forEach(this.linkFilter,function(c){e.textInput=e.textInput.replace(c[0],c[1])}));return e},_createlinkEnabledImpl:function(){return!0},setValue:function(e){this._onCloseDialog();if(9>q("ie")){var c=b.getSelection(this.editor.window).getRangeAt(0).endContainer;3===c.nodeType&&(c=c.parentNode);c&&c.nodeName&&c.nodeName.toLowerCase()!==this.tag&&(c=this.editor.selection.getSelectedElement(this.tag));c&&c.nodeName&&c.nodeName.toLowerCase()===this.tag&&this.editor.queryCommandEnabled("unlink")&&(this.editor.selection.selectElementChildren(c),
this.editor.execCommand("unlink"))}e=this._checkValues(e);this.editor.execCommand("inserthtml",v.substitute(this.htmlTemplate,e));t("a",this.editor.document).forEach(function(f){f.innerHTML||V.has(f,"name")||f.parentNode.removeChild(f)},this)},_onCloseDialog:function(){this.editor.focused&&this.editor.focus()},_getCurrentValues:function(e){if(e&&e.tagName.toLowerCase()===this.tag){var c=e.getAttribute("_djrealurl")||e.getAttribute("href");var f=e.getAttribute("target")||"_self";var A=e.textContent||
e.innerText;this.editor.selection.selectElement(e,!0)}else A=this.editor.selection.getSelectedText();return{urlInput:c||"",textInput:A||"",targetSelect:f||""}},_onOpenDialog:function(){if(q("ie")){var e=b.getSelection(this.editor.window);if(e.rangeCount){var c=e.getRangeAt(0);var f=c.endContainer;3===f.nodeType&&(f=f.parentNode);f&&f.nodeName&&f.nodeName.toLowerCase()!==this.tag&&(f=this.editor.selection.getSelectedElement(this.tag));if(!f||f.nodeName&&f.nodeName.toLowerCase()!==this.tag)(e=this.editor.selection.getAncestorElement(this.tag))&&
e.nodeName&&e.nodeName.toLowerCase()==this.tag?(f=e,this.editor.selection.selectElement(f)):c.startContainer===c.endContainer&&(e=c.startContainer.firstChild)&&e.nodeName&&e.nodeName.toLowerCase()==this.tag&&(f=e,this.editor.selection.selectElement(f))}}else f=this.editor.selection.getAncestorElement(this.tag);this.dropDown.reset();this._setButton.set("disabled",!0);this.dropDown.set("value",this._getCurrentValues(f))},_onDblClick:function(e){if(e&&e.target&&(e=e.target,(e.tagName?e.tagName.toLowerCase():
"")===this.tag&&V.get(e,"href"))){var c=this.editor;this.editor.selection.selectElement(e);c.onDisplayChanged();c._updateTimer&&(c._updateTimer.remove(),delete c._updateTimer);c.onNormalizedDisplayChanged();var f=this.button;setTimeout(function(){f.set("disabled",!1);f.loadAndOpenDropDown().then(function(){f.dropDown.focus&&f.dropDown.focus()})},10)}},_onMouseUp:function(){if(q("ff")){var e=this.editor.selection.getAncestorElement(this.tag);if(e){var c=b.getSelection(this.editor.window).getRangeAt(0);
if(c.collapsed&&e.childNodes.length){var f=c.cloneRange();f.selectNodeContents(e.childNodes[e.childNodes.length-1]);f.setStart(e.childNodes[0],0);1!==c.compareBoundaryPoints(f.START_TO_START,f)?c.setStartBefore(e):-1!==c.compareBoundaryPoints(f.END_TO_START,f)&&c.setStartAfter(e)}}}}}),k=P("dijit._editor.plugins.ImgLinkDialog",[m],{linkDialogTemplate:"\x3ctable role\x3d'presentation'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_urlInput'\x3e${url}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput dojoType\x3d'dijit.form.ValidationTextBox' regExp\x3d'${urlRegExp}' required\x3d'true' id\x3d'${id}_urlInput' name\x3d'urlInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_textInput'\x3e${text}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'false' id\x3d'${id}_textInput' name\x3d'textInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3c/td\x3e\x3ctd\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d'2'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'submit' id\x3d'${id}_setButton'\x3e${set}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'button' id\x3d'${id}_cancelButton'\x3e${buttonCancel}\x3c/button\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",
htmlTemplate:'\x3cimg src\x3d"${urlInput}" _djrealurl\x3d"${urlInput}" alt\x3d"${textInput}" /\x3e',tag:"img",_getCurrentValues:function(e){if(e&&e.tagName.toLowerCase()===this.tag){var c=e.getAttribute("_djrealurl")||e.getAttribute("src");var f=e.getAttribute("alt");this.editor.selection.selectElement(e,!0)}else f=this.editor.selection.getSelectedText();return{urlInput:c||"",textInput:f||""}},_isValid:function(){return this._urlInput.isValid()},_connectTagEvents:function(){this.inherited(arguments);
this.editor.onLoadDeferred.then(x.hitch(this,function(){this.own(n(this.editor.editNode,"mousedown",x.hitch(this,"_selectTag")))}))},_selectTag:function(e){e&&e.target&&(e=e.target,(e.tagName?e.tagName.toLowerCase():"")===this.tag&&this.editor.selection.selectElement(e))},_checkValues:function(e){e&&e.urlInput&&(e.urlInput=e.urlInput.replace(/"/g,"\x26quot;"));e&&e.textInput&&(e.textInput=e.textInput.replace(/"/g,"\x26quot;"));return e},_onDblClick:function(e){if(e&&e.target&&(e=e.target,(e.tagName?
e.tagName.toLowerCase():"")===this.tag&&V.get(e,"src"))){var c=this.editor;this.editor.selection.selectElement(e);c.onDisplayChanged();c._updateTimer&&(c._updateTimer.remove(),delete c._updateTimer);c.onNormalizedDisplayChanged();var f=this.button;setTimeout(function(){f.set("disabled",!1);f.loadAndOpenDropDown().then(function(){f.dropDown.focus&&f.dropDown.focus()})},10)}}});H.registry.createLink=function(e){var c={command:"createLink",allowUnsafeHtml:"allowUnsafeHtml"in e?e.allowUnsafeHtml:!1};
"linkFilter"in e&&(c.linkFilter=e.linkFilter);return new m(c)};H.registry.insertImage=function(){return new k({command:"insertImage"})};m.ImgLinkDialog=k;return m})},"dijit/_editor/plugins/TextColor":function(){define("require dojo/colors dojo/_base/declare dojo/_base/lang ../_Plugin ../../form/DropDownButton".split(" "),function(Q,I,P,V,J,x){var n=P("dijit._editor.plugins.TextColor",J,{buttonClass:x,colorPicker:"dijit/ColorPalette",useDefaultCommand:!1,_initButton:function(){this.command=this.name;
this.inherited(arguments);var q=this;this.button.loadDropDown=function(t){function v(H){q.button.dropDown=new H({dir:q.editor.dir,ownerDocument:q.editor.ownerDocument,value:q.value,onChange:function(d){q.editor.execCommand(q.command,d)},onExecute:function(){q.editor.execCommand(q.command,this.get("value"))}});t()}"string"==typeof q.colorPicker?Q([q.colorPicker],v):v(q.colorPicker)}},updateState:function(){var q=this.editor,t=this.command;if(q&&q.isLoaded&&t.length){if(this.button){var v=this.get("disabled");
this.button.set("disabled",v);if(v)return;try{var H=q.queryCommandValue(t)||""}catch(d){H=""}}""==H&&(H="#000000");"transparent"==H&&(H="#ffffff");"string"==typeof H?-1<H.indexOf("rgb")&&(H=I.fromRgb(H).toHex()):(H=((H&255)<<16|H&65280|(H&16711680)>>>16).toString(16),H="#000000".slice(0,7-H.length)+H);this.value=H;(q=this.button.dropDown)&&q.get&&H!==q.get("value")&&q.set("value",H,!1)}}});J.registry.foreColor=function(q){return new n(q)};J.registry.hiliteColor=function(q){return new n(q)};return n})},
"esri/dijit/editing/AttachmentEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/io-query dojo/dom-attr dijit/_Widget dijit/_Templated dijit/ProgressBar ../../kernel ../../lang ../../domUtils dojo/text!./templates/AttachmentEditor.html dojo/i18n!../../nls/jsapi dojo/NodeList-dom".split(" "),function(Q,I,P,V,J,x,n,q,t,v,H,d,b,m,k,e,c){Q=Q([v,H],{declaredClass:"esri.dijit.editing.AttachmentEditor",widgetsInTemplate:!0,
templateString:e,_listHtml:"\x3cspan id\x3d'node_${oid}_${attid}' style\x3d'display: flex;'\x3e\x3ca href\x3d'${href}' target\x3d'_blank'\x3e${name}\x3c/a\x3e",_deleteBtnHtml:"\x3cspan style\x3d'cursor:pointer;color:red;font-weight:bold;padding:0 2px;' class\x3d'deleteAttachment' id\x3d'${attid}');'\x3eX\x3c/span\x3e",_endHtml:"\x3cbr/\x3e\x3c/span\x3e",_aeConnects:[],_layerEditingCapChecked:{},_layerEditingCap:{},constructor:function(f,A){I.mixin(this,c.widgets.attachmentEditor)},startup:function(){this.inherited(arguments);
this._uploadField_connect=P.connect(this._uploadField,"onchange",this,function(){0<this._uploadField.value.length&&this._addAttachment()});this._uploadFieldFocus_connect=P.connect(this._uploadField,"onfocus",I.hitch(this,function(f){k.hide(this._attachmentError)}))},destroy:function(){V.forEach(this._aeConnects,P.disconnect);P.disconnect(this._uploadField_connect);P.disconnect(this._uploadFieldFocus_connect);this.inherited(arguments)},showAttachments:function(f,A){this._attachmentList.innerHTML=this.NLS_none;
this._uploadField.value="";V.forEach(this.domNode.children,function(C,F){k.show(C)});k.hide(this._attachmentError);f&&(this._featureLayer=f.getLayer()||A)&&("esri.layers.FeatureLayer"===this._featureLayer.declaredClass&&this._featureLayer.getEditCapabilities?(this._currentLayerId=this._featureLayer.id,this._layerEditingCapChecked[this._currentLayerId]||(this._layerEditingCap[this._currentLayerId]=this._featureLayer.getEditCapabilities(),this._layerEditingCapChecked[this._currentLayerId]=!0),this._featureCanUpdate=
this._featureLayer.getEditCapabilities({feature:f}).canUpdate,this._oid=f.attributes[this._featureLayer.objectIdField],this._getAttachments(f)):A&&A.getEditCapabilities()||(k.hide(this._uploadForm),V.forEach(this.domNode.children,function(C,F){k.hide(C)})))},_getAttachments:function(f){this._featureLayer&&this._featureLayer.queryAttachmentInfos&&this._featureLayer.queryAttachmentInfos(this._oid,I.hitch(this,"_onQueryAttachmentInfosComplete"))},_addAttachment:function(){k.hide(this._attachmentError);
this._featureLayer&&this._featureLayer.addAttachment?(k.show(this._attachmentProgress),this._featureLayer.addAttachment(this._oid,this._uploadForm,I.hitch(this,"_onAddAttachmentComplete"),I.hitch(this,"_onAddAttachmentError"))):this._tempUpload=this._uploadForm},_chainAttachment:function(f,A){this._tempUpload&&(k.show(this._attachmentProgress),A.addAttachment(f,this._tempUpload,I.hitch(this,"_onAddAttachmentComplete"),I.hitch(this,"_onAddAttachmentError")));this._tempUpload=null},_deleteAttachment:function(f,
A){k.show(this._attachmentProgress);this._featureLayer.deleteAttachments(f,[A],I.hitch(this,"_onDeleteAttachmentComplete"))},_onQueryAttachmentInfosComplete:function(f){var A=this._listHtml+this._deleteBtnHtml+this._endHtml;this._uploadForm.style.display="block";!this._featureCanUpdate&&this._layerEditingCap[this._currentLayerId].canUpdate||!this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate?(A=this._listHtml+this._endHtml,this._uploadForm.style.display=
"none"):this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate&&(A=this._listHtml+this._endHtml);var C=this._attachmentList;f=V.map(f,I.hitch(this,function(F){return m.substitute({href:F.url,name:F.name,oid:F.objectId,attid:F.id},A)}));C.innerHTML=f.join("")||this.NLS_none;this._updateConnects()},_onAddAttachmentComplete:function(f){k.hide(this._attachmentProgress.domNode);var A=this._attachmentList,C=this._uploadField,F=C.value,z=F.lastIndexOf("\\");
-1<z&&(F=F.substring(z+1,F.length));F=F.replace(/ /g,"_");z=q.objectToQuery({gdbVersion:this._featureLayer.gdbVersion,token:this._featureLayer._getToken()});var K=this._listHtml+this._deleteBtnHtml+this._endHtml;this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate&&(K=this._listHtml+this._endHtml);f=m.substitute({href:this._featureLayer._url.path+"/"+f.objectId+"/attachments/"+f.attachmentId+(z?"?"+z:""),name:F,oid:f.objectId,attid:f.attachmentId},
K);A.innerHTML=A.innerHTML==this.NLS_none?f:A.innerHTML+f;this._updateConnects();C.value=""},_onAddAttachmentError:function(f){k.hide(this._attachmentProgress.domNode);if(f){var A=this.NLS_error,C=this._attachmentError;m.isDefined(f.code)&&400===f.code&&(A=this.NLS_fileNotSupported);t.set(C,"innerHTML",A);k.show(C)}},_onDeleteAttachmentComplete:function(f){k.hide(this._attachmentProgress.domNode);var A=this._attachmentList;V.every(f,function(C){return C.success})&&(J.query("#node_"+f[0].objectId+
"_"+f[0].attachmentId).orphan(),A.children&&A.children.length||(A.innerHTML=this.NLS_none))},_updateConnects:function(){V.forEach(this._aeConnects,P.disconnect);J.query(".deleteAttachment").forEach(function(f){this._aeConnects.push(P.connect(f,"onclick",I.hitch(this,"_deleteAttachment",this._oid,f.id)))},this)}});x("extend-esri")&&I.setObject("dijit.editing.AttachmentEditor",Q,b);return Q})},"dijit/ProgressBar":function(){define("require dojo/_base/declare dojo/dom-class dojo/_base/lang dojo/number ./_Widget ./_TemplatedMixin dojo/text!./templates/ProgressBar.html".split(" "),
function(Q,I,P,V,J,x,n,q){return I("dijit.ProgressBar",[x,n],{progress:"0",value:"",maximum:100,places:0,indeterminate:!1,label:"",name:"",templateString:q,_indeterminateHighContrastImagePath:Q.toUrl("./themes/a11y/indeterminate_progress.gif"),postMixInProperties:function(){this.inherited(arguments);this.params&&"value"in this.params||(this.value=this.indeterminate?Infinity:this.progress)},buildRendering:function(){this.inherited(arguments);this.indeterminateHighContrastImage.setAttribute("src",this._indeterminateHighContrastImagePath.toString());
this.update()},_setDirAttr:function(t){var v="rtl"==t.toLowerCase();P.toggle(this.domNode,"dijitProgressBarRtl",v);P.toggle(this.domNode,"dijitProgressBarIndeterminateRtl",this.indeterminate&&v);this.inherited(arguments)},update:function(t){V.mixin(this,t||{});t=this.internalProgress;var v=this.domNode,H=1;this.indeterminate?v.removeAttribute("aria-valuenow"):(-1!=String(this.progress).indexOf("%")?(H=Math.min(parseFloat(this.progress)/100,1),this.progress=H*this.maximum):(this.progress=Math.min(this.progress,
this.maximum),H=this.maximum?this.progress/this.maximum:0),v.setAttribute("aria-valuenow",this.progress));v.setAttribute("aria-labelledby",this.labelNode.id);v.setAttribute("aria-valuemin",0);v.setAttribute("aria-valuemax",this.maximum);this.labelNode.innerHTML=this.report(H);P.toggle(this.domNode,"dijitProgressBarIndeterminate",this.indeterminate);P.toggle(this.domNode,"dijitProgressBarIndeterminateRtl",this.indeterminate&&!this.isLeftToRight());t.style.width=100*H+"%";this.onChange()},_setValueAttr:function(t){this._set("value",
t);Infinity==t?this.update({indeterminate:!0}):this.update({indeterminate:!1,progress:t})},_setLabelAttr:function(t){this._set("label",t);this.update()},_setIndeterminateAttr:function(t){this._set("indeterminate",t);this.update()},report:function(t){return this.label?this.label:this.indeterminate?"\x26#160;":J.format(t,{type:"percent",places:this.places,locale:this.lang})},onChange:function(){}})})},"esri/dijit/editing/Util":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/has","../../kernel"],
function(Q,I,P,V){var J={};J={findFeatures:function(x,n,q){var t=n.objectIdField;n=I.filter(n.graphics,function(v){return I.some(x,function(H){return v.attributes[t]===H.objectId})});if(q)q(n);else return n},getSelection:function(x){var n=[];I.forEach(x,function(q){q=q.getSelectedFeatures();I.forEach(q,function(t){n.push(t)})});return n},sortFeaturesById:function(x,n){var q=I.map(x,function(t){return t.featureLayer});n.sort(function(t,v){var H=t.getLayer(),d=v.getLayer();if(!H)return-1;if(!d)return 1;
var b=I.indexOf(q,H);d=I.indexOf(q,d);b-=d;b||(H=H.objectIdField,b=t.attributes[H]-v.attributes[H]);return b});return n}};P("extend-esri")&&Q.setObject("dijit.editing.Util.LayerHelper",J,V);return J})},"dojox/date/islamic":function(){define(["dojox/main","dojo/_base/lang","dojo/date","./islamic/Date"],function(Q,I,P,V){var J=I.getObject("date.islamic",!0,Q);J.getDaysInMonth=function(x){return x.getDaysInIslamicMonth(x.getMonth(),x.getFullYear())};J.compare=function(x,n,q){x instanceof V&&(x=x.toGregorian());
n instanceof V&&(n=n.toGregorian());return P.compare.apply(null,arguments)};J.add=function(x,n,q){var t=new V(x);switch(n){case "day":t.setDate(x.getDate()+q);break;case "weekday":var v=x.getDay();if(5>v+q&&0<v+q)t.setDate(x.getDate()+q);else{var H=n=0;5==v?(v=4,H=0<q?-1:1):6==v&&(v=4,H=0<q?-2:2);v=0<q?5-v-1:-v;var d=q-v,b=parseInt(d/5);0!=d%5&&(n=0<q?2:-2);n=n+7*b+d%5+v;t.setDate(x.getDate()+n+H)}break;case "year":t.setFullYear(x.getFullYear()+q);break;case "week":q*=7;t.setDate(x.getDate()+q);break;
case "month":x=x.getMonth();t.setMonth(x+q);break;case "hour":t.setHours(x.getHours()+q);break;case "minute":t._addMinutes(q);break;case "second":t._addSeconds(q);break;case "millisecond":t._addMilliseconds(q)}return t};J.difference=function(x,n,q){n=n||new V;q=q||"day";var t=n.getFullYear()-x.getFullYear(),v=1;switch(q){case "weekday":t=Math.round(J.difference(x,n,"day"));v=parseInt(J.difference(x,n,"week"));if(0==t%7)t=5*v;else{q=0;var H=x.getDay(),d=n.getDay();v=parseInt(t/7);n=t%7;x=new V(x);
x.setDate(x.getDate()+7*v);x=x.getDay();if(0<t)switch(!0){case 5==H:q=-1;break;case 6==H:q=0;break;case 5==d:q=-1;break;case 6==d:q=-2;break;case 5<x+n:q=-2}else if(0>t)switch(!0){case 5==H:q=0;break;case 6==H:q=1;break;case 5==d:q=2;break;case 6==d:q=1;break;case 0>x+n:q=2}t=t+q-2*v}v=t;break;case "year":v=t;break;case "month":q=n.toGregorian()>x.toGregorian()?n:x;H=n.toGregorian()>x.toGregorian()?x:n;v=q.getMonth();d=H.getMonth();if(0==t)v=q.getMonth()-H.getMonth();else for(v=12-d+v,t=H.getFullYear()+
1,q=q.getFullYear(),t;t<q;t++)v+=12;n.toGregorian()<x.toGregorian()&&(v=-v);break;case "week":v=parseInt(J.difference(x,n,"day")/7);break;case "day":v/=24;case "hour":v/=60;case "minute":v/=60;case "second":v/=1E3;case "millisecond":v*=n.toGregorian().getTime()-x.toGregorian().getTime()}return Math.round(v)};return J})},"dojox/date/islamic/Date":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/date"],function(Q,I,P){var V=I("dojox.date.islamic.Date",null,{_date:0,_month:0,_year:0,_hours:0,
_minutes:0,_seconds:0,_milliseconds:0,_day:0,_GREGORIAN_EPOCH:1721425.5,_ISLAMIC_EPOCH:1948439.5,constructor:function(){var J=arguments.length;J?1==J?(J=arguments[0],"number"==typeof J&&(J=new Date(J)),J instanceof Date?this.fromGregorian(J):""==J?this._date=new Date(""):(this._year=J._year,this._month=J._month,this._date=J._date,this._hours=J._hours,this._minutes=J._minutes,this._seconds=J._seconds,this._milliseconds=J._milliseconds)):3<=J&&(this._year+=arguments[0],this._month+=arguments[1],this._date+=
arguments[2],this._hours+=arguments[3]||0,this._minutes+=arguments[4]||0,this._seconds+=arguments[5]||0,this._milliseconds+=arguments[6]||0):this.fromGregorian(new Date)},getDate:function(){return this._date},getMonth:function(){return this._month},getFullYear:function(){return this._year},getDay:function(){return this.toGregorian().getDay()},getHours:function(){return this._hours},getMinutes:function(){return this._minutes},getSeconds:function(){return this._seconds},getMilliseconds:function(){return this._milliseconds},
setDate:function(J){J=parseInt(J);if(!(0<J&&J<=this.getDaysInIslamicMonth(this._month,this._year))){var x;if(0<J)for(x=this.getDaysInIslamicMonth(this._month,this._year);J>x;J-=x,x=this.getDaysInIslamicMonth(this._month,this._year))this._month++,12<=this._month&&(this._year++,this._month-=12);else for(x=this.getDaysInIslamicMonth(0<=this._month-1?this._month-1:11,0<=this._month-1?this._year:this._year-1);0>=J;x=this.getDaysInIslamicMonth(0<=this._month-1?this._month-1:11,0<=this._month-1?this._year:
this._year-1))this._month--,0>this._month&&(this._year--,this._month+=12),J+=x}this._date=J;return this},setFullYear:function(J){this._year=+J},setMonth:function(J){this._year+=Math.floor(J/12);this._month=0<J?Math.floor(J%12):Math.floor((J%12+12)%12)},setHours:function(){var J=arguments.length,x=0;1<=J&&(x=parseInt(arguments[0]));2<=J&&(this._minutes=parseInt(arguments[1]));3<=J&&(this._seconds=parseInt(arguments[2]));4==J&&(this._milliseconds=parseInt(arguments[3]));for(;24<=x;)this._date++,J=this.getDaysInIslamicMonth(this._month,
this._year),this._date>J&&(this._month++,12<=this._month&&(this._year++,this._month-=12),this._date-=J),x-=24;this._hours=x},_addMinutes:function(J){J+=this._minutes;this.setMinutes(J);this.setHours(this._hours+parseInt(J/60));return this},_addSeconds:function(J){J+=this._seconds;this.setSeconds(J);this._addMinutes(parseInt(J/60));return this},_addMilliseconds:function(J){J+=this._milliseconds;this.setMilliseconds(J);this._addSeconds(parseInt(J/1E3));return this},setMinutes:function(J){this._minutes=
J%60;return this},setSeconds:function(J){this._seconds=J%60;return this},setMilliseconds:function(J){this._milliseconds=J%1E3;return this},toString:function(){if(isNaN(this._date))return"Invalidate Date";var J=new Date;J.setHours(this._hours);J.setMinutes(this._minutes);J.setSeconds(this._seconds);J.setMilliseconds(this._milliseconds);return this._month+" "+this._date+" "+this._year+" "+J.toTimeString()},toGregorian:function(){var J=this._year;J=Math.floor(this._date+Math.ceil(29.5*this._month)+354*
(J-1)+Math.floor((3+11*J)/30)+this._ISLAMIC_EPOCH-1-.5)+.5;var x=J-this._GREGORIAN_EPOCH,n=Math.floor(x/146097),q=this._mod(x,146097);x=Math.floor(q/36524);var t=this._mod(q,36524);q=Math.floor(t/1461);t=this._mod(t,1461);t=Math.floor(t/365);n=400*n+100*x+4*q+t;4!=x&&4!=t&&n++;x=J-(this._GREGORIAN_EPOCH+365*(n-1)+Math.floor((n-1)/4)-Math.floor((n-1)/100)+Math.floor((n-1)/400));q=this._GREGORIAN_EPOCH-1+365*(n-1)+Math.floor((n-1)/4)-Math.floor((n-1)/100)+Math.floor((n-1)/400)+Math.floor(739/12+(P.isLeapYear(new Date(n,
3,1))?-1:-2)+1);q=J<q?0:P.isLeapYear(new Date(n,3,1))?1:2;x=Math.floor((12*(x+q)+373)/367);q=this._GREGORIAN_EPOCH-1+365*(n-1)+Math.floor((n-1)/4)-Math.floor((n-1)/100)+Math.floor((n-1)/400)+Math.floor((367*x-362)/12+(2>=x?0:P.isLeapYear(new Date(n,x-1,1))?-1:-2)+1);return new Date(n,x-1,J-q+1,this._hours,this._minutes,this._seconds,this._milliseconds)},fromGregorian:function(J){J=new Date(J);var x=J.getFullYear(),n=J.getMonth(),q=J.getDate();x=this._GREGORIAN_EPOCH-1+365*(x-1)+Math.floor((x-1)/4)+
-Math.floor((x-1)/100)+Math.floor((x-1)/400)+Math.floor((367*(n+1)-362)/12+(2>=n+1?0:P.isLeapYear(J)?-1:-2)+q);x=Math.floor(x)+.5;x-=this._ISLAMIC_EPOCH;n=Math.floor((30*x+10646)/10631);q=Math.ceil((x-29-this._yearStart(n))/29.5);q=Math.min(q,11);this._date=Math.ceil(x-this._monthStart(n,q))+1;this._month=q;this._year=n;this._hours=J.getHours();this._minutes=J.getMinutes();this._seconds=J.getSeconds();this._milliseconds=J.getMilliseconds();this._day=J.getDay();return this},valueOf:function(){return this.toGregorian().valueOf()},
_yearStart:function(J){return 354*(J-1)+Math.floor((3+11*J)/30)},_monthStart:function(J,x){return Math.ceil(29.5*x)+354*(J-1)+Math.floor((3+11*J)/30)},_civilLeapYear:function(J){return 11>(14+11*J)%30},getDaysInIslamicMonth:function(J,x){var n=0;n=29+(J+1)%2;11==J&&this._civilLeapYear(x)&&n++;return n},_mod:function(J,x){return J-x*Math.floor(J/x)}});V.getDaysInIslamicMonth=function(J){return(new V).getDaysInIslamicMonth(J.getMonth(),J.getFullYear())};return V})},"dojox/date/islamic/locale":function(){define("dojox/main dojo/_base/lang dojo/_base/array dojo/date dojo/i18n dojo/regexp dojo/string ./Date dojo/i18n!dojo/cldr/nls/islamic".split(" "),
function(Q,I,P,V,J,x,n,q,t){function v(k,e,c,f,A){return A.replace(/([a-z])\1*/ig,function(C){var F=C.charAt(0);C=C.length;var z=["abbr","wide","narrow"];switch(F){case "G":var K=e.eraAbbr[0];break;case "y":K=String(k.getFullYear());break;case "M":K=k.getMonth();if(3>C){K+=1;var D=!0}else F=["months-format",z[C-3]].join("-"),K=e[F][K];break;case "d":K=k.getDate(!0);D=!0;break;case "E":K=k.getDay();3>C?(K+=1,D=!0):(F=["days-format",z[C-3]].join("-"),K=e[F][K]);break;case "a":K=12>k.getHours()?"am":
"pm";K=e["dayPeriods-format-wide-"+K];break;case "h":case "H":case "K":case "k":D=k.getHours();switch(F){case "h":K=D%12||12;break;case "H":K=D;break;case "K":K=D%12;break;case "k":K=D||24}D=!0;break;case "m":K=k.getMinutes();D=!0;break;case "s":K=k.getSeconds();D=!0;break;case "S":K=Math.round(k.getMilliseconds()*Math.pow(10,C-3));D=!0;break;case "z":if(K=V.getTimezoneName(k.toGregorian()))break;C=4;case "Z":K=k.toGregorian().getTimezoneOffset();K=[0>=K?"+":"-",n.pad(Math.floor(Math.abs(K)/60),2),
n.pad(Math.abs(K)%60,2)];4==C&&(K.splice(0,0,"GMT"),K.splice(3,0,":"));K=K.join("");break;default:throw Error("dojox.date.islamic.locale.formatPattern: invalid pattern char: "+A);}D&&(K=n.pad(K,C));return K})}function H(k,e,c,f){var A=function(z){return z};e=e||A;c=c||A;f=f||A;var C=k.match(/(''|[^'])+/g),F="'"==k.charAt(0);P.forEach(C,function(z,K){z?(C[K]=(F?c:e)(z),F=!F):C[K]=""});return f(C.join(""))}function d(k,e,c,f){f=x.escapeString(f);J.normalizeLocale(c.locale);return f.replace(/([a-z])\1*/ig,
function(A){var C=A.charAt(0);var F=A.length,z="";c.strict?1<F&&(z="0{"+(F-1)+"}"):z="0?";switch(C){case "y":C="\\d+";break;case "M":C=2<F?"\\S+ ?\\S+":z+"[1-9]|1[0-2]";break;case "d":C="[12]\\d|"+z+"[1-9]|3[01]";break;case "E":C="\\S+";break;case "h":C=z+"[1-9]|1[0-2]";break;case "k":C=z+"\\d|1[01]";break;case "H":C=z+"\\d|1\\d|2[0-3]";break;case "K":C=z+"[1-9]|1\\d|2[0-4]";break;case "m":case "s":C=z+"\\d|[0-5]\\d";break;case "S":C="\\d{"+F+"}";break;case "a":F=c.am||e["dayPeriods-format-wide-am"];
z=c.pm||e["dayPeriods-format-wide-pm"];c.strict?C=F+"|"+z:(C=F+"|"+z,F!=F.toLowerCase()&&(C+="|"+F.toLowerCase()),z!=z.toLowerCase()&&(C+="|"+z.toLowerCase()));break;default:C=".*"}k&&k.push(A);return"("+C+")"}).replace(/[\xa0 ]/g,"[\\s\\xa0]")}var b=I.getObject("date.islamic.locale",!0,Q);b.format=function(k,e){e=e||{};var c=J.normalizeLocale(e.locale),f=e.formatLength||"short",A=b._getIslamicBundle(c),C=[];c=I.hitch(this,v,k,A,c,e.fullYear);if("year"==e.selector)return k.getFullYear();"time"!=e.selector&&
(k=e.datePattern||A["dateFormat-"+f])&&C.push(H(k,c));"date"!=e.selector&&(e=e.timePattern||A["timeFormat-"+f])&&C.push(H(e,c));return C.join(" ")};b.regexp=function(k){return b._parseInfo(k).regexp};b._parseInfo=function(k){k=k||{};var e=J.normalizeLocale(k.locale);e=b._getIslamicBundle(e);var c=k.formatLength||"short",f=k.datePattern||e["dateFormat-"+c];c=k.timePattern||e["timeFormat-"+c];var A=[];return{regexp:H("date"==k.selector?f:"time"==k.selector?c:"undefined"==typeof c?f:f+" "+c,I.hitch(this,
d,A,e,k)),tokens:A,bundle:e}};b.parse=function(k,e){k=k.replace(/[\u200E\u200F\u202A\u202E]/g,"");e||(e={});var c=b._parseInfo(e),f=c.tokens,A=c.bundle;c=c.regexp.replace(/[\u200E\u200F\u202A\u202E]/g,"");k=(new RegExp("^"+c+"$")).exec(k);J.normalizeLocale(e.locale);if(!k)return null;var C=[1389,0,1,0,0,0,0],F="",z=["abbr","wide","narrow"];P.every(k,function(K,D){if(!D)return!0;D=f[D-1];var h=D.length;switch(D.charAt(0)){case "y":C[0]=Number(K);break;case "M":if(2<h){if(D=A["months-format-"+z[h-3]].concat(),
e.strict||(K=K.replace(".","").toLowerCase(),D=P.map(D,function(N){return N?N.replace(".","").toLowerCase():N})),K=P.indexOf(D,K),-1==K)return!1}else K--;C[1]=Number(K);break;case "D":C[1]=0;case "d":C[2]=Number(K);break;case "a":D=e.am||A["dayPeriods-format-wide-am"];h=e.pm||A["dayPeriods-format-wide-pm"];if(!e.strict){var B=/\./g;K=K.replace(B,"").toLowerCase();D=D.replace(B,"").toLowerCase();h=h.replace(B,"").toLowerCase()}if(e.strict&&K!=D&&K!=h)return!1;F=K==h?"p":K==D?"a":"";break;case "K":24==
K&&(K=0);case "h":case "H":case "k":C[3]=Number(K);break;case "m":C[4]=Number(K);break;case "s":C[5]=Number(K);break;case "S":C[6]=Number(K)}return!0});k=+C[3];"p"===F&&12>k?C[3]=k+12:"a"===F&&12==k&&(C[3]=0);return new q(C[0],C[1],C[2],C[3],C[4],C[5],C[6])};var m=[];b.addCustomFormats=function(k,e){m.push({pkg:k,name:e})};b._getIslamicBundle=function(k){var e={};P.forEach(m,function(c){c=J.getLocalization(c.pkg,c.name,k);e=I.mixin(e,c)},this);return e};b.addCustomFormats("dojo.cldr","islamic");b.getNames=
function(k,e,c,f,A){f=b._getIslamicBundle(f);k=[k,c,e];if("standAlone"==c){c=k.join("-");var C=f[c];1==C[0]&&(C=void 0)}k[1]="format";return(C||f[k.join("-")]).concat()};b.weekDays=b.getNames("days","wide","format");b.months=b.getNames("months","wide","format");return b})},"widgets/SituationAwareness/js/SummaryInfo":function(){define("dojo/_base/declare dojo/Evented dojo/_base/array dojo/DeferredList dojo/Deferred dojo/_base/lang dojo/dom-class dojo/dom-construct dojo/on dojo/keys jimu/utils jimu/dijit/Message esri/graphic esri/layers/FeatureLayer esri/tasks/query esri/tasks/QueryTask ./analysisUtils".split(" "),
function(Q,I,P,V,J,x,n,q,t,v,H,d,b,m,k,e,c){return Q("SummaryInfo",[I],{summaryLayer:null,summaryFields:[],summaryIds:[],summaryFeatures:[],tabNum:null,symbolField:null,graphicsLayer:null,lyrRenderer:null,lyrSymbol:null,featureCount:0,mapServiceLayer:!1,loading:!1,queryOnLoad:!1,incidentCount:0,allFields:!1,configuredPopUpFields:[],constructor:function(f,A,C){this.tab=f;this.container=A;this.parent=C;this.config=C.config;this.graphicsLayer=null;this.baseLabel=""!==f.label?f.label:f.layerTitle?f.layerTitle:
f.layers;this.parentNode=C.domNode},queryTabCount:function(f,A,C,F){var z=new J;this.incidentCount=f.length;var K=[this.tab.tabLayers[0]];this.mapServiceLayer&&1<this.tab.tabLayers.length&&(K=[this.tab.tabLayers[1]]);if(0<this.tab.tabLayers.length&&this.tab.tabLayers[0].url&&-1<this.tab.tabLayers[0].url.indexOf("MapServer"))if(this.mapServiceLayer=!0,"undefined"!==typeof this.tab.tabLayers[0].infoTemplate)if(this.summaryLayer=this.tab.tabLayers[0],this.summaryLayer.hasOwnProperty("loaded")&&this.summaryLayer.loaded)this.summaryFields=
this._getFields(this.summaryLayer),this._performQuery(f,A,C,F,K).then(function(h){z.resolve(h)});else{var D=new m(this.summaryLayer.url);D.infoTemplate=this.tab.tabLayers[0].infoTemplate;K=[D];this.tab.tabLayers=K;t(D,"load",x.hitch(this,function(){this.summaryLayer=D;this.summaryFields=this._getFields(this.summaryLayer);this._performQuery(f,A,C,F,K).then(function(h){z.resolve(h)})}))}else this.loading||(D=new m(this.tab.tabLayers[0].url),this.loading=!0,t(D,"load",x.hitch(this,function(){this.summaryLayer=
D;this.summaryFields=this._getFields(this.summaryLayer);for(var h=this.tab.tabLayers[0].url.split("MapServer/")[1],B=this.parent.map.itemInfo.itemData.operationalLayers,N=0;N<B.length;N++){var E=B[N];if(-1<this.tab.tabLayers[0].url.indexOf(E.url)&&"undefined"!==typeof E.layerObject)if(E.layerObject.infoTemplates){if(E=E.layerObject.infoTemplates[h]){D.infoTemplate=E.infoTemplate;break}}else if(E.layerObject.infoTemplate){D.infoTemplate=E.layerObject.infoTemplate;break}}K=[D];this.tab.tabLayers=K;
this.loading=!1;this._performQuery(f,A,C,F,K).then(function(O){z.resolve(O)})})));this.mapServiceLayer||this._performQuery(f,A,C,F,K).then(function(h){z.resolve(h)});return z},_performQuery:function(f,A,C,F,z){var K=new J,D=[],h;0<A.length?h=c.getGeoms(A):0<f.length&&(h=c.getGeoms(f));this.summaryGeoms=h;if(0<h.length)for(f=0;f<h.length;f++){D=h[f];A=c.createDefArray(z,D,this.parent.opLayers,this.tab);var B=0===f?D=A:D=B.concat(A)}(new V(D)).then(x.hitch(this,function(N){for(var E=0,O=0;O<N.length;O++){var R=
N[O][1];isNaN(R)?R&&R.features?E+=R.features.length:R&&"undefined"!==typeof R.length&&(E+=R.length):E+=R}this.updateTabCount(E,C,F);this.queryOnLoad&&x.hitch(this,this._queryFeatures(this.summaryGeoms));K.resolve(E)}));return K},updateTabCount:function(f,A,C){this.featureCount=f;c.updateTabCount(this.featureCount,A,C,this.baseLabel,this.incidentCount)},updateForIncident:function(f,A,C,F,z,K,D){this.incidentCount=f.length;this.allFields="undefined"!==typeof K&&"undefined"!==typeof D?K?!0:D:!1;var h=
"undefined"!==typeof z;this.tabNum=F;if(h)var B=new J;else this.container.innerHTML="",n.add(this.container,"loading");this.summaryIds=[];this.summaryFeatures=[];if(0<this.tab.tabLayers.length){var N=this.summaryGeoms;if("undefined"!==typeof this.tab.tabLayers[0].infoTemplate){this.summaryLayer=this.tab.tabLayers[0];var E=new m(this.summaryLayer.url);E.infoTemplate=this.tab.tabLayers[0].infoTemplate;this.tab.tabLayers[1]=E;this.summaryFields=this._getFields(this.tab.tabLayers[0]);this.configuredPopUpFields=
c.getPopupConfiguredFields(this.tab.tabLayers[0]);h?this._queryFeatures(N,h).then(function(O){B.resolve(O)}):(this._initGraphicsLayer(C),x.hitch(this,this._queryFeatures(N)))}else E=new m(this.tab.tabLayers[0].url),t(E,"load",x.hitch(this,function(){this.summaryLayer=E;if(-1<this.tab.tabLayers[0].url.indexOf("MapServer"))for(var O=this.tab.tabLayers[0].url.split("MapServer/")[1],R=this.parent.map.itemInfo.itemData.operationalLayers,a=0;a<R.length;a++){var u=R[a];if(-1<this.tab.tabLayers[0].url.indexOf(u.url)&&
"undefined"!==typeof u.layerObject&&u.layerObject.infoTemplates&&(u=u.layerObject.infoTemplates[O])){E.infoTemplate=u.infoTemplate;break}}this.tab.tabLayers[1]=E;this.summaryLayer=this.tab.tabLayers[1];this.summaryFields=this._getFields(this.tab.tabLayers[1]);this.configuredPopUpFields=c.getPopupConfiguredFields(this.tab.tabLayers[1]);h?this._queryFeatures(N,h).then(function(G){B.resolve(G)}):(this._initGraphicsLayer(C),x.hitch(this,this._queryFeatures(N)))}));if(h)return B}},_initGraphicsLayer:function(f){null!==
f&&(this.graphicsLayer=f,this.graphicsLayer.clear(),this.summaryLayer&&this.summaryLayer.renderer&&(this.lyrRenderer=this.summaryLayer.renderer,this.graphicsLayer.renderer=this.lyrRenderer,"undefined"!==typeof this.summaryLayer.renderer.attributeField?this.symbolField=this.summaryLayer.renderer.attributeField:this.lyrSymbol=this.lyrRenderer.symbol))},_queryFeatures:function(f,A){var C;A&&(C=new J);var F=[],z=-1===[null,void 0,""].indexOf(this.tab.tabLayers[0].id)?this.tab.tabLayers[0].id:this.tab.layers;
z=c.getFilter(z,this.parent.opLayers);for(var K=new k,D=0;D<f.length;D++)K.geometry=f[D],K.where=z,F.push(this.summaryLayer.queryIds(K));(new V(F)).then(x.hitch(this,function(h){for(var B,N,E=0;E<h.length;E++)h[E][0]&&(B=h[E][1],N=B=0===E?B:N.concat(B));B?(this.summaryIds=B,0<this.summaryIds.length?A?this._queryFeaturesByIds(A).then(function(O){C.resolve(O)}):this._queryFeaturesByIds():A||this._processResults()):A||this._processResults()}),x.hitch(this,function(h){console.error(h);new d({message:h})}));
if(A)return C},_queryFeaturesByIds:function(f){var A,C=[];f&&(A=new J);var F=this.summaryLayer.maxRecordCount||1E3,z=this.summaryIds.slice(0,F);this.summaryIds.splice(0,F);var K=new k;K.where=c.getFilter(this.summaryLayer.id,this.parent.opLayers);var D=!1;P.some(this.summaryFields,x.hitch(this,function(B){if("area"===B.type||"length"===B.type||this.graphicsLayer)return D=!0}));f&&(D=!0);K.returnGeometry=D;K.outSpatialReference=this.parent.map.spatialReference;K.outFields=["*"];K.objectIds=z;var h=
new e(this.summaryLayer.url);for(C.push(h.execute(K));0<this.summaryIds.length;)z=this.summaryIds.slice(0,F),this.summaryIds.splice(0,F),K.objectIds=z,C.push(h.execute(K));(new V(C)).then(x.hitch(this,function(B){this.summaryFeatures=[];for(var N=0;N<B.length;N++)if(B[N][0]){var E=B[N][1];E.features&&(this.summaryFeatures=this.summaryFeatures.concat(E.features))}f?this._processResults(f).then(x.hitch(this,function(O){this.SA_SAT_download&&n.replace(this.SA_SAT_download,"download","processing");A.resolve(O)})):
(this._processResults(),this.SA_SAT_download&&n.replace(this.SA_SAT_download,"download","processing"));this.SA_SAT_download&&n.replace(this.SA_SAT_download,"download","processing")}),x.hitch(this,function(B){console.error(B);new d({message:B})}));if(f)return A},_prepResults:function(){for(var f=0;f<this.summaryFields.length;f++){var A=this.summaryFields[f],C=A.field,F=A.total;switch(A.type){case "count":F=this.summaryFeatures.length;break;case "area":F=c.getArea(this.summaryFeatures,this.summaryGeoms,
this.config.distanceSettings,this.config.distanceUnits,this.tab.advStat);break;case "length":F=c.getLength(this.summaryFeatures,this.summaryGeoms,this.config.distanceSettings,this.config.distanceUnits,this.tab.advStat);break;case "sum":F=c.getSum(this.summaryFeatures,C);break;case "avg":F=c.getSum(this.summaryFeatures,C)/this.summaryFeatures.length;break;case "min":F=c.getMin(this.summaryFeatures,C);break;case "max":F=c.getMax(this.summaryFeatures,C)}A.total=F}},_processResults:function(f){this._prepResults();
var A=this.summaryFields,C=0;if(f)var F=new J;else{this.container.innerHTML="";n.remove(this.container,"loading");if(0===this.summaryFeatures.length){this.container.innerHTML=this.parent.nls.noFeaturesFound;return}var z=q.create("div",{style:"width:"+220*(A.length+1)+"px;"},this.container);n.add(z,"SAT_tabPanelContent");var K=q.create("div",{},z);n.add(K,"SATcolExport");n.add(K,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");var D=q.create("div",{"data-dojo-attach-point":"SA_SAT_download",
title:this.parent.nls.downloadCSV,tabindex:"0",role:"button","aria-label":this.parent.nls.downloadCSV,"class":"summaryDownLoadCSVButton"},K);H.initFirstFocusNode(this.parentNode,D);H.initLastFocusNode(this.parentNode,D);n.add(D,[this.parent.isBlackTheme?"btnExportBlack":"btnExport","download"]);n.add(D,this.parent.lightTheme?"lightThemeBackground":"darkThemeBackground");D.focus();t(D,"click",x.hitch(this,this._exportToCSV,A));t(D,"keydown",x.hitch(this,function(O){if(!O.shiftKey||O.keyCode!==v.TAB)if(O.keyCode===
v.TAB&&D.focus(),O.keyCode===v.ENTER||O.keyCode===v.SPACE)this._exportToCSV(A,O),setTimeout(function(){D.focus()},500)}))}K=[];for(var h=0;h<A.length;h++){var B=A[h],N=H.stripHTML(B.alias?B.alias:"")+"\x3cbr/\x3e";B=c.formatNumber(B.total,B);C=B.total;B=B.num;if(f)K.push({num:B,info:N,total:C});else{C=q.create("div",{"class":"SATcol"},z);n.add(C,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");var E=q.create("div",{style:"max-height: 60px;"},C);q.create("div",{"class":" SATcolWrap",style:"max-height: 30px; overflow: hidden;",
innerHTML:N},E);q.create("div",{"class":" colSummary",innerHTML:B},C)}}z=[];h=null!==this.graphicsLayer;!f&&h&&(this.graphicsLayer.clear(),this.tab.tabLayers[1].clear());if(this.summaryFeatures)for(N=0;N<this.summaryFeatures.length;N++)B=this.summaryFeatures[N],this.lyrSymbol?B.symbol=this.lyrSymbol:h&&this.graphicsLayer.renderer?(C=this.graphicsLayer.renderer.getSymbol(B),B.symbol=C):this.summaryLayer.renderer&&this.summaryLayer.renderer.getSymbol&&(B.symbol=this.summaryLayer.renderer.getSymbol(B)),
B=B.toJson?new b(B.toJson()):B,!f&&h?(this.graphicsLayer.add(B),this.tab.tabLayers[1].add(B)):z.push(B);!f&&h&&(this.graphicsLayer.setVisibility(!0),this.parent._toggleTabLayersNew(this.tabNum),this.tab.restore&&this.emit("summary-complete",{bubbles:!0,cancelable:!0,tab:this.tabNum}));if(f)return F.resolve({graphics:z,analysisResults:K,context:this}),F},_exportToCSV:function(f,A,C,F){if(this.parent.config.hasOwnProperty("exportFieldsOptionForCSV"))var z=this.parent.config.exportFieldsOptionForCSV;
else this.parent.config.hasOwnProperty("csvAllFields")&&(z=this.parent.config.csvAllFields);f=c.exportToCSV(this.summaryFeatures,A,C,F,{type:"summary",baseLabel:this.baseLabel,csvAllFields:z,layer:this.summaryLayer,opLayers:this.parent.opLayers,nlsValue:this.parent.nls.summary,nlsCount:this.parent.nls.count,summaryFields:this.summaryFields,calcFields:this.calcFields,allFields:this.allFields,configuredPopUpFields:this.configuredPopUpFields});this.summaryLayer=f.summaryLayer;return f.details},_getFieldInfoByFieldInfo:function(f,
A,C){return this._getFieldInfo(f[A],A,C)},_getFieldInfoByName:function(f,A){var C=["count","area","length","tabCount"],F;for(F in f)if(-1===C.indexOf(F))return this._getFieldInfo(f[F],F,A)},_getFieldInfo:function(f,A,C){for(var F=0;F<f.length;F++){var z=f[F];if(z.expression&&z.expression===C)return{field:{field:z.expression,alias:z.label,type:A,modify:z.modify,round:z.round,roundPlaces:z.roundPlaces,truncate:z.truncate,truncatePlaces:z.truncatePlaces,total:0,show1KSeparator:"undefined"!==typeof z.show1KSeparator?
z.show1KSeparator:!0},index:F}}},_getFields:function(f){this.layerDefinition=H.getFeatureLayerDefinition(f);this.layerObject=f;var A=c.getSkipFields(f),C=[];if("undefined"!==typeof this.tab.advStat){var F=x.clone(this.tab.advStat.stats);this.tab.advStat.fieldOrder&&P.forEach(this.tab.advStat.fieldOrder,x.hitch(this,function(O){if((O=O&&O.hasOwnProperty("fieldName")?this._getFieldInfoByFieldInfo(F,O.fieldType,O.fieldName):this._getFieldInfoByName(F,O))&&O.field){var R=F[O.field.type];R.splice(O.index,
1);0===R.length&&delete F[O.field.type];C.push(O.field)}}));for(var z in F)0<F[z].length&&P.forEach(F[z],function(O){C.push({field:O.expression,alias:O.label,type:z,modify:O.modify,round:O.round,roundPlaces:O.roundPlaces,truncate:O.truncate,truncatePlaces:O.truncatePlaces,total:0,show1KSeparator:"undefined"!==typeof O.show1KSeparator?O.show1KSeparator:!0})})}else{if(f.infoTemplate)var K=f.infoTemplate.info.fieldInfos;else if(-1<this.tab.tabLayers[0].url.indexOf("MapServer")){var D=this.tab.tabLayers[0].url.split("MapServer/")[1],
h=this.parent.map.itemInfo.itemData.operationalLayers;K=null;for(var B=0;B<h.length;B++){var N=h[B];if(N.layerObject.infoTemplates&&(N=N.layerObject.infoTemplates[D])){K=N.infoTemplate.info.fieldInfos;break}}}else K=f.fields;K||(K=f.fields);for(D=0;D<K.length;D++)if(h=K[D],"undefined"!==typeof f.fields){B=f.fields[D].type;var E;h.name===f.objectIdField||"esriFieldTypeDouble"!==B&&"esriFieldTypeInteger"!==B&&"esriFieldTypeSmallInteger"!==B||("undefined"!==typeof h.visible?h.visible&&(E={field:h.fieldName,
alias:h.label,type:"sum",total:0}):E={field:h.name,alias:h.alias,type:"sum",total:0},E&&-1===A.indexOf(E.field)&&C.push(E),E=null)}}this.calcFields=x.clone(C);if(this.allFields)for(K=0;K<f.fields.length;K++){E=f.fields[K];D=!0;h=0;b:for(;h<C.length;h++)if(E.name===C[h].field){D=!1;break b}-1===A.indexOf(E.name)&&D&&C.push({field:E.name,alias:E.alias,type:E.type})}f=c.getSpecialFields(f);this.dateFields=f.dateFields;this.specialFields=f.specialFields;this.typeIdField=f.typeIdField;this.types=f.types;
return C}})})},"widgets/SituationAwareness/js/analysisUtils":function(){define("dojo/_base/array dojo/_base/lang dojo/dom-class dojo/dom-geometry dojo/dom-style esri/tasks/query esri/geometry/geometryEngine esri/geometry/Polyline ./CSVUtils jimu/utils".split(" "),function(Q,I,P,V,J,x,n,q,t,v){function H(d){return function(b,m){return b.attributes[d]<m.attributes[d]?-1:b.attributes[d]>m.attributes[d]?1:0}}return{getFields:function(d,b,m,k){var e=this.getSkipFields(d),c=[];if(!m&&b.advStat&&b.advStat.stats&&
b.advStat.stats.outFields&&0<b.advStat.stats.outFields.length)Q.forEach(b.advStat.stats.outFields,function(z){c.push(z.expression)});else{if(d.infoTemplate)b=d.infoTemplate.info.fieldInfos;else if(0<k.map.itemInfo.itemData.operationalLayers.length){k=k.map.itemInfo.itemData.operationalLayers;b=null;var f=0;a:for(;f<k.length;f++){var A=k[f];if("ArcGISMapServiceLayer"===A.layerType&&"undefined"!==typeof A.layers)for(var C=0;C<A.layers.length;C++){var F=A.layers[C];if(F.id===d.layerId&&F.popupInfo){b=
F.popupInfo.fieldInfos;break a}}}b||(b=d.fields)}else b=d.fields;if(b)for(k=0;k<b.length;k++)f=b[k],m||"undefined"===typeof f.visible?(f=f.name?f.name:f.fieldName,-1===e.indexOf(f)&&c.push(f)):f.visible&&-1===e.indexOf(f.fieldName)&&c.push(f.fieldName)}d=this.getSpecialFields(d);return{dateFields:d.dateFields,specialFields:d.specialFields,typeIdField:d.typeIdField,types:d.types,fields:3<c.length&&!m?c.slice(0,3):c,allFields:c}},getField:function(d,b){for(var m=0;m<d.length;m++){var k=d[m];if(k.name===
b||k.alias===b)return k}},getFieldValue:function(d,b,m,k,e,c,f,A,C,F){f=!1;var z=b;c="string"===typeof z?!0:!1;m[d]&&"esriFieldTypeDate"===m[d].type&&(f=!0,-1<Object.keys(k).indexOf(d)?(m=k[d],e="undefined"!==typeof m?{dateFormat:m}:{dateFormat:e}):e={dateFormat:e},z=v.fieldFormatter.getFormattedDate(new Date(b),e));!f&&A&&C&&(z=(d=v.getDisplayValueForCodedValueOrSubtype(A,d,C))&&d.hasOwnProperty("displayValue")&&d.isCodedValueOrSubtype?d.displayValue:c?d.displayValue:this.formatNumber(z,F).num);
return z},getSkipFields:function(d){var b=[];if(d.fields)for(var m=0;m<d.fields.length;m++){var k=d.fields[m];k&&k.type&&k.name&&"esriFieldTypeGeometry"===k.type&&b.push(k.name)}return b},getSpecialFields:function(d){var b={},m=[];d.fields&&Q.forEach(d.fields,I.hitch(this,function(k){if("esriFieldTypeDate"===k.type||k.domain||k.name===d.typeIdField){if("esriFieldTypeDate"===k.type&&d.infoTemplate)for(var e in d.infoTemplate._fieldsMap)"undefined"!==typeof d.infoTemplate._fieldsMap[e].fieldName&&d.infoTemplate._fieldsMap[e].fieldName===
k.name&&d.infoTemplate._fieldsMap[e].format&&"undefined"!==typeof d.infoTemplate._fieldsMap[e].format.dateFormat&&(m[k.name]=d.infoTemplate._fieldsMap[e].format.dateFormat);b[k.name]=k}}));return{specialFields:b,dateFields:m,typeIdField:d.typeIdField,types:d.types}},getSummaryFields:function(){},getPopupFields:function(d){var b=[];0<d.tabLayers.length&&Q.forEach(d.tabLayers,I.hitch(this,function(m){var k=this.getSkipFields(m);"undefined"!==typeof m.popupInfo?Q.forEach(m.popupInfo.fieldInfos,I.hitch(this,
function(e){if(e.visible&&-1===k.indexOf(e.fieldName)){var c={value:0};c.expression=e.fieldName;c.label=e.label;b.push(c)}})):m.infoTemplate&&Q.forEach(m.infoTemplate.info.fieldInfos,I.hitch(this,function(e){if(e.visible&&-1===k.indexOf(e.fieldName)){var c={value:0};c.expression=e.fieldName;c.label=e.label;b.push(c)}}))}));return b},getDisplayFields:function(d){if("undefined"!==typeof d.advStat&&"undefined"!==typeof d.advStat.stats&&"undefined"!==typeof d.advStat.stats.outFields)var b=d.advStat.stats.outFields;
else b=[],0<d.tabLayers.length&&Q.forEach(d.tabLayers,I.hitch(this,function(m){"undefined"!==typeof m.popupInfo?Q.forEach(m.popupInfo.fieldInfos,I.hitch(this,function(k){if(k.visible){var e={value:0};e.expression=k.fieldName;e.label=k.label;b.push(e)}})):m.infoTemplate?Q.forEach(m.infoTemplate.info.fieldInfos,I.hitch(this,function(k){if(k.visible){var e={value:0};e.expression=k.fieldName;e.label=k.label;b.push(e)}})):Q.forEach((m.layerObject?m.layerObject:m).fields,I.hitch(this,function(k){var e=
{value:0};e.expression=k.name;e.label=k.alias;b.push(e)}))}));return b},exportToCSV:function(d,b,m,k,e){if(0===d.length)return!1;var c=e.baseLabel,f=[],A=[];"proximity"===e.type&&d.sort(this.compareDistance);if("undefined"===typeof b.altKey)var C=b;else C=!1,m=e.csvAllFields;Q.forEach(d,I.hitch(this,function(G){"closest"===e.type&&delete G.attributes.DISTANCE;"proximity"===e.type&&(G.attributes.DISTANCE=this.getDistanceLabel(G.attributes.DISTANCE,e.unit,e.approximateLabel));f.push(G.attributes)}));
if("summary"===e.type||"grouped"===e.type)if(e.hasOwnProperty("csvAllFields")&&"allFields"===e.csvAllFields||e.hasOwnProperty("csvAllFields")&&(!0===e.csvAllFields||"true"===e.csvAllFields))for(var F in f[0])A.push(F);else if(e.hasOwnProperty("csvAllFields")&&"popUpFields"===e.csvAllFields)if(e.allFields)for(d=0;d<e.summaryFields.length;d++)A.push(e.summaryFields[d].field);else if(0===e.configuredPopUpFields.length)f=[],f.push({});else for(d=0;d<e.configuredPopUpFields.length;d++)A.push(e.configuredPopUpFields[d]);
else for(d=0;d<e.summaryFields.length;d++)A.push(e.summaryFields[d].field);else for(var z in f[0])A.push(z);d=e.layer;F=d.fields;if(d&&d.loaded&&F||C){z=b?[]:this.getSkipFields(d);var K={};if(e.opLayers&&e.opLayers._layerInfos){var D=e.opLayers.getLayerInfoById(d.id);D?K.popupInfo=D.getPopupInfo():"undefined"!==typeof d.popupInfo?K.popupInfo=d.popupInfo:d.infoTemplate&&(K.popupInfo=d.infoTemplate.info)}D=[];var h=0;for(;h<A.length;h++){var B=A[h];if(-1===z.indexOf(B)){var N=!1,E=0;b:for(;E<F.length;E++){var O=
F[E];if(O.name===B){N=!0;break b}}N?D.push(O):D.push({name:B,alias:B,show:!0,type:"esriFieldTypeString"})}}K.datas=f;K.fromClient=!1;K.withGeometry=!1;K.outFields=D;K.formatDate=!0;K.formatCodedValue=!0;K.formatNumber=!1;var R=[],a=[];if(!b&&m&&"undefined"!==typeof k)switch(e.type){case "proximity":R.push(e.nlsCount);a.push(k);break;case "closest":var u=0;Q.forEach(k,I.hitch(this,function(G){0===u&&(Q.forEach(G,function(g){R.push(g.label)}),u+=1);var l=[];Q.forEach(G,function(g){l.push(g.value)});
a.push(l)}));break;case "summary":Q.forEach(k,I.hitch(this,function(G){var l=G.info.replace("\x3cbr/\x3e",""),g=!1,w=0;a:for(;w<e.calcFields.length;w++)if(l===e.calcFields[w].alias){g=!0;break a}g&&(R.push(l),a.push(G.total))}));break;case "grouped":Q.forEach(k,function(G){R.push(G.info.replace("\x3cbr/\x3e",""));a.push(G.total)})}if(C)return{summaryLayer:d,details:D};t.exportCSVFromFeatureLayer(c,d,K);return{summaryLayer:d,details:{appendColumns:R,appendDatas:a,name:c,type:e.nlsValue}}}t.exportCSV(c,
f,A)},isURL:function(d){return/(https?:\/\/|ftp:)/g.test(d)},isEmail:function(d){return/\S+@\S+\.\S+/.test(d)},queryTabCount:function(){},performQuery:function(){},getFilter:function(d,b){var m="";b.traversal(function(k){if(d===k.id&&k.getFilter())return m=k.getFilter(),!0});return m},getGeoms:function(d){for(var b=[],m=[],k=0;k<d.length;k++){var e=d[k].geometry?d[k].geometry:d[k];if("polygon"===e.type&&-1===b.indexOf(k)){for(var c=0;c<d.length;c++)if(c!==k&&-1===b.indexOf(c)){var f=d[c].geometry?
d[c].geometry:d[c];"polygon"===f.type?n.intersects(e,f)&&(b.push(c),e=n.union(e,f)):b.push(c)}m.push(e)}}return m},createDefArray:function(d,b,m,k){for(var e=[],c=0;c<d.length;c++){var f=d[c];if(f){var A=new x;A.returnGeometry=!1;A.geometry=b;var C=-1===[null,void 0,""].indexOf(f.id)?f.id:k.layers;A.where=this.getFilter(C,m);"undefined"!==typeof f.queryCount?e.push(f.queryCount(A)):"undefined"!==typeof f.queryIds?e.push(f.queryIds(A)):"undefined"!==typeof f.queryFeatures&&e.push(f.queryFeatures(A))}}return e},
updateTabCount:function(d,b,m,k,e){var c="undefined"!==typeof e&&0<e?!0:!1;e=V.position(b).w;"undefined"!==typeof d&&0===d?(P.remove(b,"noFeatures"),P.remove(b,"noFeaturesActive"),P.add(b,c?"noFeaturesActive":"noFeatures")):(c&&P.contains(b,"noFeatures")&&P.remove(b,"noFeatures"),c&&P.contains(b,"noFeaturesActive")&&P.remove(b,"noFeaturesActive"));m&&(d="undefined"!==typeof d?k+" ("+v.localizeNumber(d).toString()+")":k,b.innerHTML=d);m=V.position(b).w;d=0;if(m>e){var f=!0;d=m-e}else e>m&&(f=!1,d=
e-m);e=V.position(b.parentNode).w;if(0<e){f=f?e+d:e-d;J.set(b.parentNode,"width",f+"px");b=b.parentNode.parentNode;e=b.parentNode;if(e&&e.children&&0<e.children.length)for(d=0;d<e.children.length;d++)if(m=e.children[d],window.isRTL){if(-1<m.className.indexOf("SA_panelLeft")&&m){var A=m;break}}else if(-1<m.className.indexOf("SA_panelRight")){var C=m;break}A&&b&&(f>V.position(e).w?(J.set(b,"left","58px"),J.set(A,"display","block")):(J.set(b,"left","24px"),J.set(A,"display","none")));C&&b&&(f>V.position(e).w?
(J.set(b,"right","58px"),J.set(C,"display","block")):(J.set(b,"right","24px"),J.set(C,"display","none")))}},getDistanceLabel:function(d,b,m){return Math.round(100*d)/100+" "+b+" ("+m+")"},getSum:function(d,b){var m=0;Q.forEach(d,function(k){m+=k.attributes[b]});return m},getMin:function(d,b){d.sort(H(b));return d[0].attributes[b]},getMax:function(d,b){d.sort(H(b));d.reverse();return d[0].attributes[b]},getArea:function(d,b,m,k,e){var c=0;m=I.clone(m);m.miles=109413;m.kilometers=109414;m.feet=109405;
m.meters=109404;m.yards=109442;m.nauticalMiles=109409;var f=m[k],A;e&&e.stats&&e.stats.area&&0<e.stats.area.length&&(A=e.stats.area[0]);Q.forEach(d,function(C){for(var F=0;F<b.length;F++){var z=n.intersect(C.geometry,b[F]);if(null!==z){var K=z.spatialReference;c=4326===K.wkid||K.isWebMercator()||K.isGeographic&&K.isGeographic()?c+n.geodesicArea(z,f):c+n.planarArea(z,f)}}});return this.formatNumber(c,A).total},getLength:function(d,b,m,k,e){var c=0,f=m[k],A;e&&e.stats&&e.stats.length&&0<e.stats.length.length&&
(A=e.stats.length[0]);Q.forEach(d,function(C){for(var F=0;F<b.length;F++){var z=n.intersect(C.geometry,b[F]);if(null!==z){var K=z.spatialReference;c=4326===K.wkid||K.isWebMercator()||K.isGeographic&&K.isGeographic()?c+n.geodesicLength(z,f):c+n.planarLength(z,f)}}});return this.formatNumber(c,A).total},getDistance:function(d,b,m){var k="point"!==d.type?d.getExtent().getCenter():d;b="point"!==b.type?b.getExtent().getCenter():b;k=new q([[k.x,k.y],[b.x,b.y]]);k.spatialReference=d.spatialReference;m="nauticalMiles"===
m?"nautical-miles":m;return 4326===d.spatialReference.wkid||d.spatialReference.isWebMercator()?n.geodesicLength(k,m):n.planarLength(k,m)},compareDistance:function(d,b){return d.attributes.DISTANCE<b.attributes.DISTANCE?-1:d.attributes.DISTANCE>b.attributes.DISTANCE?1:0},formatNumber:function(d,b){var m=d;if(!isNaN(d)&&null!==d&&""!==d){m=b&&b.modify&&!isNaN(d);var k;m&&"undefined"!==typeof b.truncatePlaces&&!isNaN(b.truncatePlaces)&&(k=new RegExp(0<b.truncatePlaces?"^\\d*[.]?\\d{0,"+b.truncatePlaces+
"}":"^\\d*"));m=m&&b.round?1*d.toFixed(b.roundPlaces):m&&b.truncate?1*k.exec(d)[0]:d;isNaN(m)&&(m=0)}d=m;isNaN(m)||null===m||""===m||!(b=b&&b.show1KSeparator)&&"undefined"!==typeof b||(d=v.localizeNumber(m));return{total:m,num:d}},getPopupConfiguredFields:function(d){var b=[];"undefined"!==typeof d.popupInfo?Q.forEach(d.popupInfo.fieldInfos,I.hitch(this,function(m){m.visible&&b.push(m.fieldName)})):d.infoTemplate&&Q.forEach(d.infoTemplate.info.fieldInfos,I.hitch(this,function(m){m.visible&&b.push(m.fieldName)}));
return b}}})},"widgets/SituationAwareness/js/CSVUtils":function(){define("exports dojo/_base/lang dojo/_base/array dojo/_base/html dojo/has dojo/Deferred jimu/utils esri/lang esri/tasks/QueryTask esri/tasks/query".split(" "),function(Q,I,P,V,J,x,n,q,t,v){function H(d){var b=I.clone(d.attributes);(d=d.geometry)&&"point"===d.type&&("x"in b?b._x=d.x:b.x=d.x,"y"in b?b._y=d.y:b.y=d.y);return b}Q.exportCSV=function(d,b,m,k,e){return Q._createCSVStr(b,m,k,e).then(function(c){return Q._download(d+".csv",
c)})};Q.exportCalculatedResultsCSV=function(d,b){var m="",k=0;P.forEach(b,function(e){m+=e.name+" ("+e.type+")\r\n";Q._createCSVStr([],[],e.appendColumns,e.appendDatas).then(function(c){m+=c;k++;if(k===b.length)return Q._download(d+".csv",m);m+="\r\n\r\n"})})};Q.exportCSVFromFeatureLayer=function(d,b,m){m=m||{};return Q._getExportData(b,{datas:m.datas,fromClient:m.fromClient,withGeometry:m.withGeometry,outFields:m.outFields,filterExpression:m.filterExpression}).then(function(k){return Q._formattedData(b,
k,{formatNumber:m.formatNumber,formatDate:m.formatDate,formatCodedValue:m.formatCodedValue,popupInfo:m.popupInfo,appendColumns:m.appendColumns,appendDatas:m.appendDatas}).then(function(e){return Q.exportCSV(d,e.datas,e.columns,e.appendColumns,e.appendDatas)})})};Q.exportCSVByAttributes=function(d,b,m,k){k=I.mixin({},k);k.datas=m;return Q.exportCSVFromFeatureLayer(d,b,k)};Q.exportCSVByGraphics=function(d,b,m,k){m=P.map(m,function(e){return e.attributes});return Q.exportCSVByAttributes(d,b,m,k)};Q._createCSVStr=
function(d,b,m,k){var e=new x,c="",f=0,A=0,C="",F="";try{if(b&&0<b.length){P.forEach(b,function(D){c=c+C+D;C=","});c+="\r\n";f=d.length;A=b.length;for(var z=0;z<f;z++){C="";for(var K=0;K<A;K++)(F=d[z][b[K]])||"number"===typeof F||(F=""),F&&/[",\r\n]/g.test(F)&&(F='"'+F.replace(/(")/g,'""')+'"'),c=c+C+F,C=",";c+="\r\n"}}"undefined"!==typeof m&&"undefined"!==typeof k&&0<m.length&&0<k.length&&(C="",P.forEach(m,function(D){c=c+C+D;C=","}),C="",c+="\r\n",P.forEach(k,function(D){Array.isArray(D)?(P.forEach(D,
function(h){c=c+C+h;C=","}),C="",c+="\r\n"):(c=c+C+D,C=",")}));e.resolve(c)}catch(D){console.error(D),e.resolve("")}return e};Q._isIE11=function(){return 11===n.has("ie")};Q._isEdge=function(){return n.has("edge")};Q._getDownloadUrl=function(d){return window.Blob&&window.URL&&window.URL.createObjectURL?(d=new Blob(["\ufeff"+d],{type:"text/csv"}),URL.createObjectURL(d)):"data:attachment/csv;charset\x3dutf-8,\ufeff"+encodeURIComponent(d)};Q._download=function(d,b){var m=new x;try{if(J("ie")&&10>J("ie")){var k=
window.top.open("about:blank","_blank");k.document.write("sep\x3d,\r\n"+b);k.document.close();k.document.execCommand("SaveAs",!0,d);k.close()}else if(10===J("ie")||Q._isIE11()||Q._isEdge()){var e=new Blob(["\ufeff"+b],{type:"text/csv"});navigator.msSaveBlob(e,d)}else{var c=V.create("a",{href:Q._getDownloadUrl(b),target:"_blank",download:d},document.body);if(J("safari")){var f=document.createEvent("MouseEvents");f.initEvent("click",!0,!0);c.dispatchEvent(f)}else c.click();V.destroy(c)}m.resolve()}catch(A){m.reject(A)}return m};
Q._getExportData=function(d,b){var m=new x,k=null,e=b.datas,c=b.withGeometry;k=b.outFields;k&&k.length||(k=d.fields);k=I.clone(k);if(c&&!(e&&0<e.length)){var f="";f=-1!==k.indexOf("x")?"_x":"x";k.push({name:f,alias:f,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"});f=-1!==k.indexOf("y")?"_y":"y";k.push({name:f,alias:f,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"})}e&&0<e.length?m.resolve({data:e||[],outFields:k}):b.fromClient?(e=P.map(d.graphics,function(A){return c?
H(A):I.clone(A)}),m.resolve({data:e||[],outFields:k})):Q._getExportDataFromServer(d,k,b).then(function(A){m.resolve({data:A||[],outFields:k})});return m};Q._getExportDataFromServer=function(d,b,m){var k=new x;if("esri.layers.FeatureLayer"!==d.declaredClass)return k.resolve([]),k;var e=new t(d.url),c=new v;c.where=m.filterExpression||d.getDefinitionExpression&&d.getDefinitionExpression()||"1\x3d1";0<b.length?(d=P.map(b,function(f){return f.name}),c.outFields=d):c.outFields=["*"];c.returnGeometry=m.withGeometry;
e.execute(c,function(f){f=P.map(f.features,function(A){return H(A)});k.resolve(f)},function(f){console.error(f);k.resolve([])});return k};Q._formattedData=function(d,b,m){var k=new x,e=[],c=b.data;b=b.outFields;for(var f=n.getFeatureLayerDefinition(d),A=0,C=c.length;A<C;A++){for(var F={},z=0;z<b.length;z++){var K=b[z];F[K.alias||K.name]=Q._getExportValue(c[A][K.name],K,d.objectIdField,d.typeIdField,c[A][d.typeIdField],d.types,m,f,c[A],d)}e.push(F)}d=P.map(b,function(D){return D.alias||D.name});k.resolve({datas:e,
columns:d,appendColumns:m.appendColumns,appendDatas:m.appendDatas});return k};Q._getExportValue=function(d,b,m,k,e,c,f,A,C,F){function z(B){if(K&&q.isDefined(K.fieldInfos))for(var N=0,E=K.fieldInfos.length;N<E;N++){var O=K.fieldInfos[N];if(O.fieldName===B)return O.format}return null}var K=f.popupInfo,D=!!b.domain&&f.formatCodedValue;f="esriFieldTypeDate"===b.type&&f.formatDate;var h=m&&b.name===m;k=k&&b.name===k;F=F&&F.renderer?F:A;return f?(d=n.fieldFormatter.getFormattedDate(d,z(b.name)),-1<d.indexOf(",")?
d.replace(",",""):d):(k||D)&&A&&C&&(A=n.getDisplayValueForCodedValueOrSubtype(F,b.name,C))&&A.hasOwnProperty("displayValue")?A.displayValue:D||f||h||k?d:(D=null,m&&c&&0<c.length&&(m=(m=P.filter(c,function(B){return B.id===e}))&&m[0])&&m.domains&&m.domains[b.name]&&m.domains[b.name].codedValues&&(b=n.getDisplayValueForCodedValueOrSubtype(F,b.name,C))&&b.hasOwnProperty("displayValue")&&(D=b.displayValue),null!==D?D:d)}})},"widgets/SituationAwareness/js/GroupedCountInfo":function(){define("dojo/_base/declare dojo/Evented dojo/_base/array dojo/DeferredList dojo/Deferred dojo/_base/lang dojo/dom-class dojo/dom-construct dojo/on dojo/keys jimu/utils jimu/dijit/Message esri/graphic esri/layers/FeatureLayer esri/tasks/query ./analysisUtils".split(" "),
function(Q,I,P,V,J,x,n,q,t,v,H,d,b,m,k,e){return Q("GroupedCountInfo",[I],{summaryLayer:null,summaryFields:[],summaryIds:[],summaryFeatures:[],tabNum:null,popupFields:[],groupedResults:{},specialFields:null,dateFields:{},symbolField:null,graphicsLayer:null,lyrRenderer:null,lyrSymbol:null,featureCount:0,incidentCount:0,displayCount:!1,allFields:!1,configuredPopUpFields:[],constructor:function(c,f,A){this.tab=c;this.container=f;this.parent=A;this.config=A.config;this.graphicsLayer=null;this.specialFields=
{};this.typeIdField="";this.types=[];this.dateFields={};this.baseLabel=""!==c.label?c.label:c.layerTitle?c.layerTitle:c.layers;this.parentNode=A.domNode},queryTabCount:function(c,f,A,C){var F=new J;this.displayCount=C;this.incidentCount=c.length;var z=[this.tab.tabLayers[0]];this.mapServiceLayer&&1<this.tab.tabLayers.length&&(z=[this.tab.tabLayers[1]]);if(0<this.tab.tabLayers.length&&this.tab.tabLayers[0].url&&-1<this.tab.tabLayers[0].url.indexOf("MapServer"))if(this.mapServiceLayer=!0,"undefined"!==
typeof this.tab.tabLayers[0].infoTemplate)if(this.summaryLayer=this.tab.tabLayers[0],this.summaryLayer.hasOwnProperty("loaded")&&this.summaryLayer.loaded)this.summaryFields=this._getFields(this.summaryLayer),this._performQuery(c,f,A,C,z).then(function(D){F.resolve(D)});else{var K=new m(this.summaryLayer.url);K.infoTemplate=this.tab.tabLayers[0].infoTemplate;z=[K];this.tab.tabLayers=z;t(K,"load",x.hitch(this,function(){this.summaryLayer=K;this.summaryFields=this._getFields(this.summaryLayer);this._performQuery(c,
f,A,C,z).then(function(D){F.resolve(D)})}))}else this.loading||(K=new m(this.tab.tabLayers[0].url),this.loading=!0,t(K,"load",x.hitch(this,function(){this.summaryLayer=K;this.summaryFields=this._getFields(this.summaryLayer);for(var D=this.tab.tabLayers[0].url.split("MapServer/")[1],h=this.parent.map.itemInfo.itemData.operationalLayers,B=0;B<h.length;B++){var N=h[B];if(-1<this.tab.tabLayers[0].url.indexOf(N.url)&&"undefined"!==typeof N.layerObject)if(N.layerObject.infoTemplates){if(N=N.layerObject.infoTemplates[D]){K.infoTemplate=
N.infoTemplate;break}}else if(N.layerObject.infoTemplate){K.infoTemplate=N.layerObject.infoTemplate;break}}z=[K];this.tab.tabLayers=z;this.loading=!1;this._performQuery(c,f,A,C,z).then(function(E){F.resolve(E)})})));this.mapServiceLayer||this._performQuery(c,f,A,C,z).then(function(D){F.resolve(D)});return F},_performQuery:function(c,f,A,C,F){var z=new J,K=[],D;0<f.length?D=e.getGeoms(f):0<c.length&&(D=e.getGeoms(c));this.summaryGeoms=D;if(0<D.length)for(c=0;c<D.length;c++){K=D[c];f=e.createDefArray(F,
K,this.parent.opLayers,this.tab);var h=0===c?K=f:K=h.concat(f)}(new V(K)).then(x.hitch(this,function(B){for(var N=0,E=0;E<B.length;E++){var O=B[E][1];isNaN(O)?O&&O.features?N+=O.features.length:O&&"undefined"!==typeof O.length&&(N+=O.length):N+=O}this.updateTabCount(N,A,C);this.queryOnLoad&&x.hitch(this,this._queryFeatures(this.summaryGeoms));z.resolve(N)}));return z},updateTabCount:function(c,f,A){this.displayCount=A;this.featureCount=c;e.updateTabCount(this.featureCount,f,A,this.baseLabel,this.incidentCount)},
updateForIncident:function(c,f,A,C,F,z,K){this.incidentCount=c.length;this.allFields="undefined"!==typeof z&&"undefined"!==typeof K?z?!0:K:!1;var D="undefined"!==typeof F;this.tabNum=C;if(D)var h=new J;else this.container.innerHTML="",n.add(this.container,"loading");this.summaryIds=[];this.summaryFeatures=[];this.groupedResults={};if(0<this.tab.tabLayers.length){var B=[];if(0<f.length)B=f;else for(f=0;f<c.length;f++)C=c[f].geometry?c[f].geometry:c[f],"polygon"===C.type&&B.push(C);if("undefined"!==
typeof this.tab.tabLayers[0].infoTemplate){this.summaryLayer=this.tab.tabLayers[0];var N=new m(this.summaryLayer.url);N.infoTemplate=this.tab.tabLayers[0].infoTemplate;this.tab.tabLayers[1]=N;this.summaryFields=this._getFields(this.tab.tabLayers[0]);this.configuredPopUpFields=e.getPopupConfiguredFields(this.tab.tabLayers[0]);D?this._queryFeatures(B,D).then(function(E){h.resolve(E)}):(this._initGraphicsLayer(A),x.hitch(this,this._queryFeatures(B)))}else N=new m(this.tab.tabLayers[0].url),t(N,"load",
x.hitch(this,function(){this.summaryLayer=N;if(-1<this.tab.tabLayers[0].url.indexOf("MapServer"))for(var E=this.tab.tabLayers[0].url.split("MapServer/")[1],O=this.parent.map.itemInfo.itemData.operationalLayers,R=0;R<O.length;R++){var a=O[R];if(-1<this.tab.tabLayers[0].url.indexOf(a.url)&&"undefined"!==typeof a.layerObject&&a.layerObject.infoTemplates&&(a=a.layerObject.infoTemplates[E])){N.infoTemplate=a.infoTemplate;break}}this.tab.tabLayers[1]=N;this.summaryLayer=this.tab.tabLayers[1];this.summaryFields=
this._getFields(this.tab.tabLayers[1]);this.configuredPopUpFields=e.getPopupConfiguredFields(this.tab.tabLayers[1]);D?this._queryFeatures(B,D).then(function(u){h.resolve(u)}):(this._initGraphicsLayer(A),x.hitch(this,this._queryFeatures(B)))}));if(D)return h}},_initGraphicsLayer:function(c){null!==c&&(this.graphicsLayer=c,this.graphicsLayer.clear(),this.summaryLayer&&this.summaryLayer.renderer&&(this.lyrRenderer=this.summaryLayer.renderer,this.graphicsLayer.renderer=this.lyrRenderer,"undefined"!==
typeof this.summaryLayer.renderer.attributeField?this.symbolField=this.summaryLayer.renderer.attributeField:this.lyrSymbol=this.lyrRenderer.symbol))},_queryFeatures:function(c,f){var A;f&&(A=new J);var C=[],F=-1===[null,void 0,""].indexOf(this.tab.tabLayers[0].id)?this.tab.tabLayers[0].id:this.tab.layers;F=e.getFilter(F,this.parent.opLayers);for(var z=new k,K=0;K<c.length;K++)z.geometry=c[K],z.where=F,C.push(this.summaryLayer.queryIds(z));(new V(C)).then(x.hitch(this,function(D){for(var h,B,N=0;N<
D.length;N++)D[N][0]&&(h=D[N][1],B=h=0===N?h:B.concat(h));h?(this.summaryIds=h,0<this.summaryIds.length?f?this._queryFeaturesByIds(f).then(function(E){A.resolve(E)}):this._queryFeaturesByIds():f||this._processResults()):f||this._processResults()}),x.hitch(this,function(D){console.error(D);new d({message:D})}));if(f)return A},_queryFeaturesByIds:function(c){var f,A=[];c&&(f=new J);var C=this.summaryLayer.maxRecordCount||1E3,F=this.summaryIds.slice(0,C);this.summaryIds.splice(0,C);var z=new k,K=-1===
[null,void 0,""].indexOf(this.summaryLayer.id)?this.summaryLayer.id:this.tab.layers;z.where=e.getFilter(K,this.parent.opLayers);var D=!1;P.some(this.summaryFields,x.hitch(this,function(h){if("area"===h.type||"length"===h.type||this.graphicsLayer)return D=!0}));c&&(D=!0);this.summaryLayer.supportsAdvancedQueries&&(z.orderByFields=[this.summaryFields[0].field]);z.returnGeometry=D;z.outSpatialReference=this.parent.map.spatialReference;z.outFields=["*"];z.objectIds=F;for(A.push(this.summaryLayer.queryFeatures(z));0<
this.summaryIds.length;)F=this.summaryIds.slice(0,C),this.summaryIds.splice(0,C),z.objectIds=F,A.push(this.summaryLayer.queryFeatures(z));(new V(A)).then(x.hitch(this,function(h){this.summaryFeatures=[];for(var B=0;B<h.length;B++)if(h[B][0]){var N=h[B][1];N.features&&(this.summaryFeatures=this.summaryFeatures.concat(N.features))}c?this._processResults(c).then(x.hitch(this,function(E){this.SA_SAT_download&&n.replace(this.SA_SAT_download,"download","processing");f.resolve(E)})):(this._processResults(),
this.SA_SAT_download&&n.replace(this.SA_SAT_download,"download","processing"));this.SA_SAT_download&&n.replace(this.SA_SAT_download,"download","processing")}),x.hitch(this,function(h){console.error(h);new d({message:h})}));if(c)return f},_prepGroupedResults:function(){for(var c=0;c<this.summaryFeatures.length;c++){var f=this.summaryFeatures[c];if("undefined"!==typeof this.summaryFields&&0<this.summaryFields.length){var A=e.getFieldValue(this.summaryFields[0].field,f.attributes[this.summaryFields[0].field],
this.specialFields,this.dateFields,"longMonthDayYear",this.typeIdField,this.types,this.layerObject&&this.layerObject.renderer?this.layerObject:this.layerDefinition,f.attributes);A="undefined"!==typeof A&&null!==A?H.stripHTML(A.toString()):"";A in this.groupedResults?this.groupedResults[A].features.push(f):this.groupedResults[A]={features:[f]}}}},_prepResults:function(){for(var c in this.groupedResults){var f=this.summaryFields[0];f.total=this.groupedResults[c].features.length;this.groupedResults[c].total=
f.total;this.groupedResults[c].type=f.type;this.groupedResults[c].label=f.alias}},_processResults:function(c){this._prepGroupedResults();this._prepResults();var f=this.groupedResults,A=0;if(c)var C=new J;else{this.container.innerHTML="";n.remove(this.container,"loading");if(0===Object.keys(this.groupedResults).length){this.container.innerHTML=this.parent.nls.noFeaturesFound;return}var F=Object.keys(this.groupedResults).length+1;var z=q.create("div",{style:"width:"+220*F+"px;"},this.container);n.add(z,
"SAT_tabPanelContent");F=q.create("div",{},z);n.add(F,"SATcolExport");n.add(F,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");var K=q.create("div",{"data-dojo-attach-point":"SA_SAT_download",title:this.parent.nls.downloadCSV,tabindex:"0",role:"button","aria-label":this.parent.nls.downloadCSVdownloadCSV,"class":"grpSummaryDownLoadCSVButton"},F);n.add(K,[this.parent.isBlackTheme?"btnExportBlack":"btnExport","download"]);n.add(K,this.parent.lightTheme?"lightThemeBackground":"darkThemeBackground");
K.focus();H.initFirstFocusNode(this.parentNode,K);H.initLastFocusNode(this.parentNode,K);t(K,"click",x.hitch(this,this._exportToCSV,f));t(K,"keydown",x.hitch(this,function(a){if(!a.shiftKey||a.keyCode!==v.TAB)if(a.keyCode===v.ENTER||a.keyCode===v.SPACE)this._exportToCSV(f,a),setTimeout(function(){K.focus()},500)}))}var D=Object.keys(f).sort();F=[];this.displayCount&&F.push({total:this.featureCount,a:void 0,info:this.parent.nls.count,c:void 0});for(var h in D){A=D[h];var B=f[A],N=H.stripHTML(A.toString());
A=B.total;isNaN(A)&&(A=0);A=H.localizeNumber(A);var E="pre"===B.type?B.label.trim():N;N="pre"===B.type?N:B.label.trim();B=""!==B.label?"colGroupedSummary":"colSummary";if(c)F.push({total:A,a:E,info:""===N?E:N,c:B});else{var O=q.create("div",{"class":"SATcol"},z);n.add(O,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");var R=q.create("div",{style:"max-height: 45px;"},O);q.create("div",{"class":"SATcolWrap",style:"max-height: 30px; overflow: hidden;",innerHTML:E},R);q.create("div",{"class":"SATcolWrap",
style:"max-height: 30px; overflow: hidden;",innerHTML:N},R);q.create("div",{"class":B,innerHTML:A},O)}}h=[];z=null!==this.graphicsLayer;!c&&z&&(this.graphicsLayer.clear(),this.tab.tabLayers[1]&&this.tab.tabLayers[1].clear());if(this.summaryFeatures)for(D=0;D<this.summaryFeatures.length;D++)A=this.summaryFeatures[D],this.lyrSymbol?A.symbol=this.lyrSymbol:this.graphicsLayer?this.graphicsLayer.renderer&&(E=this.graphicsLayer.renderer.getSymbol(A),A.symbol=E):this.summaryLayer.renderer&&this.summaryLayer.renderer.getSymbol&&
(A.symbol=this.summaryLayer.renderer.getSymbol(A)),A=A.toJson?new b(A.toJson()):A,!c&&z?(this.graphicsLayer.add(A),this.tab.tabLayers[1].add(A)):h.push(A);!c&&z&&(this.graphicsLayer.setVisibility(!0),this.parent._toggleTabLayersNew(this.tabNum),this.tab.retsore&&this.emit("summary-complete",{bubbles:!0,cancelable:!0,tab:this.tabNum}));if(c)return C.resolve({graphics:h,analysisResults:F,context:this}),C},_exportToCSV:function(c,f,A,C){if(this.parent.config.hasOwnProperty("exportFieldsOptionForCSV"))var F=
this.parent.config.exportFieldsOptionForCSV;else this.parent.config.hasOwnProperty("csvAllFields")&&(F=this.parent.config.csvAllFields);c=e.exportToCSV(this.summaryFeatures,f,A,C,{type:"grouped",baseLabel:this.baseLabel,csvAllFields:F,layer:this.summaryLayer,opLayers:this.parent.opLayers,nlsValue:this.parent.nls.groupedSummary,nlsCount:this.parent.nls.count,summaryFields:this.summaryFields,allFields:this.allFields,configuredPopUpFields:this.configuredPopUpFields});this.summaryLayer=c.summaryLayer;
return c.details},_getFields:function(c){this.layerDefinition=H.getFeatureLayerDefinition(c);this.layerObject=c;var f=e.getSkipFields(c),A,C=[];if("undefined"!==typeof this.tab.advStat){var F=this.tab.advStat.stats,z;for(z in F)0<F[z].length&&P.forEach(F[z],function(D){var h={field:D.expression,alias:D.label+"",type:z,total:0};A=D.expression;C.push(h)})}F=e.getSpecialFields(c);this.dateFields=F.dateFields;this.specialFields=F.specialFields;this.typeIdField=F.typeIdField;this.types=F.types;if(this.allFields)for(F=
0;F<c.fields.length;F++){var K=c.fields[F];-1===f.indexOf(K.name)&&A!==K.name&&C.push({field:K.name,alias:K.alias,type:K.type})}return C}})})},"widgets/SituationAwareness/js/ClosestInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Color dojo/_base/array dojo/DeferredList dojo/Deferred dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/on dojo/keys jimu/utils esri/geometry/geometryEngine esri/graphic esri/Color esri/layers/FeatureLayer esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/Font esri/symbols/TextSymbol esri/tasks/query ./analysisUtils".split(" "),
function(Q,I,P,V,J,x,n,q,t,v,H,d,b,m,k,e,c,f,A,C,F,z,K){return Q("ClosestInfo",null,{featureCount:0,mapServiceLayer:!1,loading:!1,queryOnLoad:!1,incidentCount:0,constructor:function(D,h,B){this.tab=D;this.container=h;this.parent=B;this.graphicsLayer=this.incident=null;this.map=B.map;this.specialFields={};this.typeIdField="";this.types=[];this.dateFields={};this.config=B.config;this.parentNode=B.domNode;this.baseLabel=""!==D.label?D.label:D.layerTitle?D.layerTitle:D.layers},queryTabCount:function(D,
h,B,N){var E=new x;this.incidentCount=D.length;var O=this.parent.config.distanceSettings[this.parent.config.distanceUnits],R=this.parent.config.maxDistance;h=[];for(var a=0;a<D.length;a++){var u=D[a].geometry;"4326"===u.spatialReference.wkid||u.spatialReference.isWebMercator()?h.push(m.geodesicBuffer(u,R,O)):h.push(m.buffer(u,R,O))}var G=[this.tab.tabLayers[0]];this.mapServiceLayer&&1<this.tab.tabLayers.length&&(G=[this.tab.tabLayers[1]]);if(0<this.tab.tabLayers.length&&this.tab.tabLayers[0].url&&
-1<this.tab.tabLayers[0].url.indexOf("MapServer"))if(this.mapServiceLayer=!0,"undefined"!==typeof this.tab.tabLayers[0].infoTemplate)if(this.summaryLayer=this.tab.tabLayers[0],this.summaryLayer.hasOwnProperty("loaded")&&this.summaryLayer.loaded)this.summaryFields=this._getFields(this.summaryLayer),this._performQuery(D,h,B,N,G).then(function(g){E.resolve(g)});else{var l=new c(this.summaryLayer.url);l.infoTemplate=this.tab.tabLayers[0].infoTemplate;G=[l];this.tab.tabLayers=G;H(l,"load",I.hitch(this,
function(){this.summaryLayer=l;this.summaryFields=this._getFields(this.summaryLayer);this._performQuery(D,h,B,N,G).then(function(g){E.resolve(g)})}))}else this.loading||(l=new c(this.tab.tabLayers[0].url),this.loading=!0,H(l,"load",I.hitch(this,function(){this.summaryLayer=l;this.summaryFields=this._getFields(this.summaryLayer);for(var g=this.tab.tabLayers[0].url.split("MapServer/")[1],w=this.parent.map.itemInfo.itemData.operationalLayers,M=0;M<w.length;M++){var Y=w[M];if(-1<this.tab.tabLayers[0].url.indexOf(Y.url)&&
"undefined"!==typeof Y.layerObject&&Y.layerObject.infoTemplates&&(Y=Y.layerObject.infoTemplates[g])){l.infoTemplate=Y.infoTemplate;break}}G=[l];this.tab.tabLayers=G;this.loading=!1;this._performQuery(D,h,B,N,G).then(function(W){E.resolve(W)})})));this.mapServiceLayer||this._performQuery(D,h,B,N,G).then(function(g){E.resolve(g)});return E},_performQuery:function(D,h,B,N,E){var O=new x,R=[];this.summaryGeoms=h;if(0<h.length)for(D=0;D<h.length;D++){R=h[D];var a=K.createDefArray(E,R,this.parent.opLayers,
this.tab);var u=0===D?R=a:R=u.concat(a)}(new J(R)).then(I.hitch(this,function(G){for(var l=0,g=0;g<G.length;g++){var w=G[g][1];isNaN(w)?w&&w.features?0<w.features.length&&(l+=1):w&&"undefined"!==typeof w.length&&0<w.length&&(l+=1):0<w&&(l+=1)}this.updateTabCount(l,B,N);O.resolve(l)}));return O},updateTabCount:function(D,h,B){this.featureCount=0===parseInt(D,10)?0:D;K.updateTabCount(this.featureCount,h,B,this.baseLabel,this.incidentCount)},updateForIncident:function(D,h,B,N,E,O){this.incidentCount=
D.length;this.allFields="undefined"!==typeof E&&"undefined"!==typeof O?E?!0:O:!1;var R="undefined"!==typeof N,a;V.forEach(this.tab.tabLayers,I.hitch(this,function(u){R&&(a=new x);if(u.url){var G=new c(u.url,{mode:c.MODE_ONDEMAND,infoTemplate:u.infoTemplate});H(G,"load",I.hitch(this,function(){this.tab.tabLayers=[G];R?this.processIncident(D,h,B,N).then(I.hitch(this,function(l){a.resolve(l)}),I.hitch(this,function(l){console.error(l);a.reject(l)})):this.processIncident(D,h,B,N)}))}else R?this.processIncident(D,
h,B,N).then(I.hitch(this,function(l){a.resolve(l)}),I.hitch(this,function(l){console.error(l);a.reject(l)})):this.processIncident(D,h,B,N)}));if(R)return a},processIncident:function(D,h,B,N){this.incidents=D;var E="undefined"!==typeof N;if(E)var O=new x;else this.container.innerHTML="",n.add(this.container,"loading");var R=[];N=this.parent.config.distanceSettings[this.parent.config.distanceUnits];for(var a=[],u=0;u<D.length;u++){var G=D[u].geometry;var l="4326"===G.spatialReference.wkid||G.spatialReference.isWebMercator()?
m.geodesicBuffer(G,h,N):m.buffer(G,h,N);a.push({geometry:G,buffer:l})}(this.graphicsLayer=B)&&this.graphicsLayer.clear();D=[];h=this.tab.tabLayers[0];B=-1===[null,void 0,""].indexOf(h.id)?h.id:this.tab.layers;B=K.getFilter(B,this.parent.opLayers);var g=this._getFields(h),w=K.getPopupConfiguredFields(h);for(N=0;N<a.length;N++)u=new z,u.returnGeometry=!0,u.outSpatialReference=this.parent.map.spatialReference,u.geometry=a[N].buffer,u.where=B,u.outFields=["*"],"undefined"!==typeof h.queryFeatures&&D.push(h.queryFeatures(u));
(new J(D)).then(I.hitch(this,function(M){for(var Y=0;Y<M.length;Y++)if(M[Y][0]){var W=M[Y][1].features,aa=[],ea=a[Y].geometry;if(W&&0<W.length){for(var fa=0;fa<W.length;fa++){var S=new k(W[fa].toJson()),T=K.getDistance(ea,S.geometry,this.parent.config.distanceUnits),X={DISTANCE:T};V.forEach(g,I.hitch(this,function(Z){X[Z]=S.attributes[Z]}));this.config.hasOwnProperty("exportFieldsOptionForCSV")&&"allFields"===this.config.exportFieldsOptionForCSV||this.config.hasOwnProperty("csvAllFields")&&(!0===
this.config.csvAllFields||"true"===this.config.csvAllFields)?S.attributes.DISTANCE=T:(this.config.hasOwnProperty("exportFieldsOptionForCSV")&&"popUpFields"===this.config.exportFieldsOptionForCSV&&!this.allFields&&(X={DISTANCE:T},V.forEach(w,I.hitch(this,function(Z){X[Z]=S.attributes[Z]}))),S.attributes=X);aa.push(S)}aa.sort(K.compareDistance);R.push(aa[0])}}else M[Y][1]&&M[Y][1].message&&console.log(M[Y][1].message);R.sort(K.compareDistance);E?this._processResults(R,!0).then(I.hitch(this,function(Z){O.resolve(Z)})):
this._processResults(R)}),I.hitch(this,function(M){console.error(M);O.reject(M)}));if(E)return O},_processResults:function(D,h){var B=D&&0<D.length;if(B&&"point"!==D[0].geometry.type)for(var N=D.length-1;0<=N;N--)"undefined"===typeof D[N].geometry.getExtent()&&D.splice(N,1);if(h)var E=new x;else if(this.container.innerHTML="",n.remove(this.container,"loading"),B){var O=q.create("div",{"class":"SAT_tabPanelContent"},this.container);N=q.create("div",{},O);n.add(N,"SATcolExport");n.add(N,this.parent.lightTheme?
"lightThemeBorder":"darkThemeBorder");var R=q.create("div",{title:this.parent.nls.downloadCSV,tabindex:"0",role:"button","aria-label":this.parent.nls.downloadCSV,"class":"closestDownLoadCSVButton"},N);b.initFirstFocusNode(this.parentNode,R);n.add(R,"btnExport");n.add(R,this.parent.lightTheme?"lightThemeBackground":"darkThemeBackground");H(R,"click",I.hitch(this,this._exportToCSV,D));H(R,"keydown",I.hitch(this,function(na){if(!na.shiftKey||na.keyCode!==d.TAB)if(na.keyCode===d.ENTER||na.keyCode===d.SPACE)this._exportToCSV(D,
na),setTimeout(function(){R.focus()},500)}));R.focus()}N=this.parent.nls[this.parent.config.distanceUnits];var a=[],u=220;if(B)for(var G=0;G<D.length;G++){var l=G+1,g=D[G],w=g.geometry,M=w;"point"!==w.type&&(M=w.getExtent().getCenter());w=g.attributes;var Y;"point"===this.incidents[0].geometry.type&&(Y=Math.round(100*w.DISTANCE)/100+" "+N+" ("+this.parent.nls.approximate+")");var W="",aa=0,ea=[];if("undefined"!==typeof this.displayFields)for(var fa=0;fa<this.displayFields.length;fa++){var S=this.displayFields[fa],
T;a:for(T in w)if("DISTANCE"!==T&&3>aa&&S.expression===T){var X=K.getFieldValue(T,w[T],this.specialFields,this.dateFields,"longMonthDayYear",this.typeIdField,this.types,this.layerObject&&this.layerObject.renderer?this.layerObject:this.layerDefinition,w,S);X="undefined"!==typeof X&&null!==X?b.stripHTML(X.toString()):"";var Z="undefined"!==typeof S.label&&""!==S.label?S.label:void 0,ha=g._layer&&g._layer.fields?g._layer.fields:this.tab.tabLayers&&this.tab.tabLayers[0]?this.tab.tabLayers[0].fields:void 0;
ha&&"undefined"===typeof Z&&(ha=K.getField(ha,T))&&(Z=ha.alias);if("undefined"===typeof Z||Z in[""," ",null,void 0])Z=T;K.isURL(X)?X='\x3ca href\x3d"'+X+'" target\x3d"_blank" style\x3d"color: inherit;"\x3e'+Z+"\x3c/a\x3e":K.isEmail(X)&&(X='\x3ca href\x3d"mailto:'+X+'" style\x3d"color: inherit;"\x3e'+Z+"\x3c/a\x3e");W+=S.validLabel?("undefined"!==typeof S.label&&""!==S.label?Z+" ":"")+X+"\x3cbr/\x3e":X+"\x3cbr/\x3e";aa+=1;ea.push({value:X,label:Z});break a}}a.push(ea);h||(g=q.create("div",{},O),n.add(g,
"SATcolRec"),n.add(g,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder"),aa=q.create("div",{},g),n.add(aa,"SATcolRecBar"),ea=q.create("div",{innerHTML:l,tabindex:"0",role:"button","aria-label":this.parent.nls.zoomToFeature+" "+l},aa),n.add(ea,"SATcolRecNum"),v.set(ea,"backgroundColor",this.parent.config.activeColor),H(ea,"click",I.hitch(this,this._zoomToLocation,M,null)),H(ea,"keydown",I.hitch(this,this._zoomToLocation,M,!0)),b.initLastFocusNode(this.parentNode,ea),Y&&(ea=q.create("div",
{innerHTML:Y},aa),n.add(ea,"SATcolDistance")),this.parent.config.enableRouting&&(aa=q.create("div",{"class":"directionsButton",title:this.parent.nls.get_directions,tabindex:"0","aria-label":this.parent.nls.get_directions,role:"button"},aa),n.add(aa,"SATcolDir"),H(aa,"click",I.hitch(this,this._routeToIncident,M,null)),H(aa,"keydown",I.hitch(this,this._routeToIncident,M,!0)),b.initLastFocusNode(this.parentNode,aa)),W=q.create("div",{"class":"SATcolWrap",innerHTML:W},g),n.add(W,"SATcolInfo"),u+=t.position(g).w,
W=new A(A.STYLE_SOLID,new P.fromRgb(this.parent.config.activeMapGraphicColor),1),W=new f(f.STYLE_CIRCLE,24,W,new P.fromRgb(this.parent.config.activeMapGraphicColor)),g=new C,g.family="Arial",g.size="12px",l=new F(l,g,new e(this.parent.config.fontColor)),l.setOffset(0,-4),this.graphicsLayer.add(new k(M,W,w)),this.graphicsLayer.add(new k(M,l,w)))}if(!h&&B)v.set(O,"width",u);else if(B)return E.resolve({graphics:D,analysisResults:a,context:this}),E},_exportToCSV:function(D,h,B,N){if(this.parent.config.hasOwnProperty("exportFieldsOptionForCSV"))var E=
this.parent.config.exportFieldsOptionForCSV;else this.parent.config.hasOwnProperty("csvAllFields")&&(E=this.parent.config.csvAllFields);D=K.exportToCSV(D,h,B,N,{type:"closest",baseLabel:this.baseLabel,csvAllFields:E,layer:this.tab.tabLayers[0],opLayers:this.parent.opLayers,nlsValue:this.parent.nls.closest,nlsCount:this.parent.nls.count});this.summaryLayer=D.summaryLayer;return D.details},_getFields:function(D){this.layerDefinition=b.getFeatureLayerDefinition(D);this.layerObject=D;D=K.getFields(D,
this.tab,this.allFields,this.parent);this.dateFields=D.dateFields;this.specialFields=D.specialFields;this.typeIdField=D.typeIdField;this.types=D.types;this.displayFields=K.getDisplayFields(this.tab);return D.fields},_zoomToLocation:function(D,h,B){B.shiftKey&&B.keyCode===d.TAB?(B.stopPropagation(),B.cancelBubble=!0):h&&B.keyCode!==d.ENTER&&B.keyCode!==d.SPACE||this.parent.zoomToLocation(D)},_routeToIncident:function(D,h,B){h&&B.keyCode!==d.ENTER&&B.keyCode!==d.SPACE||this.parent.routeToIncident(D)}})})},
"widgets/SituationAwareness/js/ProximityInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Color dojo/_base/array dojo/DeferredList dojo/Deferred dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/on dojo/query dojo/keys esri/graphic esri/Color esri/layers/FeatureLayer esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/Font esri/symbols/TextSymbol esri/tasks/query esri/geometry/geometryEngine jimu/utils ./analysisUtils".split(" "),function(Q,
I,P,V,J,x,n,q,t,v,H,d,b,m,k,e,c,f,A,C,F,z,K,D){return Q("ProximityInfo",null,{featureCount:0,mapServiceLayer:!1,loading:!1,queryOnLoad:!1,incidentCount:0,constructor:function(h,B,N){this.tab=h;this.container=B;this.parent=N;this.graphicsLayer=this.incident=null;this.specialFields={};this.typeIdField="";this.types=[];this.dateFields={};this.config=N.config;this.parentNode=N.domNode;this.baseLabel=""!==h.label?h.label:h.layerTitle?h.layerTitle:h.layers},queryTabCount:function(h,B,N,E){var O=new x;this.incidentCount=
h.length;var R=[this.tab.tabLayers[0]];this.mapServiceLayer&&1<this.tab.tabLayers.length&&(R=[this.tab.tabLayers[1]]);if(0<this.tab.tabLayers.length&&this.tab.tabLayers[0].url&&-1<this.tab.tabLayers[0].url.indexOf("MapServer"))if(this.mapServiceLayer=!0,"undefined"!==typeof this.tab.tabLayers[0].infoTemplate)if(this.summaryLayer=this.tab.tabLayers[0],this.summaryLayer.hasOwnProperty("loaded")&&this.summaryLayer.loaded)this.summaryFields=this._getFields(this.summaryLayer),this._performQuery(h,B,N,
E,R).then(function(u){O.resolve(u)});else{var a=new e(this.summaryLayer.url);a.infoTemplate=this.tab.tabLayers[0].infoTemplate;R=[a];this.tab.tabLayers=R;H(a,"load",I.hitch(this,function(){this.summaryLayer=a;this.summaryFields=this._getFields(this.summaryLayer);this._performQuery(h,B,N,E,R).then(function(u){O.resolve(u)})}))}else this.loading||(a=new e(this.tab.tabLayers[0].url),this.loading=!0,H(a,"load",I.hitch(this,function(){this.summaryLayer=a;this.summaryFields=this._getFields(this.summaryLayer);
for(var u=this.tab.tabLayers[0].url.split("MapServer/")[1],G=this.parent.map.itemInfo.itemData.operationalLayers,l=0;l<G.length;l++){var g=G[l];if(-1<this.tab.tabLayers[0].url.indexOf(g.url)&&"undefined"!==typeof g.layerObject&&g.layerObject.infoTemplates&&(g=g.layerObject.infoTemplates[u])){a.infoTemplate=g.infoTemplate;break}}this.tab.tabLayers=[a];this.loading=!1;this._performQuery(h,B,N,E,this.tab.tabLayers).then(function(w){O.resolve(w)})})));this.mapServiceLayer||this._performQuery(h,B,N,E,
R).then(function(u){O.resolve(u)});return O},_performQuery:function(h,B,N,E,O){var R=new x,a=[],u;0<B.length?u=D.getGeoms(B):0<h.length&&(u=D.getGeoms(h));this.summaryGeoms=u;if(0<u.length)for(h=0;h<u.length;h++){a=u[h];B=D.createDefArray(O,a,this.parent.opLayers,this.tab);var G=0===h?a=B:a=G.concat(B)}(new J(a)).then(I.hitch(this,function(l){for(var g=0,w=0;w<l.length;w++){var M=l[w][1];isNaN(M)?M&&M.features?g+=M.features.length:M&&"undefined"!==typeof M.length&&(g+=M.length):g+=M}this.updateTabCount(g,
N,E);R.resolve(g)}));return R},updateTabCount:function(h,B,N){this.featureCount=h;D.updateTabCount(this.featureCount,B,N,this.baseLabel,this.incidentCount)},updateForIncident:function(h,B,N,E,O,R){this.incidentCount=h.length;this.allFields="undefined"!==typeof O&&"undefined"!==typeof R?O?!0:R:!1;var a="undefined"!==typeof E,u;V.forEach(this.tab.tabLayers,I.hitch(this,function(G){a&&(u=new x);if(G.url){var l=new e(G.url,{mode:e.MODE_ONDEMAND,infoTemplate:G.infoTemplate});H(l,"load",I.hitch(this,function(){this.tab.tabLayers=
[l];a?this.processIncident(h,B,N,E,O).then(I.hitch(this,function(g){u.resolve(g)}),I.hitch(this,function(g){console.error(g);u.reject(g)})):this.processIncident(h,B,N,E,O)}))}else a?this.processIncident(h,B,N,E,O).then(I.hitch(this,function(g){u.resolve(g)}),I.hitch(this,function(g){console.error(g);u.reject(g)})):this.processIncident(h,B,N,E,O)}));if(a)return u},processIncident:function(h,B,N,E,O){this.incidents=h;var R=[];if(0===B.length)for(var a=0;a<h.length;a++){var u=h[a];u=u.geometry?u.geometry:
u;"polygon"===u.type?(B.push(u),R.push({geometry:u,buffer:u})):R.push({geometry:void 0,buffer:void 0})}else for(a=0;a<h.length;a++){u=h[a];var G=B[a].geometry?B[a].geometry:B[a];u=u.geometry?u.geometry:u;R.push({geometry:u,buffer:G})}if(0!==B.length){for(h=0;h<R.length;h++)if(B=R[h].buffer,"undefined"!==typeof B)for(u=0;u<R.length;u++)if(u!==h&&(a=R[u].buffer,"undefined"!==typeof a&&z.overlaps(B,a))){R[h].buffer=z.difference(B,a);R[u].buffer=z.difference(a,B);a=z.union(a,B);a=z.difference(a,R[h].buffer);
a=z.difference(a,R[u].buffer);if(Array.isArray(R[h].geometry)){if(Array.isArray(R[u].geometry))for(G=0;G<R[u].geometry.length;G++)R[h].geometry.push(R[u].geometry[G]);else R[h].geometry.push(R[u].geometry);G=R[h].geometry}else if(G=[],G.push(R[h].geometry),Array.isArray(R[u].geometry))for(var l=0;l<R[u].geometry.length;l++)G.push(R[u].geometry[l]);else G.push(R[u].geometry);R.push({geometry:G,buffer:a})}var g="undefined"!==typeof E;if(g)var w=new x;else this.container.innerHTML="",n.add(this.container,
"loading");var M=[];this.graphicsLayer=N;N=this.tab.tabLayers[0];var Y=this._getFields(N),W=D.getPopupConfiguredFields(N);E=-1===[null,void 0,""].indexOf(N.id)?N.id:this.tab.layers;E=D.getFilter(E,this.parent.opLayers);h=[];for(B=0;B<R.length;B++)u=new F,u.returnGeometry=!0,u.outSpatialReference=this.parent.map.spatialReference,u.geometry=R[B].buffer,u.where=E,u.outFields=["*"],"undefined"!==typeof N.queryFeatures&&h.push(N.queryFeatures(u));(new J(h)).then(I.hitch(this,function(aa){for(var ea=0;ea<
aa.length;ea++){var fa=aa[ea][1];if(fa&&fa.features){fa=fa.features;for(var S=R[ea].geometry,T=0;T<fa.length;T++){var X=fa[T],Z=X.geometry;if(Array.isArray(S)){for(var ha,na=0;na<S.length;na++){var ja=D.getDistance(S[na],Z,this.parent.config.distanceUnits);if("undefined"===typeof ha||ja<ha)ha=ja}Z=ha;var oa={DISTANCE:ha}}else Z=D.getDistance(S,Z,this.parent.config.distanceUnits),oa={DISTANCE:Z};V.forEach(Y,I.hitch(this,function(pa){oa[pa]=X.attributes[pa]}));this.config.hasOwnProperty("exportFieldsOptionForCSV")&&
"allFields"===this.config.exportFieldsOptionForCSV||this.config.hasOwnProperty("csvAllFields")&&(!0===this.config.csvAllFields||"true"===this.config.csvAllFields)?X.attributes.DISTANCE=Z:(this.config.hasOwnProperty("exportFieldsOptionForCSV")&&"popUpFields"===this.config.exportFieldsOptionForCSV&&!O&&(oa={DISTANCE:Z},V.forEach(W,I.hitch(this,function(pa){oa[pa]=X.attributes[pa]}))),X.attributes=oa);M.push(X)}}}M.sort(D.compareDistance);if(g){var ka={graphics:M,analysisResults:M.length,context:this};
this._processResults(M,!0).then(I.hitch(this,function(pa){w.resolve(I.mixin(ka,pa))}))}else this._processResults(M)}),I.hitch(this,function(aa){console.error(aa);w.reject(aa)}));if(g)return w}},_processResults:function(h,B){var N=h&&0<h.length;if(N&&"point"!==h[0].geometry.type)for(var E=h.length-1;0<=E;E--)"undefined"===typeof h[E].geometry.getExtent()&&h.splice(E,1);if(B)var O=new x;else if(this.container.innerHTML="",n.remove(this.container,"loading"),this.graphicsLayer.clear(),N){var R=q.create("div",
{"class":"SAT_tabPanelContent"},this.container);E=q.create("div",{},R);n.add(E,"SATcolExport");n.add(E,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder");var a=q.create("div",{title:this.parent.nls.downloadCSV,tabindex:"0",role:"button","aria-label":this.parent.nls.downloadCSV,"class":"proximityDownLoadCSVButton"},E);n.add(a,"btnExport");n.add(a,this.parent.lightTheme?"lightThemeBackground":"darkThemeBackground");a.focus();K.initFirstFocusNode(this.parentNode,a);H(a,"click",I.hitch(this,
this._exportToCSV,h));H(a,"keydown",I.hitch(this,function(oa){if(!oa.shiftKey||oa.keyCode!==b.TAB)if(oa.keyCode===b.ENTER||oa.keyCode===b.SPACE)this._exportToCSV(h,oa),setTimeout(function(){a.focus()},500)}))}E=this.parent.nls[this.parent.config.distanceUnits];if("undefined"!==typeof this.tab.advStat&&"undefined"!==typeof this.tab.advStat.stats&&"undefined"!==typeof this.tab.advStat.stats.outFields)var u=this.tab.advStat.stats.outFields;else u=[],0<this.tab.tabLayers.length&&V.forEach(this.tab.tabLayers,
I.hitch(this,function(oa){"undefined"!==typeof oa.popupInfo?V.forEach(oa.popupInfo.fieldInfos,I.hitch(this,function(ka){if(ka.visible){var pa={value:0};pa.expression=ka.fieldName;pa.label=ka.label;u.push(pa)}})):oa.infoTemplate?V.forEach(oa.infoTemplate.info.fieldInfos,I.hitch(this,function(ka){if(ka.visible){var pa={value:0};pa.expression=ka.fieldName;pa.label=ka.label;u.push(pa)}})):V.forEach((oa.layerObject?oa.layerObject:oa).fields,I.hitch(this,function(ka){var pa={value:0};pa.expression=ka.name;
pa.label=ka.alias;u.push(pa)}))}));var G=220,l=[];if(N)for(var g=0;g<h.length;g++){var w=g+1,M=h[g],Y=M.geometry,W=Y;"point"!==Y.type&&(W=Y.getExtent().getCenter());Y=M.attributes;var aa=D.getDistanceLabel(Y.DISTANCE,E,this.parent.nls.approximate),ea="",fa=0,S=[];if("undefined"!==typeof u){for(var T=0;T<u.length;T++){var X=u[T],Z;for(Z in Y)if("DISTANCE"!==Z&&3>fa&&X.expression===Z){var ha=D.getFieldValue(Z,Y[Z],this.specialFields,this.dateFields,"longMonthDayYear",this.typeIdField,this.types,this.layerObject&&
this.layerObject.renderer?this.layerObject:this.layerDefinition,Y,X);ha="undefined"!==typeof ha&&null!==ha?K.stripHTML(ha.toString()):"";var na="undefined"!==typeof X.label&&""!==X.label?X.label:void 0,ja=M._layer&&M._layer.fields?M._layer.fields:this.tab.tabLayers&&this.tab.tabLayers[0]?this.tab.tabLayers[0].fields:void 0;ja&&"undefined"===typeof na&&(ja=D.getField(ja,Z))&&(na=ja.alias);if("undefined"===typeof na||na in[""," ",null,void 0])na=Z;D.isURL(ha)?ha='\x3ca href\x3d"'+ha+'" target\x3d"_blank" style\x3d"color: inherit;"\x3e'+
na+"\x3c/a\x3e":D.isEmail(ha)&&(ha='\x3ca href\x3d"mailto:'+ha+'" style\x3d"color: inherit;"\x3e'+na+"\x3c/a\x3e");ea+=X.validLabel?("undefined"!==typeof X.label&&""!==X.label?na+" ":"")+ha+"\x3cbr/\x3e":ha+"\x3cbr/\x3e";fa+=1;S.push({label:na,value:ha})}}S.push({label:this.parent.nls.distance,value:aa});0<S.length&&l.push(S)}B||(M=q.create("div",{},R),n.add(M,"SATcolRec"),n.add(M,this.parent.lightTheme?"lightThemeBorder":"darkThemeBorder"),fa=q.create("div",{},M),n.add(fa,"SATcolRecBar"),S=q.create("div",
{innerHTML:w,tabindex:"0",role:"button","aria-label":this.parent.nls.zoomToFeature+" "+w,isLastElement:h.length-1===g},fa),n.add(S,"SATcolRecNum"),h.length-1===g&&K.initLastFocusNode(this.parentNode,S),v.set(S,"backgroundColor",this.parent.config.activeColor),H(S,"click",I.hitch(this,this._zoomToLocation,W,null)),H(S,"keydown",I.hitch(this,this._zoomToLocation,W,!0)),"point"===this.incidents[0].geometry.type&&(aa=q.create("div",{innerHTML:aa},fa),n.add(aa,"SATcolDistance")),this.parent.config.enableRouting&&
(aa=q.create("div",{"class":"directionsButton",title:this.parent.nls.get_directions,tabindex:"0","aria-label":this.parent.nls.get_directions,role:"button"},fa),n.add(aa,"SATcolDir"),H(aa,"click",I.hitch(this,this._routeToIncident,W,null)),H(aa,"keydown",I.hitch(this,this._routeToIncident,W,!0)),K.initLastFocusNode(this.parentNode,aa)),ea=q.create("div",{"class":"SATcolWrap",innerHTML:ea},M),n.add(ea,"SATcolInfo"),G+=t.position(M).w,ea=new f(f.STYLE_SOLID,new P.fromString(this.parent.config.activeMapGraphicColor),
1),ea=new c(c.STYLE_CIRCLE,24,ea,new P.fromString(this.parent.config.activeMapGraphicColor)),aa=new A,aa.family="Arial",aa.size="12px",w=new C(w,aa,new k(this.parent.lightTheme?"#111111":this.parent.config.fontColor)),w.setOffset(0,-4),this.graphicsLayer.add(new m(W,ea,Y)),this.graphicsLayer.add(new m(W,w,Y)))}if(!B&&N)v.set(R,"width",G+"px");else return O.resolve({reportResults:l}),O},_exportToCSV:function(h,B,N,E){if(this.parent.config.hasOwnProperty("exportFieldsOptionForCSV"))var O=this.parent.config.exportFieldsOptionForCSV;
else this.parent.config.hasOwnProperty("csvAllFields")&&(O=this.parent.config.csvAllFields);h=D.exportToCSV(h,B,N,E,{type:"proximity",baseLabel:this.baseLabel,csvAllFields:O,layer:this.tab.tabLayers[0],opLayers:this.parent.opLayers,nlsValue:this.parent.nls.proximity,nlsCount:this.parent.nls.count,unit:this.parent.nls[this.parent.config.distanceUnits],approximateLabel:this.parent.nls.approximate});this.summaryLayer=h.summaryLayer;return h.details},_getFields:function(h){this.layerDefinition=K.getFeatureLayerDefinition(h);
this.layerObject=h;h=D.getFields(h,this.tab,this.allFields,this.parent);this.dateFields=h.dateFields;this.specialFields=h.specialFields;this.typeIdField=h.typeIdField;this.types=h.types;this.displayFields=D.getDisplayFields(this.tab);return h.fields},_zoomToLocation:function(h,B,N){N.shiftKey&&N.keyCode===b.TAB||B&&N.keyCode!==b.ENTER&&N.keyCode!==b.SPACE||this.parent.zoomToLocation(h)},_routeToIncident:function(h,B,N){B&&N.keyCode!==b.ENTER&&N.keyCode!==b.SPACE||this.parent.routeToIncident(h)}})})},
"widgets/SituationAwareness/js/SnapShotUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/DeferredList dojo/_base/array jimu/utils jimu/dijit/SnapShot ./CSVUtils".split(" "),function(Q,I,P,V,J,x,n,q){return Q("SnapShotUtils",null,{portal:null,portalUrl:"",logo:"",originMapId:"",originAppId:"",credential:null,nls:null,layerArray:[],parent:null,downloadAll:!1,time:null,constructor:function(t){this.parent=t;this.snapshot=new n(t.appConfig,t.map);this.map=this.parent.map;
this.extent=this.map.extent;this.nls=I.mixin({},t.nls,window.jimuNls.drawBox,window.jimuNls.snapshot)},createSnapShot:function(t){var v=new P,H=x.stripHTML(t.name),d=this._getTime(t.time);this.createLayerItems(t,d,H).then(I.hitch(this,function(b){this.snapshot.createSnapShot({folderOptions:{folderName:H+"_"+d,title:H+"_"+d,description:H+" "+this.nls.snapshot},mapTitle:H+" ("+this.nls.snapshot_append+" "+d+")",name:H+" ("+d+")",shareWith:{everyone:!1,org:!1,groups:t.groups.join()},mapExtent:this.map.extent,
data:b}).then(function(){v.resolve()})}));return v},_getTime:function(t){t=new Date(t);var v=t.getTimezoneOffset();return x.fieldFormatter.getFormattedDate(t,{dateFormat:"shortDateShortTime"})+" "+this.nls.utc+(0>v?"+"+Math.abs(v)/60:"-"+v/60)},createLayerItems:function(t,v,H){var d=new P,b=t.layers.reverse();this.buffers=t.buffers;this.incidents=t.incidents;t=[];for(var m=0;m<b.length;m++){var k=!0;b[m].analysisObject&&"undefined"!==typeof b[m].analysisObject.featureCount&&0===b[m].analysisObject.featureCount&&
(k=!1);b[m].graphics&&0===b[m].graphics.length&&(k=!1);k&&t.push(this.createItem(b[m],this.incidents,this.buffers,v,this.nls,H))}var e=[];(new V(t)).then(I.hitch(this,function(c){for(var f=0;f<c.length;f++){var A=c[f][1];if(Array.isArray(A))for(var C=0;C<A.length;C++)e.push(A[C]);else e.push(A)}d.resolve(e)}),I.hitch(this,function(c){d.reject(c)}));return d},createItem:function(t,v,H,d,b,m){var k=new P,e={label:t.label,title:t.label+"_"+d,desc:b.snapshot_append+" "+b.of_append+" "+(t.type?t.type:
t.label)+" "+b.layer_append+" "+t.label+" ("+d+")",name:t.label+"("+d+")",tags:[m+","+b.snapshot_append],originalLayerName:t.label};if(t.layerObject){var c=t.layerObject;m=t.analysisObject;if(c.infoTemplate&&c.infoTemplate.info)var f=c.infoTemplate.info;e.popupInfo=f;"groupedSummary"===t.type||"summary"===t.type?m.updateForIncident(v,H,null,null,!0,!0,!0).then(I.hitch(this,function(A){A=this.createAnalysisLayerJSON(A,c,b,d,e);k.resolve(A)})):m.updateForIncident(v,"closest"===t.type?this.parent.config.maxDistance:
H,null,!0,!0,!0).then(I.hitch(this,function(A){A=this.createAnalysisLayerJSON(A,c,b,d,e);k.resolve(A)}))}else t=this.createIncidentBufferLayerJSON(t.graphics,b,d,e),k.resolve(t);return k},createAnalysisLayerJSON:function(t,v,H,d,b){H=t.graphics;d=t.context._exportToCSV(H,!0);t=[];for(var m=0;m<d.length;m++){var k=d[m];"esriFieldTypeOID"!==k.type&&t.push(k)}for(d=0;d<H.length;d++)m=H[d],m.geometry.cache&&(m.geometry.clearCache(),delete m.geometry.cahce);return{graphics:H,renderer:v.renderer,infoTemplate:b.popupInfo,
fields:t,tags:b.tags,description:b.desc,name:b.name,visibleOnStartup:!1,typeIdField:v.typeIdField,types:v.types,minScale:v.minScale,maxScale:v.maxScale,originalLayerName:b.originalLayerName}},createIncidentBufferLayerJSON:function(t,v,H,d){var b=[],m=[],k=[];v=[];J.forEach(t,function(A){switch(A.geometry.type){case "point":b.push(A);break;case "polyline":m.push(A);break;case "polygon":k.push(A)}});t=[];0<b.length&&t.push(b);0<m.length&&t.push(m);0<k.length&&t.push(k);H={point:this.nls.point,polyline:this.nls.line,
polygon:this.nls.polygon};for(var e=0;e<t.length;e++){var c=t[e];if(0<c.length){var f=c[0];f=H["undefined"!==typeof f.geometry?f.geometry.type:f.type];v.push({graphics:c,fields:[],tags:d.tags,description:d.desc,name:1===t.length?d.name:f+" "+d.name,visibleOnStartup:!1,originalLayerName:d.originalLayerName})}}return v},createDownloadZip:function(t,v,H){var d=new P,b=this.nls.calculated_results;this._performAnalysis(t,v,H,this.downloadAll,!1).then(function(m){for(var k=[],e=0;e<m.length;e++){var c=
m[e];(c=c.context._exportToCSV(c.graphics,!1,!0,c.analysisResults))&&k.push(c)}0<k.length&&q.exportCalculatedResultsCSV(b,k);d.resolve("success")},function(m){d.reject(m)});return d},_performAnalysis:function(t,v,H,d,b){for(var m=new P,k=[],e=0;e<t.length;e++){var c=t[e];console.log("AO: "+c);var f=!0;c.analysisObject&&"undefined"!==typeof c.analysisObject.featureCount&&0===c.analysisObject.featureCount&&(f=!1);f&&("groupedSummary"===c.type||"summary"===c.type?k.push(c.analysisObject.updateForIncident(v,
H,null,null,!0,b,d)):k.push(c.analysisObject.updateForIncident(v,"closest"===c.type?this.parent.config.maxDistance:H,null,!0,b,d)))}var A=[];(new V(k)).then(I.hitch(this,function(C){for(var F=0;F<C.length;F++)A.push(C[F][1]);m.resolve(A)}),I.hitch(this,function(C){console.error(C);m.reject(C)}));return m}})})},"jimu/dijit/SnapShot":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/DeferredList jimu/utils esri/request esri/geometry/webMercatorUtils jimu/portalUtils jimu/tokenUtils jimu/dijit/Message esri/layers/FeatureLayer esri/graphic".split(" "),
function(Q,I,P,V,J,x,n,q,t,v,H,d,b){return Q("Snapshot",null,{_portal:null,_portalUrl:"",_layerArray:[],_originMapId:"",_originAppId:"",_credential:null,name:"",appendTimeStamp:null,baseMap:null,tags:"",description:"",shareWith:null,logo:"",time:null,constructor:function(m,k){this.map=k;this.appConfig=m;this._originAppId=m.appId;this._originMapId=k.itemId;this._mapItemInfo=k.itemInfo;this._portalUrl=m.portalUrl;this._portal=t.getPortal(this._portalUrl);this._baseUrl=this._portalUrl+"sharing/rest/";
this.nls=I.mixin({},window.jimuNls.drawBox,window.jimuNls.snapshot)},createSnapShot:function(m){this.ids=[];this.layerArray=[];this.time=this._getDateString(Date.now());this.name=(m.appendTimeStamp&&m.name?m.name+"_"+this.time:m.name)||this._mapItemInfo.item.title+"_"+this.time;this.extent=m.mapExtent||this.map.extent;this.logo=m.logo||this.appConfig.logo;this.mapName=m.mapTitle||this.name;this.shareWith=m.shareWith||{everyone:!1,org:!1,groups:""};var k=m.folderOptions;k.name=m.folderOptions.name||
this.name;k.title=m.folderOptions.title||this.name;k.description=m.folderOptions.description||this.name;m=m.data.reverse();return this._createSnapshot(k,m)},_createSnapshot:function(m,k){var e=new V;this._portal.getUser().then(I.hitch(this,this._processUser),function(c){e.reject(c)}).then(I.hitch(this,this._createFolder,m),function(c){e.reject(c)}).then(I.hitch(this,this._createItems,k),function(c){e.reject(c)}).then(I.hitch(this,this._addLayers),function(c){e.reject(c)}).then(I.hitch(this,this._createMap,
this._mapItemInfo),function(c){e.reject(c)}).then(I.hitch(this,this._processMap),function(c){e.reject(c)}).then(I.hitch(this,this._shareItems),function(c){e.reject(c)}).then(I.hitch(this,this._showMessage),function(c){e.reject(c)}).then(function(){e.resolve()});return e},_processUser:function(m){var k=new V;this.user=m;this.groups=m.groups;k.resolve();return k},_createFolder:function(m){var k=new V;m={url:this._baseUrl+"content/users/"+this.user.username+"/createFolder",content:I.mixin({f:"json"},
m),handleAs:"json",callbackParamName:"callback"};this._isValidCredential()&&(m.content.token=this._credential.token);n(m,{usePost:!0}).then(I.hitch(this,function(e){e.success?((this.folder=e.folder)&&this.folder.id&&this.ids.push(this.folder.id),k.resolve(e.folder)):(console.log(e),k.reject(e))}),I.hitch(this,function(e){k.reject(e)}));return k},_createItems:function(m){var k=new V,e=[];P.forEach(m,I.hitch(this,function(f){f.graphics&&0<f.graphics.length&&e.push(this._createLayerItem(f))}));var c=
[];(new J(e)).then(I.hitch(this,function(f){for(var A=0;A<f.length;A++)!0===f[A][0]&&null!==f[A][1]&&c.push(f[A][1]);k.resolve(c)}),I.hitch(this,function(f){k.reject(f)}));return k},_addLayers:function(m){for(var k=new V,e=[],c=0;c<m.length;c++)e.push(this.user.addItem(m[c],this.folder.id));var f=[];(new J(e)).then(I.hitch(this,function(A){for(var C=0;C<A.length;C++){var F=A[C][1];F.success&&(f.push(F.id),this.ids.push(F.id))}k.resolve(f)}),I.hitch(this,function(A){k.reject(A)}));return k},_createMap:function(m){for(var k=
m.itemData,e=this.name,c=[],f=0;f<k.baseMap.baseMapLayers.length;f++){var A=k.baseMap.baseMapLayers[f];c.push({id:A.id,layerType:A.layerType,url:A.url,visibility:A.visibility,opacity:A.opacity,title:A.title,styleUrl:A.styleUrl,itemId:A.itemId})}k={baseMapLayers:c};c=[];for(f=0;f<this.layerArray.length;f++)A=this.layerArray[f],c.push({id:A.layer.id,layerType:"ArcGISFeatureLayer",visibility:A.layer.visible,opacity:A.layer.opacity,title:A.layer.label,type:"feature",url:A.layer.url,popupInfo:A.layer.popupInfo});
f=q.webMercatorToGeographic(this.extent);m={title:e,type:"Web Map",item:e,extent:f.xmin+","+f.ymin+","+f.xmax+","+f.ymax,text:JSON.stringify({operationalLayers:c,baseMap:k,spatialReference:this.map.spatialReference,version:m&&m.itemData&&m.itemData.version?m.itemData.version:"2.4"}),tags:this.name+","+this.nls.snapshot_append,wabType:"HTML"};return this.user.addItem(m,this.folder.id)},_processMap:function(m){var k=new V;m.id&&this.ids.push(m.id);m.success?k.resolve(m.id):k.reject("fail");return k},
_shareItems:function(m){var k=new V,e={url:this._baseUrl+"content/users/"+this.user.username+"/shareItems",content:{f:"json",everyone:this.shareWith.everyone,org:this.shareWith.org,items:this.ids.join(),groups:this.shareWith.groups,confirmItemControl:this._validateGroupItemControl(this.shareWith.groups)},handleAs:"json",callbackParamName:"callback"};this._isValidCredential()&&(e.content.token=this._credential.token);n(e,{usePost:!0}).then(I.hitch(this,function(c){c.results&&0<c.results.length?k.resolve(this._portalUrl+
"home/webmap/viewer.html?webmap\x3d"+m):k.reject("fail")}),I.hitch(this,function(c){k.reject(c)}));return k},_validateGroupItemControl:function(m){var k=m.split(",");return 0<this.groups.filter(function(e){var c=e.capabilities||[];return-1<k.indexOf(e.id)&&-1<c.indexOf("updateitemcontrol")}).length},_showMessage:function(m){var k=new V;"fail"===m?(new H({message:this.nls.snapshot_failed}),k.reject(m)):(new H({message:'\x3ca href\x3d"'+m+'" target\x3d"_blank"\x3e'+this.nls.snapshot_complete+"\x3c/a\x3e"}),
k.resolve("success"));return k},_getDateString:function(m){m=new Date(m);var k=m.getTimezoneOffset();return x.fieldFormatter.getFormattedDate(m,{dateFormat:"shortDateShortTime"})+" "+this.nls.utc+(0>k?"+"+Math.abs(k)/60:"-"+k/60)},_checkCredential:function(){var m=v.isValidCredential(this._credential);m||this._clearCredential();return m},_isValidCredential:function(){this._updateCredential();return this._checkCredential()},_updateCredential:function(){this._checkCredential()||(this._credential=v.getPortalCredential(this._portalUrl))},
_clearCredential:function(){this._credential=null},_createLayerItem:function(m){var k=new V,e={description:m.name,name:m.name,tags:[m.name],type:"Feature Service",title:m.name};this._createFeatureService(m.originalLayerName).then(I.hitch(this,function(c){if(c.success){var f=c.serviceurl.replace(/rest/g,"rest/admin")+"/addToDefinition",A=this._createLayer(I.mixin(m,e));this._addDefinitionToService(f,A).then(I.hitch(this,function(C){C.success&&(C=new d(c.serviceurl+"/0?token\x3d"+this._credential.token,
{id:e.name,outFields:["*"]}),e.url=c.serviceurl+"/0",this.layerArray.push({layer:{id:e.name,label:e.name,opacity:1,visible:!0,url:e.url,popupInfo:m.infoTemplate&&m.infoTemplate.info?m.infoTemplate.info:m.infoTemplate?m.infoTemplate:void 0}}),this._applyEditsOnLayer(C,m.graphics,k,e))}),I.hitch(this,function(C){console.log(C.message);k.reject(null)}))}else k.reject(null)}),I.hitch(this,function(c){console.log(c.message);k.reject(null)}));return k},_applyEditsOnLayer:function(m,k,e,c){var f=[];P.forEach(k,
function(A){A.attributes?f.push(new b(A.geometry,null,A.attributes)):f.push(new b(A.geometry,null,{}))},this);m.applyEdits(f,null,null).then(I.hitch(this,function(){e.resolve(c)})).otherwise(I.hitch(this,function(A){console.log(A.message);e.reject(null)}))},_createFeatureService:function(m){return n({url:this._portalUrl+"sharing/content/users/"+this._credential.userId+"/createService",content:{f:"json",token:this._credential.token,typeKeywords:"ArcGIS Server,Data,Feature Access,Feature Service,Service,Hosted Service",
createParameters:JSON.stringify(this._getFeatureServiceParams(m)),outputType:"featureService"},handleAs:"json",callbackParamName:"callback"},{usePost:!0})},_getFeatureServiceParams:function(m){return{name:m+"_"+(new Date).getTime(),serviceDescription:"",hasStaticData:!1,maxRecordCount:1E3,supportedQueryFormats:"JSON",capabilities:"Create,Delete,Query,Update,Editing",tags:"",description:"",copyrightText:"",spatialReference:{wkid:102100},initialExtent:{xmin:this.map.extent.xmin,ymin:this.map.extent.ymin,
xmax:this.map.extent.xmax,ymax:this.map.extent.ymax,spatialReference:{wkid:102100}},allowGeometryUpdates:!0,units:"esriMeters",xssPreventionInfo:{xssPreventionEnabled:!0,xssPreventionRule:"InputOnly",xssInputRule:"rejectInvalid"}}},_addDefinitionToService:function(m,k){return n({url:m,content:{token:this._credential.token,addToDefinition:JSON.stringify(k),f:"json"},handleAs:"json",callbackParamName:"callback"},{usePost:!0})},_createLayer:function(m){var k=this.nls,e=m.graphics[0],c={point:"esriGeometryPoint",
polyline:"esriGeometryPolyline",polygon:"esriGeometryPolygon"}["undefined"!==typeof e.geometry?e.geometry.type:e.type];e=e.symbol?e.symbol.toJson():"";var f=[{name:"ObjectID",alias:"ObjectID",type:"esriFieldTypeOID"},{name:k.snapshot_append,alias:k.snapshot_append,type:"esriFieldTypeString"}];m.fields&&0<m.fields.length&&P.forEach(m.fields,function(A){f.push({name:A.name,alias:A.alias,type:A.type,domain:A.domain})});k={xmin:this.extent.xmin,ymin:this.extent.ymin,xmax:this.extent.xmax,ymax:this.extent.ymax,
spatialReference:this.extent.spatialReference};e=m.renderer&&m.renderer.toJson?m.renderer.toJson():m.renderer?JSON.stringify(m.renderer):{type:"simple",label:"",description:"",symbol:e};return{layers:[{adminLayerInfo:{geometryField:{name:"Shape"},xssTrustedFields:""},id:0,name:m.name,type:"Feature Layer",displayField:"",description:m.description,tags:"SA",copyrightText:"",defaultVisibility:!0,ownershipBasedAccessControlForFeatures:{allowOthersToQuery:!1,allowOthersToDelete:!1,allowOthersToUpdate:!1},
relationships:[],isDataVersioned:!1,supportsCalculate:!0,supportsAttachmentsByUploadId:!0,supportsRollbackOnFailureParameter:!0,supportsStatistics:!0,supportsAdvancedQueries:!0,supportsValidateSql:!0,supportsCoordinatesQuantization:!0,supportsApplyEditsWithGlobalIds:!0,advancedQueryCapabilities:{supportsPagination:!0,supportsQueryWithDistance:!0,supportsReturningQueryExtent:!0,supportsStatistics:!0,supportsOrderBy:!0,supportsDistinct:!0,supportsQueryWithResultType:!0,supportsSqlExpression:!0,supportsReturningGeometryCentroid:!0},
useStandardizedQueries:!1,geometryType:c,minScale:0,maxScale:0,extent:k,drawingInfo:{renderer:e},allowGeometryUpdates:!0,hasAttachments:!1,htmlPopupType:"esriServerHTMLPopupTypeNone",hasM:!1,hasZ:!1,objectIdField:"OBJECTID",globalIdField:"",typeIdField:"",fields:this._getLayerFields(m.fields),indexes:[],types:[],templates:[{name:"New Feature",description:"",drawingTool:"esriFeatureEditToolPolygon",prototype:{attributes:{}}}],supportedQueryFormats:"JSON",hasStaticData:!1,maxRecordCount:1E4,standardMaxRecordCount:4E3,
tileMaxRecordCount:4E3,maxRecordCountFactor:1,exceedsLimitFactor:1,capabilities:"Query,Editing,Create,Update,Delete"}]}},_getLayerFields:function(m){var k=[{name:"OBJECTID",type:"esriFieldTypeOID",actualType:"int",alias:"OBJECTID",sqlType:"sqlTypeOther",nullable:!1,editable:!1,domain:null,defaultValue:null}];P.forEach(m,I.hitch(this,function(e){"esriFieldTypeString"===e.type&&(e.actualType="nvarchar",e.sqlType="sqlTypeNVarchar");k.push(e)}));return k}})})},"widgets/SituationAwareness/js/PropertyHelper":function(){define("dojo/_base/declare dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/dom-class dojo/on dojo/dom-attr dojo/keys dojo/query dojo/Deferred jimu/BaseWidget jimu/portalUtils dojo/Evented dojo/text!./PropertyHelper.html jimu/dijit/formSelect dijit/form/ValidationTextBox".split(" "),
function(Q,I,P,V,J,x,n,q,t,v,H,d,b,m,k){return Q([H,I,b],{templateString:m,baseClass:"jimu-widget-SAT-property-helper",constructor:function(){},postMixInProperties:function(){this.inherited(arguments);this.nls.common=window.jimuNls.common},postCreate:function(){this.inherited(arguments);this.windowResize=this.own(x(window,"resize",P.hitch(this,this._resize)));"report"===this.type?this.initReportControls():this.initSnapshotControls();this.startup()},_resize:function(){var e=!isNaN(window.innerWidth)&&
null!==window.innerWidth&&""!==window.innerWidth&&window.innerWidth?window.innerWidth:450;this.popup.width=450<=e?450:e},startup:function(){this.snapshotName.invalidMessage=this.invalidMessage;this.snapshotName.validator="report"===this.type?this.checkReportString:this.checkString;this.btnCancel.innerText=this.nls.common.cancel;n.set(this.btnCancel,"aria-label",this.nls.common.cancel);this.own(x(this.btnCancel,"click",P.hitch(this,function(){this.emit("cancel")})));this.own(x(this.btnCancel,"keydown",
P.hitch(this,function(e){e.keyCode!==q.ENTER&&e.keyCode!==q.SPACE||this.emit("cancel")})));this.btnOk.innerText=this.nls.common.ok;n.set(this.btnOk,"aria-label",this.nls.common.ok);this.own(x(this.btnOk,"click",P.hitch(this,function(){this.onOkButtonClicked()})));this.own(x(this.btnOk,"keydown",P.hitch(this,function(e){if(e.keyCode===q.ENTER||e.keyCode===q.SPACE)this.onOkButtonClicked()})))},onOkButtonClicked:function(){if(!J.contains(this.btnOk,"jimu-state-disabled")){var e={name:this.snapshotName.value.trim()};
"report"===this.type?e=P.mixin(e,{reportLayout:{orientation:this.pageUtils.Orientation[this.orientationSelect.selectControl.value],pageSize:this.pageUtils.PageSizes[this.pageSizeSelect.selectControl.value]},comments:this.commentTextArea.value}):e.groups=[this.shareSelect.selectControl.value!==this.nls.choose_group?this.shareSelect.selectControl.value:""];this.emit("ok",e)}},initWidth:function(){this._resize()},checkString:function(e){e=101>e.trim().length;var c=t(".snapshot-name-footer")[0];c&&(this.hasNoGroups?
(V.addClass(c.children[0],"jimu-state-disabled"),n.set(c.children[0],"tabindex","-1")):e?(V.removeClass(c.children[0],"jimu-state-disabled"),n.set(c.children[0],"tabindex","0")):(V.addClass(c.children[0],"jimu-state-disabled"),n.set(c.children[0],"tabindex","-1")));return e},checkReportString:function(e){e=0<e.trim().length?!0:!1;var c=t(".snapshot-name-footer")[0];c&&(e?(V.removeClass(c.children[0],"jimu-state-disabled"),n.set(c.children[0],"tabindex","0")):(V.addClass(c.children[0],"jimu-state-disabled"),
n.set(c.children[0],"tabindex","-1")));return e},getPageUtilValues:function(e,c,f){var A="A3 A4 Letter_ANSI_A Tabloid_ANSI_B Landscape Portrait".split(" "),C=["Letter ANSI A","Portrait"],F=Object.keys(e),z=[],K;for(K in F){var D=F[K],h=e[D];D&&h.hasOwnProperty(c)&&-1<A.indexOf(D)&&z.push({label:h[c],value:D,selected:h[c]===f||-1<C.indexOf(h[c])})}return z},getGroupValues:function(e){var c=new v;d.getPortal(this.portalUrl).getUser().then(P.hitch(this,function(f){var A=[],C;for(C in f.groups){var F=
f.groups[C];A.push({label:F.title,value:F.id,selected:F.title===e})}c.resolve(A)}),P.hitch(this,function(f){console.log(f);c.resolve([])}));return c},initSnapshotControls:function(){this.nameSpan.innerHTML=this.nls.common.name+":";this.shareSpan.innerHTML=this.nls.select_group+":";this.toggleRow(this.shareRow,!1);this.toggleRow(this.orientationRow,!0);this.toggleRow(this.pageSizeRow,!0);this.toggleRow(this.commentsRow,!0);if(null!==this.storedProps){var e=JSON.parse(this.storedProps,!0);if(e.share)var c=
e.share}this.getGroupValues(c).then(P.hitch(this,function(f){this.snapshotName.hasNoGroups=0===f.length?!0:!1;this.addSelect(this.shareSpan.innerHTML,this.shareSelect,f)}))},initReportControls:function(){this.nameSpan.innerHTML=this.nls.common.title+":";this.toggleRow(this.orientationRow,!1);this.toggleRow(this.pageSizeRow,!1);this.toggleRow(this.commentsRow,!1);this.toggleRow(this.shareRow,!0);if(null!==this.storedProps){var e=JSON.parse(this.storedProps,!0);if(e.reportLayout){var c=e.reportLayout.pageSize;
var f=e.reportLayout.orientation.Text;c=c.SizeName}}this.addSelect(this.nls.orientation,this.orientationSelect,this.getPageUtilValues(this.pageUtils.Orientation,"Text",f));this.addSelect(this.nls.pageSize,this.pageSizeSelect,this.getPageUtilValues(this.pageUtils.PageSizes,"SizeName",c))},addSelect:function(e,c,f){c.selectControl=new k({options:f,"aria-label":e,style:"width: 100%;"});c.selectControl.placeAt(c).startup()},toggleRow:function(e,c){J.contains(e,c?"display-on":"display-off")&&J.remove(e,
c?"display-on":"display-off");J.add(e,c?"display-off":"display-on")},destroy:function(){}})})},"esri/dijit/util/busyIndicator":function(){define("dijit/registry dojo/_base/lang dojo/_base/window dojo/dom dojo/dom-construct dojox/widget/Standby require".split(" "),function(Q,I,P,V,J,x,n){var q={_defaultStandbyParams:{image:n.toUrl("../images/loading-throb.gif"),color:"#fff",opacity:.75,duration:200},create:function(t){if(t=this._normalizeParams(t))return t=new x(q._toStandbyParams(t)),J.place(t.domNode,
P.doc.body),q._createHandle(t)},_normalizeParams:function(t){if(t){if(t.target)return t;if("string"===typeof t){var v=Q.byId(t);t=v?v.domNode:V.byId(t)}else t=t.domNode?t.domNode:V.byId(t);if(t)return{target:t}}},_toStandbyParams:function(t){t.imageUrl&&(t.image=t.imageUrl);t.backgroundColor&&(t.color=t.backgroundColor);t.backgroundOpacity&&(t.opacity=t.backgroundOpacity);t.fadeDuration&&(t.duration=t.fadeDuration);return I.mixin({},q._defaultStandbyParams,t)},_createHandle:function(t){return{show:function(){t&&
t.show()},hide:function(){t&&t.hide()},destroy:function(){t&&(t.destroy(),t=null)}}}};return q})},"dojox/widget/Standby":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/array dojo/_base/event dojo/_base/sniff dojo/dom dojo/dom-attr dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/window dojo/_base/window dojo/_base/fx dojo/fx dijit/_Widget dijit/_TemplatedMixin dijit/registry".split(" "),function(Q,I,P,V,J,x,n,q,t,v,H,d,b,m,k,e,c){Q.experimental("dojox.widget.Standby");
return I("dojox.widget.Standby",[k,e],{image:require.toUrl("dojox/widget/Standby/images/loading.gif").toString(),imageText:"Please Wait...",text:"Please wait...",centerIndicator:"image",target:"",color:"#C0C0C0",duration:500,zIndex:"auto",opacity:.75,templateString:'\x3cdiv\x3e\x3cdiv style\x3d"display: none; opacity: 0; z-index: 9999; position: absolute; cursor:wait;" dojoAttachPoint\x3d"_underlayNode"\x3e\x3c/div\x3e\x3cimg src\x3d"${image}" style\x3d"opacity: 0; display: none; z-index: -10000; position: absolute; top: 0px; left: 0px; cursor:wait;" dojoAttachPoint\x3d"_imageNode"\x3e\x3cdiv style\x3d"opacity: 0; display: none; z-index: -10000; position: absolute; top: 0px;" dojoAttachPoint\x3d"_textNode"\x3e\x3c/div\x3e\x3c/div\x3e',
_underlayNode:null,_imageNode:null,_textNode:null,_centerNode:null,_displayed:!1,_resizeCheck:null,_started:!1,_parent:null,startup:function(f){if(!this._started){if("string"===typeof this.target){var A=c.byId(this.target);this.target=A?A.domNode:x.byId(this.target)}this.text&&(this._textNode.innerHTML=this.text);"image"===this.centerIndicator?(this._centerNode=this._imageNode,n.set(this._imageNode,"src",this.image),n.set(this._imageNode,"alt",this.imageText)):this._centerNode=this._textNode;v.set(this._underlayNode,
{display:"none",backgroundColor:this.color});v.set(this._centerNode,"display","none");this.connect(this._underlayNode,"onclick","_ignore");this.domNode.parentNode&&this.domNode.parentNode!=d.body()&&d.body().appendChild(this.domNode);7==J("ie")&&(this._ieFixNode=q.create("div"),v.set(this._ieFixNode,{opacity:"0",zIndex:"-1000",position:"absolute",top:"-1000px"}),d.body().appendChild(this._ieFixNode));this.inherited(arguments)}},show:function(){this._displayed||(this._anim&&(this._anim.stop(),delete this._anim),
this._displayed=!0,this._size(),this._disableOverflow(),this._fadeIn())},hide:function(){if(this._displayed)try{this._anim&&(this._anim.stop(),delete this._anim),this._size()}catch(f){console.error(f)}finally{this._fadeOut(),this._displayed=!1,null!==this._resizeCheck&&(clearInterval(this._resizeCheck),this._resizeCheck=null)}},isVisible:function(){return this._displayed},onShow:function(){},onHide:function(){},uninitialize:function(){this._displayed=!1;this._resizeCheck&&clearInterval(this._resizeCheck);
v.set(this._centerNode,"display","none");v.set(this._underlayNode,"display","none");7==J("ie")&&this._ieFixNode&&(d.body().removeChild(this._ieFixNode),delete this._ieFixNode);this._anim&&(this._anim.stop(),delete this._anim);this._centerNode=this._textNode=this._imageNode=this.target=null;this.inherited(arguments)},_size:function(){if(this._displayed){var f=n.get(d.body(),"dir");f&&(f=f.toLowerCase());var A=this._scrollerWidths(),C=this.target,F=v.get(this._centerNode,"display");v.set(this._centerNode,
"display","block");var z=t.position(C,!0);if(C===d.body()||C===d.doc)z=H.getBox(),z.x=z.l,z.y=z.t;var K=t.getMarginBox(this._centerNode);v.set(this._centerNode,"display",F);if(this._ieFixNode){var D=-this._ieFixNode.offsetTop/1E3;z.x=Math.floor((z.x+.9)/D);z.y=Math.floor((z.y+.9)/D);z.w=Math.floor((z.w+.9)/D);z.h=Math.floor((z.h+.9)/D)}var h=v.get(C,"zIndex"),B=F=h;if("auto"===this.zIndex)if("auto"!=h)F=parseInt(F,10),B=parseInt(B,10);else{var N=C;if(N&&N!==d.body()&&N!==d.doc)for(N=C.parentNode,
D=-1E5;N&&N!==d.body();)(h=v.get(N,"zIndex"))&&"auto"!==h&&(h=parseInt(h,10),D<h&&(D=h,F=h+1,B=h+1)),N=N.parentNode}else F=parseInt(this.zIndex,10),B=parseInt(this.zIndex,10);v.set(this._centerNode,"zIndex",B);v.set(this._underlayNode,"zIndex",F);if((F=C.parentNode)&&F!==d.body()&&C!==d.body()&&C!==d.doc){N=z.h;B=z.w;C=t.position(F,!0);this._ieFixNode&&(D=-this._ieFixNode.offsetTop/1E3,C.x=Math.floor((C.x+.9)/D),C.y=Math.floor((C.y+.9)/D),C.w=Math.floor((C.w+.9)/D),C.h=Math.floor((C.h+.9)/D));C.w-=
F.scrollHeight>F.clientHeight&&0<F.clientHeight?A.v:0;C.h-=F.scrollWidth>F.clientWidth&&0<F.clientWidth?A.h:0;"rtl"===f&&(J("opera")?(z.x+=F.scrollHeight>F.clientHeight&&0<F.clientHeight?A.v:0,C.x+=F.scrollHeight>F.clientHeight&&0<F.clientHeight?A.v:0):J("ie")?C.x+=F.scrollHeight>F.clientHeight&&0<F.clientHeight?A.v:0:J("webkit"));C.w<z.w&&(z.w-=C.w);C.h<z.h&&(z.h-=C.h);var E=C.y,O=C.y+C.h,R=z.y,a=z.y+N;f=C.x;D=C.x+C.w;h=z.x;var u=z.x+B;if(a>E&&R<E)z.y=C.y,N-=E-R,z.h=N<C.h?N:z.h-2*(F.scrollWidth>
F.clientWidth&&0<F.clientWidth?A.h:0);else if(R<O&&a>O)z.h=O-R;else if(a<=E||R>=O)z.h=0;if(u>f&&h<f)z.x=C.x,B-=f-h,z.w=B<C.w?B:z.w-2*(F.scrollHeight>F.clientHeight&&0<F.clientHeight?A.w:0);else if(h<D&&u>D)z.w=D-h;else if(u<=f||h>=D)z.w=0}0<z.h&&0<z.w?(v.set(this._underlayNode,{display:"block",width:z.w+"px",height:z.h+"px",top:z.y+"px",left:z.x+"px"}),A=["borderRadius","borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"],this._cloneStyles(A),J("ie")||(A=
"MozBorderRadius MozBorderRadiusTopleft MozBorderRadiusTopright MozBorderRadiusBottomleft MozBorderRadiusBottomright WebkitBorderRadius WebkitBorderTopLeftRadius WebkitBorderTopRightRadius WebkitBorderBottomLeftRadius WebkitBorderBottomRightRadius".split(" "),this._cloneStyles(A,this)),A=z.h/2-K.h/2,F=z.w/2-K.w/2,z.h>=K.h&&z.w>=K.w?v.set(this._centerNode,{top:A+z.y+"px",left:F+z.x+"px",display:"block"}):v.set(this._centerNode,"display","none")):(v.set(this._underlayNode,"display","none"),v.set(this._centerNode,
"display","none"));if(null===this._resizeCheck){var G=this;this._resizeCheck=setInterval(function(){G._size()},100)}}},_cloneStyles:function(f){P.forEach(f,function(A){v.set(this._underlayNode,A,v.get(this.target,A))},this)},_fadeIn:function(){var f=this,A=b.animateProperty({duration:f.duration,node:f._underlayNode,properties:{opacity:{start:0,end:f.opacity}}}),C=b.animateProperty({duration:f.duration,node:f._centerNode,properties:{opacity:{start:0,end:1}},onEnd:function(){f.onShow();delete f._anim}});
this._anim=m.combine([A,C]);this._anim.play()},_fadeOut:function(){var f=this,A=b.animateProperty({duration:f.duration,node:f._underlayNode,properties:{opacity:{start:f.opacity,end:0}},onEnd:function(){v.set(this.node,{display:"none",zIndex:"-1000"})}}),C=b.animateProperty({duration:f.duration,node:f._centerNode,properties:{opacity:{start:1,end:0}},onEnd:function(){v.set(this.node,{display:"none",zIndex:"-1000"});f.onHide();f._enableOverflow();delete f._anim}});this._anim=m.combine([A,C]);this._anim.play()},
_ignore:function(f){f&&V.stop(f)},_scrollerWidths:function(){var f=q.create("div");v.set(f,{position:"absolute",opacity:0,overflow:"hidden",width:"50px",height:"50px",zIndex:"-100",top:"-200px",padding:"0px",margin:"0px"});var A=q.create("div");v.set(A,{width:"200px",height:"10px"});f.appendChild(A);d.body().appendChild(f);A=t.getContentBox(f);v.set(f,"overflow","scroll");var C=t.getContentBox(f);d.body().removeChild(f);return{v:A.w-C.w,h:A.h-C.h}},_setTextAttr:function(f){this.text=this._textNode.innerHTML=
f},_setColorAttr:function(f){v.set(this._underlayNode,"backgroundColor",f);this.color=f},_setImageTextAttr:function(f){n.set(this._imageNode,"alt",f);this.imageText=f},_setImageAttr:function(f){n.set(this._imageNode,"src",f);this.image=f},_setCenterIndicatorAttr:function(f){this.centerIndicator=f;"image"===f?(this._centerNode=this._imageNode,v.set(this._textNode,"display","none")):(this._centerNode=this._textNode,v.set(this._imageNode,"display","none"))},_setTargetAttr:function(f){if("string"===typeof f){var A=
c.byId(f);this._set("target",A?A.domNode:x.byId(f))}else this._set("target",f)},_disableOverflow:function(){if(this.target===d.body()||this.target===d.doc){this._overflowDisabled=!0;var f=d.body();this._oldOverflow=f.style&&f.style.overflow?v.get(f,"overflow"):"";if(J("ie")&&!J("quirks")){if(f.parentNode&&f.parentNode.style&&f.parentNode.style.overflow)this._oldBodyParentOverflow=f.parentNode.style.overflow;else try{this._oldBodyParentOverflow=v.get(f.parentNode,"overflow")}catch(A){this._oldBodyParentOverflow=
"scroll"}v.set(f.parentNode,"overflow","hidden")}v.set(f,"overflow","hidden")}},_enableOverflow:function(){if(this._overflowDisabled){delete this._overflowDisabled;var f=d.body();J("ie")&&!J("quirks")&&(f.parentNode.style.overflow=this._oldBodyParentOverflow,delete this._oldBodyParentOverflow);v.set(f,"overflow",this._oldOverflow);if(J("webkit")){var A=q.create("div",{style:{height:"2px"}});f.appendChild(A);setTimeout(function(){f.removeChild(A)},0)}delete this._oldOverflow}}})})},"widgets/SituationAwareness/_build-generate_module":function(){define(["dojo/text!./Widget.html",
"dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:jimu/dijit/templates/ReportTemplate.html":'\x3c!DOCTYPE HTML\x3e\r\n\x3chtml lang\x3d"en" dir\x3d"ltr"\x3e\r\n\r\n\x3chead id\x3d"reportHead"\x3e\r\n  \x3cmeta charset\x3d"utf-8"\x3e\r\n  \x3cmeta http-equiv\x3d"X-UA-Compatible" content\x3d"IE\x3dEdge,chrome\x3d1"\x3e\r\n  \x3ctitle\x3e\x3c/title\x3e\r\n  \x3cscript\x3e\r\n    // Show/hide text area controls based on the value\r\n    function onPrintButtonClicked() {\r\n      var notesContainer, i;\r\n      notesContainer \x3d document.getElementsByClassName("esriCTNotesContainer");\r\n      //process notes to show/hide based on contents\r\n      for (i \x3d 0; i \x3c notesContainer.length; i++) {\r\n        if (notesContainer[i]) {\r\n          //Hide the notes which are not having values\r\n          if (notesContainer[i].children[1].value.trim() \x3d\x3d\x3d "") {\r\n            notesContainer[i].className +\x3d " esriCTHideReportNotes";\r\n          }\r\n          else {\r\n            //Removes hidden class if available\r\n            notesContainer[i].className \x3d\r\n              notesContainer[i].className.replace("esriCTHideReportNotes", "");\r\n          }\r\n        }\r\n      }\r\n      //after processing notes, print the window\r\n      window.print();\r\n    }\r\n  \x3c/script\x3e\r\n  \x3c!-- Report prev page css --\x3e\r\n  \x3cstyle type\x3d"text/css"\x3e\r\n    .esriCTReportMapWait {\r\n      height: 5px;\r\n      width: 100%;\r\n      position: relative;\r\n      overflow: hidden;\r\n      background-color: #ddd;\r\n    }\r\n\r\n    .esriCTReportMapWait:before {\r\n      display: block;\r\n      position: absolute;\r\n      content: "";\r\n      left: -200px;\r\n      width: 200px;\r\n      height: 5px;\r\n      background-color: #2980b9;\r\n      animation: loading 2s linear infinite;\r\n    }\r\n\r\n    @keyframes loading {\r\n      from {\r\n        left: -200px;\r\n        width: 30%;\r\n      }\r\n      50% {\r\n        width: 30%;\r\n      }\r\n      70% {\r\n        width: 70%;\r\n      }\r\n      80% {\r\n        left: 50%;\r\n      }\r\n      95% {\r\n        left: 120%;\r\n      }\r\n      to {\r\n        left: 100%;\r\n      }\r\n    }\r\n\r\n    .esriCTHTMLData {\r\n      position: relative;\r\n      width: 100%;\r\n      height: auto;\r\n    }\r\n\r\n    .jimu-rtl .esriCTHTMLData {\r\n      direction: rtl;\r\n    }\r\n\r\n    .esriCTTable {\r\n      margin-top: 10px;\r\n      padding: 0;\r\n      border-collapse: collapse;\r\n      border-spacing: 0;\r\n      width: 100%;\r\n      page-break-inside: avoid;\r\n      table-layout: fixed;\r\n    }\r\n\r\n    .jimu-rtl .esriCTTable {\r\n      direction: rtl;\r\n    }\r\n\r\n    .esriCTTable th {\r\n      border: 1px solid gray;\r\n      background-color: #E4E4E4;\r\n      word-wrap: break-word;\r\n    }\r\n\r\n    .esriCTTable td {\r\n      border: 1px solid gray;\r\n      word-wrap: break-word;\r\n    }\r\n\r\n    .esriCTSectionTitle {\r\n      font-size: 18px;\r\n      color: #0f96cc;\r\n      font-weight: bold;\r\n      margin: 30px 0px;\r\n      width: calc(100% - 10px);\r\n      word-break: break-all;\r\n    }\r\n\r\n    .jimu-rtl .esriCTSectionTitle {\r\n      float: right;\r\n      direction: rtl;\r\n    }\r\n\r\n    .jimu-rtl .esriCTReportMap .esriCTSectionTitle {\r\n      float: none;\r\n    }\r\n\r\n    .esriCTReportLogo {\r\n      float: left;\r\n      max-width: calc(50% - 10px);\r\n      margin: auto 10px auto 0;\r\n      max-height: 90%;\r\n      position: absolute;\r\n      top: 0;\r\n      bottom: 0;\r\n    }\r\n\r\n    .jimu-rtl .esriCTReportLogo {\r\n      float: right;\r\n      margin: auto 0 auto 10px;\r\n    }\r\n\r\n    .esriCTPrintTitleDiv {\r\n      height: 56px;\r\n      float: right;\r\n      min-width: 50%;\r\n    }\r\n\r\n    .jimu-rtl .esriCTPrintTitleDiv {\r\n      float: left;\r\n      direction: rtl;\r\n    }\r\n\r\n    .esriCTInputTitle {\r\n      height: 55px;\r\n      line-height: 55px;\r\n      border: none;\r\n      font-size: 25px;\r\n      width: 100%;\r\n      padding: 0px;\r\n    }\r\n\r\n    .esriCTInputTitle::-ms-clear {\r\n      display: none;\r\n    }\r\n\r\n    .esriCTReportMain {\r\n      background: #FFF;\r\n      border: solid 1px #000;\r\n      margin: 0 auto;\r\n      padding: 20px;\r\n      width: 797px;\r\n    }\r\n\r\n    .esriCTReportMap {\r\n      text-align: center;\r\n    }\r\n\r\n    .esriCTReportMapImg {\r\n      max-width: 96%;\r\n      margin-top: 10px;\r\n    }\r\n\r\n    .esriCTReportLandscapeMapImg {\r\n      max-width: 80%;\r\n    }\r\n\r\n    .esriCTReportMapFail {\r\n      height: 50px;\r\n    }\r\n\r\n    .esriCTReportFooter {\r\n      text-align: center;\r\n      font-size: 80%;\r\n      padding: 10px 0;\r\n      white-space: pre-wrap;\r\n      word-wrap: break-word;\r\n    }\r\n\r\n    .esriCTPrintPage {\r\n      padding: 30px 0;\r\n      margin: 20px auto;\r\n      font-family: arial, sans-serif;\r\n      font-size: 13px;\r\n    }\r\n\r\n    .esriCTReportBar {\r\n      width: 100%;\r\n      position: fixed;\r\n      left: 0;\r\n      top: 0;\r\n      z-index: 6;\r\n      height: 50px;\r\n      background: #e2f1fc;\r\n      border-bottom: 1px solid #000;\r\n    }\r\n\r\n    .jimu-rtl .esriCTReportBar {\r\n      left: inherit;\r\n      right: 0;\r\n    }\r\n\r\n    .esriCTPrintButton,\r\n    .esriCTCloseButton {\r\n      color: #444;\r\n      font-family: Verdana, Helvetica, sans-serif;\r\n      font-size: 12px;\r\n      -moz-border-radius: 3px;\r\n      -webkit-border-radius: 3px;\r\n      border-radius: 3px;\r\n      border: 1px solid #8b8b8b;\r\n      box-shadow: none;\r\n      -webkit-box-shadow: none;\r\n      background: #F2F2F2;\r\n      background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI2ZmZmZmZiIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNlNWU1ZTUiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+);\r\n      background: -moz-linear-gradient(top, #F2F2F2 0%, #D1D1D1 100%);\r\n      background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #F2F2F2), color-stop(100%, #D1D1D1));\r\n      background: -webkit-linear-gradient(top, #F2F2F2 0%, #D1D1D1 100%);\r\n      background: -o-linear-gradient(top, #F2F2F2 0%, #D1D1D1 100%);\r\n      background: -ms-linear-gradient(top, #F2F2F2 0%, #D1D1D1 100%);\r\n      background: linear-gradient(to bottom, #F2F2F2 0%, #D1D1D1 100%);\r\n      filter: progid: DXImageTransform.Microsoft.gradient(startColorstr\x3d\'#F2F2F2\', endColorstr\x3d\'#D1D1D1\', GradientType\x3d0);\r\n      margin: 10px 20px;\r\n      line-height: 16px;\r\n      display: block;\r\n      padding: 5px 10px;\r\n      outline: 0;\r\n      text-decoration: none;\r\n      cursor: pointer;\r\n      font-weight: 400;\r\n      white-space: nowrap;\r\n      float: right;\r\n    }\r\n\r\n    .jimu-rtl .esriCTPrintButton,\r\n    .jimu-rtl .esriCTCloseButton {\r\n      float: left;\r\n    }\r\n\r\n    .esriCTPrintButton:hover,\r\n    .esriCTPrintButton:focus,\r\n    .esriCTCloseButton:hover,\r\n    .esriCTCloseButton:focus {\r\n      background: #E5E6E6;\r\n      background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI2ZmZmZmZiIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNlNWU1ZTUiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+);\r\n      background: -moz-linear-gradient(top, #E5E6E6 0%, #A0A1A1 100%);\r\n      background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #E5E6E6), color-stop(100%, #A0A1A1));\r\n      background: -webkit-linear-gradient(top, #E5E6E6 0%, #A0A1A1 100%);\r\n      background: -o-linear-gradient(top, #E5E6E6 0%, #A0A1A1 100%);\r\n      background: -ms-linear-gradient(top, #E5E6E6 0%, #A0A1A1 100%);\r\n      background: linear-gradient(to bottom, #E5E6E6 0%, #A0A1A1 100%);\r\n      filter: progid: DXImageTransform.Microsoft.gradient(startColorstr\x3d\'#E5E6E6\', endColorstr\x3d\'#A0A1A1\', GradientType\x3d0);\r\n    }\r\n\r\n    .esriCTReportHeader {\r\n      display: block;\r\n      width: 100%;\r\n      height: 60px;\r\n      border-bottom: 1px solid #000;\r\n      margin-bottom: 5px;\r\n      position: relative;\r\n    }\r\n\r\n    .esriCTReportBarMsg {\r\n      text-align: center;\r\n      margin-top: 16px;\r\n    }\r\n\r\n    .jimu-rtl .esriCTReportBarMsg {\r\n      direction: rtl;\r\n    }\r\n\r\n    .esriCTNotesContainer {\r\n      width: 100%;\r\n      margin-top: 30px;\r\n    }\r\n\r\n    .esriCTReportNotes {\r\n      resize: none;\r\n      width: calc(100% - 5px);\r\n      max-width: calc(100% - 5px);\r\n      font-family: "Arial";\r\n      font-size: 13px;\r\n      border: 1px solid gray;\r\n      overflow-y: hidden;\r\n      /* prevents scroll bar flash */\r\n    }\r\n\r\n    .esriCTReportNotesParagraph {\r\n      display: none;\r\n      white-space: pre-wrap;\r\n      word-wrap: break-word;\r\n    }\r\n\r\n    .jimu-rtl .esriCTReportNotesParagraph {\r\n      float: right;\r\n      direction: rtl;\r\n    }\r\n\r\n    .jimu-rtl .esriCTReportNotes {\r\n      direction: rtl;\r\n    }\r\n\r\n    .esriCTHidden {\r\n      display: none;\r\n    }\r\n  \x3c/style\x3e\r\n  \x3c!-- Media print css --\x3e\r\n  \x3cstyle type\x3d"text/css" media\x3d"print"\x3e\r\n    .esriCTPrintPage {\r\n      padding: 0;\r\n      color: #000;\r\n      margin: 0;\r\n      float: none;\r\n      background: #fff url(none);\r\n    }\r\n\r\n    .esriCTTable {\r\n      page-break-inside: avoid;\r\n      border-collapse: collapse;\r\n      border-spacing: 0;\r\n    }\r\n\r\n    .esriCTPageBreak {\r\n      page-break-after: always;\r\n    }\r\n\r\n    .esriCTReportFooter {\r\n      font-size: 75%;\r\n    }\r\n\r\n    .esriCTReportBar {\r\n      display: none;\r\n    }\r\n\r\n    .esriCTReportMain {\r\n      border: none;\r\n    }\r\n\r\n    .esriCTReportMapImg {\r\n      box-shadow: none;\r\n      border: none;\r\n    }\r\n\r\n    .esriCTReportNotes {\r\n      display: none;\r\n    }\r\n\r\n    .esriCTReportNotesParagraph {\r\n      display: block;\r\n    }\r\n\r\n    .esriCTHideReportNotes {\r\n      display: none;\r\n    }\r\n\r\n    .esriCTTable th {\r\n      border: 1px solid gray;\r\n    }\r\n\r\n    .esriCTTable td {\r\n      border: 1px solid gray;\r\n    }\r\n\r\n    .esriCTTable tr {\r\n      page-break-inside: avoid;\r\n      page-break-after: auto;\r\n    }\r\n\r\n  \x3c/style\x3e\r\n  \x3cscript\x3e\r\n    function showError(evt) {\r\n      alert(document.getElementById(\'showErrorButton\').innerHTML);\r\n    }\r\n  \x3c/script\x3e\r\n\x3c/head\x3e\r\n\r\n\x3cbody id\x3d"reportBody" class\x3d"esriCTPrintPage"\x3e\r\n  \x3cbutton id\x3d"showErrorButton" style\x3d"display: none" onclick\x3d"showError()"\x3e\x3c/button\x3e\r\n  \x3cdiv class\x3d"esriCTReportBar"\x3e\r\n    \x3cdiv id\x3d"closeButton" class\x3d"esriCTCloseButton" title\x3d"Close" onclick\x3d"window.close();"\x3eClose\x3c/div\x3e\r\n    \x3cdiv id\x3d"printButton" class\x3d"esriCTPrintButton" title\x3d"Print" onclick\x3d"onPrintButtonClicked();"\x3ePrint\x3c/div\x3e\r\n    \x3cdiv id\x3d"reportBarMsg" class\x3d"esriCTReportBarMsg"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv id\x3d"reportMain" class\x3d"esriCTReportMain"\x3e\r\n    \x3cdiv id\x3d"reportHeader" class\x3d"esriCTReportHeader"\x3e\r\n      \x3cimg id\x3d"reportLogo" class\x3d"esriCTReportLogo esriCTHidden" src\x3d""\x3e\r\n      \x3cdiv id\x3d"printTitleDiv" class\x3d"esriCTPrintTitleDiv"\x3e\r\n        \x3cinput id\x3d"reportTitle" type\x3d"text" class\x3d"esriCTInputTitle" tabindex\x3d"0" role\x3d"textbox"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"reportData"\x3e\x3c/div\x3e\r\n    \x3cdiv id\x3d"footNotes" class\x3d"esriCTReportFooter"\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/body\x3e\r\n\r\n\x3c/html\x3e',
"url:dijit/templates/ProgressBar.html":'\x3cdiv class\x3d"dijitProgressBar dijitProgressBarEmpty" role\x3d"progressbar"\r\n\t\x3e\x3cdiv  data-dojo-attach-point\x3d"internalProgress" class\x3d"dijitProgressBarFull"\r\n\t\t\x3e\x3cdiv class\x3d"dijitProgressBarTile" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\x3e\x3cspan style\x3d"visibility:hidden"\x3e\x26#160;\x3c/span\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"labelNode" class\x3d"dijitProgressBarLabel" id\x3d"${id}_label"\x3e\x3c/div\r\n\t\x3e\x3cspan data-dojo-attach-point\x3d"indeterminateHighContrastImage"\r\n\t\t   class\x3d"dijitInline dijitProgressBarIndeterminateHighContrastImage"\x3e\x3c/span\r\n\x3e\x3c/div\x3e\r\n',
"url:esri/dijit/editing/templates/AttachmentEditor.html":"\x3cdiv class\x3d\"attachmentEditor\"\x3e\r\n    \x3cbr /\x3e\r\n    \x3cdiv\x3e\r\n        \x3cb\x3e${NLS_attachments}\x3c/b\x3e\r\n        \x3chr /\x3e\r\n        \x3cdiv dojoAttachPoint\x3d\"_attachmentError\" style\x3d'color:red;display:none'\x3e\x3c/div\x3e\r\n        \x3cbr /\x3e\r\n        \x3cspan dojoAttachPoint\x3d'_attachmentList' style\x3d'word-wrap: break-word;'\x3e\x3c/span\x3e\r\n        \x3cbr\x3e\x3cbr\x3e\r\n        \x3cdiv data-dojo-type\x3d\"dijit/ProgressBar\" dojoAttachPoint\x3d\"_attachmentProgress\" indeterminate\x3d\"true\" style\x3d'display:none'\x3e\x3c/div\x3e\r\n        \x3cbr /\x3e        \r\n        \x3cform dojoAttachPoint\x3d'_uploadForm'\x3e ${NLS_add}:\x26nbsp;\x26nbsp;\x3cinput type\x3d'file' name\x3d'attachment' dojoAttachPoint\x3d'_uploadField' /\x3e \x3c/form\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e",
"url:esri/dijit/templates/AttributeInspector.html":'\x3cdiv class\x3d"esriAttributeInspector"\x3e\r\n    \x3cdiv class\x3d"atiLayerName" dojoAttachPoint\x3d"layerName"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiAttributes" dojoAttachPoint\x3d"attributeTable"\x3e\x3c/div\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"attachmentEditor"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiEditorTrackingInfo" dojoAttachPoint\x3d"editorTrackingInfoDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiButtons" dojoAttachPoint\x3d"editButtons"\x3e\r\n        \x3cbutton  dojoType\x3d"dijit.form.Button" class\x3d"atiButton atiDeleteButton"  dojoAttachPoint\x3d"deleteBtn" dojoAttachEvent\x3d"onClick: onDeleteBtn" showLabel\x3d"true" type\x3d"button"\x3e${NLS_deleteFeature}\x3c/button\x3e\r\n        \x3cdiv class\x3d"atiNavButtons" dojoAttachPoint\x3d"navButtons"\x3e\r\n            \x3cdiv class\x3d"atiNavMessage" dojoAttachPoint\x3d"navMessage"\x3e\x3c/div\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiFirstIcon" dojoAttachPoint\x3d"firstFeatureButton" dojoAttachEvent\x3d"onClick: onFirstFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_first}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiPrevIcon" dojoAttachPoint\x3d"prevFeatureButton" dojoAttachEvent\x3d"onClick: onPreviousFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_previous}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiNextIcon" dojoAttachPoint\x3d"nextFeatureButton" dojoAttachEvent\x3d"onClick: onNextFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_next}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiLastIcon" dojoAttachPoint\x3d"lastFeatureButton" dojoAttachEvent\x3d"onClick: onLastFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_last}\x3c/button\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/SituationAwareness/js/PropertyHelper.html":'\x3cdiv\x3e  \r\n  \x3cdiv class\x3d"jimu-r-row"\x3e\r\n    \x3ctable class\x3d"width-all"\x3e\r\n      \x3c!--name--\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"nameRow"\x3e\r\n        \x3ctd class\x3d"col-1-2"\x3e\r\n          \x3cspan class\x3d"label" data-dojo-attach-point\x3d"nameSpan"\x3e\x3c/span\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"col-1-2"\x3e\r\n          \x3cinput class\x3d"width-all" data-dojo-attach-point\x3d"snapshotName" data-dojo-type\x3d"dijit/form/ValidationTextBox" /\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3c!--share--\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"shareRow"\x3e\r\n        \x3ctd class\x3d"width-all pad-top-10"\x3e\r\n          \x3cspan class\x3d"hintText"\x3e${nls.select_group_instruction}\x3c/span\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"col-1-2 pad-top-10"\x3e\r\n          \x3cspan class\x3d"label" data-dojo-attach-point\x3d"shareSpan"\x3e\x3c/span\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"col-1-2 pad-top-10"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"shareSelect"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3c!--orientation--\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"orientationRow"\x3e\r\n        \x3ctd class\x3d"col-1-2 pad-top-10"\x3e\r\n          \x3cspan class\x3d"label" data-dojo-attach-point\x3d"orientationSpan"\x3e${nls.orientation}:\x3c/span\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"col-1-2 pad-top-10"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"orientationSelect"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3c!--page size--\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"pageSizeRow"\x3e\r\n        \x3ctd class\x3d"col-1-2 pad-top-10"\x3e\r\n          \x3cspan class\x3d"label" data-dojo-attach-point\x3d"pageSizeSpan"\x3e${nls.pageSize}:\x3c/span\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"col-1-2 pad-top-10"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"pageSizeSelect"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3c!--comments--\x3e\r\n  \x3cdiv class\x3d"display-off pad-top-10" data-dojo-attach-point\x3d"commentsRow"\x3e\r\n    \x3cdiv class\x3d"jimu-r-row pad-top-5"\x3e\r\n      \x3cdiv class\x3d"jimu-r-row"\x3e\r\n        \x3cspan class\x3d"label" data-dojo-attach-point\x3d"commentsSpan"\x3e${nls.comments}:\x3c/span\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"jimu-r-row pad-top-5"\x3e\r\n      \x3ctextarea aria-label\x3d"${nls.comments}" class\x3d"commentTextArea" data-dojo-attach-point\x3d"commentTextArea" rows\x3d"5"\x3e\x3c/textarea\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"snapshot-name-footer jimu-float-trailing pad-top-10"\x3e\r\n    \x3cdiv role\x3d"button" tabindex\x3d"-1" class\x3d"jimu-btn ok pad-right-5 jimu-state-disabled" data-dojo-attach-point\x3d"btnOk"\x3e\x3c/div\x3e\r\n    \x3cdiv role\x3d"button" tabindex\x3d"0" class\x3d"jimu-btn cancel" data-dojo-attach-point\x3d"btnCancel"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/SituationAwareness/Widget.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"panelBottom" class\x3d"panelBottom"\x3e\r\n\r\n    \x3c!-- Panel Footer --\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"footerNode" class\x3d"SA_panelFooter dart-bgcolor box-bgcolor jimu-main-background"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"panelLeft" class\x3d"SA_panelLeft" data-dojo-attach-event\x3d"onclick:_navTabsLeft"\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"footerContentNode" class\x3d"SA_panelFooterContent"\x3e\r\n        \x3c!-- Tabs --\x3e\r\n        \x3cdiv role\x3d"tablist" data-dojo-attach-point\x3d"tabsNode" class\x3d"SA_SAT_tabs"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"panelRight" class\x3d"SA_panelRight" data-dojo-attach-event\x3d"onclick:_navTabsRight"\x3e\x3c/div\x3e\r\n      \x3cdiv role\x3d"button" data-dojo-attach-point\x3d"closeButton" tabindex\x3d"-1" class\x3d"SA_panelClose" data-dojo-attach-event\x3d"onclick:_close"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3c!--Panel Container --\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"panelContainer" class\x3d"panelContainer dart-bgcolor box-bgcolor jimu-main-background"\x3e\r\n      \x3c!-- Panel Incident --\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"innerBL" class\x3d"innerBL" data-dojo-attach-event\x3d"onclick:_navLeft"\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"SA_tabPanel0" role\x3d"tabpanel" class\x3d"SAT_tabPanel"\x3e\r\n        \x3cdiv class\x3d"SAT_tabPanelContent" style\x3d"min-width: 650px"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"incidentsLocate" class\x3d"SATcolLocate" style\x3d"width:auto; min-width:220px"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"locateIncident" class\x3d"label locateIncident"\x3e\x3c/div\x3e\r\n            \x3cdiv role\x3d"button" aria-label\x3d"${nls.clearIncident}" tabindex\x3d"0" data-dojo-attach-point\x3d"clearIncident"\r\n              class\x3d"label clearIncident" data-dojo-attach-event\x3d"onclick:_clear"\x3e\r\n              ${nls.clearIncident}\r\n            \x3c/div\x3e\r\n            \x3cbr /\x3e\r\n            \x3cdiv class\x3d"locateIncidentContainer"\x3e\r\n              \x3cdiv class\x3d"colBar SATdrawCol"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"imgContainer" class\x3d"imgContainer"\x3e\r\n                  \x3cspan class\x3d"btn32 displayTC"\x3e \x3cdiv role\x3d"button" tabindex\x3d"0" class\x3d"btn32img"\r\n                      data-dojo-attach-point\x3d"SA_btn0"\x3e \x3c/div\x3e \x3c/span\x3e\r\n                  \x3cspan class\x3d"btn32 displayTC"\x3e \x3cdiv role\x3d"button" tabindex\x3d"0" class\x3d"btn32img"\r\n                      data-dojo-attach-point\x3d"SA_btn1"\x3e \x3c/div\x3e \x3c/span\x3e\r\n                  \x3cspan class\x3d"btn32 displayTC"\x3e \x3cdiv role\x3d"button" tabindex\x3d"0" class\x3d"btn32img"\r\n                      data-dojo-attach-point\x3d"SA_btn2"\x3e \x3c/div\x3e \x3c/span\x3e\r\n                \x3c/div\x3e\r\n              \x3c/div\x3e\r\n              \x3cdiv class\x3d"bufferIncidentContainer"\x3e\r\n                \x3cdiv class\x3d"bufferControlsContainer"\x3e\r\n                  \x3cdiv data-a11y-label-id\x3d"spinnerValue" data-dojo-attach-point\x3d"buffer_lbl" class\x3d"label bufferLabel"\x3e\x3c/div\x3e\r\n                  \x3cdiv class\x3d"spinnerValueDIV"\x3e\r\n                    \x3cinput data-a11y-label-by\x3d"spinnerValue" role\x3d"button" role\x3d"textbox" tabindex\x3d"0" data-dojo-attach-point\x3d"spinnerValue"\r\n                      data-dojo-type\x3d"dijit/form/NumberSpinner" class\x3d"spinnerValue" name\x3d"spinnerValue" /\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"buffer_lbl_unit" class\x3d"label bufferUnit"\x3e\x3c/div\x3e\r\n                  \x3c/div\x3e\r\n                \x3c/div\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"saveOptions" class\x3d"SATcol2"\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"borderCol" class\x3d"borderCol display-off"\x3e\x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"div_reverse_geocoding" class\x3d"SATcol reverseGeocodingDIV"\x3e\r\n            \x3cdiv class\x3d"label"\x3e\r\n              ${nls.reverse_geocoded_address}\r\n            \x3c/div\x3e\r\n            \x3c/br\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"div_reversed_address" class\x3d"label reversedAddressDIV"\x3e\x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"innerBR" class\x3d"innerBR" data-dojo-attach-event\x3d"onclick:_navRight"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Panel Message --\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"messageNode" class\x3d"SA_panelMessage"\x3e\r\n      \x3cspan data-dojo-attach-point\x3d"messageTextNode"\x3e\x3c/span\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/SituationAwareness/css/style.css":".jimu-widget-SAT {color: #ffffff !important; background-color: #4c4c4c; left: 0px; right: 0px; bottom: 0px; height: 155px !important; display: block; z-index: 100 !important;}.action2 {padding-left: 10px;}.jimu-widget-SAT .innerBL {display: none; width: 10px; height: 20px; background-image: url('images/nav_left.png'); background-repeat: no-repeat; background-size:cover; position: fixed; bottom: 45px; left: 0px; z-index: 2; background-size:cover; opacity: .6;}.jimu-rtl .jimu-widget-SAT .innerBL {right: 0px;}.jimu-widget-SAT .innerBL:hover {width: 20px; height: 35px; opacity: 1; cursor: pointer; bottom: 30px;}.jimu-widget-SAT .innerBR {display: none; width: 10px; height: 20px; background-image: url('images/nav_right.png'); background-repeat: no-repeat; background-size:cover; position: fixed; bottom: 45px; right: 0px; z-index: 2; opacity: .6;}.jimu-rtl .jimu-widget-SAT .innerBR {left: 0px;}.jimu-widget-SAT .innerBR:hover {width: 20px; height: 35px; opacity: 1; cursor: pointer; bottom: 30px;}.jimu-widget-SAT .rounded {-moz-border-radius: 5px 5px 5px 5px; -webkit-border-radius: 5px 5px 5px 5px; border-radius: 5px 5px 5px 5px;}.jimu-widget-SAT .roundedL {-moz-border-radius: 5px 0px 0px 5px; -webkit-border-radius: 5px 0px 0px 5px; border-radius: 5px 0px 0px 5px;}.jimu-widget-SAT .roundedR {-moz-border-radius: 0px 5px 5px 0px; -webkit-border-radius: 0px 5px 5px 0px; border-radius: 0px 5px 5px 0px;}.jimu-widget-SAT .reversedAddressDIV {width:100%;}.jimu-widget-SAT .spinnerValue {width: 80px; align: left;}.jimu-widget-SAT .panelBottom {position: absolute; width: 100%; height: 155px; left: 0px; top: 0px; text-align: center; color: #ffffff; padding: 0px;}.jimu-widget-SAT .SA_panelMessage {position: absolute; top: 0px; text-align: center; width: 100%; height: 40px; line-height: 40px; display: none;}.jimu-widget-SAT .SA_panelFooter {position: absolute; top: 0px; left: 0px; right: 0px; height: 30px; line-height: 30px; overflow: hidden; border-bottom: 1px solid #353535; border-bottom: 1px solid rgba(0, 0, 0, 0.3);}.jimu-widget-SAT .SA_panelFooterContent {position: absolute; left: 0px; right: 24px; height: 30px; overflow-x: hidden; overflow-y: hidden; display: block;}.jimu-rtl .jimu-widget-SAT .SA_panelFooterContent {position: absolute; left: 24px; right: 0px;}.jimu-widget-SAT .SA_panelClose {position: absolute; left: auto; right: 0px; width: 24px; height: 30px; line-height: 30px; text-align: center; display: block; cursor: pointer; background-image: url('images/x.png'); background-repeat: no-repeat; background-position: center center; background-size: 12px;}.jimu-widget-SAT .SA_panelRight {display: none; position: absolute; left: auto; right: 24px; width: 34px; height: 30px; line-height: 30px; cursor: pointer; background-image: url('images/nav_right.png'); background-repeat: no-repeat; background-position: center center; background-size: 10px; opacity: .4;}.jimu-widget-SAT .SA_panelRight:hover {opacity: 1; background-size: 16px;}.jimu-rtl .jimu-widget-SAT .SA_panelRight {right: 0px; left: auto; width: 0px;}.jimu-widget-SAT .SA_panelLeft {display: none; position: absolute; left: 0px; right: auto; height: 30px; line-height: 30px; cursor: pointer; background-image: url('images/nav_left.png'); background-repeat: no-repeat; background-position: center center; background-size: 10px; opacity: .4;}.jimu-rtl .jimu-widget-SAT .SA_panelLeft {left: 24px; width: 34px; right: auto;}.jimu-widget-SAT .SA_panelLeft:hover {opacity: 1; background-size: 16px;}.jimu-rtl .jimu-widget-SAT .SA_panelClose {position: absolute; left: 0px; right: auto;}.jimu-widget-SAT .panelContainer {position: absolute; top: 30px; width: 100%; height: 125px; overflow: hidden; display: block;}.jimu-widget-SAT .SAT_tabPanel {position: absolute; top: 10px; left: 0px; right: 0px; height: 115px; display: none; overflow: auto;}.jimu-widget-SAT .SAT_tabPanelContent {position: absolute; top: 0px; height: 100px; white-space: nowrap; display: block; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none;}.jimu-widget-SAT .locateIncidentContainer {display: flex; float: left; margin-top: 20px;}.jimu-rtl .jimu-widget-SAT .locateIncidentContainer {display: flex; float: right; margin-top: 20px;}.jimu-widget-SAT .bufferIncidentContainer {display: table-cell;}.jimu-widget-SAT .bufferControlsContainer {float: left; padding-left: 20px;}.jimu-widget-SAT .SA_SAT_tabs {white-space: nowrap; height: 30px; padding: 0px; overflow-x: visible; overflow-y: hidden;}@supports (-ms-ime-align:auto) {.SA_SAT_tabs {position: absolute; white-space: nowrap; height: 30px; padding: 0px; overflow-x: visible; overflow-y: hidden;}} _:-ms-fullscreen, :root .SA_SAT_tabs {position: absolute; white-space: nowrap; height: 30px; padding: 0px; overflow-x: visible; overflow-y: hidden;}.jimu-widget-SAT .SATTab {width: auto; max-width: 220px; overflow: hidden; text-overflow: ellipsis; height: 30px; float: left; line-height: 30px; font-size: 13px; padding: 0 30px 0 30px; cursor: pointer; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; opacity: .85; border-right: 1px solid #d2dae2; border-top: 2px solid transparent;}.jimu-widget-SAT .active .SATTab:focus {border-top: 2px solid #15a4fa; opacity: 1;}.jimu-rtl .jimu-widget-SAT .SATTab {float: right;}.jimu-widget-SAT .active {background-color: #353535; background-color: rgba(0, 0, 0, 0.3); opacity: 1; border-top: 2px solid #15a4fa;}.jimu-widget-SAT .activeBlack {background-color: #353535; opacity: 1; border-top: 2px solid #15a4fa;}.jimu-widget-SAT .SATcol {float: left; height: 100px; width: 220px; border-left: none; margin-left: 0; padding: 0 10px; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; overflow: hidden;}.jimu-rtl .jimu-widget-SAT .SATcol {float: right; border-right: none; overflow: hidden;}.jimu-widget-SAT .SATcolExport {float: left; height: 100px; width: 65px; border-left: none; margin-left: 0; padding: 0 10px; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; overflow: hidden;}.jimu-rtl .jimu-widget-SAT .SATcolExport {float: right; border-right: none; overflow: hidden;}.jimu-widget-SAT .lightThemeBorder{border-right: 1px solid #353535; border-right: 1px solid rgba(0, 0, 0, 0.3);}.jimu-widget-SAT .darkThemeBorder{border-right: 1px solid #ffffff; border-right: 1px solid rgba(255, 255, 255, 0.5);}.jimu-rtl .jimu-widget-SAT .lightThemeBorder{border-left: 1px solid #353535; border-left: 1px solid rgba(0, 0, 0, 0.3);}.jimu-rtl .jimu-widget-SAT .darkThemeBorder{border-left: 1px solid #ffffff; border-left: 1px solid rgba(255, 255, 255, 0.5);}.jimu-widget-SAT .SATcolLocate {float: left; height: 100px; width: 220px; border-left: none; margin-left: 0; padding: 0 30px; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; overflow: hidden;}.jimu-rtl .jimu-widget-SAT .SATcolLocate {float: right; border-right: none; overflow: hidden;}.jimu-widget-SAT .SATcolWrap {white-space: pre-wrap; white-space: -moz-pre-wrap; word-wrap: break-word;}.jimu-widget-SAT .SATcol2 {float: left; height: 100px; border-left: none; margin-left: 5px; padding: 0 10px; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; overflow: hidden; display: table;}.jimu-rtl .jimu-widget-SAT .SATcol2 {float: right; border-right: none; overflow: hidden; margin-right: 5px;}.jimu-widget-SAT .borderCol {height: 100px; float: left;}.jimu-rtl .jimu-widget-SAT .borderCol {float: right; border-right: none;}.jimu-widget-SAT .SATcolSmall {float: left; height: 90px; width: 165px; border-left: none; margin-left: 0; padding: 0 20px; overflow: hidden; text-overflow: ellipsis;}.jimu-rtl .jimu-widget-SAT .SATcolSmall {float: right; border-right: none;}.jimu-widget-SAT .SATcolLast {border-left: none; border-right: none;}.jimu-widget-SAT .SATcol .label,.jimu-widget-SAT .SATcolSmall .label {font-size: 13px; padding: 2px 0;}.jimu-widget-SAT .SATcol .colBar {height: 32px; display: table-cell; width: 130px;}.jimu-widget-SAT .SATdrawCol {display: block; float: left;}.jimu-rtl .jimu-widget-SAT .SATdrawCol {display: block; float: right;}.jimu-widget-SAT .displayTC{display: table-cell;}.jimu-widget-SAT .displayTR{display: table-row;}.jimu-widget-SAT .displayT{display: table;}.jimu-widget-SAT .display-on{display: block;}.jimu-widget-SAT .display-off{display: none;}.jimu-widget-SAT .btnOn {border: 1px solid #ffffff; border: 1px solid rgba(255, 255, 255, 0.75); background-color: #262626; background-color: rgba(0, 0, 0, 0.5);}.jimu-widget-SAT .btn32 {width: 32px; height: 32px; border-radius: 2px; margin-right: 5px; cursor: pointer;}.jimu-widget-SAT .btn32img {padding: 8px; height: 32px; width: 32px; background-repeat: no-repeat; background-position: center;}.jimu-widget-SAT .lightThemeBackground{background-color: #353535; background-color: rgba(0, 0, 0, 0.3);}.jimu-widget-SAT .darkThemeBackground{}.jimu-widget-SAT .btn32img:hover {background-color: #262626; background-color: rgba(0, 0, 0, 0.5);}.jimu-widget-SAT .btn32imgBlack {padding: 8px; height: 32px; width: 32px; background-repeat: no-repeat; background-position: center;}.jimu-widget-SAT .btn32imgBlack:hover {background-color: #262626;}.jimu-widget-SAT .dijitTextBox,.jimu-widget-SAT .dijitTextBoxHover,.jimu-widget-SAT .dijitTextBoxFocused,.jimu-widget-SAT .dijitTextBoxHoverFocused {background-color: #393939; background-color: rgba(0, 0, 0, 0.25) !important; color: #ffffff !important; border: 1px solid #a6a6a6; border: 1px solid rgba(255, 255, 255, 0.5) !important; height: 26px !important; line-height: 26px !important;}.jimu-widget-SAT .dijitInputInner,.jimu-widget-SAT .dijitInputContainer {background: transparent !important; color: #ffffff !important; height: 26px !important; line-height: 26px !important;}.jimu-widget-SAT .dijitInputField {padding: 0px 10px !important;}.jimu-widget-SAT .btnExport {border-radius: 2px; padding: 10px 10px 10px 10px; background-image: url('images/download.png'); background-repeat: no-repeat; background-position: right center; cursor: pointer; height: 40px;}.jimu-widget-SAT .btnExport:hover {background-color: #262626; background-color: rgba(0, 0, 0, 0.5);}.jimu-widget-SAT .btnExport:focus, .jimu-widget-SAT .directionsButton:focus {outline: #15a4fa solid 2px !important; outline-offset: -2px;}.jimu-widget-SAT .btnExportBlack {border-radius: 2px; padding: 10px 10px 10px 10px; background-image: url('images/download.png'); background-repeat: no-repeat; background-position: right center; cursor: pointer; height: 40px;}.jimu-widget-SAT .btnExportBlack:hover {background-color: #262626;}.jimu-widget-SAT .download {background-image: url('images/download.png'); background-repeat: no-repeat; background-position: right 0px center;}.jimu-widget-SAT .processing {background-image: url('images/processing.gif'); background-repeat: no-repeat; background-position: right 10px center;}.jimu-widget-SAT .loading {background-image: url('images/loading.gif'); background-repeat: no-repeat; background-position: center 10px;}.jimu-widget-SAT .btnDisabled {opacity: .5; cursor: default;}.jimu-widget-SAT .colSummary {font-size: 28px; padding-top: 10px;}.jimu-widget-SAT .colGroupedSummary {font-size: 28px; padding-top: 3px;}.jimu-widget-SAT .SATcolRec {float: left; height: 100%; border-left: none; margin-left: 0; padding: 0 10px; text-align: left; text-overflow: ellipsis; user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none; -o-user-select: none; min-width: 220px; max-width: 300px;}.jimu-rtl .jimu-widget-SAT .SATcolRec {float: right; border-right: none; text-align: right;}.jimu-widget-SAT .SATcolRecBar {position: relative; height: 26px; width: 100%; display: block;}.jimu-widget-SAT .SATcolRecNum {position: absolute; width: 26px; height: 26px; background-color: #393939; background-color: rgba(0, 0, 0, 0.25); line-height: 26px; text-align: center; border-radius: 13px; font-size: 11px; cursor: pointer;}.jimu-widget-SAT .SATcolRecNum:focus{outline: #15a4fa solid 2px !important; outline-offset: -2px;}.jimu-widget-SAT .SATcolDir {position: absolute; right: 0px; width: 26px; height: 26px; background-image: url('images/car.png'); background-repeat: no-repeat; background-position: center center; cursor: pointer;}.jimu-rtl .jimu-widget-SAT .SATcolDir {position: absolute; left: 0px; right: auto;}.jimu-widget-SAT .SATcolDistance {position: absolute; left: 30px; right: 30px; height: 26px; font-size: 11px; line-height: 26px;}.jimu-widget-SAT .SATcolInfo {position: relative; margin-top: 5px; width: 100%; display: block; overflow: hidden;}.jimu-widget-SAT .noFeaturesActive {opacity: .5; cursor: default;}.jimu-widget-SAT .noFeatures {display: none;}.jimu-widget-SAT .locateIncident{float: left;}.jimu-rtl .jimu-widget-SAT .locateIncident{float: right;}.jimu-widget-SAT .clearIncident{float: right; text-decoration: underline; cursor: pointer;}.jimu-rtl .jimu-widget-SAT .clearIncident{float: left; text-decoration: underline; cursor: pointer;}.jimu-widget-SAT .imgContainer{display: table; width: 130px; padding-top: 10px;}.jimu-widget-SAT .bufferLabel{}.jimu-widget-SAT .spinnerValueDIV{float: right; margin-top: 8px; margin-left: 4px; display: table-row;}.jimu-rtl .jimu-widget-SAT .spinnerValueDIV{float: left; margin-top: 8px; margin-right: 4px; display: table-row;}.jimu-widget-SAT .bufferUnit{display: inline; margin-left: 4px; margin-top: 7px;}.jimu-widget-SAT .saveIncidentDiv{position: absolute; top: 0px; left: 270px; line-height: 26px; font-size: 13px;}.jimu-rtl .jimu-widget-SAT .saveIncidentDiv{position: absolute; top: 0px; right: 270px; line-height: 26px; font-size: 13px;}.jimu-widget-SAT .downlaodAllDiv{position: absolute; top: 35px; left: 270px; line-height: 26px; font-size: 13px;}.jimu-rtl .jimu-widget-SAT .downlaodAllDiv{position: absolute; top: 35px; right: 270px; line-height: 26px; font-size: 13px;}.jimu-widget-SAT .createSnapshotDiv{position: absolute; top: 70px; left: 270px; line-height: 26px; font-size: 13px;}.jimu-rtl .jimu-widget-SAT .createSnapshotDiv{position: absolute; top: 70px; right: 270px; line-height: 26px; font-size: 13px;}.jimu-widget-SAT .pad-top-5{padding-top: 5px;}.jimu-widget-SAT .pad-top-10{padding-top: 10px;}.jimu-popup .SAT-warning-icon {width: 25px; height: 25px; position: relative; background-size: contain; background-repeat: no-repeat; background-image: url('../images/warning.png'); margin-top: 8px;}.jimu-popup .SAT-warning-hint {color: #898989; font-size: 11px; margin-bottom: 10px;}.jimu-widget-SAT-property-helper .pad-top-5{padding-top: 5px;}.jimu-widget-SAT-property-helper .pad-top-10{padding-top: 10px;}.jimu-widget-SAT-property-helper .pad-right-5{padding-right: 5px;}.jimu-rtl .jimu-widget-SAT-property-helper .pad-right-5{padding-left: 5px;}.jimu-widget-SAT-property-helper .commentTextArea{width: 100%;}.jimu-widget-SAT-property-helper .width-all{width: 100%;}.jimu-widget-SAT-property-helper .display-on{display: block;}.jimu-widget-SAT-property-helper .display-off{display: none;}.jimu-widget-SAT-property-helper .dijitSelectLabel {text-align: left; text-overflow: ellipsis; overflow: hidden; max-width: 153px;}@media screen and (max-width: 420px ) {.jimu-widget-SAT-property-helper .dijitSelectLabel {max-width: 133px;}}@media screen and (max-width: 400px ) {.jimu-widget-SAT-property-helper .dijitSelectLabel {max-width: 113px;}}@media screen and (max-width: 360px ) {.jimu-widget-SAT-property-helper .dijitSelectLabel {max-width: 105px;}}@media screen and (max-width: 320px) {.jimu-widget-SAT-property-helper .dijitSelectLabel {max-width: 87px;}}.jimu-widget-SAT-property-helper .hintText {font-size: 12px; color: #a0acbf; font-style: oblique;}.esriMobileInfoViewItem .esriAttributeInspector .esriCTAIDeleteButtonWidth {width: 60px !important; background-image: none !important;}.jimu-rtl .esriMobileInfoViewItem .esriAttributeInspector .atiDeleteButton {float: right;}.jimu-widget-SAT-ai .esriAttributeInspector .atiRichTextField{}.jimu-widget-SAT-ai .esriAttributeInspector div.dijitEditorIFrameContainer {height: 78px; width: 100%;}.jimu-widget-SAT-ai .esriAttributeInspector .dijitTextBox.dijitTextArea {height: 32px;}.jimu-widget-SAT-ai .esriAttributeInspector .atiButton {padding-top:2px; margin-right: 10px; display: inline-table; background-image: none;}.jimu-widget-SAT-ai .esriAttributeInspector .atiButtons {height:30px; width:100%; display:inline-block; width:100%;}.jimu-widget-SAT-ai .esriAttributeInspector {display:inline-block;}.jimu-widget-SAT-ai .esriAttributeInspector .dijitArrowButtonContainer {margin-top:0px; margin-right:0px; margin-bottom:0px; width:18px;}.jimu-widget-SAT-ai .esriAttributeInspector .atiNavButtons {display:none; visibility:hidden; height: 0px;}.jimu-widget-SAT-ai .esriPopup .spinner {display: none;}.DashboardTheme.light .jimu-widget-SAT .panelBottom {color: #000000 !important;}",
"*now":function(Q){Q(['dojo/i18n!*preload*widgets/SituationAwareness/nls/Widget*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare dijit/_WidgetsInTemplateMixin dijit/form/Button jimu/BaseWidget jimu/dijit/Message jimu/utils jimu/accessibleUtils jimu/LayerInfos/LayerInfos jimu/portalUtils jimu/dijit/Report jimu/dijit/PageUtils dojo/_base/Color dojo/_base/html dojo/dom dojo/on dojo/dom-style dojo/dom-class dojo/dom-construct dojo/dom-attr dojo/dom-geometry dojo/_base/lang dojo/_base/array dojo/_base/xhr dojo/query dojo/json dojo/topic dojo/aspect dojo/Deferred dojo/DeferredList dojo/string dojo/colors esri/geometry/geometryEngine esri/geometry/Point esri/geometry/webMercatorUtils esri/tasks/ProjectParameters esri/geometry/jsonUtils esri/graphic esri/graphicsUtils esri/geometry/geodesicUtils esri/Color esri/layers/GraphicsLayer esri/layers/FeatureLayer esri/SpatialReference esri/symbols/Font esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/symbols/SimpleMarkerSymbol esri/symbols/TextSymbol esri/tasks/locator esri/tasks/GeometryService esri/tasks/PrintTemplate esri/tasks/LegendLayer esri/toolbars/draw esri/dijit/AttributeInspector jimu/dijit/Popup esri/tasks/query esri/request esri/lang ./js/SummaryInfo ./js/GroupedCountInfo ./js/ClosestInfo ./js/ProximityInfo ./js/SnapShotUtils ./js/PropertyHelper ./js/analysisUtils dojo/keys esri/dijit/util/busyIndicator dojo/domReady!".split(" "),function(Q,
I,P,V,J,x,n,q,t,v,H,d,b,m,k,e,c,f,A,C,F,z,K,D,h,B,N,E,O,R,a,u,G,l,g,w,M,Y,W,aa,ea,fa,S,T,X,Z,ha,na,ja,oa,ka,pa,ta,xa,Ea,Fa,Ga,Ca,Ha,Ia,Ja,Ka,za,La,Da,qa,Ma){return Q([V,I],{baseClass:"jimu-widget-SAT",name:"IncidentAnalysis",opLayers:null,curTab:0,lyrBuffer:null,lyrIncidents:null,lyrClosest:null,lyrProximity:null,lyrSummary:null,lyrEdit:null,toolbar:null,tool:-1,symPoint:null,symLine:null,symPoly:null,symBuffer:null,symRoute:null,incidents:[],buffers:[],gsvc:null,locator:null,stops:[],initalLayerVisibility:{},
startX:0,mouseDown:!1,btnNodes:[],panelNodes:[],tabNodes:[],currentSumLayer:null,currentGrpLayer:null,mapBottom:null,mapResize:null,geomExtent:void 0,selectedGraphic:!1,honorTemplate:!1,Incident_Local_Storage_Key:"SAT_Incident",SLIDER_MAX_VALUE:1E4,isInitialLoad:!0,busyIndicator:null,postCreate:function(){this.inherited(arguments);this.nls=F.mixin(this.nls,window.jimuNls.units);this.nls=F.mixin(this.nls,window.jimuNls.common);this.widgetActive=this.openAtStartAysn=!0;window.localStorage.setItem(this.Incident_Local_Storage_Key,
null);A.set(this.closeButton,"aria-label",this.nls.close);this.own(k(this.domNode,"keydown",F.hitch(this,function(r){r.keyCode===qa.ESCAPE&&(r.stopPropagation(),this.closeButton.focus())})));this.own(k(this.panelContainer,"keydown",F.hitch(this,function(r){r.keyCode===qa.ESCAPE&&(r.stopPropagation(),D(".SATTab.active",this.domNode)[0].focus())})));this.own(k(this.closeButton,"keydown",F.hitch(this,function(r){if(r.keyCode===qa.ENTER||r.keyCode===qa.SPACE)r.stopPropagation(),this._close()})));x.has("chrome")&&
e.set(this.tabsNode,"position","absolute");this.div_reverse_geocoding&&b.setStyle(this.div_reverse_geocoding,"display","none")},postMixInProperties:function(){this.inherited(arguments);this.isRenderIdForAttrs=!0},startup:function(){this.inherited(arguments);this.updateTabs();this.btnNodes=[];this.panelNodes=[];this.tabNodes=[];this.reportSrc=this.folderUrl+"css/images/report.png";this.saveSrc=this.folderUrl+"css/images/save.png";this.downloadAllSrc=this.folderUrl+"css/images/download_all.png";this.snapshotSrc=
this.folderUrl+"css/images/snapshot.png";this.processingSrc=this.folderUrl+"css/images/processing.gif";this.editTemplate=this.config.editTemplate;this.saveEnabled=this.config.saveEnabled;this.summaryDisplayEnabled=this.config.summaryDisplayEnabled;this.busyIndicator=Ma.create({target:this.domNode,backgroundOpacity:0});this.snapshotEnabled="undefined"!==typeof this.config.snapshotEnabled?this.config.snapshotEnabled:!1;this.reportEnabled="undefined"!==typeof this.config.reportEnabled?this.config.reportEnabled:
!1;this.allEnabled=this.saveEnabled&&this.snapshotEnabled&&this.reportEnabled;this.SLIDER_MAX_VALUE=parseFloat(this.config.bufferRange.maximum.toString().replace(/,/g,""),10);this.SLIDER_MIN_VALUE=parseFloat(this.config.bufferRange.minimum.toString().replace(/,/g,""),10);"undefined"===typeof this.config.bufferRange._default&&(this.config.bufferRange._default=this.config.bufferRange.minimum);this.SLIDER_DEFAULT_VALUE=parseFloat(this.config.bufferRange._default.toString().replace(/,/g,""),10);q.getInstance(this.map,
this.map.itemInfo).then(F.hitch(this,function(r){this.opLayers=r;this._initJimuLayerInfos();this._getStyleColor();this._createUI();this._loadUI();this._initLayers();this._verifyRouting();this._getAttributeTable();this._mapLoaded();setTimeout(F.hitch(this,function(){this.isInitialLoad=!1}),500)}))},_togglePopupClass:function(r){if(this.map.infoWindow&&this.map.infoWindow.domNode&&this.saveEnabled){var y=D(".contentPane",this.map.infoWindow.domNode)[0];y&&(r?c.add:c.remove)(y,"jimu-widget-SAT-ai")}},
updateTabs:function(){if(this.config&&this.config.tabs&&this.config.tabs.length)for(var r=this.config.tabs,y=0;y<r.length;y++){var L=r[y];L.type&&"weather"===L.type&&r.splice(y,1)}},onOpen:function(){this.inherited(arguments);this.widgetActive=!0;this.map.infoWindow.isShowing&&this.map.infoWindow.hide();this.setPosition();this.windowResize=k(window,"resize",F.hitch(this,this._resize));null===this.mapResize&&(this.mapResize=this.map.on("resize",F.hitch(this,this._mapResize)));this._mapResize();this.own(B.subscribe("changeMapPosition",
F.hitch(this,this._onMapPositionChange)));(this.disableVisibilityManagement="undefined"!==typeof this.config.disableVisibilityManagement?this.config.disableVisibilityManagement:!1)||this._storeInitalVisibility();this._checkHideContainer();this._initEditInfo();this._clickTab(0);this._updateCounts(!0);this._restoreIncidents();!this.isInitialLoad&&x.isAutoFocusFirstNodeWidget(this)&&x.focusFirstFocusNode(this.domNode)},_checkHideContainer:function(){this.hideContainer=!1;var r=this.map.infoWindow;r.popupInfoView&&
r.popupInfoView.container&&(this.hideContainer=!0,this.own(k(r,"show",F.hitch(this,this._handlePopup))))},onClose:function(){this._storeIncidents();this._toggleTabLayersOld();this._resetInfoWindow(!0);this.mapResize&&(this.mapResize.remove(),this.mapResize=null);this.windowResize&&(this.windowResize.remove(),this.windowResize=null);this._clear(!0);this.widgetActive=!1;this.saveEnabled&&(this.scSignal.remove(),this.sfSignal.remove());this._mapResize();this.disableVisibilityManagement||this._resetInitalVisibility();
this.inherited(arguments);this._resetMapPosition();this._togglePopupClass(!1)},onDeActive:function(){this._clickIncidentsButton(-1)},destroy:function(){this._clear(!0);this._toggleTabLayersOld();this.lyrBuffer&&this.map.removeLayer(this.lyrBuffer);this.lyrIncidents&&this.map.removeLayer(this.lyrIncidents);this.lyrClosest&&this.map.removeLayer(this.lyrClosest);this.lyrProximity&&this.map.removeLayer(this.lyrProximity);this.lyrSummary&&this.map.removeLayer(this.lyrSummary);this.lyrGroupedSummary&&this.map.removeLayer(this.lyrGroupedSummary);
this.inherited(arguments)},onAppConfigChanged:function(r,y){switch(y){case "themeChange":case "layoutChange":case "styleChange":this._updateUI(r);break;case "widgetPoolChange":this._verifyRouting();break;case "mapChange":window.localStorage.setItem(this.Incident_Local_Storage_Key,null);break;case "attributeChange":this._updateUI(r)}},_handlePopup:function(){this._clearMobileSetAsIncidentStyle();var r=m.byId("main-page");if(this.map.infoWindow.popupInfoView){var y=this.map.infoWindow.popupInfoView.container;
var L=".mainSection { overflow-y: auto; height: "+(r.clientHeight-60).toString()+"px; }";var U=".atiAttributes {overflow: auto; height: "+(r.clientHeight-130).toString()+"px; }"}else y=D("div.atiAttributes",this.map.infoWindow.domNode)[0],L=".mainSection { overflow-y: none; }",U=".atiAttributes {overflow: none; }";r.clientHeight&&y&&(r=document.createElement("style"),r.type="text/css",r.id="_tempMainSectionOverride",y.appendChild(r),r.sheet.insertRule(L,0),r.sheet.insertRule(U,1))},_updateUI:function(r){this._getStyleColor(r)},
_updateFontColor:function(r){"undefined"===typeof r&&(r=this.appConfig);r=f.create("div",{id:"tempTitle",innerHTML:r.title}).getElementsByTagName("font");this.config.fontColor=r&&0<r.length?/^#[0-9A-F]{6}$/i.test(r[0].color)?r[0].color:"#ffffff":"#ffffff";f.destroy("tempTitle");r=document.querySelectorAll(".panelBottom ");for(var y=0;y<r.length;y++)r[y].style.color=this.config.fontColor},_updateButtonBackgrounds:function(r,y){z.forEach(this.imgContainer.children,function(U){c.contains(U.children[0],
r?"btn32img":"btn32imgBlack")&&c.remove(U.children[0],r?"btn32img":"btn32imgBlack");c.add(U.children[0],r?"btn32imgBlack":"btn32img");c.contains(U.children[0],y?"darkThemeBackground":"lightThemeBackground")&&c.remove(U.children[0],y?"darkThemeBackground":"lightThemeBackground");c.add(U.children[0],y?"lightThemeBackground":"darkThemeBackground")});var L=this.allEnabled;z.forEach(this.saveOptions.children,function(U){L?z.forEach(U.children,function(ba){c.contains(ba.children[0],r?"btn32img":"btn32imgBlack")&&
c.remove(ba.children[0],r?"btn32img":"btn32imgBlack");c.add(ba.children[0],r?"btn32imgBlack":"btn32img");c.contains(ba.children[0],y?"darkThemeBackground":"lightThemeBackground")&&c.remove(ba.children[0],y?"darkThemeBackground":"lightThemeBackground");c.add(ba.children[0],y?"lightThemeBackground":"darkThemeBackground")}):(c.contains(U.children[0],r?"btn32img":"btn32imgBlack")&&c.remove(U.children[0],r?"btn32img":"btn32imgBlack"),c.add(U.children[0],r?"btn32imgBlack":"btn32img"),c.contains(U.children[0],
y?"darkThemeBackground":"lightThemeBackground")&&c.remove(U.children[0],y?"darkThemeBackground":"lightThemeBackground"),c.add(U.children[0],y?"lightThemeBackground":"darkThemeBackground"))})},_getStyleColor:function(r){this._updateFontColor(r);setTimeout(F.hitch(this,function(){if(this.footerNode){var y=window.getComputedStyle(this.footerNode,null).getPropertyValue("background-color");this.config.activeMapGraphicColor=y;y=d.fromRgb(y);this.lightTheme=210>.2126*y.r+.7152*y.g+.0722*y.b?!1:!0;this.config.color=
y.toHex();this.isBlackTheme="#000000"===this.config.color?!0:!1;this._updateButtonBackgrounds(this.isBlackTheme,this.lightTheme);this.updateActiveNodes(this.lightTheme,!0);this.updateActiveNodes(this.lightTheme,!1);this.isBlackTheme?(c.remove(this.tabNodes[this.curTab],"active"),c.add(this.tabNodes[this.curTab],"activeBlack"),this.config.activeColor="rgb(53, 53, 53)"):(c.remove(this.tabNodes[this.curTab],"activeBlack"),c.add(this.tabNodes[this.curTab],"active"),this.config.activeColor="rgba(39, 39, 39, 0.3)");
this._setupSymbols();this.dataValue?this._drawIncident(this.dataValue,void 0,void 0,!0).then(F.hitch(this,function(){this.dataValue=void 0})):this._bufferIncident()}}),300)},updateActiveNodes:function(r,y){if(y){y=[".SATcolLocate",".SATcol",".SATcolRec",".borderCol",".SATcolSmall"];var L="lightThemeBorder";var U="darkThemeBorder"}else y=".btn32img .innerBL .innerBR .SA_panelClose .SA_panelRight .SA_panelLeft".split(" "),L="lightThemeBackground",U="darkThemeBackground";z.forEach(y,function(ba){ba=
D(ba);for(var ca=0;ca<ba.length;ca++){var da=ba[ca];c.remove(da,r?U:L);c.add(da,r?L:U)}})},setPosition:function(r,y){this.widgetActive&&(y=window.jimuConfig.layoutId,"TabTheme"===this.appConfig.theme.name?this.position={left:this.widgetManager.getControllerWidgets()[0].domNode.clientWidth,right:0,bottom:24,height:155,relativeTo:"browser"}:"DashboardTheme"===this.appConfig.theme.name?(this.position={left:0,right:0,bottom:0,height:155},y=this.map.id):this.position={left:0,right:0,bottom:0,height:155,
relativeTo:"browser"},r=x.getPositionStyle(this.position),r.position="absolute",b.place(this.domNode,y),b.setStyle(this.domNode,r),this.started&&this.resize(),B.publish("changeMapPosition",{bottom:155}))},disableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!0)},_setEventLocation:function(r){var y=r.feature?r.feature:this.map.infoWindow.getSelectedFeature();if(r&&"add"===r.type)y={eventType:"IncidentLocationAdd",
dataValue:y},this.incidents=[],this.buffers=[],this.lyrIncidents.clear(),this.lyrBuffer.clear();else{for(var L=!0,U,ba=0;ba<this.lyrIncidents.graphics.length;ba++){var ca=this.lyrIncidents.graphics[ba];if(ca.geometry.type===y.geometry.type){var da=!u.equals(ca.geometry,y.geometry);ca.attributes&&y.attributes&&!da&&(da=da&&h.stringify(ca.attributes)===h.stringify(y.attributes));L=L&&da;da||(U=ca)}}y={eventType:L?"IncidentLocationAdd":"IncidentLocationRemove",dataValue:y,removeGraphic:U}}this.onReceiveData("",
"",y);this.map.infoWindow.isShowing&&this.map.infoWindow.hide();r&&(r=this.map.infoWindow,r.popupNavigationBar&&(y=D(".esriMobileNavigationBar",r.popupNavigationBar.domNode),0<y.length&&b.setStyle(y[0],"display","none")),r.popupInfoView&&(y=D(".esriMobileInfoView",r.popupInfoView.domNode),0<y.length&&b.setStyle(y[0],"display","none")));c.remove(this.panelContainer,"loading")},_initLayers:function(){this.gsvc=new oa(this.config.geometryService&&this.config.geometryService.url?this.config.geometryService.url:
this.appConfig.geometryService);this.locator=new ja(this.config.geocodeService.url);this.own(k(this.locator,"location-to-address-complete",F.hitch(this,this._showIncidentAddress)));this.own(k(this.locator,"error",F.hitch(this,this._onAddressError)));this.lyrIncidents=new ea;this.map.addLayer(this.lyrIncidents);this.lyrClosest=new ea;this.lyrClosest.setVisibility(!1);this.map.addLayer(this.lyrClosest);this.lyrProximity=new ea;this.lyrProximity.setVisibility(!1);this.map.addLayer(this.lyrProximity);
this.summaryDisplayEnabled&&(this.lyrSummary=new ea,this.lyrSummary.setVisibility(!1),this.map.addLayer(this.lyrSummary),this.lyrGroupedSummary=new ea,this.lyrGroupedSummary.setVisibility(!1),this.map.addLayer(this.lyrGroupedSummary));this.lyrBuffer=new ea;this.map.addLayer(this.lyrBuffer)},_mapLoaded:function(){D("[data-reference]").style("z-index",0);this._processOperationalLayers();this.saveEnabled&&this._initEdit();var r=this.map.itemInfo.itemData.baseMap.baseMapLayers[0];"ArcGISTiledMapServiceLayer"===
r.layerType&&r.resourceInfo.singleFusedMapCache||(this.config.defaultZoomLevel=.5);this._clickTab(0)},_initEdit:function(){var r=this.map.infoWindow;this.config.saveEnabled&&"undefined"===typeof this.config.savePolys&&"undefined"===typeof this.config.saveLines&&"undefined"===typeof this.config.savePoints&&(this.config.savePolys=!0,this.config.polyEditLayer=this.config.editLayer,this.polyTemplate=this.config.editTemplate,this.honorTemplate=!0);this.config.savePoints&&this._initEditLayer(this.config.pointEditLayer,
"point");this.config.saveLines&&this._initEditLayer(this.config.lineEditLayer,"line");this.config.savePolys&&this._initEditLayer(this.config.polyEditLayer,"poly");this.scSignal=k(r,"selection-change",F.hitch(this,this._selectionChanged));this.sfSignal=k(r,"set-features",F.hitch(this,this._setPopupFeature));var y=D(".esriPopupWrapper",r.domNode);0<y.length&&"undefined"!==typeof y[0].clientHeight&&"undefined"!==typeof y[0].clientWidth&&(this.defaultPopupSize={width:y[0].clientWidth});r.highlight=!0},
_getLayerIDs:function(){var r=[];z.forEach(this.opLayers._layerInfos,F.hitch(this,function(y){0<y.newSubLayers.length?this._recurseLayersIDs(y.newSubLayers,r):r.push({id:y.id,title:y.title})}));return r},_recurseLayersIDs:function(r,y){z.forEach(r,F.hitch(this,function(L){0<L.newSubLayers.length?this._recurseLayersIDs(L.newSubLayers,y):y.push({id:L.id,title:L.title})}))},_initJimuLayerInfos:function(){if(this.config&&this.config.tabs&&this.config.tabs.length){for(var r=this.config.tabs,y=[],L=this._getLayerIDs(),
U=r.length-1;0<=U;U--){var ba=r[U],ca=ba.layerTitle?ba.layerTitle:ba.layers;if(ba.layers&&(ba.jimuLayerInfo=this.opLayers.getLayerInfoById(ba.layers),!ba.jimuLayerInfo)){if(L&&L.hasOwnProperty("length")&&0<L.length){var da=0;a:for(;da<L.length;da++){var la=L[da];if(la&&la.hasOwnProperty("title")&&la.title===ca){ba.jimuLayerInfo=this.opLayers.getLayerInfoById(la.id);break a}}}ba.jimuLayerInfo||(this.config.tabs.splice(U,1),y.push(ca))}}if(0<y.length){var ma="";z.forEach(y,F.hitch(this,function(ia){ma+=
Ca.substitute({name:ia},this.nls.missingLayer)+"\x3c/br\x3e\x3c/br\x3e"}));r=f.create("div",{style:"max-height:500px;overflow:auto;"});f.create("div",{className:"SAT-warning-hint",innerHTML:this.nls.missingLayerHint},r);f.create("div",{innerHTML:ma.substr(0,ma.lastIndexOf("\x3c/br\x3e\x3c/br\x3e")),style:"padding-"+(window.isRTL?"right":"left")+": 10px;"},r);new J({titleLabel:"\x3cdiv class\x3d'SAT-warning-icon' style\x3d'float: "+(window.isRTL?"right; margin-left":"left; margin-right")+": 10px;'\x3e\x3c/div\x3e"+
this.nls.layerNotAvalible,message:r,maxWidth:350})}}},_initEditLayer:function(r,y){if("point"===y){this.pointEditLayer=this.opLayers.getLayerInfoById(r).layerObject;this.isPointEditable=this._isEditable(this.pointEditLayer);var L=this.pointEditLayer;L.templates&&0<L.templates.length?this.pointTemplate=L.templates[0]:L.types&&0<L.types.length&&(this.pointTemplate=L.types[0].templates[0]);this.pointTemplate&&(this.pointEditLayerPrototype=this.pointTemplate.prototype)}else"line"===y?(this.lineEditLayer=
this.opLayers.getLayerInfoById(r).layerObject,this.isLineEditable=this._isEditable(this.lineEditLayer),L=this.lineEditLayer,L.templates&&0<L.templates.length?this.lineTemplate=L.templates[0]:L.types&&0<L.types.length&&(this.lineTemplate=L.types[0].templates[0]),this.lineTemplate&&(this.lineEditLayerPrototype=this.lineTemplate.prototype)):"poly"===y&&(this.polyEditLayer=this.opLayers.getLayerInfoById(r).layerObject,this.isPolyEditable=this._isEditable(this.polyEditLayer),L=this.polyEditLayer,this.honorTemplate||
(L.templates&&0<L.templates.length?this.polyTemplate=L.templates[0]:L.types&&0<L.types.length&&(this.polyTemplate=L.types[0].templates[0])),this.polyTemplate&&(this.polyEditLayerPrototype=this.polyTemplate.prototype));L&&this.own(k(L,"click",F.hitch(this,function(U){if(U.graphic)switch(U=U.graphic,U.geometry.type){case "point":this.pointUpdateFeature=U;break;case "polyline":this.lineUpdateFeature=U;break;case "polygon":this.polyUpdateFeature=U}})))},_isEditable:function(r){var y=!1;r.isEditable()&&
r.getEditCapabilities&&(y=r.getEditCapabilities());return y&&y.canUpdate&&y.canCreate},_initEditInfo:function(){if(this.saveEnabled){var r=!1;this.polyEditLayer&&this.isPolyEditable&&(r=!0,this.defaultPolyContent=this.polyEditLayer.infoTemplate?this.polyEditLayer.infoTemplate.content:void 0,this.polyEditLayer.infoTemplate.setContent(F.hitch(this,this._setEditLayerPopup)));this.lineEditLayer&&this.isLineEditable&&(r=!0,this.defaultLineContent=this.lineEditLayer.infoTemplate?this.lineEditLayer.infoTemplate.content:
void 0,this.lineEditLayer.infoTemplate.setContent(F.hitch(this,this._setEditLayerPopup)));this.pointEditLayer&&this.isPointEditable&&(r=!0,this.defaultPointContent=this.pointEditLayer.infoTemplate?this.pointEditLayer.infoTemplate.content:void 0,this.pointEditLayer.infoTemplate.setContent(F.hitch(this,this._setEditLayerPopup)));r&&this.map.infoWindow.resize(350,340)}},_setPopupFeature:function(){if(0<this.map.infoWindow.count){var r=this.map.infoWindow.getSelectedFeature();switch(r.geometry.type){case "point":this.pointUpdateFeature=
r;break;case "polyline":this.lineUpdateFeature=r;break;case "poly":this.polyUpdateFeature=r}}},_selectionChanged:function(){if(0<this.map.infoWindow.count){var r=this.map.infoWindow.getSelectedFeature();switch(r.geometry.type){case "point":this.pointUpdateFeature=r;break;case "polyline":this.lineUpdateFeature=r;break;case "poly":this.polyUpdateFeature=r}}},_setEditLayerPopup:function(r){if("polygon"===r.geometry.type)var y=this.polyEditLayer;"polyline"===r.geometry.type&&(y=this.lineEditLayer);"point"===
r.geometry.type&&(y=this.pointEditLayer);for(var L=[],U=this._getPopupFields(y),ba=0;ba<U.length;ba++){var ca=U[ba];ca.isEditable&&ca.isEditableOnLayer&&L.push({fieldName:ca.fieldName,isEditable:ca.isEditable})}this.attInspector=new xa({layerInfos:[{featureLayer:y,showAttachments:!1,isEditable:!0,fieldInfos:L}]},f.create("div"));L=new P({label:this.nls.update_btn,"class":"atiButton"},f.create("div"));f.place(L.domNode,this.attInspector.deleteBtn.domNode.parentNode);this._togglePopupClass(!0);x.isMobileUa()&&
(U=D(".esriMobileInfoViewItem .esriAttributeInspector .atiDeleteButton"))&&0<U.length&&c.add(this.attInspector.deleteBtn.domNode,"esriCTAIDeleteButtonWidth");this.own(k(L,"click",F.hitch(this,function(){y.applyEdits(null,[r],null,F.hitch(this,function(){this.map.infoWindow.hide();setTimeout(F.hitch(this,function(){this.saveButton.focus()}),100)}),function(da){var la="Error";"undefined"!==typeof da.details&&(la=da.details);"undefined"!==typeof da.message&&(la=da.message);new J({message:la})})})));
this.own(k(this.attInspector,"attribute-change",F.hitch(this,function(da){switch(da.feature.geometry.type){case "point":this.pointUpdateFeature=da.feature;this.pointUpdateFeature.attributes[da.fieldName]=da.fieldValue;break;case "polyline":this.lineUpdateFeature=da.feature;this.lineUpdateFeature.attributes[da.fieldName]=da.fieldValue;break;case "polygon":this.polyUpdateFeature=da.feature,this.polyUpdateFeature.attributes[da.fieldName]=da.fieldValue}})));this.own(k(this.attInspector,"next",F.hitch(this,
function(da){switch(da.feature.geometry.type){case "point":this.pointUpdateFeature=da.feature;break;case "polyline":this.pointUpdateFeature=da.feature;break;case "poly":this.pointUpdateFeature=da.feature}})));this.own(k(this.attInspector,"delete",F.hitch(this,function(da){var la=!1;if(0<this.incidents.length){for(var ma=0;ma<this.incidents.length;ma++)u.equals(da.feature.geometry,this.incidents[ma].geometry)&&(la=!0);if(!la&&0<this.lyrBuffer.graphics.length)for(ma=0;ma<length;ma++)u.equals(da.feature.geometry,
this.lyrBuffer.graphics[ma].geometry)&&(la=!0)}y.applyEdits(null,null,[da.feature],function(){},function(ia){var ra="Error";"undefined"!==typeof ia.details&&(ra=ia.details);"undefined"!==typeof ia.message&&(ra=ia.message);new J({message:ra})});this.pointEditLayer&&(this.pointUpdateFeature=this.pointEditLayerPrototype);this.lineEditLayer&&(this.lineUpdateFeature=this.lineEditLayerPrototype);this.polyEditLayer&&(this.polyUpdateFeature=this.polyEditLayerPrototype);la&&this._clear(!1);this.map.infoWindow.hide();
setTimeout(F.hitch(this,function(){x.focusFirstFocusNode(this.domNode)}),100)})));switch(r.geometry.type){case "point":this.pointUpdateFeature=r;break;case "polyline":this.lineUpdateFeature=r;break;case "polygon":this.polyUpdateFeature=r}this.attInspector.showFeature(r);return this.attInspector.domNode},_getPopupFields:function(r){if(r.infoTemplate)var y=r.infoTemplate.info.fieldInfos;else if(-1<this.tab.tabLayers[0].url.indexOf("MapServer")){var L=this.tab.tabLayers[0].url.split("MapServer/")[1],
U=this.parent.map.itemInfo.itemData.operationalLayers;y=null;for(var ba=0;ba<U.length;ba++){var ca=U[ba];if(ca.layerObject.infoTemplates&&(ca=ca.layerObject.infoTemplates[L])){y=ca.infoTemplate.info.fieldInfos;break}}}else y=r.fields;y||(y=r.fields);return y},_updatePopup:function(r,y,L){y=[];for(L=0;L<r.length;L++){var U=r[L],ba=new Fa;ba.objectIds=[U.oid];y.push(U.layer.selectFeatures(ba,fa.SELECTION_NEW))}(new O(y)).then(F.hitch(this,function(ca){for(var da=[],la=0;la<ca.length;la++){var ma=ca[la];
if(ma[0]){ma=ma[1][0];da.push(ma);switch(ma.geometry.type){case "point":this.pointUpdateFeature=ma;break;case "polyline":this.lineUpdateFeature=ma;break;case "poly":this.polyUpdateFeature=ma}this.attInspector||this._setEditLayerPopup(ma);this.attInspector&&this.attInspector.showFeature(ma)}}}))},_processOperationalLayers:function(){for(var r=0;r<this.config.tabs.length;r++){var y=this.config.tabs[r];y.layers&&""!==y.layers&&(this.hasLayerTitle="undefined"!==typeof y.layerTitle,y.tabLayers=this._getTabLayers(y.layers))}},
_goToNextTab:function(r,y){if(r.keyCode===qa.LEFT_ARROW||r.shiftKey&&r.keyCode===qa.TAB)y=0===y?this.tabNodes.length-1:y-1;else if(r.keyCode===qa.RIGHT_ARROW||r.keyCode===qa.TAB)y=y===this.tabNodes.length-1?0:y+1;else return;var L=D("div[tabNum\x3d"+y+"]",this.domNode)[0];c.contains(L,"noFeaturesActive")&&(L=this._goToNextTab(r,y));return L},_createUI:function(){var r=x.stripHTML(this.config.bufferLabel?this.config.bufferLabel:"");this.buffer_lbl.innerHTML=r;this.buffer_lbl_unit.innerHTML=this.nls[this.config.distanceUnits];
this.spinnerValue.isRenderIdForAttrs=!0;this.spinnerValue.constraints={min:this.SLIDER_MIN_VALUE,max:this.SLIDER_MAX_VALUE};this.spinnerValue.intermediateChanges=!0;r=Ca.substitute({min:this.SLIDER_MIN_VALUE,max:this.SLIDER_MAX_VALUE},this.nls.buffer_invalid);this.spinnerValue.invalidMessage=r;this.spinnerValue.rangeMessage=r;this.spinnerValue.set("value",this.SLIDER_DEFAULT_VALUE);this.locateIncident.innerHTML="undefined"!==typeof this.config.locateIncidentLabel?this.config.locateIncidentLabel:this.nls.locate_incident;
this.config.tabs.splice(0,0,{type:"incidents",label:"undefined"!==typeof this.config.incidentLabel?this.config.incidentLabel:this.nls.incident,color:this.config.color});this.panelNodes.push(this.SA_tabPanel0);var y=this.panelContainer;r=this.tabsNode;for(var L=0,U=0;U<this.config.tabs.length;U++){var ba=this.config.tabs[U],ca=ba.label;ca&&""!==ca||(ca=ba.layerTitle?ba.layerTitle:ba.layers);ca=f.create("div",{"data-dojo-attach-point":"SA_tab"+U,tabindex:"0",tabNum:U,role:"tab","aria-label":x.stripHTML(ca?
ca:""),"aria-selected":"false",innerHTML:x.stripHTML(ca?ca:"")},r);this.tabNodes.push(ca);c.add(ca,"SATTab");L+=C.position(ca).w;k(ca,"click",F.hitch(this,this._clickTab,U));k(ca,"keydown",F.hitch(this,function(da){var la=parseInt(A.get(da.currentTarget,"tabNum"),10);da.keyCode===qa.TAB?(da.preventDefault(),da=this._goToNextTab(da,la),da.focus()):da.keyCode===qa.LEFT_ARROW||da.keyCode===qa.RIGHT_ARROW?(da=this._goToNextTab(da,la),da.focus()):da.keyCode===qa.ENTER||da.keyCode===qa.SPACE?(this._clickTab(parseInt(A.get(da.currentTarget,
"tabNum"),10)),"0"===A.get(da.currentTarget,"tabNum")&&setTimeout(F.hitch(this,function(){this.clearIncident.focus()}),100)):da.keyCode===qa.ESCAPE&&(this.closeButton.focus(),da.stopPropagation())}));0<U&&(ca=f.create("div",{"data-dojo-attach-point":"SA_tabPanel"+U,role:"tabpanel",innerHTML:""},y),this.panelNodes.push(ca),k(this.panelNodes[U],"keydown",F.hitch(this,function(da){da.keyCode===qa.ESCAPE&&(z.forEach(this.tabNodes,F.hitch(this,function(la){c.contains(la,"active")&&la.focus()})),da.stopPropagation(),
da.cancelBubble=!0)})),c.add(ca,"SAT_tabPanel"),"summary"===ba.type&&(ba.summaryInfo=new Ha(ba,ca,this),this.own(k(ba.summaryInfo,"summary-complete",F.hitch(this,this.restore)))),"groupedSummary"===ba.type&&(ba.groupedSummaryInfo=new Ia(ba,ca,this),this.own(k(ba.groupedSummaryInfo,"summary-complete",F.hitch(this,this.restore)))),"closest"===ba.type&&(ba.closestInfo=new Ja(ba,ca,this)),"proximity"===ba.type&&(ba.proximityInfo=new Ka(ba,ca,this)))}L+=10;e.set(r,"width",L+"px");L>C.position(this.footerNode).w&&
(y=this.footerContentNode,window.isRTL?(e.set(y,"left","58px"),e.set(this.panelLeft,"display","block"),e.set(this.panelRight,"display","none")):(e.set(y,"right","58px"),e.set(this.panelRight,"display","block")));k(r,"scroll",F.hitch(this,this._onPanelScroll));this.own(k(this.clearIncident,"keydown",F.hitch(this,function(da){if(da.keyCode===qa.ENTER||da.keyCode===qa.SPACE)this._clear(),this.SA_btn0.focus(),this._getLastNodeForEachTab(0)})))},restore:function(r){r.tab===this.curTab&&this._clickTab(r.tab)},
validateSavePrivileges:function(){var r=new E;t.getPortal(this.appConfig.portalUrl).getUser().then(F.hitch(this,function(y){y&&y.privileges?r.resolve(-1<y.privileges.indexOf("features:user:edit")?!0:!1):r.resolve(!0)}),F.hitch(this,function(y){console.log(y);r.resolve(!0)}));return r},validateSnapshotPrivileges:function(){var r=new E;t.getPortal(this.appConfig.portalUrl).getUser().then(F.hitch(this,function(y){y&&y.privileges?r.resolve(-1<y.privileges.indexOf("portal:publisher:publishFeatures")&&
-1<y.privileges.indexOf("portal:user:createItem")?!0:!1):r.resolve(!1)}),F.hitch(this,function(y){console.log(y);r.resolve(!1)}));return r},_loadUI:function(){var r=this.allEnabled?f.create("div",{"class":"displayT pad-top-5"},this.saveOptions):this.saveOptions,y=this.allEnabled?f.create("div",{"class":"displayT pad-top-10"},this.saveOptions):this.saveOptions,L=this.allEnabled?"displayTC":"displayTR";this.reportEnabled&&(this.createReportButtonSpan=f.create("span",{"class":"btn32 "+L},r),this.createReportButton=
f.create("div",{"class":"btn32img",title:this.nls.createReport,"aria-label":this.nls.createReport,tabindex:"0",role:"button"},this.createReportButtonSpan),e.set(this.createReportButton,"backgroundImage","url("+this.reportSrc+")"),this.own(k(this.createReportButton,"click",F.hitch(this,this._createReport))),this.own(k(this.createReportButton,"keydown",F.hitch(this,function(U){U.keyCode!==qa.ENTER&&U.keyCode!==qa.SPACE||this._createReport()}))));this.saveEnabled&&(this.saveButtonSpan=f.create("span",
{"class":"btn32 "+L},r),this.validateSavePrivileges().then(F.hitch(this,function(U){this.userCanSave=U;this.saveButton=f.create("div",{"class":U?"btn32img":"btn32img btnDisabled",title:U?this.nls.saveIncident:this.nls.user_credentials,"aria-label":U?this.nls.saveIncident:this.nls.user_credentials,tabindex:"0",role:"button"},this.saveButtonSpan);e.set(this.saveButton,"backgroundImage","url("+this.saveSrc+")");U&&(this.own(k(this.saveButton,"click",F.hitch(this,this._saveIncident))),this.own(k(this.saveButton,
"keydown",F.hitch(this,function(ba){ba.keyCode!==qa.ENTER&&ba.keyCode!==qa.SPACE||this._saveIncident()}))))}),function(U){console.log(U)}));r=f.create("span",{"class":"btn32 "+L},y);this.downloadAllButon=f.create("div",{"class":"btn32img",title:this.nls.downloadAll,"aria-label":this.nls.downloadAll,tabindex:"0",role:"button"},r);e.set(this.downloadAllButon,"backgroundImage","url("+this.downloadAllSrc+")");this.own(k(this.downloadAllButon,"click",F.hitch(this,this._downloadAll)));this.own(k(this.downloadAllButon,
"keydown",F.hitch(this,function(U){U.keyCode!==qa.ENTER&&U.keyCode!==qa.SPACE||this._downloadAll()})));this.snapshotEnabled&&(this.createSnapshotButtonSpan=f.create("span",{"class":"btn32 "+L},y),this.validateSnapshotPrivileges().then(F.hitch(this,function(U){this.userCanSnapshot=U;this.createSnapshotButton=f.create("div",{"class":U?"btn32img":"btn32img btnDisabled",title:U?this.nls.createSnapshot:this.nls.user_credentials,"aria-label":U?this.nls.createSnapshot:this.nls.user_credentials,tabindex:"0",
role:"button"},this.createSnapshotButtonSpan);e.set(this.createSnapshotButton,"backgroundImage","url("+this.snapshotSrc+")");U&&(this.own(k(this.createSnapshotButton,"click",F.hitch(this,this._createSnapshot))),this.own(k(this.createSnapshotButton,"keydown",F.hitch(this,function(ba){ba.keyCode!==qa.ENTER&&ba.keyCode!==qa.SPACE||this._createSnapshot()}))))}),function(U){console.log(U)}));y={0:this.nls.drawPoint,1:this.nls.drawLine,2:this.nls.drawPolygon};this.btnNodes=[this.SA_btn0,this.SA_btn1,this.SA_btn2];
for(L=0;3>L;L++)r=this.btnNodes[L],e.set(r,"backgroundImage","url("+this.folderUrl+"images/btn"+L+".png)"),b.setAttr(r,"title",y[L]),b.setAttr(r,"aria-label",y[L]),b.setAttr(r,"toolNum",L),b.setAttr(r,"aria-pressed","false"),this.own(k(r,"click",F.hitch(this,this._clickIncidentsButton,L))),this.own(k(r,"keydown",F.hitch(this,function(U){U.keyCode!==qa.ENTER&&U.keyCode!==qa.SPACE||this._clickIncidentsButton(parseInt(A.get(U.currentTarget,"toolNum"),10))})));this.toolbar=new ta(this.map,{tooltipOffset:20,
drawTime:90});this.toolbar.on("draw-complete",F.hitch(this,this._drawIncident));this.own(k(this.spinnerValue,"change",F.hitch(this,function(){this._updateSpinnerValue(!1)})));this.own(k(this.spinnerValue,"blur",F.hitch(this,function(){this._updateSpinnerValue(!0)})));this.own(k(this.spinnerValue,"keyup",F.hitch(this,function(U){U.keyCode===qa.ENTER?this._updateSpinnerValue(!0):this._updateSpinnerValue(!1)})))},_locateBuffer:function(r){if(null!==r&&(r="extent"===r.type?r:r.getExtent(),null!==r)){r=
r.expand(1.5);var y=80/this.map.height,L=r.getHeight();r.update(r.xmin,r.ymin-L*y,r.xmax,r.ymax-L*y,this.map.spatialReference);this.map.setExtent(r,!0)}},_clickIncidentsButton:function(r){if(3>r){for(var y=0;3>y;y++){var L=this.btnNodes[y];c.remove(L,"btnOn");b.setAttr(L,"aria-pressed","false")}-1<r&&r!==this.tool?(L=this.btnNodes[r],3>r&&(c.add(L,"btnOn"),b.setAttr(L,"aria-pressed","true")),this.tool=r):this.tool=-1;switch(this.tool){case -1:this.toolbar.deactivate();this.enableWebMapPopup();break;
case 0:this._clear(!1);this.toolbar.activate(ta.POINT);this.disableWebMapPopup();break;case 1:this._clear(!1);this.toolbar.activate(ta.POLYLINE);this.disableWebMapPopup();break;case 2:this._clear(!1),this.toolbar.activate(ta.POLYGON),this.disableWebMapPopup()}}else this._clear(!0)},_saveIncident:function(){this.map.infoWindow.hide();this._updateProcessing(this.saveButton,!0,this.saveSrc);var r=[];this.config.saveEnabled&&"undefined"===typeof this.config.savePolys&&"undefined"===typeof this.config.saveLines&&
"undefined"===typeof this.config.savePoints&&(this.config.savePolys=!0);if(this.config.savePolys){var y=this._getIncidentGraphics("polygon",this.polyEditLayerPrototype);0<y.length&&r.push({layer:this.polyEditLayer,graphics:y})}this.config.saveLines&&(y=this._getIncidentGraphics("polyline",this.lineEditLayerPrototype),0<y.length&&r.push({layer:this.lineEditLayer,graphics:y}));this.config.savePoints&&(y=this._getIncidentGraphics("point",this.pointEditLayerPrototype),0<y.length&&r.push({layer:this.pointEditLayer,
graphics:y}));0<r.length?this._applyEdits(r):this._updateProcessing(this.saveButton,!1,this.saveSrc);this._clickIncidentsButton(-1)},_getIncidentGraphics:function(r,y){var L=[];y=h.parse(h.stringify(y));if("polygon"===r)for(var U=0;U<this.lyrBuffer.graphics.length;U++){var ba=this.lyrBuffer.graphics[U],ca=new M;ca.geometry=ba.geometry;ca.setAttributes(y.attributes);L.push(ca)}for(U=0;U<this.incidents.length;U++)ba=this.incidents[U],ba.geometry.type===r&&(ca=new M,ca.geometry=ba.geometry,ca.setAttributes(y.attributes),
L.push(ca));return L},_applyEdits:function(r){for(var y=new E,L=[],U=[],ba=0;ba<r.length;ba++){var ca=r[ba];ca.layer.visible||ca.layer.setVisibility(!0);var da=[];if(1<ca.graphics.length&&"polygon"===ca.graphics[0].geometry.type){var la=ca.graphics[0],ma=ca.graphics.map(function(ia){return ia.geometry});if(ma=u.union(ma))la.geometry=ma,da.push(la)}L.push(ca.layer.applyEdits(0<da.length?da:ca.graphics,null,null))}(new O(L)).then(F.hitch(this,function(ia){for(var ra=!1,ua="",wa=0;wa<ia.length;wa++)ua=
ia[wa][1][0],ua.success?(ra=!0,ua.hasOwnProperty("objectId")&&U.push({oid:ua.objectId,layer:r[wa].layer})):(ua=ia[wa][1][0].error.message,new J({title:this.nls.saveIncident,message:this.nls.saveIncidentErrorMessage+ua}));this._smartEdit();if(!this.map.infoWindow.isShowing){ia=this.incidents[0].geometry;switch(ia.type){case "point":var sa=ia;break;case "polyline":sa=ia.paths[0][parseInt(ia.paths[0].length/2,10)];sa=new G(sa[0],sa[1],ia.spatialReference);break;case "polygon":sa=ia.getCentroid()}ia=
this.map.toScreen(sa);0<U.length&&this._updatePopup(U,sa,ia);this._updateProcessing(this.saveButton,!1,this.saveSrc);this.map.emit("click",{bubbles:!0,cancelable:!0,screenPoint:ia,mapPoint:sa})}y.resolve(ra)}),F.hitch(this,function(ia){console.error(ia);this._updateProcessing(this.saveButton,!1,this.saveSrc);new J({message:ia});y.reject(ia)}));return y},_smartEdit:function(){if(!this.smartEditor){var r=this.appConfig.getConfigElementsByName("SmartEditor");z.forEach(r,F.hitch(this,function(y){"SmartEditor"===
y.name&&(this.smartEditor=this.widgetManager.getWidgetById(y.id))}))}this.smartEditor&&this.smartEditor.state&&"opened"===this.smartEditor.state&&this.smartEditor._mapClickHandler(!0)},_clear:function(r){this.map.graphics.clear();this.lyrIncidents.clear();this.lyrBuffer.clear();this.lyrProximity.clear();this.lyrClosest.clear();this.geomExtent=void 0;this.summaryDisplayEnabled&&this.lyrSummary&&this.lyrSummary.clear();this.summaryDisplayEnabled&&this.lyrGroupedSummary&&this.lyrGroupedSummary.clear();
this.saveOptions&&(c.remove(this.saveOptions,"displayT"),c.add(this.saveOptions,"display-off"));this.borderCol&&(c.remove(this.borderCol,"display-on"),c.add(this.borderCol,"display-off"));this.clearIncident&&(c.remove(this.clearIncident,"display-on"),c.add(this.clearIncident,"display-off"));this.smartEditor&&this.smartEditor._onCancelButtonClicked();this.incidents=[];this.buffers=[];this.div_reversed_address&&(this.div_reversed_address.innerHTML="");this.div_reverse_geocoding&&b.setStyle(this.div_reverse_geocoding,
"display","none");this._updateCounts(!0);this._clearGraphics();r&&this.spinnerValue&&this.spinnerValue.set("value",this.SLIDER_DEFAULT_VALUE);this.pointEditLayer&&(this.pointUpdateFeature=this.pointEditLayerPrototype);this.lineEditLayer&&(this.lineUpdateFeature=this.lineEditLayerPrototype);this.polyEditLayer&&(this.polyUpdateFeature=this.polyEditLayerPrototype);this._clearMobileSetAsIncidentStyle()},_clearMobileSetAsIncidentStyle:function(){f.destroy(m.byId("_tempMainSectionOverride"))},_updateSpinnerValue:function(r){if(this.spinnerValue.validate()){var y=
this.spinnerValue.displayedValue;"string"===typeof y&&(y=parseFloat(y.toString().replace(/,/g,""),10));y<this.SLIDER_MIN_VALUE?this.spinnerValue.set("value",this.SLIDER_MIN_VALUE):y>this.SLIDER_MAX_VALUE&&this.spinnerValue.set("value",this.SLIDER_MAX_VALUE);r&&this._bufferIncident()}},_clickTab:function(r){this._validateFeatureCount(r)&&(A.set(this.tabNodes[r],"aria-selected","true"),z.forEach(this.tabNodes,F.hitch(this,function(y,L){r!==L&&A.set(y,"aria-selected","false")})),this._toggleTabs(r),
this._toggleTabLayers(r),this.curTab=r,this._clickIncidentsButton(-1),setTimeout(F.hitch(this,function(){this._getLastNodeForEachTab(r)}),100))},_getLastNodeForEachTab:function(r){var y=this._getLastFocusNodeInDom(r);y&&(0===r&&(c.contains(this.clearIncident,"display-off")?x.initFirstFocusNode(this.domNode,this.SA_btn0):x.initFirstFocusNode(this.domNode,this.clearIncident)),x.initLastFocusNode(this.domNode,y.domNode?y.domNode:y))},_getLastFocusNodeInDom:function(r){if(0===r)return this._getLastFocusNodeInIncidentTab()},
_getLastFocusNodeInIncidentTab:function(){if(!c.contains(this.saveOptions,"display-off")){if(this.config.snapshotEnabled&&this.createSnapshotButton&&!c.contains(this.createSnapshotButton,"btnDisabled"))var r=this.createSnapshotButton;r||!this.downloadAllButon||c.contains(this.downloadAllButon,"btnDisabled")||(r=this.downloadAllButon);!r&&this.config.saveEnabled&&this.saveButton&&!c.contains(this.saveButton,"btnDisabled")&&(r=this.saveButton);!r&&this.config.reportEnabled&&this.createReportButton&&
!c.contains(this.createReportButton,"btnDisabled")&&(r=this.createReportButton)}!r&&this.spinnerValue&&(r=this.spinnerValue);return r},_validateFeatureCount:function(r){var y=!0;r=this.config.tabs[r];switch(r.type){case "summary":y=0<r.summaryInfo.featureCount;break;case "groupedSummary":y=0<r.groupedSummaryInfo.featureCount;break;case "closest":y=0<r.closestInfo.featureCount;break;case "proximity":y=0<r.proximityInfo.featureCount}return y},_toggleTabs:function(r){for(var y=0;y<this.config.tabs.length;y++)y===
r?(c.add(this.tabNodes[y],this.isBlackTheme?"activeBlack":"active"),e.set(this.panelNodes[y],"display","block")):(c.remove(this.tabNodes[y],"active"),c.remove(this.tabNodes[y],"activeBlack"),e.set(this.panelNodes[y],"display","none"));this._scrollToTab(r)},_toggleTabLayers:function(r){this._toggleTabLayersOld();this._toggleTabLayersNew(r)},_toggleTabLayersOld:function(){var r=this.config.tabs[this.curTab];r&&(this.lyrClosest.setVisibility(!1),this.lyrProximity.setVisibility(!1),this.lyrSummary&&this.lyrSummary.setVisibility(!1),
this.lyrGroupedSummary&&this.lyrGroupedSummary.setVisibility(!1),this._setLayerVisible(r,!1))},_toggleTabLayersNew:function(r){var y=this.config.tabs[r];switch(y.type){case "summary":var L=!1;this.lyrSummary&&(this.currentSumLayer!==r&&(L=!0),this.lyrSummary.clear());y.tabLayers&&1<y.tabLayers.length&&(this.lyrSummary&&(this.lyrSummary.infoTemplate=y.tabLayers[1].infoTemplate,z.forEach(y.tabLayers[1].graphics,F.hitch(this,function(U){this.lyrSummary.add(U)})),y.tabLayers[0]&&y.tabLayers[0].hasOwnProperty("opacity")&&
this.lyrSummary.setOpacity(y.tabLayers[0].opacity),this.lyrSummary.setVisibility(!0)),L&&(this.currentSumLayer=r,this._toggleTabLayersNew(r)));0<this.incidents.length&&!0===y.updateFlag?(y.summaryInfo.updateForIncident(this.incidents,this.buffers,this.summaryDisplayEnabled?this.lyrSummary:null,r),this.currentSumLayer=r):(r=D(".summaryDownLoadCSVButton",this.domNode))&&0<r.length&&(r[0].focus(),x.initFirstFocusNode(this.domNode,r[0]),x.initLastFocusNode(this.domNode,r[0]));break;case "groupedSummary":this.lyrGroupedSummary&&
(this.currentSumLayer!==r&&(L=!0),this.lyrGroupedSummary.clear());y.tabLayers&&1<y.tabLayers.length&&(this.lyrGroupedSummary&&(this.lyrGroupedSummary.infoTemplate=y.tabLayers[1].infoTemplate,z.forEach(y.tabLayers[1].graphics,F.hitch(this,function(U){this.lyrGroupedSummary.add(U)})),this.lyrGroupedSummary.setVisibility(!0)),L&&(this.currentSumLayer=r,this._toggleTabLayersNew(r)));0<this.incidents.length&&!0===y.updateFlag?(y.groupedSummaryInfo.updateForIncident(this.incidents,this.buffers,this.summaryDisplayEnabled?
this.lyrGroupedSummary:null,r),this.currentGrpLayer=r):(r=D(".grpSummaryDownLoadCSVButton",this.domNode))&&0<r.length&&(r[0].focus(),x.initFirstFocusNode(this.domNode,r[0]),x.initLastFocusNode(this.domNode,r[0]));break;case "closest":this._setLayerVisible(y,!0);this.lyrClosest.setVisibility(!0);0<this.incidents.length&&(y.closestInfo&&y.closestInfo.container&&(y.closestInfo.container.innerHTML="",c.add(y.closestInfo.container,"loading")),!1===y.updateFlag&&this.lyrClosest.clear(),y.closestInfo.updateForIncident(this.incidents,
this.config.maxDistance,this.lyrClosest));break;case "proximity":this._setLayerVisible(y,!0),this.lyrProximity.setVisibility(!0),0<this.incidents.length&&(y.proximityInfo&&y.proximityInfo.container&&(y.proximityInfo.container.innerHTML="",c.add(y.proximityInfo.container,"loading")),!1===y.updateFlag&&this.lyrProximity.clear(),y.proximityInfo.updateForIncident(this.incidents,this.buffers,this.lyrProximity))}y.updateFlag=!1},_setLayerVisible:function(r,y){this.disableVisibilityManagement||r.tabLayers&&
z.forEach(r.tabLayers,function(L){"undefined"!==typeof L.visible&&L.setVisibility(y);r&&r.jimuLayerInfo&&r.jimuLayerInfo.setTopLayerVisible&&r.jimuLayerInfo.setTopLayerVisible(y)})},_drawIncident:function(r,y,L,U){var ba=new E;r=Array.isArray(r)?r:[r];for(var ca=!1,da=[],la=[],ma=[],ia=0;ia<r.length;ia++){var ra=r[ia],ua=ra.geometry.type;null===this.symPoint&&this._getStyleColor();"point"===ua&&(U=!0,this._getIncidentAddress(ra.geometry));ca="polyline"===ua?this.isLineEditable:"polygon"===ua?this.isPolyEditable:
this.isPointEditable;U?ma.push(ra.geometry):da.push(this._updateGeom(ra.geometry));la.push({symbol:"polyline"===ua?this.symLine:"polygon"===ua?this.symPoly:this.symPoint,attributes:ra.attributes,infoTemplate:ra.infoTemplate})}U?(this._drawIncidentComplete(ma,la,ca,y,L),ba.resolve()):(new O(da)).then(F.hitch(this,function(wa){z.forEach(wa,function(sa){ma.push(sa[1])});this._drawIncidentComplete(ma,la,ca,y,L);ba.resolve()}));return ba},_drawIncidentComplete:function(r,y,L,U,ba){for(var ca=0;ca<r.length;ca++){var da=
y[ca];da=new M(r[ca],da.symbol,da.attributes,da.infoTemplate);this.incidents.push(da);this.lyrIncidents.add(da)}this._updatePanel(L);this.toolbar.deactivate();this._clickIncidentsButton(-1);this._bufferIncident(U,ba);this.clearIncident.focus()},_updatePanel:function(r){this.div_reversed_address.innerHTML="";b.setStyle(this.div_reverse_geocoding,"display","none");this.saveEnabled&&(c.remove(this.saveButton,"display-off"),(r=r&&this.userCanSave)&&c.contains(this.saveButton,"btnDisabled")&&(c.remove(this.saveButton,
"btnDisabled"),A.set(this.saveButton,"tabindex","0")),c.add(this.saveButton,r?"displayT":"displayT btnDisabled"));c.remove(this.saveOptions,"display-off");c.add(this.saveOptions,"displayT");c.remove(this.borderCol,"display-off");c.add(this.borderCol,"display-on");c.remove(this.clearIncident,"display-off");c.add(this.clearIncident,"display-on")},_updateGeom:function(r){var y=new E,L=r.spatialReference;this.config.drawGeodesic?this._getGeographicGeom(r).then(F.hitch(this,function(U){U=W.geodesicDensify(U,
5E3);if(l.canProject(U,L))y.resolve(l.project(U,L));else if(this.transformation){var ba=new g;ba.outSR=L;ba.geometries=[U];isNaN(this.transformation)||(ba.transformForward=!1);ba.transformation=this.transformation;try{this.gsvc.project(ba,F.hitch(this,function(ca){y.resolve(ca[0])}))}catch(ca){console.log(ca),y.resolve(r)}}else y.resolve(r)}),F.hitch(this,function(U){console.log(U);y.resolve(r)})):y.resolve(r);return y},_getIncidentAddress:function(r){this.incidentPoint=r;this.map.graphics.clear();
this._getGeographicGeom(r).then(F.hitch(this,function(y){this.locator.locationToAddress(y,100)}),function(y){console.log(y)})},_getGeographicGeom:function(r){var y=new E,L=new S(3857);l.canProject(r,L)?y.resolve(l.webMercatorToGeographic(l.project(r,L))):(L=u.buffer(r,100,9001),L={url:this.gsvc.url+"/findTransformations",content:{f:"json",inSR:r.spatialReference.wkid,outSR:4326,extentOfInterest:h.stringify(L.getExtent().toJson())},handleAs:"json",callbackParamName:"callback"},Ga(L,{usePost:!1}).then(F.hitch(this,
function(U){(U=U&&U.transformations?U.transformations:void 0)&&0<U.length&&(this.transformation=U[0].wkid?U[0].wkid:U[0].geoTransforms?U[0]:void 0);U=new g;U.outSR=new S(4326);U.geometries=[r];U.transformation=this.transformation;try{this.gsvc.project(U,F.hitch(this,function(ba){y.resolve(ba[0])}))}catch(ba){console.log(ba),y.resolve(r)}}),F.hitch(this,function(U){y.reject(U)})));return y},_showIncidentAddress:function(r){if(r.address.address){var y=r.address.address.Address,L=new T;L.family="Arial";
L.size="18px";L=new na(y,L,new aa("#000000"));L.setOffset(20,-4);L.horizontalAlignment="left";this.map.graphics.add(new M(this.incidentPoint,L,{}));this.div_reversed_address.innerHTML=y+"\x3c/br\x3e"+r.address.address.City+", "+r.address.address.Region+" "+r.address.address.Postal;b.setStyle(this.div_reverse_geocoding,"display","block")}},_onAddressError:function(){this.div_reversed_address.innerHTML=this.nls.reverse_geocoded_error;b.setStyle(this.div_reverse_geocoding,"display","block")},_bufferIncident:function(r,
y){var L=new E;if(0!==this.incidents.length&&this.spinnerValue.validate()){for(var U=0;U<this.config.tabs.length;U++)this.config.tabs[U].updateFlag=!0;this.buffers=[];this.lyrBuffer.clear();var ba=!1;U=[];for(var ca=0;ca<this.incidents.length;ca++){var da=this.incidents[ca],la=this.spinnerValue.get("value"),ma=this.config.distanceSettings[this.config.distanceUnits];if(0<la){var ia=da.geometry.spatialReference.wkid;if(this.config.drawGeodesic)if(4326===ia||da.geometry.spatialReference.isWebMercator()){var ra=
u.geodesicBuffer(da.geometry,la,ma);this.buffers.push(ra)}else U.push(this._updateGeom(da.geometry));else ra=u.buffer(da.geometry,la,ma),this.buffers.push(ra)}else r=!1,da=da.geometry.type,"polyline"!==da||ba||(ba=this.isLineEditable),"polygon"!==da||ba||(ba=this.isPolyEditable),"point"!==da||ba||(ba=this.isPointEditable)}0<U.length?(new O(U)).then(F.hitch(this,function(ua){z.forEach(ua,F.hitch(this,function(wa){ra=u.geodesicBuffer(wa[1],la,ma);this.buffers.push(ra)}));this._useBuffers(r,y,ba);L.resolve()})):
(this._useBuffers(r,y,ba),L.resolve());return L}},_useBuffers:function(r,y,L){0<this.buffers.length?(this.saveEnabled&&(c.remove(this.saveButton,"display-off"),c.contains(this.saveButton,"btnDisabled")&&this.isPolyEditable&&this.userCanSave&&(c.remove(this.saveButton,"btnDisabled"),A.set(this.saveButton,"tabindex","0")),c.add(this.saveButton,"displayT")),this._handleBuffers(this.symPoly,r)):(this.saveEnabled&&(L&&this.userCanSave?c.contains(this.saveButton,"btnDisabled")&&(c.remove(this.saveButton,
"btnDisabled"),A.set(this.saveButton,"tabindex","0")):(c.add(this.saveButton,"btnDisabled"),A.set(this.saveButton,"tabindex","-1"))),this.zoomToIncidents(y));setTimeout(F.hitch(this,function(){D(".noFeaturesActive",this.domNode).forEach(function(U){A.set(U,"tabindex","-1")});this._getLastNodeForEachTab(0)}),100)},_handleBuffers:function(r,y){this.bufferLookUp=[];for(var L=0;L<this.buffers.length;L++){var U=new M(this.buffers[L],r);this.lyrBuffer.add(U);this.bufferLookUp[L]=U}y||this._locateBuffer(u.union(this.buffers));
this._performAnalysis()},_performAnalysis:function(){this._updateCounts(!1);this._toggleTabLayersNew(this.curTab)},_updateCounts:function(r){for(var y=[],L=0;L<this.config.tabs.length;L++){r&&0<L&&this.panelNodes[L]&&(this.panelNodes[L].innerHTML="");var U=this.config.tabs[L],ba=this.tabNodes[L],ca=null,da=!1;U.advStat&&U.advStat.stats&&("undefined"!==typeof U.advStat.stats.tabCount?da=U.advStat.stats.tabCount:U.advStat.stats.count&&(da=!0));"proximity"===U.type?ca=U.proximityInfo:"closest"===U.type?
ca=U.closestInfo:"summary"===U.type?ca=U.summaryInfo:"groupedSummary"===U.type&&(ca=U.groupedSummaryInfo);ca&&(r?("undefined"!==typeof ca.incidentCount&&(ca.incidentCount=0),ca.updateTabCount(0,ba,da)):y.push(ca.queryTabCount(this.incidents,this.buffers,ba,da)))}(new O(y)).then(F.hitch(this,function(la){for(var ma=0,ia=0;ia<la.length;ia++){var ra=la[ia][1];isNaN(ra)||(ma+=ra)}this._updateBtnState(this.downloadAllButon,"btnDisabled",ma);this.userCanSnapshot&&this._updateBtnState(this.createSnapshotButton,
"btnDisabled",ma);this._getLastNodeForEachTab(0)}))},_updateBtnState:function(r,y,L){r&&(0===L?(c.add(r,y),A.set(r,"tabindex","-1")):c.contains(r,y)&&(c.remove(r,y),A.set(r,"tabindex","0")))},_verifyRouting:function(){if(this.config.enableRouting){this.config.enableRouting=!1;var r=this.appConfig.getConfigElementsByName("Directions");z.forEach(r,F.hitch(this,function(y){"Directions"===y.name&&(this.dirConfig=y,this.config.enableRouting=!0)}))}},_getAttributeTable:function(){var r=this.appConfig.getConfigElementsByName("AttributeTable");
z.forEach(r,F.hitch(this,function(y){"AttributeTable"===y.name&&(this.attributeTable=y)}))},zoomToIncidents:function(r){var y=!1;if(0<this.incidents.length){var L;1<this.buffers.length?L=u.union(this.buffers):1===this.buffers.length&&(L=this.buffers[0]);var U=this.incidents;if(L){y=!0;var ba=new M(L,L.spatialReference);U.push(ba)}this.geomExtent=Y.graphicsExtent(this.incidents);ba&&ba.destroy&&ba.destroy()}"undefined"===typeof r&&(this.geomExtent?this.map.setExtent(this.geomExtent.expand(1.5)):U&&
(r=U[0].geometry&&"point"===U[0].geometry.type?U[0].geometry:U[0].geometry.getCentroid(),this.map.centerAndZoom(r,this.config.defaultZoomLevel)));if(!y){for(r=0;r<this.incidents.length;r++)if("polygon"===this.incidents[r].geometry.type){y=!0;break}this._performAnalysis()}y&&this._performAnalysis()},zoomToLocation:function(r){var y;if(.5===this.config.defaultZoomLevel){if(0<this.buffers.length)var L=u.union(this.buffers)._extent;else if(0<this.incidents.length){for(var U=[],ba=[],ca=[],da=0;da<this.incidents.length;da++){var la=
this.incidents[da];switch(la.geometry.type){case "point":U.push(la.geometry._extent);break;case "polyline":ba.push(la.geometry);break;case "polygon":ca.push(la.geometry)}}da=[];0<U.length&&da.push(u.union(U)._extent);0<ba.length&&da.push(u.union(ba)._extent);0<ca.length&&da.push(u.union(ca)._extent);1<da.length?L=u.union(da)._extent:1===da.length&&(1<U.length||0<ba.length||0<ca.length)&&(L=da[0])}L&&(y=L.expand(.5))}"undefined"===typeof r&&(r=y.getCentroid());y&&this.map.setExtent(y);this.map.centerAt(r)},
routeToIncident:function(r){var y=this.incidents[0].geometry,L=y;"point"!==y.type&&(L=null);this.stops=[L,r];this.widgetManager.triggerWidgetOpen(this.dirConfig.id).then(F.hitch(this,function(U){if(U&&"closed"!==U.state){var ba=U._dijitDirections;ba?this._addStops(ba):U.getDirectionsDijit().then(F.hitch(this,function(ca){this._addStops(ca)}))}}))},_addStops:function(r){r.clearDirections();r.removeStops();r.reset();r.addStops(this.stops)},_getTabLayers:function(r){var y=[];z.forEach(this.opLayers._layerInfos,
F.hitch(this,function(L){if(0<L.newSubLayers.length)this._recurseOpLayers(L.newSubLayers,y,r);else{var U=this.hasLayerTitle?L.id:L.title;if(Array.isArray(r)?-1<r.indexOf(U):r===U)y.push(L.layerObject),"undefined"===typeof L.layerObject.visible||L.layerObject.visible||(L.layerObject.setVisibility(!0),L.layerObject.setVisibility(!1))}}));return y},_recurseOpLayers:function(r,y,L){z.forEach(r,F.hitch(this,function(U){if(0<U.newSubLayers.length)this._recurseOpLayers(U.newSubLayers,y,L);else{var ba=this.hasLayerTitle?
U.id:U.title;(Array.isArray(L)?-1<L.indexOf(ba):L===ba)&&y.push(U.layerObject)}}))},_setupSymbols:function(){var r=this.config.selectionColor?d.fromString(this.config.selectionColor):d.fromString(this.config.color);var y=r.toRgb();y.push(.2);var L=d.fromString("#000000");r=d.blendColors(r,L,.2).toRgb();L=new X(X.STYLE_SOLID,new d([255,255,255,.25]),1);this.symPoint=new ha(ha.STYLE_CIRCLE,20,L,new d([r[0],r[1],r[2],.7]));this.symLine=new X(X.STYLE_SOLID,new d([r[0],r[1],r[2],.7]),3);this.symPoly=new Z(Z.STYLE_SOLID,
this.symLine,new d([r[0],r[1],r[2],.3]));this.symBuffer=new Z(Z.STYLE_SOLID,L,new d(y));this.symSelection=new Z(Z.STYLE_NULL,new X(X.STYLE_SOLID,new d([0,255,255]),2),new d([0,0,0,0]))},onReceiveData:function(r,y,L){null!==L&&L.eventType&&("IncidentLocationAdd"===L.eventType?L.dataValue&&null!==L.dataValue&&(this._clickTab(0),null===this.symPoint?this.dataValue=L.dataValue:this._drawIncident(L.dataValue,void 0,void 0,!0)):"IncidentLocationRemove"===L.eventType?(r=this.incidents.indexOf(L.removeGraphic),
this.incidents.splice(r,1),this.lyrIncidents.remove(L.removeGraphic),this.bufferLookUp&&0<this.bufferLookUp.length&&(this.lyrBuffer.remove(this.bufferLookUp[r]),this.bufferLookUp.splice(r,1)),this.buffers&&0<this.buffers.length&&this.buffers.splice(r,1),this.incidents&&0<this.incidents.length?(this.config.tabs[this.curTab].updateFlag=!0,this._performAnalysis()):this._clear(!1)):"WebMapChanged"===L.eventType&&this._storeIncidents())},_storeIncidents:function(){if(0<this.incidents.length){for(var r=
[],y=0;y<this.incidents.length;y++)r.push(h.stringify(this.incidents[y].geometry.toJson()));r={location:h.stringify(r),hasBuffer:0<this.lyrBuffer.graphics.length,buffer_dist:this.spinnerValue.get("value"),unit:this.config.distanceUnits,curTab:this.curTab,extent:h.stringify(this.map.extent.toJson())};r=h.stringify(r);window.localStorage.setItem(this.Incident_Local_Storage_Key,r);console.log("Incident saved to storage")}},_restoreIncidents:function(){var r=window.localStorage.getItem(this.Incident_Local_Storage_Key);
if(null!==r&&"null"!==r){window.localStorage.setItem(this.Incident_Local_Storage_Key,null);var y=h.parse(r,!0),L=y.buffer_dist,U=h.parse(y.location);this.curTab=y.curTab;r=[];for(var ba=0;ba<U.length;ba++)r.push({geometry:w.fromJson(h.parse(U[ba]))});this.spinnerValue.set("value",L);for(L=0;L<this.config.tabs.length;L++)this.config.tabs[L].restore=!0;this._drawIncident(r,!0,!0,!0).then(F.hitch(this,function(){this._clickTab(0,!0);this._toggleTabs(y.curTab);this._toggleTabLayers(y.curTab);this.curTab=
y.curTab;this._clickIncidentsButton(-1);this._updateW();var ca=w.fromJson(h.parse(y.extent));u.equals(ca,this.map.extent)||this.map.setExtent(ca,!1)}))}else c.remove(this.saveOptions,"displayT"),c.add(this.saveOptions,"display-off"),c.remove(this.borderCol,"display-on"),c.add(this.borderCol,"display-off"),c.remove(this.clearIncident,"display-on"),c.add(this.clearIncident,"display-off")},_updateW:function(){for(var r=0,y=0;y<this.tabNodes.length;y++)r+=C.position(this.tabNodes[y]).w;r+=10;e.set(this.tabsNode,
"width",r+"px");r>C.position(this.footerNode).w&&(e.set(this.footerContentNode,window.isRTL?"left":"right","58px"),window.isRTL?(e.set(this.panelLeft,"display","block"),e.set(this.panelRight,"display","none")):e.set(this.panelRight,"display","block"))},_mapResize:function(){var r=e.getComputedStyle(this.map.container);if(r){var y=this._getSAPanelHeight();r=parseFloat(r.bottom.replace("px",""));if("opened"===this.state||"active"===this.state){var L=this._getAttributeTableHeight();L>y&&(y=L);r<=y&&
B.publish("changeMapPosition",{bottom:y})}}},_onMapPositionChange:function(r){r&&(this.left=r.left,this.right=r.right,isFinite(this.left)&&"number"===typeof this.left&&e.set(this.domNode,window.isRTL?"right":"left",parseFloat(this.left)+"px"),isFinite(this.right)&&"number"===typeof this.right&&e.set(this.domNode,window.isRTL?"left":"right",parseFloat(this.right)+"px"));this._onPanelScroll()},_resetMapPosition:function(){B.publish("changeMapPosition",{bottom:this._getAttributeTableHeight()})},_getSAPanelHeight:function(){var r=
parseInt(this.position.height.toString().replace("px",""),10),y=parseInt(this.position.bottom.toString().replace("px",""),10);return r+y},_getAttributeTableHeight:function(){var r=parseInt(this.position.bottom.toString().replace("px",""),10);if(this.attributeTable){var y=m.byId(this.attributeTable.id);y&&(y=e.getComputedStyle(y))&&y.height&&(r+=parseInt(y.height.toString().replace("px",""),10))}return r},_resize:function(r){try{this._onPanelScroll(this.curTab),this.hideContainer&&this._handlePopup(),
this._clearMobileSetAsIncidentStyle(),this._resetInfoWindow(!1),this._initEditInfo(),this._checkHideContainer()}catch(y){console.log(y)}},_onPanelScroll:function(r){r=this.footerContentNode.getBoundingClientRect();if(window.isRTL){for(var y=0;y<this.tabsNode.children.length;y++){var L=this.tabsNode.children[y];L=L.getBoundingClientRect();L=L.right;L=parseFloat(L.toString().split(".")[0]);if(L<=r.right){var U=y;var ba=L;break}}for(y=0;y<this.tabsNode.children.length;y++)if(L=this.tabsNode.children[y],
L=L.getBoundingClientRect(),L=L.left,L<r.left){var ca=y;break}r=this.footerContentNode;y=0;"TabTheme"===this.appConfig.theme.name&&(y+=this.right);y=1<=U||ba<y;e.set(r,"right",y?"34px":"0px");e.set(this.panelRight,"display",y?"block":"none");e.set(this.panelRight,"width",y?"34px":"0px");U=ca<=this.tabsNode.children.length;e.set(r,"left",U?"58px":"24px");e.set(this.panelLeft,"display",U?"block":"none");e.set(this.panelLeft,"width",U?"34px":"0px");c.contains(this.clearIncident,"display-off")&&(e.set(this.panelLeft,
"display","none"),e.set(this.panelRight,"display","none"))}else{for(y=0;y<this.tabsNode.children.length;y++)if(L=this.tabsNode.children[y],L=L.getBoundingClientRect(),L=window.isRTL?L.right:L.left,0<=L){U=y;ba=L;break}for(y=0;y<this.tabsNode.children.length;y++)if(L=this.tabsNode.children[y],L=L.getBoundingClientRect(),L=window.isRTL?L.left:L.right,L>(window.isRTL?r.left:r.right)){ca=y;break}r=this.footerContentNode;y=ca<=this.tabsNode.children.length;e.set(r,window.isRTL?"left":"right",y?"58px":
"24px");e.set(this.panelRight,"display",y?"block":"none");y=0;"TabTheme"===this.appConfig.theme.name&&(y+=window.isRTL?this.right:this.left);U=1<=U||ba<y;e.set(r,window.isRTL?"right":"left",U?"34px":"0px");e.set(this.panelLeft,"display",U?"block":"none");e.set(this.panelLeft,"width",U?"34px":"0px")}},_scrollToTab:function(r){var y=C.position(this.footerContentNode).w;if(C.position(this.tabsNode).w>y){var L=C.getMarginBox(this.tabNodes[r]);this.footerContentNode.scrollLeft=L.l-(y-L.w)/2}this._onPanelScroll(r)},
_navLeft:function(r){},_navRight:function(r){},_navTabsLeft:function(r){this._navTabs(!1)},_navTabsRight:function(r){this._navTabs(!0)},_navTabs:function(r){var y=this.footerContentNode.getBoundingClientRect();if(window.isRTL)for(var L=this.tabsNode.children.length-1;0<=L;L--){var U=this.tabsNode.children[L];U=U.getBoundingClientRect();if(r){if(U.right>y.right){this._scrollToTab(L);break}}else if(0<U.right){this._scrollToTab(L);break}}else for(L=0;L<this.tabsNode.children.length;L++)if(U=this.tabsNode.children[L],
U=U.getBoundingClientRect(),r){if(U.right>y.right){this._scrollToTab(L);break}}else if(0<U.right){this._scrollToTab(L);break}},_storeInitalVisibility:function(){z.forEach(this.config.tabs,F.hitch(this,function(r){z.forEach(r.tabLayers,F.hitch(this,function(y){"undefined"!==typeof y.visible&&(!y.id||y.id in this.initalLayerVisibility||(this.initalLayerVisibility[y.id]=y.visible),y.setVisibility(!1));r&&r.jimuLayerInfo&&r.jimuLayerInfo.setTopLayerVisible&&(y=r.jimuLayerInfo.isShowInMap(),this.initalLayerVisibility.hasOwnProperty(r.jimuLayerInfo.id)||
(this.initalLayerVisibility[r.jimuLayerInfo.id]=y),y&&r.jimuLayerInfo.setTopLayerVisible(!1))}))}))},_resetInitalVisibility:function(){z.forEach(this.config.tabs,F.hitch(this,function(r){z.forEach(r.tabLayers,F.hitch(this,function(y){"undefined"!==typeof y.visible&&y.id&&y.id in this.initalLayerVisibility&&(y.setVisibility(this.initalLayerVisibility[y.id]),y.hasOwnProperty("visible")&&(y.visible=this.initalLayerVisibility[y.id]),y.redraw?y.redraw():y.refresh&&y.refresh());r&&r.jimuLayerInfo&&r.jimuLayerInfo.setTopLayerVisible&&
r.jimuLayerInfo.isShowInMap()!==this.initalLayerVisibility[r.jimuLayerInfo.id]&&r.jimuLayerInfo.setTopLayerVisible(this.initalLayerVisibility[r.jimuLayerInfo.id])}))}));this.initalLayerVisibility=[]},_clearGraphics:function(){z.forEach(this.config.tabs,F.hitch(this,function(r){if("summary"===r.type&&r.tabLayers&&1<r.tabLayers.length)for(var y=1;y<r.tabLayers.length;y++)r.tabLayers.pop()}))},_resetInfoWindow:function(r){this.defaultPointContent&&this.pointEditLayer.infoTemplate.setContent(this.defaultPointContent);
this.defaultLineContent&&this.lineEditLayer.infoTemplate.setContent(this.defaultLineContent);this.defaultPolyContent&&this.polyEditLayer.infoTemplate.setContent(this.defaultPolyContent);this.defaultPopupSize&&this.map.infoWindow.resize(this.defaultPopupSize.width,"auto");(!this._isAndroid()||r)&&this.map.infoWindow.isShowing&&this.map.infoWindow.hide()},_close:function(){this.widgetManager.closeWidget(this.id)},_downloadAll:function(){for(var r=this.downloadAllButon.classList?this.downloadAllButon.classList:
this.downloadAllButon.className.split(" "),y=!0,L=0;L<r.length;L++)if("btnDisabled"===r[L]){y=!1;break}y&&(this._updateProcessing(this.downloadAllButon,!0,this.downloadAllSrc),this._verifyIncident(!1)&&(r=this._getAnalysisObjects(),(new za(this)).createDownloadZip(r,this.incidents,this.buffers).then(F.hitch(this,function(U){this._updateProcessing(this.downloadAllButon,!1,this.downloadAllSrc);setTimeout(F.hitch(this,function(){this.downloadAllButon.focus()}),1E3)}),function(U){this._updateProcessing(this.downloadAllButon,
!1,this.downloadAllSrc);new J({message:U.message})})));setTimeout(F.hitch(this,function(){this.downloadAllButon.focus()}),1E3)},_updateProcessing:function(r,y,L){b.setAttr(r,"src",y?this.processingSrc:L)},_getAnalysisObjects:function(){var r=["proximity","closest","summary","groupedSummary"],y=[];z.forEach(this.config.tabs,function(L){if(-1<r.indexOf(L.type)){switch(L.type){case "proximity":var U=L.proximityInfo;break;case "closest":U=L.closestInfo;break;case "summary":U=L.summaryInfo;break;case "groupedSummary":U=
L.groupedSummaryInfo}var ba="undefined"!==typeof L.layerTitle?L.layerTitle:L.layers;y.push({layerObject:L.tabLayers[0],label:""!==L.label?L.label:ba,analysisObject:U,type:L.type})}});return y.reverse()},_verifyIncident:function(r,y){if(0===this.buffers.length){for(var L=!1,U=0;U<this.incidents.length;U++)if("polygon"===this.incidents[U].geometry.type){L=!0;break}L||(L=0<this.config.tabs.filter(function(ba){return"closest"===ba.type}).length&&0<parseInt(this.config.maxDistance,10));L||(new J({message:r?
this.nls.notPolySnapShot:y?this.nls.notPolyReport:this.nls.notValidDownload}),this._updateProcessing(r?this.createSnapshotButton:y?this.createReportButton:this.downloadAllButon,!1,r?this.snapshotSrc:y?this.reportSrc:this.downloadAllSrc));return L}return!0},_createSnapshot:function(){for(var r=this.createSnapshotButton.classList?this.createSnapshotButton.classList:this.createSnapshotButton.className.split(" "),y=!0,L=0;L<r.length;L++)if("btnDisabled"===r[L]){y=!1;break}y&&this._verifyIncident(!0)&&
this._getName("snapshot").then(F.hitch(this,function(U){if(U&&"cancel"!==U){this._updateProcessing(this.createSnapshotButton,!0,this.snapshotSrc);var ba=[];0<this.buffers.length&&ba.push({graphics:this.lyrBuffer.graphics,label:1<this.buffers.length?this.nls.buffers:this.nls.buffer});ba.push({graphics:this.incidents,label:1<this.incidents.length?this.nls.incidents:this.nls.incident});(new za(this)).createSnapShot({layers:ba.concat(this._getAnalysisObjects()),incidents:this.incidents,buffers:this.buffers,
time:Date.now(),name:U.name,groups:U.groups}).then(F.hitch(this,function(ca){this.busyIndicator.hide();this._updateProcessing(this.createSnapshotButton,!1,this.snapshotSrc)}),F.hitch(this,function(ca){this._updateProcessing(this.createSnapshotButton,!1,this.snapshotSrc);new J({message:ca.message});this.busyIndicator.hide()}))}else this._updateProcessing(this.createSnapshotButton,!1,this.snapshotSrc);this.createSnapshotButton.focus()}))},_initReportDijit:function(r){var y="";r.logo&&(y=r.logo,y=-1<
y.indexOf("${appPath}")?R.substitute(y,{appPath:this.folderUrl.slice(0,this.folderUrl.lastIndexOf("widgets"))}):y);this.reportDijit=new v({alignNumbersToRight:window.isRTL,reportLogo:y,appConfig:this.appConfig,footNotes:r.footnote,printTaskUrl:r.printTaskURL,reportLayout:r.reportLayout,styleSheets:[this.folderUrl+"/css/reportDijitOverrides.css"],styleText:".esriCTTable th{background-color: "+r.textColor+"; color: "+this.getTextColor(r.textColor)+";} .esriCTSectionTitle{color: black;} .esriCTHTMLData{height:100%;}",
maxNoOfCols:7});this.own(k(this.reportDijit,"reportError",F.hitch(this,function(){new J({message:window.jimuNls.common.error})})))},getTextColor:function(r){r=(new a(r)).toRgb();return.5>1-(.299*r[0]+.587*r[1]+.114*r[2])/255?"#000":"#fff"},_getName:function(r){var y=new E,L=new La({nls:this.nls,type:r,pageUtils:H,storedProps:this._getStoredPropData("SA-REPORT-PROPS"),portalUrl:this.appConfig.portalUrl}),U=new Ea({autoHeight:!0,content:L,titleLabel:"report"===r?this.nls.report_name:this.nls.snapshot_name,
invalidMessage:"report"===r?this.nls.invalid_report_name:this.nls.invalid_snapshot_name});L.initWidth();this.own(k(L,"ok",F.hitch(this,function(ba){L.destroy();L=null;U.close();"report"!==r&&this.busyIndicator.show();this._storePropData("SA-REPORT-PROPS",ba);y.resolve(ba)})));this.own(k(L,"cancel",F.hitch(this,function(){L.destroy();L=null;U.close();y.resolve("cancel")})));return y},_storePropData:function(r,y){window.localStorage.setItem(r,h.stringify(y))},_getStoredPropData:function(r){return window.localStorage.getItem(r)},
_createReport:function(){this.reportEnabled&&this._verifyIncident(!1,!0)&&(this._updateProcessing(this.createReportButton,!0,this.reportSrc),this._getReportData().then(F.hitch(this,function(r){this._updateProcessing(this.createReportButton,!1,this.reportSrc);this._getName("report").then(F.hitch(this,function(y){if(y&&"cancel"!==y){this._updateProcessing(this.createReportButton,!0,this.reportSrc);this._initReportDijit(F.mixin(this.config.reportSettings,y));for(var L,U=0;U<r.length;U++){var ba=r[U];
if("map"===ba.type){L=U;ba.printTemplate=this._getPrintTemplate();break}}y.comments&&""!==y.comments&&r.splice(L+1,0,{type:"html",data:"\x3cp style\x3d'white-space: pre-wrap;'\x3e"+y.comments+"\x3c/p\x3e"});this.reportDijit.maxNoOfCols="Landscape"===y.reportLayout.orientation.Type?12:7;this.reportDijit.print(y.name,r)}this._updateProcessing(this.createReportButton,!1,this.reportSrc);this.createReportButton.focus()}))})))},_getReportData:function(r){var y=new E,L=[];L.push({addPageBreak:!0,type:"map",
map:this.map});r=this._getAnalysisObjects().reverse();var U=this.nls;(new za(this))._performAnalysis(r,this.incidents,this.buffers,!1,!0).then(function(ba){z.forEach(ba,F.hitch(this,function(ca){if(ca){var da=[],la=[],ma=[];if(!ca.context.tab.advStat.hasOwnProperty("analysisSummaryForReport")||ca.context.tab.advStat.hasOwnProperty("analysisSummaryForReport")&&ca.context.tab.advStat.analysisSummaryForReport){for(var ia=ca.context.tab.type,ra="summary"===ia?U.summary:"closest"===ia?U.closest:"proximity"===
ia?U.proximity:U.groupedSummary,ua="proximity"===ia?ca.reportResults:ca.analysisResults,wa=0;wa<ua.length;wa++){var sa=ua[wa];if("summary"!==ia&&"groupedSummary"!==ia)ma=[],0===wa&&z.forEach(sa,function(va){da.push(va.label)}),z.forEach(sa,function(va){ma.push(va.value)}),la.push(ma);else if("summary"===ia){var Aa=[];z.forEach(ca.context.calcFields,function(va){Aa.push(va.alias?va.alias:va.field)});0<Aa.length&&-1<Aa.indexOf(sa.info.replace("\x3cbr/\x3e",""))&&(da.push(sa.info.replace("\x3cbr/\x3e",
"")),ma.push(sa.num))}else da.push(-1===["",null,void 0].indexOf(sa.a)?sa.a+" "+sa.info:sa.info),ma.push(sa.total)}"summary"!==ia&&"groupedSummary"!==ia||la.push(ma);L.push({title:ca.context.baseLabel+" ("+ra+")",addPageBreak:!1,type:"table",data:{cols:da,rows:la}})}if(!ca.context.tab.advStat.hasOwnProperty("PopUpSummaryForReport")||ca.context.tab.advStat.hasOwnProperty("PopUpSummaryForReport")&&ca.context.tab.advStat.PopUpSummaryForReport){var ya={};da=[];la=[];ma=[];ia=Da.getPopupFields(ca.context.tab);
if(0<ia.length){z.forEach(ia,function(va){ya[va.expression]=va.label});for(ia=0;ia<ca.graphics.length;ia++){ma=[];var Ba=ca.graphics[ia].attributes;ra=Object.keys(Ba);0===ia&&z.forEach(ra,function(va){ya.hasOwnProperty(va)&&da.push(ya[va])});z.forEach(ra,function(va){ya.hasOwnProperty(va)&&ma.push(Da.getFieldValue(va,Ba[va],ca.context.specialFields,ca.context.dateFields,ca.context.defaultDateFormat,ca.context.typeIdField,ca.context.types,ca.context.layerObject&&ca.context.layerObject.renderer?ca.context.layerObject:
ca.context.layerDefinition,Ba))});la.push(ma)}L.push({title:ca.context.baseLabel,addPageBreak:!1,type:"table",data:{cols:da,rows:la}})}}}}));y.resolve(L)},function(ba){this._updateProcessing(this.createReportButton,!1,this.reportSrc);new J({message:ba.message})});return y},_getPrintTemplate:function(){var r=[];var y=new ka;this.reportDijit._printService.legendAll=!0;this.reportDijit._printService._getPrintDefinition(this.map,y);z.forEach(this.reportDijit._printService.allLayerslegend,F.hitch(this,
function(L){if(L.id!==this.lyrIncidents.id&&L.id!==this.lyrBuffer.id){var U=new pa;U.layerId=L.id;L.subLayerIds&&(U.subLayerIds=L.subLayerIds);r.push(U)}}));this.reportDijit._printService.legendAll=!1;y.layoutOptions={legendLayers:r,customTextElements:[{Date:(new Date).toLocaleString()}]};y=this.reportDijit.setMapLayout(y);y.preserveScale=!1;y.showAttribution=!0;y.format="jpg";return y},_isAndroid:function(){return-1<navigator.userAgent.toLowerCase().indexOf("android")}})});