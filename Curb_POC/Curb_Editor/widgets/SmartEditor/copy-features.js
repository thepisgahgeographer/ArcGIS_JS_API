// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/SmartEditor/copy-features.html":'\x3cdiv class\x3d"esriCTSelectFeaturesContainer"\x3e\r\n  \x3cdiv style\x3d"height: 100%; width: 100%;"\x3e\r\n    \x3cdiv class\x3d"esriCTCopyFeaturesListTitle"\x3e${nls.copyFeatures.title}\x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTCopyFeaturesHint" data-dojo-attach-point\x3d"warningMessage" tabindex\x3d"0" role\x3d"presentation" aria-label\x3d"${nls.copyFeatures.multipleFeatureSaveWarning}"\x3e${nls.copyFeatures.multipleFeatureSaveWarning}\x3c/div\x3e\r\n    \x3cdiv style\x3d"width: 100; margin-bottom: 5px;" data-dojo-attach-point\x3d"applyEditsProgressParentNode"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"esriCTCopyFeaturesListContent" data-dojo-attach-point\x3d"layerListTable"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTCopyFeaturesBtnContainer"\x3e\r\n      \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"esriCTCopyFeaturesBtn jimu-btn" data-dojo-attach-point\x3d"createMultipleFeaturesBtn" aria-label\x3d"${nls.copyFeatures.createFeatures}" title\x3d"${nls.copyFeatures.createFeatures}"\x3e${nls.copyFeatures.createFeatures}\x3c/div\x3e\r\n      \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"esriCTCopyFeaturesBtn jimu-btn" data-dojo-attach-point\x3d"createSingleFeatureBtn" aria-label\x3d"${nls.copyFeatures.createSingleFeature}"  title\x3d"${nls.copyFeatures.createSingleFeature}"\x3e${nls.copyFeatures.createSingleFeature}\x3c/div\x3e\r\n      \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"esriCTCopyFeaturesBtn jimu-btn" data-dojo-attach-point\x3d"cancelBtn" aria-label\x3d"${nls.cancel}" title\x3d"${nls.cancel}"\x3e${nls.cancel}\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/declare dojo/Evented dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/on dojo/keys jimu/dijit/CheckBox dojo/dom-class dojo/dom-attr ./highlightSymbolUtils esri/layers/GraphicsLayer dojo/text!./copy-features.html jimu/dijit/Message esri/tasks/query esri/tasks/QueryTask dojo/Deferred dojo/promise/all jimu/dijit/LoadingIndicator dijit/ProgressBar dojo/dom-style".split(" "),function(w,x,y,z,e,h,q,m,p,A,l,k,B,C,D,t,E,F,u,v,G,H,r){return y([w,
z,x],{templateString:D,layerLabel:null,featuresList:null,checkBoxNodes:{},layerCheckBoxNodes:{},featuresByLayerId:{},featureTitlesByLayerId:{},highlightGraphicsLayer:null,allChildCheckboxes:[],loading:null,startup:function(){this.inherited(arguments);this.highlightGraphicsLayer=this._createNewGraphicsLayer("highlightGraphicsLayer");this.loading=new G({hidden:!0});this.loading.placeAt(this.parentDomNode)},postCreate:function(){this.checkBoxNodes={};this.layerCheckBoxNodes={};this.featuresByLayerId=
{};this.featureTitlesByLayerId={};this.highlightGraphicsLayer=null;this.applyEditsProgress=new H(null,this.applyEditsProgressParentNode);r.set(this.applyEditsProgress.domNode,"display","none");this.own(m(this.cancelBtn,"click",e.hitch(this,function(){this.cancelBtnClicked()})));this.own(m(this.cancelBtn,"keydown",e.hitch(this,function(a){a.keyCode!==p.ENTER&&a.keyCode!==p.SPACE||this.cancelBtnClicked()})));this.own(m(this.createMultipleFeaturesBtn,"click",e.hitch(this,this._createMultipleFeaturesBtnClicked)));
this.own(m(this.createMultipleFeaturesBtn,"keydown",e.hitch(this,function(a){a.keyCode!==p.ENTER&&a.keyCode!==p.SPACE||this._createMultipleFeaturesBtnClicked()})));this.own(m(this.createSingleFeatureBtn,"click",e.hitch(this,this._createSingleFeatureBtnClicked)));this.own(m(this.createSingleFeatureBtn,"keydown",e.hitch(this,function(a){a.keyCode!==p.ENTER&&a.keyCode!==p.SPACE||this._createSingleFeatureBtnClicked()})))},selectFeaturesToCopy:function(a){this.allChildCheckboxes=[];if(a&&0<a.length){this.checkBoxNodes=
{};this.layerCheckBoxNodes={};this.featuresByLayerId={};this.featureTitlesByLayerId={};this._changeWarningNote(a[0]._layer.geometryType);this._showHideSingleFeatureButton(a[0]._layer.geometryType);this._showHideMultipleFeatureButton(a[0]._layer.geometryType);l.remove(this.mainNode,"esriCTHidden");var c=new u;this._processSelectedFeatures(a,c).then(e.hitch(this,function(){q.empty(this.layerListTable);for(var b in this.featureTitlesByLayerId){var d=this.layerInfosObj.getLayerInfoById(b);d=d.title?d.title:
d.name;var f=q.create("div",{},this.layerListTable);this.layerCheckBoxNodes[b]=this._createListNode(d,f,!1,b,a[0]._layer.geometryType);this.checkBoxNodes[b]||(this.checkBoxNodes[b]=[]);0<this.featureTitlesByLayerId[b].length&&this._createFeatureEntries(b,f,a[0]._layer.geometryType)}this._highlightFeatures();this.updateSingleFeatureButtonText()}))}},_processSelectedFeatures:function(a,c){var b={},d,f;this.featuresByLayerId={};this.featureTitlesByLayerId={};h.forEach(a,e.hitch(this,function(g){this.featuresByLayerId[g._layer.id]||
(this.featuresByLayerId[g._layer.id]=[],this.featureTitlesByLayerId[g._layer.id]=[]);this.featuresByLayerId[g._layer.id].push(g);var n=this.layerInfosObj.getLayerInfoById(g._layer.id).layerObject.objectIdField;n=g.getTitle()?g.getTitle():g.attributes[n];this.featureTitlesByLayerId[g._layer.id].push(n)}));this.loading.show();for(f in this.featuresByLayerId)f&&(a=this._getObjectIdFieldOfLayer(f),a=this._getSelectedFeatureObjectIds(this.featuresByLayerId[f],a),b[f]=this._getFeatureByChunks(f,a));v(b).then(e.hitch(this,
function(g){for(d in g)d&&this._updateGeometryForSelectedFeature(d,g);this._highlightFeatures();setTimeout(e.hitch(this,function(){this.loading.hide()}),1E3)}),e.hitch(this,function(){this.loading.hide();t({message:this.nls.copyFeatures.copyFeatureUpdateGeometryError})}));return c.resolve(null)},_getObjectIdFieldOfLayer:function(a){return this.layerInfosObj.getLayerInfoById(a).layerObject.objectIdField},_updateGeometryForSelectedFeature:function(a,c){var b=this._getObjectIdFieldOfLayer(a);h.forEach(this.featuresByLayerId[a],
e.hitch(this,function(d){h.some(c[a],e.hitch(this,function(f){if(f.attributes[b]===d.attributes[b])return d.geometry=f.geometry,!0}))}))},_getSelectedFeatureObjectIds:function(a,c){var b=[];h.forEach(a,e.hitch(this,function(d){b.push(d.attributes[c])}));return b},_getFeatureByChunks:function(a,c){var b=this.layerInfosObj.getLayerInfoById(a);var d=new u;var f=[];for(b=null===b.layerObject.url||""===b.layerObject.url?c.length:b.layerObject.maxRecordCount||999;0<c.length;)f.push(this._getSelectedFeatureGeometry(a,
c.splice(0,b)));v(f).then(e.hitch(this,function(g){var n=[];h.forEach(g,e.hitch(this,function(I){n=n.concat(I.features)}));d.resolve(n)}));return d.promise},_getSelectedFeatureGeometry:function(a,c){var b=this.layerInfosObj.getLayerInfoById(a);a=new F(b.getUrl());var d=new E;d.outFields=[b.layerObject.objectIdField];d.objectIds=c;d.returnGeometry=!0;d.outSpatialReference=this.map.spatialReference;return(null===b.layerObject.url||""===b.layerObject.url?b.layerObject.queryFeatures(d):a.execute(d)).promise},
_createFeatureEntries:function(a,c,b){h.forEach(this.featureTitlesByLayerId[a],e.hitch(this,function(d){d=this._createListNode(d,c,!0,a,b);this.checkBoxNodes[a].push(d);this.allChildCheckboxes.push(d)}))},_createListNode:function(a,c,b,d,f){c=q.create("div",{"class":"jimu-widget-row esriCTCopyFeaturesNode"},c);var g=q.create("div",{"class":"jimu-float-leading checkBoxNode"},c);f="esriGeometryPoint"===f&&this.hideMultipleFeatureButton?!1:!0;a=new A({label:a,checked:f},g);b?(l.add(c,"esriCTCopyFeaturesChildNode"),
k.set(a.domNode,"parentLayerId",d),m(a.domNode,"click",e.hitch(this,this._childNodeStateChanged))):(k.set(a.domNode,"layerId",d),f||a.setStatus(!1),m(a.domNode,"click",e.hitch(this,this._parentNodeStateChanged)));return a},_parentNodeStateChanged:function(a){var c=k.get(a.currentTarget,"layerId");a=this.layerCheckBoxNodes[c];if(a.getStatus()){c=this.checkBoxNodes[c];var b=a.getValue();h.forEach(c,e.hitch(this,function(d){b?d.setValue(!0):d.setValue(!1)}));this._highlightFeatures()}this.updateSingleFeatureButtonText()},
_childNodeStateChanged:function(a){var c=k.get(a.currentTarget,"parentLayerId"),b=this.layerCheckBoxNodes[c];c=this.checkBoxNodes[c];var d=!0;b.getStatus()||h.forEach(this.allChildCheckboxes,e.hitch(this,function(f){f.getValue()&&f.domNode!==a.currentTarget&&f.setValue(!1)}));this._highlightFeatures();h.some(c,e.hitch(this,function(f){if(!f.getValue())return d=!1,!0}));b.setValue(d);this.updateSingleFeatureButtonText()},updateSingleFeatureButtonText:function(){var a=0;h.some(this.allChildCheckboxes,
e.hitch(this,function(c){c.getValue()&&a++;if(1<a)return!0}));1===a||1===this.allChildCheckboxes.length?(k.set(this.createSingleFeatureBtn,"innerHTML",this.nls.copyFeatures.createOneSingleFeature),k.set(this.createSingleFeatureBtn,"aria-label",this.nls.copyFeatures.createOneSingleFeature),k.set(this.createSingleFeatureBtn,"title",this.nls.copyFeatures.createOneSingleFeature),l.add(this.createMultipleFeaturesBtn,"esriCTCanCreateOnlyOneFeature"),this.isPointGeometryFeatures&&l.remove(this.createSingleFeatureBtn,
"esriCTHidden")):(k.set(this.createSingleFeatureBtn,"innerHTML",this.nls.copyFeatures.createSingleFeature),k.set(this.createSingleFeatureBtn,"aria-label",this.nls.copyFeatures.createSingleFeature),k.set(this.createSingleFeatureBtn,"title",this.nls.copyFeatures.createSingleFeature),l.remove(this.createMultipleFeaturesBtn,"esriCTCanCreateOnlyOneFeature"),this.isPointGeometryFeatures&&l.add(this.createSingleFeatureBtn,"esriCTHidden"))},cancelBtnClicked:function(){l.add(this.mainNode,"esriCTHidden");
this.highlightGraphicsLayer.clear();this.emit("cancelBtnClicked")},_createMultipleFeaturesBtnClicked:function(){var a=[],c;(c=this._getSelectedFeaturesForCopy())&&0<c.length&&(h.forEach(c,e.hitch(this,function(b){b&&b.geometry&&a.push(b)})),this.emit("createMultipleFeatures",a))},_createSingleFeatureBtnClicked:function(){var a;(a=this._getSelectedFeaturesForCopy())&&0<a.length&&this.emit("createSingleFeature",a)},_validateSelectedFeature:function(a){(!a||0>=a.length)&&t({message:this.nls.copyFeatures.selectFeatureToCopyMessage})},
_getSelectedFeaturesForCopy:function(){var a,c=[];for(a in this.featuresByLayerId){var b=this._getSelectedFeaturesByLayerId(a);0<b.length&&(c=c.concat(b))}this._validateSelectedFeature(c);return c},_getSelectedFeaturesByLayerId:function(a){var c=[];h.forEach(this.checkBoxNodes[a],e.hitch(this,function(b,d){b.getValue()&&c.push(this.featuresByLayerId[a][d])}));return c},_showHideSingleFeatureButton:function(a){"esriGeometryPoint"===a?(this.isPointGeometryFeatures=!0,l.add(this.createSingleFeatureBtn,
"esriCTHidden")):(this.isPointGeometryFeatures=!1,l.remove(this.createSingleFeatureBtn,"esriCTHidden"))},_showHideMultipleFeatureButton:function(a){"esriGeometryPoint"!==a&&this.hideMultipleFeatureButton?l.add(this.createMultipleFeaturesBtn,"esriCTHidden"):l.remove(this.createMultipleFeaturesBtn,"esriCTHidden")},_createNewGraphicsLayer:function(a){var c={};if(a+=this.widgetId)this.map._layers[a]&&this.map.removeLayer(this.map._layers[a]),c={id:a};a=new C(c);this.map.addLayer(a);return a},_highlightFeatures:function(){this.highlightGraphicsLayer.clear();
for(var a in this.featureTitlesByLayerId)this._highlightSingleLayerFeatures(a)},_highlightSingleLayerFeatures:function(a){var c=this.map.getLayer(a);a=this._getSelectedFeaturesByLayerId(a);h.forEach(a,e.hitch(this,function(b){b=B.getHighLightSymbol(b,c);this.highlightGraphicsLayer.add(b)}))},_changeWarningNote:function(a){a="esriGeometryPoint"===a&&this.hideMultipleFeatureButton?this.nls.copyFeatures.canNotSaveMultipleFeatureWarning:"esriGeometryPoint"!==a&&this.hideMultipleFeatureButton?this.nls.copyFeatures.createOnlyOneMultipartFeatureWarning:
this.nls.copyFeatures.multipleFeatureSaveWarning;k.set(this.warningMessage,"innerHTML",a);k.set(this.warningMessage,"aria-label",a)},setProgressPercentage:function(a){a=parseFloat(a.toFixed());0>=a?(this.applyEditsProgress.set({value:0}),r.set(this.applyEditsProgress.domNode,"display","block")):100<=a?(this.applyEditsProgress.set({value:100}),r.set(this.applyEditsProgress.domNode,"display","none")):this.applyEditsProgress.set({value:a})}})});