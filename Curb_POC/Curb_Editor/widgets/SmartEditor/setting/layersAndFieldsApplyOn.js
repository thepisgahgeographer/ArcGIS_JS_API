// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/SmartEditor/setting/layerAndFieldsApplyOn.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"esriCTSearchFieldNode" data-dojo-attach-point \x3d "searchNode"\x3e\x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point \x3d "layerAndFieldsMainDiv"\x3e\x3c/div\x3e\r\n  \x3cdiv style\x3d"margin-top: 5px;" class\x3d"esriCTHidden" data-dojo-attach-point \x3d "domainFieldHintMsg"\x3e\r\n    \x3cdiv class\x3d"esriCTDomainlistDiv"\x3e*\x3c/div\x3e\r\n    \x3cdiv\x3e${nls.actionPage.domainListTitle}\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/declare dojo/Evented dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/on jimu/BaseWidgetSetting dijit/_TemplatedMixin jimu/dijit/CheckBox jimu/utils dojo/dom-attr dojo/dom-class dojo/query dojo/string dojo/dom-style dijit/form/ValidationTextBox dojo/text!./layerAndFieldsApplyOn.html dijit/form/CheckBox dijit/registry".split(" "),function(z,A,l,m,n,u,B,C,w,D,t,q,k,x,E,F,G,y,H){return z([B,A,C],{baseClass:"jimu-widget-smartEditor-setting-layersAndFieldsApplyOn",templateString:G,
checkBoxNodes:null,layerCheckBoxNodes:null,showDomainFieldIndicator:!1,searchTextBox:null,defalutFieldInfos:[{actionName:"Intersection",enabled:!1,fields:[]},{actionName:"Address",enabled:!1},{actionName:"Coordinates",enabled:!1,coordinatesSystem:"MapSpatialReference",field:"x"},{actionName:"Preset",enabled:!1}],nlsActionName:{Intersection:"Intersection1",Address:"Address1",Coordinates:"Coordinates1",Preset:"Preset1"},postCreate:function(){this.inherited(arguments);this.nlsActionName={Intersection:this.nls.actionPage.copyAction.intersection,
Address:this.nls.actionPage.copyAction.address,Coordinates:this.nls.actionPage.copyAction.coordinates,Preset:this.nls.actionPage.copyAction.preset};this.layerCheckBoxNodes={};this.checkBoxNodes={};this._prevAppliedOnLayers=[];this.appliedOn&&(this._prevAppliedOnLayers=l.clone(Object.keys(this.appliedOn)));this._addSearchControl();this._addLayerAndFields(!0)},_addSearchControl:function(){this.searchTextBox=new F({trim:!0,placeHolder:this.nls.actionPage.searchPlaceHolder,intermediateChanges:!0},n.create("div",
{},this.searchNode));E.set(this.searchTextBox.domNode,"width","350px");this.own(u(this.searchTextBox,"change",l.hitch(this,this._searchTextUpdated)));var b=n.create("div",{"class":"esriCTExpandAllNode"},this.searchNode),c=n.create("div",{"class":"esriCTExpandAllNode"},this.searchNode);this._expandAllCheckBox=new y({"class":"switch-toggle",checked:!1},n.create("div",{},b));n.create("label",{innerHTML:this.nls.actionPage.expandAllLabel,"class":"esriCTDojoCheckBoxLabel"},b);this._checkAllFieldsCheckBox=
new y({checked:!1},n.create("div",{},c));n.create("label",{innerHTML:this.nls.actionPage.selectAllLabel,"class":"esriCTDojoCheckBoxLabel"},c);this.noFieldsDOM=n.create("div",{innerHTML:this.nls.actionPage.noValidFieldTypeMsg,"class":"esriCTHidden"},this.searchNode);this.own(u(this._expandAllCheckBox,"change",l.hitch(this,function(a){a?(a=k(".esriCTToggleLayerIcon.esriCTToggleLayerCollapsed.esriCTToggleLayerExpanded",this.layerAndFieldsMainDiv))&&0<a.length&&m.forEach(a,function(d){d.click()}):(a=
k(".esriCTToggleLayerIcon.esriCTToggleLayerCollapsed",this.layerAndFieldsMainDiv))&&0<a.length&&m.forEach(a,function(d){q.contains(d,"esriCTToggleLayerExpanded")||d.click()})})));this.own(u(this._checkAllFieldsCheckBox,"change",l.hitch(this,function(a){var d;var f=""!==this.searchTextBox.get("value")?k("div[searchstring*\x3d'"+this.searchTextBox.get("value").toLowerCase()+"']",this.layerAndFieldsMainDiv):k(".esriCTFieldsDiv",this.layerAndFieldsMainDiv);m.forEach(f,l.hitch(this,function(e){d=H.byNode(k(".esriCTFieldsCheckBox",
e)[0]);a?d.check(!0):d.uncheck(!0)}));this.emit("layerFieldsUpdated",!1)})))},_searchTextUpdated:function(b){var c=b.toLowerCase();if(""!==c){b=k("[searchstring]",this.layerAndFieldsMainDiv);c=k("div[searchstring*\x3d'"+c+"']",this.layerAndFieldsMainDiv);b.style("display","none");b.removeClass("esriCTNotFilteredBySearch");b.addClass("esriCTFilteredBySearch");c.style("display","");c.replaceClass("esriCTNotFilteredBySearch","esriCTFilteredBySearch");b=this.layerDetails;for(var a in b){var d;if(0<Object.keys(b[a]).length){c=
k("[layermaindivid \x3d '"+a+"']",this.layerAndFieldsMainDiv);var f=k("[layerid\x3d'"+a+"']",this.layerAndFieldsMainDiv);var e=!0;for(d=0;d<f.length;d++)if(q.contains(f[d],"esriCTNotFilteredBySearch")){e=!1;break}e?c.style("display","none"):c.style("display","")}}}else k("[layermaindivid]",this.layerAndFieldsMainDiv).style("display",""),k("[searchstring]",this.layerAndFieldsMainDiv).style("display",""),k("[searchstring]",this.layerAndFieldsMainDiv).removeClass("esriCTFilteredBySearch"),k("[searchstring]",
this.layerAndFieldsMainDiv).addClass("esriCTNotFilteredBySearch");this._handleHeaderCheckBoxState()},_addLayerAndFields:function(){var b=[];var c=this.layerDetails;hasFields=!1;for(var a in c)if(0<Object.keys(c[a]).length){hasFields=!0;var d=n.create("div",{"class":"esriCTLayerMainDiv"},this.layerAndFieldsMainDiv);t.set(d,"layermaindivid",a);this._createLayerName(d,a);d=this._getLayersFieldValues(a);this.appliedOn&&this.appliedOn.hasOwnProperty(a)&&0<this.appliedOn[a].length&&b.push(a);for(var f in c[a])if(c[a][f].editable){var e=
!1,p=n.create("div",{"class":"esriCTFieldsDiv  esriCTHidden"},this.layerAndFieldsMainDiv);t.set(p,"layerid",a);if(d&&d.hasOwnProperty(f)){var g;m.some(d[f],function(h){if(h.actionName===this.actionName&&h.enabled&&(!h.hasOwnProperty("attributeActionGroupName")||h.hasOwnProperty("attributeActionGroupName")&&h.attributeActionGroupName!==this.prevName))return g=h,e=!0},this);"Preset"!==this.actionName||!e||!g||g.hasOwnProperty("attributeActionGroupName")&&""!==g.attributeActionGroupName||(e=!1)}this._createFieldName(c[a][f],
a,p,e,g?g.attributeActionGroupName:null)}}0<b.length&&setTimeout(l.hitch(this,function(){this._applyPrevSettings();m.forEach(b,l.hitch(this,function(h){var r=k('[rootnodelayerid\x3d"'+h+'"]');r&&0<r.length&&q.contains(r[0],"esriCTToggleLayerExpanded")&&(k('[rootnodelayerid\x3d"'+h+'"]').toggleClass("esriCTToggleLayerExpanded"),k('[layerid\x3d"'+h+'"]').toggleClass("esriCTHidden"))}));this.emit("layerFieldsUpdated",!0)}),100);hasFields?q.add(this.noFieldsDOM,"esriCTHidden"):q.remove(this.noFieldsDOM,
"esriCTHidden")},_createLayerName:function(b,c){var a;this.layerCheckBoxNodes[c]=[];this.checkBoxNodes[c]=[];if(this.layerInfos.getLayerOrTableInfoById(c)){var d=this.layerInfos.getLayerOrTableInfoById(c).layerObject.name;var f=n.create("div",{"class":"esriCTToggleLayerIcon esriCTToggleLayerCollapsed esriCTToggleLayerExpanded"},b);t.set(f,"rootnodelayerid",c);this.own(u(f,"click",l.hitch(this,function(e){var p=!0,g=k(".esriCTToggleLayerIcon.esriCTToggleLayerCollapsed",this.layerAndFieldsMainDiv);
q.toggle(e.currentTarget,"esriCTToggleLayerExpanded");a=t.get(e.currentTarget,"rootnodelayerid");k('[layerid\x3d"'+a+'"]').toggleClass("esriCTHidden");m.some(g,l.hitch(this,function(h){if(q.contains(h,"esriCTToggleLayerExpanded"))return p=!1,!0}));this._expandAllCheckBox.set("checked",p,!1)})));b=n.create("div",{"class":"esriCTLayercheckBox"},b);n.create("div",{innerHTML:d},b);d=new w({label:d,checked:!1});this.layerCheckBoxNodes[c].push(d);t.set(d.domNode,"LayerCheckBoxId",c);u(d.domNode,"click",
l.hitch(this,this._parentNodeStateChanged))}},_getLayersFieldValues:function(b){var c;m.some(this._configInfos,function(a){if(a.featureLayer&&a.featureLayer.id===b)return a.fieldValues?c=a.fieldValues:a.fieldValues={},!0},this);return c},_getAllLayersFieldValues:function(b,c,a){m.forEach(c,function(d){d.featureLayer&&d.featureLayer.id===a&&(d.fieldValues?b||(b=[]):d.fieldValues={},b.push(d.fieldValues));d.relationshipInfos&&(b=this._getAllLayersFieldValues(b,d.relationshipInfos,a))},this);return b},
_createFieldName:function(b,c,a,d,f){var e=D.getDefaultPortalFieldInfo(b);var p=x.substitute(f?this.nls.attributeActionsPage.alreadyAppliedActionMsg:this.nls.attributeActionsPage.alreadyAppliedActionLayerMsg,{action:this.nlsActionName[this.actionName]});f&&(f=x.substitute(this.nls.attributeActionsPage.appliedGroupName,{groupName:f}),p=p+" "+f);p=n.create("div",{"class":"esriCTExistingExpressionDiv esriCTVisibilityHidden",title:p},a);d&&q.remove(p,"esriCTVisibilityHidden");this.showDomainFieldIndicator&&
(d=n.create("div",{"class":"esriCTDomainlistDiv esriCTVisibilityHidden",innerHTML:"*",title:this.nls.actionPage.domainListTitle},a),b.domain&&b.domain.codedValues&&(q.remove(d,"esriCTVisibilityHidden"),q.remove(this.domainFieldHintMsg,"esriCTHidden")));b=n.create("div",{"class":"esriCTFieldsCheckBox"},a);b=new w({label:e.label,value:e.fieldName,checked:!1},b);this.checkBoxNodes[c].push(b);t.set(a,"searchstring",e.label.toLowerCase());t.set(b.domNode,"fieldsCheckBoxId",c);u(b.domNode,"click",l.hitch(this,
this._childNodeStateChanged));u(b,"change",l.hitch(this,function(){this._handleHeaderCheckBoxState()}))},_handleHeaderCheckBoxState:function(){var b=!0;var c=""!==this.searchTextBox.get("value")?k("[searchstring*\x3d'"+this.searchTextBox.get("value").toLowerCase()+"']",this.layerAndFieldsMainDiv):k(".esriCTFieldsDiv",this.layerAndFieldsMainDiv);0<c.length?m.some(c,l.hitch(this,function(a){a=k(".checkbox",a)[0];if(!q.contains(a,"jimu-icon-checked"))return b=!1,!0})):b=!1;b?this._checkAllFieldsCheckBox.set("checked",
!0,!1):this._checkAllFieldsCheckBox.set("checked",!1,!1)},_parentNodeStateChanged:function(b){var c=t.get(b.currentTarget,"LayerCheckBoxId");b=this.layerCheckBoxNodes[c];c=this.checkBoxNodes[c];var a=b[0].getValue();m.forEach(c,l.hitch(this,function(d){a?d.setValue(!0):d.setValue(!1)}))},_childNodeStateChanged:function(b){var c=t.get(b.currentTarget,"fieldsCheckBoxId");b=this.layerCheckBoxNodes[c];c=this.checkBoxNodes[c];var a=!0;m.some(c,l.hitch(this,function(d){if(!d.getValue())return a=!1,!0}));
b[0].setValue(a);this.emit("layerFieldsUpdated",!1)},getOnlyCheckedFields:function(){var b={},c;for(c in this.checkBoxNodes){b[c]=[];for(var a in this.checkBoxNodes[c])this.checkBoxNodes[c][a].checked&&b[c].push(this.checkBoxNodes[c][a].get("value"))}return b},getCheckedFields:function(b){var c={},a;for(a in this.checkBoxNodes){c[a]=[];for(var d in this.checkBoxNodes[a])this.checkBoxNodes[a][d].checked&&c[a].push(this.checkBoxNodes[a][d].get("value"))}this._applySettingsInLayer(b,c);return c},_removeSettingsFromOtherGroups:function(b,
c,a){var d;if(this.existingGroups)for(var f in this.existingGroups)if(f!==b&&f!==this.prevName&&(d=this.existingGroups[f].appliedOn)&&d.hasOwnProperty(c)&&-1<d[c].indexOf(a)){var e=d[c].indexOf(a);d[c].splice(e,1)}},_removePrevSettingsFromLayerFields:function(b){var c=[];if((c=this._getAllLayersFieldValues(c,this._configInfos,b))&&0<c.length)for(var a=0;a<c.length;a++)if(b=c[a])for(var d in b)for(var f=b[d],e=0;e<f.length;e++)f[e].actionName===this.actionName&&f[e].hasOwnProperty("attributeActionGroupName")&&
f[e].attributeActionGroupName===this.prevName&&(f[e].enabled=!1,delete f[e].attributeActionGroupName,"Intersection"===this.actionName?(f[e].fields=[],f[e].ignoreLayerRanking=!1):"Address"===this.actionName?delete f[e].field:"Coordinates"===this.actionName&&(f[e].coordinatesSystem="MapSpatialReference",f[e].field="x"))},_applysettingsToField:function(b,c,a){var d=[];if((d=this._getAllLayersFieldValues(d,this._configInfos,b))&&0<d.length){for(var f=0;f<d.length;f++){var e=d[f];if(this.appliedOn&&this.appliedOn.hasOwnProperty(b)){var p=
this.appliedOn[b];p&&0<p.length&&m.forEach(p,function(g){if(-1===c.indexOf(g)&&e.hasOwnProperty(g)){g=e[g];for(var h=0;h<g.length;h++)g[h].actionName===this.actionName&&(g[h].enabled=!1,delete g[h].attributeActionGroupName,"Intersection"===this.actionName?(g[h].fields=[],g[h].ignoreLayerRanking=!1):"Address"===this.actionName?delete g[h].field:"Coordinates"===this.actionName&&(g[h].coordinatesSystem="MapSpatialReference",g[h].field="x"))}},this)}}m.forEach(c,function(g){for(var h=0;h<d.length;h++){e=
d[h];e.hasOwnProperty(g)||(e[g]=l.clone(this.defalutFieldInfos));var r=e[g];for(var v=0;v<r.length;v++)r[v].actionName===this.actionName&&(a.attributeInfo&&(r[v]=l.mixin(r[v],a.attributeInfo)),r[v].enabled=!0,r[v].attributeActionGroupName=a.name,this._removeSettingsFromOtherGroups(a.name,b,g))}},this)}},_applySettingsInLayer:function(b,c){for(var a in c){if(this._prevAppliedOnLayers&&-1<this._prevAppliedOnLayers.indexOf(a)){var d=this._prevAppliedOnLayers.indexOf(a);this._prevAppliedOnLayers.splice(d,
1)}this._applysettingsToField(a,c[a],b)}this.deleteGroup()},deleteGroup:function(){this._prevAppliedOnLayers&&m.forEach(this._prevAppliedOnLayers,function(b){this._removePrevSettingsFromLayerFields(b)},this)},_applyPrevSettings:function(){if(this.appliedOn)for(var b in this.appliedOn)if(this.appliedOn.hasOwnProperty(b)){var c=this.appliedOn[b];if(c&&0<c.length){var a=this.layerCheckBoxNodes[b],d=!0;m.forEach(this.checkBoxNodes[b],l.hitch(this,function(e){-1<c.indexOf(e.value)?e.setValue(!0):e.getValue()||
(d=!1)}));d&&a&&a[0]&&a[0].setValue(d)}}var f=!0;b=k(".esriCTFieldsDiv",this.layerAndFieldsMainDiv);0<b.length&&m.some(b,l.hitch(this,function(e){e=k(".checkbox",e)[0];if(!q.contains(e,"jimu-icon-checked"))return f=!1,!0}));this._expandAllCheckBox.set("checked",f,!1)}})});