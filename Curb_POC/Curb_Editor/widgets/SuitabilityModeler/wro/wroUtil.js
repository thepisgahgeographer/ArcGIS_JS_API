// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define(["dojo/_base/lang","dojo/_base/array","dojo/Deferred","esri/layers/RasterFunction"],function(q,h,k,l){return{serverSideRasterFunctionName:"WeightedOverlay_7_1_9_colormap",applyItemDataRenderingRule:function(a,c,b){try{if(this.isServerSideWRORule(b)){var d=new l;d.functionName=b.renderingRule.rasterFunction||b.renderingRule.functionName;d.arguments=b.renderingRule.rasterFunctionArguments||b.renderingRule.arguments;d.variableName=b.renderingRule.variableName;a.setRenderingRule(d,!1)}else b&&
b.renderingRule&&c.supportsClientSideWRO&&(d=new l(b.renderingRule),a.setRenderingRule(d,!1))}catch(g){console.error(g)}},hasServerSideWROFunction:function(a){var c=this.serverSideRasterFunctionName;return a&&(this.isServerSideWRORule(a)||a.rasterFunctionInfos&&h.some(a.rasterFunctionInfos,function(b){if(b&&b.name===c)return!0}))?!0:!1},isServerSideWRORule:function(a){var c=this.serverSideRasterFunctionName;return a&&a.renderingRule&&a.renderingRule.rasterFunction&&a.renderingRule.rasterFunction===
c||a&&a.renderingRule&&a.renderingRule.functionName&&a.renderingRule.functionName===c?!0:!1},makeItemData:function(a,c){a=a.designModelView.weightedOverlayService.modelToImageServiceLayer(c,{modelTitle:"New Model"});c={};q.mixin(c,a);delete c.id;delete c.url;delete c.opacity;delete c.title;return c},newWROInfo:function(){return{isGETen3:!1,isWROLayer:!1,isWROModel:!1,hasServerSideWROFunction:!1,supportsClientSideWRO:!1}},validateWROLayer:function(a,c,b,d,g){var e=new k,m="Title Url Description InputRanges OutputValues NoDataRanges RangeLabels NoDataRangeLabels".split(" "),
n=!1;b.isGETen3=10.3<=c.version;b.hasServerSideWROFunction=this.hasServerSideWROFunction(c);if(b.isGETen3){c.allowRasterFunction||d.push(a.wro.validation.notAllowRasterFunction);var p=[];c.fields&&(p=c.fields);h.forEach(m,function(f){h.some(p,function(r){return f===r.name})||d.push(a.wro.validation.missingFieldPattern.replace("{field}",f))});0<d.length&&!g&&(n=!1);n?c.getKeyProperties().then(function(f){"undefined"!==typeof f&&null!==f&&f.IsWeightedOverlay?b.supportsClientSideWRO=!0:d.push(a.wro.validation.notIsWeightedOverlayProp);
e.resolve()},function(f){e.reject(f)}):(0===d.length&&(b.supportsClientSideWRO=!0),e.resolve())}else b.hasServerSideWROFunction||d.push(a.wro.validation.notAWroService),e.resolve();return e},waitForLayer:function(a,c){var b=new k,d=[];if(a.loaded)return b.resolve(a),b;if(a.loadError)return b.reject(a.loadError),b;var g=function(){h.forEach(d,function(e){e.remove()})};d.push(a.on("load",function(e){g();b.resolve(e.layer)}));d.push(a.on("error",function(e){g();e=e.error;try{e.message&&-1!==e.message.indexOf("Unable to complete")?
(console.warn("layerAccessError",e),b.reject(Error(c.wro.validation.inaccessible))):b.reject(e)}catch(m){b.reject(e)}}));return b}}});